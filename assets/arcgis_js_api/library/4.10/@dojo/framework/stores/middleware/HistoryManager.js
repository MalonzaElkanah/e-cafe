//>>built
(function(a){"object"===typeof module&&"object"===typeof module.exports?(a=a(require,exports),void 0!==a&&(module.exports=a)):"function"===typeof define&&define.amd&&define(["require","exports","../process","../state/Pointer","../../shim/WeakMap"],a)})(function(a,f){Object.defineProperty(f,"__esModule",{value:!0});var l=a("../process"),m=a("../state/Pointer"),p=a("../../shim/WeakMap");a=function(){function a(){this._storeMap=new p.default}a.prototype.collector=function(b){var c=this;return function(a,
d){var e=d.operations,h=d.undoOperations,g=d.id,n=d.store,k=c._storeMap.get(n)||{history:[],undo:[]},f=k.history,k=k.undo;f.push({id:g,operations:e});k.push({id:g,operations:h});c._storeMap.set(n,{history:f,undo:k,redo:[]});b&&b(a,d)}};a.prototype.canUndo=function(b){if(b=this._storeMap.get(b)){var c=b.history;if(b.undo.length&&c.length)return!0}return!1};a.prototype.canRedo=function(b){return(b=this._storeMap.get(b))&&b.redo.length?!0:!1};a.prototype.redo=function(b){var c=this._storeMap.get(b);
if(c){var a=c.history,d=c.redo,c=c.undo;if(d.length){var e=d.pop(),h=e.id,e=e.operations,f=b.apply(e);a.push({id:h,operations:e});c.push({id:h,operations:f});this._storeMap.set(b,{history:a,undo:c,redo:d})}}};a.prototype.undo=function(b){var a=this._storeMap.get(b);if(a){var g=a.history,d=a.undo,a=a.redo;if(d.length&&g.length){var e=d.pop(),h=e.id,e=e.operations;g.pop();e=b.apply(e);a.push({id:h,operations:e});this._storeMap.set(b,{history:g,undo:d,redo:a})}}};a.prototype.deserialize=function(a,c){var b=
c.redo;c.history.forEach(function(b){var e=b.id,d=b.operations,d=d.map(function(a){a.path=new m.Pointer(String(a.path));return a}),c;(b=l.getProcess(e))&&(c=b[2]);l.processExecutor(e,[function(){return d}],a,c,void 0)({})});c=this._storeMap.get(a);b.forEach(function(a){a=a.operations;a=a.map(function(a){a.path=new m.Pointer(String(a.path));return a})});c.redo=b};a.prototype.serialize=function(a){return(a=this._storeMap.get(a))?{history:a.history,redo:a.redo}:{history:[],redo:[]}};return a}();f.HistoryManager=
a;f.default=a});