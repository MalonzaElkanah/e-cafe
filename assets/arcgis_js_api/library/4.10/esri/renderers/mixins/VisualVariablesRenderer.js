// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ../visualVariables/ColorVariable ../visualVariables/OpacityVariable ../visualVariables/RotationVariable ../visualVariables/SizeVariable ../visualVariables/VisualVariable ../visualVariables/VisualVariableFactory ../../support/arcadeUtils ../../symbols/support/utils".split(" "),function(y,z,m,h,n,f,p,q,r,t,u,v,w,k){function l(e){return e&&"opacity"in
e?e.opacity*l(e.parent):1}var x={base:u,key:"type",typeMap:{opacity:q,color:p,rotation:r,size:t}};return function(e){function a(){var c=null!==e&&e.apply(this,arguments)||this;c._vvFactory=new v;return c}m(a,e);Object.defineProperty(a.prototype,"requiredFields",{get:function(){var c=Object.create(null);this.collectRequiredFields(c);return Object.keys(c).sort()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visualVariables",{set:function(c){this._vvFactory.visualVariables=c;this._set("visualVariables",
this._vvFactory.visualVariables)},enumerable:!0,configurable:!0});a.prototype.readVisualVariables=function(c,b,d){return this._vvFactory.readVariables(c,b,d)};a.prototype.writeVisualVariables=function(c,b,d,a){b[d]=this._vvFactory.writeVariables(c,a)};a.prototype.getDisplayedSymbol=function(c,b){if(c){var d=l(c.layer||c.sourceLayer),a=this.getSymbol(c);if(a){a=a.clone();if(!this.visualVariables)return a;var e=this._vvFactory,f=e.colorVariables,g=e.opacityVariables,h=e.sizeVariables,e=e.rotationVariables,
f=!!f.length&&f[f.length-1].getColor(c,b),g=g.length?g[g.length-1].getOpacity(c,b):null;null!=d&&(g=null!=g?g*d:d);k.applyColorToSymbol(a,f,g);h.forEach(function(d){return k.applySizeToSymbol(a,d.getSize(c,b),d.axis)});e.forEach(function(d){return k.applyRotationToSymbol(a,d.getRotationAngle(c,b),d.axis)});return a}}};a.prototype.getVisualVariableValues=function(c,b){return this._vvFactory.getVisualVariableValues(c,b)};a.prototype.hasVisualVariables=function(c,b){return c?!!this.getVisualVariablesForType(c,
b):!!(this.getVisualVariablesForType("size",b)||this.getVisualVariablesForType("color",b)||this.getVisualVariablesForType("opacity",b)||this.getVisualVariablesForType("rotation",b))};a.prototype.getVisualVariablesForType=function(c,b){var a=this.visualVariables;if(a&&(a=a.filter(function(a){return a.type===c&&("string"===typeof b?a.target===b:!1===b?!a.target:!0)}),!a||0!==a.length))return a};a.prototype.getSize=function(a,b){return this._vvFactory.getSize(a,b)};a.prototype.getSizeRangeAtScale=function(a,
b,d){return a?a.getSizeRangeAtScale(b,d):this._vvFactory.getSizeRangeAtScale(b,d)};a.prototype.getColor=function(a,b){return this._vvFactory.getColor(a,b)};a.prototype.getOpacity=function(a,b){return this._vvFactory.getOpacity(a,b)};a.prototype.getRotationAngle=function(a,b){return this._vvFactory.getRotationAngle(a,b)};a.prototype.collectRequiredFields=function(a){var b=[];this.visualVariables&&(b=b.concat(this.visualVariables));b.forEach(function(b){b&&(b.field&&(a[b.field]=!0),b.normalizationField&&
(a[b.normalizationField]=!0),b.valueExpression&&w.extractFieldNames(b.valueExpression).forEach(function(b){a[b]=!0}))})};h([f.property({type:[String],dependsOn:["visualVariables"]})],a.prototype,"requiredFields",null);h([f.property({types:[x],value:null,json:{write:!0}})],a.prototype,"visualVariables",null);h([f.reader("visualVariables",["visualVariables","rotationType","rotationExpression"])],a.prototype,"readVisualVariables",null);h([f.writer("visualVariables")],a.prototype,"writeVisualVariables",
null);return a=h([f.subclass("esri.renderers.mixins.VisualVariablesRenderer")],a)}(f.declared(n))});