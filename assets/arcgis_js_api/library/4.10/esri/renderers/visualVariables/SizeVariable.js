// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Graphic ../../core/Error ../../core/kebabDictionary ../../core/Logger ../../core/screenUtils ../../core/accessorSupport/decorators ./VisualVariable ./support/SizeStop ./support/SizeVariableLegendOptions ./support/sizeVariableUtils ../../support/arcadeUtils".split(" "),function(F,G,v,d,w,x,y,q,z,A,c,B,C,D,e,k){function r(c){if(null!=c){if("string"===typeof c||
"number"===typeof c)return A.toPt(c);if("size"===c.type){if(e.isSizeVariable(c))return c;c=w({},c);delete c.type;return new f(c)}}}function t(c,a,d){if("object"!==typeof c)return c;a=new f;a.read(c,d);return a}var E=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,u=new x,h=z.getLogger("esri.renderers.visualVariables.SizeVariable"),l=q({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),p=q({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",
millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"}),f=function(f){function a(b){b=f.call(this,b)||this;b.axis=null;b.legendOptions=null;b.normalizationField=null;b.scaleBy=null;b.target=null;b.type="size";b.useSymbolValue=null;b.valueExpression=null;b.valueRepresentation=null;b.valueUnit=null;return b}v(a,f);n=a;Object.defineProperty(a.prototype,"_cache",{get:function(){var b=k.createSyntaxTree(this.valueExpression);
return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:k.createFunction(b),isScaleDriven:E.test(this.valueExpression)}},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"expression",{set:function(b){h.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'.");"view.scale"===b?(this.valueExpression="$view.scale",this._set("expression",b)):this._set("expression",null)},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"index",{set:function(b){e.isSizeVariable(this.maxSize)&&(this.maxSize.index="visualVariables["+b+"].maxSize");e.isSizeVariable(this.minSize)&&(this.minSize.index="visualVariables["+b+"].minSize");this._set("index",b)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inputValueType",{get:function(){return e.getInputValueType(this)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxDataValue",{set:function(b){b&&
this.stops&&(h.warn("cannot set maxDataValue when stops is not null."),b=null);this._set("maxDataValue",b)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxSize",{set:function(b){b&&this.stops&&(h.warn("cannot set maxSize when stops is not null."),b=null);this._set("maxSize",b)},enumerable:!0,configurable:!0});a.prototype.castMaxSize=function(b){return r(b)};a.prototype.readMaxSize=function(b,a,c){return t(b,a,c)};Object.defineProperty(a.prototype,"minDataValue",{set:function(b){b&&
this.stops&&(h.warn("cannot set minDataValue when stops is not null."),b=null);this._set("minDataValue",b)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"minSize",{set:function(b){b&&this.stops&&(h.warn("cannot set minSize when stops is not null."),b=null);this._set("minSize",b)},enumerable:!0,configurable:!0});a.prototype.castMinSize=function(b){return r(b)};a.prototype.readMinSize=function(b,a,c){return t(b,a,c)};Object.defineProperty(a.prototype,"stops",{set:function(b){null==
this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?b&&Array.isArray(b)&&(b=b.filter(function(b){return!!b}),b.sort(function(b,a){return b.value-a.value})):b&&(h.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),b=null);this._set("stops",b)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transformationType",{get:function(){return e.getTransformationType(this,this.inputValueType)},enumerable:!0,configurable:!0});
a.prototype.readValueExpression=function(b,a){return b||a.expression&&"$view.scale"};a.prototype.writeValueExpressionWebScene=function(b,a,c,d){"$view.scale"===b?d&&d.messages&&(b=this.index,d.messages.push(new y("property:unsupported",this.type+"VisualVariable.valueExpression \x3d '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:("string"===typeof b?b:"visualVariables["+b+"]")+".valueExpression",context:d}))):a[c]=b};a.prototype.readValueUnit=
function(b,a,c){return b?p.read(b):null};a.prototype.getSize=function(b,a){var c=this._getInputValue(b,a);b=e.getSizeForValue(c,this,b,a,this._cache.ipData);return null===b||void 0===b||isNaN(b)?0:b};a.prototype.getSizeRangeAtScale=function(b,a){var c=a&&"3d"===a.type;if(!(this._cache.isScaleDriven&&c||b))return null;a={scale:b,view:a};b=e.getSizeFromNumberOrVariable(this.minSize,u,a);a=e.getSizeFromNumberOrVariable(this.maxSize,u,a);if(null!=b||null!=a)return b>a&&(c=a,a=b,b=c),{minSize:b,maxSize:a}};
a.prototype.clone=function(){return new n({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:e.isSizeVariable(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:e.isSizeVariable(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(function(b){return b.clone()}),target:this.target,useSymbolValue:this.useSymbolValue,
valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})};a.prototype._interpolateData=function(){return this.stops&&this.stops.map(function(b){return b.value||0})};a.prototype._getInputValue=function(b,a){var c="number"===typeof b,d=c?null:b,m=d&&d.attributes,g=c?b:null,f=this._cache;b=f.compiledFunc;if(f.isScaleDriven)d=a&&a.scale,a=a&&a.view,g=null==d||a&&"3d"===a.type?this._getAverageSizeValue():d;else if(!c)switch(this.inputValueType){case "expression":a=
k.getViewInfo(a);a=k.createExecContext(d,a);g=k.executeFunction(b,a);break;case "field":m&&(g=m[this.field]);break;case "unknown":g=null}if(!e.isValidNumber(g))return null;if(c||!this.normalizationField)return g;c=m?parseFloat(m[this.normalizationField]):null;return e.isValidNumber(c)&&0!==c?g/c:null};a.prototype._getAverageSizeValue=function(){var b=null,a=null;(a=this.stops)?(b=a[0].value,a=a[a.length-1].value):(b=this.minDataValue||0,a=this.maxDataValue||0);return(b+a)/2};var n;d([c.property({readOnly:!0,
dependsOn:["valueExpression","stops"]})],a.prototype,"_cache",null);d([c.property({type:l.apiValues,json:{type:l.jsonValues,origins:{"web-map":{read:!1}},read:l.read,write:l.write}})],a.prototype,"axis",void 0);d([c.property({type:String,value:null,json:{read:!1}})],a.prototype,"expression",null);d([c.property()],a.prototype,"index",null);d([c.property({type:String,readOnly:!0,dependsOn:["field","valueExpression"]})],a.prototype,"inputValueType",null);d([c.property({type:D,json:{write:!0}})],a.prototype,
"legendOptions",void 0);d([c.property({type:Number,value:null,json:{write:!0}})],a.prototype,"maxDataValue",null);d([c.property({type:Number,value:null,json:{write:!0}})],a.prototype,"maxSize",null);d([c.cast("maxSize")],a.prototype,"castMaxSize",null);d([c.reader("maxSize")],a.prototype,"readMaxSize",null);d([c.property({type:Number,value:null,json:{write:!0}})],a.prototype,"minDataValue",null);d([c.property({type:Number,value:null,json:{write:!0}})],a.prototype,"minSize",null);d([c.cast("minSize")],
a.prototype,"castMinSize",null);d([c.reader("minSize")],a.prototype,"readMinSize",null);d([c.property({type:String,json:{write:!0}})],a.prototype,"normalizationField",void 0);d([c.property({type:String})],a.prototype,"scaleBy",void 0);d([c.property({type:[C],value:null,json:{write:!0}})],a.prototype,"stops",null);d([c.property({type:["outline"],json:{write:!0}})],a.prototype,"target",void 0);d([c.property({type:String,readOnly:!0,dependsOn:"minDataValue maxDataValue minSize maxSize valueUnit inputValueType stops".split(" ")})],
a.prototype,"transformationType",null);d([c.property({type:["size"],json:{type:["sizeInfo"]}})],a.prototype,"type",void 0);d([c.property({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],a.prototype,"useSymbolValue",void 0);d([c.property({type:String,json:{write:!0}})],a.prototype,"valueExpression",void 0);d([c.reader("valueExpression",["valueExpression","expression"])],a.prototype,"readValueExpression",null);d([c.writer("web-scene","valueExpression")],a.prototype,"writeValueExpressionWebScene",
null);d([c.property({type:["radius","diameter","area","width","distance"],json:{write:!0}})],a.prototype,"valueRepresentation",void 0);d([c.property({type:p.apiValues,json:{write:p.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],a.prototype,"valueUnit",void 0);d([c.reader("valueUnit")],a.prototype,"readValueUnit",null);return a=n=d([c.subclass("esri.renderers.visualVariables.SizeVariable")],a)}(c.declared(B));return f});