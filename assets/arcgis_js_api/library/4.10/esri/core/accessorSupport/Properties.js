// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../has ../Logger ../ObjectPool ./extensions ./PropertyOrigin ./Store".split(" "),function(h,k,l,m,n,p,e,q){Object.defineProperty(k,"__esModule",{value:!0});m.getLogger("esri.core.accessorSupport.Properties");h=function(){function b(a){this.host=a;this._origin=e.OriginId.USER;this.ctorArgs=this.cursors=null;this.destroyed=!1;this.dirties={};this.lifecycle=0;this.overridden=null;this.store=new q.default;a=this.host.constructor.__accessorMetadata__;this.metadatas=a.properties;
this.autoDestroy=a.autoDestroy}b.prototype.initialize=function(){this.lifecycle=1;p.instanceCreated(this.host,this.metadatas)};b.prototype.constructed=function(){this.lifecycle=2};b.prototype.destroy=function(){this.destroyed=!0;var a=this.cursors;if(this.cursors)for(var c=0,d=Object.getOwnPropertyNames(a);c<d.length;c++){var b=d[c],f=a[b];if(f){for(;0<f.length;)f.pop().propertyDestroyed(this,b);a[b]=null}}if(this.autoDestroy)for(b in this.metadatas)(a=this.internalGet(b))&&a&&"function"===typeof a.destroy&&
(a.destroy(),this.metadatas[b].nonNullable||this.internalSet(b,null))};Object.defineProperty(b.prototype,"initialized",{get:function(){return 0!==this.lifecycle},enumerable:!0,configurable:!0});b.prototype.clearOverride=function(a){this.isOverridden(a)&&(this.overridden[a]=!1,this.propertyInvalidated(a))};b.prototype.get=function(a){var c=this.metadatas[a];if(this.store.has(a)&&!this.dirties[a])return this.store.get(a);var d=c.get;return d?(c=d.call(this.host),this.store.set(a,c,e.OriginId.COMPUTED),
this.propertyCommitted(a),c):c.value};b.prototype.originOf=function(a){var c=this.store.originOf(a);return void 0===c&&(a=this.metadatas[a])&&a.hasOwnProperty("value")?"defaults":e.idToName(c)};b.prototype.has=function(a){return this.metadatas[a]?this.store.has(a):!1};b.prototype.internalGet=function(a){if(this.metadatas[a]){var c=this.store;return c.has(a)?c.get(a):this.metadatas[a].value}};b.prototype.internalSet=function(a,c){if(this.metadatas[a]){var d=this.initialized?this._origin:e.OriginId.DEFAULTS,
b=this.store.get(a,d);if(c!==b||!this.store.has(a,d)||this.isOverridden(a))this.propertyInvalidated(a),this.store.set(a,c,d),this.propertyCommitted(a)}};b.prototype.isOverridden=function(a){return null!=this.overridden&&!0===this.overridden[a]};b.prototype.keys=function(){return Object.keys(this.metadatas)};b.prototype.override=function(a,c){if(this.metadatas[a]){this.overridden||(this.overridden={});var d=this.metadatas[a];if(!d.nonNullable||null!=c){if(d=d.cast){c=this.cast(d,c);var d=c.valid,b=
c.value;g.release(c);if(!d)return;c=b}this.overridden[a]=!0;this.internalSet(a,c)}}};b.prototype.set=function(a,c){if(this.metadatas[a]){var d=this.metadatas[a];if(!d.nonNullable||null!=c){var b=d.set;if(d=d.cast){c=this.cast(d,c);var d=c.valid,f=c.value;g.release(c);if(!d)return;c=f}b?b.call(this.host,c):this.internalSet(a,c)}}};b.prototype.setDefaultOrigin=function(a){this._origin=e.nameToId(a)};b.prototype.propertyInvalidated=function(a){var c=this.dirties,d=this.isOverridden(a),b=this.cursors&&
this.cursors[a],f=this.metadatas[a].computes;if(b)for(var e=0;e<b.length;e++)b[e].propertyInvalidated(this,a);d||(c[a]=!0);if(f)for(a=0;a<f.length;a++)this.propertyInvalidated(f[a])};b.prototype.propertyCommitted=function(a){var c=this.cursors&&this.cursors[a];this.dirties[a]=!1;if(c)for(var b=0;b<c.length;b++)c[b].propertyCommitted(this,a)};b.prototype.addCursor=function(a,c){this.cursors||(this.cursors={});var b=this.cursors[a];b||(this.cursors[a]=b=[]);b.push(c)};b.prototype.removeCursor=function(a,
b){var c=this.cursors[a];this.cursors[a]&&(c.splice(c.indexOf(b),1),0===c.length&&(this.cursors[a]=null))};b.prototype.cast=function(a,b){var c=g.acquire();c.valid=!0;c.value=b;a&&(c.value=a.call(this.host,b,c));return c};return b}();l=function(){function b(){this.value=null;this.valid=!0}b.prototype.acquire=function(){this.valid=!0};b.prototype.release=function(){this.value=null};return b}();var g=new n(l);k.default=h});