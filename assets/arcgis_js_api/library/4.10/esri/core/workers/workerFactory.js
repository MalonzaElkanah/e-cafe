// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../has ../Logger ../promiseUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(A,q,k,u,g,d,v,w,r,l,e){function t(a){return w.create(function(h){function m(b){if(b=l.receiveMessage(b))switch(b.type){case x:b=a;var e=g.workers.loaderUrl||r.DEFAULT_LOADER_URL,f;null!=g["default"]?(f=k({},g),delete f["default"],f=JSON.parse(JSON.stringify(f))):f=JSON.parse(JSON.stringify(g));var c=g.workers.loaderConfig,c=
r.default({baseUrl:c.baseUrl,locale:u.locale,has:k({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-secure-context":d("esri-secure-context"),"esri-workers-arraybuffer-transfer":d("esri-workers-arraybuffer-transfer"),"events-keypress-typed":0,"host-webworker":1},c.has),map:k({},c.map),paths:k({},c.paths),packages:c.packages||[]});b.postMessage({type:y,configure:{esriConfig:f,loaderUrl:e,loaderConfig:c}});break;case z:a.removeEventListener("message",m),a.removeEventListener("error",n),
h(a)}}function n(b){b.preventDefault();a.removeEventListener("message",m);a.removeEventListener("error",n);p.warn("Failed to create Worker. Fallback to execute module in main thread",b);a=new e;a.addEventListener("message",m);a.addEventListener("error",n)}a.addEventListener("message",m);a.addEventListener("error",n)})}Object.defineProperty(q,"__esModule",{value:!0});var p=v.getLogger("esri.core.workers");d.add("esri-workers-arraybuffer-transfer",!d("safari")||12<=d("safari"));var z=l.MessageType.CONFIGURED,
y=l.MessageType.CONFIGURE,x=l.MessageType.HANDSHAKE,h;try{h=URL.createObjectURL(new Blob(['var globalId\x3d0;var outgoing\x3dnew Map;var configured\x3dfalse;var HANDSHAKE\x3d0;var CONFIGURE\x3d1;var CONFIGURED\x3d2;var OPEN\x3d3;var OPENED\x3d4;var RESPONSE\x3d5;var INVOKE\x3d6;var CANCEL\x3d7;function mapDelete(map,key){map["delete"](key)}function receiveMessage(event){if(!event||!event.data){return null}if(typeof event.data\x3d\x3d\x3d"string"){return JSON.parse(event.data)}return event.data}function invokeStaticMessage(methodName,data,options){var signal\x3doptions\x26\x26options.signal;var Deferred\x3drequire("dojo/Deferred");var jobId\x3dglobalId++;var abortHandler\x3dfunction(){if(!outgoing.has(jobId)){return}self.postMessage({type:CANCEL,methodName:methodName,jobId:jobId});mapDelete(outgoing,jobId);if(!deferred.isCanceled()){deferred.cancel()}if(signal){signal.removeEventListener("abort",abortHandler)}};if(signal){signal.addEventListener("abort",abortHandler)}var deferred\x3dnew Deferred(abortHandler);outgoing.set(jobId,deferred);self.postMessage({type:INVOKE,methodName:methodName,jobId:jobId,data:data});return deferred.promise}function messageHandler(event){var message\x3dreceiveMessage(event);if(!message){return}var jobId\x3dmessage.jobId;switch(message.type){case CONFIGURE:var configuration\x3dmessage.configure;if(configured){return}self.dojoConfig\x3dconfiguration.loaderConfig;self.importScripts(configuration.loaderUrl);if(typeof require.config\x3d\x3d\x3d"function"){require.config(configuration.loaderConfig)}require(["esri/config"],function(esriConfig){for(var name in configuration.esriConfig){if(Object.prototype.hasOwnProperty.call(configuration.esriConfig,name)){esriConfig[name]\x3dconfiguration.esriConfig[name]}}self.postMessage({type:CONFIGURED})});break;case OPEN:var modulePath\x3dmessage.modulePath;require(["esri/core/workers/RemoteClient",modulePath],function(RemoteClient,Module){var port\x3dRemoteClient.connect(Module);self.postMessage({type:OPENED,jobId:jobId,data:port},[port])});break;case RESPONSE:if(outgoing.has(jobId)){var deferred\x3doutgoing.get(jobId);mapDelete(outgoing,jobId);if(message.error){deferred.reject(JSON.parse(message.error))}else{deferred.resolve(message.data)}}break}}self.addEventListener("message",messageHandler);self.postMessage({type:HANDSHAKE});'],
{type:"text/javascript"}))}catch(a){}q.createWorker=function(){if(!d("esri-workers"))return t(new e);var a;if(h)try{a=new Worker(h)}catch(B){p.warn("Failed to create Worker. Fallback to execute module in main thread",event),a=new e}else p.warn("Failed to create Worker. Fallback to execute module in main thread",event),a=new e;return t(a)}});