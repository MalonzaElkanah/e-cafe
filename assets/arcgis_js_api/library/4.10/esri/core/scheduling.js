// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define(["require","exports","./nextTick","./now","./requestAnimationFrame"],function(G,b,A,B,C){function D(a){void 0===a&&(a=b.now());b.debug.rafId=null;0<g.length&&(b.debug.rafId=k());if(0<l){var c=a-l;n=Math.min(c,n);if(c<f)return}b.debug.executeFrameTasks(a)}function k(){return b.debug.requestNextFrame?b.debug.requestNextFrame(u):u()}function v(){for(var a=0;a<g.length;){var c=g[a];a++;if(c.removed){g.splice(a-1,1);for(var b=0;b<p.length;b++){var h=p[b];if(c.phases[h]){var h=r[h],d=h.indexOf(c);
-1!==d&&h.splice(d,1)}}}}}function x(){for(;t.length;){var a=t.shift();a.isActive&&(a.isActive=!1,a.callback())}b.debug.willDispatch=!1}function u(){return C(D)}Object.defineProperty(b,"__esModule",{value:!0});b.now=B;var E=function(){return function(a){this.phases=a;this.paused=!1;this.pausedAt=0;this.epoch=-1;this.dt=0;this.ticks=-1;this.removed=!1}}(),F=function(){function a(a){this.callback=a;this.isActive=!0}a.prototype.remove=function(){this.isActive=!1};return a}(),l=-1,f=0,q=0,n=Number.POSITIVE_INFINITY,
m={time:0,deltaTime:0,tickTime:0,elapsedFrameTime:0,frameDuration:0,spendInTask:0},p=["prepare","preRender","render","postRender","update"],t=[],g=[],r={prepare:[],preRender:[],render:[],postRender:[],update:[]},y=function(){function a(a){this._task=a}a.prototype.remove=function(){this._task.removed=!0};a.prototype.pause=function(){this._task.paused||(this._task.paused=!0,this._task.pausedAt=b.now())};a.prototype.resume=function(){this._task.paused&&(this._task.paused=!1,-1!==this._task.epoch&&(this._task.epoch+=
b.now()-this._task.pausedAt))};return a}();b.FrameTaskHandle=y;b.debug={frameTasks:g,rafId:null,requestNextFrame:null,willDispatch:!1,clearFrameTasks:function(a){void 0===a&&(a=!1);for(var b=0;b<g.length;b++)g[b].removed=!0;a&&v()},dispatch:x,executeFrameTasks:function(a){void 0===a&&(a=b.now());0>l&&(l=a);var c=a-l,w=0<q?q:n,h=Math.max(0,c-w);l=a;for(var d=0;d<g.length;d++){var e=g[d];-1!==e.epoch&&(e.dt=c)}for(d=0;d<p.length;d++)for(var c=p[d],k=r[c],f=0;f<k.length;f++)e=k[(f+z)%k.length],e.paused||
e.removed||(0===d&&e.ticks++,-1===e.epoch&&(e.epoch=a),m.time=a,m.deltaTime=e.dt,m.tickTime=Math.min(n,33),m.elapsedFrameTime=b.now()-a,m.frameDuration=w-h,m.spendInTask=a-e.epoch,e.phases[c].call(e,m));v();++z}};b.schedule=function(a){a=new F(a);t.push(a);b.debug.willDispatch||(b.debug.willDispatch=!0,A(x));return a};b.addFrameTask=function(a){var c=new E(a);g.push(c);for(var f=0,h=p;f<h.length;f++){var d=h[f];a[d]&&r[d].push(c)}b.debug.rafId||(l=-1,b.debug.rafId=k());return new y(c)};b.setFrameRate=
function(a){if(0>=a)q=f=0;else{var b=1.05*n;a=Math.ceil(1E3/a/b);f=(a-1)*b;q=a*n}};var z=0;b.requestNextFrame=k});