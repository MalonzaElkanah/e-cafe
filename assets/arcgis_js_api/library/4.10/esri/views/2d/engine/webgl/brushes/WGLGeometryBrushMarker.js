// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),function(m,n,t,u,v,p,w,q,r){Object.defineProperty(n,"__esModule",{value:!0});m=function(l){function d(){var a=null!==l&&l.apply(this,arguments)||this;a._iconVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffsetAndTex",
count:4,type:5120,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:8,stride:24,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:24,normalized:!0,divisor:0},{name:"a_outlineColor",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_sizeAndOutlineWidth",count:4,type:5121,offset:20,stride:24,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};a._iconVertexAttributesWithVV=
{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:40,normalized:!1,divisor:0},{name:"a_vertexOffsetAndTex",count:4,type:5120,offset:4,stride:40,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:8,stride:40,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:40,normalized:!0,divisor:0},{name:"a_outlineColor",count:4,type:5121,offset:16,stride:40,normalized:!0,divisor:0},{name:"a_sizeAndOutlineWidth",count:4,type:5121,offset:20,stride:40,normalized:!1,divisor:0},
{name:"a_vv",count:4,type:5126,offset:24,stride:40,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};a._spritesTextureSize=u.vec2f32.create();return a}t(d,l);d.prototype.dispose=function(){};d.prototype.getGeometryType=function(){return v.WGLGeometryType.MARKER};d.prototype.drawGeometry=function(a,f,b,e){e=a.context;var h=a.painter,c=a.rendererInfo,d=a.state,l=b.indexCount,m=b.indexFrom,g=b.materialInfo;b=g.materialKeyInfo;if(a=
h.materialManager.getProgram(g.materialKey,a.drawPhase)){e.bindProgram(a);var k=this._getVAO(e,f,b.hasVV());e.bindVAO(k);k=g.texBindingInfo[0];g=k.pageId;h.textureManager.bindSpritePage(e,g,k.unit);a.setUniform1i(k.semantic,k.unit);h=h.textureManager.sprites;this._spritesTextureSize[0]=h.getWidth(g)/4;this._spritesTextureSize[1]=h.getHeight(g)/4;a.setUniformMatrix3fv("u_displayMat3",b.vvRotation?d.displayViewMat3:d.displayMat3);a.setUniformMatrix3fv("u_dvsMat3",f.dvsMat3);a.setUniform2fv("u_mosaicSize",
this._spritesTextureSize);b.vvSizeMinMaxValue&&a.setUniform4fv("u_vvSizeMinMaxValue",c.vvSizeMinMaxValue);b.vvSizeScaleStops&&a.setUniform1f("u_vvSizeScaleStopsValue",c.vvSizeScaleStopsValue);b.vvSizeFieldStops&&(a.setUniform1fv("u_vvSizeFieldStopsValues",c.vvSizeFieldStopsValues),a.setUniform1fv("u_vvSizeFieldStopsSizes",c.vvSizeFieldStopsSizes));b.vvSizeUnitValue&&a.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",c.vvSizeUnitValueToPixelsRatio);b.vvColor&&(a.setUniform1fv("u_vvColorValues",c.vvColorValues),
a.setUniform4fv("u_vvColors",c.vvColors));b.vvOpacity&&(a.setUniform1fv("u_vvOpacityValues",c.vvOpacityValues),a.setUniform1fv("u_vvOpacities",c.vvOpacities));b.vvRotation&&a.setUniform1f("u_vvRotationType","geographic"===c.vvMaterialParameters.vvRotationType?0:1);e.drawElements(4,l,5125,4*m);e.bindVAO(null)}};d.prototype._getVAO=function(a,f,b){if(f.iconGeometry.vao)return f.iconGeometry.vao;var e=f.iconGeometry.vertexBufferMap[p.C_VBO_GEOMETRY],d=f.iconGeometry.vertexBufferMap[p.C_VBO_VISIBILITY],
c=f.iconGeometry.indexBuffer;if(!e||!c)return null;f.iconGeometry.vao=b?new r(a,q.icon.attributes,this._iconVertexAttributesWithVV,{geometry:e,visibility:d},c):new r(a,q.icon.attributes,this._iconVertexAttributes,{geometry:e,visibility:d},c);return f.iconGeometry.vao};return d}(w.default);n.default=m});