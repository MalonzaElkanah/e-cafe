// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define(["require","exports","./Rect"],function(y,z,v){return function(){function k(c,d,e,b,g,h,a,f){this._glyphItems=c;this._maxWidth=d;this._lineHeight=e;this._letterSpacing=b;this._offset=g;this._hAnchor=h;this._vAnchor=a;this._justify=f}k.prototype.getShaping=function(c,d){for(var e=this._letterSpacing,b=this._lineHeight,g=this._justify,h=this._maxWidth,a=[],f=0,n=0,p=0,q=0,r=-1,t=0,k=-1,v=c.length,w=0;w<v;w++){var x=c.charCodeAt(w);if(10===x){if(w!==v-1){if(r>=q){var f=a[r],l=f.x+f.glyphMosaicItem.metrics.advance,
t=Math.max(l,t);g&&this._applyJustification(a,q,r);q=a.length}n=d?n-b:n+b;f=0;++p}}else{for(var l=void 0,u=0,m=this._glyphItems;u<m.length&&!(l=m[u][x]);u++);if(l){a.push({codePoint:x,x:f,y:n,glyphMosaicItem:l});f+=l.metrics.advance+e;if(0<h&&f>h&&0<=k){u=k+1;l=a[u].x;t=Math.max(l,t);for(m=u;m<a.length;m++)a[m].y=d?a[m].y-b:a[m].y+b,a[m].x-=l;g&&this._applyJustification(a,q,k);n=d?n-b:n+b;f-=l;++p;q=u;k=-1}++r;32===x&&(k=a.length-1)}}}r>=q&&(f=a[r],t=Math.max(t,f.x+f.glyphMosaicItem.metrics.advance),
g&&this._applyJustification(a,q,r));if(0<a.length)for(c=(g-this._hAnchor)*t,e=(-this._vAnchor*(p+1)+.5)*b,d&&p&&(e+=p*b),c+=this._offset[0],e+=this._offset[1],d=0;d<a.length;d++)b=a[d],b.x+=c,b.y+=e;return a};k.getBox=function(c){if(!c.length)return null;for(var d=Infinity,e=Infinity,b=-Infinity,g=-Infinity,h=0;h<c.length;h++)var a=c[h],f=a.glyphMosaicItem.metrics,k=a.x+f.left,a=a.y-f.top,p=k+f.width,f=a+f.height,d=Math.min(d,k),b=Math.max(b,p),e=Math.min(e,a),g=Math.max(g,f);return{x:d,y:e,width:b-
d,height:g-e}};k.addDecoration=function(c,d){var e=c.length;if(0!==e){for(var b=c[0].x+c[0].glyphMosaicItem.metrics.left,g=c[0].y,h=1;h<e;h++){var a=c[h];if(a.y!==g){var f=c[h-1].x+c[h-1].glyphMosaicItem.metrics.left+c[h-1].glyphMosaicItem.metrics.width;c.push({codePoint:0,x:b,y:g,glyphMosaicItem:{rect:new v(4,0,4,8),metrics:{width:f-b,height:2,left:0,top:d,advance:0},page:0}});g=a.y;b=a.x+a.glyphMosaicItem.metrics.left}}e=c[e-1].x+c[e-1].glyphMosaicItem.metrics.left+c[e-1].glyphMosaicItem.metrics.width;
c.push({codePoint:0,x:b,y:g,glyphMosaicItem:{rect:new v(4,0,4,8),metrics:{width:e-b,height:2,left:0,top:d,advance:0},page:0}})}};k.prototype._applyJustification=function(c,d,e){for(var b=c[e],b=(b.x+b.glyphMosaicItem.metrics.advance)*this._justify;d<=e;d++)c[d].x-=b};return k}()});