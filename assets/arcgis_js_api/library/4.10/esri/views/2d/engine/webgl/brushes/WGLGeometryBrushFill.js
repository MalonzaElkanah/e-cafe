// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),function(m,n,t,u,v,h,w,q,r){Object.defineProperty(n,"__esModule",{value:!0});m=function(k){function c(){var a=null!==k&&k.apply(this,arguments)||this;a._isInitialized=!1;a._spritesTextureSize=u.vec2f32.create();return a}t(c,k);c.prototype.dispose=function(){};c.prototype.getGeometryType=
function(){return v.WGLGeometryType.FILL};c.prototype.drawGeometry=function(a,d,b,e){e=a.context;var c=a.painter,g=a.rendererInfo,k=a.requiredLevel,m=b.indexCount,n=b.indexFrom;this._initialize();var p=b.materialInfo.materialKeyInfo,f=a.painter.materialManager.getProgram(b.materialInfo.materialKey,a.drawPhase);if(f){e.bindProgram(f);var l=this._getVAO(e,d,p.hasVV());e.bindVAO(l);if(0<b.materialInfo.texBindingInfo.length){b=b.materialInfo.texBindingInfo[0];var l=b.pageId,h=a.painter.textureManager.sprites;
this._spritesTextureSize[0]=h.getWidth(l);this._spritesTextureSize[1]=h.getHeight(l);f.setUniform1f("u_zoomFactor",1/Math.pow(2,k-d.key.level)/a.pixelRatio);c.textureManager.bindSpritePage(e,l,b.unit,9729);f.setUniform1i(b.semantic,b.unit);f.setUniform2fv("u_mosaicSize",this._spritesTextureSize)}f.setUniformMatrix3fv("u_dvsMat3",d.dvsMat3);p.vvColor&&(f.setUniform1fv("u_vvColorValues",g.vvColorValues),f.setUniform4fv("u_vvColors",g.vvColors));p.vvOpacity&&(f.setUniform1fv("u_vvOpacityValues",g.vvOpacityValues),
f.setUniform1fv("u_vvOpacities",g.vvOpacities));e.drawElements(4,m,5125,4*n);e.bindVAO(null)}};c.prototype._initialize=function(){if(this._isInitialized)return!0;this._fillVertexAttributeLayout={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:28,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:28,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:28,normalized:!0,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:12,stride:28,normalized:!1,
divisor:0},{name:"a_aux1",count:4,type:5121,offset:20,stride:28,normalized:!1,divisor:0},{name:"a_aux2",count:2,type:5123,offset:24,stride:28,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};this._fillVertexAttributeLayoutVV={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:36,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:36,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:36,
normalized:!0,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:12,stride:36,normalized:!1,divisor:0},{name:"a_aux1",count:4,type:5121,offset:20,stride:36,normalized:!1,divisor:0},{name:"a_aux2",count:2,type:5123,offset:24,stride:36,normalized:!1,divisor:0},{name:"a_vv",count:2,type:5126,offset:28,stride:36,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};this._isInitialized=!0};c.prototype._getVAO=function(a,d,b){if(d.fillGeometry.vao)return d.fillGeometry.vao;
var e=d.fillGeometry.vertexBufferMap[h.C_VBO_GEOMETRY],c=d.fillGeometry.vertexBufferMap[h.C_VBO_VISIBILITY],g=d.fillGeometry.indexBuffer;if(!e||!g)return null;d.fillGeometry.vao=b?new r(a,q.fill.attributes,this._fillVertexAttributeLayoutVV,{geometry:e,visibility:c},g):new r(a,q.fill.attributes,this._fillVertexAttributeLayout,{geometry:e,visibility:c},g);return d.fillGeometry.vao};return c}(w.default);n.default=m});