// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/Logger ./enums ./MaterialInfo ./Utils".split(" "),function(p,z,A,u,e,r,v){function l(b,a,g){for(var h=[],c=3;c<arguments.length;c++)h[c-3]=arguments[c];a<b.length?b.splice.apply(b,[a,g].concat(h)):b.push.apply(b,h)}var w=u.getLogger("esri.views.2d.engine.webgl.WGLDisplayList"),q=new Map;q.set(e.WGLDrawPhase.MAP,[e.WGLGeometryType.FILL,e.WGLGeometryType.LINE,e.WGLGeometryType.MARKER,e.WGLGeometryType.TEXT]);q.set(e.WGLDrawPhase.LABEL,
[e.WGLGeometryType.LABEL]);q.set(e.WGLDrawPhase.LABEL_ALPHA,[e.WGLGeometryType.LABEL]);p=function(){function b(a){void 0===a&&(a=!1);this.symbolLevels=[];this.unified=a}b.prototype.replay=function(a,g){if(this.unified)for(var h=0,c=this.symbolLevels;h<c.length;h++)for(var b=0,d=c[h].zLevels;b<d.length;b++){var f=d[b].geometryDPInfo,k;for(k in f)if(f[k])for(var e=0,l=f[k];e<l.length;e++){var n=l[e];a.painter.getGeometryBrush(n.geometryType).drawGeometry(a,g,n,null)}}else for(var h=function(c){var d=
a.painter.getGeometryBrush(c);p.byType(c,function(c){d.drawGeometry(a,g,c,null)})},p=this,c=0,b=q.get(a.drawPhase);c<b.length;c++)h(b[c])};Object.defineProperty(b.prototype,"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});b.prototype.clear=function(){this.symbolLevels.length=0};b.prototype.addToList=function(a,g){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._addToList(a[b],g);else this._addToList(a,g)};b.prototype.removeFromList=
function(a){Array.isArray(a)||(a=[a]);for(var g=null,b=0;b<a.length;b++)g=this._removeFromList(a[b]);return g};b.prototype.byType=function(a,g){for(var b=0,c=this.symbolLevels;b<c.length;b++)for(var m=0,d=c[b].zLevels;m<d.length;m++){var f=d[m].geometryDPInfo,e=this.getDPInfoType(a);if(f[e])for(var l=0,f=f[e];l<f.length;l++)g(f[l])}};b.prototype.clone=function(){for(var a=new b(this.unified),g=0,h=this.symbolLevels;g<h.length;g++)a.symbolLevels.push(h[g].clone());return a};b.prototype.splitAfter=
function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),h=b.length,c=a.indexFrom+a.indexCount,e=0;e<h;++e){var d=b[e];if(d.geometryType===a.geometryType&&c>d.indexFrom&&c<=d.indexFrom+d.indexCount)return c<d.indexFrom+d.indexCount&&(a=new n,a.geometryType=d.geometryType,a.materialInfo=d.materialInfo,a.indexFrom=c,a.indexCount=d.indexFrom+d.indexCount-c,b.splice(e+1,0,a),d.indexCount=c-d.indexFrom),e}};b.prototype._addToList=function(a,b){var g=this._getDisplayList(a.symbolLevel,
a.zOrder,a.geometryType);b=null!=b?b:g.length-1;var c=0<=b&&b<g.length?g[b]:null;null===c||!v.isSameMaterialInfo(c.materialInfo,a.materialInfo)||c.indexFrom+c.indexCount!==a.indexFrom||this.unified&&c.geometryType!==a.geometryType?(c=new n,c.indexFrom=a.indexFrom,c.indexCount=a.indexCount,c.materialInfo=a.materialInfo,c.geometryType=a.geometryType,l(g,b+1,0,c)):c.indexCount+=a.indexCount};b.prototype._removeFromList=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),
e=b.length,c=void 0,m=0;m<e;++m){var d=b[m];if(a.indexFrom+a.indexCount>d.indexFrom&&a.indexFrom<d.indexFrom+d.indexCount&&(!this.unified||d.geometryType===a.geometryType)){c=m;break}}if(void 0!==c){d=b[c];if(a.indexFrom===d.indexFrom)return d.indexCount-=a.indexCount,d.indexFrom+=a.indexCount,0===d.indexCount&&l(b,c,1),c-1;if(a.indexFrom+a.indexCount===d.indexFrom+d.indexCount)return d.indexCount-=a.indexCount,0===d.indexCount?(l(b,c,1),c-1):c;var e=d.indexFrom,m=a.indexFrom-d.indexFrom,f=a.indexCount;
a=d.indexFrom+d.indexCount-(a.indexFrom+a.indexCount);d.indexCount=m;var k=new n;k.geometryType=d.geometryType;k.materialInfo=new r.default;k.materialInfo.copy(d.materialInfo);k.indexFrom=e+m+f;k.indexCount=a;l(b,c+1,0,k);return c}return null};b.prototype._getDisplayList=function(a,b,h){for(var c,g=this.symbolLevels.length,d=0;d<g;d++)if(this.symbolLevels[d].symbolLevel===a){c=this.symbolLevels[d];break}c||(c=new x,c.symbolLevel=a,this.symbolLevels.push(c));var f;a=c.zLevels.length;for(g=0;g<a;g++)if(c.zLevels[g].zLevel===
b){f=c.zLevels[g];break}f||(f=new y,f.geometryDPInfo=new t,f.zLevel=b,c.zLevels.push(f));var k;if(this.unified)f.geometryDPInfo.unified||(f.geometryDPInfo.unified=[]),k=f.geometryDPInfo.unified;else switch(h){case e.WGLGeometryType.FILL:f.geometryDPInfo.fill||(f.geometryDPInfo.fill=[]);k=f.geometryDPInfo.fill;break;case e.WGLGeometryType.LINE:f.geometryDPInfo.line||(f.geometryDPInfo.line=[]);k=f.geometryDPInfo.line;break;case e.WGLGeometryType.MARKER:f.geometryDPInfo.marker||(f.geometryDPInfo.marker=
[]);k=f.geometryDPInfo.marker;break;case e.WGLGeometryType.TEXT:f.geometryDPInfo.text||(f.geometryDPInfo.text=[]);k=f.geometryDPInfo.text;break;case e.WGLGeometryType.LABEL:f.geometryDPInfo.label||(f.geometryDPInfo.label=[]);k=f.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+h+"'.")}return k};b.prototype.getDPInfoType=function(a){if(this.unified)return"unified";switch(a){case e.WGLGeometryType.FILL:return"fill";case e.WGLGeometryType.LINE:return"line";
case e.WGLGeometryType.MARKER:return"marker";case e.WGLGeometryType.TEXT:return"text";case e.WGLGeometryType.LABEL:return"label";default:w.error("DisplayList: Tried to convert unknown geometryType: "+a)}};return b}();var n=function(){function b(){this.materialInfo=null;this.indexCount=this.indexFrom=0}b.prototype.clone=function(){var a=new b;a.geometryType=this.geometryType;a.materialInfo=new r.default;a.materialInfo.copy(this.materialInfo);a.indexFrom=this.indexFrom;a.indexCount=this.indexCount;
return a};return b}(),t=function(){function b(){this.unified=this.label=this.text=this.marker=this.line=this.fill=null}b.prototype.clone=function(){var a=new b;a.fill=this.fill&&this.fill.map(function(a){return a.clone()});a.line=this.line&&this.line.map(function(a){return a.clone()});a.marker=this.marker&&this.marker.map(function(a){return a.clone()});a.text=this.text&&this.text.map(function(a){return a.clone()});a.label=this.label&&this.label.map(function(a){return a.clone()});a.unified=this.unified&&
this.unified.map(function(a){return a.clone()});return a};return b}(),y=function(){function b(){this.geometryDPInfo=new t}b.prototype.clone=function(){var a=new b;a.zLevel=this.zLevel;a.geometryDPInfo=this.geometryDPInfo.clone();return a};return b}(),x=function(){function b(){this.zLevels=[]}b.prototype.clone=function(){var a=new b;a.symbolLevel=this.symbolLevel;for(var e=0,h=this.zLevels;e<h.length;e++)a.zLevels.push(h[e].clone());return a};return b}();return p});