// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),function(n,p,u,v,w,q,x,r,t){Object.defineProperty(p,"__esModule",{value:!0});n=function(k){function f(){var a=null!==k&&k.apply(this,arguments)||this;a._vertexAttributeLayout={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_id",
count:4,type:5121,offset:4,stride:20,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:20,normalized:!0,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:12,stride:20,normalized:!1,divisor:0},{name:"a_texFontSize",count:4,type:5120,offset:16,stride:20,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};a._vertexAttributeLayoutVV={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:36,normalized:!1,
divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:36,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:36,normalized:!0,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:12,stride:36,normalized:!1,divisor:0},{name:"a_texFontSize",count:4,type:5120,offset:16,stride:36,normalized:!1,divisor:0},{name:"a_vv",count:4,type:5126,offset:20,stride:36,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};
a._glyphsTextureSize=v.vec2f32.create();return a}u(f,k);f.prototype.dispose=function(){};f.prototype.getGeometryType=function(){return w.WGLGeometryType.TEXT};f.prototype.drawGeometry=function(a,e,l,d){d=a.context;var g=a.painter,b=a.rendererInfo,f=a.state,h=l.materialInfo,k=l.indexCount;l=l.indexFrom;var c=h.materialKeyInfo,m=c.vvSizeMinMaxValue||c.vvSizeScaleStops||c.vvSizeFieldStops||c.vvSizeUnitValue||c.vvColor||c.vvRotation||c.vvOpacity;if(a=g.materialManager.getProgram(h.materialKey,a.drawPhase))d.bindProgram(a),
m=this._getVAO(d,e,m,this.getGeometryType()),d.bindVAO(m),h=h.texBindingInfo[0],g.textureManager.bindGlyphsPage(d,h.pageId,h.unit),a.setUniform1i(h.semantic,h.unit),g=g.textureManager.glyphs,this._glyphsTextureSize[0]=g.width/4,this._glyphsTextureSize[1]=g.height/4,a.setUniformMatrix3fv("u_displayMat3",f.displayMat3),a.setUniformMatrix3fv("u_dvsMat3",e.dvsMat3),a.setUniform2fv("u_mosaicSize",this._glyphsTextureSize),a.setUniform1f("u_pixelRatio",1),c.vvSizeMinMaxValue&&a.setUniform4fv("u_vvSizeMinMaxValue",
b.vvSizeMinMaxValue),c.vvSizeScaleStops&&a.setUniform1f("u_vvSizeScaleStopsValue",b.vvSizeScaleStopsValue),c.vvSizeFieldStops&&(a.setUniform1fv("u_vvSizeFieldStopsValues",b.vvSizeFieldStopsValues),a.setUniform1fv("u_vvSizeFieldStopsSizes",b.vvSizeFieldStopsSizes)),c.vvSizeUnitValue&&a.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",b.vvSizeUnitValueToPixelsRatio),c.vvColor&&(a.setUniform1fv("u_vvColorValues",b.vvColorValues),a.setUniform4fv("u_vvColors",b.vvColors)),c.vvOpacity&&(a.setUniform1fv("u_vvOpacityValues",
b.vvOpacityValues),a.setUniform1fv("u_vvOpacities",b.vvOpacities)),c.vvRotation&&a.setUniform1f("u_vvRotationType","geographic"===b.vvMaterialParameters.vvRotationType?0:1),d.drawElements(4,k,5125,4*l),d.bindVAO(null)};f.prototype._getVAO=function(a,e,f,d){if((e=e.getGeometry(d))&&e.vao)return e.vao;d=e.vertexBufferMap[q.C_VBO_GEOMETRY];var g=e.vertexBufferMap[q.C_VBO_VISIBILITY],b=e.indexBuffer;if(!d||!b)return null;e.vao=f?new t(a,r.text.attributes,this._vertexAttributeLayoutVV,{geometry:d,visibility:g},
b):new t(a,r.text.attributes,this._vertexAttributeLayout,{geometry:d,visibility:g},b);return e.vao};return f}(x.default);p.default=n});