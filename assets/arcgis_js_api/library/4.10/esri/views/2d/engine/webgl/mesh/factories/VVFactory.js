// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../../core/Error ../../../../../../core/Logger ../../enums ../../Utils ../../visualVariablesUtils".split(" "),function(m,g,n,r,f,h,p){Object.defineProperty(g,"__esModule",{value:!0});var k=r.getLogger("esri.views.2d.engine.webgl.mesh.VVFactory"),l;(function(b){b[b.NONE=0]="NONE";b[b.MISSING_DATA=1]="MISSING_DATA"})(l=g.VVError||(g.VVError={}));var t=function(){function b(){this._vvMap=new Map}b.prototype.set=function(a,d){this._vvMap.set(a,d)};b.prototype.getValue=
function(a,d,e,c){return this._vvMap.has(a)?this._vvMap.get(a)(d,e,c):0};return b}();m=function(){function b(a,d){this._createVVFunctionMap(a,d)}b.prototype.computeVV=function(a,d,e,c){if(!this._vvMap)return l.NONE;var b=this._vvMap.getValue(f.VVType.SIZE,d,e,c),q=this._vvMap.getValue(f.VVType.COLOR,d,e,c),g=this._vvMap.getValue(f.VVType.OPACITY,d,e,c);d=this._vvMap.getValue(f.VVType.ROTATION,d,e,c);a[f.VVType.SIZE]=this._isErrorVV(b)?1E-30:b;a[f.VVType.COLOR]=this._isErrorVV(q)?1E-30:q;a[f.VVType.OPACITY]=
this._isErrorVV(g)?1E-30:g;a[f.VVType.ROTATION]=this._isErrorVV(d)?1E-30:d;return l.NONE};b.prototype._isErrorVV=function(a){return null===a||isNaN(a)||Infinity===a};b.prototype._createVVFunctionMap=function(a,d){if(a&&a.length)for(var e=0;e<a.length;e++){var c=a[e],b=h.getVVType(c.type);if(c=this._createGetValueFunction(c,d))this._vvMap||(this._vvMap=new t),this._vvMap.set(b,c)}};b.prototype._createGetValueFunction=function(a,b){if(h.getVVType(a.type)===f.VVType.SIZE){var e=p.getTypeOfSizeVisualVariable(a);
return e===f.WGLVVFlag.SIZE_SCALE_STOPS?null:this._createNormalizedFunction(a,b,e===f.WGLVVFlag.SIZE_UNIT_VALUE&&function(b){return p.getVisualVariableSizeValueRepresentationRatio(b,a.valueRepresentation)})}return this._createNormalizedFunction(a,b)};b.prototype._createNormalizedFunction=function(a,b,e){var c=a.field;if(c){if("string"===typeof c){var d=a.normalizationField;return d?function(a){if(a.attributes[c]&&a.attributes[d])return a=a.attributes[c]/a.attributes[d],e?e(a):a}:e?function(a){return e(a.attributes[c])}:
function(a){return a.attributes[c]}}if("function"===typeof c)return k.error(new n("mapview-rendering:unsupported-feature","Function field types are not currently supported. Please use a valueExpression instead")),function(a){};k.error(new n("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof c));return function(a){}}if(a.valueExpression)return h.createArcadeFunction(a.valueExpression,b,e);k.error("Unable to create a normalized function for visual variable: "+
a);return function(a){}};return b}();g.default=m});