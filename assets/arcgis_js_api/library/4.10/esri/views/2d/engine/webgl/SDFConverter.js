// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/promiseUtils","./SDFHelper"],function(m,n,p,q){Object.defineProperty(n,"__esModule",{value:!0});m=function(){function l(b){this.size=b;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=b;this.context=this.canvas.getContext("2d");this._gridOuter=new Float64Array(b*b);this._gridInner=new Float64Array(b*b);this._f=new Float64Array(b);this._d=new Float64Array(b);this._z=new Float64Array(b+1);this._v=new Int16Array(b);b=document.createElementNS("http://www.w3.org/2000/svg",
"svg");b.setAttribute("style","position: absolute;");b.setAttribute("width","0");b.setAttribute("height","0");document.body.appendChild(b);this._svg=b}l.prototype.draw=function(b,h){var a=this;void 0===h&&(h=31);var e=this._createSVGString(b);return p.create(function(b){var c=new Image;c.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(e);c.onload=function(){a.context.clearRect(0,0,a.size,a.size);a.context.drawImage(c,0,0,a.size,a.size);for(var d=a.context.getImageData(0,0,a.size,a.size),
g=new Uint8Array(a.size*a.size*4),f=0;f<a.size*a.size;f++){var e=d.data[4*f+3]/255;a._gridOuter[f]=1===e?0:0===e?1E20:Math.pow(Math.max(0,.5-e),2);a._gridInner[f]=1===e?1E20:0===e?0:Math.pow(Math.max(0,e-.5),2)}a._edt(a._gridOuter,a.size,a.size);a._edt(a._gridInner,a.size,a.size);for(f=0;f<a.size*a.size;f++)q.packFloat(.5-(a._gridOuter[f]-a._gridInner[f])/(2*h),g,4*f);b(g)}})};l.prototype._createSVGString=function(b){var h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",
b);this._svg.appendChild(h);b=h.getBBox();var a=b.width/b.height,e=this.size/2,k,c,d;1<a?(c=k=e/b.width,d=this.size/4,a=e-1/a*e/2):(k=c=e/b.height,d=e-e*a/2,a=this.size/4);h.setAttribute("style","transform: matrix("+k+", 0, 0, "+c+", "+(-b.x*k+d)+", "+(-b.y*c+a)+")");b='\x3csvg style\x3d"fill:red;" height\x3d"'+this.size+'" width\x3d"'+this.size+'" xmlns\x3d"http://www.w3.org/2000/svg"\x3e'+this._svg.innerHTML+"\x3c/svg\x3e";this._svg.removeChild(h);return b};l.prototype._edt=function(b,h,a){for(var e=
this._f,k=this._d,c=this._v,d=this._z,g=0;g<h;g++){for(var f=0;f<a;f++)e[f]=b[f*h+g];this._edt1d(e,k,c,d,a);for(f=0;f<a;f++)b[f*h+g]=k[f]}for(f=0;f<a;f++){for(g=0;g<h;g++)e[g]=b[f*h+g];this._edt1d(e,k,c,d,h);for(g=0;g<h;g++)b[f*h+g]=Math.sqrt(k[g])}};l.prototype._edt1d=function(b,h,a,e,k){a[0]=0;e[0]=-1E20;e[1]=1E20;for(var c=1,d=0;c<k;c++){for(var g=(b[c]+c*c-(b[a[d]]+a[d]*a[d]))/(2*c-2*a[d]);g<=e[d];)d--,g=(b[c]+c*c-(b[a[d]]+a[d]*a[d]))/(2*c-2*a[d]);d++;a[d]=c;e[d]=g;e[d+1]=1E20}for(d=c=0;c<k;c++){for(;e[d+
1]<c;)d++;h[c]=(c-a[d])*(c-a[d])+b[a[d]]}};return l}();n.default=m});