// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),function(m,n,u,v,w,p,x,k,t){Object.defineProperty(n,"__esModule",{value:!0});m=function(l){function d(){var a=null!==l&&l.apply(this,arguments)||this;a._lineVertexAttributeLayout={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:32,normalized:!1,divisor:0},{name:"a_id",
count:4,type:5121,offset:4,stride:32,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:32,normalized:!0,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:12,stride:32,normalized:!1,divisor:0},{name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123,offset:16,stride:32,normalized:!1,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:20,stride:32,normalized:!1,divisor:0},{name:"a_segmentDirection",count:4,type:5120,offset:28,stride:32,normalized:!1,divisor:0}],
visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};a._lineVertexAttributeLayoutVV={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:44,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:44,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:44,normalized:!0,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:12,stride:44,normalized:!1,divisor:0},{name:"a_accumulatedDistanceAndHalfWidth",count:2,
type:5123,offset:16,stride:44,normalized:!1,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:20,stride:44,normalized:!1,divisor:0},{name:"a_segmentDirection",count:4,type:5120,offset:28,stride:44,normalized:!1,divisor:0},{name:"a_vv",count:3,type:5126,offset:32,stride:44,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};a._spritesTextureSize=v.vec2f32.create();return a}u(d,l);d.prototype.dispose=function(){};d.prototype.getGeometryType=
function(){return w.WGLGeometryType.LINE};d.prototype.drawGeometry=function(a,g,e,c){c=a.context;var d=a.painter,f=a.rendererInfo,l=a.requiredLevel,m=a.state,n=e.indexFrom,p=e.indexCount,h=e.materialInfo;e=h.materialKeyInfo;var b=d.materialManager.getProgram(h.materialKey,a.drawPhase);if(b){c.bindProgram(b);var q=this._getVAO(c,g,e.hasVV());c.bindVAO(q);q=1/a.pixelRatio;if(0<h.texBindingInfo.length){var h=h.texBindingInfo[0],r=h.pageId,k=d.textureManager.sprites;this._spritesTextureSize[0]=k.getWidth(r);
this._spritesTextureSize[1]=k.getHeight(r);d.textureManager.bindSpritePage(c,r,h.unit);b.setUniform1i(h.semantic,h.unit);b.setUniform2fv("u_mosaicSize",this._spritesTextureSize)}a=Math.pow(2,l-g.key.level)/a.pixelRatio;b.setUniform1f("u_zoomFactor",a);b.setUniformMatrix3fv("u_dvMat3",m.displayViewMat3);b.setUniformMatrix3fv("u_dvsMat3",g.dvsMat3);b.setUniform1f("u_blur",0+q);b.setUniform1f("u_antialiasing",q);b.setUniform1f("u_zoomFactor",a);e.vvSizeMinMaxValue&&b.setUniform4fv("u_vvSizeMinMaxValue",
f.vvSizeMinMaxValue);e.vvSizeScaleStops&&b.setUniform1f("u_vvSizeScaleStopsValue",f.vvSizeScaleStopsValue);e.vvSizeFieldStops&&(b.setUniform1fv("u_vvSizeFieldStopsValues",f.vvSizeFieldStopsValues),b.setUniform1fv("u_vvSizeFieldStopsSizes",f.vvSizeFieldStopsSizes));e.vvSizeUnitValue&&b.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",f.vvSizeUnitValueToPixelsRatio);e.vvColor&&(b.setUniform1fv("u_vvColorValues",f.vvColorValues),b.setUniform4fv("u_vvColors",f.vvColors));e.vvOpacity&&(b.setUniform1fv("u_vvOpacityValues",
f.vvOpacityValues),b.setUniform1fv("u_vvOpacities",f.vvOpacities));c.setFaceCullingEnabled(!0);c.setFrontFace(2305);c.setCullFace(1029);c.drawElements(4,p,5125,4*n);c.setFaceCullingEnabled(!1);c.bindVAO(null)}};d.prototype._getVAO=function(a,g,e){if(g.lineGeometry.vao)return g.lineGeometry.vao;var c=g.lineGeometry.vertexBufferMap[p.C_VBO_GEOMETRY],d=g.lineGeometry.vertexBufferMap[p.C_VBO_VISIBILITY],f=g.lineGeometry.indexBuffer;if(!c||!f)return null;g.lineGeometry.vao=e?new t(a,k.line.attributes,
this._lineVertexAttributeLayoutVV,{geometry:c,visibility:d},f):new t(a,k.line.attributes,this._lineVertexAttributeLayout,{geometry:c,visibility:d},f);return g.lineGeometry.vao};return d}(x.default);n.default=m});