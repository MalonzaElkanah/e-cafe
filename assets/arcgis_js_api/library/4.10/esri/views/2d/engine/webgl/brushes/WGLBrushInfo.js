// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../definitions ../GeometryUtils ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms ../../../../webgl/BufferObject ../../../../webgl/programUtils ../../../../webgl/Texture ../../../../webgl/VertexArrayObject".split(" "),function(g,h,q,r,t,u,v,k,l,m,n,w,p){Object.defineProperty(h,"__esModule",{value:!0});g=function(g){function b(){var a=g.call(this)||this;a._initialized=
!1;a._color=r.vec4f32.fromValues(1,0,0,1);a._maxWidth=0;return a}q(b,g);b.prototype.dispose=function(){this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null);this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null);this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null);this._canvas=
null};b.prototype.draw=function(a,c){a=a.context;if(c.isReady){this._initialized||this._initialize(a);a.bindVAO(this._outlineVertexArrayObject);a.bindProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3);this._outlineProgram.setUniform1f("u_coord_range",t.TILE_SIZE);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);a.setLineWidth(2);a.drawArrays(3,0,4);a.bindVAO();var f=this._getTexture(a,c);f&&(a.bindVAO(this._tileInfoVertexArrayObject),
a.bindProgram(this._tileInfoProgram),a.bindTexture(f,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform1f("u_coord_ratio",1),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",f.descriptor.width,f.descriptor.height),a.drawArrays(5,0,4),a.bindVAO())}};b.prototype._initialize=function(a){if(this._initialized)return!0;var c=n.createProgram(a,k.background),
f=n.createProgram(a,l.tileInfo),d={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},e=new Int8Array([0,0,1,0,1,1,0,1]),e=m.createVertex(a,35044,e),e=new p(a,k.background.attributes,d,{geometry:e}),b=new Int8Array([0,0,1,0,0,1,1,1]),b=m.createVertex(a,35044,b);a=new p(a,l.tileInfo.attributes,d,{geometry:b});this._outlineProgram=c;this._tileInfoProgram=f;this._outlineVertexArrayObject=e;this._tileInfoVertexArrayObject=a;return this._initialized=!0};b.prototype._getTexture=
function(a,c){if(c.texture)return c.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","256"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var b=c.key.id,d=this._canvas.getContext("2d");d.font="24px sans-serif";d.textAlign="left";d.textBaseline="middle";var e=d.measureText(b),e=Math.pow(2,Math.ceil(u.log2(e.width+2)));e>this._maxWidth&&(this._maxWidth=e);d.clearRect(0,
0,this._maxWidth,32);d.fillStyle="blue";d.fillText(b,0,16);c.texture=new w(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas);return c.texture};return b}(v.default);h.default=g});