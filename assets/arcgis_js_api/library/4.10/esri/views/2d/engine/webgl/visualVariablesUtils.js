// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/screenUtils ./color ./enums ./Utils ../../../3d/layers/support/FastSymbolUpdates".split(" "),function(w,d,p,t,e,l,u){function r(a){return l.isNumber(a.minDataValue)&&l.isNumber(a.maxDataValue)&&null!=a.minSize&&null!=a.maxSize?e.WGLVVFlag.SIZE_MINMAX_VALUE:(a.expression&&"view.scale"===a.expression||a.valueExpression&&"$view.scale"===a.valueExpression)&&Array.isArray(a.stops)?e.WGLVVFlag.SIZE_SCALE_STOPS:(null!=a.field||a.expression&&"view.scale"!==a.expression||
a.valueExpression&&"$view.scale"!==a.valueExpression)&&Array.isArray(a.stops)?e.WGLVVFlag.SIZE_FIELD_STOPS:(null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&null!=a.valueUnit?e.WGLVVFlag.SIZE_UNIT_VALUE:e.WGLVVFlag.NONE}function m(a){return{value:a.value,size:p.toPt(a.size)}}function n(a){return a.map(function(a){return m(a)})}function q(a){return"string"===typeof a||"number"===typeof a?p.toPt(a):{type:"size",expression:a.expression,
stops:n(a.stops)}}function v(a){var c={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(l.isString(a.field))if(a.stops){if(8<a.stops.length)return null;var b=a.stops;for(a=0;8>a;++a){var e=b[Math.min(a,b.length-1)];c.values[a]=e.value;c.opacities[a]=e.opacity}}else return null;else if(a.stops&&0<=a.stops.length)for(b=a.stops&&0<=a.stops.length&&a.stops[0].opacity,a=0;8>a;a++)c.values[a]=Infinity,c.opacities[a]=b;else return null;return c}Object.defineProperty(d,"__esModule",{value:!0});d.getTypeOfSizeVisualVariable=
r;d.getVisualVariableSizeValueRepresentationRatio=function(a,c){if(!a||!c)return a;switch(c){case "radius":case "distance":return 2*a;case "area":return Math.sqrt(a)}return a};d.stopToSizeStop=m;d.normalizeSizeStops=n;d.normalizeSizeElement=q;d.getVisualVariablesFields=function(a){var c=a&&0<a.length?{}:null;c&&a.forEach(function(a){var b=a.type;a.field&&(c[b]=a.field)});return c};d.convertVisualVariables=function(a){var c=a&&0<a.length?{}:null,b=c?{}:null;if(!c)return{vvFields:c,vvRanges:b};for(var d=
0;d<a.length;d++){var f=a[d],h=f.type;f.field&&(c[h]=f.field);if("size"===h){b.size||(b.size={});var g=f;switch(r(g)){case e.WGLVVFlag.SIZE_MINMAX_VALUE:b.size.minMaxValue={minDataValue:g.minDataValue,maxDataValue:g.maxDataValue,minSize:q(g.minSize),maxSize:q(g.maxSize)};break;case e.WGLVVFlag.SIZE_SCALE_STOPS:b.size.scaleStops={stops:n(g.stops)};break;case e.WGLVVFlag.SIZE_FIELD_STOPS:for(var f=[],h=[],g=n(g.stops),l=g.length,k=0;6>k;k++){var m=g[Math.min(k,l-1)];f.push(m.value);h.push(p.pt2px(m.size))}b.size.fieldStops=
{values:f,sizes:h};break;case e.WGLVVFlag.SIZE_UNIT_VALUE:b.size.unitValue={unit:g.valueUnit,valueRepresentation:g.valueRepresentation}}}else if("color"===h)for(f=u.convertVisualVariables([f],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null}),b.color=f.color,k=0;32>k;k+=4)t.premultiplyAlpha(b.color.colors,k,!0);else"opacity"===h?b.opacity=v(f):"rotation"===h&&(b.rotation={type:f.rotationType})}return{vvFields:c,vvRanges:b}}});