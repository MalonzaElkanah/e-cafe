// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define(["require","exports","./definitions","./Geometry","./GeometryUtils"],function(u,v,z,l,w){Object.defineProperty(v,"__esModule",{value:!0});var x=function(){return function(c,a,b){this.ratio=c;this.x=a;this.y=b}}();u=function(){function c(a,b,e,f,k){void 0===f&&(f=8);void 0===k&&(k=8);this.lines=[];this.starts=[];this.pixelRatio=f;this.pixelMargin=k;this.tileSize=z.TILE_SIZE*f;this.dz=a;this.yPos=b;this.xPos=e}c.prototype.setExtent=function(a){this.finalRatio=this.tileSize/a*(1<<this.dz);var b=
this.pixelRatio*this.pixelMargin,b=b/this.finalRatio;a>>=this.dz;b>a&&(b=a);this.margin=b;this.xmin=a*this.xPos-b;this.ymin=a*this.yPos-b;this.xmax=this.xmin+a+2*b;this.ymax=this.ymin+a+2*b};c.prototype.reset=function(a){this.type=a;this.lines=[];this.starts=[];this.line=null;this.start=0};c.prototype.moveTo=function(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);this._prevPt=new l.Point(a,b);this._firstPt=new l.Point(a,b);this._dist=0};c.prototype.lineTo=function(a,
b){var e=this._isIn(a,b),f=new l.Point(a,b),k=l.Point.distance(this._prevPt,f),g,d,h;if(e)this._prevIsIn?this._lineTo(a,b,!0):(g=this._prevPt,d=f,a=this._intersect(d,g),this.start=this._dist+k*(1-this._r),this._lineTo(a.x,a.y,!0),this._lineTo(d.x,d.y,!0));else if(this._prevIsIn)d=this._prevPt,g=f,a=this._intersect(d,g),this._lineTo(a.x,a.y,!0),this._lineTo(g.x,g.y,!1);else{var c=this._prevPt;if(!(c.x<=this.xmin&&f.x<=this.xmin||c.x>=this.xmax&&f.x>=this.xmax||c.y<=this.ymin&&f.y<=this.ymin||c.y>=
this.ymax&&f.y>=this.ymax)){a=[];if(c.x<this.xmin&&f.x>this.xmin||c.x>this.xmin&&f.x<this.xmin)b=(this.xmin-c.x)/(f.x-c.x),h=c.y+b*(f.y-c.y),h<=this.ymin?d=!1:h>=this.ymax?d=!0:a.push(new x(b,this.xmin,h));if(c.x<this.xmax&&f.x>this.xmax||c.x>this.xmax&&f.x<this.xmax)b=(this.xmax-c.x)/(f.x-c.x),h=c.y+b*(f.y-c.y),h<=this.ymin?d=!1:h>=this.ymax?d=!0:a.push(new x(b,this.xmax,h));if(c.y<this.ymin&&f.y>this.ymin||c.y>this.ymin&&f.y<this.ymin)b=(this.ymin-c.y)/(f.y-c.y),h=c.x+b*(f.x-c.x),h<=this.xmin?g=
!1:h>=this.xmax?g=!0:a.push(new x(b,h,this.ymin));if(c.y<this.ymax&&f.y>this.ymax||c.y>this.ymax&&f.y<this.ymax)b=(this.ymax-c.y)/(f.y-c.y),h=c.x+b*(f.x-c.x),h<=this.xmin?g=!1:h>=this.xmax?g=!0:a.push(new x(b,h,this.ymax));if(0===a.length)g?d?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):d?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<a.length&&a[0].ratio>a[1].ratio)this.start=this._dist+k*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),
this._lineTo(a[0].x,a[0].y,!0);else for(this.start=this._dist+k*a[0].ratio,g=0;g<a.length;g++)this._lineTo(a[g].x,a[g].y,!0)}this._lineTo(f.x,f.y,!1)}this._dist+=k;this._prevIsIn=e;this._prevPt=f};c.prototype.close=function(){if(2<this.line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this.line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;else break}};c.prototype.result=
function(a){void 0===a&&(a=!0);this._pushLine();if(0===this.lines.length)return null;3===this.type&&a&&y.simplify(this.tileSize,this.margin*this.finalRatio,this.lines);return this.lines};c.prototype.resultWithStarts=function(){if(2!==this.type)throw Error("Only valid for lines");this._pushLine();var a=this.lines,b=a.length;if(0===b)return null;for(var e=[],f=0;f<b;f++)e.push({line:a[f],start:this.starts[f]||0});return e};c.prototype._isIn=function(a,b){return a>=this.xmin&&a<=this.xmax&&b>=this.ymin&&
b<=this.ymax};c.prototype._intersect=function(a,b){var e,f,c;if(b.x>=this.xmin&&b.x<=this.xmax)f=b.y<=this.ymin?this.ymin:this.ymax,c=(f-a.y)/(b.y-a.y),e=a.x+c*(b.x-a.x);else if(b.y>=this.ymin&&b.y<=this.ymax)e=b.x<=this.xmin?this.xmin:this.xmax,c=(e-a.x)/(b.x-a.x),f=a.y+c*(b.y-a.y);else{f=b.y<=this.ymin?this.ymin:this.ymax;e=b.x<=this.xmin?this.xmin:this.xmax;var g=(e-a.x)/(b.x-a.x),d=(f-a.y)/(b.y-a.y);g<d?(c=g,f=a.y+g*(b.y-a.y)):(c=d,e=a.x+d*(b.x-a.x))}this._r=c;return new l.Point(e,f)};c.prototype._pushLine=
function(){this.line&&(1===this.type?0<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?1<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&3<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)));this.line=[];this.start=0};c.prototype._moveTo=function(a,b,e){3!==this.type?e&&(a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new l.Point(a,
b))):(e||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new l.Point(a,b)),this._is_v=this._is_h=!1)};c.prototype._lineTo=function(a,b,e){if(3!==this.type)if(e){a=Math.round((a-(this.xmin+this.margin))*this.finalRatio);b=Math.round((b-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&(e=this.line[this.line.length-
1],e.equals(a,b)))return;this.line.push(new l.Point(a,b))}else this.line&&0<this.line.length&&this._pushLine();else if(e||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line&&0<this.line.length){e=this.line[this.line.length-1];var c=e.x===a,k=e.y===b;c&&k||(this._is_h&&c?(e.x=a,e.y=b,e=this.line[this.line.length-2],
e.x===a&&e.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(e=this.line[this.line.length-2],this._is_h=e.x===a,this._is_v=e.y===b)):(this._is_h=e.x===a,this._is_v=e.y===b)):this._is_v&&k?(e.x=a,e.y=b,e=this.line[this.line.length-2],e.x===a&&e.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(e=this.line[this.line.length-2],this._is_h=e.x===a,this._is_v=e.y===b)):(this._is_h=e.x===a,this._is_v=e.y===b)):(this.line.push(new l.Point(a,b)),this._is_h=c,this._is_v=
k))}else this.line.push(new l.Point(a,b))};return c}();v.TileClipper=u;u=function(){function c(){}c.prototype.setExtent=function(a){this._ratio=4096===a?1:4096/a};c.prototype.reset=function(a){this.type=a;this.lines=[];this.line=null};c.prototype.moveTo=function(a,b){this.line&&this.lines.push(this.line);this.line=[];var e=this._ratio;this.line.push(new l.Point(Math.round(a*e),Math.round(b*e)))};c.prototype.lineTo=function(a,b){var e=this._ratio;this.line.push(new l.Point(Math.round(a*e),Math.round(b*
e)))};c.prototype.close=function(){var a=this.line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};c.prototype.result=function(){this.line&&this.lines.push(this.line);if(0===this.lines.length)return null;3===this.type&&1!==this._ratio&&y.simplify(4096,64,this.lines);return this.lines};return c}();v.SimpleBuilder=u;var y=function(){function c(){}c.simplify=function(a,b,e){if(e){var f=-b,k=a+b,g=-b,d=a+b;a=[];b=[];for(var h=e.length,r=0;r<h;++r){var l=e[r];if(l&&!(2>l.length))for(var n=l[0],m=void 0,
t=l.length,p=1;p<t;++p)m=l[p],n.x===m.x&&(n.x<=f&&(n.y>m.y?(a.push(r),a.push(p),a.push(0),a.push(-1)):(b.push(r),b.push(p),b.push(0),b.push(-1))),n.x>=k&&(n.y<m.y?(a.push(r),a.push(p),a.push(1),a.push(-1)):(b.push(r),b.push(p),b.push(1),b.push(-1)))),n.y===m.y&&(n.y<=g&&(n.x<m.x?(a.push(r),a.push(p),a.push(2),a.push(-1)):(b.push(r),b.push(p),b.push(2),b.push(-1))),n.y>=d&&(n.x>m.x?(a.push(r),a.push(p),a.push(3),a.push(-1)):(b.push(r),b.push(p),b.push(3),b.push(-1)))),n=m}0!==a.length&&0!==b.length&&
(c.fillParent(e,b,a),c.fillParent(e,a,b),f=[],c.calcDeltas(f,b,a),c.calcDeltas(f,a,b),c.addDeltas(f,e))}};c.fillParent=function(a,b,e){for(var c=e.length,k=b.length,g=0;g<k;g+=4){for(var d=b[g],h=b[g+1],l=b[g+2],u=a[d][h-1],d=a[d][h],h=8092,n=-1,m=0;m<c;m+=4)if(e[m+2]===l){var t=e[m],p=e[m+1],q=a[t][p-1],t=a[t][p];switch(l){case 0:case 1:w.between(u.y,q.y,t.y)&&w.between(d.y,q.y,t.y)&&(q=Math.abs(t.y-q.y),q<h&&(h=q,n=m));break;case 2:case 3:w.between(u.x,q.x,t.x)&&w.between(d.x,q.x,t.x)&&(q=Math.abs(t.x-
q.x),q<h&&(h=q,n=m))}}b[g+3]=n}};c.calcDeltas=function(a,b,e){for(var f=b.length,k=0;k<f;k+=4){var g=c.calcDelta(k,b,e,[]);a.push(b[k]);a.push(b[k+1]);a.push(b[k+2]);a.push(g)}};c.calcDelta=function(a,b,e,f){a=b[a+3];if(-1===a)return 0;var k=f.length;if(1<k&&f[k-2]===a)return 0;f.push(a);return c.calcDelta(a,e,b,f)+1};c.addDeltas=function(a,b){for(var e=a.length,c=0,k=0;k<e;k+=4){var g=a[k+3];g>c&&(c=g)}for(k=0;k<e;k+=4){var d=b[a[k]],h=a[k+1],g=c-a[k+3];switch(a[k+2]){case 0:d[h-1].x-=g;d[h].x-=
g;1===h&&(d[d.length-1].x-=g);h===d.length-1&&(d[0].x-=g);break;case 1:d[h-1].x+=g;d[h].x+=g;1===h&&(d[d.length-1].x+=g);h===d.length-1&&(d[0].x+=g);break;case 2:d[h-1].y-=g;d[h].y-=g;1===h&&(d[d.length-1].y-=g);h===d.length-1&&(d[0].y-=g);break;case 3:d[h-1].y+=g,d[h].y+=g,1===h&&(d[d.length-1].y+=g),h===d.length-1&&(d[0].y+=g)}}};return c}();u=function(){function c(){this.linesIn=[];this.linesOut=[]}c.prototype.cut=function(a,b){this.xCut=b;var c;if(a.rings)this.closed=!0,c=a.rings,this.minPts=
4;else if(a.paths)this.closed=!1,c=a.paths,this.minPts=2;else return null;for(var f=0;f<c.length;f++)if((b=c[f])&&!(b.length<this.minPts)){for(var k=!0,g=0;g<b.length;g++){var d=b[g];k?(this.moveTo(d),k=!1):this.lineTo(d)}this.closed&&this.close()}this._pushLineIn();this._pushLineOut();c=[];d=0;for(f=this.linesIn;d<f.length;d++)(b=f[d])&&b.length>=this.minPts&&c.push(b);f=-2*this.xCut;k=0;for(g=this.linesOut;k<g.length;k++)if((b=g[k])&&b.length>=this.minPts){for(var h=0,l=b;h<l.length;h++)d=l[h],
d[0]+=f;c.push(b)}this.closed?a.rings=c:a.paths=c;return a};c.prototype.moveTo=function(a){this._pushLineIn();this._pushLineOut();this._prevSide=this._side(a[0]);this._moveTo(a[0],a[1],this._prevSide);this._firstPt=this._prevPt=a};c.prototype.lineTo=function(a){var b=this._side(a[0]);if(-1===b*this._prevSide){var c=this._intersect(this._prevPt,a);this._lineTo(this.xCut,c,0);this._prevSide=0}this._lineTo(a[0],a[1],b);this._prevSide=b;this._prevPt=a};c.prototype.close=function(){var a=this._firstPt,
b=this._prevPt;a[0]===b[0]&&a[1]===b[1]||this.lineTo(a);this._checkClosingPt(this.lineIn);this._checkClosingPt(this.lineOut)};c.prototype._moveTo=function(a,b,c){this.closed?(this.lineIn.push([0>=c?a:this.xCut,b]),this.lineOut.push([0<=c?a:this.xCut,b])):(0>=c&&this.lineIn.push([a,b]),0<=c&&this.lineOut.push([a,b]))};c.prototype._lineTo=function(a,b,c){this.closed?(this._addPolyVertex(this.lineIn,0>=c?a:this.xCut,b),this._addPolyVertex(this.lineOut,0<=c?a:this.xCut,b)):0>c?(0===this._prevSide&&this._pushLineOut(),
this.lineIn.push([a,b])):0<c?(0===this._prevSide&&this._pushLineIn(),this.lineOut.push([a,b])):0>this._prevSide?(this.lineIn.push([a,b]),this.lineOut.push([a,b])):0<this._prevSide&&(this.lineOut.push([a,b]),this.lineIn.push([a,b]))};c.prototype._addPolyVertex=function(a,b,c){var e=a.length;1<e&&a[e-1][0]===b&&a[e-2][0]===b?a[e-1][1]=c:a.push([b,c])};c.prototype._checkClosingPt=function(a){var b=a.length;3<b&&a[0][0]===this.xCut&&a[b-2][0]===this.xCut&&a[1][0]===this.xCut&&(a[0][1]=a[b-2][1],a.pop())};
c.prototype._side=function(a){return a<this.xCut?-1:a>this.xCut?1:0};c.prototype._intersect=function(a,b){return a[1]+(this.xCut-a[0])/(b[0]-a[0])*(b[1]-a[1])};c.prototype._pushLineIn=function(){this.lineIn&&this.lineIn.length>=this.minPts&&this.linesIn.push(this.lineIn);this.lineIn=[]};c.prototype._pushLineOut=function(){this.lineOut&&this.lineOut.length>=this.minPts&&this.linesOut.push(this.lineOut);this.lineOut=[]};return c}();v.CutVertical=u});