// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/features/controllers":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","../../../../core/Error","../../../../core/promiseUtils"],function(m,f,g,d,e){Object.defineProperty(f,"__esModule",{value:!0});f.getControllerConfiguration=function(b){var h=b.source;return"stream"===b.type?e.resolve().then(function(){var a;if(a=b.filter){var d={};a.geometry&&(d.geometry=a.geometry.toJSON());a.where&&(d.where=a.where);a=d}else a=null;return{type:"stream",
filter:a,purgeOptions:b.purgeOptions}}):b.capabilities.operations.supportsQuery?h&&"openPorts"in h?e.resolve().then(function(){return{type:"memory",processing:b.processing&&b.processing.toWorker()||null}}):e.resolve({type:"on-demand",gdbVersion:b.gdbVersion,historicMoment:b.historicMoment&&b.historicMoment.getTime(),processing:b.processing&&b.processing.toWorker()||null}):e.reject(new d("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",
{layer:b}))};f.createController=function(b,d){return("memory"===b?e.create(function(a){return m(["./controllers/MemoryController"],a)}):"stream"===b?e.create(function(a){return m(["./controllers/StreamController"],a)}):e.create(function(a){return m(["./controllers/OnDemandController"],a)})).then(function(a){return a.default}).then(function(a){return new a(g({},d.serviceAndViewInfo,{tileStore:d.tileStore,remoteClient:d.remoteClient}))})}})},"esri/views/2d/layers/features/tileRenderers":function(){define(["require",
"exports","../../../../core/nextTick","../../../../core/promiseUtils"],function(m,f,g,d){Object.defineProperty(f,"__esModule",{value:!0});f.createOrReuseTileRenderer=function(e,b,f){if(e&&e.supportsRenderer(b))return d.create(function(a){return g(function(){return a(e)})});if(!b)return d.resolve(null);switch(b.type){case "class-breaks":case "simple":case "unique-value":return d.create(function(a){g(function(){return m(["./tileRenderers/SymbolTileRenderer"],a)})}).then(function(a){return a.default}).then(function(a){return new a(f)});
case "heatmap":return d.create(function(a){g(function(){return m(["./tileRenderers/HeatmapTileRenderer"],a)})}).then(function(a){return a.default}).then(function(a){return new a(f)})}return d.resolve(null)}})},"esri/views/2d/layers/support/FeatureLayerProxy":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/Accessor ../../../../core/Promise ../../../../core/promiseUtils ../../../../core/requireUtils ../../../../core/workers ../../../../core/accessorSupport/decorators ./util module".split(" "),
function(m,f,g,d,e,b,h,a,q,t,n,r,p){Object.defineProperty(f,"__esModule",{value:!0});e=function(b){function e(c){c=b.call(this,c)||this;c.tileRenderer=null;return c}g(e,b);e.prototype.initialize=function(){var c=this;this.addResolvingPromise(t.open(q.getAbsMid("../features/Pipeline",m,p),{client:this.client,strategy:"dedicated"}).then(function(a){c._connection=a;return c._getStartupOptions(c.layer,c.featuresTiling)}).then(function(a){return Array.isArray(a.service.source)?c._connection.invoke("startup",
a,{transferList:a.service.source}):c._connection.invoke("startup",a)}))};e.prototype.destroy=function(){var c=this;this._connection&&this._connection.invoke("destroy").then(function(){return c._connection.close()})};e.prototype.configure=function(c){return this._connection.invoke("configure",c)};e.prototype.refresh=function(){return this._connection.invoke("controller.refresh")};e.prototype.redraw=function(){return this._connection.invoke("controller.redraw")};e.prototype.setViewState=function(c){return this._connection.invoke("setViewState",
c.toJSON())};e.prototype.queryFeatures=function(c){return this._connection.invoke("controller.queryFeatures",c.toJSON())};e.prototype.queryObjectIds=function(c){return this._connection.invoke("controller.queryObjectIds",c.toJSON())};e.prototype.queryFeatureCount=function(c){return this._connection.invoke("controller.queryFeatureCount",c.toJSON())};e.prototype.queryExtent=function(c){return this._connection.invoke("controller.queryExtent",c.toJSON())};e.prototype.queryLatestObservations=function(c){return this._connection.invoke("controller.queryLatestObservations",
c.toJSON())};e.prototype.onEdits=function(c){return this._connection.invoke("controller.onEdits",{addedFeatures:c.addedFeatures,deletedFeatures:c.deletedFeatures,updatedFeatures:c.updatedFeatures})};e.prototype.enableEvent=function(c,a){return this._connection.invoke("controller.enableEvent",{name:c,value:a})};e.prototype._getStartupOptions=function(c,e){var b=c.capabilities,d=c.objectIdField,k=c.source,f=c.fields.map(function(a){return a.toJSON()}),u=c.fullExtent&&c.fullExtent.toJSON(),g=r.toJSONGeometryType(c.geometryType);
if(k&&"openPorts"in k)return k.openPorts().then(function(a){return{service:{capabilities:b,fields:f,fullExtent:u,geometryType:g,objectIdField:d,source:a},tileInfo:e.tileInfo.toJSON()}});if("stream"===c.type){var k=c.source,h=k.relatedLayerDefinition,l=k.archivedLayerDefinition,h=h&&{capabilities:h.capabilities,fields:h.fields,fullExtent:h.extent,geometryType:h.geometryType,objectIdField:h.objectIdField,source:k.layerDefinition.relatedFeatures.featuresUrl,joinField:k.layerDefinition.relatedFeatures.joinField}||
null,l=l&&{capabilities:l.capabilities,fields:l.fields,fullExtent:l.extent,geometryType:l.geometryType,objectIdField:l.objectIdField,source:k.layerDefinition.keepLatestArchive.featuresUrl,maximumFeatureAge:k.layerDefinition.keepLatestArchive.maximumFeatureAge,updateInterval:k.layerDefinition.keepLatestArchive.updateInterval}||null;return a.resolve({service:{capabilities:c.capabilities,fields:c.fields.map(function(a){return a.toJSON()}),fullExtent:c.fullExtent&&c.fullExtent.toJSON()||null,geometryType:r.toJSONGeometryType(c.geometryType),
objectIdField:c.objectIdField||"__OBJECTID",source:c.parsedUrl.path,buddyLayers:{relatedFeatures:h,keepLatestArchive:l},streamUrls:k.layerDefinition.streamUrls,timeInfo:k.layerDefinition.timeInfo,content:c.parsedUrl.query},tileInfo:e.tileInfo.toJSON()})}return a.resolve({service:{capabilities:b,fields:f,fullExtent:u,geometryType:g,objectIdField:d,source:c.dynamicDataSource?c.parsedUrl:c.url+"/"+c.layerId},tileInfo:e.tileInfo.toJSON()})};d([n.property({constructOnly:!0})],e.prototype,"client",void 0);
d([n.property({constructOnly:!0})],e.prototype,"layer",void 0);d([n.property({constructOnly:!0})],e.prototype,"featuresTiling",void 0);d([n.property()],e.prototype,"tileRenderer",void 0);return e=d([n.subclass()],e)}(n.declared(b,h));f.default=e})},"esri/views/2d/layers/support/util":function(){define(["require","exports","../../../../core/kebabDictionary"],function(m,f,g){Object.defineProperty(f,"__esModule",{value:!0});var d=g({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",
esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});f.toJSONGeometryType=function(e){return d.toJSON(e)}})},"esri/views/layers/FeatureLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/arrayUtils ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/accessorSupport/decorators ../../renderers/support/clickToleranceUtils ../../support/arcadeUtils ../../support/graphicUtils ./RefreshableLayerView ./support/popupUtils".split(" "),
function(m,f,g,d,e,b,h,a,q,t,n,r,p,v){var w=h.getLogger("esri.views.layers.FeatureLayerView");return function(c){function f(a){a=c.call(this,a)||this;a.layer=null;return a}g(f,c);Object.defineProperty(f.prototype,"maximumNumberOfFeatures",{get:function(){return 0},set:function(a){w.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!1},
enumerable:!0,configurable:!0});f.prototype.highlight=function(a,c){return this.inherited(arguments)};f.prototype.queryFeatures=function(a){return this.inherited(arguments)};f.prototype.queryObjectIds=function(a){return this.inherited(arguments)};f.prototype.queryFeatureCount=function(a){return this.inherited(arguments)};f.prototype.queryExtent=function(a){return this.inherited(arguments)};f.prototype.fetchPopupFeatures=function(c,b){var d=this._validateFetchPopupFeatures();if(d)return a.reject(d);
d=this._fetchClientPopupFeatures(b);if(!c)return d;c=this._fetchServicePopupFeatures(c,b);return a.eachAlwaysValues([d,c]).then(e.concatAll)};f.prototype._validateFetchPopupFeatures=function(){var a=this.layer,c=a.popupTemplate;if(!a.popupEnabled)return new b("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:a});if(!c)return new b("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:a})};f.prototype._fetchClientPopupFeatures=function(c){if(!c||0===
c.length)return a.resolve([]);for(var d=[],e=[],b=this.layer,f=n.hasGeometryOperations(b.popupTemplate),h=this._createPopupQuery(),g=0;g<c.length;g++){var l=c[g];f||!r.hasRequiredFields(l,h.outFields)?e.push(l):d.push(l)}if(0===e.length)return a.resolve(d);h.objectIds=e.map(function(a){return a.attributes[b.objectIdField]});return b.queryFeatures(h).then(function(a){return d.concat(a.features)}).catch(function(){return e})};f.prototype._fetchServicePopupFeatures=function(a,c){var d=this._createPopupQuery(),
e=this.layer,b=t.calculateTolerance(e.renderer);d.geometry=this.createFetchPopupFeaturesQueryGeometry(a,b);var f=new Set,h=e.objectIdField;for(a=0;a<c.length;a++)f.add(c[a].attributes[h]);return e.queryFeatures(d).then(function(a){return a.features.filter(function(a){return!f.has(a.attributes[h])})})};f.prototype._createPopupQuery=function(){var a=this.layer.createQuery();a.returnGeometry=!0;a.returnZ=!0;a.returnM=!0;a.outFields=v.getRequiredFields(this.layer);a.outSpatialReference=this.getViewSpatialReference();
return a};d([q.property()],f.prototype,"layer",void 0);d([q.property({type:Number})],f.prototype,"maximumNumberOfFeatures",null);d([q.property({readOnly:!0,type:Boolean})],f.prototype,"maximumNumberOfFeaturesExceeded",null);return f=d([q.subclass("esri.views.layers.FeatureLayerView")],f)}(q.declared(p))})},"esri/support/graphicUtils":function(){define(["require","exports"],function(m,f){Object.defineProperty(f,"__esModule",{value:!0});f.hasRequiredFields=function(d,e){if(!e)return!0;var b=d.attributes||
g;return!e.some(function(e){return!(e in b)})};var g={}})},"esri/views/layers/support/popupUtils":function(){define(["require","exports"],function(m,f){function g(d,e){if(!d.fields)return!1;var b=e.toLowerCase();return d.fields.some(function(e){return e.name.toLowerCase()===b})}Object.defineProperty(f,"__esModule",{value:!0});f.getRequiredFields=function(d){var e=d.popupTemplate,b=e.requiredFields,e=e.lastEditInfoEnabled,f=d.objectIdField,a=d.editFieldsInfo;if(b&&1===b.length&&"*"===b[0])return b;
b=b&&b.filter(function(a){return g(d,a)});a&&e&&(a.creatorField&&b.push(a.creatorField),a.creationDateField&&b.push(a.creationDateField),a.editorField&&b.push(a.editorField),a.editDateField&&b.push(a.editDateField));b&&f&&g(d,f)&&-1===b.indexOf(f)&&b.push(f);return b}})},"*noref":1}});
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/paramHelper ../../../core/tsSupport/assignHelper ../../../geometry ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ../../../tasks/support/FeatureSet ../../../tasks/support/Query ../engine/Container ./LayerView2D ./features/controllers ./features/tileRenderers ./support/FeatureLayerProxy ./support/popupUtils2D ../tiling/TileStrategy ../../layers/FeatureLayerView".split(" "),function(m,
f,g,d,e,b,h,a,q,t,n,r,p,v,w,c,u,x,y,k,z,A,B,C){var l=v.ensureType(c);return function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;a._pipelineIsUpdating=!1;a.container=new u.Container;return a}g(b,e);b.prototype.destroy=function(){this._proxy.destroy()};b.prototype.initialize=function(){this._proxy=this._createProxy();this.addResolvingPromise(n.all([y.getControllerConfiguration(this.layer),this._proxy.when()]).then(function(a){return a[1].configure({controller:a[0]})}))};Object.defineProperty(b.prototype,
"labelsVisible",{get:function(){return!this.suspended&&this.layer.labelingInfo&&this.layer.labelsVisible},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"numFeatures",{get:function(){var a=0;this.attached&&this._tileStrategy.tiles.forEach(function(b){a+=b.iconDisplayRecords?b.iconDisplayRecords.length:0});return a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderingConfigHash",{get:function(){if(!this.layer)return null;var a=this.layer,b=a.renderer,c=a.labelingInfo;
return JSON.stringify({definitionExpression:a.definitionExpression,historicMoment:a.historicMoment,outFields:a.outFields.slice().sort(),renderer:b,labelingInfo:c})},enumerable:!0,configurable:!0});b.prototype.highlight=function(b,c){var e=this,d;b instanceof a?d=[b.getAttribute(this.layer.objectIdField||"__OBJECTID")]:"number"===typeof b?d=[b]:q.isCollection(b)?d=b.map(function(a){return a&&a.getAttribute(e.layer.objectIdField)}).toArray():Array.isArray(b)&&0<b.length&&(d="number"===typeof b[0]?b:
b.map(function(a){return a&&a.getAttribute(e.layer.objectIdField)}));return(d=d.filter(function(a){return null!=a}))&&d.length&&"highlight"in this.tileRenderer?this.tileRenderer.highlight(d):{remove:function(){}}};b.prototype.hitTest=function(b,e){var d=this;return this.suspended||!this.tileRenderer?n.resolve(null):this.tileRenderer.hitTest(b,e).then(function(b){return 0===b.length?null:d._proxy.queryFeatures(new c({objectIds:b,outSpatialReference:d.view.spatialReference,returnGeometry:!0})).then(function(b){if(!b.features[0])return null;
b=a.fromJSON(b.features[0]);b.layer=d.layer;b.sourceLayer=d.layer;b.geometry&&(b.geometry.spatialReference=d.view.spatialReference);return b})})};b.prototype.queryFeatures=function(a){var b=this;return this.queryFeaturesJSON(a).then(function(a){a=w.fromJSON(a);a.features.forEach(function(a){a.layer=b.layer;a.sourceLayer=b.layer});return a})};b.prototype.queryFeaturesJSON=function(a){return this._proxy.queryFeatures(this._cleanUpQuery(a))};b.prototype.queryObjectIds=function(a){return this._proxy.queryObjectIds(this._cleanUpQuery(a))};
b.prototype.queryFeatureCount=function(a){return this._proxy.queryFeatureCount(this._cleanUpQuery(a))};b.prototype.queryExtent=function(a){return this._proxy.queryExtent(this._cleanUpQuery(a)).then(function(a){return{count:a.count,extent:h.Extent.fromJSON(a.extent)}})};b.prototype.update=function(a){this.attached&&this._tileStrategy&&this.tileRenderer&&(this._tileStrategy.update(a)||this.requestUpdate(),this._proxy.setViewState(a.state),this.notifyChange("numFeatures"),this.notifyChange("updating"))};
b.prototype.attach=function(){var a=this;this._tileStrategy=new B({cachePolicy:"purge",acquireTile:function(b){return a._acquireTile(b)},releaseTile:function(b){return a._releaseTile(b)},tileInfoView:this.view.featuresTilingScheme,buffer:0});this.handles.add([r.init(this,"layer.processing.version",function(b){a._proxy.redraw()}),this.layer.on("edits",function(b){a._proxy.onEdits(b)}),r.init(this,"renderingConfigHash",function(){return a._renderingConfigHashChanged()}),this.view.watch("highlightOptions.color,highlightOptions.fillOpacity,highlightOptions.haloOpacity",
function(){a.container.requestRender()})])};b.prototype.detach=function(){this.container.removeAllChildren();this.handles.remove(this);this._tileRendererPromise=null;this._pipelineIsUpdating=!1;this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null);this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null)};b.prototype.moveStart=function(){this.requestUpdate()};b.prototype.viewChange=function(){this.requestUpdate()};b.prototype.moveEnd=function(){this.requestUpdate()};
b.prototype.getViewSpatialReference=function(){return this.view.spatialReference};b.prototype.createFetchPopupFeaturesQueryGeometry=function(a,b){return A.createQueryGeometry(a,b,this.view)};b.prototype.doRefresh=function(){this._proxy.refresh()};b.prototype.isUpdating=function(){return null!=this.layer.renderer&&(null==this.tileRenderer||this._pipelineIsUpdating||this.tileRenderer.updating)};b.prototype._createClientOptions=function(){var a=this;return{executeProcessing:function(b){var c=a.layer.processing;
return c?(b=c.process(b.featureSet,c.options))?b:n.reject(new t("FeatureLayer","invalid processing.process() method, returns nothing")):b.featureSet},setUpdating:function(b){a._pipelineIsUpdating=b;a.notifyChange("updating")}}};b.prototype._cleanUpQuery=function(a){a=a?l(a):new c;a.outSpatialReference||(a.outSpatialReference=this.view.spatialReference);return a};b.prototype._createProxy=function(){return new z.default({layer:this.layer,featuresTiling:this.view.featuresTilingScheme,client:this._createClientOptions()})};
b.prototype._acquireTile=function(a){var b=this;a=this.tileRenderer.acquireTile(a);a.once("attach",function(){b.requestUpdate()});return a};b.prototype._releaseTile=function(a){this.tileRenderer.releaseTile(a)};b.prototype._renderingConfigHashChanged=function(){var a=this,b=this._tileRendererPromise=k.createOrReuseTileRenderer(this.tileRenderer,this.layer.renderer,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer,highlightOptions:this.view.highlightOptions}).then(function(c){a._tileRendererPromise===
b&&(a._tileRendererPromise=null,a.tileRenderer!==c&&(a._tileStrategy.clear(),a.tileRenderer&&(a.tileRenderer.uninstall(a.container),a.tileRenderer.destroy()),(a.tileRenderer=a._proxy.client.tileRenderer=c)&&c.install(a.container),a.requestUpdate()),c&&(c=c.getProcessorConfiguration(),a.tileRenderer.wouldClear(c)?(a.tileRenderer.clear(),a.tileRenderer.applyConfiguration(c),a._proxy.configure({processor:c})):a.tileRenderer.needsProcessorReconfiguration(c)?a._proxy.configure({processor:c}):a.tileRenderer.applyConfiguration(c),
a.requestUpdate()))},function(){return a._tileRendererPromise=null})};d([p.property()],b.prototype,"_pipelineIsUpdating",void 0);d([p.property({dependsOn:["suspended","layer.labelingInfo","layer.labelsVisible"]})],b.prototype,"labelsVisible",null);d([p.property()],b.prototype,"numFeatures",null);d([p.property({dependsOn:["layer.renderer","layer.outFields","layer.definitionExpression","layer.historicMoment","layer.labelingInfo"]})],b.prototype,"renderingConfigHash",null);d([p.property()],b.prototype,
"tileRenderer",void 0);d([p.property({dependsOn:["layer.renderer","tileRenderer.updating"]})],b.prototype,"updating",void 0);return b=d([p.subclass("esri.views.2d.layers.FeatureLayerView2D")],b)}(p.declared(x,C))});