// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/webgl/rendererInfoUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../Graphic ../../../../arcade/Feature ../../../../support/arcadeUtils ./enums ./visualVariablesUtils".split(" "),function(u,k,w,t,v,m,r,x){function l(c,d,l){if(!c)return null;var g=0,a={};c=c.clone();var b=c.visualVariables,e=null;if("simple"!==c.type){var n=c.valueExpression;if(!c.field&&n){var y="$$fake"+g++,A=m.createFunction(n);a[y]=function(a,b){f.repurposeFromGraphicLikeObject(a.geometry,
a.attributes,l);return m.executeFunction(A,{vars:{$feature:f,$view:m.getViewInfo(b)},spatialReference:d})};c.field=y;c.valueExpression=null;e=function(b,e){e.attributes[y]=a[y](e);return b.valueExpression?b.getSymbol(t.fromJSON(e)):b.getSymbol(e)}}}b&&(c.visualVariables=b.map(function(b){var e="size"===b.type&&b.valueExpression&&"$view.scale"===b.valueExpression;if(b.normalizationField){var n=b.field,z=b.normalizationField,e="$$fake"+g++;a[e]=function(b,a){return b.attributes[n]/b.attributes[z]};
b=b.clone();b.field=e;b.normalizationField=null;return b}if(b.valueExpression&&!e){var D=b.valueExpression,e="$$fake"+g++,c=m.createFunction(D);a[e]=function(b,a){f.repurposeFromGraphicLikeObject(b.geometry,b.attributes,l);return m.executeFunction(c,{vars:{$feature:f,$view:m.getViewInfo(a)},spatialReference:d})};b=b.clone();b.field=e;b.valueExpression=null}return b}));return{renderer:c,normalizingFunctions:a,getSymbolFunction:e}}Object.defineProperty(k,"__esModule",{value:!0});var f=new v;k.createRendererInfo=
function(c,d,f){var g=(d=l(c,d,f)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null},d.normalizingFunctions),a=d&&d.getSymbolFunction;c=d&&d.renderer||c;d=x.convertVisualVariables(c.visualVariables);return{renderer:c,vvFields:d.vvFields,vvRanges:d.vvRanges,getValue:function(b,a){var e=g[a];return e?e(b):b.attributes[a]},getSymbol:function(b){return a?a(this.renderer,b):this.renderer.getSymbol?this.renderer.getSymbol.call(this.renderer,b):null}}};k.getNormalizedRenderer=function(c,d,
f){return(d=l(c,d,f)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null},d.renderer)||c};k.getSymbol=function(c,d){return c.getSymbol(d)};k.isRendererWebGLCompatible=function(c){if(!c||-1===["simple","class-breaks","unique-value","heatmap"].indexOf(c.type))return!1;if("visualVariables"in c&&c.visualVariables){var d=0;for(c=c.visualVariables;d<c.length;d++){var f=c[d];switch(f.type){case "color":case "opacity":if(f.stops&&8<f.stops.length)return!1;break;case "size":if(x.getTypeOfSizeVisualVariable(f)===
r.WGLVVFlag.SIZE_FIELD_STOPS&&f.stops&&6<f.stops.length)return!1}}}return!0}})},"esri/views/2d/engine/webgl/WGLFeatureView":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/promiseUtils ../../../../core/promiseUtils ../../../../geometry/Point ../Container ../../engine/webgl/TileData ./enums ./Utils ./WGLRendererInfo".split(" "),function(u,k,w,t,v,m,r,x,l,f,c,d){Object.defineProperty(k,"__esModule",{value:!0});u=function(k){function g(a){var b=
k.call(this)||this;b._rendererInfo=new d;b._pointToCallbacks=new Map;b._highlightIDs=new Set;b._invisibleFeatures=new Set;b._displayWidth=0;b._displayHeight=0;b._highlightOptionsUpToDate=!1;b.layer=null;b.highlightOptions=a.highlightOptions;b.tileInfoView=a.tileInfoView;b.layer=a.layer;b._layerView=a.layerView;return b}t(g,k);g.prototype.dispose=function(){this.removeAllChildren();for(var a=0,b=this.children;a<b.length;a++)b[a].dispose()};g.prototype.disposeWebGLResources=function(){for(var a=0,b=
this.children;a<b.length;a++)b[a].clear()};g.prototype.displayWidth=function(){return this._displayWidth};Object.defineProperty(g.prototype,"displayHeight",{get:function(){return this._displayHeight},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"highlightOptions",{get:function(){return this._highlightOptions},set:function(a){this._highlightOptions=a;this._highlightOptionsUpToDate=!1},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"visualVariablesInfo",{get:function(){return this._visualVariablesInfo},
set:function(a){this._visualVariablesInfo=a;this.requestRender()},enumerable:!0,configurable:!0});g.prototype.hitTest=function(a,b){var e=this,n=[a,b];return v.create(function(b,a){e._pointToCallbacks.set(n,{resolve:b,reject:a});e.requestRender()},function(){e._pointToCallbacks.has(n)&&e._pointToCallbacks.delete(n)})};g.prototype.highlight=function(a){var b=this;b.addHighlight(a);return{remove:function(){b.removeHighlight(a)}}};g.prototype.setHighlight=function(a){this._highlightIDs.clear();this.addHighlight(a)};
g.prototype.setVisibility=function(a,b){a||(a=[]);b||(b=[]);for(var e=this._invisibleFeatures,n=0,c=a;n<c.length;n++){var f=c[n];e.has(f)&&e.delete(f)}n=0;for(c=b;n<c.length;n++)e.add(c[n]);e=0;for(n=this.children;e<n.length;e++)c=n[e],c.data&&c.setVisibility(a,b)};g.prototype.addHighlight=function(a){for(var b=0;b<a.length;b++)this._highlightIDs.add(a[b]);this._buildHLList()};g.prototype.removeHighlight=function(a){for(var b=0;b<a.length;b++)this._highlightIDs.delete(a[b]);this._buildHLList()};g.prototype.whenAttached=
function(){var a=this;return this.attached?v.resolve():v.create(function(b){return a.once("attached",function(){return b()})})};g.prototype.getMaterialItems=function(a){var b=this;return this.whenAttached().then(function(){if(b.stage&&a&&0!==a.length){for(var e=[],c=b.stage.painter.textureManager,f=0;f<a.length;f++){var g=a[f];e.push(c.rasterizeItem(g.symbol,g.glyphIds))}return m.all(e).then(function(b){return b.map(function(b,a){return{id:a,mosaicItem:b}})})}})};g.prototype.onTileData=function(a,
b){var e=!(!this.layer.labelingInfo||!this.layer.labelingInfo.length),c=b.addOrUpdate&&l.decode(b.addOrUpdate);b=w({},b,{addOrUpdate:c});a.setData(b,e,this.layer.labelsVisible);a.resetVisibility(this._invisibleFeatures);a.buildHLList(this._highlightIDs);this.contains(a)||this.addChild(a);this.requestRender();this._layerView&&this._layerView.view.labelManager.requestUpdate()};g.prototype.onTileError=function(a){a.clear();a.buildHLList(this._highlightIDs);this.contains(a)||this.addChild(a);this.requestRender()};
g.prototype.addChild=function(a){var b=k.prototype.addChild.call(this,a);this.layer.labelingInfo&&this._layerView&&this._layerView.view.labelManager.addTile(this.layer.uid,a);this._buildHLList();return b};g.prototype.removeChild=function(a){var b=k.prototype.removeChild.call(this,a);this.layer.labelingInfo&&this._layerView&&this._layerView.view.labelManager.removeTile(this.layer.uid,a.key.id);this._buildHLList();return b};g.prototype.renderChildren=function(a){var b=this,e=this.stage.painter;this._updateTilesTransform(a.state,
this.tileInfoView.getClosestInfoForScale(a.state.scale).level);this._updateHighlightOptions();this._rendererInfo.updateVisualVariables(this._visualVariablesInfo.vvRanges,a.state);var c=this.tileInfoView.getClosestInfoForScale(a.state.scale).level,g=this.tileInfoView.tileInfo.scaleToZoom(a.state.scale),d=w({},a,{rendererInfo:this._rendererInfo,requiredLevel:c,displayLevel:g,context:this.stage.context,painter:this.stage.painter});this._rendererInfo.updateVisualVariables(this._visualVariablesInfo.vvRanges,
d.state);this.sortChildren(function(b,a){return 0!==b.key.level-a.key.level?b.key.level-a.key.level:0!==b.key.row-a.key.row?b.key.row-a.key.row:b.key.col-a.key.col});a=d.drawPhase;if(a&(f.WGLDrawPhase.LABEL|f.WGLDrawPhase.LABEL_ALPHA)){c=this.layer;if(!(c.labelsVisible&&c.labelingInfo&&0<c.labelingInfo.length))return;this._updateTilesTransform(d.state,d.requiredLevel)}e.draw(d,this.children,a,this._painterOptions);0<this._highlightIDs.size&&e.highlight(d,this.children);0!==this._pointToCallbacks.size&&
(this._pointToCallbacks.forEach(function(a,c){a.resolve(b._hitTest(d,c[0],c[1]))}),this._pointToCallbacks.clear())};g.prototype._hitTest=function(a,b,e){var d=this.stage,g=d.painter,d=d.context,l=a.requiredLevel,k=[0,0];a.state.toMap(k,[b,e]);b=a.state.clone();e=b.viewpoint.clone();e.targetGeometry=new r(k[0],k[1],a.state.spatialReference);b.viewpoint=e;b.size=[c.C_HITTEST_SEARCH_SIZE,c.C_HITTEST_SEARCH_SIZE];this._updateTilesTransform(b,l);return g.hitTest({globalOpacity:1,painter:g,context:d,drawPhase:f.WGLDrawPhase.HITTEST,
pixelRatio:a.pixelRatio,displayLevel:a.displayLevel,rendererInfo:this._rendererInfo,requiredLevel:l,state:b,stationary:a.stationary},this.children)};g.prototype._updateTilesTransform=function(a,b){b=0;for(var c=this.children;b<c.length;b++){var d=c[b],f=this.tileInfoView.tileInfo.lods[d.key.level].resolution;d.setTransform(a,f/(a.resolution*a.pixelRatio));d.setLabelTransform(a,f)}};g.prototype._updateHighlightOptions=function(){if(!this._highlightOptionsUpToDate&&this.parent){var a=this.stage.painter,
b=this._highlightOptions;if(a){var c=b.color.toRgba();c[0]/=255;c[1]/=255;c[2]/=255;var d=c.slice();c[3]*=b.fillOpacity;d[3]*=b.haloOpacity;a.setHighlightOptions({fillColor:c,outlineColor:d,outlineWidth:2,outerHaloWidth:.3,innerHaloWidth:.3,outlinePosition:0});this._highlightOptionsUpToDate=!0}}};g.prototype._buildHLList=function(){for(var a=0,b=this.children;a<b.length;a++)b[a].buildHLList(this._highlightIDs);this.requestRender()};return g}(x.Container);k.default=u})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Accessor ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators".split(" "),
function(u,k,w,t,v,m,r){Object.defineProperty(k,"__esModule",{value:!0});u=function(k){function l(f){f=k.call(this)||this;f.tiles=new Map;f.layer=null;return f}w(l,k);l.prototype.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.highlightOptions=this.configuration=this.tiles=null};Object.defineProperty(l.prototype,"updating",{get:function(){return this.isUpdating()},enumerable:!0,configurable:!0});l.prototype.acquireTile=function(f){var c=this,d=this.createTile(f);
d.once("isReady",function(){return c.notifyChange("updating")});this.tiles.set(f.id,d);return d};l.prototype.forEachTile=function(f){this.tiles.forEach(f)};l.prototype.releaseTile=function(f){this.tiles.delete(f.key.id);this.disposeTile(f)};l.prototype.isUpdating=function(){var f=!0;this.tiles.forEach(function(c){f=f&&c.isReady});return!f};l.prototype.requestUpdate=function(){this.layerView.requestUpdate()};t([r.property()],l.prototype,"configuration",void 0);t([r.property()],l.prototype,"highlightOptions",
void 0);t([r.property()],l.prototype,"layer",void 0);t([r.property()],l.prototype,"layerView",void 0);t([r.property()],l.prototype,"tileInfoView",void 0);t([r.property()],l.prototype,"updating",null);return l=t([r.subclass()],l)}(r.declared(v,m));k.default=u})},"*noref":1}});
define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/tsSupport/assignHelper ../../../../../renderers ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators ../../../../../geometry/support/aaBoundingRect ../../../../../renderers/support/diffUtils ../../../../../support/arcadeUtils ../../../engine/webgl/rendererInfoUtils ../../../engine/webgl/visualVariablesUtils ../../../engine/webgl/WGLFeatureView ../../../engine/webgl/WGLTile ./BaseTileRenderer".split(" "),function(u,
k,w,t,v,m,r,x,l,f,c,d,B,g,a,b,e,n){function y(b){for(var a in b.diff){var c=b.diff[a];if("collection"===c.type){if(0!==c.changed.length||0!==c.added.length||0!==c.removed.length)return!0}else if("visualVariables"!==a&&"authoringInfo"!==a)return!0}return!1}function A(b){if(!("visualVariables"in b&&b.visualVariables&&b.visualVariables.length))return b;b=b.clone();var a=b.visualVariables.map(function(b){if(("size"===b.type||"color"===b.type||"opacity"===b.type)&&null!=b.stops){var a;var c=b.type;a=b.stops;
if(!(8>=a.length))if(C.warn("Found "+a.length+" Visual Variable stops, but MapView only supports 8. Displayed stops will be simplified."),16<a.length){for(var z=a[0],d=a.slice(1),f=d.pop(),e=d[0].value,g=d[d.length-1].value,k=(g-e)/6,n=[];e<g;e+=k){for(var h=0;e>=d[h].value;)h++;var p=d[h],m=a[h-1],q=e-m.value,p=p.value===m.value?1:q/(p.value-m.value);"color"===c?(m=d[h],h=a[h-1],q=m.color.clone(),q.r=(1-p)*h.color.r+p*q.r,q.g=(1-p)*h.color.g+p*q.g,q.b=(1-p)*h.color.b+p*q.b,q.a=(1-p)*h.color.a+p*
q.a,n.push({value:e,color:q,label:m.label})):"size"===c?(m=d[h],q=a[h-1],h=l.toPt(m.size),q=l.toPt(q.size),n.push({value:e,size:(1-p)*q+p*h,label:m.label})):(m=d[h],n.push({value:e,opacity:(1-p)*a[h-1].opacity+p*m.opacity,label:m.label}))}a=[z].concat(n,[f])}else{c=a[0];a=a.slice(1);for(z=a.pop();6<a.length;){f=d=0;for(g=1;g<a.length;g++)k=Math.abs(a[g].value-a[g-1].value),k>f&&(f=k,d=g);a.splice(d,1)}a=[c].concat(a,[z])}b.stops=a}return b});b.visualVariables=a;return b}Object.defineProperty(k,"__esModule",
{value:!0});var C=x.getLogger("esri.views.2d.layers.features.tileRenderer.SymbolTileRenderer");u=function(k){function h(a){return k.call(this)||this}w(h,k);h.prototype.createTile=function(a){var b=c.create();this.tileInfoView.getTileBounds(b,a);return new e(a,b)};h.prototype.disposeTile=function(a){this.featuresView.removeChild(a)};h.prototype.highlight=function(a){return this.featuresView.highlight(a)};h.prototype.hitTest=function(a,b){return this.featuresView.hitTest(a,b)};h.prototype.supportsRenderer=
function(a){return null!=a&&g.isRendererWebGLCompatible(a)&&-1!==["simple","class-breaks","unique-value"].indexOf(a.type)};h.prototype.getProcessorConfiguration=function(){var a=this.layer,b=A(a.renderer);return{type:"symbol",renderer:b.toJSON(),devicePixelRatio:window.devicePixelRatio||1,definitionExpression:a.definitionExpression,outFields:a.outFields.slice().sort(),gdbVersion:a.gdbVersion,historicMoment:a.historicMoment&&a.historicMoment.getTime(),labelingInfo:a.labelingInfo&&a.labelingInfo.map(function(a){return a.toJSON()}),
hasGeometryExpr:B.hasGeometryOperations(b)||a.labelingInfo&&a.labelingInfo.some(function(a){return B.hasGeometryOperations(a)})}};h.prototype.needsProcessorReconfiguration=function(a){var b=this.wouldClear(a),c=this.configuration;this.configuration=a;return b||c.definitionExpression!==a.definitionExpression};h.prototype.wouldClear=function(b){var c=this.configuration;if(!c||c.outFields.join()!==b.outFields.join()||d.diff(c.labelingInfo,b.labelingInfo))return!0;c=this.configuration&&m.fromJSON(this.configuration.renderer)||
null;b=b&&m.fromJSON(b.renderer)||null;c=d.diff(c,b);if(!c)return!1;switch(c.type){case "complete":return!0;case "partial":if(y(c))return!0;if(c.diff.visualVariables){var c=this.featuresView.visualVariablesInfo,e=this.tileInfoView.tileInfo.spatialReference,f={fields:this.layer.fields.map(function(a){return a.toJSON()})};b=g.getNormalizedRenderer(b,e,f);b=a.convertVisualVariables(b.visualVariables).vvFields;return d.diff(c.vvFields,b)?!0:!1}}};h.prototype.clear=function(){this.featuresView.disposeWebGLResources()};
h.prototype.applyConfiguration=function(b){var c=m.fromJSON(b.renderer),d={fields:this.layer.fields.map(function(a){return a.toJSON()})},c=g.getNormalizedRenderer(c,this.tileInfoView.tileInfo.spatialReference,d);this.configuration=b;this.featuresView.visualVariablesInfo=a.convertVisualVariables(c.visualVariables)};h.prototype.install=function(a){var c=new b.default({highlightOptions:this.highlightOptions,tileInfoView:this.tileInfoView,layer:this.layer,layerView:this.layerView});this.featuresView=
c;a.addChild(c)};h.prototype.uninstall=function(a){a.removeChild(this.featuresView);this.featuresView=null};h.prototype.onTileData=function(a){var b=this.tiles.get(a.tileKey);if(b)this.featuresView.onTileData(b,a.data)};h.prototype.onTileError=function(a){if(a=this.tiles.get(a.tileKey))this.featuresView.onTileError(a)};h.prototype.getMaterialItems=function(a){return this.featuresView.getMaterialItems(a)};return h=t([f.subclass()],h)}(f.declared(r,n.default));k.default=u});