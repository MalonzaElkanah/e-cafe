// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
require({cache:{"esri/renderers/support/heatmapUtils":function(){define(["require","exports","../../core/global","../../views/3d/support/mathUtils"],function(l,c,n,g){function p(b,a,d,q,e){b=new Uint32Array(b*b);a="buffer"in a?a:new Float64Array(a);d="buffer"in d?new Uint32Array(d.buffer):new Uint32Array((new Uint8Array(d)).buffer);e=d.length/(e-q);for(var c=0;c<a.length;c++)b[c]=d[g.clamp(Math.floor((a[c]-q)*e),0,d.length-1)];return b.buffer}function r(b){for(var a=Math.round(4.5*b),d=b*b,c=new Float64Array(2*
a+1),e=0;e<=c.length;e++)c[e]=Math.exp(-Math.pow(e-a,2)/(2*d))/Math.sqrt(2*Math.PI)*(b/2);return c}function k(b,a){return"function"===typeof b?b:b?"string"===typeof a?function(a){return-1*+a[b]}:function(d){return+d[b]+a}:function(a){return 1}}Object.defineProperty(c,"__esModule",{value:!0});c.generateGradient=function(){if(!("document"in n))return function(a){return null};var b=document.createElement("canvas"),a=b.getContext("2d");b.height=512;b.width=1;return function(d){var c=a.createLinearGradient(0,
0,0,b.height),e=0;for(d=d.colorStops;e<d.length;e++){var g=d[e],h=g.color;c.addColorStop(g.ratio,"rgba("+h[0]+", "+h[1]+", "+h[2]+", "+h[3]+")")}a.fillStyle=c;a.fillRect(0,0,1,b.height);return a.getImageData(0,0,1,b.height).data}}();c.calculateHeatmapIntensityInfo=function(b,a,d,c){var e=a.blurRadius,g=a.fieldOffset,h=a.field;a=new Float64Array(d*c);for(var q=r(e),e=Math.round(4.5*e),f=Number.NEGATIVE_INFINITY,m,g=k(h,g),h=0;h<b.length;h++){var w=b[h],t=w.geometry,l=t.x-e,x=t.y-e,p=Math.max(0,l);
m=Math.max(0,x);for(var n=Math.min(c,t.y+e),t=Math.min(d,t.x+e),w=+g(w.attributes),u=m;u<n;u++)for(var z=q[u-x],v=p;v<t;v++)m=a[u*d+v]+=z*q[v-l]*w,m>f&&(f=m)}return{matrix:a.buffer,max:f}};c.drawHeatmap=function(b,a,d,c,e,g){b.canvas.width=b.canvas.height=a;b.clearRect(0,0,a,a);var h=b.getImageData(0,0,a,a);d&&c&&h.data.set(new Uint8ClampedArray(p(a,d,c,e,g)));b.putImageData(h,0,0)};c.createHeatmapImageData=p;c.createKernel=r;c.createValueFunction=k})},"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":function(){define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../core/Accessor ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators".split(" "),
function(l,c,n,g,p,r,k){Object.defineProperty(c,"__esModule",{value:!0});l=function(b){function a(a){a=b.call(this)||this;a.tiles=new Map;a.layer=null;return a}n(a,b);a.prototype.destroy=function(){this.tiles.clear();this.layer=this.layerView=this.tileInfoView=this.highlightOptions=this.configuration=this.tiles=null};Object.defineProperty(a.prototype,"updating",{get:function(){return this.isUpdating()},enumerable:!0,configurable:!0});a.prototype.acquireTile=function(a){var b=this,d=this.createTile(a);
d.once("isReady",function(){return b.notifyChange("updating")});this.tiles.set(a.id,d);return d};a.prototype.forEachTile=function(a){this.tiles.forEach(a)};a.prototype.releaseTile=function(a){this.tiles.delete(a.key.id);this.disposeTile(a)};a.prototype.isUpdating=function(){var a=!0;this.tiles.forEach(function(b){a=a&&b.isReady});return!a};a.prototype.requestUpdate=function(){this.layerView.requestUpdate()};g([k.property()],a.prototype,"configuration",void 0);g([k.property()],a.prototype,"highlightOptions",
void 0);g([k.property()],a.prototype,"layer",void 0);g([k.property()],a.prototype,"layerView",void 0);g([k.property()],a.prototype,"tileInfoView",void 0);g([k.property()],a.prototype,"updating",null);return a=g([k.subclass()],a)}(k.declared(p,r));c.default=l})},"esri/views/2d/layers/features/tileRenderers/support/HeatmapSource":function(){define(["require","exports","../../../../../../renderers/support/heatmapUtils"],function(l,c,n){Object.defineProperty(c,"__esModule",{value:!0});l=function(){function c(){this.gradient=
null;this.width=this.height=512}c.prototype.render=function(c){n.drawHeatmap(c,512,this.intensities,this.gradient,this.minPixelIntensity,this.maxPixelIntensity)};return c}();c.HeatmapSource=l})},"*noref":1}});
define("require exports ../../../../../core/tsSupport/declareExtendsHelper ../../../../../core/tsSupport/decorateHelper ../../../../../renderers ../../../../../core/Accessor ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators ../../../../../renderers/support/diffUtils ../../../../../renderers/support/heatmapUtils ../../../engine/BitmapContainer ../../../engine/BitmapTile ./BaseTileRenderer ./support/HeatmapSource".split(" "),function(l,c,n,g,p,r,k,b,a,d,q,e,y,h){Object.defineProperty(c,
"__esModule",{value:!0});l=function(c){function f(a){a=c.call(this,a)||this;a.container=new q.BitmapContainer;return a}n(f,c);Object.defineProperty(f.prototype,"gradient",{get:function(){return d.generateGradient(this.configuration.renderer)},enumerable:!0,configurable:!0});f.prototype.createTile=function(a){var m=e.BitmapTile.pool.acquire();m.key.set(a);this.tileInfoView.getTileCoords(m,a);m.resolution=this.tileInfoView.getTileResolution(a);return m};f.prototype.applyConfiguration=function(a){this.configuration=
a;a=a.renderer;var m=a.minPixelIntensity,b=a.maxPixelIntensity,c=this.gradient;this.tiles.forEach(function(a){var d=a.source;d&&(d.minPixelIntensity=m,d.maxPixelIntensity=b,d.gradient=c,a.invalidateTexture())})};f.prototype.clear=function(){this.tiles.forEach(function(a){if(a=a.source)a.intensities=null})};f.prototype.getProcessorConfiguration=function(){var a=this.layer;return{type:"heatmap",renderer:a.renderer.toJSON(),definitionExpression:a.definitionExpression,outFields:a.outFields,gdbVersion:a.gdbVersion,
historicMoment:a.historicMoment&&a.historicMoment.getTime()}};f.prototype.hitTest=function(a,b){return k.resolve([])};f.prototype.highlight=function(a){return{remove:function(){}}};f.prototype.install=function(a){a.addChild(this.container)};f.prototype.uninstall=function(a){this.container.removeAllChildren();a.removeChild(this.container)};f.prototype.needsProcessorReconfiguration=function(a){var b=this.configuration;return this.wouldClear(a)||b.definitionExpression!==a.definitionExpression};f.prototype.wouldClear=
function(b){var c=this.configuration;if(!c||c.outFields.join()!==b.outFields.join())return!0;c=this.configuration&&p.fromJSON(this.configuration.renderer)||null;b=b&&p.fromJSON(b.renderer)||null;b=a.diff(c,b);if(!b)return!1;switch(b.type){case "complete":return!0;case "partial":for(var d in b.diff)if("colorStops"!==d&&"minPixelIntensity"!==d&&"maxPixelIntensity"!==d)return!0}return!1};f.prototype.disposeTile=function(a){this.container.removeChild(a);e.BitmapTile.pool.release(a)};f.prototype.supportsRenderer=
function(a){return a&&"heatmap"===a.type};f.prototype.onTileData=function(a){var b=this.tiles.get(a.tileKey);if(b){a=a.intensityInfo;var c=this.configuration.renderer,d=c.minPixelIntensity,c=c.maxPixelIntensity,e=b.source||new h.HeatmapSource;e.intensities=a&&a.matrix||null;e.minPixelIntensity=d;e.maxPixelIntensity=c;e.gradient=this.gradient;b.source=e;this.container.addChild(b);this.requestUpdate()}};f.prototype.onTileError=function(a){console.error(a)};g([b.property({readOnly:!0,dependsOn:["configuration"]})],
f.prototype,"gradient",null);return f=g([b.subclass()],f)}(b.declared(r,y.default));c.default=l});