// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
/*

 Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
 Copyright 2015, Google Inc. All Rights Reserved.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to
 deal in the Software without restriction, including without limitation the
 rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 sell copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice including the dates of first publication and
 either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
 shall be included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
 IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

 Original Code. The Original Code is: OpenGL Sample Implementation,
 Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
 Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
 Copyright in any portions created by third parties is as indicated
 elsewhere herein. All Rights Reserved.
*/
require({cache:{"esri/views/2d/engine/Stage":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../core/promiseUtils ../../../core/scheduling ../../../core/libs/gl-matrix-2/gl-matrix ./Container ./webgl/BitBlitRenderer ./webgl/enums ./webgl/Painter ./webgl/shaders/StencilPrograms ../../support/screenshotUtils ../../webgl/BufferObject ../../webgl/context-util ../../webgl/FramebufferObject ../../webgl/programUtils ../../webgl/RenderingContext ../../webgl/VertexArrayObject".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w,r,t,A,C){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function e(c,f){var e=a.call(this)||this;e._renderParameters={drawPhase:0,state:e.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1};e._renderRequested=!1;e._clipData=new Float32Array(8);e._upperLeft=g.vec2f64.create();e._upperRight=g.vec2f64.create();e._lowerLeft=g.vec2f64.create();e._lowerRight=g.vec2f64.create();e._mat2=g.mat2df64.create();e._clipRendererInitialized=
!1;e._supersampleScreenshots=!0;e.stage=e;e._stationary=!0;e.attached=!0;f=k({alpha:!0,stencil:!0,renderContext:"webgl"},f);e._canvas=document.createElement("canvas");e._canvas.setAttribute("style","width: 100%; height:100%; display:block;");c.appendChild(e._canvas);c=w.createContextOrErrorHTML(e._canvas,{alpha:f.alpha,antialias:!1,depth:!0,stencil:f.stencil},f.renderContext);e.context=new A(c);e.painter=new m.default(e.context);e._taskHandle=l.addFrameTask({render:function(){return e.renderFrame()}});
e._taskHandle.pause();e._supersampleScreenshots=f.hasOwnProperty("supersampleScreenshots")?f.supersampleScreenshots:!0;return e}d(e,a);e.prototype.destroy=function(){this.removeAllChildren();this.renderFrame();this._taskHandle.remove();this._boundFBO=this._taskHandle=null;this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null);this._labelsFBO1&&(this._labelsFBO1.dispose(),this._labelsFBO1=null);this._labelsFBO2&&(this._labelsFBO2.dispose(),this._labelsFBO2=null);this._blitRenderer&&(this._blitRenderer.dispose(),
this._blitRenderer=null);this._clipVAO&&(this._clipVAO.dispose(),this._clipVBO=this._clipVAO=null);this._clipStencilProgram&&(this._clipStencilProgram.dispose(),this._clipStencilProgram=null);this.painter.dispose();this.context.dispose();this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas);this._canvas=null};Object.defineProperty(e.prototype,"state",{get:function(){return this._state},set:function(a){this._state=a;this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"stationary",{get:function(){return this._stationary},set:function(a){this._stationary!==a&&(this._stationary=a,this.requestRender())},enumerable:!0,configurable:!0});e.prototype.requestRender=function(){this._renderRequested=!0;this._taskHandle&&this._taskHandle.resume()};e.prototype.renderFrame=function(){this._renderRequested&&(this._renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,
this._renderParameters.globalOpacity=1,this.processRender(this._renderParameters));this._renderRequested||this._taskHandle.pause()};e.prototype.renderChildren=function(a){var c=this.context,e=this.children;this.beforeRenderChildren(a);a.drawPhase=f.WGLDrawPhase.MAP;for(var e=a.children?a.children:e,g=e.length,b=0;b<g;b++){var l=e[b];l.attached&&l.processRender(a)}var m=c.getBoundFramebufferObject();c.bindFramebuffer(this._labelsFBO2);b=a.stationary;c.setClearColor(0,0,0,b?0:1);c.clear(c.gl.COLOR_BUFFER_BIT);
if(b)for(a.drawPhase=f.WGLDrawPhase.LABEL_ALPHA,a.labelFBO=this._labelsFBO1,b=0;b<g;b++)l=e[b],l.attached&&l.processRender(a);c.bindFramebuffer(m);a.labelFBO=this._labelsFBO2;a.drawPhase=f.WGLDrawPhase.LABEL;for(b=0;b<g;b++)l=e[b],l.attached&&l.processRender(a);a=this._labelsFBO2;this._labelsFBO2=this._labelsFBO1;this._labelsFBO1=a;this.afterRenderChildren()};e.prototype.beforeRenderChildren=function(a){var c=this.context,f=a.state,e=a.pixelRatio;if(this.painter){c.enforceState();var b=f.size;a=f.rotation;
var l=Math.round(b[0]*e),b=Math.round(b[1]*e);this._boundFBO=c.getBoundFramebufferObject();this._labelsFBO1&&this._labelsFBO1.width===l&&this._labelsFBO1.height===b||(this._labelsFBO1&&(this._labelsFBO1.dispose(),this._labelsFBO2.dispose()),this._labelsFBO1=r.createWithAttachments(c,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:l,height:b},{colorTarget:0,depthStencilTarget:0}),c.bindFramebuffer(this._labelsFBO1),c.setDepthWriteEnabled(!0),c.setStencilWriteMask(255),
c.setClearColor(0,0,0,0),c.setClearDepth(1),c.setClearStencil(0),c.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT|c.gl.STENCIL_BUFFER_BIT),c.setDepthWriteEnabled(!1),c.bindFramebuffer(this._boundFBO),this._labelsFBO2=r.createWithAttachments(c,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:l,height:b},{colorTarget:0,depthStencilTarget:0}));if(f.spatialReference&&(f.spatialReference._isWrappable?f.spatialReference._isWrappable():f.spatialReference.isWrappable)){var m=
g.common.toRadian(a),d=Math.abs(Math.cos(m)),p=Math.abs(Math.sin(m)),k=Math.round(f.worldScreenWidth);if(Math.round(l*d+b*p)<=k)this._clipFrame=!1;else{this._clipFBO&&this._clipFBO.width===l&&this._clipFBO.height===b||(this._clipFBO=new r(c,{colorTarget:0,depthStencilTarget:3,width:l,height:b}));var y=.5*l,x=.5*b,f=1/l,v=1/b,e=.5*k*e,u=.5*(l*p+b*d),l=this._upperLeft,d=this._upperRight,p=this._lowerLeft,k=this._lowerRight;g.vec2.set(l,-e,-u);g.vec2.set(d,e,-u);g.vec2.set(p,-e,u);g.vec2.set(k,e,u);
g.mat2d.identity(this._mat2);g.mat2d.translate(this._mat2,this._mat2,[y,x]);0!==a&&g.mat2d.rotate(this._mat2,this._mat2,m);g.vec2.transformMat2d(l,l,this._mat2);g.vec2.transformMat2d(d,d,this._mat2);g.vec2.transformMat2d(p,p,this._mat2);g.vec2.transformMat2d(k,k,this._mat2);a=this._clipData;a.set([2*p[0]*f-1,2*(b-p[1])*v-1,2*k[0]*f-1,2*(b-k[1])*v-1,2*l[0]*f-1,2*(b-l[1])*v-1,2*d[0]*f-1,2*(b-d[1])*v-1]);this._clipRendererInitialized||this._initializeClipRenderer(c);this._clipVBO.setData(a);this._boundFBO=
c.getBoundFramebufferObject();c.bindFramebuffer(this._clipFBO);c.setDepthWriteEnabled(!0);c.setStencilWriteMask(255);c.setClearColor(0,0,0,0);c.setClearDepth(1);c.setClearStencil(0);c.clear(c.gl.COLOR_BUFFER_BIT|c.gl.DEPTH_BUFFER_BIT|c.gl.STENCIL_BUFFER_BIT);c.setDepthWriteEnabled(!1);this._clipFrame=!0}}else this._clipFrame=!1}};e.prototype.afterRenderChildren=function(){var a=this.context;a.logIno();this._clipFrame&&this._clipRendererInitialized&&(a.bindFramebuffer(this._boundFBO),this._boundFBO=
null,a.bindVAO(this._clipVAO),a.bindProgram(this._clipStencilProgram),a.setDepthWriteEnabled(!1),a.setDepthTestEnabled(!1),a.setStencilTestEnabled(!0),a.setBlendingEnabled(!1),a.setColorMask(!1,!1,!1,!1),a.setStencilOp(7680,7680,7681),a.setStencilWriteMask(255),a.setStencilFunction(519,1,255),a.drawElements(4,6,5123,0),a.bindVAO(),a.setColorMask(!0,!0,!0,!0),a.setBlendingEnabled(!0),a.setStencilFunction(514,1,255),this._blitRenderer.render(a,this._clipFBO.colorTexture,9728,1),a.setStencilTestEnabled(!1))};
e.prototype.doRender=function(c){var f=this.context,e=c.state,b=c.pixelRatio;this._resizeCanvas(c);this.context.enforceState();f.setViewport(0,0,b*e.size[0],b*e.size[1]);f.setDepthWriteEnabled(!0);f.setStencilWriteMask(255);f.setClearColor(0,0,0,0);f.setClearDepth(1);f.setClearStencil(0);f.clear(f.gl.COLOR_BUFFER_BIT|f.gl.DEPTH_BUFFER_BIT|f.gl.STENCIL_BUFFER_BIT);f.setDepthWriteEnabled(!1);a.prototype.doRender.call(this,c)};e.prototype.takeScreenshot=function(a,c){var f=x.screenshotSuperSampleSettings(a,
this._supersampleScreenshots),e=f.framebufferWidth,g=f.framebufferHeight,l=this.context,m=a.layers,d={drawPhase:null,globalOpacity:1,stationary:!0,state:this._renderParameters.state.clone(),pixelRatio:f.pixelRatio};if(null!=a.rotation){var p=d.state.viewpoint;p.rotation=a.rotation;d.state.viewpoint=p}0<m.length&&(d.children=[],m.forEach(function(a){var f=c.find(function(c){return c.layer.id===a.id});f&&f.container&&f.attached&&d.children.push(f.container)}));p=r.create(l,{colorTarget:0,depthStencilTarget:3,
width:e,height:g});m=l.getBoundFramebufferObject();l.bindFramebuffer(p);l.setViewport(0,0,e,g);e=l.gl;l.setClearColor(0,0,0,0);l.setClearDepth(1);l.setClearStencil(0);l.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);this.renderChildren(d);f=this._readbackScreenshot(f);l.bindFramebuffer(m);l=this._ensureScreenshotEncodeCanvas();a=x.encodeResult(f,a,l,{flipY:!0,premultipliedAlpha:!0});return b.resolve(a)};e.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||
(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};e.prototype._readbackScreenshot=function(a){var c=a.framebufferWidth,f=a.framebufferHeight,e=a.region;a=a.resample;var b=this.context.gl;if(a){var g=x.createEmptyImageData(c,f,this._ensureScreenshotEncodeCanvas());b.readPixels(0,0,c,f,6408,5121,new Uint8Array(g.data.buffer));c=x.createEmptyImageData(e.width,e.height,this._ensureScreenshotEncodeCanvas());return x.resampleHermite(g,c,!0,a.region.x,f-
(a.region.y+a.region.height),a.region.width,a.region.height)}g=x.createEmptyImageData(e.width,e.height,this._ensureScreenshotEncodeCanvas());b.readPixels(e.x,f-(e.y+e.height),e.width,e.height,6408,5121,new Uint8Array(g.data.buffer));return g};e.prototype._resizeCanvas=function(a){var c=this._canvas,f=c.style,e=a.state.size,b=a.pixelRatio;a=e[0];var e=e[1],g=Math.round(a*b),b=Math.round(e*b);if(c.width!==g||c.height!==b)c.width=g,c.height=b;f.width=a+"px";f.height=e+"px"};e.prototype._initializeClipRenderer=
function(a){if(this._clipRendererInitialized)return!0;this._blitRenderer=new c;var f=p.stencil.attributes,e=t.createProgram(a,p.stencil);if(!e)return!1;var b=u.createVertex(a,35040,32),g=new Uint16Array([0,1,2,2,1,3]),g=u.createIndex(a,35044,g);a=new C(a,f,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:b},g);this._clipStencilProgram=e;this._clipVBO=b;this._clipVAO=a;return this._clipRendererInitialized=!0};return e}(e.Container);a.Stage=h})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define("require exports ./shaders/BitBlitPrograms ../../../webgl/BufferObject ../../../webgl/programUtils ../../../webgl/VertexArrayObject".split(" "),
function(h,a,d,k,b,l){return function(){function a(){this._initialized=!1}a.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};a.prototype.render=function(a,c,f,b){a&&(this._initialized||this._initialize(a),a.setBlendFunctionSeparate(1,771,1,771),a.bindVAO(this._vertexArrayObject),a.bindProgram(this._program),c.setSamplingMode(f),a.bindTexture(c,0),this._program.setUniform1i("u_tex",
0),this._program.setUniform1f("u_opacity",b),a.drawArrays(5,0,4),a.bindVAO())};a.prototype._initialize=function(a){if(this._initialized)return!0;var c=d.bitBlit.attributes,f=b.createProgram(a,d.bitBlit);if(!f)return!1;var e=new Int8Array(16);e[0]=-1;e[1]=-1;e[2]=0;e[3]=0;e[4]=1;e[5]=-1;e[6]=1;e[7]=0;e[8]=-1;e[9]=1;e[10]=0;e[11]=1;e[12]=1;e[13]=1;e[14]=1;e[15]=1;a=new l(a,c,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,
stride:4,normalized:!1,divisor:0}]},{geometry:k.createVertex(a,35044,e)});this._program=f;this._vertexArrayObject=a;return this._initialized=!0};return a}()})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["require","exports","./sources/resolver"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.bitBlit={name:"bitBlit",shaders:{vertexShader:d.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:d.resolveIncludes("bitBlit/bitBlit.frag")},attributes:{a_pos:0,
a_tex:1}}})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["require","exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],function(h,a,d,k){Object.defineProperty(a,"__esModule",{value:!0});var b=new k(function(a){var b=d;a.split("/").forEach(function(a){b&&(b=b[a])});return b});a.resolveIncludes=function(a){return b.resolveIncludes(a)}})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(["require","exports"],function(h,a){return{background:{"background.frag":"uniform lowp vec4 u_color;\r\nvoid main() {\r\n  gl_FragColor \x3d u_color;\r\n}\r\n",
"background.vert":"attribute vec2 a_pos;\r\n\r\nuniform highp mat3 u_dvsMat3;\r\nuniform mediump float u_coord_range;\r\nuniform mediump float u_depth;\r\n\r\nvoid main() {\r\n  vec3 v_pos \x3d u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\r\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\r\n}\r\n"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\r\nuniform lowp float u_opacity;\r\n\r\nvarying mediump vec2 v_uv;\r\n\r\nvoid main() {\r\n  lowp vec4 color \x3d texture2D(u_tex, v_uv);\r\n\r\n  // Note: output in pre-multiplied alpha for correct alpha compositing\r\n  gl_FragColor \x3d color *  u_opacity;\r\n}\r\n",
"bitBlit.vert":"attribute vec2 a_pos;\r\nattribute vec2 a_tex;\r\n\r\nvarying mediump vec2 v_uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\r\n  v_uv \x3d a_tex;\r\n}\r\n"},highlight:{"blur.frag":"// A gaussian blur shader. It blurs the alpha channel of its input\r\n// according to 4 different sigma and stores the results into the\r\n// four channel of the target framebuffer.\r\n\r\n// It is intended to be called twice; the first time to perform an\r\n// horizontal blur, and a second time to perform a vertical blur.\r\n\r\n// This shader is used to turn the highlight mask into a highlight\r\n// map. The highlight map is an approximation of the signed distance\r\n// field of the mask.\r\n\r\n\r\n// Interpolated texture coordinates.\r\nvarying mediump vec2 v_texcoord;\r\n\r\n// Blur direction information. There are two possible\r\n// configurations that the host code can use.\r\n//  - [1, 0, 1/WIDTH, 0] Used when blurring horizontally. In this\r\n//    case u_direction[0] \x3d 1 is expressed in pixel and is fed to\r\n//    the gauss function to produce the value of the gaussian weight\r\n//    for that pixel, while u_direction[2] \x3d 1/WIDTH is in texel units\r\n//    and is used to sample the right texel from the texture map.\r\n//  - [0, 1, 0, 1/HEIGHT] Used when blurring vertically. In this\r\n//    case u_direction[1] \x3d 1 is expressed in pixel and is fed to\r\n//    the gauss function to produce the value of the gaussian weight\r\n//    for that pixel, while u_direction[3] \x3d 1/HEIGHT is in texel units\r\n//    and is used to sample the right texel from the texture map.\r\nuniform mediump vec4 u_direction;\r\n\r\n// Source to destination channel selection matrix.\r\nuniform mediump mat4 u_channelSelector;\r\n\r\n// The highlight map is obtained by blurring the alpha channel of the highlight\r\n// mask accroding to these 4 values of the gaussian's sigma parameter.\r\nuniform mediump vec4 u_sigmas;\r\n\r\n// This is the highlight mask if we have not blurred horizontally yet, otherwise\r\n// it is the horizontally blurred highlight map and blurring it one more time\r\n// vertically will complete the process.\r\nuniform sampler2D u_texture;\r\n\r\n// The gaussian kernel. Note that it lacks the normalization constant, because\r\n// we want to store it unnormalized in the highlight map (i.e. having a peak\r\n// value of 1). Note also that we are using the SIMD (single instruction, multiple\r\n// data) capabilities of the GPU to compute four different gaussian kernels, one\r\n// for each sigma.\r\nmediump vec4 gauss(mediump vec2 dir) {\r\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas * u_sigmas));\r\n}\r\n\r\nmediump vec4 selectChannel(mediump vec4 sample) {\r\n  return u_channelSelector * sample;\r\n}\r\n\r\n// Sample the input texture and accumulated its gaussian weighted value and the\r\n// total weight.\r\nvoid accumGauss(mediump float i, inout mediump vec4 tot, inout mediump vec4 weight) {\r\n  // Computes the gaussian weights, one for each sigma.\r\n  // Note that u_direction.xy is [1, 0] when blurring horizontally and [0, 1] when blurring vertically.\r\n  mediump vec4 w \x3d gauss(i * u_direction.xy);\r\n\r\n  // Accumumates the values.\r\n  // Note that u_direction.xy is [1/WIDTH, 0] when blurring horizontally and [0, 1/HEIGHT] when blurring vertically.\r\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw)) * w;\r\n\r\n  // Accumulates the weights.\r\n  weight +\x3d w;\r\n}\r\n\r\nvoid main(void) {\r\n  // Initialize accumulated values and weights to zero.\r\n  mediump vec4 tot \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n  mediump vec4 weight \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n  // Accumulates enough samples. These will be taken\r\n  // horizontally or vertically depending on the value\r\n  // of u_direction.\r\n  accumGauss(-5.0, tot, weight);\r\n  accumGauss(-4.0, tot, weight);\r\n  accumGauss(-3.0, tot, weight);\r\n  accumGauss(-2.0, tot, weight);\r\n  accumGauss(-1.0, tot, weight);\r\n  accumGauss(0.0, tot, weight);\r\n  accumGauss(1.0, tot, weight);\r\n  accumGauss(2.0, tot, weight);\r\n  accumGauss(3.0, tot, weight);\r\n  accumGauss(4.0, tot, weight);\r\n  accumGauss(5.0, tot, weight);\r\n\r\n  // Compute blurred values.\r\n  mediump vec4 rgba \x3d tot / weight;\r\n\r\n  // Return the values. Note that each channel will contain\r\n  // the result of a different blur operation, one for each\r\n  // of the four chosen sigma.\r\n  gl_FragColor \x3d vec4(rgba);\r\n}\r\n",
"highlight.frag":"// Takes as input the highlight map, estimated the signed distance field,\r\n// and shades the fragments according to their estimated distance from the\r\n// edge of the highlighted feature.\r\n\r\n// A shade texture is used to turn distance values into colors; the shade\r\n// texture is basically a color gradient and is recomputed on the host\r\n// every time that the user alters the highlight options.\r\n\r\n// Interpolated texture coordinates.\r\nvarying mediump vec2 v_texcoord;\r\n\r\n// The highlight map. Each channel is a blurred\r\n// version of the alpha channel of the highlight mask.\r\n//  - Channel 0 (red) corresponds to a gaussian blur with sigma \x3d u_sigmas[0];\r\n//  - Channel 1 (green) corresponds to a gaussian blur with sigma \x3d u_sigmas[1];\r\n//  - Channel 2 (blue) corresponds to a gaussian blur with sigma \x3d u_sigmas[2];\r\n//  - Channel 3 (alpha) corresponds to a gaussian blur with sigma \x3d u_sigmas[3];\r\n// As of today, only channel 3 is used for distance estimation.\r\n// But the availability of different amounts of blur leaves the\r\n// door open to multi-scale approaches.\r\nuniform sampler2D u_texture;\r\n\r\n// The highlight map was obtained by blurring the alpha channel of the highlight\r\n// mask accroding to these 4 values of the gaussian's sigma parameter.\r\nuniform mediump vec4 u_sigmas;\r\n\r\n// A 1-D texture used to shade the highlight.\r\nuniform sampler2D u_shade;\r\n\r\n// The 1-D shade texture is spreaded between u_minMaxDistance[0] and u_minMaxDistance[1].\r\nuniform mediump vec2 u_minMaxDistance;\r\n\r\n// Signed distance estimation.\r\nmediump float estimateDistance() {\r\n  // Use the largest sigma and the corresponding distance value stored in the\r\n  // last channel of the highlight map.\r\n  mediump float sigma \x3d u_sigmas[3];\r\n  mediump float y \x3d texture2D(u_texture, v_texcoord)[3];\r\n\r\n  // Estimates the distance by linearization and local inversion around\r\n  // the inflection point. The inflection point is in x \x3d 0.\r\n  const mediump float y0 \x3d 0.5;                           // Value of the convolution at the inflection point.\r\n  mediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * sigma);  // Slope of the convolution at the inflection point.\r\n  mediump float d \x3d (y - y0) / m0;                        // Inversion of a local linearization.\r\n\r\n  // Return the estimated distance.\r\n  return d;\r\n}\r\n\r\n// Shading based on estimated distance.\r\nmediump vec4 shade(mediump float d) {\r\n  // Maps the sampled distance from the [A, D] range (see HighlightRenderer::setHighlightOptions) to [0, 1].\r\n  mediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\r\n\r\n  // Force to [0, 1]; it should not be necessary because the shade texture uses the CLAMP address mode, so\r\n  // this should happen anyway internally to the sampler, but in practice it is needed to avoid weird\r\n  // banding artifacts.\r\n  // We don't really know if we need this or not.\r\n  mappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\r\n\r\n  // Sample the 1-D shade texture on its center line (i.e. on t\x3d0.5).\r\n  return texture2D(u_shade, vec2(mappedDistance, 0.5));\r\n}\r\n\r\nvoid main(void) {\r\n  // Estimate the distance.\r\n  mediump float d \x3d estimateDistance();\r\n\r\n  // Shade the distance.\r\n  gl_FragColor \x3d shade(d);\r\n}\r\n",
"textured.vert":"// Identity vertex shader that outputs an untransformed 2-D vertex\r\n// and passes its texture coordinates unchanged to the interpolator.\r\n\r\n// Vertex position.\r\nattribute mediump vec2 a_position;\r\n\r\n// Texture coordinates.\r\nattribute mediump vec2 a_texcoord;\r\n\r\n// Texture coordinates to be interpolated.\r\nvarying mediump vec2 v_texcoord;\r\n\r\nvoid main(void) {\r\n  // Pass the position unchanged.\r\n  gl_Position \x3d vec4(a_position, 0.0, 1.0);\r\n\r\n  // Pass the texture coordinates unchanged.\r\n  v_texcoord \x3d a_texcoord;\r\n}\r\n"},
materials:{fill:{"fill.frag":"precision lowp float;\r\n\r\n#ifdef PATTERN\r\nuniform lowp sampler2D u_texture;\r\n\r\nvarying mediump vec4 v_tlbr;\r\nvarying mediump vec2 v_tileTextureCoord;\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\nvarying lowp vec4 v_color;\r\nvarying lowp float v_opacity;\r\n\r\nvoid main()\r\n{\r\n#ifdef PATTERN\r\n  // normalize the calculated texture coordinate such that it fits in the range of 0 to 1.\r\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\r\n  // interpolate the image coordinate between the top-left and the bottom right to get the actual position to sample.\r\n  // after normalizing the position, we get a value ranging between 0 and 1 which refers to the entire texture, however\r\n  // we need to only sample from area that has our sprite in the mosaic.\r\n  mediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\r\n  // sample the sprite mosaic\r\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\r\n  gl_FragColor \x3d v_opacity * v_color * color;\r\n#else\r\n  gl_FragColor \x3d v_opacity * v_color;\r\n#endif // PATTERN\r\n\r\n#ifdef HIGHLIGHT\r\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\r\n#endif // HIGHLIGHT\r\n\r\n#ifdef ID\r\n  //if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n  //  discard;\r\n  //}\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"fill.vert":"precision mediump float;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_id; // since we need to render the Id as a color we need to break it into RGBA components. so just like a color, the Id is normalized.\r\nattribute vec4 a_color;\r\nattribute vec4 a_tlbr;\r\nattribute vec4 a_aux1;\r\nattribute vec2 a_aux2;\r\n\r\nattribute float  a_visible; // a one byte controlling the visibility of the vertex (a separate visibility buffer), values are 0 or 1 (visible)\r\n\r\n// T: TileCoords -\x3e DisplayCoords\r\n// Premultiplies DisplayMat3 * ViewMat3 * ScreenMat3\r\nuniform highp mat3 u_dvsMat3;\r\n\r\nvarying lowp vec4 v_color;\r\nvarying lowp float v_opacity;\r\n\r\n// import the VV inputs and functions (they are #ifdefed, so if the proper #define is not set it will end-up being a no-op)\r\n#include \x3cmaterials/fill/vvUniforms.glsl\x3e\r\n#include \x3cmaterials/fill/vvFunctions.glsl\x3e\r\n\r\n#ifdef PATTERN\r\nuniform mediump float u_zoomFactor;\r\nuniform mediump vec2 u_mosaicSize;\r\n\r\nvarying mediump vec4 v_tlbr;\r\nvarying mediump vec2 v_tileTextureCoord;\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\nconst float SIGNED_BYTE_TO_UNSIGNED \x3d 128.0;\r\n\r\nvoid main()\r\n{\r\n#ifdef VV_OPACITY\r\n  v_opacity \x3d getVVOpacity(a_vv.y);\r\n#else\r\n  v_opacity \x3d 1.0;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  v_color \x3d getVVColor(a_vv.x, a_color);\r\n#else\r\n  v_color \x3d a_color;\r\n#endif // VV_COLOR\r\n\r\n#ifdef ID\r\n  v_id \x3d a_id;\r\n#endif // ID\r\n\r\n#ifdef PATTERN\r\n  vec2 aux2 \x3d (1.0 / SIGNED_BYTE_TO_UNSIGNED) * a_aux2;\r\n\r\n  // calculate the pattern matrix\r\n  mat3 patternMatrix \x3d mat3(1.0, 0.0, 0.0,\r\n                            0.0, 1.0, 0.0,\r\n                            0.0, 0.0, 1.0);\r\n\r\n  patternMatrix[0][0] \x3d 1.0 / (u_zoomFactor * a_aux1.x * aux2.x);\r\n  patternMatrix[1][1] \x3d 1.0 / (u_zoomFactor * a_aux1.y * aux2.y);\r\n\r\n  vec2 symbolOffset \x3d u_zoomFactor * (a_aux1.zw - vec2(SIGNED_BYTE_TO_UNSIGNED));\r\n\r\n  // calculate the texture coordinates of the current vertex. It will of course get interpolated.\r\n  // The pattern matrix is a 3x3 scale matrix which 'tiles' the texture inside the tile, translating from\r\n  // tile coordinates to texture coordinates.\r\n  v_tileTextureCoord \x3d (patternMatrix * vec3(a_pos + symbolOffset, 1.0)).xy;\r\n  v_tlbr \x3d vec4(a_tlbr.x / u_mosaicSize.x, a_tlbr.y / u_mosaicSize.y, a_tlbr.z / u_mosaicSize.x, a_tlbr.w / u_mosaicSize.y);\r\n#endif // PATTERN\r\n\r\n  float z \x3d 2.0 * (1.0 - a_visible); // clip the vertex if the geometry isn't visible\r\n  vec3 v_pos \x3d u_dvsMat3 * vec3(a_pos, 1.);\r\n\r\n  gl_Position \x3d vec4(v_pos.xy, z, 1.0);\r\n}\r\n",
"vvFunctions.glsl":"const highp float nanValue \x3d 1e-30;\r\n\r\nbool isNan(float val) {\r\n  return (val \x3d\x3d nanValue);\r\n  //return !(val \x3c 0.0 || -1.0 \x3c (val - 1.0) || val \x3d\x3d 0.0);\r\n}\r\n\r\n#ifdef VV_OPACITY\r\nconst int VV_OPACITY_N \x3d 8;\r\n\r\nfloat getVVOpacity(float opacityValue) {\r\n  if (isNan(opacityValue)) {\r\n    return 1.0;\r\n  }\r\n\r\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\r\n    return u_vvOpacities[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\r\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\r\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\r\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvOpacities[VV_OPACITY_N - 1];\r\n}\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\nconst int VV_COLOR_N \x3d 8;\r\n\r\nvec4 getVVColor(float colorValue, vec4 fallback) {\r\n  if (isNan(colorValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\r\n    return u_vvColors[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\r\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\r\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvColors[VV_COLOR_N - 1];\r\n}\r\n#endif // VV_COLOR\r\n",
"vvUniforms.glsl":"#if defined(VV_COLOR)|| defined(VV_OPACITY)\r\nattribute highp vec4 a_vv;\r\n#endif // VV_COLOR || VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\nuniform highp float u_vvColorValues[8];\r\nuniform vec4 u_vvColors[8];\r\n#endif // VV_COLOR\r\n\r\n#ifdef VV_OPACITY\r\nuniform highp float u_vvOpacityValues[8];\r\nuniform float u_vvOpacities[8];\r\n#endif // VV_OPACITY\r\n"},icon:{"icon.frag":"precision mediump float;\r\n\r\nuniform lowp sampler2D u_texture;\r\n\r\nvarying lowp vec2 v_tex;\r\nvarying lowp float v_transparency;\r\nvarying mediump vec2 v_size;\r\nvarying lowp vec4 v_color;\r\n\r\n#ifdef SDF\r\nvarying lowp vec4 v_outlineColor;\r\nvarying mediump float v_outlineWidth;\r\n\r\n// we need the conversion function from RGBA to float\r\n#include \x3cutil/encoding.glsl\x3e\r\n#endif // SDF\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\nconst float softEdgeRatio \x3d 1.0; // use blur here if needed\r\n\r\nvoid main()\r\n{\r\n#ifdef SDF\r\n  lowp vec4 fillPixelColor \x3d v_color;\r\n\r\n  // calculate the distance from the edge [-0.5, 0.5]\r\n  float d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\r\n\r\n  // the soft edge ratio is about 1.5 pixels allocated for the soft edge.\r\n  float size \x3d max(v_size.x, v_size.y);\r\n  float dist \x3d d * size * softEdgeRatio;\r\n\r\n  // set the fragment's transparency according to the distance from the edge\r\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n  // count for the outline\r\n  // therefore tint the entire icon area.\r\n  if (v_outlineWidth \x3e 0.25) {\r\n    lowp vec4 outlinePixelColor \x3d v_outlineColor;\r\n\r\n    // outlines can't be larger than the size of the symbol\r\n    float clampedOutlineSize \x3d min(v_outlineWidth, size);\r\n\r\n    outlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\r\n\r\n    // finally combine the outline and the fill colors (outline draws on top of fill)\r\n    gl_FragColor \x3d v_transparency * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d v_transparency * fillPixelColor;\r\n  }\r\n#else // not an SDF\r\n   lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\r\n   gl_FragColor \x3d v_transparency * texColor;\r\n#endif // SDF\r\n\r\n#ifdef HIGHLIGHT\r\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\r\n#endif // HIGHLIGHT\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"icon.vert":"precision mediump float;\r\n\r\n//const float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\r\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\r\nconst vec2 SIGNED_BYTE_TO_UNSIGNED \x3d vec2(128.0);\r\n\r\n// per quad (instance) attributes (20 bytes \x3d\x3d\x3e equivalent of 5 bytes per vertex)\r\nattribute vec2 a_pos;\r\nattribute vec4 a_vertexOffsetAndTex;\r\nattribute vec4 a_id; // since we need to render the Id as a color we need to break it into RGBA components. so just like a color, the Id is normalized.\r\nattribute vec4 a_color;\r\nattribute vec4 a_outlineColor;\r\nattribute vec4 a_sizeAndOutlineWidth;\r\n\r\nattribute float a_visible; // a one byte controlling the visibility of the vertex (a separate visibility buffer), values are 0 or 1 (visible)\r\n\r\nuniform highp mat3 u_dvsMat3;\r\nuniform highp mat3 u_displayMat3;\r\n\r\n// the size of the mosaic given in pixels\r\nuniform vec2 u_mosaicSize;\r\n\r\n// the interpolated texture coordinate value to be used by the fragment shader in order to sample the sprite texture\r\nvarying mediump vec2 v_tex;\r\n// the calculated transparency to be applied by the fragment shader. It is incorporating both the fade as well as the\r\n// opacity of the layer given by the painter\r\nvarying lowp float v_transparency;\r\n// the of the icon given in pixels\r\nvarying mediump vec2 v_size;\r\n\r\n// icon color. If is a picture-marker it is used to tint the texture color\r\nvarying lowp vec4 v_color;\r\n\r\n#ifdef SDF\r\nvarying lowp vec4 v_outlineColor;\r\nvarying mediump float v_outlineWidth;\r\n#endif // SDF\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\n// import the VV inputs and functions (they are #ifdefed, so if the proper #define is not set it will end-up being a no-op)\r\n#include \x3cmaterials/icon/vvUniforms.glsl\x3e\r\n#include \x3cmaterials/icon/vvFunctions.glsl\x3e\r\n\r\nvoid main()\r\n{\r\n  vec2 a_offset \x3d a_vertexOffsetAndTex.xy;\r\n  vec2 a_tex \x3d a_vertexOffsetAndTex.zw + SIGNED_BYTE_TO_UNSIGNED; // offset to change from signed to unsigned byte\r\n  vec2 a_size \x3d a_sizeAndOutlineWidth.xy;\r\n\r\n  // default values (we need them for the variations to come)\r\n  float a_angle \x3d 0.0;\r\n  float delta_z \x3d 2.0 * (1.0 - a_visible);\r\n  float depth \x3d 0.0;\r\n  v_transparency \x3d 1.0;\r\n\r\n#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\n  // vv size override the original symbol's size\r\n  float h \x3d getVVMinMaxSize(a_vv.x, a_size.y);\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_SCALE_STOPS\r\n  float h \x3d u_vvSizeScaleStopsValue;\r\n#endif // VV_SIZE_SCALE_STOPS\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\n  float h \x3d getVVStopsSize(a_vv.x, a_size.y);\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\n  float h \x3d getVVUnitValue(a_vv.x, a_size.y);\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n  // make sure to preserve the aspect ratio of the symbol\r\n  vec2 size \x3d vec2(h * a_size.x / a_size.y, h);\r\n  vec3 offset \x3d vec3(a_offset * size / a_size, 0.0);\r\n  v_size \x3d size;\r\n#else\r\n  vec3 offset \x3d vec3(a_offset, 0.0);\r\n  v_size \x3d a_size;\r\n#endif // defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n#ifdef SDF\r\n  offset *\x3d 2.0;\r\n#endif // SDF\r\n\r\n\r\n#ifdef VV_ROTATION\r\n  // If we have a rotation VV, we need to rotate our offset\r\n  offset \x3d u_displayMat3 * getVVRotationMat3(a_vv.w) * offset;\r\n#else\r\n  offset \x3d u_displayMat3 * offset;\r\n#endif // VV_ROTATION\r\n  vec3 pos \x3d u_dvsMat3 * vec3(a_pos, 1.0) + offset;\r\n\r\n  gl_Position \x3d vec4(pos.xy, delta_z, 1.0);\r\n\r\n#ifdef VV_OPACITY\r\n  v_transparency \x3d getVVOpacity(a_vv.z);\r\n#else\r\n  v_transparency \x3d 1.0;\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\n  v_color \x3d getVVColor(a_vv.y, a_color);\r\n#else\r\n  v_color \x3d a_color;\r\n#endif // VV_COLOR\r\n\r\n  // output the texture coordinates and the transparency\r\n  v_tex \x3d a_tex / u_mosaicSize;\r\n\r\n#ifdef SDF\r\n  v_outlineColor \x3d a_outlineColor;\r\n  // YF: in practice v_size.x and v_size.y are identical since we're mostly dealing with sms\r\n  v_outlineWidth \x3d min(a_sizeAndOutlineWidth.z, max(v_size.x - 0.99, 0.0));\r\n#endif // SDF\r\n\r\n#ifdef ID\r\n  v_id \x3d a_id;\r\n#endif // ID\r\n}\r\n",
"vvFunctions.glsl":"const highp float nanValue \x3d 1e-30;\r\n\r\nbool isNan(float val) {\r\n  return (val \x3d\x3d nanValue);\r\n  //return !( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 );\r\n}\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  // we need to multiply by 8 in order to translate to tile coordinates\r\n  float interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\r\n  interpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\r\n  return u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z);\r\n}\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nconst int VV_SIZE_N \x3d 6;\r\nfloat getVVStopsSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\r\n    return u_vvSizeFieldStopsSizes[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\r\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\r\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\r\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\r\n}\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nfloat getVVUnitValue(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\r\n}\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nconst int VV_OPACITY_N \x3d 8;\r\nfloat getVVOpacity(float opacityValue) {\r\n  if (isNan(opacityValue)) {\r\n    return 1.0;\r\n  }\r\n\r\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\r\n    return u_vvOpacities[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\r\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\r\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\r\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvOpacities[VV_OPACITY_N - 1];\r\n}\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_ROTATION\r\nmat4 getVVRotation(float rotationValue) {\r\n  // YF TODO: if the symbol has rotation we need to combine the symbo's rotation with the VV one\r\n  if (isNan(rotationValue)) {\r\n    return mat4(1, 0, 0, 0,\r\n                0, 1, 0, 0,\r\n                0, 0, 1, 0,\r\n                0, 0, 0, 1);\r\n  }\r\n\r\n  float rotation \x3d rotationValue;\r\n  if (u_vvRotationType \x3d\x3d 1.0) {\r\n    rotation \x3d 90.0 - rotation;\r\n  }\r\n\r\n  float angle \x3d C_DEG_TO_RAD * rotation;\r\n\r\n  float sinA \x3d sin(angle);\r\n  float cosA \x3d cos(angle);\r\n\r\n  return mat4(cosA, sinA, 0, 0,\r\n              -sinA,  cosA, 0, 0,\r\n              0,     0, 1, 0,\r\n              0,     0, 0, 1);\r\n}\r\n\r\nmat3 getVVRotationMat3(float rotationValue) {\r\n  // YF TODO: if the symbol has rotation we need to combine the symbo's rotation with the VV one\r\n  if (isNan(rotationValue)) {\r\n    return mat3(1, 0, 0,\r\n                0, 1, 0,\r\n                0, 0, 1);\r\n  }\r\n\r\n  float rotation \x3d rotationValue;\r\n  if (u_vvRotationType \x3d\x3d 1.0) {\r\n    rotation \x3d 90.0 - rotation;\r\n  }\r\n\r\n  float angle \x3d C_DEG_TO_RAD * -rotation;\r\n\r\n  float sinA \x3d sin(angle);\r\n  float cosA \x3d cos(angle);\r\n\r\n  return mat3(cosA, -sinA, 0,\r\n             sinA, cosA, 0,\r\n              0,    0,    1);\r\n}\r\n#endif // VV_ROTATION\r\n\r\n#ifdef VV_COLOR\r\nconst int VV_COLOR_N \x3d 8;\r\n\r\nvec4 getVVColor(float colorValue, vec4 fallback) {\r\n  if (isNan(colorValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\r\n    return u_vvColors[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\r\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\r\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvColors[VV_COLOR_N - 1];\r\n}\r\n#endif // VV_COLOR\r\n",
"vvUniforms.glsl":"#if defined(VV_COLOR) || defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE) || defined(VV_OPACITY) || defined(VV_ROTATION)\r\nattribute highp vec4 a_vv;\r\n#endif // VV_COLOR || VV_SIZE_MIN_MAX_VALUE || VV_SIZE_SCALE_STOPS || VV_SIZE_FIELD_STOPS || VV_SIZE_UNIT_VALUE || VV_OPACITY || VV_ROTATION\r\n\r\n#ifdef VV_COLOR\r\nuniform highp float u_vvColorValues[8];\r\nuniform vec4 u_vvColors[8];\r\n#endif // VV_COLOR\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nuniform highp vec4 u_vvSizeMinMaxValue;\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_SCALE_STOPS\r\nuniform highp float u_vvSizeScaleStopsValue;\r\n#endif // VV_SIZE_SCALE_STOPS\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nuniform highp float u_vvSizeFieldStopsValues[6];\r\nuniform float u_vvSizeFieldStopsSizes[6];\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nuniform highp float u_vvSizeUnitValueWorldToPixelsRatio;\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nuniform highp float u_vvOpacityValues[8];\r\nuniform float u_vvOpacities[8];\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_ROTATION\r\nuniform lowp float u_vvRotationType;\r\n#endif // VV_ROTATION\r\n"},
label:{"label.frag":"precision lowp float;\r\n\r\nuniform mediump sampler2D u_referenceTex;\r\nuniform mediump vec2 u_screenSize;\r\nuniform mediump float u_pixelRatio;\r\n\r\nvarying mediump float v_antialiasingWidth;\r\nvarying mediump float v_edgeDistanceOffset;\r\nvarying mediump vec2 v_tex;\r\n\r\n#ifdef ID\r\nvarying mediump float v_fadeStep;\r\n#else\r\nuniform lowp sampler2D u_texture;\r\nvarying mediump vec4 v_color;\r\n#endif // ID\r\n\r\nconst vec3 epsilon \x3d vec3(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\r\n\r\nvoid main()\r\n{\r\n  mediump vec2 refTextPos \x3d gl_FragCoord.xy / (u_pixelRatio * u_screenSize.xy);\r\n  mediump vec4 referenceFragment \x3d texture2D(u_referenceTex, refTextPos);\r\n#ifdef ID\r\n  mediump float alpha \x3d clamp(referenceFragment.a + v_fadeStep, 0.0, 1.0);\r\n  // fill the whole quad\r\n  gl_FragColor \x3d vec4(alpha);\r\n#else\r\n  // read the fade alpha\r\n  lowp float fadeAlpha \x3d referenceFragment.a;\r\n\r\n  // read the distance from the SDF texture\r\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\r\n\r\n  // the edge distance if a factor of the outline width\r\n  // We cap this to 0.25 to prevent this from becomming negative / running into the glyph boundaries\r\n  float glyphEdgeDistance \x3d max(0.75 - v_edgeDistanceOffset, 0.25);\r\n\r\n  // use a smooth-step in order to calculate the geometry of the shape given by the distance field\r\n  lowp float sdfAlpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist);\r\n\r\n  gl_FragColor \x3d fadeAlpha * sdfAlpha * v_color;\r\n#endif\r\n}\r\n",
"label.vert":"precision mediump float;\r\n\r\nattribute vec2 a_pos;                  // 2 * 2 (2 x signed 16)\r\nattribute vec4 a_color;                // 4 (4 x unsigned byte)\r\nattribute vec2 a_vertexOffset;         // 2 * 2 // (2 x signed 16) offset from the anchor point of the string\r\nattribute vec4 a_texAndSize;          // 4 (4 x unsigned byte) texture coordinatesm and font size. w is for the halo size\r\nattribute vec4 a_refSymbolAndPlacementOffset; // 4 (4 x unsigned byte) the offset of the reference symbol of the feature (x,y) and the placement offset (z, w) all given in pixels\r\nattribute float a_vvSize;\r\n\r\nattribute lowp float  a_visible; // a one byte controlling the visibility of the vertex (a separate visibility buffer), values are 0 or 1 (visible)\r\n\r\nattribute mediump vec2 a_visibilityRange; // 2 x unsigned byte;\r\n\r\n// T: TileCoords -\x3e DisplayCoords\r\n// Premultiplies DisplayMat3 * ViewMat3 * ScreenMat3\r\nuniform highp mat3 u_dvsMat3;\r\nuniform highp mat3 u_displayMat3;\r\n\r\n\r\nuniform float u_mapRotation;\r\nuniform float u_mapAligned;\r\n\r\nuniform vec2 u_mosaicSize;\r\nuniform float u_pixelRatio;\r\n\r\n// the curent zoom\r\nuniform mediump float u_zoomLevel; // the current zoom level X 10\r\n\r\nvarying mediump float v_antialiasingWidth;\r\nvarying mediump float v_edgeDistanceOffset;\r\n\r\n// the interpolated texture coordinate value to be used by the fragment shader in order to sample the sprite texture\r\nvarying mediump vec2 v_tex;\r\n\r\n#ifdef ID\r\nuniform mediump float u_fadeStep;\r\nvarying mediump float v_fadeStep;\r\n#else\r\nvarying mediump vec4 v_color;\r\n#endif // ID\r\n\r\n// the vertex offsets are given in integers, therefore in order to maintain a reasonable precission we multiply the values\r\n// by 16 and then at the shader devide by the same number\r\nconst float offsetPrecision \x3d 1.0 / 8.0;\r\nconst float outlineScale \x3d 1.0 / 5.0;\r\nconst float sdfFontSize \x3d 24.0;\r\n\r\n// maximum SDF distance of 8 pixels represent the distance values that range from -2 inside the geometry to 6 on the outside.\r\n// 6 is actually the maximum distance outside the glyph, therefore it is the limitation of the halo which is 1/4 of the geometry size.\r\nconst float maxSdfDistance \x3d 8.0;\r\n\r\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\r\nconst float PLACEMENT_PADDING \x3d 8.0;\r\n\r\n#include \x3cmaterials/icon/vvUniforms.glsl\x3e\r\n#include \x3cmaterials/icon/vvFunctions.glsl\x3e\r\n\r\nvoid main()\r\n{\r\n  float refSymbolSize \x3d a_refSymbolAndPlacementOffset.y;\r\n    \r\n#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n  #ifdef VV_SIZE_MIN_MAX_VALUE\r\n    // vv size override the original symbol's size\r\n    float h \x3d getVVMinMaxSize(a_vvSize, refSymbolSize);\r\n  #endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n  #ifdef VV_SIZE_SCALE_STOPS\r\n    float h \x3d u_vvSizeScaleStopsValue;\r\n  #endif // VV_SIZE_SCALE_STOPS\r\n\r\n  #ifdef VV_SIZE_FIELD_STOPS\r\n    float h \x3d getVVStopsSize(a_vvSize, refSymbolSize);\r\n  #endif // VV_SIZE_FIELD_STOPS\r\n\r\n  #ifdef VV_SIZE_UNIT_VALUE\r\n    float h \x3d getVVUnitValue(a_vvSize, refSymbolSize);\r\n  #endif // VV_SIZE_UNIT_VALUE\r\n    // make sure to preserve the aspect ratio of the symbol\r\n    float halfSize \x3d h / 2.0;\r\n#else\r\n    float halfSize \x3d refSymbolSize / 2.0;\r\n#endif // defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n  // make sure to clip the vertices in case that given record is marked as invisible\r\n  float z \x3d 2.0 * (1.0 - a_visible);\r\n  float glyphAngle \x3d a_refSymbolAndPlacementOffset.x * 360.0 / 254.0;\r\n  float mapAngle \x3d u_mapRotation * 360.0 / 254.0;\r\n  float diffAngle \x3d min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\r\n  \r\n  // make sure range is inclusive\r\n  z +\x3d 2.0 * (1.0 - step(a_visibilityRange.x, u_zoomLevel));\r\n  z +\x3d 2.0 * (1.0 - step(u_zoomLevel, a_visibilityRange.y));\r\n  z +\x3d 2.0 * u_mapAligned * step(90.0, diffAngle); \r\n\r\n  // encoded as dir + 1.0\r\n  vec2 placementDir \x3d a_refSymbolAndPlacementOffset.zw - 1.0; \r\n  \r\n  // we use the list significant bit of the position in order to store the indication\r\n  // whether the vertex is of a halow of a glyph\r\n  mediump float halo \x3d mod(a_pos, 2.0).x;\r\n  vec3 pos \x3d vec3(floor(a_pos * 0.5), 1.0);\r\n\r\n  float fontSize \x3d a_texAndSize.z;\r\n  float fontScale \x3d fontSize / sdfFontSize;\r\n\r\n  vec2 vertexOffset \x3d offsetPrecision * a_vertexOffset;\r\n  vec2 placementOffset \x3d placementDir * (halfSize + PLACEMENT_PADDING);\r\n  vec3 glyphOffset \x3d u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\r\n  vec3 v_pos \x3d u_dvsMat3 * pos + glyphOffset;\r\n\r\n  gl_Position \x3d vec4(v_pos.xy, z, 1.0);\r\n\r\n  v_tex \x3d a_texAndSize.xy / u_mosaicSize;\r\n  v_antialiasingWidth \x3d 0.106 * sdfFontSize / fontSize / u_pixelRatio;\r\n  // if halo.x is zero (not a halo) v_edgeDistanceOffset will end up being zero as well.\r\n  v_edgeDistanceOffset \x3d halo * outlineScale * a_texAndSize.w / fontScale / maxSdfDistance;\r\n\r\n#ifdef ID\r\n  v_fadeStep \x3d u_fadeStep;\r\n#else\r\n  v_color \x3d a_color;\r\n  // Enable this code to visualize hidden glyphs\r\n  // float a \x3d 1.0;\r\n  // if (z !\x3d 0.0)  {\r\n  //   a \x3d 0.645;\r\n  // }\r\n  // v_color \x3d vec4(a_color.rgb, a);\r\n#endif // ID\r\n}\r\n"},
line:{"constants.glsl":"const float thinLineHalfWidth \x3d 1.0; // meaning that a 2 pixels line width is considered a thin line\r\nconst float thinLineWidthFactor \x3d 1.1;\r\n","line.frag":"precision lowp float;\r\n\r\nuniform lowp float u_blur;\r\nuniform mediump float u_antialiasing;\r\n\r\nvarying mediump vec2 v_normal;\r\nvarying mediump float v_lineHalfWidth;\r\nvarying lowp vec4 v_color;\r\nvarying lowp float v_transparency;\r\n\r\n#if defined(PATTERN) || defined(SDF)\r\nuniform sampler2D u_texture;\r\nuniform mediump float u_zoomFactor;\r\n\r\nvarying mediump vec4 v_tlbr; // normalized pattern coordinates [0, 1]\r\nvarying mediump vec2 v_patternSize;\r\nvarying highp float v_accumulatedDistance;\r\n#endif // PATTERN SDF\r\n\r\n#ifdef SDF\r\nconst float sdfPatternHalfWidth \x3d 15.5; // YF: assumed that the width will be set to 31\r\nconst float widthFactor \x3d 2.0;\r\n\r\n// we need the conversion function from RGBA to float\r\n#include \x3cutil/encoding.glsl\x3e\r\n#endif // SDF\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\n// include the thin line parameters (thinLineHalfWidth and thinLineWidthFactor)\r\n#include \x3cmaterials/line/constants.glsl\x3e\r\n\r\nvoid main()\r\n{\r\n  // for now assume that a thin line is a line which is under 2 pixels (1 pixels on either sides of the centerline)\r\n  mediump float thinLineFactor \x3d max(thinLineWidthFactor * step(v_lineHalfWidth, thinLineHalfWidth), 1.0);\r\n\r\n  // dist represent the distance of the fragment from the line. 1.0 or -1.0 will be the values on the edge of the line,\r\n  // and any value in between will be inside the line (the sign represent the direction - right or left).\r\n  // since u_linewidth.s (half line width) is represented in pixels, dist is also given in pixels\r\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\r\n\r\n  // calculate the alpha given the difference between the line-width and the distance of the fragment from the center-line.\r\n  // when it is a thin line then use a slightly shallower slope in order to add more feathering\r\n  lowp float alpha \x3d clamp(thinLineFactor * (v_lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\r\n\r\n#if defined(SDF)\r\n  mediump float lineHalfWidth \x3d widthFactor * v_lineHalfWidth;\r\n  mediump float lineWidthRatio \x3d lineHalfWidth / sdfPatternHalfWidth;\r\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * lineHalfWidth) / (lineWidthRatio * v_patternSize.x), 1.0);\r\n  mediump float relativeTexY \x3d 0.5 + 0.5 * v_normal.y;\r\n\r\n  // claculate the actual texture coordinates by interpolating between the TL/BR pattern coordinates\r\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\r\n\r\n  // calculate the distance from the edge [-0.5, 0.5]\r\n  mediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\r\n\r\n  // the distance is a proportional to the line width\r\n  float dist \x3d d * lineHalfWidth;\r\n\r\n  lowp vec4 fillPixelColor \x3d v_transparency * alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\r\n  gl_FragColor \x3d fillPixelColor;\r\n#elif defined(PATTERN)\r\n  // we need to calculate the relative portion of the line texture along the line given the accumulated distance along the line\r\n  // The computed value should is anumber btween 0 and 1 which will later be used to interpolate btween the BR and TL values\r\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * v_lineHalfWidth) / v_patternSize.x, 1.0);\r\n\r\n  // in order to calculate the texture coordinates prependicular to the line (Y axis), we use the interpolated normal values\r\n  // which range from -1.0 to 1.0. On the line's centerline, the value of the interpolated normal is 0.0, however the relative\r\n  // texture value shpould be 0.5 (given that at the bottom of the line, the texture coordinate must be equal to 0.0)\r\n  // (TL) ---------------------------      --\x3e left edge of line. Interpolatedf normal is 1.0\r\n  //              | -\x3e line-width / 2\r\n  //      - - - - - - - - - - - - - -\r\n  //              | -\x3e line-width / 2\r\n  //      ---------------------------- (BR)--\x3e right edge of line. Interpolatedf normal is -1.0\r\n\r\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / v_patternSize.y);\r\n\r\n  // claculate the actual texture coordinates by interpolating between the TL/BR pattern coordinates\r\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\r\n\r\n  // get the color from the texture\r\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\r\n\r\n  gl_FragColor \x3d v_transparency * alpha * v_color * color;\r\n#else // solid line (no texture, no pattern)\r\n  // output the fragment color\r\n  gl_FragColor \x3d v_transparency * alpha * v_color;\r\n#endif // SDF\r\n\r\n#ifdef HIGHLIGHT\r\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\r\n#endif // HIGHLIGHT\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"line.vert":"precision mediump float;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_id;\r\nattribute vec4 a_color;\r\nattribute vec4 a_offsetAndNormal;\r\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\r\nattribute vec4 a_tlbr;\r\nattribute vec4 a_segmentDirection;\r\n\r\nattribute float  a_visible; // a one byte controlling the visibility of the vertex (a separate visibility buffer), values are 0 or 1 (visible)\r\n\r\n// T: TileCoords -\x3e DisplayCoords\r\n// Premultiplies DisplayMat3 * ViewMat3 * ScreenMat3\r\nuniform highp mat3 u_dvsMat3;\r\n// T: ScreenCoords -\x3e DisplayCoords\r\n// Premultiplies DisplayMat3 * ViewMat3\r\nuniform highp mat3 u_dvMat3;\r\n\r\nuniform mediump float u_zoomFactor;\r\nuniform mediump float u_antialiasing;\r\n\r\n// the interpolated normal to the line. the information is packed into the two LSBs of the vertex coordinate\r\nvarying mediump vec2 v_normal;\r\nvarying mediump float v_lineHalfWidth;\r\nvarying lowp vec4 v_color;\r\nvarying lowp float v_transparency;\r\n\r\nconst float scale \x3d 1.0 / 31.0;\r\n#ifdef SDF\r\nconst float widthFactor \x3d 2.0;\r\n#else\r\nconst float widthFactor \x3d 1.0;\r\n#endif\r\n\r\n\r\n#ifdef PATTERN\r\nuniform mediump vec2 u_mosaicSize;\r\n\r\nvarying mediump vec4 v_tlbr; // normalized pattern coordinates [0, 1]\r\nvarying mediump vec2 v_patternSize;\r\n#endif // PATTERN\r\n\r\n// we need to accumulated distance only if it is a pattern or an SDF line\r\n#if defined(PATTERN) || defined(SDF)\r\nvarying highp float v_accumulatedDistance;\r\n#endif // PATTERN SDF\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\n// import the VV inputs and functions (they are #ifdefed, so if the proper #define is not set it will end-up being a no-op)\r\n#include \x3cmaterials/line/vvUniforms.glsl\x3e\r\n#include \x3cmaterials/line/vvFunctions.glsl\x3e\r\n\r\n// include the thin line parameters (thinLineHalfWidth and thinLineWidthFactor)\r\n#include \x3cmaterials/line/constants.glsl\x3e\r\n\r\nvoid main()\r\n{\r\n// size VV block\r\n#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\n  mediump float lineHalfWidth \x3d 0.5 * getVVMinMaxSize(a_vv.x, 2.0 * a_accumulatedDistanceAndHalfWidth.y * scale);\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_SCALE_STOPS\r\n  mediump float lineHalfWidth \x3d 0.5 * u_vvSizeScaleStopsValue;\r\n#endif // VV_SIZE_SCALE_STOPS\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\n  mediump float lineHalfWidth \x3d 0.5 * getVVStopsSize(a_vv.x, 2.0 * a_accumulatedDistanceAndHalfWidth.y * scale);\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\n  mediump float lineHalfWidth \x3d 0.5 * getVVUnitValue(a_vv.x, 2.0 * a_accumulatedDistanceAndHalfWidth.y * scale);\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#else // no VV\r\n  mediump float lineHalfWidth \x3d a_accumulatedDistanceAndHalfWidth.y * scale;\r\n#endif // defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n#ifdef VV_OPACITY\r\nv_transparency \x3d getVVOpacity(a_vv.z);\r\n#else\r\nv_transparency \x3d 1.0;\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\nv_color \x3d getVVColor(a_vv.y, a_color);\r\n#else\r\nv_color \x3d a_color;\r\n#endif // VV_COLOR\r\n\r\n  // make sure to clip the vertices in case that the width of the line is 0 (or negative),\r\n  // or in case that the line is not visible\r\n  float z \x3d 2.0 * (step(lineHalfWidth, 0.0) + (1.0 - a_visible));\r\n\r\n  // add an antialiasing distance. We use 0.2 rather than 0.5 in order to match the SVG renderer\r\n  // also limit the total line width to 1.3 pixels. Below this value lines don't look good compared\r\n  // to the SVG renderer\r\n  lineHalfWidth \x3d max(lineHalfWidth, 0.45) + 0.2 * u_antialiasing;\r\n\r\n  // for now assume that a thin line is a line which is under 2 pixels (1 pixels on either sides\r\n  // of the centerline) in practice, a thin line is a line who's half width vary from 0.45px to\r\n  // the value of thinLineHalfWidth, as the value is claped in line 221 above\r\n  mediump float thinLineFactor \x3d max(thinLineWidthFactor * step(lineHalfWidth, thinLineHalfWidth), 1.0);\r\n\r\n  v_lineHalfWidth \x3d lineHalfWidth;\r\n\r\n  // calculate the relative distance from the centerline to the edge of the line. Since offset is\r\n  // given in integers (for the sake of using less attribute memory, we need to scale it back to\r\n  // the original range of ~ [0, 1]) in a case of a thin line we move each vertex twice as far\r\n  mediump vec2 dist \x3d thinLineFactor * widthFactor * lineHalfWidth * a_offsetAndNormal.xy * scale;\r\n\r\n  vec3 offset \x3d u_dvMat3 * vec3(dist, 0.0);\r\n  vec3 v_pos \x3d u_dvsMat3 * vec3(a_pos.xy, 1.0) + offset;\r\n\r\n  gl_Position \x3d vec4(v_pos.xy, z, 1.0);\r\n\r\n  v_normal \x3d a_offsetAndNormal.zw * scale;\r\n\r\n#if defined(PATTERN) || defined(SDF)\r\n  v_accumulatedDistance \x3d a_accumulatedDistanceAndHalfWidth.x + dot(scale * a_segmentDirection.xy, dist / u_zoomFactor);\r\n#endif // PATTERN || SDF\r\n\r\n#ifdef PATTERN\r\nv_tlbr \x3d vec4(a_tlbr.x / u_mosaicSize.x, a_tlbr.y / u_mosaicSize.y, a_tlbr.z / u_mosaicSize.x, a_tlbr.w / u_mosaicSize.y);\r\nv_patternSize \x3d vec2(a_tlbr.z - a_tlbr.x, a_tlbr.w - a_tlbr.y);\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\nv_id \x3d a_id;\r\n#endif // ID\r\n}\r\n",
"vvFunctions.glsl":"const highp float nanValue \x3d 1e-30;\r\n\r\nbool isNan(float val) {\r\n  return (val \x3d\x3d nanValue);\r\n  //return !( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 );\r\n}\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  float f \x3d (sizeValue - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\r\n  return clamp(mix(u_vvSizeMinMaxValue.z, u_vvSizeMinMaxValue.w, f), u_vvSizeMinMaxValue.z, u_vvSizeMinMaxValue.w);\r\n}\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nconst int VV_SIZE_N \x3d 6;\r\nfloat getVVStopsSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\r\n    return u_vvSizeFieldStopsSizes[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\r\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\r\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\r\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\r\n}\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nfloat getVVUnitValue(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\r\n}\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nconst int VV_OPACITY_N \x3d 8;\r\nfloat getVVOpacity(float opacityValue) {\r\n  if (isNan(opacityValue)) {\r\n    return 1.0;\r\n  }\r\n\r\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\r\n    return u_vvOpacities[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\r\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\r\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\r\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvOpacities[VV_OPACITY_N - 1];\r\n}\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\nconst int VV_COLOR_N \x3d 8;\r\n\r\nvec4 getVVColor(float colorValue, vec4 fallback) {\r\n  if (isNan(colorValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\r\n    return u_vvColors[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\r\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\r\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvColors[VV_COLOR_N - 1];\r\n}\r\n#endif // VV_COLOR\r\n",
"vvUniforms.glsl":"#if defined(VV_COLOR) || defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE) || defined(VV_OPACITY)\r\nattribute highp vec3 a_vv;\r\n#endif // VV_COLOR || VV_SIZE_MIN_MAX_VALUE || VV_SIZE_SCALE_STOPS || VV_SIZE_FIELD_STOPS || VV_SIZE_UNIT_VALUE || VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\nuniform highp float u_vvColorValues[8];\r\nuniform vec4 u_vvColors[8];\r\n#endif // VV_COLOR\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nuniform highp vec4 u_vvSizeMinMaxValue;\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_SCALE_STOPS\r\nuniform highp float u_vvSizeScaleStopsValue;\r\n#endif\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nuniform highp float u_vvSizeFieldStopsValues[6];\r\nuniform float u_vvSizeFieldStopsSizes[6];\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nuniform float u_vvSizeUnitValueWorldToPixelsRatio;\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nuniform highp float u_vvOpacityValues[8];\r\nuniform float u_vvOpacities[8];\r\n#endif // VV_OPACITY\r\n"},
text:{"text.frag":"precision lowp float;\r\n\r\nuniform lowp sampler2D u_texture;\r\n\r\nvarying mediump vec4 v_color;\r\nvarying mediump float v_antialiasingWidth;\r\nvarying mediump float v_edgeDistanceOffset;\r\nvarying mediump vec2 v_tex;\r\nvarying lowp float v_transparency;\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\nvoid main()\r\n{\r\n  // read the distance from the SDF texture\r\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\r\n\r\n  // the edge distance if a factor of the outline width\r\n  // We cap this to 0.25 to prevent this from becomming negative / running into the glyph boundaries\r\n  float glyphEdgeDistance \x3d max(0.75 - v_edgeDistanceOffset, 0.25);\r\n  \r\n  // use a smooth-step in order to calculate the geometry of the shape given by the distance field\r\n  lowp float alpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist) * v_transparency;\r\n\r\n  gl_FragColor \x3d alpha * v_color;\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"text.vert":"precision mediump float;\r\n\r\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\r\n\r\nattribute vec2 a_pos;           // 2 * 2 (2 x signed 16)\r\nattribute vec4 a_id;            // 4 (4 x unsigned byte)\r\nattribute vec4 a_color;         // 4 (4 x unsigned byte)\r\nattribute vec2 a_vertexOffset; // 2 * 2 // (2 x signed 16) offset from the anchor point of the string\r\nattribute vec4 a_texFontSize; // 4 (4 x unsigned byte) texture coordinatesm and font size\r\n\r\nattribute lowp float  a_visible; // a one byte controlling the visibility of the vertex (a separate visibility buffer), values are 0 or 1 (visible)\r\n\r\nuniform vec2 u_mosaicSize;\r\nuniform float u_pixelRatio;\r\n\r\n// T: TileCoords -\x3e DisplayCoords\r\n// Premultiplies DisplayMat3 * ViewMat3 * ScreenMat3\r\nuniform highp mat3 u_dvsMat3;\r\nuniform highp mat3 u_displayMat3;\r\n\r\nvarying mediump vec4 v_color;\r\nvarying mediump float v_antialiasingWidth;\r\nvarying mediump float v_edgeDistanceOffset;\r\n\r\n// the interpolated texture coordinate value to be used by the fragment shader in order to sample the sprite texture\r\nvarying mediump vec2 v_tex;\r\n// the calculated transparency to be applied by the fragment shader. It is incorporating both the fade as well as the\r\n// opacity of the layer given by the painter\r\nvarying lowp float v_transparency;\r\n\r\n// the vertex offsets are given in integers, therefore in order to maintain a reasonable precission we multiply the values\r\n// by 16 and then at the shader devide by the same number\r\nconst float offsetPrecision \x3d 1.0 / 8.0;\r\nconst float outlineScale \x3d 1.0 / 5.0;\r\nconst float sdfFontSize \x3d 24.0;\r\n\r\n// maximum SDF distance of 8 pixels represent the distance values that range from -2 inside the geometry to 6 on the outside.\r\n// 6 is actually the maximum distance outside the glyph, therefore it is the limitation of the halo which is 1/4 of the geometry size.\r\nconst float maxSdfDistance \x3d 8.0;\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\n// import the VV inputs and functions (they are #ifdefed, so if the proper #define is not set it will end-up being a no-op)\r\n#include \x3cmaterials/text/vvUniforms.glsl\x3e\r\n#include \x3cmaterials/text/vvFunctions.glsl\x3e\r\n\r\nvoid main()\r\n{\r\n  // make sure to clip the vertices in case that given record is marked as invisible\r\n  float z \x3d 2.0 * (1.0 - a_visible);\r\n\r\n  // we use the list significant bit of the position in order to store the indication whethe the vertex is of a halow of a glyph\r\n  mediump float halo \x3d mod(a_pos, 2.0).x;\r\n\r\n  float fontSize \x3d a_texFontSize.z;\r\n  float scale \x3d 1.0;\r\n\r\n#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n  #ifdef VV_SIZE_MIN_MAX_VALUE\r\n    // vv size override the original symbol's size\r\n    vec2 size \x3d vec2(getVVMinMaxSize(a_vv.x, a_texFontSize.z));\r\n  #endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n  #ifdef VV_SIZE_SCALE_STOPS\r\n    vec2 size \x3d vec2(u_vvSizeScaleStopsValue);\r\n  #endif // VV_SIZE_SCALE_STOPS\r\n\r\n  #ifdef VV_SIZE_FIELD_STOPS\r\n    vec2 size \x3d vec2(getVVStopsSize(a_vv.x, a_texFontSize.z));\r\n  #endif // VV_SIZE_FIELD_STOPS\r\n\r\n  #ifdef VV_SIZE_UNIT_VALUE\r\n    vec2 size \x3d vec2(getVVUnitValue(a_vv.x, a_texFontSize.z));\r\n  #endif // VV_SIZE_UNIT_VALUE\r\n\r\n    scale \x3d size.x / fontSize;\r\n    fontSize \x3d size.x;\r\n\r\n#endif // defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n  float fontScale \x3d fontSize / sdfFontSize;\r\n  vec3 pos \x3d vec3(floor(a_pos * 0.5), 1.0);\r\n  vec3 offset \x3d vec3(offsetPrecision * a_vertexOffset * scale, 0.0);\r\n\r\n#ifdef VV_ROTATION\r\n  vec3 glyphOffset \x3d u_displayMat3 * getVVRotationMat3(a_vv.w) * offset;\r\n#else\r\n  vec3 glyphOffset \x3d u_displayMat3 * offset;\r\n#endif // VV_ROTATION\r\n\r\n  vec3 v_pos \x3d u_dvsMat3 * pos + glyphOffset;\r\n  gl_Position \x3d vec4(v_pos.xy, z, 1.0);\r\n\r\n\r\n  v_tex \x3d a_texFontSize.xy / u_mosaicSize;\r\n  v_antialiasingWidth \x3d 0.105 * sdfFontSize / fontSize / u_pixelRatio;\r\n  // if halo.x is zero (not a halo) v_edgeDistanceOffset will end up being zero as well.\r\n  v_edgeDistanceOffset \x3d halo * outlineScale * a_texFontSize.w / fontScale / maxSdfDistance;\r\n\r\n#ifdef VV_OPACITY\r\n  v_transparency \x3d getVVOpacity(a_vv.z);\r\n#else\r\n  v_transparency \x3d 1.0;\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\n  // we don't want to override the halo color\r\n  v_color \x3d halo * a_color + (1.0 - halo) * getVVColor(a_vv.y, a_color);\r\n#else\r\n  v_color \x3d a_color;\r\n#endif // VV_COLOR\r\n\r\n#ifdef ID\r\n  v_id \x3d a_id;\r\n#endif // ID\r\n}\r\n",
"vvFunctions.glsl":"const highp float nanValue \x3d 1e-30;\r\n\r\nbool isNan(float val) {\r\n  return (val \x3d\x3d nanValue);\r\n  //return !( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 );\r\n}\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  // we need to multiply by 8 in order to translate to tile coordinates\r\n  float interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\r\n  return clamp(u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z), u_vvSizeMinMaxValue.z, u_vvSizeMinMaxValue.w);\r\n}\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nconst int VV_SIZE_N \x3d 6;\r\nfloat getVVStopsSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\r\n    return u_vvSizeFieldStopsSizes[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\r\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\r\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\r\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\r\n}\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nfloat getVVUnitValue(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\r\n}\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nconst int VV_OPACITY_N \x3d 8;\r\nfloat getVVOpacity(float opacityValue) {\r\n  if (isNan(opacityValue)) {\r\n    return 1.0;\r\n  }\r\n\r\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\r\n    return u_vvOpacities[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\r\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\r\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\r\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvOpacities[VV_OPACITY_N - 1];\r\n}\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_ROTATION\r\nmat4 getVVRotation(float rotationValue) {\r\n  // YF TODO: if the symbol has rotation we need to combine the symbo's rotation with the VV one\r\n  if (isNan(rotationValue)) {\r\n    return mat4(1, 0, 0, 0,\r\n                0, 1, 0, 0,\r\n                0, 0, 1, 0,\r\n                0, 0, 0, 1);\r\n  }\r\n\r\n  float rotation \x3d rotationValue;\r\n  if (u_vvRotationType \x3d\x3d 1.0) {\r\n    rotation \x3d 90.0 - rotation;\r\n  }\r\n\r\n  float angle \x3d C_DEG_TO_RAD * rotation;\r\n\r\n  float sinA \x3d sin(angle);\r\n  float cosA \x3d cos(angle);\r\n\r\n  return mat4(cosA, sinA, 0, 0,\r\n              -sinA,  cosA, 0, 0,\r\n              0,     0, 1, 0,\r\n              0,     0, 0, 1);\r\n}\r\n\r\nmat3 getVVRotationMat3(float rotationValue) {\r\n  // YF TODO: if the symbol has rotation we need to combine the symbo's rotation with the VV one\r\n  if (isNan(rotationValue)) {\r\n    return mat3(1, 0, 0,\r\n                0, 1, 0,\r\n                0, 0, 1);\r\n  }\r\n\r\n  float rotation \x3d rotationValue;\r\n  if (u_vvRotationType \x3d\x3d 1.0) {\r\n    rotation \x3d 90.0 - rotation;\r\n  }\r\n\r\n  float angle \x3d C_DEG_TO_RAD * -rotation;\r\n\r\n  float sinA \x3d sin(angle);\r\n  float cosA \x3d cos(angle);\r\n\r\n  return mat3(cosA, -sinA, 0,\r\n             sinA, cosA, 0,\r\n              0,    0,    1);\r\n}\r\n\r\n#endif // VV_ROTATION\r\n\r\n#ifdef VV_COLOR\r\nconst int VV_COLOR_N \x3d 8;\r\n\r\nvec4 getVVColor(float colorValue, vec4 fallback) {\r\n  if (isNan(colorValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\r\n    return u_vvColors[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\r\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\r\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvColors[VV_COLOR_N - 1];\r\n}\r\n#endif // VV_COLOR\r\n",
"vvUniforms.glsl":"#if defined(VV_COLOR) || defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE) || defined(VV_OPACITY) || defined(VV_ROTATION)\r\nattribute highp vec4 a_vv;\r\n#endif // VV_COLOR || VV_SIZE_MIN_MAX_VALUE || VV_SIZE_SCALE_STOPS || VV_SIZE_FIELD_STOPS || VV_SIZE_UNIT_VALUE || VV_OPACITY || VV_ROTATION\r\n\r\n#ifdef VV_COLOR\r\nuniform highp float u_vvColorValues[8];\r\nuniform vec4 u_vvColors[8];\r\n#endif // VV_COLOR\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nuniform highp vec4 u_vvSizeMinMaxValue;\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_SCALE_STOPS\r\nuniform highp float u_vvSizeScaleStopsValue;\r\n#endif // VV_SIZE_SCALE_STOPS\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nuniform highp float u_vvSizeFieldStopsValues[6];\r\nuniform float u_vvSizeFieldStopsSizes[6];\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nuniform float u_vvSizeUnitValueWorldToPixelsRatio;\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nuniform highp float u_vvOpacityValues[8];\r\nuniform float u_vvOpacities[8];\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_ROTATION\r\nuniform lowp float u_vvRotationType;\r\n#endif // VV_ROTATION\r\n"}},
raster:{"solid.frag":"precision mediump float;\r\n\r\nvoid main(void) {\r\n  gl_FragColor \x3d vec4(1.0, 0.0, 0.0, 1.0);\r\n}\r\n","texture.frag":"precision mediump float;\r\n\r\n// Texture coordinates.\r\nvarying vec2 v_texcoord;\r\n\r\n// Texture sampler.\r\nuniform sampler2D u_texture;\r\n\r\n// Opacity.\r\nuniform float u_opacity;\r\n\r\nvoid main(void) {\r\n  vec4 color \x3d texture2D(u_texture, v_texcoord);\r\n  color.a *\x3d u_opacity;\r\n  gl_FragColor \x3d vec4(color.rgb * color.a, color.a);\r\n}\r\n",
"transform.vert":'precision mediump float;\r\n\r\n// Vertex position. Assumed normalized in the [-1, 1] range.\r\nattribute vec2 a_position;\r\n\r\n// Texture coordinates. Assumed normalized in the [-1, 1] range.\r\nattribute vec2 a_texcoord;\r\n\r\n// Transform matrix.\r\nuniform mat4 u_transform;\r\n\r\n// Scales applied to position and texture coordinates to get the\r\n// "unnormalized" value.\r\nuniform float u_positionScale;\r\nuniform float u_texcoordScale;\r\n\r\n// Output texture coordinates, for interpolation.\r\nvarying vec2 v_texcoord;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d u_transform * vec4(a_position * u_positionScale, 0.0, 1.0);\r\n  v_texcoord \x3d a_texcoord * u_texcoordScale;\r\n}\r\n'},
stencil:{"stencil.frag":"void main() {\r\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n}\r\n","stencil.vert":"attribute vec2 a_pos;\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\r\n}\r\n"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\r\nvarying mediump vec2 v_tex;\r\n\r\nvoid main(void) {\r\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\r\n  gl_FragColor \x3d 0.75 * color;\r\n}\r\n","tileInfo.vert":"attribute vec2 a_pos;\r\n\r\nuniform highp mat3 u_dvsMat3;\r\n\r\nuniform mediump float u_depth;\r\nuniform mediump float u_coord_ratio;\r\nuniform mediump vec2 u_delta; // in tile coordinates\r\nuniform mediump vec2 u_dimensions; // in tile coordinates\r\n\r\nvarying mediump vec2 v_tex;\r\n\r\nvoid main() {\r\n  mediump vec2 offset \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\r\n  vec3 v_pos \x3d u_dvsMat3 * vec3(offset, 1.0);\r\n  \r\n  gl_Position \x3d vec4(v_pos.xy, 0.0, 1.0);\r\n\r\n  v_tex \x3d a_pos;\r\n}\r\n"},
util:{"encoding.glsl":"// Factors to convert rgba back to float\r\nconst vec4 rgba2float_factors \x3d vec4(\r\n    255.0 / (256.0),\r\n    255.0 / (256.0 * 256.0),\r\n    255.0 / (256.0 * 256.0 * 256.0),\r\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\r\n  );\r\n\r\nfloat rgba2float(vec4 rgba) {\r\n  // Convert components from 0-\x3e1 back to 0-\x3e255 and then\r\n  // add the components together with their corresponding\r\n  // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\r\n  return dot(rgba, rgba2float_factors);\r\n}\r\n"}}})},
"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(h,a){return function(){function a(a){this.readFile=a}a.prototype.resolveIncludes=function(a){return this.resolve(a)};a.prototype.resolve=function(a,b){var l=this;void 0===b&&(b=new Map);if(b.has(a))return b.get(a);var g=this.read(a);if(!g)throw Error("cannot find shader file "+a);for(var e=/^\h?#include\s+<(\S+)>\h?/gm,c=e.exec(g),f=[];null!=c;)f.push({path:c[1],start:c.index,length:c[0].length}),c=e.exec(g);var m=
0,d="";f.forEach(function(a){d+=g.slice(m,a.start);d+=b.has(a.path)?"":l.resolve(a.path,b);m=a.start+a.length});d+=g.slice(m);b.set(a,d);return d};a.prototype.read=function(a){return this.readFile(a)};return a}()})},"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/has","../3d/support/buffer/typedArrayUtil"],function(h,a,d,k){return function(){function a(b,g,e,c,f){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=
void 0;this._context=b;this._bufferType=g;this._usage=e;this._id=a._nextId++;this._glName=this._context.gl.createBuffer();c&&this.setData(c,f)}a.createIndex=function(b,g,e,c){return new a(b,34963,g,e,c)};a.createVertex=function(b,g,e){return new a(b,34962,g,e)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"byteSize",{get:function(){return 34962===this._bufferType?
this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context=null)};a.prototype.setData=function(a,b){if(a){if("number"===typeof a){if(0>a&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&b)switch(this._indexType=b,this._size=a,b){case 5123:a*=2;break;case 5125:a*=4}}else b=a.byteLength,k.isUint16Array(a)&&
(b/=2,this._indexType=5123),k.isUint32Array(a)&&(b/=4,this._indexType=5125),this._size=b;b=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,a,this._usage);this._context.bindVAO(b)}};a.prototype.setSubData=function(a,b,e,c){void 0===b&&(b=0);void 0===e&&(e=0);if(a){(0>b||b>=this._size)&&console.error("offset is out of range!");var f=b,g=e,l=c,d=a.byteLength;k.isUint16Array(a)&&(d/=2,f*=2,g*=2,l*=2);k.isUint32Array(a)&&
(d/=4,f*=4,g*=4,l*=4);void 0===c&&(c=d-1);e>=c&&console.error("end must be bigger than start!");b+e-c>this._size&&console.error("An attempt to write beyond the end of the buffer!");b=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);e=this._context.gl;a=ArrayBuffer.isView(a)?a.buffer:a;e.bufferSubData(this._bufferType,f,a.slice(g,l));this._context.bindVAO(b)}};a._nextId=0;return a}()})},"esri/views/3d/support/buffer/typedArrayUtil":function(){define(["require",
"exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.forEach=function(a,k){if(a.forEach)a.forEach(k);else for(var b=0;b<a.length;b++)k(a[b],b,a)};a.slice=function(a,k,b){if(a.slice)return a.slice(k,b);void 0===k?k=0:(0>k&&(k+=a.length),k=Math.min(a.length,Math.max(0,k)));void 0===b?b=a.length:(0>b&&(b+=a.length),b=Math.min(a.length,Math.max(0,b)));b=Math.max(0,b-k);for(var l=new a.constructor(b),g=0;g<b;g++)l[g]=a[k+g];return l};a.isArrayBuffer=function(a){return a instanceof
ArrayBuffer||a&&a.constructor&&"ArrayBuffer"===a.constructor.name};a.isInt8Array=function(a){return a instanceof Int8Array||a&&a.constructor&&"Int8Array"===a.constructor.name};a.isUint8Array=function(a){return a instanceof Uint8Array||a&&a.constructor&&"Uint8Array"===a.constructor.name};a.isInt16Array=function(a){return a instanceof Int16Array||a&&a.constructor&&"Int16Array"===a.constructor.name};a.isUint16Array=function(a){return a instanceof Uint16Array||a&&a.constructor&&"Uint16Array"===a.constructor.name};
a.isInt32Array=function(a){return a instanceof Int32Array||a&&a.constructor&&"Int32Array"===a.constructor.name};a.isUint32Array=function(a){return a instanceof Uint32Array||a&&a.constructor&&"Uint32Array"===a.constructor.name};a.isFloat32Array=function(a){return a instanceof Float32Array||a&&a.constructor&&"Float32Array"===a.constructor.name};a.isFloat64Array=function(a){return a instanceof Float64Array||a&&a.constructor&&"Float64Array"===a.constructor.name};a.toArray=function(a){for(var d=Array(a.length),
b=0;b<a.length;b++)d[b]=a[b];return d}})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],function(h,a,d){function k(a,l,g){g=g||{};g="function"===typeof l.shaders?l.shaders(g):l.shaders;return new d(a,g.vertexShader,g.fragmentShader,l.attributes)}Object.defineProperty(a,"__esModule",{value:!0});a.glslifyDefineMap=function(a){var b="",g;for(g in a){var e=a[g];if("boolean"===typeof e)e&&(b+="#define "+g+"\n");else if("number"===typeof e)b+="#define "+g+" "+e.toFixed()+
"\n";else if("object"===typeof e){var c=e.options,f=0,m;for(m in c)b+="#define "+c[m]+" "+(f++).toFixed()+"\n";b+="#define "+g+" "+c[e.value]+"\n"}}return b};h=function(){function a(a){this._programCacheByTemplate=new Map;this._rctx=a}a.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});this._programCacheByTemplate=null};a.prototype.getProgram=function(a,b){var e=this;this._programCacheByTemplate.has(a)||this.addProgramTemplate(a,
function(c){return k(e._rctx,a,c)});return this.getProgramTemplateInstance(a,b)};a.prototype.addProgramTemplate=function(a,b){this._programCacheByTemplate.set(a,{constructor:b,programs:new Map})};a.prototype.getProgramTemplateInstance=function(a,b){if(a=this._programCacheByTemplate.get(a)){var e=b?JSON.stringify(b):"default";a.programs.has(e)||(b=a.constructor(b),a.programs.set(e,b));return a.programs.get(e)}return null};return a}();a.ProgramCache=h;a.createProgram=k})},"esri/views/webgl/Program":function(){define(["require",
"exports","../../core/has","./ShaderTranspiler"],function(h,a,d,k){return function(){function a(b,g,e,c,f){void 0===f&&(f={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4=
{};b||console.error("RenderingContext isn't initialized!");0===g.length&&console.error("Shaders source should not be empty!");this._context=b;this._vertexShaderSource=g;this._fragmentShaderSource=e;if(Array.isArray(f))for(b=0;b<f.length;b++)this._defines[f[b]]="1";else this._defines=f;this._id=a._nextId++;this._locations=c}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});a.prototype.getDefine=function(a){return this._defines[a]};a.prototype.dispose=function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};a.prototype.initialize=
function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,b=a.createProgram();a.attachShader(b,this._vShader);a.attachShader(b,this._fShader);for(var e in this._locations)a.bindAttribLocation(b,this._locations[e],e);a.linkProgram(b);a.getProgramParameter(b,a.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+a.getProgramParameter(b,
a.VALIDATE_STATUS)+", gl error ["+a.getError()+"]infoLog: "+a.getProgramInfoLog(b));this._glName=b;this._initialized=!0}};a.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};a.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};a.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&
(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};a.prototype.setUniform1i=function(a,b){var e=this._nameToUniform1[a];if(void 0===e||b!==e)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),b),this._nameToUniform1[a]=b};a.prototype.setUniform1f=function(a,b){var e=this._nameToUniform1[a];if(void 0===e||b!==e)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),
b),this._nameToUniform1[a]=b};a.prototype.setUniform1fv=function(b,g){var e=this._nameToUniform1v[b];void 0!==e&&a._arraysEqual(g,e)||(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(b),g),void 0===e?this._nameToUniform1v[b]=a._arrayCopy(g):a._arrayAssign(g,e))};a.prototype.setUniform2f=function(a,b,e){var c=this._nameToUniform2[a];if(void 0===c||b!==c[0]||e!==c[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),b,e),void 0===
c?this._nameToUniform2[a]=[b,e]:(c[0]=b,c[1]=e)};a.prototype.setUniform2fv=function(b,g){var e=this._nameToUniform2[b];void 0!==e&&a._arraysEqual(g,e)||(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(b),g),void 0===e?this._nameToUniform2[b]=a._arrayCopy(g):a._arrayAssign(g,e))};a.prototype.setUniform3f=function(a,b,e,c){var f=this._nameToUniform3[a];if(void 0===f||b!==f[0]||e!==f[1]||c!==f[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),
b,e,c),void 0===f?this._nameToUniform3[a]=[b,e,c]:(f[0]=b,f[1]=e,f[2]=c)};a.prototype.setUniform3fv=function(b,g){var e=this._nameToUniform3[b];void 0!==e&&a._arraysEqual(g,e)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(b),g),void 0===e?this._nameToUniform3[b]=a._arrayCopy(g):a._arrayAssign(g,e))};a.prototype.setUniform4f=function(a,b,e,c,f){var g=this._nameToUniform4[a];if(void 0===g||b!==g[0]||e!==g[1]||c!==g[2]||f!==g[3])this._context.bindProgram(this),
this._context.gl.uniform4f(this.getUniformLocation(a),b,e,c,f),void 0===g?this._nameToUniform4[a]=[b,e,c,f]:(g[0]=b,g[1]=e,g[2]=c,g[3]=f)};a.prototype.setUniform4fv=function(b,g){var e=this._nameToUniform4[b];void 0!==e&&a._arraysEqual(g,e)||(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(b),g),void 0===e?this._nameToUniform4[b]=a._arrayCopy(g):a._arrayAssign(g,e))};a.prototype.setUniformMatrix3fv=function(b,g,e){void 0===e&&(e=!1);var c=this._nameToUniformMatrix3[b];
void 0!==c&&(9===c.length?a._matrix3Equal(c,g):a._arraysEqual(g,c))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(b),e,g),void 0===c?this._nameToUniformMatrix3[b]=a._arrayCopy(g):a._arrayAssign(g,c))};a.prototype.setUniformMatrix4fv=function(b,g,e){void 0===e&&(e=!1);var c=this._nameToUniformMatrix4[b];void 0!==c&&(16===c.length?a._matrix4Equal(c,g):a._arraysEqual(g,c))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(b),
e,g),void 0===c?this._nameToUniformMatrix4[b]=a._arrayCopy(g):a._arrayAssign(g,c))};a._padToThree=function(a){var b=a.toString();1E3>a&&(b=("  "+a).slice(-3));return b};a.prototype._addLineNumbers=function(b){var g=2;return b.replace(/\n/g,function(){return"\n"+a._padToThree(g++)+":"})};a.prototype._loadShader=function(a){var b=35633===a,e=b?this._vertexShaderSource:this._fragmentShaderSource,c;c="";for(var f in this._defines)c+="#define "+f+" "+this._defines[f]+"\n";c+=e;"webgl2"===this._context.contextVersion&&
(c=k.transpileShader(c,b?"vertex":"fragment"));b=this._context.gl;a=b.createShader(a);b.shaderSource(a,c);b.compileShader(a);b.getShaderParameter(a,b.COMPILE_STATUS)||(console.error(b.getShaderInfoLog(a)),console.error(this._addLineNumbers(c)),"webgl2"===this._context.contextVersion&&(console.log("Shader source before transpilation:"),console.log(e)));return a};a._matrix4Equal=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&
a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};a._matrix3Equal=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};a._arraysEqual=function(a,b){if(a.length!==b.length)return!1;for(var e=0;e<a.length;++e)if(a[e]!==b[e])return!1;return!0};a._arrayCopy=function(a){for(var b=[],e=0;e<a.length;++e)b.push(a[e]);return b};a._arrayAssign=function(a,b){for(var e=
0;e<a.length;++e)b[e]=a[e]};a._nextId=0;return a}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(h,a,d,k){function b(a){return a.map(function(a){return"eof"!==a.type?a.data:""}).join("")}function l(a,f,b,e){e=e||b;for(var c=0;c<a.length;c++){var g=a[c];if("ident"===g.type&&g.data===b)return e in f?f[e]++:f[e]=0,l(a,f,e+"_"+f[e],e)}return b}function g(a,f,b){void 0===b&&(b="afterVersion");var c={data:"\n",
type:"whitespace"},e=function(c){return c<a.length?/[^\r\n]$/.test(a[c].data):!1},g=function(a){for(var c=-1,f=0,e=-1,g=0;g<a.length;g++){var m=a[g];"preprocessor"===m.type&&(m.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++f:m.data.match(/\#endif\s*.*/)&&--f);("afterVersion"===b||"afterPrecision"===b)&&"preprocessor"===m.type&&/^#version/.test(m.data)&&(e=Math.max(e,g));if("afterPrecision"===b&&"keyword"===m.type&&"precision"===m.data){a:{for(m=g;m<a.length;m++){var l=a[m];if("operator"===l.type&&";"===
l.data)break a}m=null}if(null===m)throw Error("precision statement not followed by any semicolons!");e=Math.max(e,m)}c<e&&0===f&&(c=g)}return c+1}(a);e(g-1)&&a.splice(g++,0,c);for(var m=0;m<f.length;m++){var l=f[m];a.splice(g++,0,l)}e(g-1)&&e(g)&&a.splice(g,0,c)}Object.defineProperty(a,"__esModule",{value:!0});var e=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];a.transpileShader=function(a,f){a=k(a);var c;a:{c="100";var p="300 es";void 0===c&&
(c="100");void 0===p&&(p="300 es");for(var x=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,u=0;u<a.length;u++){var w=a[u];if("preprocessor"===w.type){var h=x.exec(w.data);if(h)if(x=h[1].replace(/\s\s+/g," "),x===p){c=x;break a}else if(x===c){w.data="#version "+p;break a}else throw Error("unknown glsl version: "+x);}}a.splice(0,0,{type:"preprocessor",data:"#version "+p},{type:"whitespace",data:"\n"});c=null}if("300 es"===c)throw Error("shader is already glsl 300 es");x=w=null;u={};h={};for(c=0;c<a.length;++c)switch(p=
a[c],p.type){case "keyword":"vertex"===f&&"attribute"===p.data?p.data="in":"varying"===p.data&&(p.data="vertex"===f?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(p.data.trim())&&(p.data=p.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===f&&"gl_FragColor"===p.data){if(!w){var w=l(a,u,"fragColor"),t=void 0;void 0===t&&(t="lowp");g(a,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:t},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},
{type:"whitespace",data:" "},{type:"ident",data:w},{type:"operator",data:";"}],"afterPrecision")}p.data=w}else"fragment"===f&&"gl_FragDepthEXT"===p.data&&(x||(x=l(a,u,"gl_FragDepth")),p.data=x);break;case "ident":if(0<=d.indexOf(p.data)){if(t="vertex"===f)a:{for(t=c-1;0<=t;t--){var A=a[t];if("whitespace"!==A.type&&"block-comment"!==A.type)if("keyword"===A.type){if("attribute"===A.data||"in"===A.data){t=!0;break a}}else break}t=!1}if(t)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");
p.data in h||(h[p.data]=l(a,u,p.data));p.data=h[p.data]}}for(c=a.length-1;0<=c;--c)p=a[c],"preprocessor"===p.type&&((f=p.data.match(/\#extension\s+(.*)\:/))&&f[1]&&0<=e.indexOf(f[1].trim())&&(f=a[c+1],a.splice(c,f&&"whitespace"===f.type?2:1)),(f=p.data.match(/\#ifdef\s+(.*)/))&&f[1]&&0<=e.indexOf(f[1].trim())&&(p.data="#if 1"),(f=p.data.match(/\#ifndef\s+(.*)/))&&f[1]&&0<=e.indexOf(f[1].trim())&&(p.data="#if 0"));return b(a)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],
function(h,a){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(h){"use strict;";return function(a){var d=h(),k=[],k=k.concat(d(a));return k=k.concat(d(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(h,a,d){"use strict;";var k="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function b(a){a.length&&A.push({type:k[u],
data:a,position:v,line:C,column:z})}function l(){t=t.length?[]:t;if("/"===r&&"*"===w)return v=x+p-1,u=0,r=w,p+1;if("/"===r&&"/"===w)return v=x+p-1,u=1,r=w,p+1;if("#"===w)return u=2,v=x+p,p;if(/\s/.test(w))return u=9,v=x+p,p;y=/\d/.test(w);D=/[^\w_]/.test(w);v=x+p;u=y?4:D?3:9999;return p}function g(){if(("\r"===w||"\n"===w)&&"\\"!==r)return b(t.join("")),u=999,p;t.push(w);r=w;return p+1}function e(){if("."===r&&/\d/.test(w))return u=5,p;if("/"===r&&"*"===w)return u=0,p;if("/"===r&&"/"===w)return u=
1,p;if("."===w&&t.length){for(;c(t););u=5;return p}if(";"===w||")"===w||"("===w){if(t.length)for(;c(t););b(w);u=999;return p+1}var a=2===t.length&&"\x3d"!==w;if(/[\w_\d\s]/.test(w)||a){for(;c(t););u=999;return p}t.push(w);r=w;return p+1}function c(c){var f=0,e,g;do{e=a.indexOf(c.slice(0,c.length+f).join(""));g=a[e];if(-1===e){if(0<f--+c.length)continue;g=c.slice(0,1).join("")}b(g);v+=g.length;t=t.slice(g.length);return t.length}while(1)}function f(){if("."===w||/[eE]/.test(w))return t.push(w),u=5,
r=w,p+1;if("x"===w&&1===t.length&&"0"===t[0])return u=11,t.push(w),r=w,p+1;if(/[^\d]/.test(w))return b(t.join("")),u=999,p;t.push(w);r=w;return p+1}function m(){"f"===w&&(t.push(w),r=w,p+=1);if(/[eE]/.test(w)||"-"===w&&/[eE]/.test(r))return t.push(w),r=w,p+1;if(/[^\d]/.test(w))return b(t.join("")),u=999,p;t.push(w);r=w;return p+1}var p=0,x=0,u=999,w,r,t=[],A=[],C=1,z=0,v=0,y=!1,D=!1,F="",G;return function(a){A=[];if(null!==a){a=a.replace?a.replace(/\r\n/g,"\n"):a;p=0;F+=a;for(G=F.length;w=F[p],p<
G;){a=p;switch(u){case 0:"/"===w&&"*"===r?(t.push(w),b(t.join("")),u=999):(t.push(w),r=w);p+=1;break;case 1:p=g();break;case 2:p=g();break;case 3:p=e();break;case 4:p=f();break;case 11:/[^a-fA-F0-9]/.test(w)?(b(t.join("")),u=999):(t.push(w),r=w,p+=1);break;case 5:p=m();break;case 9999:if(/[^\d\w_]/.test(w)){var c=t.join("");u=-1<h.indexOf(c)?8:-1<d.indexOf(c)?7:6;b(t.join(""));u=999}else t.push(w),r=w,p+=1;break;case 9:/[^\s]/g.test(w)?(b(t.join("")),u=999):(t.push(w),r=w,p+=1);break;case 999:p=l()}if(a!==
p)switch(F[a]){case "\n":z=0;++C;break;default:++z}}x+=p;F=F.slice(p);return A}t.length&&b(t.join(""));u=10;b("(eof)");return A}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","../../core/has","./Util"],function(h,a,d,k){return function(){function a(b,g,e,c,f){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=b;this._layout=e;this._buffers=c;this._locations=g;f&&(this._indexBuffer=f);this._id=a._nextId++}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(b,e){return b+a._buffers[e].size},this._indexBuffer?this._indexBuffer.size:
0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});a.prototype.dispose=function(a){void 0===a&&(a=!0);if(this._context){var b=this._context.capabilities.vao;b&&this._glName&&(b.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);
if(a){for(var e in this._buffers)this._buffers[e].dispose(),delete this._buffers[e];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};a.prototype.initialize=function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var b=a.createVertexArray();a.bindVertexArray(b);this._bindLayout();a.bindVertexArray(null);this._glName=b}this._initialized=!0}};a.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):
(this._context.bindVAO(null),this._bindLayout())};a.prototype._bindLayout=function(){var a=this._buffers,b=!!this._context.capabilities.vao,e=this._layout,c=this._indexBuffer;a||console.error("Vertex buffer dictionary is empty!");var f=this._context.gl,m;for(m in a){var p=a[m];p||console.error("Vertex buffer is uninitialized!");var d=e[m];d||console.error("Vertex element descriptor is empty!");k.bindVertexBufferLayout(this._context,this._locations,p,d)}c&&(b?f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c.glName):
this._context.bindBuffer(c))};a.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};a.prototype._unbindLayout=function(){var a=this._buffers,b=this._layout;a||console.error("Vertex buffer dictionary is empty!");for(var e in a){var c=a[e];c||console.error("Vertex buffer is uninitialized!");k.unbindVertexBufferLayout(this._context,this._locations,c,b[e])}(a=this._indexBuffer)&&this._context.unbindBuffer(a.bufferType)};a._nextId=
0;return a}()})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/Error"],function(h,a,d,k){function b(a){return a[0].stride}function l(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}Object.defineProperty(a,"__esModule",{value:!0});a.vertexCount=function(a,e){return a.vertexBuffers[e].size/b(a.layout[e])};
a.getStride=b;a.getBytesPerElement=l;a.addDescriptor=function(a,b,c,f,m,p){var e=l(f);if(0<a.length){var g=a[0].stride,d=g+e*c;a.forEach(function(a){return a.stride=d});a.push({name:b,count:c,type:f,offset:g,stride:d,normalized:m,divisor:p})}else a.push({name:b,count:c,type:f,offset:0,stride:e*c,normalized:m,divisor:p})};a.assertCompatibleVertexAttributeLocations=function(a,b){(a=a.locations===b.locations)||console.error("VertexAttributeLocations are incompatible");return a};a.hasAttribute=function(a,
b){for(var c=0;c<a.length;c++)if(a[c].name===b)return!0;return!1};a.findAttribute=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return a[c];return null};a.copyFramebufferToTexture=function(a,b,c,f,m){void 0===m&&(m=0);var e=a.getBoundFramebufferObject(),g=a.getBoundTexture(0);a.bindFramebuffer(b);a.bindTexture(c,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,m,c.descriptor.pixelFormat,f[0],f[1],f[2],f[3],0);a.gl.flush();a.bindFramebuffer(e);a.bindTexture(g,0)};a.assert=function(a,b){if(!a)throw new k(b);
};a.setBaseInstanceOffset=function(a,b){var c={},f;for(f in a)c[f]=a[f].map(function(a){return a.divisor?d({},a,{baseInstance:b}):a});return c};a.bindVertexBufferLayout=function(a,b,c,f,m){var e=a.gl,g=a.capabilities.instancing;a.bindBuffer(c);f.forEach(function(a){var c=b[a.name],f=(m?m:0+a.baseInstance?a.baseInstance:0)*a.stride;void 0===c&&console.error("There is no location for vertex attribute '"+a.name+"' defined.");a.baseInstance&&!a.divisor&&console.error("Vertex attribute '"+a.name+"' uses baseInstanceOffset without divisor.");
if(4>=a.count)e.vertexAttribPointer(c,a.count,a.type,a.normalized,a.stride,a.offset+f),e.enableVertexAttribArray(c),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c,a.divisor);else if(9===a.count)for(var l=0;3>l;l++)e.vertexAttribPointer(c+l,3,a.type,a.normalized,a.stride,a.offset+12*l+f),e.enableVertexAttribArray(c+l),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c+l,a.divisor);else if(16===a.count)for(l=0;4>l;l++)e.vertexAttribPointer(c+l,4,a.type,a.normalized,a.stride,a.offset+16*l+f),e.enableVertexAttribArray(c+
l),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c+l,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)})};a.unbindVertexBufferLayout=function(a,b,c,f){var e=a.gl,g=a.capabilities.instancing;a.bindBuffer(c);f.forEach(function(a){var c=b[a.name];if(4>=a.count)e.disableVertexAttribArray(c),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c,0);else if(9===a.count)for(var f=0;3>f;f++)e.disableVertexAttribArray(c+f),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c+
f,0);else if(16===a.count)for(f=0;4>f;f++)e.disableVertexAttribArray(c+f),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c+f,0);else console.error("Unsupported vertex attribute element count: "+a.count)});a.unbindBuffer(34962)}})},"esri/views/2d/engine/webgl/Painter":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/gl-matrix ./BitBlitRenderer ./enums ./MaterialManager ./TextureManager ./Utils ./VertexStream ./brushes/WGLBrushInfo ./brushes/WGLBrushStencil ./brushes/WGLGeometryBrushFill ./brushes/WGLGeometryBrushLabel ./brushes/WGLGeometryBrushLine ./brushes/WGLGeometryBrushMarker ./brushes/WGLGeometryBrushText ./painter/WGLHighlightPainter ./shaders/RasterPrograms ../../../webgl/FramebufferObject ../../../webgl/programUtils".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w,r,t,A,C,z,v,y){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._initialized=!1}a.prototype.registerPass=function(a,c){this._initialize();for(var f=0;f<g.WGLDrawPhase.NUM_DRAW_PHASES-2;f++){var b=1<<f;b&c&&this._passMap.set(b,a)}return this};a.prototype.getPaintPassTs=function(a){this._initialize();return this._passMap.has(a)?[this._passMap.get(a)]:[]};a.prototype._initialize=function(){this._initialized||(this._passMap=new Map,
this._initialized=!0)};return a}();a.PainterOptions=h;var D=new Uint8Array(4*f.C_HITTEST_SEARCH_SIZE*f.C_HITTEST_SEARCH_SIZE),F=new Uint32Array(D.buffer);h=function(){function a(a){var f=this;this.context=a;this._hlPainter=new C;this._blitRenderer=new l;this._boundFBO=this._globalOpacityFBO=null;this.textureManager=new c;this.stencilRef=-1;this.drawImage=function(){var a=b.vec3f32.create();return function(c,e,m,l,d,p,k,v,x,y,t){var h=c.getViewport(),w=h.width,h=h.height,u,r=f._transform,z=f._quadVertexStream;
t===g.WGLDrawPhase.CLIP?(c.setStencilFunction(519,f.stencilRef,255),u=f._transformSolidProgram):(c.setStencilFunction(514,f.stencilRef,255),u=f._transformTextureProgram);u.setUniform1f("u_positionScale",z.positionScale);b.mat4.identity(r);b.mat4.scale(r,r,b.vec3.set(a,2*y/w,2*y/h,1));b.mat4.translate(r,r,b.vec3.set(a,m-w/2/y,-l+h/2/y,0));b.mat4.rotateZ(r,r,k);b.mat4.translate(r,r,b.vec3.set(a,d/2,-p/2,0));b.mat4.rotateZ(r,r,-v);b.mat4.scale(r,r,b.vec3.set(a,d/2,p/2,1));u.setUniformMatrix4fv("u_transform",
r);t!==g.WGLDrawPhase.CLIP&&(u.setUniform1f("u_texcoordScale",z.texcoordScale),c.bindTexture(e,0),u.setUniform1i("u_texture",0));u.setUniform1f("u_opacity",x);z.draw()}}();this.materialManager=new e(a);this._quadVertexStream=new m(a,[-32768,-32768,0,0,32767,-32768,32767,0,-32768,32767,0,32767,32767,32767,32767,32767],[0,1,2,1,3,2]);this._quadVertexStream.positionScale=1;this._quadVertexStream.texcoordScale=1;this._transformTextureProgram=y.createProgram(a,z.transformTexture);this._transformSolidProgram=
y.createProgram(a,z.transformSolid);this._transform=b.mat4f32.create()}a.prototype.dispose=function(){this.materialManager.dispose();this.textureManager.dispose();this._hlPainter&&(this._hlPainter.dispose(),this._hlPainter=null);this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._globalOpacityFBO&&(this._globalOpacityFBO.dispose(),this._globalOpacityFBO=null);this._boundFBO=null;this._hittestFBO&&(this._hittestFBO.dispose(),this._hittestFBO=null);this._passes&&(this._passes.forEach(function(a){return a.dispose()}),
this._passes.clear());this._brushes&&(this._brushes.forEach(function(a){return a.forEach(function(a){return a.dispose()})}),this._brushes.clear());this._geometryBrushes&&(this._geometryBrushes.forEach(function(a){return a.dispose()}),this._geometryBrushes.clear());this._quadVertexStream.dispose()};a.prototype.getBrushes=function(a){if(a===g.WGLDrawPhase.MAP)throw Error("Painter: Tried to get brush for the MAP phase; use a specific geometry type and call getMapBrush() instead.");if(!this._brushes){var c=
[this.getGeometryBrush(g.WGLGeometryType.FILL),this.getGeometryBrush(g.WGLGeometryType.LINE),this.getGeometryBrush(g.WGLGeometryType.MARKER),this.getGeometryBrush(g.WGLGeometryType.TEXT)],f=new w.default,b=new p.default,e=new x.default;this._brushes=new Map;this._brushes.set(g.WGLDrawPhase.LABEL,[f]);this._brushes.set(g.WGLDrawPhase.LABEL_ALPHA,[f]);this._brushes.set(g.WGLDrawPhase.HITTEST,c);this._brushes.set(g.WGLDrawPhase.HIGHLIGHT,c);this._brushes.set(g.WGLDrawPhase.CLIP,[e]);this._brushes.set(g.WGLDrawPhase.DEBUG,
[b])}if(!this._brushes.has(a))throw Error("Painter: Tried to get brush for unknown phase: "+a);return this._brushes.get(a)};a.prototype.getGeometryBrush=function(a){if(!this._geometryBrushes){var c=new u.default,f=new r.default,b=new t.default,e=new A.default,m=new w.default;this._geometryBrushes=new Map;this._geometryBrushes.set(g.WGLGeometryType.FILL,c);this._geometryBrushes.set(g.WGLGeometryType.LINE,f);this._geometryBrushes.set(g.WGLGeometryType.MARKER,b);this._geometryBrushes.set(g.WGLGeometryType.TEXT,
e);this._geometryBrushes.set(g.WGLGeometryType.LABEL,m)}return this._geometryBrushes.get(a)};a.prototype.draw=function(a,c,f,b){this._setGlobalOpacity(a,f);0===(f&(g.WGLDrawPhase.LABEL_ALPHA|g.WGLDrawPhase.LABEL))&&this._drawClippingRects(a,c);var e=this.context;e.setBlendingEnabled(!0);e.setStencilWriteMask(0);e.setBlendFunctionSeparate(1,771,1,771);this._drawPhases(a,c,f,b);this._applyGlobalOpacity(a,f);this._debugTiles(a,c)};a.prototype.setHighlightOptions=function(a){this._hlPainter.setHighlightOptions(a)};
a.prototype.highlight=function(a,c){var f=this.context,b=f.getViewport();this._hlPainter.setup(f,b.width,b.height);this._hlPainter.startMaskDraw(f);this._drawClippingRects(a,c);f.setBlendingEnabled(!0);f.setStencilWriteMask(0);f.setBlendFunctionSeparate(1,771,1,771);this._drawPhases(a,c,g.WGLDrawPhase.HIGHLIGHT);this._hlPainter.draw(f)};a.prototype.hitTest=function(a,c){var b=this.context,e=f.C_HITTEST_SEARCH_SIZE,m=[0,0],l=[0,0],d=a.state;d.toMap(m,[0,0]);d.toMap(l,[e,e]);if(0===c.filter(function(a){return!(m[0]>
a.bounds[2]||l[0]<a.bounds[0]||m[1]<a.bounds[1]||l[1]>a.bounds[3])}).length)return[];this._hittestFBO||(this._hittestFBO=v.create(b,{colorTarget:0,depthStencilTarget:3,width:e,height:e}));var d=b.getViewport(),p=b.getBoundFramebufferObject();b.bindFramebuffer(this._hittestFBO);b.setViewport(0,0,e,e);this._drawClippingRects(a,c);var k=b.gl;b.setClearColor(1,1,1,1);b.clear(k.COLOR_BUFFER_BIT);b.setBlendingEnabled(!1);b.setStencilWriteMask(0);this._drawPhases(a,c,g.WGLDrawPhase.HITTEST);b.setBlendingEnabled(!0);
this._hittestFBO.readPixels(0,0,e,e,6408,5121,D);a=e*e;c=new Set;for(e=0;e<a;e++)k=F[e],4294967295!==k&&c.add(k);b.bindFramebuffer(p);b.setViewport(d.x,d.y,d.width,d.height);var x=[];c.forEach(function(a){x.push(a)});return x};a.prototype.startStencilBurn=function(){this.context.setStencilTestEnabled(!0);this.context.setStencilWriteMask(255);this.context.setClearStencil(0);this.context.clear(this.context.gl.STENCIL_BUFFER_BIT);this.context.setStencilOp(7680,7680,7681);this.context.setColorMask(!1,
!1,!1,!1);this.context.setBlendingEnabled(!1);this._quadVertexStream.bind();this.context.bindProgram(this._transformSolidProgram)};a.prototype.startStencilDraw=function(){this.context.setStencilWriteMask(0);this.context.setStencilOp(7680,7680,7680);this.context.setColorMask(!0,!0,!0,!0);this.context.setBlendingEnabled(!0);this.context.setBlendFunction(1,771);this._quadVertexStream.bind();this.context.bindProgram(this._transformTextureProgram)};a.prototype.endStencilDraw=function(){this.context.setStencilTestEnabled(!1);
this._quadVertexStream.unbind();this.context.bindProgram()};a.prototype._getPaintPass=function(a){this._passes||(this._passes=new Map);if(!this._passes.has(a))try{this._passes.set(a,new a)}catch(J){throw Error("Tried to instantiate WGLPaintPass with unknown constructor: "+a+",\n"+J);}return this._passes.get(a)};a.prototype._getPaintPasses=function(a,c){var f=this;return c.getPaintPassTs(a).map(function(a){return f._getPaintPass(a)})};a.prototype._drawPhases=function(a,c,f,b){var e=this.context;e.setStencilTestEnabled(!0);
for(var m=0;m<g.WGLDrawPhase.NUM_DRAW_PHASES-2;m++){var l=1<<m;if(l&f){var p=b?this._getPaintPasses(l,b):[],l=d({},a,{drawPhase:l});p.forEach(function(c){return c.preRender(a,a.rendererInfo)});for(var k=0,v=c;k<v.length;k++)v[k].doRender(l);p.reverse().forEach(function(c){return c.postRender(a,a.rendererInfo)})}}e.setStencilTestEnabled(!1)};a.prototype._debugTiles=function(a,c){};a.prototype._drawClippingRects=function(a,c){if(0!==c.length){var f=this.context;f.setDepthWriteEnabled(!1);f.setDepthTestEnabled(!1);
f.setStencilTestEnabled(!0);f.setBlendingEnabled(!1);f.setColorMask(!1,!1,!1,!1);f.setStencilOp(7680,7680,7681);f.setClearStencil(0);f.clear(f.gl.STENCIL_BUFFER_BIT);f.setStencilWriteMask(255);for(var b=0,e=c.length;b<c.length;b++,e--){var m=c[b];m.attached&&(m.stencilRef=e)}this._drawPhases(a,c,g.WGLDrawPhase.CLIP);f.setColorMask(!0,!0,!0,!0)}};a.prototype._setGlobalOpacity=function(a,c){if(c===g.WGLDrawPhase.MAP&&1!==a.globalOpacity){c=a.context;var f=a.pixelRatio,b=a.state.size;a=Math.round(b[0]*
f);f=Math.round(b[1]*f);if(null===this._globalOpacityFBO||this._globalOpacityFBO.width!==a||this._globalOpacityFBO.height!==f)null!==this._globalOpacityFBO&&this._globalOpacityFBO.dispose(),this._globalOpacityFBO=v.create(c,{colorTarget:0,depthStencilTarget:3,width:a,height:f});this._boundFBO=c.getBoundFramebufferObject();c.bindFramebuffer(this._globalOpacityFBO);c.setDepthWriteEnabled(!0);c.setStencilWriteMask(255);c.setClearColor(0,0,0,0);c.setClearDepth(1);c.setClearStencil(0);c.clear(c.gl.COLOR_BUFFER_BIT|
c.gl.DEPTH_BUFFER_BIT|c.gl.STENCIL_BUFFER_BIT);c.setDepthWriteEnabled(!1)}};a.prototype._applyGlobalOpacity=function(a,c){c===g.WGLDrawPhase.MAP&&1!==a.globalOpacity&&(c=a.context,c.bindFramebuffer(this._boundFBO),this._blitRenderer.render(c,this._globalOpacityFBO.colorTexture,9728,a.globalOpacity),this._boundFBO=null)};return a}();a.default=h})},"esri/views/2d/engine/webgl/MaterialManager":function(){define("require exports ./enums ./MaterialInfoUtils ./shaders/MaterialPrograms ../../../webgl/programUtils".split(" "),
function(h,a,d,k,b,l){return function(){function a(a){this._programByKey=new Map;this._programCache=new l.ProgramCache(a)}a.prototype.dispose=function(){this._programCache&&this._programCache.dispose()};a.prototype.getProgram=function(a,c){a|=c===d.WGLDrawPhase.HITTEST?8:0;a|=c===d.WGLDrawPhase.HIGHLIGHT?16:0;if(this._programByKey[a])return this._programByKey[a];c=k.getMaterialVariations(a);var f=null;switch(c.geometryType){case d.WGLGeometryType.MARKER:f=this._programCache.getProgram(b.icon,c.programOptions);
break;case d.WGLGeometryType.TEXT:f=this._programCache.getProgram(b.text,c.programOptions);break;case d.WGLGeometryType.LABEL:f=this._programCache.getProgram(b.label,c.programOptions);break;case d.WGLGeometryType.FILL:f=this._programCache.getProgram(b.fill,c.programOptions);break;case d.WGLGeometryType.LINE:f=this._programCache.getProgram(b.line,c.programOptions)}f&&(this._programByKey[a]=f);return f};return a}()})},"esri/views/2d/engine/webgl/MaterialInfoUtils":function(){define("require exports ./enums ./MaterialInfo ./MaterialKeyInfo ./util/Result".split(" "),
function(h,a,d,k,b,l){function g(a){var c=[];c[0]=a.sdf?!0:!1;c[1]=a.vvSizeMinMaxValue?!0:!1;c[2]=a.vvSizeScaleStops?!0:!1;c[3]=a.vvSizeFieldStops?!0:!1;c[4]=a.vvSizeUnitValue?!0:!1;c[5]=a.vvColor?!0:!1;c[6]=a.vvRotation?!0:!1;c[7]=a.vvOpacity?!0:!1;c[8]=a.visibility?!0:!1;c[9]=a.pattern?!0:!1;c[10]=a.simplePattern?!0:!1;return c.reduce(function(a,c,f){c&&(a|=1<<f+2);return a},0)}function e(a){if(a.geometryType===d.WGLGeometryType.UNKNOWN)return-1;var c=g(a)<<3;return a.geometryType+c}Object.defineProperty(a,
"__esModule",{value:!0});a.createTextMaterialInfo=function(a,f,g){var c=new k.default,m=new b;m.geometryType=g;m.sdf=!0;m.pattern=!1;m.visibility=!1;m.simplePattern=!1;c.texBindingInfo.push(new k.TexBindingInfo(2,a.page,"u_texture"));0===f?m.vvOpacity=m.vvSizeMinMaxValue=m.vvSizeScaleStops=m.vvSizeFieldStops=m.vvSizeUnitValue=m.vvColor=m.vvRotation=!1:(m.vvOpacity=0!==(f&d.WGLVVFlag.OPACITY),m.vvSizeMinMaxValue=0!==(f&d.WGLVVFlag.SIZE_MINMAX_VALUE),m.vvSizeScaleStops=0!==(f&d.WGLVVFlag.SIZE_SCALE_STOPS),
m.vvSizeFieldStops=0!==(f&d.WGLVVFlag.SIZE_FIELD_STOPS),m.vvSizeUnitValue=0!==(f&d.WGLVVFlag.SIZE_UNIT_VALUE),m.vvColor=0!==(f&d.WGLVVFlag.COLOR),m.vvRotation=0!==(f&d.WGLVVFlag.ROTATION));c.materialKey=e(m);c.materialKeyInfo=m;return c};a.createMaterialInfo=function(a,f,g){var c=new k.default,m=new b;m.geometryType=f;a&&l.ok(a.spriteMosaicItem)?(a=a.spriteMosaicItem,m.sdf=a.sdf,m.pattern=!0,c.texBindingInfo.push(new k.TexBindingInfo(1,a.page,"u_texture"))):(m.sdf=!1,m.pattern=!1);0===g?m.vvOpacity=
m.vvSizeMinMaxValue=m.vvSizeScaleStops=m.vvSizeFieldStops=m.vvSizeUnitValue=m.vvColor=m.vvRotation=!1:(m.vvOpacity=0!==(g&d.WGLVVFlag.OPACITY),m.vvSizeMinMaxValue=0!==(g&d.WGLVVFlag.SIZE_MINMAX_VALUE),m.vvSizeScaleStops=0!==(g&d.WGLVVFlag.SIZE_SCALE_STOPS),m.vvSizeFieldStops=0!==(g&d.WGLVVFlag.SIZE_FIELD_STOPS),m.vvSizeUnitValue=0!==(g&d.WGLVVFlag.SIZE_UNIT_VALUE),m.vvColor=0!==(g&d.WGLVVFlag.COLOR),m.vvRotation=0!==(g&d.WGLVVFlag.ROTATION));m.visibility=!1;c.materialKey=e(m);c.materialKeyInfo=m;
return c};a.getMaterialKey=e;a.getMaterialVariations=function(a){var c=a&7;a>>=3;return{geometryType:c,programOptions:{id:0!==(a&1),highlight:0!==(a&2),isSDF:0!==(a&4),vvSizeMinMaxValue:0!==(a&8),vvSizeScaleStops:0!==(a&16),vvSizeFieldStops:0!==(a&32),vvSizeUnitValue:0!==(a&64),vvColor:0!==(a&128),vvRotation:0!==(a&256),vvOpacity:0!==(a&512),visibility:0!==(a&1024),pattern:0!==(a&2048),simplePattern:0!==(a&4096)}}}})},"esri/views/2d/engine/webgl/MaterialInfo":function(){define("require exports ./enums ./MaterialInfoUtils ./MaterialInfoUtils_updateMaterialVariations ./MaterialKeyInfo ./util/serializationUtils".split(" "),
function(h,a,d,k,b,l,g){Object.defineProperty(a,"__esModule",{value:!0});var e=function(){function a(a,c,f){this.unit=a;this.pageId=c;this.semantic=f}a.prototype.clone=function(){return new a(this.unit,this.pageId,this.semantic)};a.prototype.serialize=function(a){a.push(this.unit);a.push(this.pageId);return a};a.deserialize=function(c){var f=c.readInt32();c=c.readInt32();return new a(f,c,"u_texture")};return a}();a.TexBindingInfo=e;var c=function(){function a(a,c){this.name=a;this.value=c}a.prototype.clone=
function(){return new a(this.name,this.value)};a.prototype.serialize=function(a){a.push(this.value);return a};a.deserialize=function(c){c=c.readInt32();return new a("u_my_param",c)};return a}();a.MaterialParam=c;h=function(){function a(){this.texBindingInfo=[];this.materialParams=[]}a.fromSprite=function(c,f,b){var g=new a,m=new l;m.geometryType=f;c?(m.sdf=c.sdf,m.pattern=!0,m.simplePattern=c.simplePattern,g.texBindingInfo.push(new e(1,c.page,"u_texture"))):(m.sdf=!1,m.pattern=!1,m.simplePattern=
!1);0===b?m.vvOpacity=m.vvSizeMinMaxValue=m.vvSizeScaleStops=m.vvSizeFieldStops=m.vvSizeUnitValue=m.vvColor=m.vvRotation=!1:(m.vvOpacity=0!==(b&d.WGLVVFlag.OPACITY),m.vvSizeMinMaxValue=0!==(b&d.WGLVVFlag.SIZE_MINMAX_VALUE),m.vvSizeScaleStops=0!==(b&d.WGLVVFlag.SIZE_SCALE_STOPS),m.vvSizeFieldStops=0!==(b&d.WGLVVFlag.SIZE_FIELD_STOPS),m.vvSizeUnitValue=0!==(b&d.WGLVVFlag.SIZE_UNIT_VALUE),m.vvColor=0!==(b&d.WGLVVFlag.COLOR),m.vvRotation=0!==(b&d.WGLVVFlag.ROTATION));m.visibility=!1;g.materialKey=k.getMaterialKey(m);
g.materialKeyInfo=m;return g};a.fromGlyph=function(c,f,b){var g=new a,m=new l;m.geometryType=f;m.sdf=!0;m.pattern=!1;m.visibility=!1;m.simplePattern=!1;g.texBindingInfo.push(new e(2,c.page,"u_texture"));0===b?m.vvOpacity=m.vvSizeMinMaxValue=m.vvSizeScaleStops=m.vvSizeFieldStops=m.vvSizeUnitValue=m.vvColor=m.vvRotation=!1:(m.vvOpacity=0!==(b&d.WGLVVFlag.OPACITY),m.vvSizeMinMaxValue=0!==(b&d.WGLVVFlag.SIZE_MINMAX_VALUE),m.vvSizeScaleStops=0!==(b&d.WGLVVFlag.SIZE_SCALE_STOPS),m.vvSizeFieldStops=0!==
(b&d.WGLVVFlag.SIZE_FIELD_STOPS),m.vvSizeUnitValue=0!==(b&d.WGLVVFlag.SIZE_UNIT_VALUE),m.vvColor=0!==(b&d.WGLVVFlag.COLOR),m.vvRotation=0!==(b&d.WGLVVFlag.ROTATION));g.materialKey=k.getMaterialKey(m);g.materialKeyInfo=m;return g};a.prototype.copy=function(a){this.materialParams=a.materialParams.map(function(a){return a.clone()});this.texBindingInfo=a.texBindingInfo.map(function(a){return a.clone()});a.materialKeyInfo&&(this.materialKeyInfo=new l,this.materialKeyInfo.copy(a.materialKeyInfo));this.materialKey=
a.materialKey};a.prototype.serialize=function(a){a.push(this.materialKey);g.serializeList(a,this.texBindingInfo);g.serializeList(a,this.materialParams);return a};a.deserialize=function(f){var m=new a;m.materialKey=f.readInt32();m.texBindingInfo=g.deserializeList(f,e);m.materialParams=g.deserializeList(f,c);m.materialKeyInfo=new l;b(m.materialKeyInfo,m.materialKey);return m};return a}();a.default=h})},"esri/views/2d/engine/webgl/MaterialInfoUtils_updateMaterialVariations":function(){define(["require",
"exports"],function(h,a){return function(a,k){a.geometryType=k&7;k>>=3;a.sdf=0!==(k&4);a.vvSizeMinMaxValue=0!==(k&8);a.vvSizeScaleStops=0!==(k&16);a.vvSizeFieldStops=0!==(k&32);a.vvSizeUnitValue=0!==(k&64);a.vvColor=0!==(k&128);a.vvRotation=0!==(k&256);a.vvOpacity=0!==(k&512);a.visibility=0!==(k&1024);a.pattern=0!==(k&2048);a.simplePattern=0!==(k&4096);return a}})},"esri/views/2d/engine/webgl/MaterialKeyInfo":function(){define(["require","exports"],function(h,a){return function(){function a(){this.simplePattern=
this.pattern=this.visibility=this.vvOpacity=this.vvRotation=this.vvColor=this.vvSizeUnitValue=this.vvSizeFieldStops=this.vvSizeScaleStops=this.vvSizeMinMaxValue=this.sdf=!1}a.prototype.copy=function(a){this.geometryType=a.geometryType;this.sdf=a.sdf;this.vvSizeMinMaxValue=a.vvSizeMinMaxValue;this.vvSizeScaleStops=a.vvSizeScaleStops;this.vvSizeFieldStops=a.vvSizeFieldStops;this.vvSizeUnitValue=a.vvSizeUnitValue;this.vvColor=a.vvColor;this.vvRotation=a.vvRotation;this.vvOpacity=a.vvOpacity;this.visibility=
a.visibility;this.pattern=a.pattern;this.simplePattern=a.simplePattern};a.prototype.hasVV=function(){void 0===this._hasVV&&(this._hasVV=this.vvColor||this.vvOpacity||this.vvRotation||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue);return this._hasVV};a.prototype.hasVVSize=function(){return this.vvSizeMinMaxValue||this.vvSizeFieldStops||this.vvSizeScaleStops||this.vvSizeUnitValue};a.prototype.hasVVColor=function(){return this.vvColor};a.prototype.hasVVRotation=
function(){return this.vvRotation};a.prototype.hasVVOpacity=function(){return this.vvOpacity};a.prototype.isMapAligned=function(){return this.vvRotation};return a}()})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.serializeList=function(a,k){if(null===k)a.push(0);else{a.push(k.length);for(var b=0;b<k.length;b++)k[b].serialize(a);return a}};a.deserializeList=function(a,k,b){for(var l=a.readInt32(),
l=Array(l),g=0;g<l.length;g++)l[g]=k.deserialize(a,b);return l}})},"esri/views/2d/engine/webgl/util/Result":function(){define(["require","exports","../../../../../core/Error"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.ok=function(a,b){return a&&"name"in a?(b&&b.error(new d(a.name,a.message,a.details)),!1):!0}})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["require","exports","./sources/resolver","../../../../webgl/programUtils"],function(h,a,d,
k){Object.defineProperty(a,"__esModule",{value:!0});var b=function(a){return k.glslifyDefineMap({ID:a.id,HIGHLIGHT:a.highlight,SDF:a.isSDF,VV_SIZE_MIN_MAX_VALUE:a.vvSizeMinMaxValue,VV_SIZE_SCALE_STOPS:a.vvSizeScaleStops,VV_SIZE_FIELD_STOPS:a.vvSizeFieldStops,VV_SIZE_UNIT_VALUE:a.vvSizeUnitValue,VV_COLOR:a.vvColor,VV_ROTATION:a.vvRotation,VV_OPACITY:a.vvOpacity,VERTEX_VISIBILITY:a.visibility,PATTERN:a.pattern})};b;a.fill={name:"fill",shaders:function(a){return{vertexShader:b(a)+d.resolveIncludes("materials/fill/fill.vert"),
fragmentShader:b(a)+d.resolveIncludes("materials/fill/fill.frag")}},attributes:{a_pos:0,a_id:1,a_color:2,a_tlbr:3,a_aux1:4,a_aux2:5,a_vv:6,a_visible:7}};a.icon={name:"icon",shaders:function(a){return{vertexShader:b(a)+d.resolveIncludes("materials/icon/icon.vert"),fragmentShader:b(a)+d.resolveIncludes("materials/icon/icon.frag")}},attributes:{a_pos:0,a_vertexOffsetAndTex:1,a_id:2,a_color:3,a_outlineColor:4,a_sizeAndOutlineWidth:5,a_vv:6,a_visible:8}};a.label={name:"label",shaders:function(a){return{vertexShader:b(a)+
d.resolveIncludes("materials/label/label.vert"),fragmentShader:b(a)+d.resolveIncludes("materials/label/label.frag")}},attributes:{a_pos:0,a_color:1,a_vertexOffset:2,a_texAndSize:3,a_refSymbolAndPlacementOffset:4,a_vvSize:5,a_visible:6,a_visibilityRange:7}};a.line={name:"line",shaders:function(a){return{vertexShader:b(a)+d.resolveIncludes("materials/line/line.vert"),fragmentShader:b(a)+d.resolveIncludes("materials/line/line.frag")}},attributes:{a_pos:0,a_id:1,a_color:2,a_offsetAndNormal:3,a_accumulatedDistanceAndHalfWidth:4,
a_tlbr:5,a_segmentDirection:6,a_vv:7,a_visible:8}};a.text={name:"text",shaders:function(a){return{vertexShader:b(a)+d.resolveIncludes("materials/text/text.vert"),fragmentShader:b(a)+d.resolveIncludes("materials/text/text.frag")}},attributes:{a_pos:0,a_id:1,a_color:2,a_vertexOffset:3,a_texFontSize:4,a_visible:5,a_vv:6}}})},"esri/views/2d/engine/webgl/TextureManager":function(){define("require exports ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../config ../../../../core/asyncUtils ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ./CIMSymbolHelper ./fontUtils ./GlyphMosaic ./GlyphSource ./SDFConverter ./SDFHelper ./SpriteMosaic ./Utils ../../../3d/support/imageUtils".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w,r,t,A){function C(a){if(a.type){switch(t.normalizeSymbolType(a.type)){case "simple-marker":return a.path?"simple-marker"+a.style+a.path:"simple-marker"+a.style;case "simple-line":return"simple-line"+a.style+a.cap;case "simple-fill":return"simple-fill"+a.style}if(t.isPictureSymbol(a))return a.url?a.url:a.imageData+(""+a.width+a.height)}return JSON.stringify(a)}var z=e.getLogger("esri.views.2d.engine.webgl.TextureManager");return function(){function a(){this._invalidFontsMap=
new Map;this._sdfConverter=new u.default(126);this._spriteMosaic=new r(1024,1024,250);this._glyphSource=new x(b.fontsUrl+"/{fontstack}/{range}.pbf");this._glyphMosaic=new p(1024,1024,this._glyphSource)}Object.defineProperty(a.prototype,"sprites",{get:function(){return this._spriteMosaic},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glyphs",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._spriteMosaic.dispose();this._glyphMosaic.dispose();
this._rasterizationCanvas=null};a.prototype.rasterizeItem=function(a,f){void 0===f&&(f=null);return a?a.type&&-1!==a.type.toLowerCase().indexOf("3d")?(z.error(new g("mapview-invalid-type","MapView does not support 3d symbol type: "+a.type,a)),c.resolve({glyphMosaicItems:[],spriteMosaicItem:null})):!a.type||"text"!==a.type&&"esriTS"!==a.type?l.safeCast(this._rasterizeSpriteSymbol(a)).then(function(a){return{spriteMosaicItem:a}}):this._rasterizeTextSymbol(a,f).then(function(a){return{glyphMosaicItems:a}}):
(z.error(new g("mapview-null-resource","Unable to rasterize null resource")),c.resolve(null))};a.prototype.bindSpritePage=function(a,c,f,b){b||(b=9729);this._spriteMosaic.bind(a,b,c,f)};a.prototype.bindGlyphsPage=function(a,c,f){this._glyphMosaic.bind(a,9729,c,f)};a.prototype._rasterizeTextSymbol=function(a,c){var f=this,b=m.getFullyQualifiedFontName(a.font);a=this._invalidFontsMap.has(b);return this._glyphMosaic.getGlyphItems(a?"arial-unicode-ms-regular":b,c).catch(function(a){z.error(new g("mapview-invalid-resource",
"Couldn't find font "+b+". Falling back to Arial Unicode MS Regular"));f._invalidFontsMap.set(b,!0);return f._glyphMosaic.getGlyphItems("arial-unicode-ms-regular",c)})};a.prototype._rasterizeSpriteSymbol=function(a){return d(this,void 0,void 0,function(){var c,f,b,e,g,m,l;return k(this,function(d){if(a&&(t.isFillSymbol(a)||t.isLineSymbol(a))&&"style"in a&&("solid"===a.style||"esriSFSSolid"===a.style||"esriSLSSolid"===a.style||"none"===a.style||"esriSFSNull"===a.style||"esriSLSNull"===a.style))return[2,
null];c=C(a);if(this._spriteMosaic.has(c))return[2,this._spriteMosaic.getSpriteItem(c)];if(("simple-marker"===a.type||"esriSMS"===a.type)&&a.path)return[2,this._handleSVG(a,c)];if(a.url||a.imageData)return[2,this._handleImage(a,c)];f=this._rasterizeResource(a);b=f.size;e=f.anchor;g=f.image;m=f.sdf;l=f.simplePattern;return[2,this._addItemToMosaic(c,b,e,g,!t.isMarkerSymbol(a),m,l)]})})};a.prototype._handleSVG=function(a,c){return d(this,void 0,void 0,function(){var f,b;return k(this,function(e){switch(e.label){case 0:return f=
[126,126],[4,this._sdfConverter.draw(a.path)];case 1:return b=e.sent(),[2,this._addItemToMosaic(c,f,[0,0],new Uint32Array(b.buffer),!1,!0,!0)]}})})};a.prototype._handleImage=function(a,c){return d(this,void 0,void 0,function(){var f,b,e,m,l,d,p;return k(this,function(k){switch(k.label){case 0:f=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url,k.label=1;case 1:return k.trys.push([1,3,,4]),[4,A.requestImage(f)];case 2:return b=k.sent(),e=this._rasterizeResource(b),m=e.size,l=e.anchor,
d=e.sdf,p=e.image,[2,this._addItemToMosaic(c,m,l,p,!t.isMarkerSymbol(a),d,!1)];case 3:return k.sent(),[2,new g("mapview-invalid-resoure","Could not fetch requested resource at "+f)];case 4:return[2]}})})};a.prototype._rasterizeResource=function(a){if(a instanceof HTMLImageElement){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));this._rasterizationCanvas.width=a.width;this._rasterizationCanvas.height=a.height;var c=this._rasterizationCanvas.getContext("2d");
c.drawImage(a,0,0,a.width,a.height);for(var c=c.getImageData(0,0,a.width,a.height),c=new Uint8Array(c.data),f=void 0,b=0;b<c.length;b+=4)f=c[b+3]/255,c[b]*=f,c[b+1]*=f,c[b+2]*=f;var f=a.width,b=a.height,e=c;if(512<=f||512<=b)e=a.width/a.height,1<e?(f=512,b=Math.round(512/e)):(b=512,f=Math.round(512*e)),e=new Uint8Array(4*f*b),t.resampleHermite(c,a.width,a.height,new Uint8ClampedArray(e.buffer),f,b,!1);return{size:[f,b],anchor:[0,0],image:new Uint32Array(e.buffer),sdf:!1,simplePattern:!1}}return this._rasterizeJSON(a)};
a.prototype._addItemToMosaic=function(a,c,f,b,e,g,m){return this._spriteMosaic.addSpriteItem(a,c,f,b,e,g,m)};a.prototype._rasterizeJSON=function(a){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));if("simple-fill"===a.type||"esriSFS"===a.type){var c=f.SymbolHelper.rasterizeSimpleFill(this._rasterizationCanvas,a.style);a=c[0];var b=c[1],c=c[2];return{size:[b,c],anchor:[0,0],image:new Uint32Array(a.buffer),sdf:!1,simplePattern:!0}}if("simple-line"===a.type||"esriSLS"===
a.type)return c=f.SymbolHelper.rasterizeSimpleLine(this._rasterizationCanvas,a.style,a.cap),a=c[0],b=c[1],c=c[2],{size:[b,c],anchor:[0,0],image:new Uint32Array(a.buffer),sdf:!0,simplePattern:!0};"simple-marker"===a.type||"esriSMS"===a.type?(a=f.CIMSymbolHelper.fromSimpleMarker(a),b=!0):b=w.SDFHelper.checkSDF(a);if(b)return b=(new w.SDFHelper).buildSDF(a),a=b[0],{size:[b[1],b[2]],anchor:[0,0],image:new Uint32Array(a.buffer),sdf:!0,simplePattern:!0};var e=f.CIMSymbolHelper.rasterize(this._rasterizationCanvas,
a);a=e[0];b=e[1];c=e[2];return{size:[b,c],anchor:[e[3],e[4]],image:new Uint32Array(a.buffer),sdf:!1,simplePattern:!1}};return a}()})},"esri/views/2d/engine/webgl/CIMSymbolHelper":function(){define("require exports ../../../../core/Logger ./CIMSymbolDrawHelper ./SDFHelper ../../../vectorTiles/GeometryUtils".split(" "),function(h,a,d,k,b,l){Object.defineProperty(a,"__esModule",{value:!0});var g=d.getLogger("esri/views/2d/engine/webgl/CIMSymbolHelper");h=function(){function a(){}a.getEnvelope=function(a){if("CIMPointSymbol"!==
a.type)return null;var c=new k.EnvDrawHelper;c.drawSymbol(a,{type:"point",x:0,y:0});return c.envelope()};a.rasterize=function(a,f){var c=this.getEnvelope(f);if(!c||0>=c.width||0>=c.height)return[null,0,0,0,0];var b=96/72,e=(c.x+.5*c.width)*b,g=-(c.y+.5*c.height)*b;a.width=c.width*b+2;a.height=c.height*b+2;c=a.getContext("2d");b=k.Transformation.createScale(b,-b);b.translate(.5*a.width-e,.5*a.height-g);(new k.CanvasDrawHelper(c,b)).drawSymbol(f,{type:"point",x:0,y:0});f=c.getImageData(0,0,a.width,
a.height);f=new Uint8Array(f.data);for(c=0;c<f.length;c+=4)b=f[c+3]/255,f[c]*=b,f[c+1]*=b,f[c+2]*=b;return[f,a.width,a.height,e/a.width,g/a.height]};a.fromSimpleMarker=function(a){var c,b,e=a.style;if("circle"===e||"esriSMSCircle"===e){c=Math.acos(.995);b=Math.ceil(l.C_PI/c/4);0===b&&(b=1);c=l.C_PI_BY_2/b;b*=4;e=[];e.push([50,0]);for(var g=1;g<b;g++)e.push([50*Math.cos(g*c),-50*Math.sin(g*c)]);e.push([50,0]);c={rings:[e]};b={xmin:-50,ymin:-50,xmax:50,ymax:50}}else if("cross"===e||"esriSMSCross"===
e)c=0,c={rings:[[[c,50],[c,c],[50,c],[50,-c],[c,-c],[c,-50],[-c,-50],[-c,-c],[-50,-c],[-50,c],[-c,c],[-c,50],[c,50]]]},b={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("diamond"===e||"esriSMSDiamond"===e)c={rings:[[[-50,0],[0,50],[50,0],[0,-50],[-50,0]]]},b={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("square"===e||"esriSMSSquare"===e)c={rings:[[[-50,-50],[-50,50],[50,50],[50,-50],[-50,-50]]]},b={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("x"===e||"esriSMSX"===e)c=0,c={rings:[[[0,c],[50-c,50],[50,50-
c],[c,0],[50,c-50],[50-c,-50],[0,-c],[c-50,-50],[-50,c-50],[-c,0],[-50,50-c],[c-50,50],[0,c]]]},b={xmin:-50,ymin:-50,xmax:50,ymax:50};else if("triangle"===e||"esriSMSTriangle"===e)b=2/3*100,e=b-100,c={rings:[[[-57.735026918962575,e],[0,b],[57.735026918962575,e],[-57.735026918962575,e]]]},b={xmin:-57.735026918962575,ymin:e,xmax:57.735026918962575,ymax:b};var d;c&&b&&(d=[{type:"CIMSolidFill",enable:!0,color:a.color}],a.outline&&d.push({type:"CIMSolidStroke",enable:!0,width:a.outline.width,color:a.outline.color}),
d={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:a.angle,size:a.size,offsetX:a.xoffset,offsetY:a.yoffset,frame:b,markerGraphics:[{type:"CIMMarkerGraphic",geometry:c,symbol:{type:"CIMPolygonSymbol",symbolLayers:d}}]}]});return d};return a}();a.CIMSymbolHelper=h;h=function(){function a(){}a.rasterizeSimpleFill=function(a,f){"solid"!==f&&"none"!==f&&"esriSFSSolid"!==f&&"esriSFSNull"!==f||console.error("Unexpected: style does not require rasterization");a.width=8;a.height=
8;var c=a.getContext("2d");c.strokeStyle="#FFFFFF";c.beginPath();if("vertical"===f||"cross"===f||"esriSFSCross"===f||"esriSFSVertical"===f)c.moveTo(0,0),c.lineTo(0,8);if("horizontal"===f||"cross"===f||"esriSFSCross"===f||"esriSFSHorizontal"===f)c.moveTo(0,0),c.lineTo(8,0);if("forward-diagonal"===f||"diagonal-cross"===f||"esriSFSDiagonalCross"===f||"esriSFSForwardDiagonal"===f)c.moveTo(0,0),c.lineTo(8,8);if("backward-diagonal"===f||"diagonal-cross"===f||"esriSFSBackwardDiagonal"===f||"esriSFSDiagonalCross"===
f)c.moveTo(8,0),c.lineTo(0,8);c.stroke();f=c.getImageData(0,0,a.width,a.height);f=new Uint8Array(f.data);for(var b=0;b<f.length;b+=4)c=f[b+3]/255,f[b]*=c,f[b+1]*=c,f[b+2]*=c;return[f,a.width,a.height]};a.rasterizeSimpleLine=function(a,f,b){switch(b){case "butt":b="Butt";break;case "square":b="Square";break;default:b="Round"}var c="Butt"===b;switch(f){case "dash":case "esriSLSDash":f=c?[4,3]:[3,4];break;case "dash-dot":case "esriSLSDashDot":f=c?[4,3,1,3]:[3,4,0,4];break;case "dot":case "esriSLSDot":f=
c?[1,3]:[0,4];break;case "long-dash":case "esriSLSLongDash":f=c?[8,3]:[7,4];break;case "long-dash-dot":case "esriSLSLongDashDot":f=c?[8,3,1,3]:[7,4,0,4];break;case "long-dash-dot-dot":case "esriSLSDashDotDot":f=c?[8,3,1,3,1,3]:[7,4,0,4,0,4];break;case "short-dash":case "esriSLSShortDash":f=c?[4,1]:[3,2];break;case "short-dash-dot":case "esriSLSShortDashDot":f=c?[4,1,1,1]:[3,2,0,2];break;case "short-dash-dot-dot":case "esriSLSShortDashDotDot":f=c?[4,1,1,1,1,1]:[3,2,0,2,0,2];break;case "short-dot":case "esriSLSShortDot":f=
c?[1,1]:[0,2];break;case "solid":case "esriSLSSolid":case "none":g.error("Unexpected: style does not require rasterization");f=[0,0];break;default:g.error("Tried to rasterize SLS, but found an unexpected style: "+f+"!"),f=[0,0]}return this.rasterizeDash(a,f,b)};a.rasterizeDash=function(a,f,e){a="Butt"===e;var c="Square"===e;e=!a&&!c;for(var g=0,m=0;m<f.length;m++)var l=f[m],g=g+l;for(var g=15*g,d=31*g,m=new Float32Array(d),k=e?225:15,l=0;l<d;++l)m[l]=k;for(var k=d=0,h=!0,C=0;C<f.length;C++){for(var l=
f[C],d=k,k=k+15*l,z=d;z<k;){for(var v=0;31>v;){var l=v*g+z,y=e?(v-15)*(v-15):Math.abs(v-15);m[l]=h?a?Math.max(Math.max(d+7.5-z,y),Math.max(z-k+7.5,y)):y:e?Math.min((z-d)*(z-d)+y,(z-k)*(z-k)+y):c?Math.min(Math.max(z-d,y),Math.max(k-z,y)):Math.min(Math.max(z-d+7.5,y),Math.max(k+7.5-z,y));v++}z++}h=!h}f=m.length;a=new Uint8Array(4*f);for(l=0;l<f;++l)b.packFloat((e?Math.sqrt(m[l]):m[l])/15,a,4*l);return[a,g,31]};return a}();a.SymbolHelper=h})},"esri/views/2d/engine/webgl/CIMSymbolDrawHelper":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ./GeometryUtils ./Rect".split(" "),
function(h,a,d,k,b,l){Object.defineProperty(a,"__esModule",{value:!0});var g=function(){function a(a){this._t=a}a.createIdentity=function(){return new a([1,0,0,0,1,0])};a.prototype.clone=function(){return new a(this._t.slice())};a.prototype.transform=function(a){var c=this._t;return[c[0]*a[0]+c[1]*a[1]+c[2],c[3]*a[0]+c[4]*a[1]+c[5]]};a.createScale=function(c,f){return new a([c,0,0,0,f,0])};a.prototype.scale=function(a,f){var c=this._t;c[0]*=a;c[1]*=a;c[2]*=a;c[3]*=f;c[4]*=f;c[5]*=f;return this};a.prototype.scaleRatio=
function(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])};a.createTranslate=function(c,f){return new a([0,0,c,0,0,f])};a.prototype.translate=function(a,f){var c=this._t;c[2]+=a;c[5]+=f;return this};a.createRotate=function(c){var f=Math.cos(c);c=Math.sin(c);return new a([f,-c,0,c,f,0])};a.prototype.rotate=function(c){return this.multiply(a.createRotate(c))};a.prototype.multiply=function(a){var c=this._t;a=a._t;var b=c[1]*a[0]+c[4]*a[1],e=c[2]*a[0]+c[5]*a[1]+a[2],g=c[0]*a[3]+c[3]*a[4],
l=c[1]*a[3]+c[4]*a[4],d=c[2]*a[3]+c[5]*a[4]+a[5];c[0]=c[0]*a[0]+c[3]*a[1];c[1]=b;c[2]=e;c[3]=g;c[4]=l;c[5]=d;return this};return a}();a.Transformation=g;h=function(){function a(a){this._transfos=[];this._sizeTransfos=[];this._transfos.push(a||g.createIdentity());this._sizeTransfos.push(a?a.scaleRatio():1)}a.prototype.transformPt=function(a){return this._transfos[this._transfos.length-1].transform(a)};a.prototype.transformSize=function(a){return a*this._sizeTransfos[this._sizeTransfos.length-1]};a.prototype.back=
function(){return this._transfos[this._transfos.length-1]};a.prototype.push=function(a){var c=a.scaleRatio();a.multiply(this.back());this._transfos.push(a);this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*c)};a.prototype.pop=function(){this._transfos.splice(-1,1);this._sizeTransfos.splice(-1,1)};a.prototype.drawSolidFill=function(a,b){};a.prototype.drawSolidStroke=function(a,b,e){};a.prototype.drawSymbol=function(a,b){if(a)switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":this.drawMultiLayerSymbol(a,
b)}};a.prototype.drawMultiLayerSymbol=function(a,b){if(a&&(a=a.symbolLayers))for(var c=a.length;c--;){var f=a[c];if(f&&f.enable)switch(f.type){case "CIMSolidFill":this.drawSolidFill(b,f.color);break;case "CIMSolidStroke":this.drawSolidStroke(b,f.color,f.width);break;case "CIMVectorMarker":this.drawVectorMarker(f,b)}}};a.prototype.drawVectorMarker=function(a,f){if(a){var c=a.markerGraphics;if(c){var e=a.size,l=a.frame,d=l?l.ymax-l.ymin:0,d=e&&d?e/d:1,k=g.createIdentity();l&&k.translate(.5*-(l.xmax+
l.xmin),.5*-(l.ymax+l.ymin));var h=a.anchorPt;if(h){var t=h.x,h=h.y;"relative"===a.anchorPtUnits&&l&&(t*=(l.xmax-l.xmin)*d,h*=e);k.translate(-t,-h)}1!==d&&k.scale(d,d);a.rotation&&k.rotate(a.rotation*b.C_DEG_TO_RAD);k.translate(a.offsetX||0,a.offsetY||0);k.translate(f.x,f.y);this.push(k);for(a=0;a<c.length;a++)(f=c[a])&&this.drawSymbol(f.symbol,f.geometry);this.pop()}}};return a}();a.CIMSymbolDrawHelper=h;k=function(a){function c(){var c=a.call(this)||this;c._xmin=c._ymin=Infinity;c._xmax=c._ymax=
-Infinity;return c}d(c,a);c.prototype.envelope=function(){return new l(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)};c.prototype._merge=function(a,c){a[0]-c<this._xmin&&(this._xmin=a[0]-c);a[0]+c>this._xmax&&(this._xmax=a[0]+c);a[1]-c<this._ymin&&(this._ymin=a[1]-c);a[1]+c>this._ymax&&(this._ymax=a[1]+c)};c.prototype.drawSolidFill=function(a,c){c=0;for(a=a.rings;c<a.length;c++){var b=a[c],f=b?b.length:0;if(2<f){this._merge(this.transformPt(b[0]),0);for(var e=1;e<f;++e)this._merge(this.transformPt(b[e]),
0)}}};c.prototype.drawSolidStroke=function(a,c,b){c=.5*this.transformSize(b);b=0;for(a=a.rings||a.paths;b<a.length;b++){var f=a[b],e=f?f.length:0;if(1<e){this._merge(this.transformPt(f[0]),c);for(var g=1;g<e;++g)this._merge(this.transformPt(f[g]),c)}}};return c}(h);a.EnvDrawHelper=k;h=function(a){function c(c,b){b=a.call(this,b)||this;b._ctx=c;return b}d(c,a);c.prototype.drawSolidFill=function(a,c){var b=this._ctx;b.fillStyle="rgba("+Math.round(c[0])+","+Math.round(c[1])+","+Math.round(c[2])+","+
c[3]/255+")";b.beginPath();c=0;for(a=a.rings;c<a.length;c++){var f=a[c],e=f?f.length:0;if(2<e){var g=this.transformPt(f[0]);b.moveTo(g[0],g[1]);for(var l=1;l<e;++l)g=this.transformPt(f[l]),b.lineTo(g[0],g[1]);b.closePath()}}b.fill("evenodd")};c.prototype.drawSolidStroke=function(a,c,b){var f=this._ctx;f.strokeStyle="rgba("+Math.round(c[0])+","+Math.round(c[1])+","+Math.round(c[2])+","+c[3]/255+")";f.lineWidth=this.transformSize(b)+.5;f.beginPath();c=!!a.rings;b=0;for(a=a.rings||a.paths;b<a.length;b++){var e=
a[b],g=e?e.length:0;if(1<g){var l=this.transformPt(e[0]);f.moveTo(l[0],l[1]);for(var d=1;d<g;++d)l=this.transformPt(e[d]),f.lineTo(l[0],l[1]);c&&f.closePath()}}f.stroke()};return c}(h);a.CanvasDrawHelper=h})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["require","exports"],function(h,a){function d(a,l){a%=l;return 0<=a?a:a+l}Object.defineProperty(a,"__esModule",{value:!0});a.C_INFINITY=Number.POSITIVE_INFINITY;a.C_PI=Math.PI;a.C_2PI=2*a.C_PI;a.C_PI_BY_2=a.C_PI/2;a.C_RAD_TO_256=128/
a.C_PI;a.C_256_TO_RAD=a.C_PI/128;a.C_DEG_TO_256=256/360;a.C_DEG_TO_RAD=a.C_PI/180;a.C_SQRT2=1.414213562;a.C_SQRT2_INV=1/a.C_SQRT2;var k=1/Math.LN2;a.positiveMod=d;a.radToByte=function(b){return d(b*a.C_RAD_TO_256,256)};a.degToByte=function(b){return d(b*a.C_DEG_TO_256,256)};a.log2=function(a){return Math.log(a)*k};a.sqr=function(a){return a*a};a.clamp=function(a,l,g){return Math.min(Math.max(a,l),g)};a.interpolate=function(a,l,g){return a*(1-g)+l*g};a.between=function(a,l,g){return a>=l&&a<=g||a>=
g&&a<=l}})},"esri/views/2d/engine/webgl/Rect":function(){define(["require","exports"],function(h,a){return function(){function a(a,b,l,g){void 0===a&&(a=0);void 0===b&&(b=0);void 0===l&&(l=0);void 0===g&&(g=0);this.x=a;this.y=b;this.width=l;this.height=g}Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0});return a}()})},"esri/views/2d/engine/webgl/SDFHelper":function(){define(["require","exports","./Geometry","./Rect","../../../3d/webgl-engine/lib/Util"],
function(h,a,d,k,b){function l(a,e,c){b.packFloatRGBA(a,e,c)}Object.defineProperty(a,"__esModule",{value:!0});a.packFloat=l;h=function(){function a(){}a.checkSDF=function(a){return!0};a.prototype._extractGeometry=function(a){if(!a)return null;a=a.symbolLayers;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;a=a.markerGraphics;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;var c=a.geometry;if(!c||!c.rings)return null;a=[];for(var b=0,c=c.rings;b<c.length;b++){for(var e=[],g=0,l=c[b];g<
l.length;g++){var k=l[g];e.push(new d.Point(k[0],k[1]))}a.push(e)}return a};a.prototype._getEnvelope=function(a){for(var c=Infinity,b=-Infinity,e=Infinity,g=-Infinity,l=0;l<a.length;l++)for(var d=0,h=a[l];d<h.length;d++){var r=h[d];r.x<c&&(c=r.x);r.x>b&&(b=r.x);r.y<e&&(e=r.y);r.y>g&&(g=r.y)}return new k(c,e,b-c,g-e)};a.prototype.buildSDF=function(a){a=this._extractGeometry(a);if(!a)return null;var c=this._getEnvelope(a);if(0>=c.width||0>=c.height)return null;for(var b=Math.floor(31.5),e=(128-2*(b+
0+1))/Math.max(c.width,c.height),g=Math.round(c.width*e),l=Math.round(c.height*e),d=g+2*b,k=l+2*b,h=0;h<a.length;h++)for(var t=0,A=a[h];t<A.length;t++){var C=A[t];C.x-=c.x;C.y-=c.y;C.x*=e;C.y*=e;C.x+=b-.5;C.y+=b-.5}c=this._dist_map(a,d,k,b);this._sign_dist_map(a,d,k,b,c);return[this._encodeDistMap(c,b),d,k,g,l,e]};a.prototype._dist_map=function(a,c,b,g){for(var f=c*b,e=new Float32Array(f),l=g*g+1,d=0;d<f;++d)e[d]=l;for(l=0;l<a.length;l++)for(var m=a[l],k=m.length,d=1;d<k;++d){var h=m[d-1],C=m[d],
z=void 0,v=void 0;h.x<C.x?(z=h.x,v=C.x):(z=C.x,v=h.x);var y=void 0,D=void 0;h.y<C.y?(y=h.y,D=C.y):(y=C.y,D=h.y);var F=Math.floor(z)-g,v=Math.floor(v)+g,y=Math.floor(y)-g,D=Math.floor(D)+g;0>F&&(F=0);v>c&&(v=c);0>y&&(y=0);D>b&&(D=b);for(var z=C.x-h.x,G=C.y-h.y,E=z*z+G*G;F<v;F++)for(var J=y;J<D;J++){var H=(F-h.x)*z+(J-h.y)*G,I=void 0,K=void 0;0>H?(I=h.x,K=h.y):H>E?(I=C.x,K=C.y):(H/=E,I=h.x+H*z,K=h.y+H*G);H=(F-I)*(F-I)+(J-K)*(J-K);I=(b-J-1)*c+F;H<e[I]&&(e[I]=H)}}for(d=0;d<f;++d)e[d]=Math.sqrt(e[d]);
return e};a.prototype._sign_dist_map=function(a,c,b,g,l){for(var f=0;f<a.length;f++)for(var e=a[f],d=e.length,m=1;m<d;++m){var k=e[m-1],p=e[m],h=void 0,z=void 0;k.x<p.x?(h=k.x,z=p.x):(h=p.x,z=k.x);var v=void 0,y=void 0;k.y<p.y?(v=k.y,y=p.y):(v=p.y,y=k.y);h=Math.floor(h);z=Math.floor(z)+1;v=Math.floor(v);y=Math.floor(y)+1;h<g&&(h=g);z>c-g&&(z=c-g);v<g&&(v=g);for(y>b-g&&(y=b-g);v<y;++v)if(k.y>v!==p.y>v){for(var D=(b-v-1)*c,F=h;F<z;++F)F<(p.x-k.x)*(v-k.y)/(p.y-k.y)+k.x&&(l[D+F]=-l[D+F]);for(F=g;F<h;++F)l[D+
F]=-l[D+F]}}};a.prototype._encodeDistMap=function(a,c){c*=2;for(var b=a.length,e=new Uint8Array(4*b),g=0;g<b;++g)l(.5-a[g]/c,e,4*g);return e};return a}();a.SDFHelper=h})},"esri/views/2d/engine/webgl/Geometry":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,b){this.x=a;this.y=b}a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.equals=function(a,b){return a===this.x&&b===this.y};a.prototype.isEqual=
function(a){return a.x===this.x&&a.y===this.y};a.prototype.setCoords=function(a,b){this.x=a;this.y=b};a.prototype.normalize=function(){var a=this.x,b=this.y,a=Math.sqrt(a*a+b*b);this.x/=a;this.y/=a};a.prototype.rightPerpendicular=function(){var a=this.x;this.x=this.y;this.y=-a};a.prototype.move=function(a,b){this.x+=a;this.y+=b};a.prototype.assign=function(a){this.x=a.x;this.y=a.y};a.prototype.assignAdd=function(a,b){this.x=a.x+b.x;this.y=a.y+b.y};a.prototype.assignSub=function(a,b){this.x=a.x-b.x;
this.y=a.y-b.y};a.prototype.rotate=function(a,b){var l=this.x,g=this.y;this.x=l*a-g*b;this.y=l*b+g*a};a.prototype.scale=function(a){this.x*=a;this.y*=a};a.prototype.length=function(){var a=this.x,b=this.y;return Math.sqrt(a*a+b*b)};a.distance=function(a,b){var l=b.x-a.x;a=b.y-a.y;return Math.sqrt(l*l+a*a)};a.add=function(d,b){return new a(d.x+b.x,d.y+b.y)};a.sub=function(d,b){return new a(d.x-b.x,d.y-b.y)};return a}();a.Point=h})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/gl-matrix","../../support/mathUtils"],function(h,a,d,k){function b(a,c){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new t(c);}function l(a){for(var c in a)return c}function g(a,c){a[12]=c[0];a[13]=c[1];a[14]=c[2]}function e(a,c){void 0===c&&(c=0);for(var b=0,f=0;4>f;f++)b+=a[c+f]*C[f];return b}function c(a){return a-Math.floor(a)}Object.defineProperty(a,"__esModule",{value:!0});var f=d.vec4f64.create(),m=d.vec2f64.create(),p=d.vec2f64.create(),
x=d.vec2f64.create(),u=d.vec2f64.create(),w=d.vec2f64.create(),r=d.vec2f64.create(),t=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};return a}();a.AssertException=t;a.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"};a.assert=b;a.verify=function(a,
c){a||(console.log("Verify failed: "+c),console.log(Error("dummy").stack))};a.encodeInt16=function(a){return k.clamp(Math.round(32767*a),-32767,32767)};a.encodeNormal=function(a,c){var b=Math.abs(a[0]),f=Math.abs(a[1]),e=1/(b+f+Math.abs(a[2])),g=Math.min(a[2]*e,0);c[0]=(0>a[0]?-1:1)*(b*e-g);c[1]=(0>a[1]?-1:1)*(f*e-g)};a.fallbackIfUndefined=function(a,c){return void 0===a?c:a};a.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};a.rgb2hex=function(a){var c=k.clamp(Math.round(255*
a[0]),0,255),b=k.clamp(Math.round(255*a[1]),0,255);a=k.clamp(Math.round(255*a[2]),0,255);return"0x"+((c<<16)+(b<<8)+a).toString(16)};a.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};a.rayTriangle3D=function(a,c,b,f,e,g,l,m,k){void 0===k&&(k=d.vec3f64.create());var p=f[l]-b[g],h=f[l+1]-b[g+1],v=f[l+2]-b[g+2];f=e[m]-b[g];l=e[m+1]-b[g+1];e=e[m+2]-b[g+2];var t=c[1]*e-l*c[2],x=c[2]*f-e*c[0],y=c[0]*l-f*c[1];m=p*t+h*x+v*y;if(-1E-5<m&&1E-5>m)return!1;m=1/m;var u=a[0]-b[g],r=
a[1]-b[g+1];a=a[2]-b[g+2];k[1]=m*(u*t+r*x+a*y);if(0>k[1]||1<k[1])return!1;b=r*v-h*a;a=a*p-v*u;p=u*h-p*r;k[2]=m*(c[0]*b+c[1]*a+c[2]*p);if(0>k[2]||1<k[1]+k[2])return!1;k[0]=m*(f*b+l*a+e*p);return!0};a.rayBoxTest=function(a,c,b,f){var e,g=(b[0]-a[0])/c[0],l=(f[0]-a[0])/c[0];g>l&&(e=g,g=l,l=e);var d=(b[1]-a[1])/c[1],m=(f[1]-a[1])/c[1];d>m&&(e=d,d=m,m=e);if(g>m||d>l)return!1;d>g&&(g=d);m<l&&(l=m);b=(b[2]-a[2])/c[2];a=(f[2]-a[2])/c[2];b>a&&(e=b,b=a,a=e);if(g>a||b>l)return!1;a<l&&(l=a);return 0>l?!1:!0};
a.rayRay2D=function(a,c,b,f,e,g){void 0===g&&(g=d.vec2f64.create());var l=(f[e]-b[e])*(c[0]-a[0])-(f[0]-b[0])*(c[e]-a[e]);if(0===l)return!1;b=((f[0]-b[0])*(a[e]-b[e])-(f[e]-b[e])*(a[0]-b[0]))/l;g[0]=a[0]+b*(c[0]-a[0]);g[1]=a[e]+b*(c[e]-a[e]);return!0};a.project=function(a,c,e,g,l){l||(l=a);f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=1;d.vec4.transformMat4(f,f,c);2<l.length&&(l[2]=-f[2]);d.vec4.transformMat4(f,f,e);b(0!==f[3]);l[0]=f[0]/f[3];l[1]=f[1]/f[3];l[2]=f[2]/f[3];l[0]=(.5*l[0]+.5)*g[2]+g[0];l[1]=(.5*
l[1]+.5)*g[3]+g[1]};a.getFirstObjectKey=l;a.getFirstObjectValue=function(a){return a[l(a)]};a.objectEmpty=function(a){for(var c in a)return!1;return!0};a.logWithBase=function(a,c){return Math.log(a)/Math.log(c)};a.setMatrixTranslation=g;a.setMatrixTranslation3=function(a,c,b,f){a[12]=c;a[13]=b;a[14]=f};a.getMatrixTranslation=function(a,c){void 0===c&&(c=d.vec3f64.create());c[0]=a[12];c[1]=a[13];c[2]=a[14];return c};a.createTranslationMatrix=function(a,c){a=d.mat4.identity(a);g(a,c);return a};a.isTranslationMatrix=
function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};a.fovx2fovy=function(a,c,b){return 2*Math.atan(b*Math.tan(.5*a)/c)};a.fovy2fovx=function(a,c,b){return 2*Math.atan(c*Math.tan(.5*a)/b)};a.fovx2fovd=function(a,c,b){return 2*Math.atan(Math.sqrt(c*c+b*b)*Math.tan(.5*a)/c)};a.fovy2fovd=function(a,c,b){return 2*Math.atan(Math.sqrt(c*c+b*b)*Math.tan(.5*a)/b)};a.fovd2fovx=function(a,c,b){return 2*Math.atan(c*
Math.tan(.5*a)/Math.sqrt(c*c+b*b))};a.fovd2fovy=function(a,c,b){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(c*c+b*b))};a.pointLineSegmentDistanceSquared2D=function(a,c,b){u[0]=c[0]-a[0];u[1]=c[1]-a[1];w[0]=b[0]-a[0];w[1]=b[1]-a[1];r[0]=b[0];r[1]=b[1];c=d.vec2.dot(w,u);b=d.vec2.dot(u,u);c=k.clamp(c/b,0,1);x[0]=u[0]*c;x[1]=u[1]*c;m[0]=a[0]+x[0];m[1]=a[1]+x[1];d.vec2.subtract(p,r,m);a=d.vec2.dot(p,p);c=d.vec2.dot(w,w);b=d.vec2.dot(u,u);var f=d.vec2.dot(x,x);if(f>c||f>b)a=Number.MAX_VALUE;return a};
a.packFloatRGBA=function(a,b,f){void 0===f&&(f=0);a=k.clamp(a,0,z);for(var e=0;4>e;e++)b[f+e]=Math.floor(256*c(a*A[e]))};a.unpackFloatRGBA=e;var A=[1,256,65536,16777216],C=[1/256,1/65536,1/16777216,1/4294967296],z=e(new Uint8ClampedArray([255,255,255,255]));a.inverseProjectionInfo=function(a,c,b,f,e){0===a[11]?(f[0]=2/(c*a[0]),f[1]=2/(b*a[5]),f[2]=(1+a[12])/a[0],f[3]=(1+a[13])/a[5],d.vec2.set(e,0,1)):(f[0]=-2/(c*a[0]),f[1]=-2/(b*a[5]),f[2]=(1-a[8])/a[0],f[3]=(1-a[9])/a[5],d.vec2.set(e,1,0))}})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require",
"exports"],function(h,a){function d(a,l){a%=l;return 0<=a?a:a+l}Object.defineProperty(a,"__esModule",{value:!0});a.C_INFINITY=Number.POSITIVE_INFINITY;a.C_PI=Math.PI;a.C_2PI=2*a.C_PI;a.C_PI_BY_2=a.C_PI/2;a.C_RAD_TO_256=128/a.C_PI;a.C_256_TO_RAD=a.C_PI/128;a.C_DEG_TO_256=256/360;a.C_DEG_TO_RAD=a.C_PI/180;a.C_SQRT2=1.414213562;a.C_SQRT2_INV=1/a.C_SQRT2;var k=1/Math.LN2;a.positiveMod=d;a.radToByte=function(b){return d(b*a.C_RAD_TO_256,256)};a.degToByte=function(b){return d(b*a.C_DEG_TO_256,256)};a.log2=
function(a){return Math.log(a)*k};a.sqr=function(a){return a*a};a.clamp=function(a,l,g){return Math.min(Math.max(a,l),g)};a.interpolate=function(a,l,g){return a*(1-g)+l*g};a.between=function(a,l,g){return a>=l&&a<=g||a>=g&&a<=l}})},"esri/views/2d/engine/webgl/fontUtils":function(){define(["require","exports"],function(h,a){function d(a){a=a.toLowerCase().split(" ").join("-");switch(a){case "serif":return"noto-serif";case "sans-serif":return"arial-unicode-ms";case "monospace":return"ubuntu-mono";case "fantasy":return"cabin-sketch";
case "cursive":return"redressed";default:return a}}Object.defineProperty(a,"__esModule",{value:!0});a.getFullyQualifiedFontName=function(a){var b;a:{if(a.weight)switch(a.weight.toLowerCase()){case "bold":case "bolder":b="-bold";break a}b=""}var l;a:{if(a.style)switch(a.style.toLowerCase()){case "italic":case "oblic":l="-italic";break a}l=""}b+=l;return d(a.family)+(0<b.length?b:"-regular")};a.getFontDecorationTop=function(a){switch(a.decoration.toLowerCase()){case "underline":return-26;case "line-through":return-18}return NaN}})},
"esri/views/2d/engine/webgl/GlyphMosaic":function(){define("require exports ../../../../core/has ../../../../core/promiseUtils ./Rect ./RectangleBinPack ../../../webgl/Texture".split(" "),function(h,a,d,k,b,l,g){return function(){function a(a,b,e){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=new Map;this.width=a;this.height=b;this._glyphSource=e;this._binPack=new l(a-4,b-4);this._glyphData.push(new Uint8Array(a*
b));this._dirties.push(!0);this._textures.push(void 0);this._addDecorationGlyph()}a.prototype.getGlyphItems=function(a,b){for(var c=this,f=[],e=this._glyphSource,g=new Set,l=1/256,d=0;d<b.length;d++)g.add(Math.floor(b[d]*l));var h=[];g.forEach(function(b){if(256>=b){var f=a+b;c._rangePromises.has(f)?h.push(c._rangePromises.get(f)):(b=e.getRange(a,b).then(function(){c._rangePromises["delete"](f)}).catch(function(){c._rangePromises["delete"](f);throw Error("Unable to query resource");}),c._rangePromises.set(f,
b),h.push(b))}});return k.all(h).then(function(g){var l=c._glyphIndex[a];l||(l={},c._glyphIndex[a]=l);for(var d=0;d<b.length;d++){g=b[d];var m=l[g];if(m)f[g]={rect:m.rect,metrics:m.metrics,page:m.page};else if((m=e.getGlyph(a,g))&&m.metrics){var k=c._recordGlyph(m,g);l[g]={rect:k,metrics:m.metrics,tileIDs:null,page:c._currentPage};f[g]={rect:k,metrics:m.metrics,page:c._currentPage};c._dirties[c._currentPage]=!0}}return f})};a.prototype._recordGlyph=function(a,f){var c=a.metrics;if(0===c.width)c=new b(0,
0,0,0);else{f=c.width+6;var e=c.height+6,g=f%4?4-f%4:4,d=e%4?4-e%4:4;1===g&&(g=5);1===d&&(d=5);c=this._binPack.allocate(f+g,e+d);c.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new l(this.width-4,this.height-4),c=this._binPack.allocate(f+g,e+d));g=this._glyphData[this._currentPage];a=a.bitmap;
var k=d=void 0;if(a)for(var h=0;h<e;h++)for(var d=f*h,k=this.width*(c.y+h+1)+c.x,t=0;t<f;t++)g[k+t+1]=a[d+t]}return c};a.prototype._addDecorationGlyph=function(){for(var a=[117,149,181,207,207,181,149,117],b=[],e=0;e<a.length;e++)for(var g=a[e],l=0;11>l;l++)b.push(g);a={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(b)};this._recordGlyph(a,0)};a.prototype.bind=function(a,b,e,l){this._textures[e]||(this._textures[e]=new g(a,{pixelFormat:6406,dataType:5121,width:this.width,
height:this.height},new Uint8Array(this.width*this.height)));var c=this._textures[e];c.setSamplingMode(b);this._dirties[e]&&c.setData(this._glyphData[e]);a.bindTexture(c,l);this._dirties[e]=!1};a.prototype.dispose=function(){this._binPack=null;for(var a=0,b=this._textures;a<b.length;a++){var e=b[a];e&&e.dispose()}this._textures.length=0;this._glyphData.length=0};return a}()})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["require","exports","./Rect"],function(h,a,d){return function(){function a(a,
l){this._height=this._width=0;this._free=[];this._width=a;this._height=l;this._free.push(new d(0,0,a,l))}Object.defineProperty(a.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});a.prototype.allocate=function(a,l){if(a>this._width||l>this._height)return new d;for(var b=null,e=-1,c=0;c<this._free.length;++c){var f=this._free[c];a<=f.width&&l<=f.height&&
(null===b||f.y<=b.y&&f.x<=b.x)&&(b=f,e=c)}if(null===b)return new d;this._free.splice(e,1);b.width<b.height?(b.width>a&&this._free.push(new d(b.x+a,b.y,b.width-a,l)),b.height>l&&this._free.push(new d(b.x,b.y+l,b.width,b.height-l))):(b.width>a&&this._free.push(new d(b.x+a,b.y,b.width-a,b.height)),b.height>l&&this._free.push(new d(b.x,b.y+l,a,b.height-l)));return new d(b.x,b.y,a,l)};a.prototype.release=function(a){for(var b=0;b<this._free.length;++b){var g=this._free[b];if(g.y===a.y&&g.height===a.height&&
g.x+g.width===a.x)g.width+=a.width;else if(g.x===a.x&&g.width===a.width&&g.y+g.height===a.y)g.height+=a.height;else if(a.y===g.y&&a.height===g.height&&a.x+a.width===g.x)g.x=a.x,g.width+=a.width;else if(a.x===g.x&&a.width===g.width&&a.y+a.height===g.y)g.y=a.y,g.height+=a.height;else continue;this._free.splice(b,1);this.release(a)}this._free.push(a)};return a}()})},"esri/views/2d/engine/webgl/GlyphSource":function(){define(["require","exports","../../../../request","../../../../core/pbf","../../../../core/promiseUtils"],
function(h,a,d,k,b){var l=function(){function a(a){this._metrics=[];for(this._bitmaps=[];a.next();)switch(a.tag()){case 1:for(var c=a.getMessage();c.next();)switch(c.tag()){case 3:for(var b=c.getMessage(),e=void 0,g=void 0,l=void 0,d=void 0,k=void 0,h=void 0,A=void 0;b.next();)switch(b.tag()){case 1:e=b.getUInt32();break;case 2:g=b.getBytes();break;case 3:l=b.getUInt32();break;case 4:d=b.getUInt32();break;case 5:k=b.getSInt32();break;case 6:h=b.getSInt32();break;case 7:A=b.getUInt32();break;default:b.skip()}e&&
(this._metrics[e]={width:l,height:d,left:k,top:h,advance:A},this._bitmaps[e]=g);break;default:c.skip()}break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),g=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,b){this._ranges[a]=b};return a}();return function(){function a(a){this._glyphInfo={};this._baseURL=a}a.prototype.getRange=
function(a,f){var c=this._getFontStack(a);if(c.getRange(f))return b.resolve();var e=256*f,g=e+255;a=this._baseURL.replace("{fontstack}",a).replace("{range}",e+"-"+g);return d(a,{responseType:"array-buffer"}).then(function(a){c.addRange(f,new l(new k(new Uint8Array(a.data),new DataView(a.data))))})};a.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}};a.prototype._getFontStack=function(a){var c=
this._glyphInfo[a];c||(c=this._glyphInfo[a]=new g);return c};return a}()})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["require","exports","../../../../core/promiseUtils","./SDFHelper"],function(h,a,d,k){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a){this.size=a;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=a;this.context=this.canvas.getContext("2d");this._gridOuter=new Float64Array(a*a);this._gridInner=new Float64Array(a*
a);this._f=new Float64Array(a);this._d=new Float64Array(a);this._z=new Float64Array(a+1);this._v=new Int16Array(a);a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("style","position: absolute;");a.setAttribute("width","0");a.setAttribute("height","0");document.body.appendChild(a);this._svg=a}a.prototype.draw=function(a,b){var e=this;void 0===b&&(b=31);var c=this._createSVGString(a);return d.create(function(a){var f=new Image;f.src="data:image/svg+xml; charset\x3dutf8, "+
encodeURIComponent(c);f.onload=function(){e.context.clearRect(0,0,e.size,e.size);e.context.drawImage(f,0,0,e.size,e.size);for(var c=e.context.getImageData(0,0,e.size,e.size),g=new Uint8Array(e.size*e.size*4),l=0;l<e.size*e.size;l++){var d=c.data[4*l+3]/255;e._gridOuter[l]=1===d?0:0===d?1E20:Math.pow(Math.max(0,.5-d),2);e._gridInner[l]=1===d?1E20:0===d?0:Math.pow(Math.max(0,d-.5),2)}e._edt(e._gridOuter,e.size,e.size);e._edt(e._gridInner,e.size,e.size);for(l=0;l<e.size*e.size;l++)k.packFloat(.5-(e._gridOuter[l]-
e._gridInner[l])/(2*b),g,4*l);a(g)}})};a.prototype._createSVGString=function(a){var b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d",a);this._svg.appendChild(b);a=b.getBBox();var e=a.width/a.height,c=this.size/2,f,l,d;1<e?(l=f=c/a.width,d=this.size/4,e=c-1/e*c/2):(f=l=c/a.height,d=c-c*e/2,e=this.size/4);b.setAttribute("style","transform: matrix("+f+", 0, 0, "+l+", "+(-a.x*f+d)+", "+(-a.y*l+e)+")");a='\x3csvg style\x3d"fill:red;" height\x3d"'+this.size+'" width\x3d"'+
this.size+'" xmlns\x3d"http://www.w3.org/2000/svg"\x3e'+this._svg.innerHTML+"\x3c/svg\x3e";this._svg.removeChild(b);return a};a.prototype._edt=function(a,b,e){for(var c=this._f,f=this._d,g=this._v,l=this._z,d=0;d<b;d++){for(var k=0;k<e;k++)c[k]=a[k*b+d];this._edt1d(c,f,g,l,e);for(k=0;k<e;k++)a[k*b+d]=f[k]}for(k=0;k<e;k++){for(d=0;d<b;d++)c[d]=a[k*b+d];this._edt1d(c,f,g,l,b);for(d=0;d<b;d++)a[k*b+d]=Math.sqrt(f[d])}};a.prototype._edt1d=function(a,b,e,c,f){e[0]=0;c[0]=-1E20;c[1]=1E20;for(var g=1,l=
0;g<f;g++){for(var d=(a[g]+g*g-(a[e[l]]+e[l]*e[l]))/(2*g-2*e[l]);d<=c[l];)l--,d=(a[g]+g*g-(a[e[l]]+e[l]*e[l]))/(2*g-2*e[l]);l++;e[l]=g;c[l]=d;c[l+1]=1E20}for(l=g=0;g<f;g++){for(;c[l+1]<g;)l++;b[g]=(g-e[l])*(g-e[l])+a[e[l]]}};return a}();a.default=h})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define("require exports ./GeometryUtils ./Rect ./RectangleBinPack ../../../webgl/Texture".split(" "),function(h,a,d,k,b,l){return function(){function a(a,c,f){void 0===f&&(f=0);this._size=[];this._mosaicsData=
[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects=new Map;this._spriteCopyQueue=[];this.pixelRatio=1;(0>=a||0>=c)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=a;this._pageHeight=c;0<f&&(this._maxItemSize=f);this.pixelRatio=window.devicePixelRatio|1;this._binPack=new b(this._pageWidth,this._pageHeight);this._mosaicsData[0]=new Uint32Array(Math.floor(this._pageWidth)*
Math.floor(this._pageHeight));this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}a.prototype.getWidth=function(a){return a>=this._size.length?-1:this._size[a][0]};a.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]};a.prototype.getPage=function(a){return a<this._textures.length?this._textures[a]:null};a.prototype.has=function(a){return this._mosaicRects.has(a)};Object.defineProperty(a.prototype,"itemCount",{get:function(){return this._mosaicRects.size},
enumerable:!0,configurable:!0});a.prototype.getSpriteItem=function(a){return this._mosaicRects.get(a)};a.prototype.addSpriteItem=function(a,c,b,g,l,d,k){if(this._mosaicRects.has(a))return this._mosaicRects.get(a);var f=this._allocateImage(c[0],c[1]),e=f[0],m=f[1],f=f[2];if(0>=e.width||0>=e.height)return null;b={rect:e,width:c[0],height:c[1],anchorX:b[0],anchorY:b[1],sdf:d,simplePattern:k,pixelRatio:1,page:m};this._mosaicRects.set(a,b);this._copy({rect:e,spriteSize:c,spriteData:g,page:m,pageSize:f,
repeat:l,sdf:d});return b};a.prototype.hasItemsToProcess=function(){return 0!==this._spriteCopyQueue.length};a.prototype.processNextItem=function(){var a=this._spriteCopyQueue.pop();a&&this._copy(a)};a.prototype.getSpriteItems=function(a){for(var c={},b=0;b<a.length;b++){var e=a[b];c[e]=this.getSpriteItem(e)}return c};a.prototype.getMosaicItemPosition=function(a,c){c=(a=this.getSpriteItem(a))&&a.rect;if(!c)return null;c.width=a.width;c.height=a.height;return{size:[a.width,a.height],tl:[(c.x+1)/this._size[a.page][0],
(c.y+1)/this._size[a.page][1]],br:[(c.x+1+a.width)/this._size[a.page][0],(c.y+1+a.height)/this._size[a.page][1]],page:a.page}};a.prototype.bind=function(a,c,b,g){void 0===b&&(b=0);void 0===g&&(g=0);this._textures[b]||(this._textures[b]=new l(a,{pixelFormat:6408,dataType:5121,width:this._size[b][0],height:this._size[b][1]},new Uint8Array(this._mosaicsData[b].buffer)));var f=this._textures[b];f.setSamplingMode(c);this._dirties[b]&&(f.setData(new Uint8Array(this._mosaicsData[b].buffer)),f.generateMipmap());
a.bindTexture(f,g);this._dirties[b]=!1};a._copyBits=function(a,c,b,g,l,d,k,h,r,t,A){var f=g*c+b;k=h*d+k;if(A)for(k-=d,A=-1;A<=t;A++,f=((A+t)%t+g)*c+b,k+=d)for(h=-1;h<=r;h++)l[k+h]=a[f+(h+r)%r];else for(A=0;A<t;A++){for(h=0;h<r;h++)l[k+h]=a[f+h];f+=c;k+=d}};a.prototype._copy=function(b){if(!(b.page>=this._mosaicsData.length)){var c=b.spriteData,f=this._mosaicsData[b.page];f&&c||console.error("Source or target images are uninitialized!");a._copyBits(c,b.spriteSize[0],0,0,f,b.pageSize[0],b.rect.x+1,
b.rect.y+1,b.spriteSize[0],b.spriteSize[1],b.repeat);this._dirties[b.page]=!0}};a.prototype._allocateImage=function(a,c){a+=2;c+=2;var f=Math.max(a,c);if(this._maxItemSize&&this._maxItemSize<f){var f=Math.pow(2,Math.ceil(d.log2(a))),e=Math.pow(2,Math.ceil(d.log2(c)));a=new k(0,0,a,c);this._mosaicsData.push(new Uint32Array(f*e));this._dirties.push(!0);this._size.push([f,e]);this._textures.push(void 0);return[a,this._mosaicsData.length-1,[f,e]]}f=this._binPack.allocate(a+(a%4?4-a%4:0),c+(c%4?4-c%4:
0));return 0>=f.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new b(this._pageWidth,this._pageHeight),this._allocateImage(a,c)):[f,this._currentPage,[this._pageWidth,this._pageHeight]]};a.prototype.dispose=function(){this._binPack=
null;for(var a=0,c=this._textures;a<c.length;a++){var b=c[a];b&&b.dispose()}this._textures.length=0;this._mosaicsData.length=0;this._mosaicRects.clear()};return a}()})},"esri/views/2d/engine/webgl/Utils":function(){define("require exports ../../../../arcade/Dictionary ../../../../arcade/Feature ../../../../core/Error ../../../../core/Logger ../../../../core/screenUtils ../../../../geometry/support/quantizationUtils ../../../../support/arcadeUtils ./color ./enums ./SymbolProperties ../../../3d/support/mathUtils ../../../webgl/Texture".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u){function w(a){for(var c={},b=0;b<a.length;b++){var f=a[b];c[f.name]=f.strideInBytes}return c}function r(a){switch(a){case m.WGLGeometryType.MARKER:return H;case m.WGLGeometryType.FILL:return I;case m.WGLGeometryType.LINE:return K;case m.WGLGeometryType.TEXT:return N;case m.WGLGeometryType.LABEL:return O}return null}function t(a){switch(a%4){case 0:case 2:return 4;case 1:case 3:return 1}}function A(a){switch(a){case "esriSMS":return"simple-marker";case "esriPMS":return"picture-marker";
case "esriSLS":return"simple-line";case "esriPLS":return"picture-line";case "esriSFS":return"simple-fill";case "esriPFS":return"picture-fill";case "esriTS":return"text"}return a}function C(a){if(a=A(a.type)){switch(a){case "simple-marker":case "picture-marker":return!0;case "CIMPointSymbol":return!0}return!1}}function z(a){if(a=A(a.type)){switch(a){case "simple-fill":case "picture-fill":return!0;case "CIMPolygonSymbol":return!0}return!1}}function v(a){if(a=A(a.type)){switch(a){case "simple-line":case "picture-line":return!0;
case "CIMLineSymbol":return!0}return!1}}function y(a){if(a=A(a.type)){switch(a){case "text":return!0;case "CIMTextSymbol":return!0}return!1}}function D(a){return a&&a.length||0}function F(a){return"string"===typeof a}function G(a){var c={};switch(a){case "esriGeometryPoint":return function(a,b,f,g){return e.hydratePoint(b,c,a,f,g)};case "esriGeometryPolygon":return function(a,b,f,g){return e.hydratePolygon(b,c,a,f,g)};case "esriGeometryPolyline":return function(a,b,f,g){return e.hydratePolyline(b,
c,a,f,g)};case "esriGeometryMultipoint":return function(a,b,f,g){return e.hydrateMultipoint(b,c,a,f,g)};default:return J.error(new b("mapview-arcade","Unable to handle geometryType: "+a)),function(a,c,b,f){return a}}}Object.defineProperty(a,"__esModule",{value:!0});var E,J=l.getLogger("esri.views.2d.engine.webgl.Utils");a.C_HITTEST_SEARCH_SIZE=4;a.C_VBO_GEOMETRY="geometry";a.C_VBO_PERINSTANCE="per_instance";a.C_VBO_PERINSTANCE_VV="per_instance_vv";a.C_VBO_VISIBILITY="visibility";a.C_VBO_VISIBILITY_RANGE=
"visibilityRange";a.C_ICON_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_ICON_VERTEX_DEF_VV=[{name:a.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_FILL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:28,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_FILL_VERTEX_DEF_VV=[{name:a.C_VBO_GEOMETRY,strideInBytes:36,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,
divisor:0}];a.C_LINE_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:32,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_LINE_VERTEX_DEF_VV=[{name:a.C_VBO_GEOMETRY,strideInBytes:44,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_TEXT_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:20,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];a.C_TEXT_VERTEX_DEF_VV=[{name:a.C_VBO_GEOMETRY,strideInBytes:36,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,
divisor:0}];a.C_LABEL_VERTEX_DEF=[{name:a.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:a.C_VBO_VISIBILITY,strideInBytes:1,divisor:0},{name:a.C_VBO_VISIBILITY_RANGE,strideInBytes:2,divisor:0}];a.C_ICON_STRIDE_SPEC=w(a.C_ICON_VERTEX_DEF);a.C_ICON_STRIDE_SPEC_VV=w(a.C_ICON_VERTEX_DEF_VV);a.C_FILL_STRIDE_SPEC=w(a.C_FILL_VERTEX_DEF);a.C_FILL_STRIDE_SPEC_VV=w(a.C_FILL_VERTEX_DEF_VV);a.C_LINE_STRIDE_SPEC=w(a.C_LINE_VERTEX_DEF);a.C_LINE_STRIDE_SPEC_VV=w(a.C_LINE_VERTEX_DEF_VV);a.C_TEXT_STRIDE_SPEC=w(a.C_TEXT_VERTEX_DEF);
a.C_TEXT_STRIDE_SPEC_VV=w(a.C_TEXT_VERTEX_DEF_VV);a.C_LABEL_STRIDE_SPEC=w(a.C_LABEL_VERTEX_DEF);a.getStrides=function(c,b){switch(c){case m.WGLGeometryType.MARKER:return b?a.C_ICON_STRIDE_SPEC_VV:a.C_ICON_STRIDE_SPEC;case m.WGLGeometryType.FILL:return b?a.C_FILL_STRIDE_SPEC_VV:a.C_FILL_STRIDE_SPEC;case m.WGLGeometryType.LINE:return b?a.C_LINE_STRIDE_SPEC_VV:a.C_LINE_STRIDE_SPEC;case m.WGLGeometryType.TEXT:return b?a.C_TEXT_STRIDE_SPEC_VV:a.C_TEXT_STRIDE_SPEC;case m.WGLGeometryType.LABEL:return a.C_LABEL_STRIDE_SPEC}return null};
var H=[a.C_VBO_GEOMETRY,a.C_VBO_VISIBILITY],I=[a.C_VBO_GEOMETRY,a.C_VBO_VISIBILITY],K=[a.C_VBO_GEOMETRY,a.C_VBO_VISIBILITY],N=[a.C_VBO_GEOMETRY,a.C_VBO_VISIBILITY],O=[a.C_VBO_GEOMETRY,a.C_VBO_VISIBILITY,a.C_VBO_VISIBILITY_RANGE];a.getNamedBuffers=r;a.strideToPackingFactor=t;a.allocateTypedArrayBuffer=function(a,c){switch(c%4){case 0:case 2:return new Uint32Array(Math.floor(a*c/4));case 1:case 3:return new Uint8Array(a*c)}};a.allocateTypedArrayBufferwithData=function(a,c){switch(c%4){case 0:case 2:return new Uint32Array(a);
case 1:case 3:return new Uint8Array(a)}};a.getSymbolGeometryType=function(a){return C(a)?m.WGLGeometryType.MARKER:v(a)?m.WGLGeometryType.LINE:z(a)?m.WGLGeometryType.FILL:y(a)?m.WGLGeometryType.TEXT:m.WGLGeometryType.UNKNOWN};a.normalizeSymbolType=A;a.isMarkerSymbol=C;a.isFillSymbol=z;a.isLineSymbol=v;a.isPictureSymbol=function(a){if(a=A(a.type))switch(a){case "picture-marker":case "picture-line":case "picture-fill":return!0}return!1};a.isTextSymbol=y;a.getTextProperties=function(a){return p.TextProperties.pool.acquire(a.color?
f.copyAndPremultiply(a.color):[255,255,255,255],a.haloColor?f.copyAndPremultiply(a.haloColor):[255,255,255,255],g.pt2px(a.haloSize),g.pt2px(a.font.size),a.angle*Math.PI/180,a.xoffset/a.font.size,a.yoffset/a.font.size,"left"===a.horizontalAlignment?0:"right"===a.horizontalAlignment?1:.5,"top"===a.verticalAlignment?0:"bottom"===a.verticalAlignment?1:.5)};a.isSameUniformValue=function(a,c){return!1};a.isSameMaterialInfo=function(a,c){if(a.materialKey!==c.materialKey||D(a.texBindingInfo)!==D(c.texBindingInfo)||
D(a.materialParams)!==D(c.materialParams))return!1;for(var b=a.texBindingInfo.length,f=0;f<b;++f){var e=a.texBindingInfo[f],g=c.texBindingInfo[f];if(e.unit!==g.unit||e.pageId!==g.pageId||e.semantic!==g.semantic)return!1}a=a.materialParams.length;for(f=0;f<a;)return!1;return!0};a.serializeString=function(a,c,b){for(var f=0,e=a.length,g=0;g<e;++g)c&&(c[b+f]=a.charCodeAt(g)),++f;c&&(c[b+f]=0);++f;return f};a.deserializeString=function(a,c,b){var f=0;a.s="";for(var e=!0;e;){var g=c[b+f];++f;0!==g?a.s+=
String.fromCharCode(g):e=!1}return f};a.isDefined=function(a){return null!==a&&void 0!==a};a.isNumber=function(a){return"number"===typeof a};a.isString=F;a.isStringOrNull=function(a){return null==a||F(a)};a.lerp=function(a,c,b){return a+(c-a)*b};h=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,c){this._arr.push(c)};a.prototype.getKeys=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();a.KeysGetter=h;h=function(){function a(){this._arr=
[];this._push=this._push.bind(this)}a.prototype._push=function(a,c){this._arr.push(a)};a.prototype.getValues=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();a.ValuesGetter=h;a.getCapType=function(a,c){switch(a){case "butt":return m.CapType.BUTT;case "round":return c?m.CapType.SQUARE:m.CapType.ROUND;case "square":return m.CapType.SQUARE;default:return J.error(new b("mapview-invalid-type","Cap type "+a+" is not a valid option. Defaulting to round")),m.CapType.ROUND}};
a.getJoinType=function(a){switch(a){case "miter":return m.JoinType.MITER;case "bevel":return m.JoinType.BEVEL;case "round":return m.JoinType.ROUND;default:return J.error(new b("mapview-invalid-type","Join type "+a+" is not a valid option. Defaulting to round")),m.JoinType.ROUND}};a.getVVType=function(a){switch(a){case "opacity":return m.VVType.OPACITY;case "color":return m.VVType.COLOR;case "rotation":return m.VVType.ROTATION;case "size":return m.VVType.SIZE;default:return J.error("Cannot interpret unknown vv: "+
a),null}};a.createHydrateFactory=G;a.getTransformParams=function(a){return{transform:a.transform,hasZ:a.hasZ,hasM:a.hasM}};a.createArcadeFunction=function(a,b,f){var e=b.fields,g=b.spatialReference,l=b.hasGeometryExpr;b=b.geometryType;var m=c.createFunction(a),p=new k,h=new d({viewingMode:null,scale:null}),t={},v={vars:{$feature:p,$view:null},spatialReference:g},x={fields:e},r=G(b);return function(a,b,e){l?(b=r(a.geometry,b.transform,b.hasZ,b.hasM),b.spatialReference=g,p.repurposeFromGraphicLikeObject(b,
a.attributes,x)):p.repurposeFromGraphicLikeObject(a.geometry,a.attributes,x);e?(v.vars.$view=h,h.attributes.viewingMode=e.viewingMode,h.attributes.scale=e.scale):v.vars.$view=t;a=c.executeFunction(m,v);return f?f(a):a}};a.copyMeshData=function(a,c,b,f,e,g,l){for(var d in g)for(var k=g[d].stride,m=t(k),p=g[d].data,h=b[d].data,v=k*e.vertexCount/m,x=k*a/m,m=k*e.vertexFrom/m,k=0;k<v;++k)h[k+x]=p[k+m];b=e.indexCount;for(k=0;k<b;++k)f[k+c]=l[k+e.indexFrom]-e.vertexFrom+a};a.C_VBO_INFO=(E={},E[a.C_VBO_GEOMETRY]=
35044,E[a.C_VBO_VISIBILITY]=35044,E[a.C_VBO_VISIBILITY_RANGE]=35048,E);a.createGeometryData=function(a,c){for(var b=[],f=0;5>f;++f){for(var e={},g=0,l=r(f);g<l.length;g++){var d=l[g];e[d]={data:c(f,d)}}b.push({data:a(f),buffers:e})}return b};a.resampleHermite=function(a,c,b,f,e,g,l){void 0===l&&(l=!0);var d=c/e;b/=g;for(var k=Math.ceil(d/2),m=Math.ceil(b/2),p=0;p<g;p++)for(var h=0;h<e;h++){for(var t=4*(h+(l?g-p-1:p)*e),v=0,x=0,r=0,z=0,u=0,y=0,w=0,C=(p+.5)*b,A=Math.floor(p*b);A<(p+1)*b;A++)for(var H=
Math.abs(C-(A+.5))/m,D=(h+.5)*d,H=H*H,J=Math.floor(h*d);J<(h+1)*d;J++){var n=Math.abs(D-(J+.5))/k,v=Math.sqrt(H+n*n);-1<=v&&1>=v&&(v=2*v*v*v-3*v*v+1,0<v&&(n=4*(J+A*c),w+=v*a[n+3],r+=v,255>a[n+3]&&(v=v*a[n+3]/250),z+=v*a[n],u+=v*a[n+1],y+=v*a[n+2],x+=v))}f[t]=z/x;f[t+1]=u/x;f[t+2]=y/x;f[t+3]=w/r}};a.createTextureFromTexelData=function(a,c){var b,f;x.isPowerOfTwo(c.width)&&x.isPowerOfTwo(c.height)?(b=!0,f=9987):(b=!1,f=9729);return new u(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,
hasMipmap:b,samplingMode:f,wrapMode:33071,flipped:!0},c)};a.geometryToMappedGeometry=function(a){return{vertexFrom:void 0,vertexTo:void 0,geometry:a}}})},"esri/geometry/support/quantizationUtils":function(){define(["require","exports","./jsonUtils"],function(h,a,d){function k(a,c){return Math.round((c-a.translate[0])/a.scale[0])}function b(a,c){return Math.round((a.translate[1]-c)/a.scale[1])}function l(a,c,f){for(var e=[],g,l,d,m,p=0;p<f.length;p++){var h=f[p];if(0<p){if(d=k(a,h[0]),m=b(a,h[1]),
d!==g||m!==l)e.push(c(h,d-g,m-l)),g=d,l=m}else g=k(a,h[0]),l=b(a,h[1]),e.push(c(h,g,l))}return 0<e.length?e:null}function g(a,c,b,f){return l(a,b?f?E:G:f?G:F,c)}function e(a,c,b,f){var e=[];b=b?f?E:G:f?G:F;for(f=0;f<c.length;f++){var g=l(a,b,c[f]);g&&3<=g.length&&e.push(g)}return e.length?e:null}function c(a,c,b,f){var e=[];b=b?f?E:G:f?G:F;for(f=0;f<c.length;f++){var g=l(a,b,c[f]);g&&2<=g.length&&e.push(g)}return e.length?e:null}function f(a,c){return c*a.scale[0]+a.translate[0]}function m(a,c){return a.translate[1]-
c*a.scale[1]}function p(a,c,b){var e=Array(b.length);if(!b.length)return e;var g=a.scale,l=g[0],g=g[1],d=f(a,b[0][0]);a=m(a,b[0][1]);e[0]=c(b[0],d,a);for(var k=1;k<b.length;k++){var p=b[k],d=d+p[0]*l;a-=p[1]*g;e[k]=c(p,d,a)}return e}function x(a,c,b){for(var f=Array(b.length),e=0;e<b.length;e++)f[e]=p(a,c,b[e]);return f}function u(a,c,b,f){return p(a,b?f?E:G:f?G:F,c)}function w(a,c,b,f){return x(a,b?f?E:G:f?G:F,c)}function r(a,c,b,f){return x(a,b?f?E:G:f?G:F,c)}function t(a,c,b){var f=b[0],e=f[0],
f=f[1],g=Math.min(e,c[0]),l=Math.min(f,c[1]),d=Math.max(e,c[2]);c=Math.max(f,c[3]);for(var k=1;k<b.length;k++){var m=b[k],p=m[0],m=m[1],e=e+p,f=f+m;0>p&&(g=Math.min(g,e));0<p&&(d=Math.max(d,e));0>m?l=Math.min(l,f):0<m&&(c=Math.max(c,f))}a[0]=g;a[1]=l;a[2]=d;a[3]=c;return a}function A(a,c){if(!c.length)return null;a[0]=a[1]=Number.POSITIVE_INFINITY;a[2]=a[3]=Number.NEGATIVE_INFINITY;for(var b=0;b<c.length;b++)t(a,a,c[b]);return a}function C(a,c,f,e,g){c.xmin=k(a,f.xmin);c.ymin=b(a,f.ymin);c.xmax=k(a,
f.xmax);c.ymax=b(a,f.ymax);c!==f&&(e&&(c.zmin=f.zmin,c.zmax=f.zmax),g&&(c.mmin=f.mmin,c.mmax=f.mmax));return c}function z(a,c,b,f,e){c.points=g(a,b.points,f,e);return c}function v(a,c,f,e,g){c.x=k(a,f.x);c.y=b(a,f.y);c!==f&&(e&&(c.z=f.z),g&&(c.m=f.m));return c}function y(a,c,b,f,g){a=e(a,b.rings,f,g);if(!a)return null;c.rings=a;return c}function D(a,b,f,e,g){a=c(a,f.paths,e,g);if(!a)return null;b.paths=a;return b}Object.defineProperty(a,"__esModule",{value:!0});var F=function(a,c,b){return[c,b]},
G=function(a,c,b){return[c,b,a[2]]},E=function(a,c,b){return[c,b,a[2],a[3]]};a.toTransform=function(a){return a?{originPosition:"upperLeft",scale:[a.tolerance,a.tolerance],translate:[a.extent.xmin,a.extent.ymax]}:null};a.equals=function(a,c){if(a===c||null==a&&null==c)return!0;if(null==a||null==c)return!1;var b,f,e,g;a&&"upperLeft"===a.originPosition?(b=a.translate[0],f=a.translate[1],a=a.scale[0]):(b=a.extent.xmin,f=a.extent.ymax,a=a.tolerance);c&&"upperLeft"===c.originPosition?(e=c.translate[0],
g=c.translate[1],c=c.scale[0]):(e=c.extent.xmin,g=c.extent.ymax,c=c.tolerance);return b===e&&f===g&&a===c};a.quantizeX=k;a.quantizeY=b;a.quantizeBounds=function(a,c,f){c[0]=k(a,f[0]);c[3]=b(a,f[1]);c[2]=k(a,f[2]);c[1]=b(a,f[3]);return c};a.quantizePoints=g;a.quantizeRings=e;a.quantizePaths=c;a.hydrateX=f;a.hydrateY=m;a.hydrateCoordsArray=p;a.hydrateCoordsArrayArray=x;a.hydrateBounds=function(a,c,b){return b?(c[0]=f(a,b[0]),c[1]=m(a,b[3]),c[2]=f(a,b[2]),c[3]=m(a,b[1]),c):[f(a,c[0]),m(a,c[3]),f(a,c[2]),
m(a,c[1])]};a.hydratePoints=u;a.hydratePaths=w;a.hydrateRings=r;a.getQuantizedBoundsCoordsArray=t;a.getQuantizedBoundsCoordsArrayArray=A;a.getQuantizedBoundsPoints=function(a){var c=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return t(c,c,a)};a.getQuantizedBoundsPaths=function(a){return A([0,0,0,0],a)};a.getQuantizedBoundsRings=function(a){return A([0,0,0,0],a)};a.quantizeExtent=C;a.quantizeMultipoint=z;a.quantizePoint=v;a.quantizePolygon=
y;a.quantizePolyline=D;a.quantizeGeometry=function(a,c){return a&&c?d.isPoint(c)?v(a,{},c,!1,!1):d.isPolyline(c)?D(a,{},c,!1,!1):d.isPolygon(c)?y(a,{},c,!1,!1):d.isMultipoint(c)?z(a,{},c,!1,!1):d.isExtent(c)?C(a,{},c,!1,!1):null:null};a.hydrateExtent=function(a,c,b,e,g){c.xmin=f(a,b.xmin);c.ymin=m(a,b.ymin);c.xmax=f(a,b.xmax);c.ymax=m(a,b.ymax);c!==b&&(e&&(c.zmin=b.zmin,c.zmax=b.zmax),g&&(c.mmin=b.mmin,c.mmax=b.mmax));return c};a.hydrateMultipoint=function(a,c,b,f,e){c.points=u(a,b.points,f,e);return c};
a.hydratePoint=function(a,c,b,e,g){c.x=f(a,b.x);c.y=m(a,b.y);c!==b&&(e&&(c.z=b.z),g&&(c.m=b.m));return c};a.hydratePolygon=function(a,c,b,f,e){c.rings=r(a,b.rings,f,e);return c};a.hydratePolyline=function(a,c,b,f,e){c.paths=w(a,b.paths,f,e);return c}})},"esri/views/2d/engine/webgl/color":function(){define(["require","exports","./number"],function(h,a,d){function k(a,b){Array.isArray(b)?(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]):(a[0]=b.r,a[1]=b.g,a[2]=b.b,a[3]=b.a);return a}function b(a,b,c){void 0===
b&&(b=0);void 0===c&&(c=!1);var f=a[b+3];a[b+0]*=f;a[b+1]*=f;a[b+2]*=f;c||(a[b+3]*=255);return a}Object.defineProperty(a,"__esModule",{value:!0});a.white=[255,255,255,1];var l=[0,0,0,0];a.premultiplyAlpha=b;a.copyAndPremultiply=function(a){return b(k([],a))};a.premultiplyAlphaUint32=function(a){b(k(l,a));return d.i8888to32(l[0],l[1],l[2],l[3])};a.premultiplyAlphaRGBA=function(a){var b=a.a;return d.i8888to32(a.r*b,a.g*b,a.b*b,255*b)}})},"esri/views/2d/engine/webgl/number":function(){define(["require",
"exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});var d=new Float32Array(1),k=new Uint32Array(d.buffer);a.nextHighestPowerOfTwo=function(a){var b=a;b--;b|=b>>1;b|=b>>2;b|=b>>4;b|=b>>8;b|=b>>16;b++;var g=b>>1;return b-a>a-g?g:b};a.toUint32=function(a){d[0]=a;return k[0]};a.toFloat32=function(a){k[0]=a;return d[0]};a.i1616to32=function(a,l){return 65535&a|l<<16};a.i8888to32=function(a,l,g,e){return a&255|(l&255)<<8|(g&255)<<16|e<<24};a.i8816to32=function(a,l,g){return a&255|
(l&255)<<8|g<<16};a.numTo32=function(a){return a|0}})},"esri/views/2d/engine/webgl/SymbolProperties":function(){define(["require","exports","../../../../core/ObjectPool"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this.color=[0,0,0,0];this.haloColor=[0,0,0,0];this.haloSize=0;this.size=12;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=0}a.prototype.acquire=function(a,l,g,e,c,f,d,k,h){this.color=a;this.haloColor=l;this.haloSize=g;this.size=
e;this.angle=c;this.offsetX=f;this.offsetY=d;this.hAnchor=k;this.vAnchor=h};a.prototype.release=function(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=this.size=this.haloSize=this.haloColor[0]=this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0};a.pool=new d(a);return a}();a.TextProperties=h})},"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../request"],function(h,a,d){Object.defineProperty(a,
"__esModule",{value:!0});a.dataURItoBlob=function(a){var b=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var l=new ArrayBuffer(b.length),g=new Uint8Array(l),e=0;e<b.length;e++)g[e]=b.charCodeAt(e);return new Blob([l],{type:a})};a.requestImage=function(a){return d(a,{responseType:"image"}).then(function(a){return a.data})}})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["require","exports","../../../../core/tsSupport/declareExtendsHelper","../../../webgl/BufferObject",
"../../../webgl/VertexArrayObject"],function(h,a,d,k,b){return function(){function a(a,e,c){this.rctx=a;this.texcoordScale=this.positionScale=1;this._vertexBuffer=k.createVertex(a,35044,(new Int16Array(e)).buffer);this._indexBuffer=k.createIndex(a,35044,new Uint16Array(c));this._vao=new b(a,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",count:2,type:5122,offset:0,stride:8,normalized:!0},{name:"a_texcoord",count:2,type:5122,offset:4,stride:8,normalized:!0}]},{geometry:this._vertexBuffer},
this._indexBuffer)}a.prototype.bind=function(){this._vao.bind()};a.prototype.unbind=function(){this._vao.unbind()};a.prototype.dispose=function(){this._vao.dispose(!1);this._vertexBuffer.dispose();this._indexBuffer.dispose()};a.prototype.draw=function(){this.rctx.drawElements(4,this._indexBuffer.size,5123,0)};return a}()})},"esri/views/2d/engine/webgl/brushes/WGLBrushInfo":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../definitions ../GeometryUtils ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms ../../../../webgl/BufferObject ../../../../webgl/programUtils ../../../../webgl/Texture ../../../../webgl/VertexArrayObject".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function g(){var c=a.call(this)||this;c._initialized=!1;c._color=k.vec4f32.fromValues(1,0,0,1);c._maxWidth=0;return c}d(g,a);g.prototype.dispose=function(){this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null);this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null);this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=
null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null);this._canvas=null};g.prototype.draw=function(a,c){a=a.context;if(c.isReady){this._initialized||this._initialize(a);a.bindVAO(this._outlineVertexArrayObject);a.bindProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3);this._outlineProgram.setUniform1f("u_coord_range",b.TILE_SIZE);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",
this._color);a.setLineWidth(2);a.drawArrays(3,0,4);a.bindVAO();var f=this._getTexture(a,c);f&&(a.bindVAO(this._tileInfoVertexArrayObject),a.bindProgram(this._tileInfoProgram),a.bindTexture(f,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform1f("u_coord_ratio",1),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",f.descriptor.width,f.descriptor.height),
a.drawArrays(5,0,4),a.bindVAO())}};g.prototype._initialize=function(a){if(this._initialized)return!0;var b=m.createProgram(a,e.background),g=m.createProgram(a,c.tileInfo),l={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},d=new Int8Array([0,0,1,0,1,1,0,1]),d=f.createVertex(a,35044,d),d=new x(a,e.background.attributes,l,{geometry:d}),k=new Int8Array([0,0,1,0,0,1,1,1]),k=f.createVertex(a,35044,k);a=new x(a,c.tileInfo.attributes,l,{geometry:k});this._outlineProgram=
b;this._tileInfoProgram=g;this._outlineVertexArrayObject=d;this._tileInfoVertexArrayObject=a;return this._initialized=!0};g.prototype._getTexture=function(a,c){if(c.texture)return c.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","256"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var b=c.key.id,f=this._canvas.getContext("2d");f.font="24px sans-serif";f.textAlign=
"left";f.textBaseline="middle";var e=f.measureText(b),e=Math.pow(2,Math.ceil(l.log2(e.width+2)));e>this._maxWidth&&(this._maxWidth=e);f.clearRect(0,0,this._maxWidth,32);f.fillStyle="blue";f.fillText(b,0,16);c.texture=new p(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas);return c.texture};return g}(g.default);a.default=h})},"esri/views/2d/engine/webgl/definitions":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});a.EXTRUDE_SCALE=
64;a.PICTURE_FILL_COLOR=4294967295;a.TILE_SIZE=512;a.ANGLE_FACTOR_256=256/360;a.DEBUG_LABELS=!1;a.COLLISION_BUCKET_SIZE=128;a.COLLISION_MAX_ZOOM_DELTA=3;a.COLLISION_EARLY_REJECT_BUCKET_SIZE=32;a.COLLISION_BOX_PADDING=8;a.COLLISION_TILE_BOX_SIZE=a.TILE_SIZE/a.COLLISION_BUCKET_SIZE;a.COLLISION_PLACEMENT_PADDING=8;a.HEURISTIC_GLYPHS_PER_LINE=50;a.HEURISTIC_GLYPHS_PER_FEATURE=10;a.GLYPH_SIZE=24;a.TEXT_LINE_HEIGHT=1.2*a.GLYPH_SIZE;a.TEXT_MAX_WIDTH=10*a.GLYPH_SIZE;a.TEXT_SPACING=0})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(["require",
"exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){return function(){}}();a.default=h})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["require","exports","./sources/resolver"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.background={name:"background",shaders:{vertexShader:d.resolveIncludes("background/background.vert"),fragmentShader:d.resolveIncludes("background/background.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["require",
"exports","./sources/resolver"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.tileInfo={name:"tileInfo",shaders:{vertexShader:d.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:d.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../definitions ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/BufferObject ../../../../webgl/programUtils ../../../../webgl/VertexArrayObject".split(" "),
function(h,a,d,k,b,l,g,e,c,f){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function l(){var c=a.call(this)||this;c._color=k.vec4f32.fromValues(1,0,0,1);c._initialized=!1;return c}d(l,a);l.prototype.dispose=function(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)};l.prototype.draw=function(a,c){a=a.context;this._initialized||this._initialize(a);a.setStencilFunctionSeparate(1032,
519,c.stencilRef,255);a.bindVAO(this._solidVertexArrayObject);a.bindProgram(this._solidProgram);this._solidProgram.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3);this._solidProgram.setUniform1f("u_coord_range",b.TILE_SIZE);this._solidProgram.setUniform1f("u_depth",0);this._solidProgram.setUniform4fv("u_color",this._color);a.drawArrays(5,0,4);a.bindVAO()};l.prototype._initialize=function(a){if(this._initialized)return!0;var b=c.createProgram(a,g.background);if(!b)return!1;var l=new Int8Array([0,0,1,0,
0,1,1,1]),l=e.createVertex(a,35044,l);a=new f(a,g.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:l});this._solidProgram=b;this._solidVertexArrayObject=a;return this._initialized=!0};return l}(l.default);a.default=h})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushFill":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),
function(h,a,d,k,b,l,g,e,c){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function f(){var c=null!==a&&a.apply(this,arguments)||this;c._isInitialized=!1;c._spritesTextureSize=k.vec2f32.create();return c}d(f,a);f.prototype.dispose=function(){};f.prototype.getGeometryType=function(){return b.WGLGeometryType.FILL};f.prototype.drawGeometry=function(a,c,b,f){f=a.context;var e=a.painter,g=a.rendererInfo,l=a.requiredLevel,d=b.indexCount,k=b.indexFrom;this._initialize();var m=b.materialInfo.materialKeyInfo,
p=a.painter.materialManager.getProgram(b.materialInfo.materialKey,a.drawPhase);if(p){f.bindProgram(p);var h=this._getVAO(f,c,m.hasVV());f.bindVAO(h);if(0<b.materialInfo.texBindingInfo.length){b=b.materialInfo.texBindingInfo[0];var h=b.pageId,x=a.painter.textureManager.sprites;this._spritesTextureSize[0]=x.getWidth(h);this._spritesTextureSize[1]=x.getHeight(h);p.setUniform1f("u_zoomFactor",1/Math.pow(2,l-c.key.level)/a.pixelRatio);e.textureManager.bindSpritePage(f,h,b.unit,9729);p.setUniform1i(b.semantic,
b.unit);p.setUniform2fv("u_mosaicSize",this._spritesTextureSize)}p.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3);m.vvColor&&(p.setUniform1fv("u_vvColorValues",g.vvColorValues),p.setUniform4fv("u_vvColors",g.vvColors));m.vvOpacity&&(p.setUniform1fv("u_vvOpacityValues",g.vvOpacityValues),p.setUniform1fv("u_vvOpacities",g.vvOpacities));f.drawElements(4,d,5125,4*k);f.bindVAO(null)}};f.prototype._initialize=function(){if(this._isInitialized)return!0;this._fillVertexAttributeLayout={geometry:[{name:"a_pos",
count:2,type:5122,offset:0,stride:28,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:28,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:28,normalized:!0,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:12,stride:28,normalized:!1,divisor:0},{name:"a_aux1",count:4,type:5121,offset:20,stride:28,normalized:!1,divisor:0},{name:"a_aux2",count:2,type:5123,offset:24,stride:28,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,
stride:1,normalized:!0,divisor:0}]};this._fillVertexAttributeLayoutVV={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:36,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:36,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:36,normalized:!0,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:12,stride:36,normalized:!1,divisor:0},{name:"a_aux1",count:4,type:5121,offset:20,stride:36,normalized:!1,divisor:0},{name:"a_aux2",count:2,type:5123,offset:24,
stride:36,normalized:!1,divisor:0},{name:"a_vv",count:2,type:5126,offset:28,stride:36,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};this._isInitialized=!0};f.prototype._getVAO=function(a,b,f){if(b.fillGeometry.vao)return b.fillGeometry.vao;var g=b.fillGeometry.vertexBufferMap[l.C_VBO_GEOMETRY],d=b.fillGeometry.vertexBufferMap[l.C_VBO_VISIBILITY],k=b.fillGeometry.indexBuffer;if(!g||!k)return null;b.fillGeometry.vao=f?new c(a,
e.fill.attributes,this._fillVertexAttributeLayoutVV,{geometry:g,visibility:d},k):new c(a,e.fill.attributes,this._fillVertexAttributeLayout,{geometry:g,visibility:d},k);return b.fillGeometry.vao};return f}(g.default);a.default=h})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrush":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","./WGLBrush"],function(h,a,d,k){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function b(){return null!==a&&a.apply(this,
arguments)||this}d(b,a);b.prototype.draw=function(a,b){var c=this;if(b.canDisplay){var f=this.getGeometryType(),e=b.getDisplayList(a.drawPhase),g=b.getGeometry(f);g&&e.byType(f,function(f){c.drawGeometry(a,b,f,g)})}};return b}(k.default);a.default=h})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),
function(h,a,d,k,b,l,g,e,c){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function f(){var c=null!==a&&a.apply(this,arguments)||this;c._vertexAttributeLayout={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:24,normalized:!0,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_texAndSize",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},
{name:"a_refSymbolAndPlacementOffset",count:4,type:5121,offset:16,stride:24,normalized:!1,divisor:0},{name:"a_vvSize",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}],visibilityRange:[{name:"a_visibilityRange",count:2,type:5121,offset:0,stride:2,normalized:!1,divisor:0}]};c._glyphsTextureSize=k.vec2f32.create();return c}d(f,a);f.prototype.dispose=function(){};f.prototype.drawGeometry=function(a,
c,f,e){e=a.context;var g=a.painter,l=a.drawPhase,d=a.state,k=a.rendererInfo,m=f.materialInfo,p=f.indexCount;f=f.indexFrom;var h=m.materialKeyInfo,x=h.isMapAligned()?1:0;if(a.requiredLevel===c.key.level||x){var u=a.drawPhase===b.WGLDrawPhase.LABEL_ALPHA,w=m.materialKey;u&&(w|=8);if(l=g.materialManager.getProgram(w,l))e.setStencilTestEnabled(!1),e.bindProgram(l),w=this._getVAO(e,c),e.bindVAO(w),u?(e.setBlendingEnabled(!1),l.setUniform1f("u_fadeStep",c.fader.value)):(m=m.texBindingInfo[0],g.textureManager.bindGlyphsPage(e,
m.pageId,m.unit),l.setUniform1i(m.semantic,m.unit)),g=g.textureManager.glyphs,this._glyphsTextureSize[0]=g.width/4,this._glyphsTextureSize[1]=g.height/4,g=1===x?d.displayViewMat3:d.displayMat3,h.vvSizeMinMaxValue&&l.setUniform4fv("u_vvSizeMinMaxValue",k.vvSizeMinMaxValue),h.vvSizeScaleStops&&l.setUniform1f("u_vvSizeScaleStopsValue",k.vvSizeScaleStopsValue),h.vvSizeFieldStops&&(l.setUniform1fv("u_vvSizeFieldStopsValues",k.vvSizeFieldStopsValues),l.setUniform1fv("u_vvSizeFieldStopsSizes",k.vvSizeFieldStopsSizes)),
h.vvSizeUnitValue&&l.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",k.vvSizeUnitValueToPixelsRatio),e.bindTexture(a.labelFBO.colorTexture,3),l.setUniform1i("u_referenceTex",3),l.setUniform1f("u_mapRotation",Math.floor(d.rotation/360*254)),l.setUniform1f("u_mapAligned",x),l.setUniformMatrix3fv("u_displayMat3",g),l.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3),l.setUniform2fv("u_mosaicSize",this._glyphsTextureSize),l.setUniform1f("u_pixelRatio",a.pixelRatio),l.setUniform1f("u_opacity",1),l.setUniform1f("u_zoomLevel",
Math.round(10*a.displayLevel)),l.setUniform2fv("u_screenSize",a.state.size),e.drawElements(4,p,5125,4*f),e.bindVAO(null),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!0)}};f.prototype.getGeometryType=function(){return b.WGLGeometryType.LABEL};f.prototype._getVAO=function(a,b){if((b=b.labelGeometry)&&b.vao)return b.vao;var f=b.vertexBufferMap[l.C_VBO_GEOMETRY],g=b.vertexBufferMap[l.C_VBO_VISIBILITY_RANGE],d=b.indexBuffer;if(!f||!d||!g)return null;b.vao=new c(a,e.label.attributes,this._vertexAttributeLayout,
{geometry:f,visibility:b.vertexBufferMap[l.C_VBO_VISIBILITY],visibilityRange:g},d);return b.vao};return f}(g.default);a.default=h})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLine":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),function(h,a,d,k,b,l,g,e,c){Object.defineProperty(a,"__esModule",{value:!0});
h=function(a){function f(){var c=null!==a&&a.apply(this,arguments)||this;c._lineVertexAttributeLayout={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:32,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:32,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:32,normalized:!0,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:12,stride:32,normalized:!1,divisor:0},{name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123,offset:16,
stride:32,normalized:!1,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:20,stride:32,normalized:!1,divisor:0},{name:"a_segmentDirection",count:4,type:5120,offset:28,stride:32,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};c._lineVertexAttributeLayoutVV={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:44,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:44,normalized:!0,divisor:0},{name:"a_color",
count:4,type:5121,offset:8,stride:44,normalized:!0,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:12,stride:44,normalized:!1,divisor:0},{name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123,offset:16,stride:44,normalized:!1,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:20,stride:44,normalized:!1,divisor:0},{name:"a_segmentDirection",count:4,type:5120,offset:28,stride:44,normalized:!1,divisor:0},{name:"a_vv",count:3,type:5126,offset:32,stride:44,normalized:!1,divisor:0}],
visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};c._spritesTextureSize=k.vec2f32.create();return c}d(f,a);f.prototype.dispose=function(){};f.prototype.getGeometryType=function(){return b.WGLGeometryType.LINE};f.prototype.drawGeometry=function(a,c,b,f){f=a.context;var e=a.painter,g=a.rendererInfo,l=a.requiredLevel,d=a.state,k=b.indexFrom,m=b.indexCount,h=b.materialInfo;b=h.materialKeyInfo;var p=e.materialManager.getProgram(h.materialKey,a.drawPhase);if(p){f.bindProgram(p);
var x=this._getVAO(f,c,b.hasVV());f.bindVAO(x);x=1/a.pixelRatio;if(0<h.texBindingInfo.length){var h=h.texBindingInfo[0],u=h.pageId,w=e.textureManager.sprites;this._spritesTextureSize[0]=w.getWidth(u);this._spritesTextureSize[1]=w.getHeight(u);e.textureManager.bindSpritePage(f,u,h.unit);p.setUniform1i(h.semantic,h.unit);p.setUniform2fv("u_mosaicSize",this._spritesTextureSize)}a=Math.pow(2,l-c.key.level)/a.pixelRatio;p.setUniform1f("u_zoomFactor",a);p.setUniformMatrix3fv("u_dvMat3",d.displayViewMat3);
p.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3);p.setUniform1f("u_blur",0+x);p.setUniform1f("u_antialiasing",x);p.setUniform1f("u_zoomFactor",a);b.vvSizeMinMaxValue&&p.setUniform4fv("u_vvSizeMinMaxValue",g.vvSizeMinMaxValue);b.vvSizeScaleStops&&p.setUniform1f("u_vvSizeScaleStopsValue",g.vvSizeScaleStopsValue);b.vvSizeFieldStops&&(p.setUniform1fv("u_vvSizeFieldStopsValues",g.vvSizeFieldStopsValues),p.setUniform1fv("u_vvSizeFieldStopsSizes",g.vvSizeFieldStopsSizes));b.vvSizeUnitValue&&p.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",
g.vvSizeUnitValueToPixelsRatio);b.vvColor&&(p.setUniform1fv("u_vvColorValues",g.vvColorValues),p.setUniform4fv("u_vvColors",g.vvColors));b.vvOpacity&&(p.setUniform1fv("u_vvOpacityValues",g.vvOpacityValues),p.setUniform1fv("u_vvOpacities",g.vvOpacities));f.setFaceCullingEnabled(!0);f.setFrontFace(2305);f.setCullFace(1029);f.drawElements(4,m,5125,4*k);f.setFaceCullingEnabled(!1);f.bindVAO(null)}};f.prototype._getVAO=function(a,b,f){if(b.lineGeometry.vao)return b.lineGeometry.vao;var g=b.lineGeometry.vertexBufferMap[l.C_VBO_GEOMETRY],
d=b.lineGeometry.vertexBufferMap[l.C_VBO_VISIBILITY],k=b.lineGeometry.indexBuffer;if(!g||!k)return null;b.lineGeometry.vao=f?new c(a,e.line.attributes,this._lineVertexAttributeLayoutVV,{geometry:g,visibility:d},k):new c(a,e.line.attributes,this._lineVertexAttributeLayout,{geometry:g,visibility:d},k);return b.lineGeometry.vao};return f}(g.default);a.default=h})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),
function(h,a,d,k,b,l,g,e,c){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function f(){var c=null!==a&&a.apply(this,arguments)||this;c._iconVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffsetAndTex",count:4,type:5120,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:8,stride:24,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:24,normalized:!0,divisor:0},
{name:"a_outlineColor",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_sizeAndOutlineWidth",count:4,type:5121,offset:20,stride:24,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};c._iconVertexAttributesWithVV={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:40,normalized:!1,divisor:0},{name:"a_vertexOffsetAndTex",count:4,type:5120,offset:4,stride:40,normalized:!1,divisor:0},{name:"a_id",count:4,
type:5121,offset:8,stride:40,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:40,normalized:!0,divisor:0},{name:"a_outlineColor",count:4,type:5121,offset:16,stride:40,normalized:!0,divisor:0},{name:"a_sizeAndOutlineWidth",count:4,type:5121,offset:20,stride:40,normalized:!1,divisor:0},{name:"a_vv",count:4,type:5126,offset:24,stride:40,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};c._spritesTextureSize=
k.vec2f32.create();return c}d(f,a);f.prototype.dispose=function(){};f.prototype.getGeometryType=function(){return b.WGLGeometryType.MARKER};f.prototype.drawGeometry=function(a,c,b,f){f=a.context;var e=a.painter,g=a.rendererInfo,l=a.state,d=b.indexCount,k=b.indexFrom,m=b.materialInfo;b=m.materialKeyInfo;if(a=e.materialManager.getProgram(m.materialKey,a.drawPhase)){f.bindProgram(a);var h=this._getVAO(f,c,b.hasVV());f.bindVAO(h);h=m.texBindingInfo[0];m=h.pageId;e.textureManager.bindSpritePage(f,m,h.unit);
a.setUniform1i(h.semantic,h.unit);e=e.textureManager.sprites;this._spritesTextureSize[0]=e.getWidth(m)/4;this._spritesTextureSize[1]=e.getHeight(m)/4;a.setUniformMatrix3fv("u_displayMat3",b.vvRotation?l.displayViewMat3:l.displayMat3);a.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3);a.setUniform2fv("u_mosaicSize",this._spritesTextureSize);b.vvSizeMinMaxValue&&a.setUniform4fv("u_vvSizeMinMaxValue",g.vvSizeMinMaxValue);b.vvSizeScaleStops&&a.setUniform1f("u_vvSizeScaleStopsValue",g.vvSizeScaleStopsValue);
b.vvSizeFieldStops&&(a.setUniform1fv("u_vvSizeFieldStopsValues",g.vvSizeFieldStopsValues),a.setUniform1fv("u_vvSizeFieldStopsSizes",g.vvSizeFieldStopsSizes));b.vvSizeUnitValue&&a.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",g.vvSizeUnitValueToPixelsRatio);b.vvColor&&(a.setUniform1fv("u_vvColorValues",g.vvColorValues),a.setUniform4fv("u_vvColors",g.vvColors));b.vvOpacity&&(a.setUniform1fv("u_vvOpacityValues",g.vvOpacityValues),a.setUniform1fv("u_vvOpacities",g.vvOpacities));b.vvRotation&&a.setUniform1f("u_vvRotationType",
"geographic"===g.vvMaterialParameters.vvRotationType?0:1);f.drawElements(4,d,5125,4*k);f.bindVAO(null)}};f.prototype._getVAO=function(a,b,f){if(b.iconGeometry.vao)return b.iconGeometry.vao;var g=b.iconGeometry.vertexBufferMap[l.C_VBO_GEOMETRY],d=b.iconGeometry.vertexBufferMap[l.C_VBO_VISIBILITY],k=b.iconGeometry.indexBuffer;if(!g||!k)return null;b.iconGeometry.vao=f?new c(a,e.icon.attributes,this._iconVertexAttributesWithVV,{geometry:g,visibility:d},k):new c(a,e.icon.attributes,this._iconVertexAttributes,
{geometry:g,visibility:d},k);return b.iconGeometry.vao};return f}(g.default);a.default=h})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushText":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),function(h,a,d,k,b,l,g,e,c){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function f(){var c=null!==
a&&a.apply(this,arguments)||this;c._vertexAttributeLayout={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:20,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:20,normalized:!0,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:12,stride:20,normalized:!1,divisor:0},{name:"a_texFontSize",count:4,type:5120,offset:16,stride:20,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,
type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};c._vertexAttributeLayoutVV={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:36,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:36,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:36,normalized:!0,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:12,stride:36,normalized:!1,divisor:0},{name:"a_texFontSize",count:4,type:5120,offset:16,stride:36,normalized:!1,divisor:0},{name:"a_vv",
count:4,type:5126,offset:20,stride:36,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};c._glyphsTextureSize=k.vec2f32.create();return c}d(f,a);f.prototype.dispose=function(){};f.prototype.getGeometryType=function(){return b.WGLGeometryType.TEXT};f.prototype.drawGeometry=function(a,c,b,f){f=a.context;var e=a.painter,g=a.rendererInfo,l=a.state,d=b.materialInfo,k=b.indexCount;b=b.indexFrom;var m=d.materialKeyInfo,h=m.vvSizeMinMaxValue||
m.vvSizeScaleStops||m.vvSizeFieldStops||m.vvSizeUnitValue||m.vvColor||m.vvRotation||m.vvOpacity;if(a=e.materialManager.getProgram(d.materialKey,a.drawPhase))f.bindProgram(a),h=this._getVAO(f,c,h,this.getGeometryType()),f.bindVAO(h),d=d.texBindingInfo[0],e.textureManager.bindGlyphsPage(f,d.pageId,d.unit),a.setUniform1i(d.semantic,d.unit),e=e.textureManager.glyphs,this._glyphsTextureSize[0]=e.width/4,this._glyphsTextureSize[1]=e.height/4,a.setUniformMatrix3fv("u_displayMat3",l.displayMat3),a.setUniformMatrix3fv("u_dvsMat3",
c.dvsMat3),a.setUniform2fv("u_mosaicSize",this._glyphsTextureSize),a.setUniform1f("u_pixelRatio",1),m.vvSizeMinMaxValue&&a.setUniform4fv("u_vvSizeMinMaxValue",g.vvSizeMinMaxValue),m.vvSizeScaleStops&&a.setUniform1f("u_vvSizeScaleStopsValue",g.vvSizeScaleStopsValue),m.vvSizeFieldStops&&(a.setUniform1fv("u_vvSizeFieldStopsValues",g.vvSizeFieldStopsValues),a.setUniform1fv("u_vvSizeFieldStopsSizes",g.vvSizeFieldStopsSizes)),m.vvSizeUnitValue&&a.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",g.vvSizeUnitValueToPixelsRatio),
m.vvColor&&(a.setUniform1fv("u_vvColorValues",g.vvColorValues),a.setUniform4fv("u_vvColors",g.vvColors)),m.vvOpacity&&(a.setUniform1fv("u_vvOpacityValues",g.vvOpacityValues),a.setUniform1fv("u_vvOpacities",g.vvOpacities)),m.vvRotation&&a.setUniform1f("u_vvRotationType","geographic"===g.vvMaterialParameters.vvRotationType?0:1),f.drawElements(4,k,5125,4*b),f.bindVAO(null)};f.prototype._getVAO=function(a,b,f,g){if((b=b.getGeometry(g))&&b.vao)return b.vao;g=b.vertexBufferMap[l.C_VBO_GEOMETRY];var d=b.vertexBufferMap[l.C_VBO_VISIBILITY],
k=b.indexBuffer;if(!g||!k)return null;b.vao=f?new c(a,e.text.attributes,this._vertexAttributeLayoutVV,{geometry:g,visibility:d},k):new c(a,e.text.attributes,this._vertexAttributeLayout,{geometry:g,visibility:d},k);return b.vao};return f}(g.default);a.default=h})},"esri/views/2d/engine/webgl/painter/WGLHighlightPainter":function(){define(["require","exports","../../../../../core/has","./highlight/HighlightRenderer","./highlight/HighlightSurfaces"],function(h,a,d,k,b){return function(){function a(){this._hlRenderer=
new k;this._hlSurfaces=new b;this._adjustedHeight=this._adjustedWidth=this._height=this._width=void 0}a.prototype.dispose=function(){this._hlSurfaces&&this._hlSurfaces.dispose();this._hlRenderer&&this._hlRenderer.dispose();this._boundFBO=null};a.prototype.setup=function(a,b,c){this._width=b;this._height=c;var f=b%4,e=c%4;b+=2>f?-f:4-f;c+=2>e?-e:4-e;this._adjustedWidth=b;this._adjustedHeight=c;this._boundFBO=a.getBoundFramebufferObject();b=Math.round(.75*b);c=Math.round(.75*c);this._hlRenderer.setup(a,
b,c);this._hlSurfaces.setup(a,b,c)};a.prototype.setHighlightOptions=function(a){this._hlRenderer.setHighlightOptions({fillColor:a.fillColor,outlineColor:a.outlineColor,outlineWidth:.75*a.outlineWidth,outerHaloWidth:.75*a.outerHaloWidth,innerHaloWidth:.75*a.innerHaloWidth,outlinePosition:.75*a.outlinePosition})};a.prototype.startMaskDraw=function(a){a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setClearColor(0,0,0,0);a.setClearStencil(0);a.clear(a.gl.COLOR_BUFFER_BIT|a.gl.STENCIL_BUFFER_BIT);
a.setViewport(0,0,.75*this._adjustedWidth,.75*this._adjustedHeight)};a.prototype.draw=function(a){a.setStencilTestEnabled(!1);a.setBlendingEnabled(!1);a.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.preBlur(a,this._hlSurfaces.sharedBlur1Tex);a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setClearColor(0,0,0,0);a.clear(a.gl.COLOR_BUFFER_BIT);this._hlRenderer.finalBlur(a,this._hlSurfaces.sharedBlur2Tex);a.bindFramebuffer(this._boundFBO);
a.setBlendingEnabled(!0);a.setViewport(0,0,this._width,this._height);this._hlRenderer.renderHighlight(a,this._hlSurfaces.sharedBlur1Tex);this._boundFBO=null};return a}()})},"esri/views/2d/engine/webgl/painter/highlight/HighlightRenderer":function(){define("require exports ../../shaders/HighlightPrograms ../../../../../webgl/BufferObject ../../../../../webgl/programUtils ../../../../../webgl/Texture ../../../../../webgl/VertexArrayObject".split(" "),function(h,a,d,k,b,l,g){var e=[void 0,void 0,void 0,
1],c=[3,4],f=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return function(){function a(){this._height=this._width=void 0;this._highlightOptions={fillColor:[.2,.6,.9,.75],outlineColor:[.2,.6,.9,.9],outlinePosition:0,outlineWidth:3.4,innerHaloWidth:2,outerHaloWidth:3.3};this._resources=null}a.prototype.dispose=function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),
this._resources.shadeTex.dispose(),this._resources=null)};a.prototype.preBlur=function(a,b){a.bindTexture(b,c[0]);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",f);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};a.prototype.finalBlur=function(a,b){a.bindTexture(b,c[0]);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",
[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",m);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};a.prototype.renderHighlight=function(a,b){a.bindTexture(b,c[0]);a.bindTexture(this._resources.shadeTex,c[1]);a.bindProgram(this._resources.highlightProgram);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};a.prototype._initialize=function(a,f,m){this._width=f;this._height=m;f=new k(a,34962,35044,(new Int8Array([-1,-1,
0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);m=new g(a,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:f});var h=b.createProgram(a,d.highlight),p=b.createProgram(a,d.blur);h.setUniform1i("u_texture",c[0]);h.setUniform1i("u_shade",c[1]);h.setUniform4fv("u_sigmas",e);p.setUniform1i("u_texture",c[0]);p.setUniform4fv("u_sigmas",e);a=new l(a,{target:3553,pixelFormat:6408,
dataType:5121,wrapMode:33071,width:256,height:1,samplingMode:9728});this._resources={quadGeometry:f,quadVAO:m,highlightProgram:h,blurProgram:p,shadeTex:a}};a.prototype.setHighlightOptions=function(a){function c(a,c,b){m[0]=(1-b)*a[0]+b*c[0];m[1]=(1-b)*a[1]+b*c[1];m[2]=(1-b)*a[2]+b*c[2];m[3]=(1-b)*a[3]+b*c[3]}this._highlightOptions=a;if(this._resources){var b=a.outlinePosition-a.outlineWidth/2-a.outerHaloWidth,f=a.outlinePosition-a.outlineWidth/2,g=a.outlinePosition+a.outlineWidth/2,l=a.outlinePosition+
a.outlineWidth/2+a.innerHaloWidth,d=Math.sqrt(Math.PI/2)*e[3],k=Math.abs(b)>d?Math.round(10*(Math.abs(b)-d))/10:0,d=Math.abs(l)>d?Math.round(10*(Math.abs(l)-d))/10:0;k&&!d?console.warn("The outer rim of the highlight is "+k+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!k&&d?console.warn("The inner rim of the highlight is "+d+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):
k&&d&&console.warn("The highlight is "+Math.max(k,d)+"px away from the edge of the feature; consider reducing some width values.");for(var k=new Uint8Array(1024),m=[void 0,void 0,void 0,void 0],h=0;256>h;++h)d=b+h/255*(l-b),d<b?(k[4*h+0]=0,k[4*h+1]=0,k[4*h+2]=0,k[4*h+3]=0):d<f?c([0,0,0,0],a.outlineColor,(d-b)/(f-b)):d<g?(m[0]=a.outlineColor[0],m[1]=a.outlineColor[1],m[2]=a.outlineColor[2],m[3]=a.outlineColor[3]):d<l?c(a.outlineColor,a.fillColor,(d-g)/(l-g)):(k[4*h+0]=a.fillColor[0],k[4*h+1]=a.fillColor[1],
k[4*h+2]=a.fillColor[2],k[4*h+3]=a.fillColor[3]),k[4*h+0]=255*m[0]*m[3],k[4*h+1]=255*m[1]*m[3],k[4*h+2]=255*m[2]*m[3],k[4*h+3]=255*m[3];this._resources.highlightProgram.setUniform2fv("u_minMaxDistance",[b,l]);this._resources.shadeTex.updateData(0,0,0,256,1,k)}};a.prototype.setup=function(a,c,b){this._resources?(this._width=c,this._height=b):(this._initialize(a,c,b),this.setHighlightOptions(this._highlightOptions))};return a}()})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["require",
"exports","./sources/resolver"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.highlight={name:"highlight",shaders:{vertexShader:d.resolveIncludes("highlight/textured.vert"),fragmentShader:d.resolveIncludes("highlight/highlight.frag")},attributes:{a_position:0,a_texcoord:1}};a.blur={name:"blur",shaders:{vertexShader:d.resolveIncludes("highlight/textured.vert"),fragmentShader:d.resolveIncludes("highlight/blur.frag")},attributes:{a_position:0,a_texcoord:1}}})},"esri/views/2d/engine/webgl/painter/highlight/HighlightSurfaces":function(){define(["require",
"exports","../../../../../webgl/FramebufferObject","../../../../../webgl/Texture"],function(h,a,d,k){function b(a,b,e){b=new k(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:b,height:e,samplingMode:9729});a=d.createWithAttachments(a,b,{colorTarget:0,depthStencilTarget:2});return[b,a]}return function(){function a(){this._height=this._width=void 0;this._resources=null}a.prototype.dispose=function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),
this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)};a.prototype._initialize=function(a,e,c){this._width=e;this._height=c;var f=b(a,e,c),g=f[0],f=f[1];a=b(a,e,c);this._resources={sharedBlur1Tex:g,sharedBlur1Fbo:f,sharedBlur2Tex:a[0],sharedBlur2Fbo:a[1]}};a.prototype.setup=function(a,b,c){!this._resources||this._width===b&&this._height===c||this.dispose();this._resources||this._initialize(a,b,c)};Object.defineProperty(a.prototype,"sharedBlur1Tex",
{get:function(){return this._resources.sharedBlur1Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur1Fbo",{get:function(){return this._resources.sharedBlur1Fbo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Tex",{get:function(){return this._resources.sharedBlur2Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Fbo",{get:function(){return this._resources.sharedBlur2Fbo},enumerable:!0,configurable:!0});
return a}()})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","../../core/has","./Renderbuffer","./Texture"],function(h,a,d,k,b){return function(){function a(g,e,c,f){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=g;this._desc={colorTarget:e.colorTarget,depthStencilTarget:e.depthStencilTarget,width:e.width,height:e.height,multisampled:e.multisampled};this._id=a._nextId++;c&&(g=void 0,
c instanceof b?(this._colorAttachment=c,g=c.descriptor):(g=c,this._colorAttachment=new b(this._context,g)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),a._validateTextureDimensions(g,this._desc));f instanceof k?(2===e.depthStencilTarget?this._stencilAttachment=f:1===e.depthStencilTarget||3===e.depthStencilTarget?this._depthAttachment=f:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),
a._validateBufferDimensions(f.descriptor,this._desc)):f&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),e=void 0,f instanceof b?(this._depthStencilTexture=f,e=this._depthStencilTexture.descriptor):(e=f,this._depthStencilTexture=new b(this._context,e)),a._validateTextureDimensions(e,this._desc))}a.create=function(b,e){return new a(b,e)};a.createWithAttachments=function(b,
e,c,f){return new a(b,c,e,f)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof b?this._colorAttachment:null},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._context&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),
this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context=null)};a.prototype.attachColorTexture=function(b){if(b){a._validateTextureDimensions(b.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var e=this._context.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,b.glName,0)}this._colorAttachment=b}};a.prototype.detachColorTexture=function(){var a=void 0;if(this._colorAttachment instanceof
b){a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var e=this._context.gl;this._context.gl.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}this._colorAttachment=null}return a};a.prototype.attachDepthStencilTexture=function(b){if(b){var e=b.descriptor;34041!==e.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==e.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");
this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");a._validateTextureDimensions(e,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),e=this._context.gl,e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,b.glName,0));this._depthStencilTexture=
b}};a.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};a.prototype.attachDepthStencilBuffer=function(b){if(b){var e=b.descriptor;34041!==e.internalFormat&&33189!==e.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");
a._validateBufferDimensions(e,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===e.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),e=this._context.gl,e.framebufferRenderbuffer(e.FRAMEBUFFER,1===this._desc.depthStencilTarget?e.DEPTH_ATTACHMENT:e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,b.glName));this._depthAttachment=b}};a.prototype.detachDepthStencilBuffer=function(){var a=this._context.gl,b=this._depthAttachment;b&&this._initialized&&
(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null));this._depthAttachment=null;return b};a.prototype.copyToTexture=function(a,b,c,f,d,l,k){(0>a||0>b||0>d||0>l)&&console.error("Offsets cannot be negative!");(0>=c||0>=f)&&console.error("Copy width and height must be greater than zero!");var e=this._desc,g=k.descriptor;3553!==k.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");
(a+c>e.width||b+f>e.height||d+c>g.width||l+f>g.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");e=this._context;e.bindTexture(k);e.bindFramebuffer(this);e.gl.copyTexSubImage2D(3553,0,d,l,a,b,c,f)};a.prototype.readPixels=function(a,b,c,f,d,l,k){(0>=c||0>=f)&&console.error("Copy width and height must be greater than zero!");k||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,
b,c,f,d,l,k)};a.prototype.resize=function(g,e){var c=this._desc;if(c.width!==g||c.height!==e)if(this._initialized)c.width=g,c.height=e,this._colorAttachment instanceof b?(f=this._colorAttachment,c=f.descriptor,c.width=g,c.height=e,this._colorAttachment.dispose(),this._colorAttachment=new b(this._context,c),a._validateTextureDimensions(f.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(c=this._depthStencilTexture.descriptor,c.width=g,c.height=
e,this._depthStencilTexture.dispose(),this._depthStencilTexture=new b(this._context,c)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1;else{c.width=g;c.height=e;if(this._colorAttachment instanceof b){var f=this._colorAttachment;f.resize(g,e)}this._depthStencilTexture&&this._depthStencilTexture.resize(g,e)}};a.prototype.initialize=function(){if(this._initialized)return!1;
var a=this._context.gl;this._glName&&a.deleteFramebuffer(this._glName);var e=a.createFramebuffer(),c=this._desc;a.bindFramebuffer(a.FRAMEBUFFER,e);if(!this._colorAttachment)if(0===c.colorTarget)this._colorAttachment=new b(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:c.width,height:c.height});else{var f=new k(this._context,{internalFormat:32854,width:c.width,height:c.height});a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,
f.glName);this._colorAttachment=f}this._colorAttachment instanceof b&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._colorAttachment.glName,0);switch(c.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new k(this._context,{internalFormat:1===c.depthStencilTarget?33189:34041,width:c.width,height:c.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,1===c.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthAttachment.glName);
break;case 2:this._stencilAttachment||(this._stencilAttachment=new k(this._context,{internalFormat:36168,width:c.width,height:c.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new b(this._context,
{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:c.width,height:c.height})),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,this._depthStencilTexture.glName,0)}a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=e;return this._initialized=!0};a.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof b){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);
var e=this._context.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(a=this._colorAttachment,e=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=null};a.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;this._depthAttachment&&
(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&
(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};a._validateBufferDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};
a._validateTextureDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Color attachment texture must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};a._nextId=0;return a}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","../../core/has"],function(h,a,d){return function(){function a(b,
d){this._context=b;this._desc=d;this._glName=null;this._id=-1;b=this._context.gl;this._id=++a._nextId;this._glName=b.createRenderbuffer();this._context.bindRenderbuffer(this);b.renderbufferStorage(b.RENDERBUFFER,d.internalFormat,d.width,d.height)}Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",
{get:function(){return this._glName},enumerable:!0,configurable:!0});a.prototype.resize=function(a,d){var b=this._context.gl,e=this._desc;if(e.width!==a||e.height!==d)e.width=a,e.height=d,this._context.bindRenderbuffer(this),b.renderbufferStorage(b.RENDERBUFFER,e.internalFormat,e.width,e.height)};a.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);this._context=null};a._nextId=0;return a}()})},"esri/views/2d/engine/webgl/shaders/RasterPrograms":function(){define(["require",
"exports","./sources/resolver"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.transformTexture={name:"transform-texture",shaders:{vertexShader:d.resolveIncludes("raster/transform.vert"),fragmentShader:d.resolveIncludes("raster/texture.frag")},attributes:{a_position:0,a_texcoord:1}};a.transformSolid={name:"transform-solid",shaders:{vertexShader:d.resolveIncludes("raster/transform.vert"),fragmentShader:d.resolveIncludes("raster/solid.frag")},attributes:{a_position:0}}})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["require",
"exports","./sources/resolver"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.stencil={name:"stencil",shaders:{vertexShader:d.resolveIncludes("stencil/stencil.vert"),fragmentShader:d.resolveIncludes("stencil/stencil.frag")},attributes:{a_pos:0}}})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ./enums ./InstanceCounter ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(h,a,d,k,b,l,g){return function(){function a(a,b){this.gl=
null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};
this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._lineWidth=1;this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap=
{};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=l.default(a)?"webgl2":"webgl";this.gl=a;a instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=g.loadCapabilities(a,b);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],width:a[2],height:a[3]};a=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)};this.enforceState()}Object.defineProperty(a.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});
a.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};a.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=a)};a.prototype.setBlendColor=function(a,b,e,g){if(a!==this._blendColorState.r||b!==this._blendColorState.g||e!==this._blendColorState.b||g!==this._blendColorState.a)this.gl.blendColor(a,b,e,g),this._blendColorState.r=
a,this._blendColorState.g=b,this._blendColorState.b=e,this._blendColorState.a=g};a.prototype.setBlendFunction=function(a,b){if(a!==this._blendFunctionState.srcRGB||b!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,b),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=b};a.prototype.setBlendFunctionSeparate=function(a,b,e,g){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==e||this._blendFunctionState.dstRGB!==
b||this._blendFunctionState.dstAlpha!==g)this.gl.blendFuncSeparate(a,b,e,g),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=g};a.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a)};a.prototype.setBlendEquationSeparate=function(a,b){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==
b)this.gl.blendEquationSeparate(a,b),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=b};a.prototype.setColorMask=function(a,b,e,g){if(this._colorMaskState.r!==a||this._colorMaskState.g!==b||this._colorMaskState.b!==e||this._colorMaskState.a!==g)this.gl.colorMask(a,b,e,g),this._colorMaskState.r=a,this._colorMaskState.g=b,this._colorMaskState.b=e,this._colorMaskState.a=g};a.prototype.setClearColor=function(a,b,e,g){if(this._clearColor.r!==a||this._clearColor.g!==b||this._clearColor.b!==
e||this._clearColor.a!==g)this.gl.clearColor(a,b,e,g),this._clearColor.r=a,this._clearColor.g=b,this._clearColor.b=e,this._clearColor.a=g};a.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a)};a.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),
this._polygonOffsetFillEnabled=a)};a.prototype.setPolygonOffset=function(a,b){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==b)this._polygonOffset[0]=a,this._polygonOffset[1]=b,this.gl.polygonOffset(a,b)};a.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a)};a.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a)};a.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):
this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};a.prototype.setScissorRect=function(a,b,e,g){if(this._scissorRect.x!==a||this._scissorRect.y!==b||this._scissorRect.width!==e||this._scissorRect.height!==g)this.gl.scissor(a,b,e,g),this._scissorRect.x=a,this._scissorRect.y=b,this._scissorRect.width=e,this._scissorRect.height=g};a.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=
a)};a.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};a.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a)};a.prototype.setDepthWriteEnabled=function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a)};a.prototype.setDepthRange=function(a,b){if(this._depthRange.zNear!==a||this._depthRange.zFar!==b)this.gl.depthRange(a,b),this._depthRange.zNear=a,this._depthRange.zFar=
b};a.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a)};a.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=a)};a.prototype.setStencilFunction=function(a,b,e){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==b||this._stencilFunction.mask!==e)this.gl.stencilFunc(a,b,e),this._stencilFunction.face=
1032,this._stencilFunction.func=a,this._stencilFunction.ref=b,this._stencilFunction.mask=e};a.prototype.setStencilFunctionSeparate=function(a,b,e,g){if(this._stencilFunction.face!==a||this._stencilFunction.func!==b||this._stencilFunction.ref!==e||this._stencilFunction.mask!==g)this.gl.stencilFuncSeparate(a,b,e,g),this._stencilFunction.face=a,this._stencilFunction.func=b,this._stencilFunction.ref=e,this._stencilFunction.mask=g};a.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&
(this.gl.stencilMask(a),this._stencilWriteMask=a)};a.prototype.setStencilOp=function(a,b,e){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==e)this.gl.stencilOp(a,b,e),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=b,this._stencilOperation.zPass=e};a.prototype.setStencilOpSeparate=function(a,b,e,g){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==b||this._stencilOperation.zFail!==e||this._stencilOperation.zPass!==
g)this.gl.stencilOpSeparate(a,b,e,g),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=b,this._stencilOperation.zFail=e,this._stencilOperation.zPass=g};a.prototype.setLineWidth=function(a){var b=this._lineWidth;this._lineWidth!==a&&(this.gl.lineWidth(a),this._lineWidth=a);return b};a.prototype.setActiveTexture=function(a){var b=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(k.BASE_TEXTURE_UNIT+a),this._activeTextureUnit=a);return b};
a.prototype.clear=function(a){a&&this.gl.clear(a)};a.prototype.drawArrays=function(a,b,e){this.gl.drawArrays(a,b,e)};a.prototype.drawElements=function(a,b,e,g){5123===e?this.gl.drawElements(a,b,e,g):5125===e&&this.gl.drawElements(a,b,e,g)};a.prototype.logIno=function(){};Object.defineProperty(a.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});a.prototype.setViewport=function(a,b,e,g){var c=this._viewport;if(c.x!==a||c.y!==b||c.width!==e||c.height!==
g)c.x=a,c.y=b,c.width=e,c.height=g,this.gl.viewport(a,b,e,g)};a.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};a.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};a.prototype.bindTexture=function(b,f){void 0===f&&(f=0);-1===a._MAX_TEXTURE_IMAGE_UNITS&&(a._MAX_TEXTURE_IMAGE_UNITS=
this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(f>=a._MAX_TEXTURE_IMAGE_UNITS||0>f)&&console.error("Input texture unit is out of range of available units!");var c=this._textureUnitMap[f];this.setActiveTexture(f);null==b||null==b.glName?(null!=c&&(this.gl.bindTexture(c.descriptor.target,null),c.setBoundToUnit(f,!1)),this._textureUnitMap[f]=null):c&&c.id===b.id?b.applyChanges():(this.gl.bindTexture(b.descriptor.target,b.glName),b.setBoundToUnit(f,!0),b.applyChanges(),this._textureUnitMap[f]=
b)};a.prototype.bindFramebuffer=function(a){a?this._activeFramebuffer!==a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};a.prototype.bindBuffer=function(b){b&&(34962===b.bufferType?this._activeVertexBuffer=a._bindBuffer(this.gl,b,b.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,b,b.bufferType,this._activeIndexBuffer))};a.prototype.bindRenderbuffer=
function(a){var b=this.gl;a||(b.bindRenderbuffer(b.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(b.bindRenderbuffer(b.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};a.prototype.unbindBuffer=function(b){34962===b?this._activeVertexBuffer=a._bindBuffer(this.gl,null,b,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,null,b,this._activeIndexBuffer)};a.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===
a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};a.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};a.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};a.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};a.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);
this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);
this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};a.prototype.enforceState=function(){var a=this.gl,b=this._capabilities.vao;b&&b.bindVertexArray(null);for(var e=0;e<this.parameters.maxVertexAttributes;e++)a.disableVertexAttribArray(e);
this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(b&&this._activeVertexArrayObject){if(b=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(b)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:
null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);a.bindRenderbuffer(a.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,
this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?
a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);a.lineWidth(this._lineWidth);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?
a.enable(a.SCISSOR_TEST):a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(b=0;b<this.parameters.maxTextureImageUnits;b++)a.activeTexture(k.BASE_TEXTURE_UNIT+b),a.bindTexture(3553,
null),(e=this._textureUnitMap[b])&&a.bindTexture(e.descriptor.target,e.glName);a.activeTexture(k.BASE_TEXTURE_UNIT+this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};a._bindBuffer=function(a,b,e,g){if(!b)return a.bindBuffer(e,null),null;if(g===b)return g;a.bindBuffer(e,b.glName);return b};a._MAX_TEXTURE_IMAGE_UNITS=-1;return a}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,
"__esModule",{value:!0});a.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(h,a){return function(){function a(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}a.prototype.incrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;
break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}};a.prototype.decrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}};a.prototype.printResourceCount=function(){console.log("Live objects:");
console.log("Textures: "+this._instanceCount.textureCount);console.log("Buffers: "+this._instanceCount.bufferCount);console.log("VAOs: "+this._instanceCount.vaoCount);console.log("Programs: "+this._instanceCount.programCount);console.log("Framebuffers: "+this._instanceCount.framebufferCount);console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)};return a}()})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,
"__esModule",{value:!0});a.default=function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./VertexArrayObjects".split(" "),function(h,a,d,k,b,l){function g(a,c,f,g,d){if(g&&b.default(a))return!0;if(c[f])return!1;for(c=0;c<d.length;c++)if(a.getExtension(d[c]))return!0;return!1}Object.defineProperty(a,"__esModule",{value:!0});a.loadCapabilities=
function(a,c){c=c&&c.disabledExtensions||{};g(a,c,"standardDerivatives",!0,["OES_standard_derivatives"]);var f=k.load(a),e=l.load(a,c),h;h=c.compressedTextureS3TC?null:(h=a.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:h.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:h.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:h.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:h.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null;var x;x=c.textureFilterAnisotropic?null:(x=a.getExtension("EXT_texture_filter_anisotropic")||
a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:x.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:x.TEXTURE_MAX_ANISOTROPY_EXT}:null;var u=d.load(a,c),w;if(b.default(a))w=c.colorBufferFloat||!a.getExtension("EXT_color_buffer_float")?null:{R16F:a.R16F,RG16F:a.RG16F,RGBA16F:a.RGBA16F,R32F:a.R32F,RG32F:a.RG32F,RGBA32F:a.RGBA32F,R11F_G11F_B10F:a.R11F_G11F_B10F};else if(a instanceof WebGLRenderingContext){w=
!c.colorBufferFloat&&a.getExtension("EXT_color_buffer_half_float");var r=!c.colorBufferFloat&&a.getExtension("WEBGL_color_buffer_float");w=w||r?{RGBA16F:w?w.RGBA16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}else w=void 0;r=b.default(a)?{MIN:a.MIN,MAX:a.MAX}:c.blendMinMax?null:(r=a.getExtension("EXT_blend_minmax"))?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null;return{instancing:f,vao:e,compressedTextureS3TC:h,textureFilterAnisotropic:x,disjointTimerQuery:u,colorBufferFloat:w,blendMinMax:r,depthTexture:g(a,
c,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:g(a,c,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),textureFloatLinear:g(a,c,"textureFloatLinear",!1,["OES_texture_float_linear"]),fragDepth:g(a,c,"fragDepth",!0,["EXT_frag_depth"])}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});
a.load=function(a,b){if(b.disjointTimerQuery)return null;var l=a.getExtension("EXT_disjoint_timer_query")||a.getExtension("EXT_disjoint_timer_query_webgl2");return l?d.default(a)?{createQuery:function(){return a.createQuery()},resultAvailable:function(b){return a.getQueryParameter(b,a.QUERY_RESULT_AVAILABLE)},getResult:function(b){return a.getQueryParameter(b,a.QUERY_RESULT)},disjoint:function(){return a.getParameter(l.GPU_DISJOINT_EXT)},beginTimeElapsed:function(b){return a.beginQuery(l.TIME_ELAPSED_EXT,
b)},endTimeElapsed:function(){return a.endQuery(l.TIME_ELAPSED_EXT)},createTimestamp:function(a){return l.queryCounterEXT(a,l.TIMESTAMP_EXT)},timestampBits:function(){return a.getQuery(l.TIMESTAMP_EXT,l.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return l.createQueryEXT()},resultAvailable:function(a){return l.getQueryObjectEXT(a,l.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(a){return l.getQueryObjectEXT(a,l.QUERY_RESULT_EXT)},disjoint:function(){return a.getParameter(l.GPU_DISJOINT_EXT)},
beginTimeElapsed:function(a){return l.beginQueryEXT(l.TIME_ELAPSED_EXT,a)},endTimeElapsed:function(){return l.endQueryEXT(l.TIME_ELAPSED_EXT)},createTimestamp:function(a){return l.queryCounterEXT(a,l.TIMESTAMP_EXT)},timestampBits:function(){return l.getQueryEXT(l.TIMESTAMP_EXT,l.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});a.load=function(a){return d.default(a)?
{drawArraysInstanced:a.drawArraysInstanced.bind(a),drawElementsInstanced:a.drawElementsInstanced.bind(a),vertexAttribDivisor:a.vertexAttribDivisor.bind(a)}:(a=a.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:a.drawArraysInstancedANGLE.bind(a),drawElementsInstanced:a.drawElementsInstancedANGLE.bind(a),vertexAttribDivisor:a.vertexAttribDivisorANGLE.bind(a)}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require","exports","./isWebGL2Context"],function(h,
a,d){Object.defineProperty(a,"__esModule",{value:!0});a.load=function(a,b){return d.default(a)?{createVertexArray:a.createVertexArray.bind(a),deleteVertexArray:a.deleteVertexArray.bind(a),bindVertexArray:a.bindVertexArray.bind(a)}:b.vao?null:(a=a.getExtension("OES_vertex_array_object")||a.getExtension("MOZ_OES_vertex_array_object")||a.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:a.createVertexArrayOES.bind(a),deleteVertexArray:a.deleteVertexArrayOES.bind(a),bindVertexArray:a.bindVertexArrayOES.bind(a)}:
null}})},"esri/views/2d/LabelManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/HandleOwner ../../core/throttle ../../core/accessorSupport/decorators ./engine/webgl/collisions/CollisionEngine ./engine/webgl/collisions/LayerViewSorter".split(" "),function(h,a,d,k,b,l,g,e,c,f){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function b(b){b=a.call(this)||this;b._applyVisivilityPassThrottled=
g.throttle(b._applyVisivilityPass,64,b);b._previousResolution=Number.POSITIVE_INFINITY;b.lastUpdateId=-1;b.updateRequested=!1;b.view=null;return b}d(b,a);b.prototype.initialize=function(){var a=this;this.collisionEngine=new c.default(this.view.featuresTilingScheme);this._layerViewSorter=new f.default(function(b,c){a.collisionEngine.registerLayer(b.layer,c);(c=b.tileRenderer)&&c.forEachTile(function(c){c.isDirty=!0;a.addTile(b.layer.uid,c)});a.requestUpdate()},function(b){a.collisionEngine.unregisterLayer(b.layer);
a.requestUpdate()});this.handles.add(this.view.allLayerViews.on("change",function(b){a._layerViewSorter.update(b)}))};b.prototype.destroy=function(){this._layerViewSorter.destroy();this.collisionEngine=this._layerViewSorter=null;this._applyVisivilityPassThrottled.remove()};Object.defineProperty(b.prototype,"updating",{get:function(){return this.updateRequested},enumerable:!0,configurable:!0});b.prototype.update=function(a){var b=this._previousResolution,c=a.state.resolution;this._previousResolution=
c;c===b&&this._applyVisivilityPassThrottled(a)};b.prototype.viewChange=function(){this.requestUpdate()};b.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))};b.prototype.processUpdate=function(a){this._set("updateParameters",a);this.updateRequested&&(this.update(a),this.updateRequested=!1)};b.prototype.addTile=function(a,b){this.collisionEngine.addTile(a,b)};b.prototype.removeTile=function(a,b){this.collisionEngine.removeTile(a,b)};b.prototype._applyVisivilityPass=
function(a){var b=this.view.featuresTilingScheme.getClosestInfoForScale(a.state.scale).level;this.collisionEngine.run(a.state,b)};k([e.property()],b.prototype,"updateRequested",void 0);k([e.property({readOnly:!0})],b.prototype,"updateParameters",void 0);k([e.property({dependsOn:["updateRequested"]})],b.prototype,"updating",null);k([e.property()],b.prototype,"view",void 0);return b=k([e.subclass("esri.views.2d.layers.labels.LabelManager")],b)}(e.declared(b,l));a.default=h})},"esri/views/2d/engine/webgl/collisions/CollisionEngine":function(){define("require exports @dojo/framework/shim/array @dojo/framework/shim/Map ../definitions ./CollisionBucket ./LayerCollisionInfo ../util/iterator ../../../../3d/support/mathUtils".split(" "),
function(h,a,d,k,b,l,g,e,c){Object.defineProperty(a,"__esModule",{value:!0});var f=b.TILE_SIZE/b.COLLISION_BUCKET_SIZE;h=function(){function a(a){this._layers=new k.default;this._collisionBuckets=new k.default;this._tilingScheme=a}Object.defineProperty(a.prototype,"collisionInfos",{get:function(){var a=[];e.forEachIter(this._layers.values(),function(b){return a.push(b)});return a},enumerable:!0,configurable:!0});a.prototype.registerLayer=function(a,b){if(a&&!this._layers.has(a.uid)){var c=g.default.create(a,
b,this.collisionInfos,this._tilingScheme);this._layers.set(a.uid,c);this._collisionBuckets.forEach(function(a){return a.onRegisterLayer(c.index)})}};a.prototype.unregisterLayer=function(a){var b=this;if(a&&this._layers.has(a.uid)){var c=this._layers.get(a.uid);g.default.delete(c.index,this.collisionInfos);this._layers.delete(a.uid);this._collisionBuckets.forEach(function(a,f){var e=a.getTile(c.index);e&&(e.dirty=!1,a.onUnregisterLayer(c.index),a.canDelete()&&b._collisionBuckets.delete(f))})}};a.prototype.addTile=
function(a,b){var c=b.key.id;this._layers.has(a)&&(this._collisionBuckets.has(c)||this._collisionBuckets.set(c,new l.default(b.key,this._layers.size)),this._collisionBuckets.get(c).getTile(this._getIndex(a)).reference=b)};a.prototype.removeTile=function(a,b){this._layers.has(a)&&this._collisionBuckets.has(b)&&(this._collisionBuckets.get(b).getTile(this._getIndex(a)).reference=null)};a.prototype.run=function(a,b){for(var c=d.from(this._collisionBuckets.values()).filter(function(a){return a.key.level===
b}).sort(function(a,b){return a.key.compareRowMajor(b.key)}),f=this._checkRotation(a.rotation),e=0;e<c.length;e++)for(var l=c[e],f=f||l.isDirty,k=0;k<this._layers.size;k++){var h=g.default.find(k,this.collisionInfos);l.computeNeighbors(this._collisionBuckets);l.reset(a,f,h)}for(a=0;a<this._layers.size;a++)for(h=g.default.find(a,this.collisionInfos),f=0,e=c;f<e.length;f++)l=e[f],this._run(l,h,b);for(h=0;h<c.length;h++)l=c[h],l.ready()};a.prototype._run=function(a,b,c){var f=a.getReference(b.index);
f&&f.isDirty&&f.hasData&&this._runVisibility(a,f,b,c)};a.prototype._runVisibility=function(a,b,c,f){for(var e=0,g=b.displayObjects;e<g.length;e++){for(var d=g[e],l=0,k=0;k<d.metrics.length;k++)var h=d.metrics[k],h=this._computeLabelVisibility(d,h,c.index,a,b,h.baseZoom,f),l=Math.max(h,l);for(var k=0,m=d.metrics;k<m.length;k++)h=m[k],b.setVisibilityRange(d.id,h.range.from,h.range.count,l),h.minZoom=l}};a.prototype._computeLabelVisibility=function(a,b,c,e,g,d,l){for(var k=b.xBucket,h=b.yBucket,m=b.xOverflow,
p=b.yOverflow,t=k-m,k=k+m+1,m=h+p+1,h=h-p;h<m;h++)for(p=t;p<k;p++)if(!(p<-f||h<-f||p>f||h>f))for(var r=0;r<=c;r++){var u=this._getRelativeSubBucket(r,e,g,p,h);if(u)for(var w=0;w<u.length;w++){var x=u[w];x.id!==a.id&&(x=this._compareLabels(b,x,d,l),d=Math.max(x,d))}}return d};a.prototype._compareLabels=function(a,f,e,g){var d=10*(g+b.COLLISION_MAX_ZOOM_DELTA);if(-1===f.minZoom||f.minZoom>d||f.minZoom>Math.floor(10*g))return e;a=a.findCollisionDelta(f);g=c.clamp(Math.floor(10*(a+g)),0,255);return f.minZoom>=
g?e:Math.max(e,g)};a.prototype._getNeighboringTile=function(a,b,c,f,e){return(b=b.neighbors[3*(1+e)+(1+f)])&&b.getTile(a)};a.prototype._getRelativeSubBucket=function(a,b,f,e,g){var d=c.sign(Math.floor(e/4)),l=c.sign(Math.floor(g/4));return(a=this._getNeighboringTile(a,b,f,d,l))&&a.reference&&a.index&&a.reference.hasData?a.index[g-4*l][e-4*d]:null};a.prototype._checkRotation=function(a){if(!this._lastRotation)return this._lastRotation=a,!1;var b=a!==this._lastRotation;this._lastRotation=a;return b};
a.prototype._getIndex=function(a){return this._layers.get(a).index};return a}();a.default=h})},"@dojo/framework/shim/Map":function(){(function(h){"object"===typeof module&&"object"===typeof module.exports?(h=h(require,exports),void 0!==h&&(module.exports=h)):"function"===typeof define&&define.amd&&define("require exports tslib ./iterator ./global ./object ./support/has ./Symbol".split(" "),h)})(function(h,a){Object.defineProperty(a,"__esModule",{value:!0});var d=h("tslib"),k=h("./iterator"),b=h("./global"),
l=h("./object"),g=h("./support/has");h("./Symbol");a.Map=b.default.Map;g.default("es6-map")||(a.Map=(e=function(){function a(a){this._keys=[];this._values=[];this[Symbol.toStringTag]="Map";if(a)if(k.isArrayLike(a))for(var b=0;b<a.length;b++){var c=a[b];this.set(c[0],c[1])}else try{for(var b=d.__values(a),f=b.next();!f.done;f=b.next())c=f.value,this.set(c[0],c[1])}catch(r){e={error:r}}finally{try{f&&!f.done&&(g=b.return)&&g.call(b)}finally{if(e)throw e.error;}}var e,g}a.prototype._indexOfKey=function(a,
b){for(var c=0,f=a.length;c<f;c++)if(l.is(a[c],b))return c;return-1};Object.defineProperty(a.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this._keys.length=this._values.length=0};a.prototype.delete=function(a){a=this._indexOfKey(this._keys,a);if(0>a)return!1;this._keys.splice(a,1);this._values.splice(a,1);return!0};a.prototype.entries=function(){var a=this,b=this._keys.map(function(b,c){return[b,a._values[c]]});return new k.ShimIterator(b)};
a.prototype.forEach=function(a,b){for(var c=this._keys,f=this._values,e=0,g=c.length;e<g;e++)a.call(b,f[e],c[e],this)};a.prototype.get=function(a){a=this._indexOfKey(this._keys,a);return 0>a?void 0:this._values[a]};a.prototype.has=function(a){return-1<this._indexOfKey(this._keys,a)};a.prototype.keys=function(){return new k.ShimIterator(this._keys)};a.prototype.set=function(a,b){var c=this._indexOfKey(this._keys,a),c=0>c?this._keys.length:c;this._keys[c]=a;this._values[c]=b;return this};a.prototype.values=
function(){return new k.ShimIterator(this._values)};a.prototype[Symbol.iterator]=function(){return this.entries()};return a}(),e[Symbol.species]=e,e));a.default=a.Map;var e})},"@dojo/framework/shim/object":function(){(function(h){"object"===typeof module&&"object"===typeof module.exports?(h=h(require,exports),void 0!==h&&(module.exports=h)):"function"===typeof define&&define.amd&&define(["require","exports","./global","./support/has","./Symbol"],h)})(function(h,a){Object.defineProperty(a,"__esModule",
{value:!0});var d=h("./global"),k=h("./support/has"),b=h("./Symbol");k.default("es6-object")?(h=d.default.Object,a.assign=h.assign,a.getOwnPropertyDescriptor=h.getOwnPropertyDescriptor,a.getOwnPropertyNames=h.getOwnPropertyNames,a.getOwnPropertySymbols=h.getOwnPropertySymbols,a.is=h.is,a.keys=h.keys):(a.keys=function(a){return Object.keys(a).filter(function(a){return!a.match(/^@@.+/)})},a.assign=function(b){for(var g=[],e=1;e<arguments.length;e++)g[e-1]=arguments[e];if(null==b)throw new TypeError("Cannot convert undefined or null to object");
var c=Object(b);g.forEach(function(b){b&&a.keys(b).forEach(function(a){c[a]=b[a]})});return c},a.getOwnPropertyDescriptor=function(a,g){b.isSymbol(g);return Object.getOwnPropertyDescriptor(a,g)},a.getOwnPropertyNames=function(a){return Object.getOwnPropertyNames(a).filter(function(a){return!a.match(/^@@.+/)})},a.getOwnPropertySymbols=function(a){return Object.getOwnPropertyNames(a).filter(function(a){return!!a.match(/^@@.+/)}).map(function(a){return Symbol.for(a.substring(2))})},a.is=function(a,b){return a===
b?0!==a||1/a===1/b:a!==a&&b!==b});k.default("es2017-object")?(h=d.default.Object,a.getOwnPropertyDescriptors=h.getOwnPropertyDescriptors,a.entries=h.entries,a.values=h.values):(a.getOwnPropertyDescriptors=function(b){return a.getOwnPropertyNames(b).reduce(function(g,e){g[e]=a.getOwnPropertyDescriptor(b,e);return g},{})},a.entries=function(b){return a.keys(b).map(function(a){return[a,b[a]]})},a.values=function(b){return a.keys(b).map(function(a){return b[a]})})})},"esri/views/2d/engine/webgl/collisions/CollisionBucket":function(){define(["require",
"exports","../../../tiling","./CollisionBucketEntry"],function(h,a,d,k){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,b){this.neighbors=Array(9);this._tiles=Array(b);for(var e=0;e<b;e++)this._tiles[e]=new k.default;this.key=a}Object.defineProperty(a.prototype,"isDirty",{get:function(){for(var a=0,b=this._tiles;a<b.length;a++)if(b[a].dirty)return!0;return!1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){return this._tiles.length},
enumerable:!0,configurable:!0});a.prototype.getTile=function(a){return this._tiles[a]};a.prototype.getReference=function(a){return(a=this._tiles[a])&&a.reference};a.prototype.onRegisterLayer=function(a){this.invalidateRange(a);this._add(a)};a.prototype.onUnregisterLayer=function(a){this.invalidateRange(a);this._remove(a)};a.prototype.onLabelsRendered=function(){};a.prototype.invalidateRange=function(a){for(;a<this._tiles.length;a++)this._tiles[a].dirty=!0};a.prototype.add=function(a){this._add(a)};
a.prototype.remove=function(a){this._remove(a)};a.prototype.canDelete=function(){return 0===this._tiles.length};a.prototype.ready=function(){for(var a=0,b=this._tiles;a<b.length;a++)b[a].dirty=!1};a.prototype.computeNeighbors=function(a){this.neighbors[0]=this._getNeighbor(a,-1,-1);this.neighbors[1]=this._getNeighbor(a,0,-1);this.neighbors[2]=this._getNeighbor(a,1,-1);this.neighbors[3]=this._getNeighbor(a,-1,0);this.neighbors[4]=this;this.neighbors[5]=this._getNeighbor(a,1,0);this.neighbors[6]=this._getNeighbor(a,
-1,1);this.neighbors[7]=this._getNeighbor(a,0,1);this.neighbors[8]=this._getNeighbor(a,1,1)};a.prototype.reset=function(a,b,e){for(var c=0,f=this._tiles;c<f.length;c++){var g=f[c];g&&g.reset(a,b,e)}};a.prototype._add=function(a){var b=[];if(a>=this._tiles.length)this._tiles.push(new k.default);else{for(var e=0;e<this._tiles.length;e++)e===a&&b.push(new k.default),b.push(this._tiles[e]);this._tiles=b}};a.prototype._remove=function(a){for(var b=[],e=0;e<this._tiles.length;e++)e!==a&&b.push(this._tiles[e]);
this._tiles=b};a.prototype._getNeighbor=function(a,b,e){var c=this.key;b=d.TileKey.getId(c.level,c.row+e,c.col+b,c.world);return a.has(b)?a.get(b):null};return a}();a.default=h})},"esri/views/2d/engine/webgl/collisions/CollisionBucketEntry":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/gl-matrix"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._reference=null}Object.defineProperty(a.prototype,"dirty",{get:function(){return this.reference&&
this.reference.isDirty},set:function(a){this.reference&&this.reference.hasData&&(this.reference.isDirty=a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"index",{get:function(){return this._reference&&this._reference.labelIndex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"reference",{get:function(){return this._reference},set:function(a){this._reference=a},enumerable:!0,configurable:!0});a.prototype.reset=function(a,l,g){var b=this.reference;if(!b||!b.hasData)return!1;
l&&(b.isDirty=!0);l=b.labelMat2d;for(var c=b.labelMat2d[4],f=b.labelMat2d[5],k=0,h=b.displayObjects;k<h.length;k++)for(var x=0,u=h[k].metrics;x<u.length;x++){var w=u[x];g.hasVV()&&w.computeOffset(g.vvEval);var r=w.bounds.center,t=w.bounds.centerT;b.isDirty&&(w.minZoom=-1);var A=d.vec2.copy(t,w.anchor);a.rotation?d.vec2.transformMat2d(A,A,l):(t[0]=A[0]+c,t[1]=A[1]+f);d.vec2.add(t,A,r);t[0]+=w.offsetX;t[1]+=w.offsetY;if(w.boxes)for(r=0,t=w.boxes;r<t.length;r++){var A=t[r],C=A.centerT;d.vec2.add(C,w.anchor,
A.center);a.rotation?d.vec2.transformMat2d(C,C,l):(C[0]+=c,C[1]+=f)}}return!0};return a}();a.default=h})},"esri/views/2d/engine/webgl/collisions/LayerCollisionInfo":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/screenUtils","../../../../3d/support/mathUtils"],function(h,a,d,k,b){function l(a){return function(b){return k.pt2px(a.getSize(b))}}function g(a){if(!a)return null;for(var b=0;b<a.length;b++){var c=a[b];if("size"===c.type)return l(c)}return null}Object.defineProperty(a,
"__esModule",{value:!0});var e=function(a,b){return a.order-b.order},c=function(a,b){return a.index-b.index},f=d.getLogger("esri/views/2d/engine/webgl/collisions/CollisionEngine");a.createLabelVVEvaluator=g;h=function(){function a(a,c,f,e){var d=this;this._vvHandle=null;var l=a.geometryType,k=a.labelingInfo,h=a.renderer;this.vvEval=g("visualVariables"in h&&h.visualVariables);this._vvHandle=a.watch("visualVariables",function(a){d.vvEval=g(a)});a=k.map(function(a){var c=!!a.maxScale,f=!!a.minScale&&
e.scaleToZoom(a.minScale)||0;a=c&&e.scaleToZoom(a.maxScale)||255;return{minZoom:b.clamp(Math.floor(10*f),0,255),maxZoom:b.clamp(Math.floor(10*a),0,255)}});this.geometryType=l;this.index=c;this.order=f;this.zoomRanges=a}a.prototype.hasVV=function(){return!!this.vvEval};a.prototype.allOrNothing=function(){return"polyline"!==this.geometryType};a.prototype.destroy=function(){this._vvHandle.remove()};a.create=function(b,c,f,g){f=f.sort(e);for(var d=!1,l=-1,k=0;k<f.length;k++){var h=f[k];!d&&h.order>c&&
(l=h.index,d=!0);d&&h.index++}d||(l=f.length);return new a(b,l,c,g)};a.delete=function(a,b){for(var f=b.sort(c),e=a+1;e<f.length;e++)b[e].index--;b[a].destroy();b.splice(a,1)};a.find=function(a,b){for(var c=0;c<b.length;c++){var e=b[c];if(e.index===a)return e}f.error("Tried to get a LayerCollisionInfo for an index that doesn't exist!");return null};return a}();a.default=h})},"esri/views/2d/engine/webgl/util/iterator":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",
{value:!0});a.forEachIter=function(a,k){for(;;){var b=a.next();if(b.done)break;k(b.value)}}})},"esri/views/2d/engine/webgl/collisions/LayerViewSorter":function(){define(["require","exports","@dojo/framework/shim/Map"],function(h,a,d){function k(a){return"esri.views.2d.layers.FeatureLayerView2D"===a.declaredClass||"esri.views.2d.layers.StreamLayerView2D"===a.declaredClass}Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,b){this.registerLayer=a;this.unregisterLayer=b;this._layerViewState=
new d.default}a.prototype.findIndex=function(a){return a.view.allLayerViews.findIndex(function(b){return b.uid===a.uid})};a.prototype.update=function(a){for(var b=a.added,e=0,c=a.removed;e<c.length;e++)a=c[e],k(a)&&this._layerViewState.has(a)&&this._deleteState(a);for(e=0;e<b.length;e++){a=b[e];if(c=k(a))a:switch(a.get("layer.renderer.type")){case "class-breaks":case "simple":case "unique-value":c=!0;break a;default:c=!1}c&&!this._layerViewState.has(a)&&this._createState(a)}this._recomputeOrder()};
a.prototype.destroy=function(){var a=this;this._layerViewState.forEach(function(b,e){return a._deleteState(e)})};a.prototype._createState=function(a){var b={priority:-1,handle:null};b.handle=a.watch("labelsVisible",this._recomputeOrder.bind(this));this._layerViewState.set(a,b);return b};a.prototype._deleteState=function(a){if(this._layerViewState.has(a)){var b=this._layerViewState.get(a);b.handle.remove();-1!==b.priority&&this.unregisterLayer(a);this._layerViewState.delete(a)}};a.prototype._recomputeOrder=
function(){var a=this;this._layerViewState.forEach(function(b,e){var c=e.view.map.allLayers.findIndex(function(a){return a.uid===e.layer.uid}),f=e.layer,c=f.visible&&f.labelsVisible&&f.labelingInfo?4294967295-c:-1;c!==b.priority&&(b.priority=c,a.unregisterLayer(e),-1!==c&&a.registerLayer(e,c))})};return a}();a.default=h})},"esri/views/2d/layers/support/GraphicsView2D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../Graphic ../../../../core/Collection ../../../../core/HandleOwner ../../../../core/Identifiable ../../../../core/MapPool ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/jsonUtils ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/data/projectionSupport ../../engine/webgl/GraphicContainer ../../engine/webgl/TileData ../../engine/webgl/WGLTile ../../engine/webgl/mesh/factories/matcherUtils ../../engine/webgl/mesh/factories/MaterialStore ../../engine/webgl/mesh/factories/WGLMeshFactory ../../engine/webgl/mesh/templates/WGLTemplateStore ../features/support/TileStore ../graphics/GraphicProcessingQueue ../graphics/GraphicStore ../graphics/graphicsUtils ../../../layers/GraphicsView".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w,r,t,A,C,z,v,y,D,F,G,E,J,H,I){Object.defineProperty(a,"__esModule",{value:!0});var K=new p,N=new Set,O=[];h=function(a){function e(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];b=a.apply(this,b)||this;b._hiddenGraphics=[];b._tiles=new Map;b._graphicStoreUpdate=!1;b._highlightIDs=new Set;b._graphicsSet=new Set;b._matcher=null;b._tileUpdateSet=new Set;b.lastUpdateId=-1;b.updateRequested=!1;b.graphicUpdateHandler=b.graphicUpdateHandler.bind(b);b._addOrUpdateGraphic=
b._addOrUpdateGraphic.bind(b);b._processAnalyzedGraphics=b._processAnalyzedGraphics.bind(b);b._graphicsChangeHandler=b._graphicsChangeHandler.bind(b);return b}d(e,a);e.prototype.initialize=function(){var a=this;this._tileStore=new G.default(this.view.featuresTilingScheme);this.container=new A.default({tileInfoView:this.view.featuresTilingScheme,highlightOptions:this.view.highlightOptions,highlightIDs:this._highlightIDs});this._graphicStore=new J.default(this.view.featuresTilingScheme,this.view.state.scale,
this.uid,this.renderer,this.graphics);this._graphicProcessingQueue=new E.default({process:this._addOrUpdateGraphic});var b=new y.default,c=new F.default(this.container.getMaterialItems,devicePixelRatio);this.renderer&&(this._matcher=v.createMatcher(this.renderer,b,c,null));this._meshFactory=new D.default(null,this.uid,null,null,this.view.state.pixelRatio,this.view.spatialReference,b,c,null,this._tileStore.tileScheme.tileInfo);this.watch("renderer",function(f){if(a._graphicStore.renderer=f)a._matcher=
v.createMatcher(a.renderer,b,c,null)});this._tileStore.on("update",this._onTileUpdate.bind(this));this.view.watch("highlightOptions.color,highlightOptions.fillOpacity,highlightOptions.haloOpacity",function(){a.container.requestRender()});this.container.on("attach",function(){var b=a.graphics.toArray();b.sort(function(b,c){return a.graphics.indexOf(c)-a.graphics.indexOf(b)});for(var c=0;c<b.length;c++)a._add(b[c]);a.handles.add(a.graphics.on("change",a._graphicsChangeHandler),"graphics")})};e.prototype.destroy=
function(){this._graphicStore.clear();this._tileStore.destroy()};Object.defineProperty(e.prototype,"updating",{get:function(){return this._graphicProcessingQueue.updating||0<this._tileUpdateSet.size},enumerable:!0,configurable:!0});e.prototype.install=function(a){a.addChild(this.container)};e.prototype.uninstall=function(a){a.removeChild(this.container)};e.prototype.addHighlight=function(a){for(var b=0;b<a.length;b++)this._highlightIDs.add(a[b]);this._buildHLList()};e.prototype.highlight=function(a){var b=
this;b.addHighlight(a);return{remove:function(){b.removeHighlight(a)}}};e.prototype.hitTest=function(a,b){if(!this.view||!this.view.position)return f.resolve();this.view.toMap(a,b,K);return this.searchFeatures(K).then(function(a){return a&&a.length?a[0]:null})};e.prototype.searchFeatures=function(a,b){var c=this;void 0===b&&(b=2);return f.create(function(f){f(c._graphicStore.hitTest(a.x,a.y,b,c.view.state.resolution,c.view.state.rotation))})};e.prototype.removeHighlight=function(a){for(var b=0;b<
a.length;b++)this._highlightIDs.delete(a[b]);this._buildHLList()};e.prototype.setHighlight=function(a){this._highlightIDs.clear();this.addHighlight(a)};e.prototype.update=function(a){a=a.state;var b=this.view.featuresTilingScheme.getClosestInfoForScale(a.scale).level;this._graphicStore.updateLevel(b);this._tileStore.setViewState(a);this._graphicStoreUpdate=!0;this.updateRequested=!1};e.prototype.viewChange=function(){this.requestUpdate()};e.prototype.requestUpdate=function(){this.updateRequested||
(this.updateRequested=!0,this.view.requestUpdate(this))};e.prototype.processUpdate=function(a){this.updateRequested&&(this.updateRequested=!1,this.update(a))};e.prototype.graphicUpdateHandler=function(a){var b=a.graphic,c=a.newValue;switch(a.property){case "geometry":case "symbol":this._graphicProcessingQueue.push(b,"update");break;case "visible":this._setVisible(b.uid,c)}};e.prototype._graphicsChangeHandler=function(a){if(!this._graphicStoreUpdate){var b=this.view.state,c=this.view.featuresTilingScheme.getClosestInfoForScale(b.scale).level;
this._graphicStore.updateLevel(c);this._tileStore.setViewState(b)}var c=a.added,b=a.moved,f=0;for(a=a.removed;f<a.length;f++)this._remove(a[f]);for(a=0;a<c.length;a++)this._add(c[a]);for(a=0;a<b.length;a++)this._reorder(b[a])};e.prototype._buildHLList=function(){for(var a=0,b=this.container.children;a<b.length;a++)b[a].buildHLList(this._highlightIDs);this.container.requestRender()};e.prototype._getSymbolResources=function(a){var b=a.symbol;!b&&this.renderer&&(b=this.renderer.getSymbol(a,{scale:this.view.scale}));
if(!b||b&&"text"!==b.type)return f.resolve(null);N.clear();a=b;for(var b=a.text,c=0;c<b.length;c++)N.add(b.charCodeAt(c));O.length=0;N.forEach(function(a){return O.push(a)});b=[];b.push({symbol:a.toJSON(),id:0,glyphIds:O});return this.container.getMaterialItems(b).then(function(a){return 0<a.length?a[0].mosaicItem:null})};e.prototype._projectAndNormalizeGeometry=function(a){var b=this;if(!a.geometry)return f.resolve(null);var c=a.geometry;w.isPolygon(c)?c.rings=c.rings:w.isPolyline(c)?c.paths=c.paths:
w.isExtent(c)&&(c=x.fromExtent(c));return t.checkProjectionSupport(c.spatialReference,this.view.spatialReference).then(function(){return H.normalizeCentralMeridian(c)}).then(function(a){return t.project(a.toJSON(),a.spatialReference,b.view.spatialReference)}).then(function(a){H.ensureClosedRings(a);return a})};e.prototype._onTileUpdate=function(a){var b=this,c=r.getInfo(this.view.spatialReference);if(a.added&&0<a.added.length)for(var f=function(a){var f=e._graphicStore.queryTileData(a);if(c)for(var g=
Math.round((c.valid[1]-c.valid[0])/a.resolution),d=0;d<f.length;d++){var l=f[d];l.geometry&&w.isPoint(l.geometry)&&e._wrapPoints(l,g)}e._tileUpdateSet.add(a.key);e.notifyChange("updating");e._processGraphics(a.key,f).then(function(c){b._addTile(a.key,c);b._tileUpdateSet.delete(a.key);b.notifyChange("updating")}).catch(function(){b._tileUpdateSet.delete(a.key);b.notifyChange("updating")})},e=this,g=0,d=a.added;g<d.length;g++)f(d[g]);if(a.removed&&0<a.removed.length)for(f=0,a=a.removed;f<a.length;f++)this._removeTile(a[f].key)};
e.prototype._add=function(a){this.container.attached&&(this._graphicsSet.add(a),this._graphicProcessingQueue.has(a)&&this._graphicProcessingQueue.cancel(a),this._graphicProcessingQueue.push(a,"add"))};e.prototype._addOrUpdateGraphic=function(a,b){var c=this;return this._projectAndNormalizeGeometry(a).then(function(f){return c._getSymbolResources(a).then(function(e){return"add"===b?c._addProjectedGraphic(a,e,f):c._updateGraphic(a,e,f)})})};e.prototype._addProjectedGraphic=function(a,b,c){var e=this;
if(!this._graphicsSet.has(a))return f.resolve();var g=this._graphicStore.add(a,b,c);if(!g||0===u.width(g)&&0===u.height(g))return f.resolve();a.visible||this._hiddenGraphics.push(a.uid);var d=[];b=function(b){var c=l._getGraphicData(b,a),c=l._processGraphics(b.key,c).then(function(a){e._patchTile(b.key,{addOrUpdate:a,remove:null})});d.push(c)};var l=this;c=0;for(g=this._tileStore.boundsIntersections(g);c<g.length;c++)b(g[c]);return f.all(d)};e.prototype._remove=function(a){this._graphicsSet.has(a)&&
this._graphicsSet.delete(a);this._graphicProcessingQueue.has(a)&&this._graphicProcessingQueue.cancel(a);var b=this._graphicStore.getBounds(a);if(b){this._graphicStore.remove(a);for(var c=0,b=this._tileStore.boundsIntersections(b);c<b.length;c++)this._patchTile(b[c].key,{addOrUpdate:null,remove:[a.uid]})}};e.prototype._reorder=function(a){var b=this;this._graphicStore.reorder(a);var c=this._graphicStore.getBounds(a);if(0===u.width(c)&&0===u.height(c))return f.resolve();for(var e=[],g=function(c){var f=
d._getGraphicData(c,a),f=d._processGraphics(c.key,f).then(function(a){b._patchTile(c.key,{addOrUpdate:a,remove:[]})});e.push(f)},d=this,l=0,c=this._tileStore.boundsIntersections(c);l<c.length;l++)g(c[l]);return f.all(e)};e.prototype._updateGraphic=function(a,b,e){var g=this;if(!this._graphicStore.has(a))return f.resolve();e=this._graphicStore.update(a,b,e);b=e.oldBounds;e=e.newBounds;var d=0===u.width(b)&&0===u.height(b),l=0===u.width(e)&&0===u.height(e),d=d?[]:this._tileStore.boundsIntersections(b);
b=l?[]:this._tileStore.boundsIntersections(e);e=c.acquire();for(var k=0;k<d.length;k++)l=d[k],e.set(l.key,{addOrUpdate:null,remove:[a.uid]});for(d=0;d<b.length;d++)l=b[d],k=this._getGraphicData(l,a),e.has(l.key)?(l=e.get(l.key),l.remove.length=0,l.addOrUpdate=k):e.set(l.key,{addOrUpdate:k,remove:null});var h=[];e.forEach(function(a,b){var c=g._processGraphics(b,a.addOrUpdate).then(function(c){g._patchTile(b,{addOrUpdate:c,remove:a.remove})});h.push(c)});c.release(e);return f.all(h)};e.prototype._addTile=
function(a,b){var c=u.create();this.view.featuresTilingScheme.getTileBounds(c,a);c=new z(a,c,!0);c.setData({clear:!0,addOrUpdate:b,remove:[]},!1,!1);c.buildHLList(this._highlightIDs);0<this._hiddenGraphics.length&&c.setVisibility([],this._hiddenGraphics);this._tiles.set(a,c);this.container.addChild(c)};e.prototype._removeTile=function(a){this._tiles.has(a)&&(a=this._tiles.get(a),this.container.removeChild(a))};e.prototype._patchTile=function(a,b){this._tiles.has(a)&&(a=this._tiles.get(a),a.setData(b,
!1,!1),a.buildHLList(this._highlightIDs),0<this._hiddenGraphics.length&&a.setVisibility([],this._hiddenGraphics),this.container.requestRender())};e.prototype._setVisible=function(a,b){var c=[],f=[],e=this._hiddenGraphics.indexOf(a);if(b){if(-1!==e)this._hiddenGraphics.splice(e,1);else return;c.push(a)}else{if(-1===e)this._hiddenGraphics.push(a);else return;f.push(a)}a=0;for(b=this.container.children;a<b.length;a++)e=b[a],e.data&&e.setVisibility(c,f)};e.prototype._getGraphicData=function(a,b){b=this._graphicStore.getGraphicData(a,
b);var c=[b],f=r.getInfo(this.view.spatialReference);f&&(a=Math.round((f.valid[1]-f.valid[0])/a.resolution),b.geometry&&w.isPoint(b.geometry)&&this._wrapPoints(b,a));return c};e.prototype._wrapPoints=function(a,b){var c=a.geometry;512===b?20>c.x?a.geometry={points:[[c.x,c.y],[b,0]]}:492<c.x&&(a.geometry={points:[[c.x,c.y],[-b,0]]}):-20>c.x?a.geometry={points:[[c.x,c.y],[b,0]]}:532<c.x&&(a.geometry={points:[[c.x,c.y],[-b,0]]})};e.prototype._processGraphics=function(a,b){var c=this;return b&&b.length&&
this._meshFactory?this._meshFactory.analyze(b,this._matcher).then(function(b){return c._processAnalyzedGraphics(a,b)}):f.resolve(null)};e.prototype._processAnalyzedGraphics=function(a,b){for(var c=this._meshFactory,f=c.createMeshData(b.length),e=0;e<b.length;e++)c.write(f,b[e],null,null,a.level);return C.fromMeshData(f)};k([m.property()],e.prototype,"_graphicProcessingQueue",void 0);k([m.property(),m.cast(l.ofType(b))],e.prototype,"graphics",void 0);k([m.property({dependsOn:["_graphicProcessingQueue.updating"]})],
e.prototype,"updating",null);k([m.property()],e.prototype,"view",void 0);k([m.property()],e.prototype,"updateRequested",void 0);return e=k([m.subclass("esri.views.2d.layers.support.GraphicsView2D")],e)}(m.declared(I,g,e.Identifiable));a.default=h})},"esri/core/MapPool":function(){define(["require","exports","./ObjectPool"],function(h,a,d){h=function(){function a(a,b){void 0===a&&(a=50);void 0===b&&(b=50);this._pool=new d(Map,!1,function(a){return a.clear()},b,a)}a.prototype.acquire=function(){return this._pool.acquire()};
a.prototype.release=function(a){this._pool.release(a)};a.acquire=function(){return k.acquire()};a.release=function(a){return k.release(a)};return a}();var k=new h(100);return h})},"esri/layers/graphics/data/projectionSupport":function(){define("require exports ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(h,a,d,k,b,l,g){function e(a,b){var e;if(!b)return null;
if("x"in b){var g={x:0,y:0};a=a(b.x,b.y,p,0);g.x=a[0];g.y=a[1];null!=b.z&&(g.z=b.z);null!=b.m&&(g.m=b.m);return g}if("xmin"in b)return g={xmin:0,ymin:0,xmax:0,ymax:0},e=a(b.xmin,b.ymin,p,0),g.xmin=e[0],g.ymin=e[1],a=a(b.xmax,b.ymax,p,0),g.xmax=a[0],g.ymax=a[1],b.hasZ&&(g.zmin=b.zmin,g.zmax=b.zmax,g.hasZ=!0),b.hasM&&(g.mmin=b.mmin,g.mmax=b.mmax,g.hasM=!0),g;if("rings"in b)return{rings:c(b.rings,a),hasM:b.hasM,hasZ:b.hasZ};if("paths"in b)return{paths:c(b.paths,a),hasM:b.hasM,hasZ:b.hasZ};if("points"in
b)return{points:f(b.points,a),hasM:b.hasM,hasZ:b.hasZ}}function c(a,b){for(var c=[],e=0;e<a.length;e++)c.push(f(a[e],b));return c}function f(a,b){for(var c=[],f=0;f<a.length;f++){var e=a[f],g=b(e[0],e[1],[0,0],0);c.push(g);2<e.length&&g.push(e[2]);3<e.length&&g.push(e[3])}return c}function m(a,b){return!l.isValid(a)||!l.isValid(b)||l.equals(a,b)||g.canProject(a,b)?!1:!0}Object.defineProperty(a,"__esModule",{value:!0});var p=[0,0];a.checkProjectionSupport=function(a,c){if(Array.isArray(a)){for(var f=
0;f<a.length;f++){var e=a[f];if(m(e.geometry&&e.geometry.spatialReference,c))return b.isSupported()?b.load():k.reject(new d("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:c}))}return k.resolve()}return m(a,c)?b.isSupported()?b.load():k.reject(new d("feature-store:unsupported-query","projection not supported",{inSpatialReference:a,outSpatialReference:c})):k.resolve()};var x=e.bind(null,g.lngLatToXY),u=e.bind(null,g.xyToLngLat);a.project=function(a,
c,f){return l.isValid(c)&&l.isValid(f)&&!l.equals(c,f)?g.canProject(c,f)?l.isWebMercator(f)?x(a):u(a):b.projectMany([a],c,f,null,!0)[0]:a};var w=new (function(){function a(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}a.prototype.push=function(a,b,c){var f=this;a&&a.length&&b&&c&&!l.equals(b,c)||k.resolve(a);var e={geometries:a,inSpatialReference:b,outSpatialReference:c,resolve:null};this._jobs.push(e);return k.create(function(a){e.resolve=a;null===f._timer&&(f._timer=setTimeout(f._process,
10))},function(){var a=f._jobs.indexOf(e);-1<a&&f._jobs.splice(a,1)})};a.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var c=a.geometries,f=a.inSpatialReference,e=a.outSpatialReference,a=a.resolve;g.canProject(f,e)?l.isWebMercator(e)?a(c.map(x)):a(c.map(u)):a(b.projectMany(c,f,e,null,!0));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return a}());a.projectMany=function(a,b,c){return w.push(a,b,c)}})},"esri/geometry/projection":function(){define("require exports ../core/promiseUtils ./pe ./SpatialReference ./support/GeographicTransformation".split(" "),
function(h,a,d,k,b,l){function g(a,f,g,d,k){void 0===d&&(d=null);void 0===k&&(k=!1);if(null===d){var h=l.cacheKey(f,g);void 0!==m[h]?d=m[h]:(d=e(f,g,null),null===d&&(d=new l),m[h]=d)}return c._project(a,f,g instanceof b||!1===k?g:new b(g),d,k)}function e(a,b,f){void 0===f&&(f=null);a=c._getTransformation(a,b,f);return null!==a?l.fromGE(a):null}Object.defineProperty(a,"__esModule",{value:!0});var c=null;a.isLoaded=function(){return!!c&&k.isLoaded()};a.isSupported=function(){return k.isSupported()};
var f=null;a.load=function(){return f?f:f=d.create(function(a,b){var f=k.load();h(["./geometryEngine"],function(e){c=e;f.then(function(){c._enableProjection(k);a()},function(a){b(a)})})})};a.project=function(a,b,c){void 0===c&&(c=null);return a instanceof Array?0===a.length?[]:g(a,a[0].spatialReference,b,c):g([a],a.spatialReference,b,c)[0]};var m={};a.projectMany=g;a.getTransformation=e;a.getTransformations=function(a,b,f){void 0===f&&(f=null);a=c._getTransformationBySuitability(a,b,f);if(null!==
a){b=[];for(f=0;f<a.length;f++)b.push(l.fromGE(a[f]));return b}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/has","../core/promiseUtils"],function(h,a,d,k,b){function l(b){function c(a,b,c){a[b]=c(a[b])}a._pe=b;p.init();x.init();u.init();w.init();r.init();a.PeGCSExtent=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}d(c,b);c.prototype.destroy=function(){a._pe.destroy(this)};return c}(a._pe.PeGCSExtent);for(var e=
0,g=[a._pe.PeDatum,a._pe.PeGeogcs,a._pe.PeGeogtran,a._pe.PeObject,a._pe.PeParameter,a._pe.PePrimem,a._pe.PeProjcs,a._pe.PeSpheroid,a._pe.PeUnit];e<g.length;e++)b=g[e],c(b.prototype,"getName",function(a){return function(){return a.call(this,Array(p.PE_NAME_MAX))}});e=0;for(g=[a._pe.PeGeogtran,a._pe.PeProjcs];e<g.length;e++)b=g[e],c(b.prototype,"getParameters",function(b){return function(){for(var c=Array(p.PE_PARM_MAX),f=b.call(this),e=0;e<c.length;e++){var g=a._pe.getValue(f,"*");c[e]=g?a._pe.wrapPointer(g,
a._pe.PeParameter):null;f+=Int32Array.BYTES_PER_ELEMENT}return c}});c(a._pe.PeHorizon.prototype,"getCoord",function(a){return function(){var b=this.getSize();if(!b)return null;var c=[],e=a.call(this);f(c,b,e);return c}});c(a._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(b){var c=a._pe._pe_getPeGTlistExtendedGTsSize();return function(){var f=null,e=b.call(this);if(!a._pe.compare(e,a._pe.NULL)){var f=[e],g=this.getSteps();if(1<g)for(var e=a._pe.getPointer(e),d=1;d<g;d++)f.push(a._pe.wrapPointer(e+
c*d,a._pe.PeGTlistExtendedGTs))}return f}});var l=a._pe._pe_getPeHorizonSize();b=function(b){return function(){var c=this._cache;c||(this._cache=c=new Map);if(c.has(b))return c.get(b);var f=null,e=b.call(this);if(!a._pe.compare(e,a._pe.NULL)){var f=[e],g=e.getNump();if(1<g)for(var e=a._pe.getPointer(e),d=1;d<g;d++)f.push(a._pe.wrapPointer(e+l*d,a._pe.PeHorizon))}c.set(b,f);return f}};c(a._pe.PeProjcs.prototype,"horizonGcsGenerate",b);c(a._pe.PeProjcs.prototype,"horizonPcsGenerate",b);a._pe.PeObject.prototype.toString=
function(b){void 0===b&&(b=p.PE_STR_OPTS_NONE);a._pe.ensureCache.prepare();var c=a._pe.getPointer(this),f=a._pe.ensureInt8(Array(p.PE_BUFFER_MAX));return a._pe.Pointer_stringify(a._pe._pe_object_to_string_ext(c,b,f))}}function g(b){if(b){var c=a._pe.getClass(b);c&&(c=a._pe.getCache(c))&&(b=a._pe.getPointer(b))&&delete c[b]}}function e(b,c){var f=[];c=Array(c);for(var e=0;e<b;e++)f.push(a._pe.ensureInt8(c));return f}function c(a){var b;Array.isArray(a[0])?(b=[],a.forEach(function(a){b.push(a[0],a[1])})):
b=a;return b}function f(b,c,f,e){void 0===e&&(e=!1);if(e)for(e=0;e<2*c;e++)b[e]=a._pe.getValue(f+e*Float64Array.BYTES_PER_ELEMENT,"double");else{var g=0===b.length;for(e=0;e<c;e++)g&&(b[e]=Array(2)),b[e][0]=a._pe.getValue(f,"double"),b[e][1]=a._pe.getValue(f+Float64Array.BYTES_PER_ELEMENT,"double"),f+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(a,"__esModule",{value:!0});var m;a._pe=null;a.isLoaded=function(){return!!a._pe};a.isSupported=function(){return!!k("esri-wasm")};a.load=function(){return m?
m:m=b.create(function(a,b){h(["./support/pe-wasm"],function(c){c({locateFile:function(a){return h.toUrl("./support/"+a)},onAbort:function(a){b(Error(a))}}).then(function(b){l(b);a()})})})};(function(b){function e(b,e,g){a._pe.ensureCache.prepare();var d=c(g),l=g===d,d=a._pe.ensureFloat64(d);(b=a._pe._pe_geog_to_proj(a._pe.getPointer(b),e,d))&&f(g,e,d,l);return b}function g(a,b,c){return d(a,b,c,0)}function d(b,e,g,d){a._pe.ensureCache.prepare();var l=c(g),k=g===l,l=a._pe.ensureFloat64(l);(b=a._pe._pe_proj_to_geog_center(a._pe.getPointer(b),
e,l,d))&&f(g,e,l,k);return b}b.geogToProj=e;b.projGeog=function(a,b,c,f){switch(f){case p.PE_TRANSFORM_P_TO_G:return g(a,b,c);case p.PE_TRANSFORM_G_TO_P:return e(a,b,c)}return 0};b.projToGeog=g;b.projToGeogCenter=d})(a.PeCSTransformations||(a.PeCSTransformations={}));var p;(function(b){b.init=function(){b.PE_BUFFER_MAX=a._pe.PeDefs.prototype.PE_BUFFER_MAX;b.PE_NAME_MAX=a._pe.PeDefs.prototype.PE_NAME_MAX;b.PE_MGRS_MAX=a._pe.PeDefs.prototype.PE_MGRS_MAX;b.PE_USNG_MAX=a._pe.PeDefs.prototype.PE_USNG_MAX;
b.PE_DD_MAX=a._pe.PeDefs.prototype.PE_DD_MAX;b.PE_DDM_MAX=a._pe.PeDefs.prototype.PE_DDM_MAX;b.PE_DMS_MAX=a._pe.PeDefs.prototype.PE_DMS_MAX;b.PE_UTM_MAX=a._pe.PeDefs.prototype.PE_UTM_MAX;b.PE_PARM_MAX=a._pe.PeDefs.prototype.PE_PARM_MAX;b.PE_TYPE_NONE=a._pe.PeDefs.prototype.PE_TYPE_NONE;b.PE_TYPE_GEOGCS=a._pe.PeDefs.prototype.PE_TYPE_GEOGCS;b.PE_TYPE_PROJCS=a._pe.PeDefs.prototype.PE_TYPE_PROJCS;b.PE_TYPE_GEOGTRAN=a._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;b.PE_TYPE_COORDSYS=a._pe.PeDefs.prototype.PE_TYPE_COORDSYS;
b.PE_TYPE_UNIT=a._pe.PeDefs.prototype.PE_TYPE_UNIT;b.PE_STR_OPTS_NONE=a._pe.PeDefs.prototype.PE_STR_OPTS_NONE;b.PE_STR_AUTH_NONE=a._pe.PeDefs.prototype.PE_STR_AUTH_NONE;b.PE_STR_AUTH_TOP=a._pe.PeDefs.prototype.PE_STR_AUTH_TOP;b.PE_STR_NAME_CANON=a._pe.PeDefs.prototype.PE_STR_NAME_CANON;b.PE_PARM_X0=a._pe.PeDefs.prototype.PE_PARM_X0;b.PE_PARM_ND=a._pe.PeDefs.prototype.PE_PARM_ND;b.PE_TRANSFORM_1_TO_2=a._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;b.PE_TRANSFORM_2_TO_1=a._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;
b.PE_TRANSFORM_P_TO_G=a._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;b.PE_TRANSFORM_G_TO_P=a._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;b.PE_HORIZON_RECT=a._pe.PeDefs.prototype.PE_HORIZON_RECT;b.PE_HORIZON_POLY=a._pe.PeDefs.prototype.PE_HORIZON_POLY;b.PE_HORIZON_LINE=a._pe.PeDefs.prototype.PE_HORIZON_LINE;b.PE_HORIZON_DELTA=a._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(p=a.PeDefs||(a.PeDefs={}));(function(b){function c(b,c){var g=null,d=e[b];d||(d={},e[b]=d);d.hasOwnProperty(String(c))?g=d[c]:(b=a._pe.PeFactory.prototype.factoryByType(b,
c),a._pe.compare(b,a._pe.NULL)||(g=b,d[c]=g));return g=f(g)}function f(b){if(b){var c=b.getType();switch(c){case p.PE_TYPE_GEOGCS:b=a._pe.castObject(b,a._pe.PeGeogcs);break;case p.PE_TYPE_PROJCS:b=a._pe.castObject(b,a._pe.PeProjcs);break;case p.PE_TYPE_GEOGTRAN:b=a._pe.castObject(b,a._pe.PeGeogtran);break;default:c&p.PE_TYPE_UNIT&&(b=a._pe.castObject(b,a._pe.PeUnit))}}return b}var e={},g={};b.initialize=function(){a._pe.PeFactory.prototype.initialize(null)};b.coordsys=function(a){return c(p.PE_TYPE_COORDSYS,
a)};b.factoryByType=c;b.fromString=function(b,c){var e=null,d=g[b];d||(d={},g[b]=d);d.hasOwnProperty(c)?e=d[c]:(b=a._pe.PeFactory.prototype.fromString(b,c),a._pe.compare(b,a._pe.NULL)||(e=b,d[c]=e));return e=f(e)};b.geogcs=function(a){return c(p.PE_TYPE_GEOGCS,a)};b.geogtran=function(a){return c(p.PE_TYPE_GEOGTRAN,a)};b.getCode=function(b){return a._pe.PeFactory.prototype.getCode(b)};b.projcs=function(a){return c(p.PE_TYPE_PROJCS,a)};b.unit=function(a){return c(p.PE_TYPE_UNIT,a)}})(a.PeFactory||(a.PeFactory=
{}));a.PeGCSExtent=null;var x;(function(b){var c;b.init=function(){b.PE_GTLIST_OPTS_COMMON=a._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;c=a._pe._pe_getPeGTlistExtendedEntrySize()};b.getGTlist=function(b,f,e,g,d,l){var k=null,h=new a._pe.PeInteger(l);try{var m=a._pe.PeGTlistExtended.prototype.getGTlist(b,f,e,g,d,h);if(l=h.val)if(k=[m],1<l){var p=a._pe.getPointer(m);for(b=1;b<l;b++)k.push(a._pe.wrapPointer(p+c*b,a._pe.PeGTlistExtendedEntry))}}finally{a._pe.destroy(h)}return k}})(x=a.PeGTlistExtended||
(a.PeGTlistExtended={}));(function(b){b.destroy=function(b){if(b&&b.length){for(var c=0;c<b.length;c++){var f=b[c];g(f);f.getEntries().forEach(function(a){g(a);a=a.getGeogtran();g(a);a.getParameters().forEach(g);[a.getGeogcs1(),a.getGeogcs2()].forEach(function(a){g(a);var b=a.getDatum();g(b);g(b.getSpheroid());g(a.getPrimem());g(a.getUnit())})})}a._pe.PeGTlistExtendedEntry.prototype.Delete(b[0])}}})(a.PeGTlistExtendedEntry||(a.PeGTlistExtendedEntry={}));(function(b){b.geogToGeog=function(b,e,g,d,
l){a._pe.ensureCache.prepare();var k=c(g),h=g===k,k=a._pe.ensureFloat64(k),m=0;d&&(m=a._pe.ensureFloat64(d));(b=a._pe._pe_geog_to_geog(a._pe.getPointer(b),e,k,m,l))&&f(g,e,k,h);return b}})(a.PeGTTransformations||(a.PeGTTransformations={}));(function(b){function g(b,f,g,d,l,k){a._pe.ensureCache.prepare();var h,m;switch(b){case "dd":h=a._pe._pe_geog_to_dd;m=p.PE_DD_MAX;break;case "ddm":h=a._pe._pe_geog_to_ddm;m=p.PE_DDM_MAX;break;case "dms":h=a._pe._pe_geog_to_dms,m=p.PE_DMS_MAX}b=0;f&&(b=a._pe.getPointer(f));
f=c(d);f=a._pe.ensureFloat64(f);m=e(g,m);d=a._pe.ensureInt32(m);if(l=h(b,g,f,l,d))for(h=0;h<g;h++)k[h]=a._pe.Pointer_stringify(m[h]);return l}function d(b,c,e,g,d){a._pe.ensureCache.prepare();var l;switch(b){case "dd":l=a._pe._pe_dd_to_geog;break;case "ddm":l=a._pe._pe_ddm_to_geog;break;case "dms":l=a._pe._pe_dms_to_geog}b=0;c&&(b=a._pe.getPointer(c));c=g.map(function(b){return a._pe.ensureString(b)});g=a._pe.ensureInt32(c);c=a._pe.ensureFloat64(Array(2*e));(l=l(b,e,g,c))&&f(d,e,c);return l}b.geog_to_dms=
function(a,b,c,f,e){return g("dms",a,b,c,f,e)};b.dms_to_geog=function(a,b,c,f){return d("dms",a,b,c,f)};b.geog_to_ddm=function(a,b,c,f,e){return g("ddm",a,b,c,f,e)};b.ddm_to_geog=function(a,b,c,f){return d("ddm",a,b,c,f)};b.geog_to_dd=function(a,b,c,f,e){return g("dd",a,b,c,f,e)};b.dd_to_geog=function(a,b,c,f){return d("dd",a,b,c,f)}})(a.PeNotationDms||(a.PeNotationDms={}));var u;(function(b){b.init=function(){b.PE_MGRS_STYLE_NEW=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;b.PE_MGRS_STYLE_OLD=
a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;b.PE_MGRS_STYLE_AUTO=a._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;b.PE_MGRS_180_ZONE_1_PLUS=a._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;b.PE_MGRS_ADD_SPACES=a._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};b.geog_to_mgrs_extended=function(b,f,g,d,l,k,h){a._pe.ensureCache.prepare();var m=0;b&&(m=a._pe.getPointer(b));b=c(g);g=a._pe.ensureFloat64(b);b=e(f,p.PE_MGRS_MAX);var v=a._pe.ensureInt32(b);if(d=a._pe._pe_geog_to_mgrs_extended(m,
f,g,d,l,k,v))for(l=0;l<f;l++)h[l]=a._pe.Pointer_stringify(b[l]);return d};b.mgrs_to_geog_extended=function(b,c,e,g,d){a._pe.ensureCache.prepare();var l=0;b&&(l=a._pe.getPointer(b));b=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(g=a._pe._pe_mgrs_to_geog_extended(l,c,e,g,b))&&f(d,c,b);return g}})(u=a.PeNotationMgrs||(a.PeNotationMgrs={}));(function(b){b.geog_to_usng=function(b,f,g,d,l,k,h){a._pe.ensureCache.prepare();var m=0;b&&(m=a._pe.getPointer(b));
b=c(g);g=a._pe.ensureFloat64(b);b=e(f,p.PE_MGRS_MAX);var v=a._pe.ensureInt32(b);if(d=a._pe._pe_geog_to_usng(m,f,g,d,l,k,v))for(l=0;l<f;l++)h[l]=a._pe.Pointer_stringify(b[l]);return d};b.usng_to_geog=function(b,c,e,g){a._pe.ensureCache.prepare();var d=0;b&&(d=a._pe.getPointer(b));b=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(d=a._pe._pe_usng_to_geog(d,c,e,b))&&f(g,c,b);return d}})(a.PeNotationUsng||(a.PeNotationUsng={}));var w;(function(b){b.init=
function(){b.PE_UTM_OPTS_NONE=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;b.PE_UTM_OPTS_ADD_SPACES=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;b.PE_UTM_OPTS_NS=a._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};b.geog_to_utm=function(b,f,g,d,l){a._pe.ensureCache.prepare();var k=0;b&&(k=a._pe.getPointer(b));b=c(g);g=a._pe.ensureFloat64(b);b=e(f,p.PE_UTM_MAX);var h=a._pe.ensureInt32(b);if(d=a._pe._pe_geog_to_utm(k,f,g,d,h))for(k=0;k<f;k++)l[k]=a._pe.Pointer_stringify(b[k]);return d};b.utm_to_geog=
function(b,c,e,g,d){a._pe.ensureCache.prepare();var l=0;b&&(l=a._pe.getPointer(b));b=e.map(function(b){return a._pe.ensureString(b)});e=a._pe.ensureInt32(b);b=a._pe.ensureFloat64(Array(2*c));(g=a._pe._pe_utm_to_geog(l,c,e,g,b))&&f(d,c,b);return g}})(w=a.PeNotationUtm||(a.PeNotationUtm={}));var r;(function(b){var c=new Map;b.init=function(){b.PE_PCSINFO_OPTION_NONE=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;b.PE_PCSINFO_OPTION_DOMAIN=a._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;b.PE_POLE_OUTSIDE_BOUNDARY=
a._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;b.PE_POLE_POINT=a._pe.PePCSInfo.prototype.PE_POLE_POINT};b.generate=function(f,e){void 0===e&&(e=b.PE_PCSINFO_OPTION_DOMAIN);var g,d;c.has(f)&&(d=c.get(f),d[e]&&(g=d[e]));g||(g=a._pe.PePCSInfo.prototype.generate(f,e),d||(d=[],c.set(f,d)),d[e]=g);return g}})(r=a.PePCSInfo||(a.PePCSInfo={}));(function(b){b.version_string=function(){return a._pe.PeVersion.prototype.version_string()}})(a.PeVersion||(a.PeVersion={}));a._init=l})},"esri/geometry/support/GeographicTransformation":function(){define(["require",
"exports","./GeographicTransformationStep"],function(h,a,d){return function(){function a(a){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(a&&a.steps){var b=0;for(a=a.steps;b<a.length;b++){var g=a[b];g instanceof d?this.steps.push(g):this.steps.push(new d({wkid:g.wkid,wkt:g.wkt,isInverse:g.isInverse}))}}}a.cacheKey=function(a,d){return[void 0!==a.wkid&&null!==a.wkid?a.wkid.toString():"-1",void 0!==a.wkt&&null!==a.wkt?a.wkt.toString():"",void 0!==d.wkid&&null!==d.wkid?
d.wkid.toString():"-1",void 0!==d.wkt&&null!==d.wkt?d.wkt.toString():""].join()};a.fromGE=function(b){var l=new a,g="",e=0;for(b=b.steps;e<b.length;e++){var c=d.fromGE(b[e]);l.steps.push(c);g+=c.uid.toString()+","}l._cached_projection={};l._gtlistentry=null;l._chain=g;return l};a.prototype.getInverse=function(){var b=new a;b.steps=[];for(var d=this.steps.length-1;0<=d;d--)b.steps.push(this.steps[d].getInverse());return b};a.prototype.getGTListEntry=function(){for(var a="",d=0,g=this.steps;d<g.length;d++)a+=
g[d].uid.toString()+",";a!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=a);return this._gtlistentry};a.prototype.assignCachedGe=function(b,d,g){this._cached_projection[a.cacheKey(b,d)]=g};a.prototype.getCachedGeTransformation=function(b,d){for(var g="",e=0,c=this.steps;e<c.length;e++)g+=c[e].uid.toString()+",";g!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=g);b=this._cached_projection[a.cacheKey(b,d)];return void 0===b?null:b};return a}()})},
"esri/geometry/support/GeographicTransformationStep":function(){define(["require","exports"],function(h,a){var d=0;return function(){function a(a){void 0===a&&(a=null);this.uid=d++;a?(this._wkt=void 0!==a.wkt?a.wkt:null,this._wkid=void 0!==a.wkid?a.wkid:-1,this._isInverse=void 0!==a.isInverse?!0===a.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}a.fromGE=function(b){var d=new a;d._wkt=b.wkt;d._wkid=b.wkid;d._isInverse=b.isInverse;return d};Object.defineProperty(a.prototype,"wkt",
{get:function(){return this._wkt},set:function(a){this._wkt=a;this.uid=d++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"wkid",{get:function(){return this._wkid},set:function(a){this._wkid=a;this.uid=d++},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isInverse",{get:function(){return this._isInverse},set:function(a){this._isInverse=a;this.uid=d++},enumerable:!0,configurable:!0});a.prototype.getInverse=function(){var b=new a;b._wkt=this.wkt;b._wkid=this._wkid;
b._isInverse=!this.isInverse;return b};return a}()})},"esri/views/2d/engine/webgl/GraphicContainer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/promiseUtils ../Container ./enums ./WGLRendererInfo".split(" "),function(h,a,d,k,b,l,g,e){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function c(b){var c=a.call(this)||this;c._displayHeight=0;c._displayWidth=0;c._rendererInfo=new e;c._highlightOptionsUpToDate=
!1;c.tileInfoView=b.tileInfoView;c.highlightOptions=b.highlightOptions;c.highlightIDs=b.highlightIDs;c.getMaterialItems=c.getMaterialItems.bind(c);return c}k(c,a);c.prototype.dispose=function(){this.removeAllChildren();for(var a=0,b=this.children;a<b.length;a++)b[a].dispose()};c.prototype.disposeWebGLResources=function(){for(var a=0,b=this.children;a<b.length;a++)b[a].clear()};c.prototype.displayWidth=function(){return this._displayWidth};Object.defineProperty(c.prototype,"displayHeight",{get:function(){return this._displayHeight},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"highlightOptions",{get:function(){return this._highlightOptions},set:function(a){this._highlightOptions=a;this._highlightOptionsUpToDate=!1},enumerable:!0,configurable:!0});c.prototype.setVisibility=function(a,b){};c.prototype.getMaterialItems=function(a){if(a&&0!==a.length){for(var c=[],f=this.stage.painter.textureManager,e=0;e<a.length;e++){var g=a[e];c.push(f.rasterizeItem(g.symbol,g.glyphIds))}return b.all(c).then(function(b){return b.map(function(b,
c){return{id:a[c].id,mosaicItem:b}})})}};c.prototype.renderChildren=function(a){var b=this.stage.painter;this._updateTilesTransform(a.state,this.tileInfoView.getClosestInfoForScale(a.state.scale).level);this._updateHighlightOptions();if(a.drawPhase===g.WGLDrawPhase.MAP){var c=this.tileInfoView.getClosestInfoForScale(a.state.scale).level,f=this.tileInfoView.tileInfo.scaleToZoom(a.state.scale);a=d({},a,{rendererInfo:this._rendererInfo,requiredLevel:c,displayLevel:f,context:this.stage.context,painter:b});
this.sortChildren(function(a,b){return 0!==a.key.level-b.key.level?a.key.level-b.key.level:0!==a.key.row-b.key.row?a.key.row-b.key.row:a.key.col-b.key.col});b.draw(a,this.children,a.drawPhase,null);0<this.highlightIDs.size&&b.highlight(a,this.children)}};c.prototype._updateTilesTransform=function(a,b){b=0;for(var c=this.children;b<c.length;b++){var f=c[b];f.setTransform(a,this.tileInfoView.tileInfo.lods[f.key.level].resolution/(a.resolution*a.pixelRatio))}};c.prototype._updateHighlightOptions=function(){if(!this._highlightOptionsUpToDate&&
this.parent&&this._highlightOptions){var a=this.stage.painter,b=this._highlightOptions;if(a){var c=b.color.toRgba();c[0]/=255;c[1]/=255;c[2]/=255;var f=c.slice();c[3]*=b.fillOpacity;f[3]*=b.haloOpacity;a.setHighlightOptions({fillColor:c,outlineColor:f,outlineWidth:2,outerHaloWidth:.3,innerHaloWidth:.3,outlinePosition:0});this._highlightOptionsUpToDate=!0}}};return c}(l.Container);a.default=h})},"esri/views/2d/engine/webgl/WGLRendererInfo":function(){define("require exports ../../../../core/screenUtils ../../../../geometry/support/scaleUtils ../../../../renderers/support/utils ./Utils".split(" "),
function(h,a,d,k,b,l){function g(a,b){var c=b.length;if(a<b[0].value||1===c)return b[0].size;for(var e=1;e<c;e++)if(a<b[e].value)return b[e-1].size+(a-b[e-1].value)/(b[e].value-b[e-1].value)*(b[e].size-b[e-1].size);return b[c-1].size}return function(){function a(){this.symbolLevels=[];this.vvColorValues=new Float32Array(8);this.vvColors=new Float32Array(32);this.vvOpacityValues=new Float32Array(8);this.vvOpacities=new Float32Array(8);this.vvSizeMinMaxValue=new Float32Array(4);this.vvSizeFieldStopsValues=
new Float32Array(6);this.vvSizeFieldStopsSizes=new Float32Array(6);this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1};this.symbolLevels.push(0)}Object.defineProperty(a.prototype,"vvMaterialParameters",{get:function(){return this._vvMaterialParameters},enumerable:!0,configurable:!0});a.prototype.updateVisualVariables=function(a,f){var c=this._vvMaterialParameters;c.vvOpacityEnabled=!1;c.vvSizeEnabled=!1;c.vvColorEnabled=
!1;c.vvRotationEnabled=!1;if(a){var e=a.size;if(e){c.vvSizeEnabled=!0;if(e.minMaxValue){var h=e.minMaxValue,u=void 0,w=void 0;l.isDefined(h.minSize)&&l.isDefined(h.maxSize)&&(l.isNumber(h.minSize)&&l.isNumber(h.maxSize)?(u=d.pt2px(h.minSize),w=d.pt2px(h.maxSize)):(w=f.scale,u=d.pt2px(g(w,h.minSize.stops)),w=d.pt2px(g(w,h.maxSize.stops))));this.vvSizeMinMaxValue.set([h.minDataValue,h.maxDataValue,u,w])}e.scaleStops&&(this.vvSizeScaleStopsValue=d.pt2px(g(f.scale,e.scaleStops.stops)));e.unitValue&&(this.vvSizeUnitValueToPixelsRatio=
k.getMetersPerUnitForSR(f.spatialReference)/b.meterIn[e.unitValue.unit]/f.resolution);e.fieldStops&&(this.vvSizeFieldStopsValues.set(e.fieldStops.values),this.vvSizeFieldStopsSizes.set(e.fieldStops.sizes))}if(f=a.color)c.vvColorEnabled=!0,this.vvColorValues.set(f.values),this.vvColors.set(f.colors);if(f=a.opacity)c.vvOpacityEnabled=!0,this.vvOpacityValues.set(f.values),this.vvOpacities.set(f.opacities);if(a=a.rotation)c.vvRotationEnabled=!0,c.vvRotationType=a.type}};return a}()})},"esri/views/2d/engine/webgl/TileData":function(){define("require exports ./MemoryRequirements ./TileBufferData ./TileDisplayData ./Utils ./Utils ./WGLDisplayObject ./WGLDisplayRecord ./mesh/VertexBuffer ./mesh/factories/MaterialStore ./util/Reader ./util/serializationUtils ./util/Writer".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u){var w=new d.default,r=new d.default;return function(){function a(){this.tileBufferData=this.tileDisplayData=null}a.prototype.reshuffle=function(){w.reset();var c=b.groupRecordsByGeometryType(this.tileDisplayData.displayObjects),f;for(f in c)for(var e=c[f],d=0,h=e;d<h.length;d++){var m=h[d];w.needMore(m.geometryType,m.meshData?m.meshData.vertexCount:m.vertexCount,m.meshData?m.meshData.indexData.length:m.indexCount)}h=c.length;d=new k;for(f=0;f<h;++f){d.geometries[f].indexBuffer=
new Uint32Array(Math.round(1.15*w.indicesFor(f)));var m=[],p;for(p in this.tileBufferData.geometries[f].vertexBuffer)m.push(this.tileBufferData.geometries[f].vertexBuffer[p].stride);var m=a._computeVertexAlignment(m),e=Math.round(1.15*w.verticesFor(f)),m=a._align(e,m),u;for(u in this.tileBufferData.geometries[f].vertexBuffer)e=this.tileBufferData.geometries[f].vertexBuffer[u].stride,d.geometries[f].vertexBuffer[u]={stride:e,data:g.allocateTypedArrayBuffer(m,e)}}r.reset();this.tileDisplayData.displayList.clear();
for(f=0;f<h;++f){e=c[f];p=0;for(u=e;p<u.length;p++){m=u[p];if(m.meshData)m.writeMeshDataToBuffers(r.verticesFor(f),d.geometries[f].vertexBuffer,r.indicesFor(f),d.geometries[f].indexBuffer),m.meshData=null;else{var t=this.tileBufferData.geometries[f].vertexBuffer,x=this.tileBufferData.geometries[f].indexBuffer,H=d.geometries[f].vertexBuffer,I=d.geometries[f].indexBuffer,K=r.verticesFor(f),N=r.indicesFor(f);l.copyMeshData(K,N,H,I,m,t,x);m.vertexFrom=K;m.indexFrom=N}r.needMore(f,m.vertexCount,m.indexCount)}this.tileDisplayData.displayList.unified||
this.tileDisplayData.displayList.addToList(e)}if(this.tileDisplayData.displayList.unified)for(c=0,f=this.tileDisplayData.displayObjects;c<f.length;c++)this.tileDisplayData.displayList.addToList(f[c].displayRecords);this.tileBufferData=d};a.prototype.getStrides=function(){for(var a=[],b=0;b<this.tileBufferData.geometries.length;++b){var c=this.tileBufferData.geometries[b];a[b]={};for(var f in c.vertexBuffer)a[b][f]=c.vertexBuffer[f].stride}return a};a.prototype._guessSize=function(){for(var a=this.tileDisplayData.displayObjects,
b=Math.min(a.length,4),c=0,f=0;f<b;f++)c=Math.max(c,a[f].displayRecords.length);return 2*(12*a.length+a.length*c*40)};a.prototype.serialize=function(){var a=this.tileBufferData.serialize(),b=this.tileBufferData.getBuffers(),c=this.tileDisplayData.serialize(new u.default(Int32Array,this._guessSize())).buffer();b.push(c);return{result:{displayData:c,bufferData:a},transferList:b}};a.decode=function(b){var c=m.default.deserialize(new p.default(b.materialStore)),g=x.deserializeList(new p.default(b.displayObjects),
e,{store:c}),d={},l;for(l in b.vertexBuffersMap)d[l]=f.VertexBuffers.decode(b.vertexBuffersMap[l]);return a.fromMeshData({materials:c,displayObjects:g,vertexBuffersMap:d},!1)};a.fromMeshData=function(c,f){void 0===f&&(f=!0);var e=new a,g=new b.default,d=new k;g.displayObjects=c.displayObjects;f&&c.materials.hydrateObjects(g.displayObjects);for(var l in c.vertexBuffersMap)f=c.vertexBuffersMap[l],d.geometries[l].indexBuffer=f.indexBuffer,d.geometries[l].vertexBuffer=f.namedBuffers;e.tileDisplayData=
g;e.tileBufferData=d;return e};a.bind=function(b,c){var f=new a;f.tileDisplayData=b;f.tileBufferData=c;return f};a.create=function(f,e){var d=new a;d.tileDisplayData=new b.default;d.tileDisplayData.displayObjects=f;for(var l=[0,0,0,0,0],h=[0,0,0,0,0],m=[[],[],[],[],[]],p=0;p<f.length;p++)for(var r=0,u=f[p].displayRecords;r<u.length;r++){var w=u[r];m[w.geometryType].push(w);l[w.geometryType]+=w.meshData.vertexCount;h[w.geometryType]+=w.meshData.indexData.length}f=new k;e=[e.fill||{},e.line||{},e.icon||
{},e.text||{},e.label||{}];for(p=0;5>p;p++){var r=new Uint32Array(h[p]),u=e[p],w=l[p],t={},x=void 0;for(x in u){var A={data:g.allocateTypedArrayBuffer(w,u[x]),stride:u[x]};t[x]=A}u=t;c.writeAllMeshDataToBuffers(m[p],u,r);f.geometries[p]={indexBuffer:r,vertexBuffer:u}}d.tileBufferData=f;return d};a._align=function(a,b){var c=a%b;return 0===c?a:a+(b-c)};a._computeVertexAlignment=function(a){for(var b=!1,c=!1,f=0;f<a.length;f++){var e=a[f];2===e%4?b=!0:0!==e%4&&(c=!0)}return c?4:b?2:1};return a}()})},
"esri/views/2d/engine/webgl/MemoryRequirements":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._byGeometryType=null}Object.defineProperty(a.prototype,"satisfied",{get:function(){return!this._byGeometryType},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._byGeometryType=null};a.prototype.verticesFor=function(a){return this._byGeometryType?this._byGeometryType[a].vertices:0};a.prototype.indicesFor=
function(a){return this._byGeometryType?this._byGeometryType[a].indices:0};a.prototype.needMore=function(a,b,d){if(b||d)this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]),a=this._byGeometryType[a],a.vertices+=b,a.indices+=d};return a}();a.default=h})},"esri/views/2d/engine/webgl/TileBufferData":function(){define(["require","exports","./Utils"],function(h,a,d){return function(){function a(){this.geometries=
[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}a.deserialize=function(b){for(var l=new a,g=0;5>g;++g){l.geometries[g].indexBuffer=new Uint32Array(b.geometries[g].indexBuffer);l.geometries[g].vertexBuffer={};for(var e in b.geometries[g].vertexBuffer)l.geometries[g].vertexBuffer[e]={data:d.allocateTypedArrayBufferwithData(b.geometries[g].vertexBuffer[e].data,b.geometries[g].vertexBuffer[e].stride),
stride:b.geometries[g].vertexBuffer[e].stride}}return l};a.prototype.serialize=function(){for(var a={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},d=0;5>d;++d)for(var g in this.geometries[d].vertexBuffer)a.geometries[d].vertexBuffer[g]=
{data:this.geometries[d].vertexBuffer[g].data.buffer,stride:this.geometries[d].vertexBuffer[g].stride};return a};a.prototype.getBuffers=function(){for(var a=[],d=0;5>d;++d){a.push(this.geometries[d].indexBuffer.buffer);for(var g in this.geometries[d].vertexBuffer)a.push(this.geometries[d].vertexBuffer[g].data.buffer)}return a};return a}()})},"esri/views/2d/engine/webgl/TileDisplayData":function(){define("require exports ./WGLDisplayList ./WGLDisplayObject ./mesh/factories/MaterialStore ./util/serializationUtils".split(" "),
function(h,a,d,k,b,l){function g(a){for(var b=[[],[],[],[],[]],f=0;f<a.length;f++)for(var e=0,g=a[f].displayRecords;e<g.length;e++){var d=g[e];b[d.geometryType].push(d)}return b}Object.defineProperty(a,"__esModule",{value:!0});a.groupRecordsByGeometryType=g;h=function(){function a(){}Object.defineProperty(a.prototype,"displayObjectRegistry",{get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;for(var a=0,b=this.displayObjects;a<b.length;a++){var e=b[a];this._displayObjectRegistry.set(e.id,
e)}}return this._displayObjectRegistry},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"displayList",{get:function(){return this._displayList},enumerable:!0,configurable:!0});a.prototype.computeDisplayList=function(a){this._displayList=new d(a);if(a){a=0;for(var b=this.displayObjects;a<b.length;a++)for(var c=0,e=b[a].displayRecords;c<e.length;c++)this._displayList.addToList(e[c])}else for(a=g(this.displayObjects),b=a.length,c=0;c<b;++c)this._displayList.addToList(a[c])};a.prototype.serialize=
function(a){this.materialStore.serialize(a);l.serializeList(a,this.displayObjects);return a};a.prototype._deserializeObjects=function(a){for(var b=a.readInt32(),b=Array(b),c=new Map,e={store:this.materialStore},g=0;g<b.length;++g){var d=k.deserialize(a,e);b[g]=d;c.set(d.id,d)}this.displayObjects=b;this._displayList=null;this._displayObjectRegistry=c};a.deserialize=function(c){var f=new a;f.materialStore=b.default.deserialize(c);f._deserializeObjects(c);return f};return a}();a.default=h})},"esri/views/2d/engine/webgl/WGLDisplayList":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/Logger ./enums ./MaterialInfo ./Utils".split(" "),
function(h,a,d,k,b,l,g){function e(a,b,c){for(var f=[],e=3;e<arguments.length;e++)f[e-3]=arguments[e];b<a.length?a.splice.apply(a,[b,c].concat(f)):a.push.apply(a,f)}var c=k.getLogger("esri.views.2d.engine.webgl.WGLDisplayList"),f=new Map;f.set(b.WGLDrawPhase.MAP,[b.WGLGeometryType.FILL,b.WGLGeometryType.LINE,b.WGLGeometryType.MARKER,b.WGLGeometryType.TEXT]);f.set(b.WGLDrawPhase.LABEL,[b.WGLGeometryType.LABEL]);f.set(b.WGLDrawPhase.LABEL_ALPHA,[b.WGLGeometryType.LABEL]);h=function(){function a(a){void 0===
a&&(a=!1);this.symbolLevels=[];this.unified=a}a.prototype.replay=function(a,b){if(this.unified)for(var c=0,e=this.symbolLevels;c<e.length;c++)for(var g=0,d=e[c].zLevels;g<d.length;g++){var l=d[g].geometryDPInfo,k;for(k in l)if(l[k])for(var h=0,m=l[k];h<m.length;h++){var p=m[h];a.painter.getGeometryBrush(p.geometryType).drawGeometry(a,b,p,null)}}else for(var c=function(c){var f=a.painter.getGeometryBrush(c);r.byType(c,function(c){f.drawGeometry(a,b,c,null)})},r=this,e=0,g=f.get(a.drawPhase);e<g.length;e++)c(g[e])};
Object.defineProperty(a.prototype,"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.symbolLevels.length=0};a.prototype.addToList=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)this._addToList(a[c],b);else this._addToList(a,b)};a.prototype.removeFromList=function(a){Array.isArray(a)||(a=[a]);for(var b=null,c=0;c<a.length;c++)b=this._removeFromList(a[c]);return b};a.prototype.byType=function(a,
b){for(var c=0,f=this.symbolLevels;c<f.length;c++)for(var e=0,g=f[c].zLevels;e<g.length;e++){var d=g[e].geometryDPInfo,l=this.getDPInfoType(a);if(d[l])for(var k=0,d=d[l];k<d.length;k++)b(d[k])}};a.prototype.clone=function(){for(var b=new a(this.unified),c=0,f=this.symbolLevels;c<f.length;c++)b.symbolLevels.push(f[c].clone());return b};a.prototype.splitAfter=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),c=b.length,f=a.indexFrom+a.indexCount,e=0;e<c;++e){var g=b[e];
if(g.geometryType===a.geometryType&&f>g.indexFrom&&f<=g.indexFrom+g.indexCount)return f<g.indexFrom+g.indexCount&&(a=new m,a.geometryType=g.geometryType,a.materialInfo=g.materialInfo,a.indexFrom=f,a.indexCount=g.indexFrom+g.indexCount-f,b.splice(e+1,0,a),g.indexCount=f-g.indexFrom),e}};a.prototype._addToList=function(a,b){var c=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType);b=null!=b?b:c.length-1;var f=0<=b&&b<c.length?c[b]:null;null===f||!g.isSameMaterialInfo(f.materialInfo,a.materialInfo)||
f.indexFrom+f.indexCount!==a.indexFrom||this.unified&&f.geometryType!==a.geometryType?(f=new m,f.indexFrom=a.indexFrom,f.indexCount=a.indexCount,f.materialInfo=a.materialInfo,f.geometryType=a.geometryType,e(c,b+1,0,f)):f.indexCount+=a.indexCount};a.prototype._removeFromList=function(a){for(var b=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),c=b.length,f=void 0,g=0;g<c;++g){var d=b[g];if(a.indexFrom+a.indexCount>d.indexFrom&&a.indexFrom<d.indexFrom+d.indexCount&&(!this.unified||d.geometryType===
a.geometryType)){f=g;break}}if(void 0!==f){d=b[f];if(a.indexFrom===d.indexFrom)return d.indexCount-=a.indexCount,d.indexFrom+=a.indexCount,0===d.indexCount&&e(b,f,1),f-1;if(a.indexFrom+a.indexCount===d.indexFrom+d.indexCount)return d.indexCount-=a.indexCount,0===d.indexCount?(e(b,f,1),f-1):f;var c=d.indexFrom,g=a.indexFrom-d.indexFrom,k=a.indexCount;a=d.indexFrom+d.indexCount-(a.indexFrom+a.indexCount);d.indexCount=g;var h=new m;h.geometryType=d.geometryType;h.materialInfo=new l.default;h.materialInfo.copy(d.materialInfo);
h.indexFrom=c+g+k;h.indexCount=a;e(b,f+1,0,h);return f}return null};a.prototype._getDisplayList=function(a,c,f){for(var e,g=this.symbolLevels.length,d=0;d<g;d++)if(this.symbolLevels[d].symbolLevel===a){e=this.symbolLevels[d];break}e||(e=new u,e.symbolLevel=a,this.symbolLevels.push(e));var l;a=e.zLevels.length;for(g=0;g<a;g++)if(e.zLevels[g].zLevel===c){l=e.zLevels[g];break}l||(l=new x,l.geometryDPInfo=new p,l.zLevel=c,e.zLevels.push(l));var k;if(this.unified)l.geometryDPInfo.unified||(l.geometryDPInfo.unified=
[]),k=l.geometryDPInfo.unified;else switch(f){case b.WGLGeometryType.FILL:l.geometryDPInfo.fill||(l.geometryDPInfo.fill=[]);k=l.geometryDPInfo.fill;break;case b.WGLGeometryType.LINE:l.geometryDPInfo.line||(l.geometryDPInfo.line=[]);k=l.geometryDPInfo.line;break;case b.WGLGeometryType.MARKER:l.geometryDPInfo.marker||(l.geometryDPInfo.marker=[]);k=l.geometryDPInfo.marker;break;case b.WGLGeometryType.TEXT:l.geometryDPInfo.text||(l.geometryDPInfo.text=[]);k=l.geometryDPInfo.text;break;case b.WGLGeometryType.LABEL:l.geometryDPInfo.label||
(l.geometryDPInfo.label=[]);k=l.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+f+"'.")}return k};a.prototype.getDPInfoType=function(a){if(this.unified)return"unified";switch(a){case b.WGLGeometryType.FILL:return"fill";case b.WGLGeometryType.LINE:return"line";case b.WGLGeometryType.MARKER:return"marker";case b.WGLGeometryType.TEXT:return"text";case b.WGLGeometryType.LABEL:return"label";default:c.error("DisplayList: Tried to convert unknown geometryType: "+
a)}};return a}();var m=function(){function a(){this.materialInfo=null;this.indexCount=this.indexFrom=0}a.prototype.clone=function(){var b=new a;b.geometryType=this.geometryType;b.materialInfo=new l.default;b.materialInfo.copy(this.materialInfo);b.indexFrom=this.indexFrom;b.indexCount=this.indexCount;return b};return a}(),p=function(){function a(){this.unified=this.label=this.text=this.marker=this.line=this.fill=null}a.prototype.clone=function(){var b=new a;b.fill=this.fill&&this.fill.map(function(a){return a.clone()});
b.line=this.line&&this.line.map(function(a){return a.clone()});b.marker=this.marker&&this.marker.map(function(a){return a.clone()});b.text=this.text&&this.text.map(function(a){return a.clone()});b.label=this.label&&this.label.map(function(a){return a.clone()});b.unified=this.unified&&this.unified.map(function(a){return a.clone()});return b};return a}(),x=function(){function a(){this.geometryDPInfo=new p}a.prototype.clone=function(){var b=new a;b.zLevel=this.zLevel;b.geometryDPInfo=this.geometryDPInfo.clone();
return b};return a}(),u=function(){function a(){this.zLevels=[]}a.prototype.clone=function(){var b=new a;b.symbolLevel=this.symbolLevel;for(var c=0,f=this.zLevels;c<f.length;c++)b.zLevels.push(f[c].clone());return b};return a}();return h})},"esri/views/2d/engine/webgl/WGLDisplayObject":function(){define(["require","exports","./WGLDisplayRecord","./collisions/Metric","./util/serializationUtils"],function(h,a,d,k,b){return function(){function a(a){this.insertAfter=null;this.id=a;this.displayRecords=
[];this.metrics=[]}a.prototype.copy=function(){var b=new a(this.id);b.set(this);return b};a.prototype.set=function(a){this.id=a.id;this.displayRecords=a.displayRecords;this.metrics=a.metrics;this.insertAfter=a.insertAfter};a.prototype.serialize=function(a){a.push(this.id);b.serializeList(a,this.metrics);b.serializeList(a,this.displayRecords);return a};a.deserialize=function(g,e){var c=e.store,f=g.readInt32();e=new a(f);c={id:f,store:c};f=b.deserializeList(g,k.default);f.length&&(e.metrics=f);e.displayRecords=
b.deserializeList(g,d,c);return e};return a}()})},"esri/views/2d/engine/webgl/WGLDisplayRecord":function(){define(["require","exports","../../../../core/Logger","./MeshData","./Utils"],function(h,a,d,k,b){var l=d.getLogger("esri/views/2d/engine/webgl/WGLDisplayRecord");return function(){function a(a,b,f,d,g){void 0===d&&(d=0);void 0===g&&(g=0);this.id=a;this.geometryType=b;this._materialInfo=f;this.minZoom=d;this.maxZoom=g;this.meshData=null;this.indexCount=this.indexFrom=this.vertexCount=this.vertexFrom=
this.zOrder=this.symbolLevel=0}Object.defineProperty(a.prototype,"sortKey",{get:function(){void 0===this._sortKey&&this._computeSortKey();return this._sortKey},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"materialInfo",{get:function(){return"number"===typeof this._materialInfo?(l.warn("Tried to read materialInfo, but found an index! Was materialInfo deserialized correctly?"),null):this._materialInfo},set:function(a){this._materialInfo=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"materialIndex",{get:function(){return this._materialInfo},enumerable:!0,configurable:!0});a.prototype.copy=function(){var b=new a(this.id,this.geometryType,this._materialInfo);b.vertexFrom=this.vertexFrom;b.vertexCount=this.vertexCount;b.indexFrom=this.indexFrom;b.indexCount=this.indexCount;b.zOrder=this.zOrder;b.symbolLevel=this.symbolLevel;b.meshData=this.meshData;b.minZoom=this.minZoom;b.maxZoom=this.maxZoom;return b};a.prototype.setMeshDataFromBuffers=function(a,c,f){var e=new k,d;for(d in c){for(var g=
c[d].stride,l=c[d].data,h=[],r=b.strideToPackingFactor(g),t=0;t<g*a.vertexCount/r;++t)h[t]=l[t+g*a.vertexFrom/r];e.vertexData.set(d,h)}for(t=e.indexData.length=0;t<a.indexCount;++t)e.indexData[t]=f[t+a.indexFrom]-a.vertexFrom;e.vertexCount=a.vertexCount;this.meshData=e};a.prototype.readMeshDataFromBuffers=function(a,c){this.meshData?this.meshData.clear():this.meshData=new k;for(var f in a){for(var e=a[f].stride,d=a[f].data,g=[],l=b.strideToPackingFactor(e),h=0;h<e*this.vertexCount/l;++h)g[h]=d[h+
e*this.vertexFrom/l];this.meshData.vertexData.set(f,g)}for(h=this.meshData.indexData.length=0;h<this.indexCount;++h)this.meshData.indexData[h]=c[h+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount};a.prototype.writeMeshDataToBuffers=function(a,c,f,d){for(var e in c)for(var g=c[e].stride,l=this.meshData.vertexData.get(e),k=c[e].data,h=b.strideToPackingFactor(g),m=0;m<g*this.meshData.vertexCount/h;++m)k[m+g*a/h]=l[m];for(m=0;m<this.meshData.indexData.length;++m)d[m+f]=this.meshData.indexData[m]+
a;this.vertexFrom=a;this.vertexCount=this.meshData.vertexCount;this.indexFrom=f;this.indexCount=this.meshData.indexData.length};a.writeAllMeshDataToBuffers=function(a,b,f){for(var c=0,e=0,d=0;d<a.length;d++){var g=a[d];g.writeMeshDataToBuffers(c,b,e,f);c+=g.vertexCount;e+=g.indexCount}};a.prototype._computeSortKey=function(){this._sortKey=(this.symbolLevel&31)<<12|(this.zOrder&127)<<4|this.geometryType&7};a.prototype.serialize=function(a){a.push(this.geometryType);a.push(this._materialInfo);a.push(this.symbolLevel);
a.push(this.zOrder);a.push(this.vertexFrom);a.push(this.vertexCount);a.push(this.indexFrom);a.push(this.indexCount);a.push(this.minZoom);a.push(this.maxZoom);return a};a.deserialize=function(b,c){var f=b.readInt32(),e=c.store&&c.store.get(b.readInt32())||b.readInt32();c=new a(c.id,f,e);c.symbolLevel=b.readInt32();c.zOrder=b.readInt32();c.vertexFrom=b.readInt32();c.vertexCount=b.readInt32();c.indexFrom=b.readInt32();c.indexCount=b.readInt32();c.minZoom=b.readInt32();c.maxZoom=b.readInt32();return c};
return a}()})},"esri/views/2d/engine/webgl/MeshData":function(){define(["require","exports"],function(h,a){return function(){function a(){this.vertexData=new Map;this.vertexCount=0;this.indexData=[]}a.prototype.clear=function(){this.vertexData.clear();this.vertexCount=0;this.indexData=[]};a.prototype.update=function(a,b,d){for(var g in a)this.vertexData.set(g,a[g]);for(g in this.vertexData)null===a[g]&&this.vertexData.delete(g);this.vertexCount=b;this.indexData=d};return a}()})},"esri/views/2d/engine/webgl/collisions/Metric":function(){define("require exports ../../../../../core/Logger ../../../../../core/libs/gl-matrix-2/gl-matrix ../definitions ./BoundingBox ../util/serializationUtils".split(" "),
function(h,a,d,k,b,l,g){Object.defineProperty(a,"__esModule",{value:!0});var e=d.getLogger("esri/views/2d/engine/webgl/collisions/Metric");h=function(){function a(a,b,c,e,d){this.id=a;this.range=b;this.boxes=null;this.minZoom=-1;this.offsetY=this.offsetX=this.directionY=this.directionX=this.size=this.vv=0;this.anchor=k.vec2f32.fromValues(c,e);this.baseZoom=d}a.prototype.add=function(a){this.bounds?(this.boxes?this.boxes.push(a):(this.boxes=[this.bounds,a],this.bounds=this.bounds.clone()),this.bounds.extend(a)):
this.bounds=a};a.prototype.computeIndex=function(){var a=this.bounds,c=this.anchor[0],e=this.anchor[1],d=Math.floor(c/b.COLLISION_BUCKET_SIZE),g=Math.floor(e/b.COLLISION_BUCKET_SIZE),l=0;if(d>b.COLLISION_TILE_BOX_SIZE||g>b.COLLISION_TILE_BOX_SIZE)g=d=b.COLLISION_TILE_BOX_SIZE,l=1;if(0>d||0>g)g=d=0,l=1;a=2*Math.max(a.halfWidth+Math.abs(a.center[0]),a.halfHeight+Math.abs(a.center[1]));c%=b.COLLISION_BUCKET_SIZE;e%=b.COLLISION_BUCKET_SIZE;this.xBucket=d;this.yBucket=g;this.xOverflow=Math.ceil(Math.abs((a-
c)/b.COLLISION_BUCKET_SIZE))+l;this.yOverflow=Math.ceil(Math.abs((a-e)/b.COLLISION_BUCKET_SIZE))+l};a.prototype.findCollisionDelta=function(a){var c=this.bounds.findCollisionDelta(a.bounds),f=this.boxes&&this.boxes.length,e=a.boxes&&a.boxes.length;return Math.abs(c)>b.COLLISION_MAX_ZOOM_DELTA||!f&&!e?c:f&&e?this._boxesToBoxes(a):f?this._boxesToBox(a):this._boxToBoxes(a)};a.prototype.computeOffset=function(a){a||e.error("mapview-labeling","Unable to compute label offset. Expected an evaluator function but found "+
a);a=a(this.vv);a=isNaN(this.vv)||isNaN(a)?this.size:a;this.offsetX=this.directionX*(a/2+b.COLLISION_PLACEMENT_PADDING);this.offsetY=this.directionY*(a/2+b.COLLISION_PLACEMENT_PADDING)};a.prototype.setVV=function(a,b,c,e){this.vv=a;this.size=b;this.directionX=c;this.directionY=e};a.prototype._boxToBoxes=function(a){var b=-Infinity,c=0;for(a=a.boxes;c<a.length;c++)var f=this.bounds.findCollisionDelta(a[c]),b=Math.max(f,b);return b};a.prototype._boxesToBox=function(a){for(var b=this.boxes[0].findCollisionDelta(a.bounds),
c=1;c<this.boxes.length;c++)var f=this.boxes[c].findCollisionDelta(a.bounds),b=Math.max(f,b);return b};a.prototype._boxesToBoxes=function(a){for(var b=-Infinity,c=0;c<this.boxes.length;c++)for(var f=this.boxes[c],e=0,d=a.boxes;e<d.length;e++)var g=f.findCollisionDelta(d[e]),b=Math.max(g,b);return b};a.prototype.serialize=function(a){a.push(this.id);this.bounds.serialize(a);a.push(this.range.from);a.push(this.range.count);a.push(this.anchor[0]);a.push(this.anchor[1]);a.push(this.baseZoom);a.writeF32(this.vv);
a.push(this.size);a.push(this.directionX);a.push(this.directionY);a.push(this.offsetX);a.push(this.offsetY);g.serializeList(a,this.boxes);return a};a.deserialize=function(b){var c=b.readInt32(),f=l.default.deserialize(b),e=b.readInt32(),d=b.readInt32(),k={from:e,count:d},h=b.readInt32(),t=b.readInt32(),A=b.readInt32(),e=b.readF32(),d=b.readInt32(),C=b.readInt32(),z=b.readInt32(),v=b.readInt32(),y=b.readInt32();b=g.deserializeList(b,l.default);c=new a(c,k,h,t,A);c.bounds=f;c.boxes=b;c.computeIndex();
c.setVV(e,d,C,z);c.offsetX=v;c.offsetY=y;return c};return a}();a.default=h})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/gl-matrix","../../../../3d/support/mathUtils"],function(h,a,d,k){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,b,e,c){this.center=d.vec2f32.fromValues(a,b);this.centerT=d.vec2f32.create();this.halfWidth=e/2;this.halfHeight=c/2;this.width=e;this.height=c}Object.defineProperty(a.prototype,
"x",{get:function(){return this.center[0]},set:function(a){this.center[0]=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this.center[1]},set:function(a){this.center[1]=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blX",{get:function(){return this.center[0]-this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"blY",{get:function(){return this.center[1]-this.halfHeight},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"trX",{get:function(){return this.center[0]+this.halfWidth},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"trY",{get:function(){return this.center[1]+this.halfHeight},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)};a.prototype.serialize=function(a){a.writeF32(this.center[0]);a.writeF32(this.center[1]);a.push(this.width);a.push(this.height);return a};a.prototype.findCollisionDelta=
function(a){return k.log2(Math.min((a.halfWidth+this.halfWidth)/Math.abs(a.centerT[0]-this.centerT[0]),(a.halfHeight+this.halfHeight)/Math.abs(a.centerT[1]-this.centerT[1])))};a.prototype.extend=function(a){var b=Math.min(this.blX,a.blX),e=Math.min(this.blY,a.blY),c=Math.max(this.trY,a.trY);this.width=Math.max(this.trX,a.trX)-b;this.height=c-e;this.halfWidth=this.width/2;this.halfHeight=this.height/2;this.x=b+this.halfWidth;this.y=e+this.halfHeight};a.deserialize=function(b){var d=b.readF32(),e=b.readF32(),
c=b.readInt32();b=b.readInt32();return new a(d,e,c,b)};return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/factories/MaterialStore":function(){define(["require","exports","../../MaterialInfo","../../util/serializationUtils"],function(h,a,d,k){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._materials=[];this._materialsIndex=new Map}a.prototype.insert=function(a){var b=this._materials.length;this._materials.push(a);return b};a.prototype._hashGlyph=function(a,
b,e){return"G-"+b+"-"+e+"-"+a.page};a.prototype._hashSprite=function(a,b,e){return a?"S-"+b+"-"+e+"-"+a.page+"-"+(a.sdf?1:0):"S-"+b+"-"+e+"--1}"};a.prototype.createSpriteMaterial=function(a,b,e){var c=this._hashSprite(a,b,e);if(this._materialsIndex.has(c))return this._materialsIndex.get(c);var f=this._materials.length;a=d.default.fromSprite(a,b,e);this._materials.push(a);this._materialsIndex.set(c,f);return f};a.prototype.createGlyphMaterial=function(a,b,e){var c=this._hashGlyph(a,b,e);if(this._materialsIndex.has(c))return this._materialsIndex.get(c);
var f=this._materials.length;a=d.default.fromGlyph(a,b,e);this._materials.push(a);this._materialsIndex.set(c,f);return f};a.prototype.get=function(a){return this._materials[a]};a.prototype.hydrateObjects=function(a){for(var b=0;b<a.length;b++)for(var e=0,c=a[b].displayRecords;e<c.length;e++){var f=c[e];f.materialInfo=this.get(f.materialIndex)}return a};a.prototype.serialize=function(a){k.serializeList(a,this._materials);return a};a.deserialize=function(b){var g=new a;g._materials=k.deserializeList(b,
d.default);return g};return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/VertexBuffer":function(){define(["require","exports","../Utils"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});var k=function(){function a(a,b,e){this.data=a;this.stride=b;this.vertexCount=e}a.decode=function(b){var g=d.allocateTypedArrayBufferwithData(b.data,b.stride);return new a(g,b.stride,b.vertexCount)};a.fromVertexVector=function(b){var g=d.allocateTypedArrayBufferwithData(b.data.buffer(),b.stride);
return new a(g,b.stride,b.vertexCount)};return a}();a.default=k;h=function(){function a(a,b,e){this.geometryType=a;this.indexBuffer=new Uint32Array(b);this.namedBuffers=e}a.decode=function(b){var d=b.geometryType,e=b.indexBuffer,c={},f;for(f in b.namedBuffers)c[f]=k.decode(b.namedBuffers[f]);return new a(d,e,c)};a.fromVertexVectors=function(b){var d=b.geometryType,e=b.indexVector.buffer(),c={},f;for(f in b.namedVectors)c[f]=k.fromVertexVector(b.namedVectors[f]);return new a(d,e,c)};return a}();a.VertexBuffers=
h})},"esri/views/2d/engine/webgl/util/Reader":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a){this._pos=0;this._buffer=a;this._i32View=new Int32Array(this._buffer);this._f32View=new Float32Array(this._buffer)}a.prototype.readInt32=function(){return this._i32View[this._pos++]};a.prototype.readF32=function(){return this._f32View[this._pos++]};return a}();a.default=h})},"esri/views/2d/engine/webgl/util/Writer":function(){define(["require",
"exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,b){this._pos=0;b=b?this._roundToNearest(b,a.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(b);this._buffer=new a(this._array);this._ctor=a}Object.defineProperty(a.prototype,"length",{get:function(){return this._pos},enumerable:!0,configurable:!0});a.prototype._roundToNearest=function(a,b){a=Math.round(a);return a+(b-a%b)};a.prototype._ensureSize=function(a){if(this._pos+a>=this._buffer.length){a=
this._roundToNearest(1.5*(this._array.byteLength+a*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT);a=new ArrayBuffer(a);var b=new this._ctor(a);b.set(this._buffer,0);this._array=a;this._buffer=b}};a.prototype.writeF32=function(a){this._ensureSize(1);var b=this._pos;(new Float32Array(this._array,4*this._pos,1))[0]=a;this._pos++;return b};a.prototype.push=function(a){this._ensureSize(1);var b=this._pos;this._buffer[this._pos++]=a;return b};a.prototype.writeRegion=function(a){this._ensureSize(a.length);
var b=this._pos;this._buffer.set(a,this._pos);this._pos+=a.length;return b};a.prototype.buffer=function(){var a=this._array.slice(0,4*this._pos);this.destroy();return a};a.prototype.destroy=function(){this._buffer=this._array=null};return a}();a.default=h})},"esri/views/2d/engine/webgl/WGLTile":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../DisplayObject ./definitions ./DirtyMap ./DisplayRecordStore ./enums ./Fader ./number ./Utils ./WGLBuffers ./WGLDisplayList ../../tiling/TileKey".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w){function r(a,b){return a.sortKey-b.sortKey}var t=new Set;return function(a){function b(b,c,e){void 0===e&&(e=!1);var d=a.call(this)||this;d._data=null;d.hlDisplayList=null;d._displayList=null;d._wglBuffers=null;d._dirtyMap=new g.default;d.coords=[0,0];d.bounds=[0,0,0,0];d.tileTransform={transform:k.mat4f32.create(),screenTransform:k.mat2df32.create(),displayCoord:k.vec2f32.create(),screenCoord:k.vec2f32.create()};d.dvsMat3=k.mat3f32.create();d.tileMat3=k.mat3f32.create();
d.labelMat2d=k.mat2df32.create();d._labelIndex=null;d._dirty=!0;d.fader=new f.default;d.key=w.pool.acquire(b);d.coords[0]=c[0];d.coords[1]=c[3];d.bounds=c;d._ensureCorrectZOrder=e;return d}d(b,a);Object.defineProperty(b.prototype,"iconGeometry",{get:function(){return this.getGeometry(c.WGLGeometryType.MARKER)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textGeometry",{get:function(){return this.getGeometry(c.WGLGeometryType.TEXT)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"fillGeometry",{get:function(){return this.getGeometry(c.WGLGeometryType.FILL)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"lineGeometry",{get:function(){return this.getGeometry(c.WGLGeometryType.LINE)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"labelGeometry",{get:function(){return this.getGeometry(c.WGLGeometryType.LABEL)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"displayObjects",{get:function(){return this._data.tileDisplayData.displayObjects},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"canDisplay",{get:function(){return!!this.attached},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isDirty",{get:function(){return this._dirty},set:function(a){(this._dirty=a)||this.isReady||this.ready();this.requestRender()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasData",{get:function(){return!!this._data},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"labelIndex",
{get:function(){return this._labelIndex},enumerable:!0,configurable:!0});b.prototype.getGeometry=function(a){return this._wglBuffers&&this._wglBuffers.has(a)?this._wglBuffers.get(a):null};b.prototype.getDisplayList=function(a){switch(a){case c.WGLDrawPhase.HIGHLIGHT:return this.hlDisplayList;default:return this._data&&this._displayList}};Object.defineProperty(b.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});b.prototype.setData=function(a,b,c){var f=a.addOrUpdate,
d=a.remove;this.fader.reset();!a.clear&&this.hasData||a.addOrUpdate?!a.clear&&this.hasData||!a.addOrUpdate?this.hasData&&this._doPatchData({addOrUpdate:f,remove:d},b,c):(f.tileDisplayData.computeDisplayList(this._ensureCorrectZOrder),this._dirtyMap=new g.default,this._dispRecStore=e.default.fromTileData(f,this._dirtyMap),this._data=f,this._readyTileIfNoLabels(b,c),this._dirtyMap.markAllDirty(),this._displayList||(this._displayList=f.tileDisplayData.displayList.clone())):(this.clear(),this.ready())};
b.prototype.commitChanges=function(a){this.isDirty&&this._wglBuffers||(this._wglBuffers||(this._wglBuffers=new x.default(this.stage.context)),this._displayList=this._data.tileDisplayData.displayList.clone(),this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._dirtyMap.markAllClean())};b.prototype.resetVisibility=function(a){var b=this,c=[],f=Array(1);a.forEach(function(a){f[0]=a;b.setVisibility(c,f)})};b.prototype.setVisibility=function(a,b){for(var c=this._data.tileBufferData.geometries.map(p.geometryToMappedGeometry),
f=0;f<a.length;f++){var e=this._data.tileDisplayData.displayObjectRegistry.get(a[f]);if(e)for(var d=0,g=e.displayRecords;d<g.length;d++){var l=g[d],h=c[l.geometryType];if(e=h.geometry.vertexBuffer[p.C_VBO_VISIBILITY]){h.vertexFrom=null==h.vertexFrom?l.vertexFrom:Math.min(h.vertexFrom,l.vertexFrom);h.vertexTo=null==h.vertexTo?l.vertexFrom+l.vertexCount:Math.max(h.vertexTo,l.vertexFrom+l.vertexCount);for(var h=l.vertexFrom,l=l.vertexCount,k=0;k<l;++k)e.data[h+k]=255}}}for(a=0;a<b.length;a++)if(e=this._data.tileDisplayData.displayObjectRegistry.get(b[a]))for(f=
0,d=e.displayRecords;f<d.length;f++)if(l=d[f],h=c[l.geometryType],e=h.geometry.vertexBuffer[p.C_VBO_VISIBILITY])for(h.vertexFrom=null==h.vertexFrom?l.vertexFrom:Math.min(h.vertexFrom,l.vertexFrom),h.vertexTo=null==h.vertexTo?l.vertexFrom+l.vertexCount:Math.max(h.vertexTo,l.vertexFrom+l.vertexCount),h=l.vertexFrom,l=l.vertexCount,k=0;k<l;++k)e.data[h+k]=0;b=!1;for(e=0;e<c.length;++e)h=c[e],null!=h.vertexFrom&&null!=h.vertexTo&&(this._dirtyMap.markDirtyVertices(e,p.C_VBO_VISIBILITY,h.vertexFrom,h.vertexTo?
h.vertexTo-h.vertexFrom:0),b=!0);b&&this.requestRender()};b.prototype.setVisibilityRange=function(a,b,f,e){a=this._data.tileDisplayData.displayObjectRegistry.get(a);for(var d=this._data.tileBufferData.geometries[c.WGLGeometryType.LABEL].vertexBuffer[p.C_VBO_VISIBILITY_RANGE],g=Infinity,l=0,h=b;h<b+f;++h){for(var k=a.displayRecords[h],u=Math.max(k.minZoom,e),v=k.maxZoom,u=m.i8888to32(u,v,u,v),v=k.vertexFrom*d.stride/4,w=k.vertexCount*d.stride/4,r=v;r<v+w;++r)d.data[r]=u;g=Math.min(g,k.vertexFrom);
l=Math.max(l,k.vertexFrom+k.vertexCount)}this._dirtyMap.markDirtyVertices(c.WGLGeometryType.LABEL,p.C_VBO_VISIBILITY_RANGE,g,l-g)};b.prototype.setTransform=function(a,b){var c=this.tileMat3,f=a.toScreenNoRotation([0,0],this.coords);k.mat3.set(this.tileMat3,b,0,0,0,b,0,f[0],f[1],1);k.mat3.multiply(this.dvsMat3,a.displayViewMat3,c)};b.prototype.setLabelTransform=function(a,b){var c=this.labelMat2d;b=a.getScreenTransform(c,b);var f=k.vec2f32.create();k.vec2.transformMat2d(f,this.coords,b);k.mat2d.identity(c);
k.mat2d.translate(c,c,f);k.mat2d.multiply(c,a.viewMat2d,c)};b.prototype.clear=function(){this._dispRecStore=this._displayList=this._data=null;this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null);this.hlDisplayList&&(this.hlDisplayList=null)};b.prototype.attach=function(){return!0};b.prototype.dispose=function(){this.clear()};b.prototype.doRender=function(a){if(this.isReady&&this.hasData){this.commitChanges(a);this.stage.context.setStencilFunction(514,this.stencilRef,255);if(a.drawPhase===
c.WGLDrawPhase.MAP||a.drawPhase===c.WGLDrawPhase.LABEL||a.drawPhase===c.WGLDrawPhase.LABEL_ALPHA)this._displayList.replay(a,this);else for(var b=0,f=this.stage.painter.getBrushes(a.drawPhase);b<f.length;b++)f[b].draw(a,this);this.fader.step()||this.requestRender()}};b.prototype.buildHLList=function(a){var b=this;this.hlDisplayList=new u;a.forEach(function(a){b._addToHLDisplayList(b.hlDisplayList,a)})};b.prototype._addToHLDisplayList=function(a,b){if(this._data){var c=this._data.tileDisplayData.displayObjectRegistry.get(b);
if(c){b=[];for(var f=0,c=c.displayRecords;f<c.length;f++){var e=c[f].copy();e.meshData=null;e.symbolLevel=0;e.zOrder=0;b.push(e)}b.sort(r);a.addToList(b)}}};b.prototype._readyTileIfNoLabels=function(a,b){a?(b||(this.isDirty=!1),this._rebuildLabelIndex(),this.isDirty=!0):this.isDirty=!1};b.prototype._doPatchData=function(a,b,c){this._patchData(a)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=e.default.fromTileData(this._data,this._dirtyMap));this._readyTileIfNoLabels(b,
c);this.requestRender()};b.prototype._rebuildLabelIndex=function(){this._labelIndex=this._initLabelIndex();for(var a=0,b=this.displayObjects;a<b.length;a++)for(var c=0,f=b[a].metrics;c<f.length;c++)this._insertIntoLabelIndex(f[c])};b.prototype._insertIntoLabelIndex=function(a){-1!==a.xBucket&&this.labelIndex[a.yBucket][a.xBucket].push(a)};b.prototype._initLabelIndex=function(){for(var a=[],b=0;b<l.TILE_SIZE/l.COLLISION_BUCKET_SIZE;b++){a.push([]);for(var c=0;c<l.TILE_SIZE/l.COLLISION_BUCKET_SIZE;c++)a[b].push([])}return a};
b.prototype._patchData=function(a){for(var b=!0,c=a.addOrUpdate&&a.addOrUpdate.tileDisplayData&&a.addOrUpdate.tileDisplayData.displayObjects||[],f=(a.remove||[]).slice(),e=0;e<c.length;e++){var d=c[e];null!=d.insertAfter&&f.push(d.id)}for(d=0;d<f.length;d++){var g=f[d];if(e=this._data.tileDisplayData.displayObjectRegistry.get(g)){this._data.tileDisplayData.displayList.removeFromList(e.displayRecords);for(var l=0,h=e.displayRecords;l<h.length;l++)this._dispRecStore.delete(h[l]);this._data.tileDisplayData.displayObjectRegistry.delete(g);
e=this._data.tileDisplayData.displayObjects.indexOf(e);this._data.tileDisplayData.displayObjects.splice(e,1)}}for(f=0;f<c.length;f++){d=c[f];e=this._data.tileDisplayData.displayObjectRegistry.get(d.id);g=void 0;if(e){l=e.displayRecords;e.set(d);e.displayRecords=l;l=e.displayRecords.length;for(h=0;h<l;++h){var k=e.displayRecords[h],m=d.displayRecords[h];if(h>=d.displayRecords.length||k.geometryType!==m.geometryType||k.symbolLevel!==m.symbolLevel||k.zOrder!==m.zOrder||k.materialInfo.materialKey!==m.materialInfo.materialKey)this._dispRecStore.delete(e.displayRecords[h]),
h<d.displayRecords.length&&(e.displayRecords[h]=void 0)}e.displayRecords.length=d.displayRecords.length;e.metrics=d.metrics}else if(e=d.copy(),e.displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(d.id,e),h=void 0,k=this._data.tileDisplayData.displayObjects,null!=e.insertAfter?(g={},0<=e.insertAfter?(l=this._data.tileDisplayData.displayObjectRegistry.get(e.insertAfter))?(h=k.indexOf(l)+1,h<k.length?k.splice(h,0,e):(k.push(e),h=k.length)):(k.push(e),h=k.length):(k.unshift(e),h=0)):
(k.push(e),h=k.length),g){m=void 0;if(this._data.tileDisplayData.displayList.unified)m=0<d.displayRecords.length?1:0;else{t.clear();for(var m=0,p=d.displayRecords;m<p.length;m++)l=this._data.tileDisplayData.displayList.getDPInfoType(p[m].geometryType),t.add(l);m=t.size}p=0;for(--h;0<=h&&p<m;--h)for(var u=k[h].displayRecords.length-1;0<=u&&p<m;--u){var w=k[h].displayRecords[u],l=this._data.tileDisplayData.displayList.getDPInfoType(w.geometryType);g[l]||(g[l]=w,++p)}}p=d.displayRecords.length;for(h=
0;h<p;++h){m=d.displayRecords[h];(k=e.displayRecords[h])?(k.meshData=m.meshData,k.materialInfo=m.materialInfo):(k=m.copy(),k.vertexFrom=void 0,k.indexFrom=void 0,e.displayRecords[h]=k);var u=m.geometryType,l=this._data.tileDisplayData.displayList.getDPInfoType(u),w=a.addOrUpdate.tileBufferData.geometries[u],u=w.vertexBuffer,w=w.indexBuffer,r=void 0;g&&(r=g[l]?this._data.tileDisplayData.displayList.splitAfter(g[l]):-1);b=this._dispRecStore.setMeshData(k,m,u,w,r)&&b;g&&null!=k.indexFrom&&null!=k.indexFrom&&
(g[l]=k)}}return b};return b}(b.DisplayObject)})},"esri/views/2d/engine/webgl/DirtyMap":function(){define(["require","exports","./Utils"],function(h,a,d){function k(a,d,g){if(!a.allDirty)if(null!=a.from&&null!=a.count){var b=Math.min(a.from,d);d=Math.max(a.from+a.count,d+g)-b;a.from=b;a.count=d}else a.from=d,a.count=g}Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._dirties=d.createGeometryData(function(a){return{indices:{from:null,count:null,allDirty:!1}}},function(a,
b){return{vertices:{from:null,count:null,allDirty:!1}}})}a.prototype.markAllClean=function(){for(var a=0,b=this._dirties;a<b.length;a++){var e=b[a];e.data.indices.from=null;e.data.indices.count=null;e.data.indices.allDirty=!1;for(var c in e.buffers)e.buffers[c].data.vertices.from=null,e.buffers[c].data.vertices.count=null,e.buffers[c].data.vertices.allDirty=!1}};a.prototype.markAllDirty=function(){for(var a=0,b=this._dirties;a<b.length;a++){var e=b[a];e.data.indices.allDirty=!0;for(var c in e.buffers)e.buffers[c].data.vertices.allDirty=
!0}};a.prototype.forEach=function(a){for(var b=0;b<this._dirties.length;++b){var e=this._dirties[b],c={},f;for(f in e.buffers){var d=e.buffers[f].data.vertices;if(d.allDirty||null!=d.from&&null!=d.count&&0<d.count)c[f]=d}e=e.data.indices;d=void 0;d=e.allDirty||null!=e.from&&null!=e.count&&0<e.count?{indices:e,vertices:c}:{indices:null,vertices:c};(d.indices||0<Object.keys(d).length)&&a(d,b)}};a.prototype.markDirtyIndices=function(a,b,e){k(this._dirties[a].data.indices,b,e)};a.prototype.markDirtyVertices=
function(a,b,e,c){k(this._dirties[a].buffers[b].data.vertices,e,c)};return a}();a.default=h})},"esri/views/2d/engine/webgl/DisplayRecordStore":function(){define(["require","exports","../../../../core/has","./FreeList","./Utils"],function(h,a,d,k,b){function l(a){a=a.getStrides();var b={},f;for(f in a)b[g[f]]=a[f];return b}Object.defineProperty(a,"__esModule",{value:!0});var g=["FILL","LINE","MARKER","TEXT","LABEL"];h=function(){function a(a,f,e,d){this._strides=a;this._displayList=f;this._freeListsAndStorage=
{};this._dirtyMap=null;this._dirtyMap=e;for(var c in a){this._freeListsAndStorage[c]={vtxFreeList:d?new k.FreeList(d):null,idxFreeList:d?new k.FreeList(d):null,vertexBuffers:{},indexBuffer:d?new Uint32Array(d):null};for(var g in a[c])this._freeListsAndStorage[c].vertexBuffers[g]={data:d?b.allocateTypedArrayBuffer(d,a[c][g]):null,stride:a[c][g]}}}a.fromTileData=function(c,f){var e=l(c),d=[0,0,0,0,0],h=[0,0,0,0,0],u=[];c.tileDisplayData.displayObjectRegistry.forEach(function(a){u.push(a)});for(var w=
0;w<u.length;w++)for(var r=0,t=u[w].displayRecords;r<t.length;r++){var A=t[r];d[A.geometryType]=Math.max(d[A.geometryType],A.vertexFrom+A.vertexCount);h[A.geometryType]=Math.max(h[A.geometryType],A.indexFrom+A.indexCount)}f=new a(e,c.tileDisplayData.displayList,f,null);for(e=0;e<c.tileBufferData.geometries.length;++e){var w=d[e],t=h[e],A=c.tileBufferData.geometries[e],r=f._storageFor(g[e]),C=c.tileBufferData.geometries[e].indexBuffer;r.indexBuffer=C;r.idxFreeList=new k.FreeList(C.length);r.idxFreeList.allocate(t);
var t=void 0,z;for(z in A.vertexBuffer)A=c.tileBufferData.geometries[e].vertexBuffer[z],r.vertexBuffers[z].data=A.data,r.vertexBuffers[z].stride=A.stride,C=b.strideToPackingFactor(A.stride),A=A.data.length*C/A.stride,t||(t=A);r.vtxFreeList=new k.FreeList(t);r.vtxFreeList.allocate(w)}return f};a.prototype.delete=function(a){var b=g[a.geometryType];this._freeVertices(b,a.vertexFrom,a.vertexCount);this._freeIndices(b,a.indexFrom,a.indexCount);this._displayList.removeFromList(a);a.vertexFrom=void 0;a.indexFrom=
void 0};a.prototype.setMeshData=function(a,f,e,d,l){var c=g[a.geometryType];a.meshData=null;var h=void 0,k=void 0;void 0===a.vertexFrom?(k=f.vertexCount,h=this._allocateVertices(c,k)):f.vertexCount>a.vertexCount?(this._freeVertices(c,a.vertexFrom,a.vertexCount),k=f.vertexCount,h=this._allocateVertices(c,k)):f.vertexCount===a.vertexCount?(h=a.vertexFrom,k=a.vertexCount):(this._freeVertices(c,a.vertexFrom+f.vertexCount,a.vertexCount-f.vertexCount),h=a.vertexFrom,k=f.vertexCount);var m=!0,p=void 0,x=
void 0,z=void 0;void 0===a.indexFrom?(p=l,z=f.indexCount,x=this._allocateIndices(c,z)):f.indexCount>a.indexCount?(p=this._displayList.removeFromList(a),this._freeIndices(c,a.indexFrom,a.indexCount),z=f.indexCount,x=this._allocateIndices(c,z)):f.indexCount===a.indexCount?(m=!1,x=a.indexFrom,z=a.indexCount):(p=this._displayList.removeFromList(a),this._freeIndices(c,a.indexFrom+f.indexCount,a.indexCount-f.indexCount),x=a.indexFrom,z=f.indexCount);if(-1!==h&&-1!==x){l=this._storageFor(c);b.copyMeshData(h,
x,l.vertexBuffers,l.indexBuffer,f,e,d);a.vertexFrom=h;a.indexFrom=x;a.vertexCount=f.vertexCount;a.indexCount=f.indexCount;if(this._dirtyMap){this._dirtyMap.markDirtyIndices(a.geometryType,a.indexFrom,a.indexCount);for(var v in e)this._dirtyMap.markDirtyVertices(a.geometryType,v,a.vertexFrom,a.vertexCount)}m&&this._displayList.addToList(a,p);return!0}-1!==h&&this._freeVertices(c,h,k);-1!==x&&this._freeIndices(c,x,z);a.setMeshDataFromBuffers(f,e,d);a.vertexFrom=void 0;a.vertexCount=0;a.indexFrom=void 0;
a.indexCount=0;return!1};a.prototype._allocateVertices=function(a,b){a=this._storageFor(a);b=a.vtxFreeList.allocate(b);return-1===b||.5<a.vtxFreeList.fragmentation?-1:b};a.prototype._freeVertices=function(a,b,e){this._storageFor(a).vtxFreeList.free(b,e)};a.prototype._freeIndices=function(a,b,e){this._storageFor(a).idxFreeList.free(b,e)};a.prototype._allocateIndices=function(a,b){a=this._storageFor(a);b=a.idxFreeList.allocate(b);return-1===b||.5<a.idxFreeList.fragmentation?-1:b};a.prototype._storageFor=
function(a){return this._freeListsAndStorage[a]};a.prototype._stridesFor=function(a,b){return this._strides[a][b]};return a}();a.default=h})},"esri/views/2d/engine/webgl/FreeList":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});var d=function(){function a(a){this._largestRange=null;this._parent=a;this._updateLargestRange()}Object.defineProperty(a.prototype,"largestRange",{get:function(){return this._largestRange},enumerable:!0,configurable:!0});
a.prototype.rangeCreated=function(a){if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a};a.prototype.rangeResized=function(a,d,g){if(a===this._largestRange)a.count<g&&this._updateLargestRange();else if(!this._largestRange||a.count>this._largestRange.count)this._largestRange=a};a.prototype.findBestRange=function(a){for(var b=this._parent._freeHead,d=null;null!==b;)b.count>=a&&(!d||b.count-a<d.count-a)&&(d=b),b=b.next;return d};a.prototype.findAdjacentRanges=function(a,d){for(var b=
!0,e=!1,c=null,f=this._parent._freeHead;b&&!e;){var l=null!==f?f.from:this._parent._size;a>=(null!==c?c.from+c.count:0)&&a+d<=l?(b=!1,e=!0):null!==f?(c=f,f=f.next):b=!1}return[c,f]};a.prototype._updateLargestRange=function(){for(var a=null,d=this._parent._freeHead;null!==d;){if(!a||d.count>a.count)a=d;d=d.next}this._largestRange=a};return a}();h=function(){function a(a,l){this._allocated=0;this._size=a;this._freeHead=0<a?{from:0,count:a,prev:null,next:null}:null;this._bookKeeper=l||new d(this);this._freeHead&&
this._bookKeeper.rangeCreated(this._freeHead)}a.prototype.allocate=function(b){var d=this._bookKeeper.findBestRange(b);if(null===d)return-1;var g=d.from,e=d.count;d.from+=b;d.count-=b;this._bookKeeper.rangeResized(d,g,e);this._allocated+=b;0===d.count&&(b=null!==d.prev?this._freeHead:d.next,a._removeRange(d),this._freeHead=b);return g};a.prototype.free=function(b,d){var g=this._bookKeeper.findAdjacentRanges(b,d),e=g[0],g=g[1];b={from:b,count:d,prev:e,next:g};null!==e&&(e.next=b);null!==g&&(g.prev=
b);this._bookKeeper.rangeCreated(b);this._allocated-=d;if(null!==g&&b.from+b.count===g.from){d=b.from;var c=b.count;a._fuse(b,g);a._removeRange(g);this._bookKeeper.rangeResized(b,d,c);this._bookKeeper.rangeResized(g,void 0,0)}null!==e&&e.from+e.count===b.from&&(d=e.from,c=e.count,a._fuse(e,b),a._removeRange(b),this._bookKeeper.rangeResized(e,d,c),this._bookKeeper.rangeResized(b,void 0,0));this._freeHead=null!==b.prev?this._freeHead:b};Object.defineProperty(a.prototype,"fragmentation",{get:function(){var a=
this._size-this._allocated;return 0===a?0:1-this._bookKeeper.largestRange.count/a},enumerable:!0,configurable:!0});a._removeRange=function(a){null!==a.prev?null!==a.next?(a.prev.next=a.next,a.next.prev=a.prev):a.prev.next=null:null!==a.next&&(a.next.prev=null)};a._fuse=function(a,d){a.count+=d.count;a.next=d.next;d.from+=d.count;d.count=0;null!==d.next&&(d.next.prev=a)};return a}();a.FreeList=h})},"esri/views/2d/engine/webgl/Fader":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,
"__esModule",{value:!0});h=function(){function a(a){void 0===a&&(a=400);this.duration=a;this._value=this._elapsed=this._lastTime=0;this._finished=!1}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._value=this._elapsed=this._lastTime=0};a.prototype.step=function(){var a=performance.now();if(0===this._lastTime)return this._lastTime=a,this._value=0,!0;if(this._elapsed>=this.duration)return!0;this._elapsed+=
a-this._lastTime;this._lastTime=a;this._value=Math.min(this._elapsed/this.duration,1);return!1};return a}();a.default=h})},"esri/views/2d/engine/webgl/WGLBuffers":function(){define(["require","exports","./Utils","../../../webgl/BufferObject"],function(h,a,d,k){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a){this.geometryMap=d.createGeometryData(function(b){return{indexBuffer:k.createIndex(a,35044),vao:null}},function(b,e){return{vertexBuffer:k.createVertex(a,d.C_VBO_INFO[e])}})}
a.prototype.dispose=function(){for(var a in this.geometryMap){var b=this.geometryMap[a];b.data.vao&&b.data.vao.dispose(!1);b.data.indexBuffer&&b.data.indexBuffer.dispose();for(var e in b.buffers)b.buffers[e]&&b.buffers[e].data.vertexBuffer.dispose()}};a.prototype.get=function(a){var b=this.geometryMap[a];a={};for(var e in b.buffers)a[e]=b.buffers[e].data.vertexBuffer;return{indexBuffer:b.data.indexBuffer,get vao(){return b.data.vao},set vao(a){b.data.vao=a},vertexBufferMap:a}};a.prototype.has=function(a){return null!=
this.geometryMap[a]};a.prototype.upload=function(a,b){var e=this;b.forEach(function(b,f){e._upload(b,f,a)})};a.prototype._upload=function(a,b,e){a.indices&&(a.indices.allDirty?this._uploadIndices(e,b):null!=a.indices.from&&null!=a.indices.count&&this._uploadIndices(e,b,a.indices.from,a.indices.count));if(a.vertices){a=a.vertices;for(var c in a){var f=a[c];f.allDirty?this._uploadVertices(e,b,c):null!=f.from&&null!=f.count&&this._uploadVertices(e,b,c,f.from,f.count)}}};a.prototype._uploadVertices=function(a,
b,e,c,f){var d=this.geometryMap[b];d&&(b=a.geometries[b].vertexBuffer[e])&&(a=b.stride,b=b.data.buffer,d.buffers[e]&&0<b.byteLength&&(null!=c&&null!=f?d.buffers[e].data.vertexBuffer.setSubData(b,c*a,c*a,(c+f)*a):d.buffers[e].data.vertexBuffer.setData(b)))};a.prototype._uploadIndices=function(a,b,e,c){var f=this.geometryMap[b];f&&(a=a.geometries[b].indexBuffer.buffer,f.data.indexBuffer&&0<a.byteLength&&(null!=e&&null!=c?f.data.indexBuffer.setSubData(a,4*e,4*e,4*(e+c)):f.data.indexBuffer.setData(a)))};
return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/factories/matcherUtils":function(){define(["require","exports","../../../../../../core/Error","../../../../../../core/Logger","../../util/Matcher"],function(h,a,d,k,b){Object.defineProperty(a,"__esModule",{value:!0});var l=k.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");a.createMatcher=function(a,e,c,f){switch(a.type){case "simple":return b.default.fromSimpleRenderer(a,e,c);case "unique-value":case "uniqueValue":return b.MapMatcher.fromUVRenderer(a,
e,c,f);case "class-breaks":case "classBreaks":return b.IntervalMatcher.fromCBRenderer(a,e,c,f);default:return l.error(new d("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),null}}})},"esri/views/2d/engine/webgl/util/Matcher":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/Logger ../Utils ./vvFlagUtils".split(" "),function(h,a,d,k,b,l){Object.defineProperty(a,"__esModule",{value:!0});var g=k.getLogger("esri/views/2d/engine/webgl/util/Matcher");
h=function(){function a(){this._defaultResult=null}a.fromSimpleRenderer=function(b,f,e){var c=b.getSymbols(),d=l.getVVFlags(b.visualVariables);b=new a;c.length&&(f=e.createTemplateGroup(c[0],null,f,d),b.setDefault(f));return b};a.prototype.size=function(){return 1};a.prototype.getDefault=function(){return this._defaultResult};a.prototype.setDefault=function(a){this._defaultResult=a};a.prototype.match=function(a,b,e){return this.getDefault()};return a}();a.default=h;k=function(a){function c(c,e,d,
g,h){var f=a.call(this)||this;f._intervals=[];f._isMaxInclusive=e;g?f._getValue=b.createArcadeFunction(g,h):c&&c.length?"function"===typeof c?(f._field=null,f._getValue=c):(f._field=c,f._normalizationInfo=d,f._getValue=f._getValueFromField.bind(f)):f._field=null;return f}d(c,a);c.fromCBRenderer=function(a,b,e,d){var f=a.isMaxInclusive,g=a.valueExpression,h=a.normalizationField,k=a.normalizationTotal,m=a.normalizationType,p=l.getVVFlags(a.visualVariables);d=new c(a.field,f,{normalizationField:h,normalizationTotal:k,
normalizationType:m},g,d);f=a.backgroundFillSymbol;g=0;for(h=a.classBreakInfos;g<h.length;g++)k=h[g],m=e.createTemplateGroup(k.symbol,f,b,p),d.add({min:k.minValue,max:k.maxValue},m);if(a=a.defaultSymbol)b=e.createTemplateGroup(a,f,b,p),d.setDefault(b);return d};c.prototype.add=function(a,b){this._intervals.push({interval:a,result:b});this._intervals.sort(function(a,b){return a.interval.min-b.interval.min})};c.prototype.size=function(){return a.prototype.size.call(this)+this._intervals.length};c.prototype.match=
function(a,b,c){if(!this._getValue)return this.getDefault();a=this._getValue(a,b,c);if(!a&&(null===a||void 0===a||isNaN(a)))return this.getDefault();for(b=0;b<this._intervals.length;b++){var f=this._intervals[b];c=f.interval;var f=f.result,e=this._isMaxInclusive?a<=c.max:a<c.max;if(a>=c.min&&e)return f}return this.getDefault()};c.prototype._needsNormalization=function(){var a=this._normalizationInfo;return a&&(a.normalizationField||a.normalizationTotal||a.normalizationType)};c.prototype._getValueFromField=
function(a){var b=a.attributes[this._field];if(!this._needsNormalization())return b;var c=this._normalizationInfo,f=c.normalizationField,e=c.normalizationTotal,c=c.normalizationType;a=!!f&&a.attributes[f];if(c)switch(c){case "field":return(a||void 0)&&b/a;case "log":return Math.log(b)*Math.LOG10E;case "percent-of-total":return b/e*100;default:g.error("Found unknown normalization type: "+c)}else g.error("Normalization is required, but no type was set!")};return c}(h);a.IntervalMatcher=k;h=function(a){function c(c,
e,d,g){var f=a.call(this)||this;f._resultsMap=new Map;d?f._getValue=b.createArcadeFunction(d,g):c&&c.length?"function"===typeof c[0]?(f._fields=null,f._getValue=c[0]):(f._fields=c,f._seperator=e||"",f._getValue=f._getValueFromFields.bind(f)):f._fields=null;return f}d(c,a);c.fromUVRenderer=function(a,b,e,d){var f=a.uniqueValueInfos,g=l.getVVFlags(a.visualVariables),h=a.fieldDelimiter,k=a.valueExpression,m=[a.field];a.field2&&m.push(a.field2);a.field3&&m.push(a.field3);var p=a.backgroundFillSymbol;
d=new c(m,h,k,d);for(h=0;h<f.length;h++)k=f[h],m=e.createTemplateGroup(k.symbol,p,b,g),d.add(k.value,m);a.defaultSymbol&&(a=e.createTemplateGroup(a.defaultSymbol,p,b,g),d.setDefault(a));return d};c.prototype.add=function(a,b){this._resultsMap.set(a.toString(),b)};c.prototype.size=function(){return a.prototype.size.call(this)+this._resultsMap.size};c.prototype.match=function(a,b,c){if(!this._getValue)return this.getDefault();a=this._getValue(a,b,c);if(!a&&(null===a||void 0===a))return this.getDefault();
a=a.toString();return this._resultsMap.has(a)?this._resultsMap.get(a):this.getDefault()};c.prototype._getValueFromFields=function(a){for(var b=[],c=0,f=this._fields;c<f.length;c++)b.push(a.attributes[f[c]]);return b.join(this._seperator)};return c}(h);a.MapMatcher=h})},"esri/views/2d/engine/webgl/util/vvFlagUtils":function(){define(["require","exports","../enums","../visualVariablesUtils"],function(h,a,d,k){function b(a,b){void 0===b&&(b=!1);var c=d.WGLVVFlag.SIZE_FIELD_STOPS|d.WGLVVFlag.SIZE_MINMAX_VALUE|
d.WGLVVFlag.SIZE_SCALE_STOPS|d.WGLVVFlag.SIZE_UNIT_VALUE;a=(a&(d.WGLVVTarget.FIELD_TARGETS_OUTLINE|d.WGLVVTarget.MINMAX_TARGETS_OUTLINE|d.WGLVVTarget.SCALE_TARGETS_OUTLINE|d.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return b?c&a:c&~a}function l(a){var e=b(a,!1);return a&(d.WGLVVFlag.COLOR|d.WGLVVFlag.OPACITY|d.WGLVVFlag.ROTATION|e)}Object.defineProperty(a,"__esModule",{value:!0});a.getVVFlags=function(a){if(!a)return d.WGLVVFlag.NONE;for(var b=0,c=0;c<a.length;c++){var f=a[c];if("size"===f.type){var g=
k.getTypeOfSizeVisualVariable(f),b=b|g;"outline"===f.target&&(b|=g<<4)}else"color"===f.type?b|=d.WGLVVFlag.COLOR:"opacity"===f.type?b|=d.WGLVVFlag.OPACITY:"rotation"===f.type&&(b|=d.WGLVVFlag.ROTATION)}return b};a.getSizeFlagsMask=b;a.getMarkerVVFlags=l;a.getFillVVFlags=function(a){return a&(d.WGLVVFlag.COLOR|d.WGLVVFlag.OPACITY)};a.getLineVVFlags=function(a,e){if(e)return e=b(a,!0),a&e;e=b(a,!1);return a&(d.WGLVVFlag.COLOR|d.WGLVVFlag.OPACITY|e)};a.getTextVVFlags=function(a){return l(a)};a.getLabelVVFlags=
function(a){var e=b(a,!1);return a&e}})},"esri/views/2d/engine/webgl/visualVariablesUtils":function(){define("require exports ../../../../core/screenUtils ./color ./enums ./Utils ../../../3d/layers/support/FastSymbolUpdates".split(" "),function(h,a,d,k,b,l,g){function e(a){return l.isNumber(a.minDataValue)&&l.isNumber(a.maxDataValue)&&null!=a.minSize&&null!=a.maxSize?b.WGLVVFlag.SIZE_MINMAX_VALUE:(a.expression&&"view.scale"===a.expression||a.valueExpression&&"$view.scale"===a.valueExpression)&&Array.isArray(a.stops)?
b.WGLVVFlag.SIZE_SCALE_STOPS:(null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&Array.isArray(a.stops)?b.WGLVVFlag.SIZE_FIELD_STOPS:(null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&null!=a.valueUnit?b.WGLVVFlag.SIZE_UNIT_VALUE:b.WGLVVFlag.NONE}function c(a){return{value:a.value,size:d.toPt(a.size)}}function f(a){return a.map(function(a){return c(a)})}function m(a){return"string"===
typeof a||"number"===typeof a?d.toPt(a):{type:"size",expression:a.expression,stops:f(a.stops)}}function p(a){var b={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(l.isString(a.field))if(a.stops){if(8<a.stops.length)return null;var c=a.stops;for(a=0;8>a;++a){var f=c[Math.min(a,c.length-1)];b.values[a]=f.value;b.opacities[a]=f.opacity}}else return null;else if(a.stops&&0<=a.stops.length)for(c=a.stops&&0<=a.stops.length&&a.stops[0].opacity,a=0;8>a;a++)b.values[a]=Infinity,b.opacities[a]=c;
else return null;return b}Object.defineProperty(a,"__esModule",{value:!0});a.getTypeOfSizeVisualVariable=e;a.getVisualVariableSizeValueRepresentationRatio=function(a,b){if(!a||!b)return a;switch(b){case "radius":case "distance":return 2*a;case "area":return Math.sqrt(a)}return a};a.stopToSizeStop=c;a.normalizeSizeStops=f;a.normalizeSizeElement=m;a.getVisualVariablesFields=function(a){var b=a&&0<a.length?{}:null;b&&a.forEach(function(a){var c=a.type;a.field&&(b[c]=a.field)});return b};a.convertVisualVariables=
function(a){var c=a&&0<a.length?{}:null,h=c?{}:null;if(!c)return{vvFields:c,vvRanges:h};for(var l=0;l<a.length;l++){var t=a[l],x=t.type;t.field&&(c[x]=t.field);if("size"===x){h.size||(h.size={});var C=t;switch(e(C)){case b.WGLVVFlag.SIZE_MINMAX_VALUE:h.size.minMaxValue={minDataValue:C.minDataValue,maxDataValue:C.maxDataValue,minSize:m(C.minSize),maxSize:m(C.maxSize)};break;case b.WGLVVFlag.SIZE_SCALE_STOPS:h.size.scaleStops={stops:f(C.stops)};break;case b.WGLVVFlag.SIZE_FIELD_STOPS:for(var t=[],x=
[],C=f(C.stops),z=C.length,v=0;6>v;v++){var y=C[Math.min(v,z-1)];t.push(y.value);x.push(d.pt2px(y.size))}h.size.fieldStops={values:t,sizes:x};break;case b.WGLVVFlag.SIZE_UNIT_VALUE:h.size.unitValue={unit:C.valueUnit,valueRepresentation:C.valueRepresentation}}}else if("color"===x)for(t=g.convertVisualVariables([t],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null}),h.color=t.color,v=0;32>v;v+=4)k.premultiplyAlpha(h.color.colors,v,!0);else"opacity"===x?h.opacity=p(t):"rotation"===x&&
(h.rotation={type:t.rotationType})}return{vvFields:c,vvRanges:h}}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../../../../renderers/support/utils"],function(h,a,d,k){function b(a){return null!==a&&void 0!==a}function l(a){return"number"===typeof a}function g(a,b){a&&a.push(b)}function e(a,f,e,d,h){var m=a.minSize,p=a.maxSize;if(a.expression)return g(h,"Could not convert size info: expression not supported"),
!1;if(a.useSymbolValue)return a=d.symbolSize[e],f.minSize[e]=a,f.maxSize[e]=a,f.offset[e]=f.minSize[e],f.factor[e]=0,f.type[e]=1,!0;if(b(a.field)){if(b(a.stops)){if(2===a.stops.length&&l(a.stops[0].size)&&l(a.stops[1].size))return c(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,f,e),f.type[e]=1,!0;g(h,"Could not convert size info: stops only supported with 2 elements");return!1}if(l(m)&&l(p)&&b(a.minDataValue)&&b(a.maxDataValue))return c(m,p,a.minDataValue,a.maxDataValue,f,e),
f.type[e]=1,!0;if(null!=k.meterIn[a.valueUnit])return f.minSize[e]=-Infinity,f.maxSize[e]=Infinity,f.offset[e]=0,f.factor[e]=1/k.meterIn[a.valueUnit],f.type[e]=1,!0;"unknown"===a.valueUnit?g(h,"Could not convert size info: proportional size not supported"):g(h,"Could not convert size info: scale-dependent size not supported");return!1}if(!b(a.field)){if(a.stops&&a.stops[0]&&l(a.stops[0].size))return f.minSize[e]=a.stops[0].size,f.maxSize[e]=a.stops[0].size,f.offset[e]=f.minSize[e],f.factor[e]=0,f.type[e]=
1,!0;if(l(m))return f.minSize[e]=m,f.maxSize[e]=m,f.offset[e]=m,f.factor[e]=0,f.type[e]=1,!0}g(h,"Could not convert size info: unsupported variant of sizeInfo");return!1}function c(a,b,c,f,e,d){f=0<Math.abs(f-c)?(b-a)/(f-c):0;e.minSize[d]=0<f?a:b;e.maxSize[d]=0<f?b:a;e.offset[d]=a-c*f;e.factor[d]=f}function f(a,b,c,f){if(a.normalizationField||a.valueRepresentation)return g(f,"Could not convert size info: unsupported property"),null;var d=a.field;if(null!=d&&"string"!==typeof d)return g(f,"Could not convert size info: field is not a string"),
null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=a.field;else if(a.field!==b.size.field)return g(f,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(d=e(a,b.size,0,c,f))?b:null;case "height":return(d=e(a,b.size,2,c,f))?b:null;case "depth":return(d=e(a,b.size,1,c,f))?b:null;case "width-and-depth":return(d=e(a,b.size,0,c,f))&&e(a,b.size,1,c,f),d?
b:null;case null:case void 0:case "all":return(d=(d=(d=e(a,b.size,0,c,f))&&e(a,b.size,1,c,f))&&e(a,b.size,2,c,f))?b:null;default:return g(f,'Could not convert size info: unknown axis "'+a.axis+'""'),null}}function m(a,b,c){for(var f=0;3>f;++f){var e=b.unitInMeters;1===a.type[f]&&(e*=b.modelSize[f],a.type[f]=2);a.minSize[f]/=e;a.maxSize[f]/=e;a.offset[f]/=e;a.factor[f]/=e}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return g(c,"No size axis contains a valid size or scale"),
!1;for(f=0;3>f;++f)0===a.type[f]&&(a.minSize[f]=a.minSize[b],a.maxSize[f]=a.maxSize[b],a.offset[f]=a.offset[b],a.factor[f]=a.factor[b],a.type[f]=a.type[b]);return!0}function p(a,b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function x(a,b,c){if(a.normalizationField)return g(c,"Could not convert color info: unsupported property"),null;if("string"===typeof a.field)if(a.stops){if(8<a.stops.length)return g(c,"Could not convert color info: too many color stops"),null;b.color={field:a.field,
values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c=a.stops;for(a=0;8>a;++a){var f=c[Math.min(a,c.length-1)];b.color.values[a]=f.value;p(b.color.colors,a,f.color)}}else return g(c,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length)for(c=a.stops&&0<=a.stops.length&&a.stops[0].color,b.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a=0;8>
a;a++)b.color.values[a]=Infinity,p(b.color.colors,a,c);else return g(c,"Could not convert color info: no field and no colors/stops"),null;return b}function u(a,b,c,f){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;b.type[c]=1}function w(a,b,c){if("string"!==typeof a.field)return g(c,"Could not convert rotation info: field is not a string"),null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=
a.field;else if(a.field!==b.rotation.field)return g(c,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return u(a,b.rotation,0,c),b;case "roll":return u(a,b.rotation,1,c),b;case null:case void 0:case "heading":return u(a,b.rotation,2,c),b;default:return g(c,'Could not convert rotation info: unknown axis "'+a.axis+'""'),null}}function r(a,b,c){if(!a)return null;var e=!b.supportedTypes||!!b.supportedTypes.size,d=!b.supportedTypes||!!b.supportedTypes.color,h=
!b.supportedTypes||!!b.supportedTypes.rotation;return(a=a.reduce(function(a,k){if(!a)return a;if(k.valueExpression)return g(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(k.type){case "size":return e?f(k,a,b,c):a;case "color":return d?x(k,a,c):a;case "rotation":return h?w(k,a,c):a;default:return g(c,"Could not convert visual variables: unsupported type "+k.type),null}},{size:null,color:null,rotation:null}))&&a.size&&!m(a.size,b,c)?null:a}function t(a,b,c){if(!!a!==
!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function A(a,b){var c={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},f=a&&null!=a.size;a&&a.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=a.size.minSize,c.vvSizeMaxSize=a.size.maxSize,
c.vvSizeOffset=a.size.offset,c.vvSizeFactor=a.size.factor):a&&f&&(c.vvSizeValue=b.transformation.scale);a&&f&&(c.vvSymbolAnchor=b.transformation.anchor,c.vvSymbolRotation=b.transformation.rotation);a&&a.color&&(c.vvColorEnabled=!0,c.vvColorValues=a.color.values,c.vvColorColors=a.color.colors);return c}Object.defineProperty(a,"__esModule",{value:!0});a.convertVisualVariables=r;a.initFastSymbolUpdatesState=function(a,b){return!a||a.disableFastUpdates?{enabled:!1}:(a=r(a.visualVariables,b))?{enabled:!0,
visualVariables:a,materialParameters:A(a,b),requiresShaderTransformation:a&&null!=a.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(a,b,c){if(!b||!a.enabled)return!1;var f=a.visualVariables;b=r(b.visualVariables,c);if(!(b&&t(f.size,b.size,"size")&&t(f.color,b.color,"color")&&t(f.rotation,b.rotation,"rotation")))return!1;a.visualVariables=b;a.materialParameters=A(b,c);a.requiresShaderTransformation=b&&null!=b.size;return!0};a.getMaterialParams=A;var C;(function(a){function b(a,b,c){return a<
b?b:a>c?c:a}var c=d.mat4f64.create(),f=d.vec3f64.create();a.evaluateModelTransform=function(a,e,g){if(!a.vvSizeEnabled)return g;d.mat4.copy(c,g);var h=a.vvSymbolRotation[2],k=a.vvSymbolRotation[0],l=a.vvSymbolRotation[1];g=c;void 0===g&&(g=d.mat4f64.create());h=h||0;k=k||0;l=l||0;0!==h&&d.mat4.rotateZ(g,g,-h/180*Math.PI);0!==k&&d.mat4.rotateX(g,g,k/180*Math.PI);0!==l&&d.mat4.rotateY(g,g,l/180*Math.PI);for(g=0;3>g;++g)f[g]=b(a.vvSizeOffset[g]+e[0]*a.vvSizeFactor[g],a.vvSizeMinSize[g],a.vvSizeMaxSize[g]);
d.mat4.scale(c,c,f);d.mat4.translate(c,c,a.vvSymbolAnchor);return c};a.evaluateModelTransformScaleFactor=function(a,c){if(!a.vvSizeEnabled)return 1;for(var f=-Infinity,e=0;3>e;++e)f=Math.max(f,b(a.vvSizeOffset[e]+c[0]*a.vvSizeFactor[e],a.vvSizeMinSize[e],a.vvSizeMaxSize[e]));return f}})(C||(C={}));a.evaluateModelTransform=C.evaluateModelTransform;a.evaluateModelTransformScaleFactor=C.evaluateModelTransformScaleFactor})},"esri/views/2d/engine/webgl/mesh/factories/WGLMeshFactory":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../geometry/support/jsonUtils ../../../../../../symbols/SimpleLineSymbol ../../definitions ../../enums ../../WGLDisplayObject ../../collisions/LayerCollisionInfo ../MeshData ../VertexVector ./VVFactory ../templates/WGLLabelTemplate ../templates/WGLLineTemplate ../templates/WGLMarkerTemplate ../../util/vvFlagUtils".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w,r,t,A){Object.defineProperty(a,"__esModule",{value:!0});var C=b.getLogger("esri.views.2d.engine.webgl.WGLMeshFactory"),z={esriGeometryPoint:"above-right above-center above-left center-center center-left center-right below-center below-left below-right".split(" "),esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null,esriGeometryEnvelope:null};h=function(){function a(a,b,c,f,d,g,h,l,p,r){var t=this;this._labelsDebugVVEval=
this._labelsDebugTemplate=null;this._materials=h;this._geometryType=a;this._idField=b;this._pixelRatio=d;this._vvFlags=A.getVVFlags(c);this._vvFactory=new u.default(c,f);this._vvBuf=new ArrayBuffer(16);this._vvBufU32=new Uint32Array(this._vvBuf);this._vvBufF32=new Float32Array(this._vvBuf);this._templateStore=l;if(p)if(e.DEBUG_LABELS&&(this._labelsDebugVVEval=c&&m.createLabelVVEvaluator(c)),this._validateLabelingInfo(p)){var v=A.getLabelVVFlags(this._vvFlags);this._labelTemplates=p.map(function(a){return w.default.fromLabelClass(t._materials,
v,a,d,r)})}else C.error(new k("mapview-labeling:unsupported-geometry","LabelingInfo failed validation - unable to create labels for layer."))}Object.defineProperty(a.prototype,"materials",{get:function(){return this._materials},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"templates",{get:function(){return this._templateStore},enumerable:!0,configurable:!0});a.prototype.createMeshData=function(a){var b=Array(5),f=!!A.getMarkerVVFlags(this._vvFlags),d=!!A.getFillVVFlags(this._vvFlags),
g=!!A.getLineVVFlags(this._vvFlags,"esriGeometryPolyline"!==this._geometryType),h=!!A.getTextVVFlags(this._vvFlags),k="esriGeometryPolyline"===this._geometryType?e.HEURISTIC_GLYPHS_PER_LINE:e.HEURISTIC_GLYPHS_PER_FEATURE;b[c.WGLGeometryType.MARKER]=new x.VertexVectors(c.WGLGeometryType.MARKER,f,a);b[c.WGLGeometryType.FILL]=new x.VertexVectors(c.WGLGeometryType.FILL,d,a);b[c.WGLGeometryType.LINE]=new x.VertexVectors(c.WGLGeometryType.LINE,g,a);b[c.WGLGeometryType.TEXT]=new x.VertexVectors(c.WGLGeometryType.TEXT,
h,a);b[c.WGLGeometryType.LABEL]=new x.VertexVectors(c.WGLGeometryType.LABEL,!1,this._labelTemplates&&0<this._labelTemplates.length?k:0);return new p.default([],b,this._materials)};a.prototype.analyze=function(a,b,c,f){for(var e=0;e<a.length;e++){var d=a[e],g=-1;null!=d.symbol?g=this._templateStore.createTemplateGroup(d.symbol,null,this._materials,0):b&&(g=b.match(d,c,f));d.groupId=g}return this._templateStore.finalize().then(function(){return a})};a.prototype.write=function(a,b,c,e,d,g,h){var k=this._templateStore.getTemplateGroup(b.groupId),
m=b.attributes[this._idField],p=new f(m),u=!!g&&!!this._labelTemplates&&g.has(m);if(k&&(b.geometry||b.centroid)){this._vvFactory.computeVV(this._vvBufF32,b,c,e);e=p.displayRecords;c=b.insertAfter;void 0!==c&&(p.insertAfter=c);(c=this._geometryType)||(c=null!=b.centroid?"esriGeometryPolygon":l.getJsonType(b.geometry));for(var r=0;r<k.length;r++){var w=k[r],t=a.get(w.geometryType);w.writeMesh(e,t,c,m,b,this._pixelRatio,this._vvBufU32)}u&&(k=this._getLabelReference(k),g=g.get(m),this._writeLabelMesh(p,
a,m,b,h,g,k,d,c));a.pushDisplayObject(p)}};a.prototype._hasBadLabelClass=function(a,b){var c=a.labelPlacement,f=z[b];if(!f)return C.error(new k("mapview-labeling:unsupported-geometry-type","Unable to create labels for WebGL Feature Layer, "+b+" is not supported")),!0;f.some(function(a){return a===c})||(f=f[0],c&&C.warn("Found invalid label placement type "+c+" for "+b+". Defaulting to "+f),a.labelPlacement=f);return!1};a.prototype._validateLabelingInfo=function(a){var b=this;return!a.some(function(a){return b._hasBadLabelClass(a,
b._geometryType)})};a.prototype._getLabelReference=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c instanceof t.default)return c}return null};a.prototype._writeLabelMesh=function(a,b,c,f,d,g,h,k,l){for(var m=a.displayRecords,p=[],u=this._pixelRatio,r=this._vvBufU32,w=0;w<g.length;w++){var t=g[w],v=t.text,x=t.rtl,t=this._labelTemplates[t.id],H=b.get(t.geometryType),y=d.get(t.symbolId).glyphMosaicItems;t.bindReferenceTemplate(h);t.bindTextInfo(y,v,x);t.writeMesh(m,H,l,c,f,u,r,k,p)}a.metrics=
p;e.DEBUG_LABELS&&this._debugLabels(a,b)};a.prototype._debugLabels=function(a,b){var c=a.displayRecords,f=a.id,e=0;for(a=a.metrics;e<a.length;e++){var d=a[e],g=d.boxes?d.boxes.concat([d.bounds]):[d.bounds];this._labelsDebugVVEval&&d.computeOffset(this._labelsDebugVVEval);for(var h=0;h<g.length;h++){var k=g[h],k={geometry:{paths:[[[d.anchor[0]+d.offsetX+k.center[0]-k.width/2,d.anchor[1]+d.offsetY+k.center[1]+k.height/2],[0,-k.height],[k.width,0],[0,k.height],[-k.width,0]]]},attributes:{}},l=this._getLabelDebugTemplate(),
m=b.get(l.geometryType);l.writeMesh(c,m,"esriGeometryPolyline",f,k,this._pixelRatio,null)}}};a.prototype._getLabelDebugTemplate=function(){this._labelsDebugTemplate||(this._labelsDebugTemplate=this._createLabelsDebugTemplate());return this._labelsDebugTemplate};a.prototype._createLabelsDebugTemplate=function(){var a=new g({style:"solid",width:1,color:[255,0,0,1]});return r.default.fromSimpleLine(this._materials,0,a,null,this._pixelRatio)};return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["require",
"exports","../util/serializationUtils","../util/Writer"],function(h,a,d,k){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,b,e){this.displayObjects=a;this.vertexVectorsMap=b;this._materials=e}Object.defineProperty(a.prototype,"materials",{get:function(){return this._materials},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexBuffersMap",{get:function(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(var a=0;a<this.vertexVectorsMap.length;a++)this._vertexBuffersMap[a]=
this.vertexVectorsMap[a].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap},enumerable:!0,configurable:!0});a.prototype.get=function(a){return this.vertexVectorsMap[a]};a.prototype.pushDisplayObject=function(a){this.displayObjects.push(a)};a.prototype.encode=function(a,b){var e=d.serializeList(new k.default(Uint32Array,this._guessSize()),this.displayObjects).buffer(),c=this._materials.serialize(new k.default(Uint32Array)).buffer(),f={};b.push(e);b.push(c);for(var g=0;g<this.vertexVectorsMap.length;g++){var h=
this.vertexVectorsMap[g];f[g]={};h.transfer(f[g],b)}a.displayObjects=e;a.materialStore=c;a.vertexBuffersMap=f;this.destroy()};a.prototype.destroy=function(){this.displayObjects=this.vertexVectorsMap=null};a.prototype._guessSize=function(){for(var a=this.displayObjects,b=Math.min(a.length,4),e=0,c=0;c<b;c++)e=Math.max(e,a[c].displayRecords.length);return 2*(12*a.length+a.length*e*40)};return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/VertexVector":function(){define(["require","exports","../Utils",
"./VertexBuffer","../util/Writer"],function(h,a,d,k,b){Object.defineProperty(a,"__esModule",{value:!0});var l=function(){function a(a,b){this.data=a;this.stride=b;this.vertexCount=0}a.prototype.transfer=function(a,b){var c=this.data.buffer();a.vertexCount=this.vertexCount;a.data=c;a.stride=this.stride;b.push(c)};return a}();a.default=l;h=function(){function a(a,c,f){this.geometryType=a;this.indexVector=new b.default(Uint32Array,f);this.namedVectors={};a=d.getStrides(a,c);for(var e in a){c=a[e];var g=
void 0;switch(c%4){case 0:case 2:g=new b.default(Uint32Array,c/4*f);break;case 1:case 3:g=new b.default(Uint8Array,c*f)}this.namedVectors[e]=new l(g,c)}}a.prototype.get=function(a){return this.namedVectors[a].data};a.prototype.transfer=function(a,b){var c=this.indexVector.buffer(),e={};b.push(c);for(var d in this.namedVectors){var g=this.namedVectors[d];e[d]={};g.transfer(e[d],b)}a.geometryType=this.geometryType;a.indexBuffer=c;a.namedBuffers=e;this.destroy()};a.prototype.intoBuffers=function(){var a=
k.VertexBuffers.fromVertexVectors(this);this.destroy();return a};a.prototype.destroy=function(){this.namedVectors=this.indexVector=null};return a}();a.VertexVectors=h})},"esri/views/2d/engine/webgl/mesh/factories/VVFactory":function(){define("require exports ../../../../../../core/Error ../../../../../../core/Logger ../../enums ../../Utils ../../visualVariablesUtils".split(" "),function(h,a,d,k,b,l,g){Object.defineProperty(a,"__esModule",{value:!0});var e=k.getLogger("esri.views.2d.engine.webgl.mesh.VVFactory"),
c;(function(a){a[a.NONE=0]="NONE";a[a.MISSING_DATA=1]="MISSING_DATA"})(c=a.VVError||(a.VVError={}));var f=function(){function a(){this._vvMap=new Map}a.prototype.set=function(a,b){this._vvMap.set(a,b)};a.prototype.getValue=function(a,b,c,f){return this._vvMap.has(a)?this._vvMap.get(a)(b,c,f):0};return a}();h=function(){function a(a,b){this._createVVFunctionMap(a,b)}a.prototype.computeVV=function(a,f,e,d){if(!this._vvMap)return c.NONE;var g=this._vvMap.getValue(b.VVType.SIZE,f,e,d),h=this._vvMap.getValue(b.VVType.COLOR,
f,e,d),k=this._vvMap.getValue(b.VVType.OPACITY,f,e,d);f=this._vvMap.getValue(b.VVType.ROTATION,f,e,d);a[b.VVType.SIZE]=this._isErrorVV(g)?1E-30:g;a[b.VVType.COLOR]=this._isErrorVV(h)?1E-30:h;a[b.VVType.OPACITY]=this._isErrorVV(k)?1E-30:k;a[b.VVType.ROTATION]=this._isErrorVV(f)?1E-30:f;return c.NONE};a.prototype._isErrorVV=function(a){return null===a||isNaN(a)||Infinity===a};a.prototype._createVVFunctionMap=function(a,b){if(a&&a.length)for(var c=0;c<a.length;c++){var e=a[c],d=l.getVVType(e.type);if(e=
this._createGetValueFunction(e,b))this._vvMap||(this._vvMap=new f),this._vvMap.set(d,e)}};a.prototype._createGetValueFunction=function(a,c){if(l.getVVType(a.type)===b.VVType.SIZE){var f=g.getTypeOfSizeVisualVariable(a);return f===b.WGLVVFlag.SIZE_SCALE_STOPS?null:this._createNormalizedFunction(a,c,f===b.WGLVVFlag.SIZE_UNIT_VALUE&&function(b){return g.getVisualVariableSizeValueRepresentationRatio(b,a.valueRepresentation)})}return this._createNormalizedFunction(a,c)};a.prototype._createNormalizedFunction=
function(a,b,c){var f=a.field;if(f){if("string"===typeof f){var g=a.normalizationField;return g?function(a){if(a.attributes[f]&&a.attributes[g])return a=a.attributes[f]/a.attributes[g],c?c(a):a}:c?function(a){return c(a.attributes[f])}:function(a){return a.attributes[f]}}if("function"===typeof f)return e.error(new d("mapview-rendering:unsupported-feature","Function field types are not currently supported. Please use a valueExpression instead")),function(a){};e.error(new d("mapview-rendering:invalid-type",
"The field for a vv must be a string or a number, but got "+typeof f));return function(a){}}if(a.valueExpression)return l.createArcadeFunction(a.valueExpression,b,c);e.error("Unable to create a normalized function for visual variable: "+a);return function(a){}};return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/templates/WGLLabelTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/libs/gl-matrix-2/gl-matrix ../../definitions ../../enums ../../number ../../TextShaping ../../Utils ../../collisions/Metric ./GlyphGroup ./util ./WGLTextTemplate ../../util/vvFlagUtils ../../../../../3d/support/mathUtils ../../../../../vectorTiles/GeometryUtils".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w,r,t,A){function C(a){switch(a){case "above-left":return[-1,-1];case "above-center":case "above-along":return[0,-1];case "above-right":return[1,-1];case "center-left":return[-1,0];case "center-center":case "center-along":return[0,0];case "center-right":return[1,0];case "below-left":return[-1,1];case "below-center":case "below-along":return[0,1];case "below-right":return[1,1];case "always-horizontal":return[0,0];default:G("Found invalid placement type "+a)}}Object.defineProperty(a,
"__esModule",{value:!0});var z=b.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),v=c.i8888to32(255,255,255,255),y=l.vec2f32.create(),D=l.mat2df32.create(),F={xOffset:0,yOffset:0,width:0,height:0},G=function(a,b){void 0===b&&(b="mapview-labeling");return z.error(new k(b,a))};h=function(a){function b(b,c,f,d,g,h){b=a.call(this,b,c,f)||this;b.geometryType=e.WGLGeometryType.LABEL;b._refTemplate=F;a:switch(d){case "above-along":case "below-along":case "center-along":c=1;break a;default:c=0}var k=
C(d);d=k[0];k=k[1];b._justify=(-1*d+1)/2;b._xAlignD=d;b._yAlignD=k;b._xPlacementD=d;b._yPlacementD=k;b._minZoom=g;b._maxZoom=h;b.vvFlags|=c*e.WGLVVFlag.ROTATION;f=f.font.decoration.toLowerCase();"underline"===f?b._decorationTop=6:"line-through"===f&&(b._decorationTop=-5);return b}d(b,a);b.fromLabelClass=function(a,c,f,e,d){e=f.symbol;var g;g=!!f.minScale&&d.scaleToZoom(f.minScale)||0;g=t.clamp(g,0,25.5);d=!!f.maxScale&&d.scaleToZoom(f.maxScale)||255;d=t.clamp(d,0,25.5);return new b(a,c,e,f.labelPlacement,
g,d)};b.prototype.bindTextInfo=function(a,b,c){a=this._computeShaping(a,this._justify).getShaping(b,c);isNaN(this._decorationTop)||f.addDecoration(a,this._decorationTop);this._shapedGlyphs=a;this._shapedBox=f.getBox(a)};b.prototype._computeShaping=function(a,b){return new f([a],g.TEXT_MAX_WIDTH,g.TEXT_LINE_HEIGHT,g.TEXT_SPACING,[0,0],.5,.5,b)};Object.defineProperty(b.prototype,"bounds",{get:function(){return this._bounds},enumerable:!0,configurable:!0});b.prototype.bindReferenceTemplate=function(a){this._refTemplate=
a||F};b.prototype._placeGlyphs=function(a,b,c,f){var e=this._size,d=this._haloSize,g=this._shapedBox,h=this._shapedGlyphs,k=this._computeGlyphTransform(g);if("esriGeometryPolyline"!==a)for(var l=0;l<c.length;l++)for(var m=c[l],p=0,u=h;p<u.length;p++){var r=u[p],w=this._materialStore.createGlyphMaterial(r.glyphMosaicItem,this.geometryType,this.vvFlags);m.place(r,a,b,k,w,e,d,g,f,this._minZoom,this._maxZoom)}else for(l=0;l<c.length;l++)for(var m=c[l],w=r=m.order,p=w-(w-1)/2-1,u=p-(p-1)/2-1,v=u-(u-1)/
2-1,r=-1===r?0:w%2?p%2?u%2?v%2?0:f-3.1:f-2.1:f-1.1:f-.1,p=Math.max(f+t.log2((this._shapedBox.width*this._scale+48)/m.pathLen),Math.max(r,this._minZoom)),u=0,v=h;u<v.length;u++)r=v[u],w=this._materialStore.createGlyphMaterial(r.glyphMosaicItem,this.geometryType,this.vvFlags),m.place(r,a,b,k,w,e,d,g,f,p,this._maxZoom)};b.prototype.writeMesh=function(a,b,f,d,h,k,l,m,u){var w=this,t=this._computeAnchors(f,h);if(t.length&&this._shapedGlyphs.length)if(this._placeGlyphs(f,h,t,m),"esriGeometryPolyline"!==
f){f=t[0];h=this._computeGlyphTransform(this._shapedBox);h=this._createBounds(this._shapedBox,h);k=f.glyphs.get(0);var v=k[0];m=v.anchorX;var x=v.anchorY,P=Math.floor(10*v.minZoom),v=Math.floor(10*v.maxZoom),Q=a.length;k.forEach(function(a){a.minZoom=25.5;a.maxZoom=25.5});this._writeVertices(a,b,d,l,k,P,v);k=new p.default(d,{from:Q,count:a.length-Q},m,x,P);m=Math.max(this._refTemplate.height,this._refTemplate.width);x=r.getSizeFlagsMask(this.vvFlags,!1);this.vvFlags&x?k.setVV(c.toFloat32(l[e.VVType.SIZE]),
m,this._xPlacementD,this._yPlacementD):(k.offsetX=(m/2+g.COLLISION_PLACEMENT_PADDING)*this._xPlacementD,k.offsetY=(m/2+g.COLLISION_PLACEMENT_PADDING)*this._yPlacementD);k.bounds=h;u.push(k);f.clear()}else{f=function(c){var f=t[c],e=f.x,g=f.y;c=a.length;var h=new p.default(d,{from:c,count:-1},e,g,25.5);f.glyphs.forEach(function(c){for(var k=0;k<c.length;k++){var m=c[k];m.minZoom=Math.max(f.minZoom,m.minZoom);if(m.bounds){var p=m.anchorY-g;m.bounds.center[0]+=m.anchorX-e;m.bounds.center[1]+=p;h.add(m.bounds)}}h.bounds&&
w._writeHalos(a,b,d,l,c)});f.glyphs.forEach(function(c){h.bounds&&w._writeText(a,b,d,l,c)});h.range.count=a.length-c;h.bounds&&u.push(h);f.clear()};for(h=0;h<t.length;h++)f(h);this._computedGlyphs=[]}};b.prototype._outsideTile=function(a,b){return 0>a||512<=a||0>b||512<=b};b.prototype._smoothVertices=function(a,b){if(!(0>=b)){var c=a.length;if(!(3>c)){var f=[],e=0;f.push(0);for(var d=1;d<c;d++)e+=u.dist(a[d],a[d-1]),f.push(e);b=Math.min(b,.2*e);e=[];e.push(a[0][0]);e.push(a[0][1]);var g=a[c-1][0],
h=a[c-1][1],d=u.sub([0,0],a[0],a[1]);u.normalize(d);a[0][0]+=b*d[0];a[0][1]+=b*d[1];u.sub(d,a[c-1],a[c-2]);u.normalize(d);a[c-1][0]+=b*d[0];a[c-1][1]+=b*d[1];for(d=1;d<c;d++)f[d]+=b;f[c-1]+=b;for(var k=.5*b,d=1;d<c-1;d++){for(var l=0,m=0,p=0,r=d-1;0<=r&&!(f[r+1]<f[d]-k);r--){var w=k+f[r+1]-f[d],t=f[r+1]-f[r],v=f[d]-f[r]<k?1:w/t;if(1E-6>Math.abs(v))break;var x=v*v,y=v*w-.5*x*t,A=v*t/b,H=a[r+1],z=a[r][0]-H[0],E=a[r][1]-H[1],l=l+A/y*(H[0]*v*w+.5*x*(w*z-t*H[0])-x*v*t*z/3),m=m+A/y*(H[1]*v*w+.5*x*(w*E-
t*H[1])-x*v*t*E/3),p=p+A}for(r=d+1;r<c&&!(f[r-1]>f[d]+k);r++){w=k-f[r-1]+f[d];t=f[r]-f[r-1];v=f[r]-f[d]<k?1:w/t;if(1E-6>Math.abs(v))break;x=v*v;y=v*w-.5*x*t;A=v*t/b;H=a[r-1];z=a[r][0]-H[0];E=a[r][1]-H[1];l+=A/y*(H[0]*v*w+.5*x*(w*z-t*H[0])-x*v*t*z/3);m+=A/y*(H[1]*v*w+.5*x*(w*E-t*H[1])-x*v*t*E/3);p+=A}e.push(l/p);e.push(m/p)}e.push(g);e.push(h);for(r=d=0;d<c;d++)a[d][0]=e[r++],a[d][1]=e[r++]}}};b.prototype._computeLineAnchors=function(a,b,c){b=b.paths;var f=this._scale*this._shapedBox.width;c=f/2+c;
for(var f=f/2+16,e=this._shapedBox.width*this._scale,d=0;d<b.length;d++){var g=b[d],h=[];h.push(g[0]);for(var k=1;k<g.length;k++){var l=h[k-1],m=l[0],l=l[1],m=m+g[k][0],l=l+g[k][1];h.push([m,l])}this._smoothVertices(h,e);g=[];g.push(h[0]);for(k=1;k<h.length;k++){var l=h[k-1],p=h[k],m=Math.round(p[0]-l[0]),l=Math.round(p[1]-l[1]);g.push([m,l])}b[d]=g;h=this._getPathLength(g);if(!(h<2*f))for(var k=h/2,r=0,p=g[0][0],u=g[0][1],w=1;w<g.length;w++){var m=g[w][0],l=g[w][1],t=Math.sqrt(m*m+l*l),r=r+t;if(0<=
r-k){var v=r-k,y=t-v,A=y/t,H=p+m*A,z=u+l*A;this._outsideTile(H,z)||(r=new x.default(H,z,A,d,w,p,u,t,h,-1),a.push(r));for(var E=-1,z=0,z=y-c;0<=z;z-=c){var A=z/t,H=p+m*A,C=u+l*A;E++;this._outsideTile(H,C)||(r=new x.default(H,C,A,d,w,p,u,t,h,E),a.push(r))}r=z+c;z=t-v;A=p;H=u;for(C=w-1;0!==C;C--){var J=g[C][0],K=g[C][1],I=Math.sqrt(J*J+K*K);if(r+I>=c){for(var G=r=c-r;G<I;G+=c){var F=G/I,D=A-J*F,S=H-K*F;E++;(r=G+z+f<k)&&!this._outsideTile(D,S)&&(r=new x.default(D,S,1-F,d,C,A-J,H-K,I,h,E),a.push(r))}r=
I-(G-c)}else r+=I;z+=I;A-=J;H-=K}E=-1;for(z=y+c;z<=t;z+=c)A=z/t,H=p+m*A,y=u+l*A,E++,this._outsideTile(H,y)||(r=new x.default(H,y,A,d,w,p,u,t,h,E),a.push(r));A=p+m;H=u+l;r=t-(z-c);z=v;for(C=w+1;C<g.length;C++){m=g[C][0];l=g[C][1];p=Math.sqrt(m*m+l*l);if(r+p>=c){for(u=r=c-r;u<p;u+=c)w=u/p,t=A+m*w,v=H+l*w,E++,(r=u+z+f<k)&&!this._outsideTile(t,v)&&(r=new x.default(t,v,w,d,C,A,H,p,h,E),a.push(r));r=p-(u-c)}else r+=p;z+=p;A+=m;H+=l}break}p+=m;u+=l}}return a};b.prototype._computeAnchors=function(a,b){var c=
[];switch(a){case "esriGeometryPoint":return b=b.geometry,a=b.x,b=b.y,a=new x.default(a,b),c.push(a),c;case "esriGeometryPolygon":if(b.centroid)return b=b.centroid,a=b.x,b=b.y,a=new x.default(a,b),c.push(a),c;G("Non-centroid polygon anchor placement not supported");break;case "esriGeometryPolyline":return this._computeLineAnchors(c,b.geometry,376);default:return G("Unable to handle geometryType: "+a),c}};b.prototype._getPathLength=function(a){for(var b=0,c=1;c<a.length;c++)var f=a[c][0],e=a[c][1],
b=b+Math.sqrt(f*f+e*e);return b};b.prototype._computeGlyphTransform=function(a){var b=this._scale,c=this._angle*A.C_DEG_TO_RAD,f=a.width/2,e=a.height/2,f=this._xAlignD*f*b+(this._xOffset+this._refTemplate.xOffset)+(a.x+f);a=this._yAlignD*e*b-(this._yOffset+this._refTemplate.yOffset)-(a.y+e);e=l.mat2d.identity(D);l.mat2d.translate(e,e,l.vec2.set(y,f,a));l.mat2d.scale(e,e,l.vec2.set(y,b,b));l.mat2d.rotate(e,e,c);return e};b.prototype._getOffset=function(a){return a.length/(m.C_LABEL_VERTEX_DEF[0].strideInBytes/
4)};b.prototype._writeVertex=function(a,b,f,d,g,h,k,l){f=b.get("geometry");k=b.get("visibility");b=b.get("visibilityRange");l=l&&l[e.VVType.SIZE]||1;this._refSymbolAndPlacementOffset=c.i8888to32(h.angle,Math.min(Math.floor(Math.max(this._refTemplate.width,this._refTemplate.height)),255),this._xPlacementD+1,this._yPlacementD+1);f.push(d);f.push(g);f.push(h.vertexOffsetUpperLeft);f.push(h.texFontSizeUpperLeft);f.push(this._refSymbolAndPlacementOffset);f.push(l);k.push(255);f.push(d);f.push(g);f.push(h.vertexOffsetUpperRight);
f.push(h.texFontSizeUpperRight);f.push(this._refSymbolAndPlacementOffset);f.push(l);k.push(255);f.push(d);f.push(g);f.push(h.vertexOffsetLowerLeft);f.push(h.texFontSizeLowerLeft);f.push(this._refSymbolAndPlacementOffset);f.push(l);k.push(255);f.push(d);f.push(g);f.push(h.vertexOffsetLowerRight);f.push(h.texFontSizeLowerRight);f.push(this._refSymbolAndPlacementOffset);f.push(l);k.push(255);b.push(v);b.push(v);a.vertexCount+=4};return b}(w.default);a.default=h})},"esri/views/2d/engine/webgl/TextShaping":function(){define(["require",
"exports","./Rect"],function(h,a,d){return function(){function a(a,d,g,e,c,f,h,k){this._glyphItems=a;this._maxWidth=d;this._lineHeight=g;this._letterSpacing=e;this._offset=c;this._hAnchor=f;this._vAnchor=h;this._justify=k}a.prototype.getShaping=function(a,d){for(var b=this._letterSpacing,e=this._lineHeight,c=this._justify,f=this._maxWidth,h=[],k=0,l=0,u=0,w=0,r=-1,t=0,A=-1,C=a.length,z=0;z<C;z++){var v=a.charCodeAt(z);if(10===v){if(z!==C-1){if(r>=w){var k=h[r],y=k.x+k.glyphMosaicItem.metrics.advance,
t=Math.max(y,t);c&&this._applyJustification(h,w,r);w=h.length}l=d?l-e:l+e;k=0;++u}}else{for(var y=void 0,D=0,F=this._glyphItems;D<F.length&&!(y=F[D][v]);D++);if(y){h.push({codePoint:v,x:k,y:l,glyphMosaicItem:y});k+=y.metrics.advance+b;if(0<f&&k>f&&0<=A){D=A+1;y=h[D].x;t=Math.max(y,t);for(F=D;F<h.length;F++)h[F].y=d?h[F].y-e:h[F].y+e,h[F].x-=y;c&&this._applyJustification(h,w,A);l=d?l-e:l+e;k-=y;++u;w=D;A=-1}++r;32===v&&(A=h.length-1)}}}r>=w&&(k=h[r],t=Math.max(t,k.x+k.glyphMosaicItem.metrics.advance),
c&&this._applyJustification(h,w,r));if(0<h.length)for(a=(c-this._hAnchor)*t,b=(-this._vAnchor*(u+1)+.5)*e,d&&u&&(b+=u*e),a+=this._offset[0],b+=this._offset[1],d=0;d<h.length;d++)e=h[d],e.x+=a,e.y+=b;return h};a.getBox=function(a){if(!a.length)return null;for(var b=Infinity,d=Infinity,e=0,c=0,f=0;f<a.length;f++)var h=a[f],k=h.glyphMosaicItem.metrics,x=k.height,u=h.x,h=h.y-(x-Math.abs(k.top)),k=u+k.width+k.left,x=h+x,b=Math.min(b,u),e=Math.max(e,k),d=Math.min(d,h),c=Math.max(c,x);return{x:b,y:d,width:e-
b,height:c-d}};a.addDecoration=function(a,h){var b=a.length;if(0!==b){for(var e=a[0].x+a[0].glyphMosaicItem.metrics.left,c=a[0].y,f=1;f<b;f++){var k=a[f];if(k.y!==c){var l=a[f-1].x+a[f-1].glyphMosaicItem.metrics.left+a[f-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:e,y:c+h-3,glyphMosaicItem:{rect:new d(4,0,4,8),metrics:{width:l-e,height:8,left:0,top:0,advance:0},page:0}});c=k.y;e=k.x+k.glyphMosaicItem.metrics.left}}b=a[b-1].x+a[b-1].glyphMosaicItem.metrics.left+a[b-1].glyphMosaicItem.metrics.width;
a.push({codePoint:0,x:e,y:c+h-3,glyphMosaicItem:{rect:new d(4,0,4,8),metrics:{width:b-e,height:8,left:0,top:0,advance:0},page:0}})}};a.prototype._applyJustification=function(a,d,g){for(var b=a[g],b=(b.x+b.glyphMosaicItem.metrics.advance)*this._justify;d<=g;d++)a[d].x-=b};return a}()})},"esri/views/2d/engine/webgl/mesh/templates/GlyphGroup":function(){define("require exports ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/libs/gl-matrix-2/gl-matrix ../../definitions ./ComputedGlyph ./util ../../../../../3d/support/mathUtils".split(" "),
function(h,a,d,k,b,l,g,e,c){Object.defineProperty(a,"__esModule",{value:!0});var f=k.getLogger("esri.views.2d.engine.webgl.GlyphGroup");h=function(){function a(a,b,c,f,e,d,g,h,k,l){void 0===c&&(c=0);void 0===f&&(f=-1);void 0===e&&(e=-1);void 0===d&&(d=-1);void 0===g&&(g=-1);void 0===h&&(h=-1);void 0===k&&(k=0);void 0===l&&(l=-1);this.x=a;this.y=b;this.t=c;this.i=f;this.j=e;this.segmentPosX=d;this.segmentPosY=g;this.segmentLen=h;this.pathLen=k;this.order=l;this._glyphs=new Map;this.minZoom=0}Object.defineProperty(a.prototype,
"glyphs",{get:function(){return this._glyphs},enumerable:!0,configurable:!0});a.prototype.add=function(a,b){var c=this._glyphs.get(b);c?c.push(a):this._glyphs.set(b,[a])};a.prototype.clear=function(){this._glyphs.clear()};a.prototype.place=function(a,b,c,e,h,k,l,m,z,v,y){var p=a.x,r=a.y,u=a.codePoint,w=a.glyphMosaicItem;switch(b){case "esriGeometryPoint":case "esriGeometryPolygon":a=g.default.from(p,r,this.x,this.y,-1,v,y,w,u,h,e,k,l);this.add(a,0);break;case "esriGeometryPolyline":b=c.geometry;this._placeGlyphAlongLine(a,
h,b,e,m,k,l,z,v,y,-1);this._placeGlyphAlongLine(a,h,b,e,m,k,l,z,v,y,1);break;case "esriGeometryMultipoint":case "esriGeometryEnvelope":a=void 0,void 0===a&&(a="mapview-labeling"),f.error(new d(a,"Cannot place for unsupported geometryType: "+b))}};a.prototype._findLabelTheta=function(a,b,c,f){b*=f;a=Math.acos((0*b+-1*f*-a)/(1*c));0<b&&(a=2*Math.PI-a);return a};a.prototype._placeGlyphAlongLine=function(a,f,d,h,k,m,A,C,z,v,y){d=d.paths[this.i];var p=d[this.j],r=p[0],u=p[1],p=a.x,w=a.y,t=a.glyphMosaicItem,
x=a.codePoint,I=a.glyphMosaicItem.metrics,I=(a.x+I.left+I.width/2)*m/24;a=y*c.sign(I)||1;var I=Math.abs(I),K=e.len(r,u),N=this._findLabelTheta(r,u,K,y),O=(a+1)/2,K=-a*(-1*O+this.t)*K,P=b.mat2d.rotate(b.mat2df32.create(),h,-N),Q=48<k.height;k=0===K?v:Math.max(Math.max(C+c.log2(Math.abs(I/K)),0),z);Q&&(k=z);v=g.default.from(p,w,this.x,this.y,N,k,v,t,x,f,P,m,A,Q||k<=C&&v>=C&&1===y);this.add(v,this.j);if(!Q)for(v=this.segmentPosX+O*r,r=this.segmentPosY+O*u,P=k,u=this.j+a;0<u&&u<d.length;u+=a){var R=v,
Z=r,O=d[u];k=O[0];var O=O[1],T=e.len(k,O),Q=this._findLabelTheta(k,O,T,y),Q=b.mat2d.rotate(b.mat2df32.create(),h,-Q),R=R+-a*k/T*K,Z=Z+-a*O/T*K,K=K+T,T=P-.1,P=0===K?T:Math.max(Math.max(C+c.log2(Math.abs(I/K)),0),z),Q=g.default.from(p,w,R,Z,N,P,T,t,x,f,Q,m,A,P<=C&&T>=C&&1===y);this.add(Q,u);if(P<C-l.COLLISION_MAX_ZOOM_DELTA){this.minZoom=Math.max(P,this.minZoom);break}v+=a*k;r+=a*O}};return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/templates/ComputedGlyph":function(){define("require exports ../../../../../../core/libs/gl-matrix-2/gl-matrix ../../definitions ../../number ../../collisions/BoundingBox".split(" "),
function(h,a,d,k,b,l){Object.defineProperty(a,"__esModule",{value:!0});var g=d.vec2f32.create();h=function(){function a(a,b,e,d,g,h,k,l,t,A,C,z,v,y,D){this.anchorX=a;this.anchorY=b;this.angle=e;this.bounds=d;this.minZoom=g;this.maxZoom=h;this.materialId=k;this.vertexOffsetUpperLeft=l;this.vertexOffsetUpperRight=t;this.vertexOffsetLowerLeft=A;this.vertexOffsetLowerRight=C;this.texFontSizeUpperLeft=z;this.texFontSizeUpperRight=v;this.texFontSizeLowerLeft=y;this.texFontSizeLowerRight=D}a.from=function(c,
f,e,h,x,u,w,r,t,A,C,z,v,y,D){void 0===y&&(y=!1);void 0===D&&(D=!1);var m=r.rect,p=r.metrics;x=-1===x?255:Math.floor(180*x/Math.PI/360*254);var E=Math.round(m.x/4),J=Math.round(m.y/4);r=E+Math.round(m.width/4);var H=J+Math.round(m.height/4),I=-24-p.top,K=p.left,N=-p.top,O=m.width,m=m.height;t||(D||(I=0),K=4,O=p.width);c+=K;t=D?f+N:f+I;O=c+O;I=t;f=c;N=t+m;m=O;D=N;var K=f+p.width,P=N-p.height,Q=p.width*z/24,p=p.height*z/24;C&&(d.vec2.transformMat2d(g,d.vec2.set(g,c,t),C),c=g[0],t=g[1],d.vec2.transformMat2d(g,
d.vec2.set(g,O,I),C),O=g[0],I=g[1],d.vec2.transformMat2d(g,d.vec2.set(g,f,N),C),f=g[0],N=g[1],d.vec2.transformMat2d(g,d.vec2.set(g,m,D),C),m=g[0],D=g[1],d.vec2.transformMat2d(g,d.vec2.set(g,K,P),C),K=g[0],P=g[1]);C=y?new l.default(K,P,Q+k.COLLISION_BOX_PADDING,p+k.COLLISION_BOX_PADDING):null;y=b.i1616to32(8*c,8*t);p=b.i1616to32(8*O,8*I);c=b.i1616to32(8*f,8*N);f=b.i1616to32(8*m,8*D);m=b.i8888to32(E,J,z,v);J=b.i8888to32(r,J,z,v);E=b.i8888to32(E,H,z,v);z=b.i8888to32(r,H,z,v);return new a(e|0,h|0,x,C,
u,w,A,y,p,c,f,m,J,E,z)};return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/templates/util":function(){define(["require","exports"],function(h,a){function d(a,b){return Math.sqrt(a*a+b*b)}Object.defineProperty(a,"__esModule",{value:!0});a.sub=function(a,b,d){a[0]=b[0]-d[0];a[1]=b[1]-d[1];return a};a.len=d;a.normalize=function(a){var b=d(a[0],a[1]);a[0]/=b;a[1]/=b};a.dist=function(a,b){return d(a[0]-b[0],a[1]-b[1])}})},"esri/views/2d/engine/webgl/mesh/templates/WGLTextTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/gl-matrix ../../color ../../definitions ../../enums ../../fontUtils ../../number ../../TextShapingNew ../../WGLDisplayRecord ../../collisions/BoundingBox ./ComputedGlyph ./WGLMeshTemplate ../../util/BidiText ../../../../layers/graphics/graphicsUtils ../../../../../vectorTiles/GeometryUtils".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w,r,t,A,C,z){Object.defineProperty(a,"__esModule",{value:!0});var v=b.getLogger("esri.views.2d.engine.webgl.WGLTextTemplate"),y=g.mat2df32.create(),D=g.vec2f32.create();h=function(a){function b(b,c,d){var g=a.call(this)||this;g.geometryType=f.WGLGeometryType.TEXT;g.vvFlags=0;g._xOffset=l.pt2px(d.xoffset);g._yOffset=l.pt2px(d.yoffset);g._decorationTop=m.getFontDecorationTop(d.font);g._color=(d.color&&e.premultiplyAlphaRGBA(d.color))|0;g._haloColor=(d.haloColor&&
e.premultiplyAlphaRGBA(d.haloColor))|0;g._haloSize=Math.min(Math.floor(5*l.pt2px(l.toPt(d.haloSize||0))),127);g._size=Math.min(Math.round(l.pt2px(d.font.size)),127);g._scale=g._size/24;g._angle=d.angle||0;g._justify=C.getJustification(d.horizontalAlignment||"center");g._xAlignD=C.getXAnchorDirection(d.horizontalAlignment||"center");g._yAlignD=-C.getYAnchorDirection(d.verticalAlignment||"baseline");g._baseline="baseline"===(d.verticalAlignment||"baseline");g._materialStore=b;g.vvFlags=c;g.symbolId=
d.id;return g}d(b,a);b.fromText=function(a,c,f,e,d){a=new b(a,c,f);f=A.bidiText(f.text);a.bindTextInfo(d,f[0],f[1]);a._computeGlyphs(a._shapedGlyphs,a._shapedBox);return a};b.prototype.bindTextInfo=function(a,b,c){a=this._computeShaping(a,this._justify).getShaping(b,c);isNaN(this._decorationTop)||x.addDecoration(a,this._decorationTop);this._shapedGlyphs=a;this._shapedBox=x.getBox(a)};b.prototype.writeMesh=function(a,b,c,f,e,d,g){d=this._computedGlyphs;switch(c){case "esriGeometryPoint":e=e.geometry;
c=e.x;e=e.y;for(var h=0;h<d.length;h++){var l=d[h];l.anchorX=c;l.anchorY=e}this._writeVertices(a,b,f,g,d,0,0);break;case "esriGeometryPolygon":if(e.centroid){e=e.centroid;c=e.x;e=e.y;for(h=0;h<d.length;h++)l=d[h],l.anchorX=c,l.anchorY=e;this._writeVertices(a,b,f,g,d,0,0);break}case "esriGeometryMultipoint":for(var h=e.geometry.points,m=e=c=0;m<h.length;m++){l=h[m];c+=l[0];e+=l[1];for(var p=0,r=d;p<r.length;p++)l=r[p],l.anchorX=c,l.anchorY=e;this._writeVertices(a,b,f,g,d,0,0)}break;default:a=void 0,
void 0===a&&(a="mapview-processing"),v.error(new k(a,"Unable to handle geometryType: "+c))}};b.prototype._computeGlyphs=function(a,b){var c=Array(a.length);b=this._computeGlyphTransform(b);for(var f=0;f<a.length;f++){var e=a[f],d=e.x,g=e.y,h=e.codePoint,e=e.glyphMosaicItem,k=this._materialStore.createGlyphMaterial(e,this.geometryType,this.vvFlags);c[f]=r.default.from(d,g,0,0,-1,0,25,e,h,k,b,this._size,this._haloSize,!1,!0)}this._computedGlyphs=c};b.prototype._createBounds=function(a,b){var f=a.width/
2,e=a.height/2,d=b[4],h=b[5],k;if(this._angle){a=g.vec2f32.fromValues(-f,-e);k=g.vec2f32.fromValues(f,-e);var l=g.vec2f32.fromValues(-f,e),m=g.vec2f32.fromValues(f,e);g.vec2.transformMat2d(a,a,b);g.vec2.transformMat2d(k,k,b);g.vec2.transformMat2d(l,l,b);g.vec2.transformMat2d(m,m,b);b=e=Infinity;var p=0,r=f=0;for(a=[a,k,l,m];r<a.length;r++)k=a[r],e=Math.min(k[0],e),p=Math.max(k[0],p),b=Math.min(k[1],b),f=Math.max(k[1],f);k=p-e;a=f-b}else k=a.width*this._scale,a=a.height*this._scale;return new w.default(d,
h,k+c.COLLISION_BOX_PADDING,a+c.COLLISION_BOX_PADDING)};b.prototype._computeShaping=function(a,b){return new x([a],c.TEXT_MAX_WIDTH,c.TEXT_LINE_HEIGHT,c.TEXT_SPACING,[0,.5*-c.TEXT_LINE_HEIGHT],.5*(1-this._xAlignD),0,b)};b.prototype._computeGlyphTransform=function(a){var b=this._scale,c=this._angle*z.C_DEG_TO_RAD,f=g.mat2d.identity(y);g.mat2d.rotate(f,f,c);g.mat2d.translate(f,f,g.vec2.set(D,this._xOffset,-this._yOffset));g.mat2d.scale(f,f,g.vec2.set(D,b,b));g.mat2d.translate(f,f,g.vec2.set(D,-4,-4-
(this._baseline?25:a.y+(1-this._yAlignD)*a.height*.5)));return f};b.prototype._getOffset=function(a){return a.length/(this.vvFlags?9:5)};b.prototype._writeVertices=function(a,b,c,f,e,d,g){this._writeHalos(a,b,c,f,e,d,g);this._writeText(a,b,c,f,e,d,g)};b.prototype._writeHalos=function(a,b,c,f,e,d,g){var h=b.indexVector,k=b.get("geometry"),k=this._getOffset(k),l=0;if(this._haloSize)for(var m=0;m<e.length;m++,l+=4){var r=e[m],w=p.i1616to32(2*r.anchorX+1,2*r.anchorY),t=e[m].materialId,v=this._materialStore.get(t),
t=new u(c,this.geometryType,t,null==d?Math.floor(10*r.minZoom):d,null==g?Math.floor(10*r.maxZoom):g);t.vertexFrom=k+l;t.indexFrom=h.length;this._writeVertex(t,b,c,w,this._haloColor,r,v,f);this._writeIndices(t,h,k+l);a.push(t)}};b.prototype._writeText=function(a,b,c,f,e,d,g){for(var h=b.indexVector,k=b.get("geometry"),k=this._getOffset(k),l=0,m=0;m<e.length;m++,l+=4){var r=e[m],w=p.i1616to32(2*r.anchorX,2*r.anchorY),t=e[m].materialId,v=this._materialStore.get(t),t=new u(c,this.geometryType,t,null==
d?Math.floor(10*r.minZoom):d,null==g?Math.floor(10*r.maxZoom):g);t.vertexFrom=k+l;t.indexFrom=h.length;this._writeVertex(t,b,c,w,this._color,r,v,f);this._writeIndices(t,h,k+l);a.push(t)}};b.prototype._writeVertex=function(a,b,c,f,e,d,g,h){var k=b.get("geometry");b=b.get("visibility");k.push(f);k.push(c);k.push(e);k.push(d.vertexOffsetUpperLeft);k.push(d.texFontSizeUpperLeft);this._writeVV(k,h,g);b.push(255);k.push(f);k.push(c);k.push(e);k.push(d.vertexOffsetUpperRight);k.push(d.texFontSizeUpperRight);
this._writeVV(k,h,g);b.push(255);k.push(f);k.push(c);k.push(e);k.push(d.vertexOffsetLowerLeft);k.push(d.texFontSizeLowerLeft);this._writeVV(k,h,g);b.push(255);k.push(f);k.push(c);k.push(e);k.push(d.vertexOffsetLowerRight);k.push(d.texFontSizeLowerRight);this._writeVV(k,h,g);b.push(255);a.vertexCount+=4};b.prototype._writeVV=function(a,b,c){c.materialKeyInfo.hasVV()&&(a.push(b[f.VVType.SIZE]),a.push(b[f.VVType.COLOR]),a.push(b[f.VVType.OPACITY]),a.push(b[f.VVType.ROTATION]))};b.prototype._writeIndices=
function(a,b,c){b.push(c+0);b.push(c+1);b.push(c+2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return b}(t.default);a.default=h})},"esri/views/2d/engine/webgl/TextShapingNew":function(){define(["require","exports","./Rect"],function(h,a,d){return function(){function a(a,d,g,e,c,f,h,k){this._glyphItems=a;this._maxWidth=d;this._lineHeight=g;this._letterSpacing=e;this._offset=c;this._hAnchor=f;this._vAnchor=h;this._justify=k}a.prototype.getShaping=function(a,d){for(var b=this._letterSpacing,
e=this._lineHeight,c=this._justify,f=this._maxWidth,h=[],k=0,l=0,u=0,w=0,r=-1,t=0,A=-1,C=a.length,z=0;z<C;z++){var v=a.charCodeAt(z);if(10===v){if(z!==C-1){if(r>=w){var k=h[r],y=k.x+k.glyphMosaicItem.metrics.advance,t=Math.max(y,t);c&&this._applyJustification(h,w,r);w=h.length}l=d?l-e:l+e;k=0;++u}}else{for(var y=void 0,D=0,F=this._glyphItems;D<F.length&&!(y=F[D][v]);D++);if(y){h.push({codePoint:v,x:k,y:l,glyphMosaicItem:y});k+=y.metrics.advance+b;if(0<f&&k>f&&0<=A){D=A+1;y=h[D].x;t=Math.max(y,t);
for(F=D;F<h.length;F++)h[F].y=d?h[F].y-e:h[F].y+e,h[F].x-=y;c&&this._applyJustification(h,w,A);l=d?l-e:l+e;k-=y;++u;w=D;A=-1}++r;32===v&&(A=h.length-1)}}}r>=w&&(k=h[r],t=Math.max(t,k.x+k.glyphMosaicItem.metrics.advance),c&&this._applyJustification(h,w,r));if(0<h.length)for(a=(c-this._hAnchor)*t,b=(-this._vAnchor*(u+1)+.5)*e,d&&u&&(b+=u*e),a+=this._offset[0],b+=this._offset[1],d=0;d<h.length;d++)e=h[d],e.x+=a,e.y+=b;return h};a.getBox=function(a){if(!a.length)return null;for(var b=Infinity,d=Infinity,
e=-Infinity,c=-Infinity,f=0;f<a.length;f++)var h=a[f],k=h.glyphMosaicItem.metrics,x=h.x+k.left,h=h.y-k.top,u=x+k.width,k=h+k.height,b=Math.min(b,x),e=Math.max(e,u),d=Math.min(d,h),c=Math.max(c,k);return{x:b,y:d,width:e-b,height:c-d}};a.addDecoration=function(a,h){var b=a.length;if(0!==b){for(var e=a[0].x+a[0].glyphMosaicItem.metrics.left,c=a[0].y,f=1;f<b;f++){var k=a[f];if(k.y!==c){var l=a[f-1].x+a[f-1].glyphMosaicItem.metrics.left+a[f-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:e,y:c,
glyphMosaicItem:{rect:new d(4,0,4,8),metrics:{width:l-e,height:2,left:0,top:h,advance:0},page:0}});c=k.y;e=k.x+k.glyphMosaicItem.metrics.left}}b=a[b-1].x+a[b-1].glyphMosaicItem.metrics.left+a[b-1].glyphMosaicItem.metrics.width;a.push({codePoint:0,x:e,y:c,glyphMosaicItem:{rect:new d(4,0,4,8),metrics:{width:b-e,height:2,left:0,top:h,advance:0},page:0}})}};a.prototype._applyJustification=function(a,d,g){for(var b=a[g],b=(b.x+b.glyphMosaicItem.metrics.advance)*this._justify;d<=g;d++)a[d].x-=b};return a}()})},
"esri/views/2d/engine/webgl/mesh/templates/WGLMeshTemplate":function(){define(["require","exports","../../../../../../core/tsSupport/extendsHelper"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});h=function(){return function(){}}();a.default=h})},"esri/views/2d/engine/webgl/util/BidiText":function(){define(["require","exports","dojox/string/BidiEngine"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});var k=new d;a.bidiText=function(a){if(!k.hasBidiChar(a))return[a,
!1];var b;b="rtl"===k.checkContextual(a)?"IDNNN":"ICNNN";return[k.bidiTransform(a,b,"VLYSN"),!0]}})},"dojox/string/BidiEngine":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/Stateful"],function(h,a,d){function k(a,c,f,d,g){var h=a;void 0===c&&(c=g.defInFormat);void 0===f&&(f=g.defOutFormat);void 0===d&&(d=g.defSwap);if(c!==f){var m,p=c.substring(0,1);m=c.substring(1,4);var r=f.substring(0,1),n=f.substring(1,4);"C"===m.charAt(0)&&(m=b(h),m="ltr"===m||"rtl"===m?m.toUpperCase():"L"===
c.charAt(2)?"LTR":"RTL",c=p+m);"C"===n.charAt(0)&&(m=b(h),"rtl"===m?n="RTL":"ltr"===m?(h=h.split(""),h.reverse(),m=b(h.join("")),n=m.toUpperCase()):n="L"===f.charAt(2)?"LTR":"RTL",f=r+n)}if(c===f)return a;r=c.substring(0,1);h=c.substring(1,4);p=f.substring(0,1);n=f.substring(1,4);g.inFormat=c;g.outFormat=f;g.swap=d;if("L"===r&&"VLTR"===f){if("LTR"===h)return g.dir=F,l(a,g);if("RTL"===h)return g.dir=G,l(a,g)}if("V"===r&&"V"===p)return g.dir="RTL"===h?G:F,e(a,g);if("L"===r&&"VRTL"===f)return g.dir=
"LTR"===h?F:G,a=l(a,g),e(a);if("VLTR"===c&&"LLTR"===f)return g.dir=F,l(a,g);if("V"===r&&"L"===p&&h!==n)return a=e(a),"RTL"===h?k(a,"LLTR","VLTR",d,g):k(a,"LRTL","VRTL",d,g);if("VRTL"===c&&"LRTL"===f)return k(a,"LRTL","VRTL",d,g);if("L"===r&&"L"===p)return c=g.swap,g.swap=c.substr(0,1)+"N","RTL"===h?(g.dir=G,a=l(a,g),g.swap="N"+c.substr(1,2),g.dir=F,a=l(a,g)):(g.dir=F,a=l(a,g),g.swap="N"+c.substr(1,2),a=k(a,"VLTR","LRTL",g.swap,g)),a}function b(a){return(a=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(a))?
"z">=a[0]?"ltr":"rtl":""}function l(a,b){a=a.split("");var c=[];g(a,c,b);if(0!==b.hiLevel&&b.swap.substr(0,1)!==b.swap.substr(1,2))for(var f=0;f<a.length;f++)if(1===c[f]){var e=f,d;b:{d=a[f];for(var h=void 0,k=0,l=H.length-1;k<=l;)if(h=Math.floor((k+l)/2),d<H[h][0])l=h-1;else if(d>H[h][0])k=h+1;else{d=H[h][1];break b}}a[e]=d}m(2,a,c,b);m(1,a,c,b);z=c;return a.join("")}function g(a,b,c){var f=a.length,e=c.dir?oa:na,d=null,g=null,h=null,d=0,g=g=null,k=-1,l=g=null,m=[],r=[];c.hiLevel=c.dir;c.lastArabic=
!1;c.hasUbatAl=!1;c.hasUbatB=!1;c.hasUbatS=!1;for(g=0;g<f;g++){var l=g,h=a[g].charCodeAt(0),n=qa[h>>8];m[l]=n<Y?n:ra[n-Y][h&255]}for(l=0;l<f;l++){r[l]=g=p(a,m,r,l,c);d=e[d][g];g=d&240;d&=15;b[l]=h=e[d][y];if(0<g){if(16===g)for(g=k;g<l;g++)b[g]=1;k=-1}if(g=e[d][D])-1===k&&(k=l);else if(-1<k){for(g=k;g<l;g++)b[g]=h;k=-1}m[l]===da&&(b[l]=0);c.hiLevel|=h}if(c.hasUbatS)for(a=0;a<f;a++)if(m[a]===ga)for(b[a]=c.dir,e=a-1;0<=e;e--)if(m[e]===ia)b[e]=c.dir;else break}function e(a,b){a=a.split("");if(b){var c=
[];g(a,c,b);z=c}a.reverse();A.reverse();return a.join("")}function c(a){for(var b=0;b<U.length;b++)if(a>=U[b]&&a<=ma[b])return!0;return!1}function f(a,b,f,e){for(;b*f<e&&u(a[b]);)b+=f;return b*f<e&&c(a[b])?!0:!1}function m(a,b,c,f){if(!(f.hiLevel<a))if(1!==a||f.dir!==G||f.hasUbatB){f=b.length;for(var e=0,d,g,h;e<f;){if(c[e]>=a){for(d=e+1;d<f&&c[d]>=a;)d++;for(g=d-1;e<g;e++,g--)h=b[e],b[e]=b[g],b[g]=h,h=A[e],A[e]=A[g],A[g]=h;e=d}e++}}else b.reverse(),A.reverse()}function p(a,b,c,f,e){return{UBAT_L:function(){e.lastArabic=
!1;return fa},UBAT_R:function(){e.lastArabic=!1;return ca},UBAT_ON:function(){return V},UBAT_AN:function(){return ba},UBAT_EN:function(){return e.lastArabic?ba:X},UBAT_AL:function(){e.lastArabic=!0;e.hasUbatAl=!0;return ca},UBAT_WS:function(){return V},UBAT_CS:function(){var a,d;if(1>f||f+1>=b.length||(a=c[f-1])!==X&&a!==ba||(d=b[f+1])!==X&&d!==ba)return V;e.lastArabic&&(d=ba);return d===a?d:V},UBAT_ES:function(){return(0<f?c[f-1]:da)===X&&f+1<b.length&&b[f+1]===X?X:V},UBAT_ET:function(){if(0<f&&
c[f-1]===X)return X;if(e.lastArabic)return V;for(var a=f+1,d=b.length;a<d&&b[a]===ja;)a++;return a<d&&b[a]===X?X:V},UBAT_NSM:function(){if("VLTR"===e.inFormat){for(var d=b.length,g=f+1;g<d&&b[g]===ka;)g++;if(g<d&&(d=a[f],g=b[g],(1425<=d&&2303>=d||64286===d)&&(g===ca||g===ha)))return ca}return 1>f||b[f-1]===da?V:c[f-1]},UBAT_B:function(){e.lastArabic=!0;e.hasUbatB=!0;return e.dir},UBAT_S:function(){e.hasUbatS=!0;return V},UBAT_LRE:function(){e.lastArabic=!1;return V},UBAT_RLE:function(){e.lastArabic=
!1;return V},UBAT_LRO:function(){e.lastArabic=!1;return V},UBAT_RLO:function(){e.lastArabic=!1;return V},UBAT_PDF:function(){e.lastArabic=!1;return V},UBAT_BN:function(){return V}}[pa[b[f]]]()}function x(a,b){for(var c=0;c<O.length;c++)if(a===O[c])return b[c];return a}function u(a){return"\u064b"<=a&&"\u0655">=a?!0:!1}function w(a){if("L"===a)return"LTR";if("R"===a)return"RTL";if("C"===a)return"CLR";if("D"===a)return"CRL"}function r(a,b){for(var c=0;c<I.length;c++)if(a===I[c])return b[c];return a}
function t(a,b,c,f){for(var e=0;e<a.length;e++)if(a[e]>b||!c&&a[e]===b)a[e]+=f}h.getObject("string",!0,dojox);h=a("dojox.string.BidiEngine",d,{inputFormat:"ILYNN",outputFormat:"VLNNN",sourceToTarget:[],targetToSource:[],levels:[],bidiTransform:function(a,b,e){this.sourceToTarget=[];this.targetToSource=[];if(!a)return"";var d=this.sourceToTarget,g=this.targetToSource,h=a.length;A=[];z=[];for(var l=0;l<h;l++)d[l]=l,g[l]=l,A[l]=l;if(!this.checkParameters(b,e))return a;b=this.inputFormat;e=this.outputFormat;
var d=a,d=v,l=w(b.charAt(1)),g=w(e.charAt(1)),m="I"===b.charAt(0)?"L":b.charAt(0),h="I"===e.charAt(0)?"L":e.charAt(0),l=m+l,g=h+g,h=b.charAt(2)+e.charAt(2);d.defInFormat=l;d.defOutFormat=g;d.defSwap=h;a=k(a,l,g,h,d);d=!1;if("R"===e.charAt(1))d=!0;else if("C"===e.charAt(1)||"D"===e.charAt(1))d=this.checkContextual(a);g=this.sourceToTarget=A;h=Array(g.length);for(l=0;l<g.length;l++)h[g[l]]=l;C=this.targetToSource=h;if(b.charAt(3)===e.charAt(3))d=a;else if("S"===e.charAt(3))if(b=d,e=!0,0===a.length)d=
void 0;else{void 0===b&&(b=!0);void 0===e&&(e=!0);a=String(a);a=a.split("");var p=0,g=1,d=a.length;b||(p=a.length-1,g=-1,d=1);for(var h=d,l=e,n=0,d=[],m=0;p*g<h;p+=g)if(c(a[p])||u(a[p])){var q;if(q="\u0644"===a[p])b:{for(var y=a,U=p+g,H=g,E=h;U*H<E&&u(y[U]);)U+=H;q=" ";if(U*H<E)for(q=y[U],y=0;y<I.length;y++)if(I[y]===q){q=!0;break b}q=!1}if(q){a[p]=0===n?r(a[p+g],K):r(a[p+g],N);p+=g;n=a;q=p;y=g;for(U=h;q*y<U&&u(n[q]);)q+=y;q*y<U&&(n[q]=" ");l&&(d[m]=p,m++);n=0}else{q=a[p];if(1===n){y=p;if(f(a,p+g,
g,h))b:for(U=a[p],H=0;H<O.length;H++){if(U===O[H]){U=R[H];break b}}else U=x(a[p],Q);a[y]=U}else!0===f(a,p+g,g,h)?a[p]=x(a[p],Z):a[p]=x(a[p],P);u(q)||(n=1);b:{for(y=0;y<T.length;y++)if(T[y]===q){q=!0;break b}q=!1}!0===q&&(n=0)}}else n=0;g="";for(h=0;h<a.length;h++){if(l=e){b:{for(l=0;l<d.length;l++)if(d[l]===h)break b;l=-1}l=-1<l}l?(t(C,h,!b,-1),A.splice(h,1)):g+=a[h]}d=g}else if(b=a,e=d,a=!0,0===b.length)d=void 0;else for(void 0===a&&(a=!0),void 0===e&&(e=!0),b=String(b),d="",g=[],g=b.split(""),h=
0;h<b.length;h++)l=!1,"\ufe70"<=g[h]&&"\ufeff">g[h]?(m=b.charCodeAt(h),"\ufef5"<=g[h]&&"\ufefc">=g[h]?(e?(0<h&&a&&" "===g[h-1]?d=d.substring(0,d.length-1)+"\u0644":(d+="\u0644",l=!0),d+=I[(m-65269)/2]):(d+=I[(m-65269)/2],d+="\u0644",h+1<b.length&&a&&" "===g[h+1]?h++:l=!0),l&&(t(C,h,!0,1),A.splice(h,0,A[h]))):d+=la[m-65136]):d+=g[h];this.sourceToTarget=A;this.targetToSource=C;this.levels=z;return d},_inputFormatSetter:function(a){if(!E.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");
this.inputFormat=a},_outputFormatSetter:function(a){if(!E.test(a))throw Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=a},checkParameters:function(a,b){a?this.set("inputFormat",a):a=this.inputFormat;b?this.set("outputFormat",b):b=this.outputFormat;return a===b?!1:!0},checkContextual:function(a){a=b(a);if("ltr"!==a&&"rtl"!==a){try{a=document.dir.toLowerCase()}catch(sa){}"ltr"!==a&&"rtl"!==a&&(a="ltr")}return a},hasBidiChar:function(a){return J.test(a)}});var A=
[],C=[],z=[],v={dir:0,defInFormat:"LLTR",defoutFormat:"VLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,hasBlockSep:!1,hasSegSep:!1},y=5,D=6,F=0,G=1,E=/^[(I|V)][(L|R|C|D)][(Y|N)][(S|N)][N]$/,J=/[\u0591-\u06ff\ufb1d-\ufefc]/,H=[["(",")"],[")","("],["\x3c","\x3e"],["\x3e","\x3c"],["[","]"],["]","["],["{","}"],["}","{"],["\u00ab","\u00bb"],["\u00bb","\u00ab"],["\u2039","\u203a"],["\u203a","\u2039"],["\u207d","\u207e"],["\u207e","\u207d"],["\u208d","\u208e"],
["\u208e","\u208d"],["\u2264","\u2265"],["\u2265","\u2264"],["\u2329","\u232a"],["\u232a","\u2329"],["\ufe59","\ufe5a"],["\ufe5a","\ufe59"],["\ufe5b","\ufe5c"],["\ufe5c","\ufe5b"],["\ufe5d","\ufe5e"],["\ufe5e","\ufe5d"],["\ufe64","\ufe65"],["\ufe65","\ufe64"]],I=["\u0622","\u0623","\u0625","\u0627"],K=["\ufef5","\ufef7","\ufef9","\ufefb"],N=["\ufef6","\ufef8","\ufefa","\ufefc"],O="\u0627\u0628\u062a\u062b\u062c\u062d\u062e\u062f\u0630\u0631\u0632\u0633\u0634\u0635\u0636\u0637\u0638\u0639\u063a\u0641\u0642\u0643\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u0644\u0645\u0646\u0647\u0648\u064a\u0625\u0623\u0622\u0629\u0649\u06cc\u0626\u0624".split(""),
P="\ufe8d\ufe8f\ufe95\ufe99\ufe9d\ufea1\ufea5\ufea9\ufeab\ufead\ufeaf\ufeb1\ufeb5\ufeb9\ufebd\ufec1\ufec5\ufec9\ufecd\ufed1\ufed5\ufed9\ufedd\ufee1\ufee5\ufee9\ufeed\ufef1\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfc\ufe89\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe89\ufe85".split(""),Q="\ufe8e\ufe90\ufe96\ufe9a\ufe9e\ufea2\ufea6\ufeaa\ufeac\ufeae\ufeb0\ufeb2\ufeb6\ufeba\ufebe\ufec2\ufec6\ufeca\ufece\ufed2\ufed6\ufeda\ufede\ufee2\ufee6\ufeea\ufeee\ufef2\ufe88\ufe84\ufe82\ufe94\ufef0\ufbfd\ufe8a\ufe86\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8a\ufe86".split(""),
R="\ufe8e\ufe92\ufe98\ufe9c\ufea0\ufea4\ufea8\ufeaa\ufeac\ufeae\ufeb0\ufeb4\ufeb8\ufebc\ufec0\ufec4\ufec8\ufecc\ufed0\ufed4\ufed8\ufedc\ufee0\ufee4\ufee8\ufeec\ufeee\ufef4\ufe88\ufe84\ufe82\ufe94\ufef0\ufbff\ufe8c\ufe86\ufe71\ufe72\ufe74\ufe77\ufe79\ufe7b\ufe7d\ufe7f\ufe80\ufe8c\ufe86".split(""),Z="\ufe8d\ufe91\ufe97\ufe9b\ufe9f\ufea3\ufea7\ufea9\ufeab\ufead\ufeaf\ufeb3\ufeb7\ufebb\ufebf\ufec3\ufec7\ufecb\ufecf\ufed3\ufed7\ufedb\ufedf\ufee3\ufee7\ufeeb\ufeed\ufef3\ufe87\ufe83\ufe81\ufe93\ufeef\ufbfe\ufe8b\ufe85\ufe70\ufe72\ufe74\ufe76\ufe78\ufe7a\ufe7c\ufe7e\ufe80\ufe8b\ufe85".split(""),
T="\u0621\u0622\u0623\u0624\u0625\u0627\u0629\u062f\u0630\u0631\u0632\u0648\u0649".split(""),la="\u064b\u064b\u064c\u061f\u064d\u061f\u064e\u064e\u064f\u064f\u0650\u0650\u0651\u0651\u0652\u0652\u0621\u0622\u0622\u0623\u0623\u0624\u0624\u0625\u0625\u0626\u0626\u0626\u0626\u0627\u0627\u0628\u0628\u0628\u0628\u0629\u0629\u062a\u062a\u062a\u062a\u062b\u062b\u062b\u062b\u062c\u062c\u062c\u062c\u062d\u062d\u062d\u062d\u062e\u062e\u062e\u062e\u062f\u062f\u0630\u0630\u0631\u0631\u0632\u0632\u0633\u0633\u0633\u0633\u0634\u0634\u0634\u0634\u0635\u0635\u0635\u0635\u0636\u0636\u0636\u0636\u0637\u0637\u0637\u0637\u0638\u0638\u0638\u0638\u0639\u0639\u0639\u0639\u063a\u063a\u063a\u063a\u0641\u0641\u0641\u0641\u0642\u0642\u0642\u0642\u0643\u0643\u0643\u0643\u0644\u0644\u0644\u0644\u0645\u0645\u0645\u0645\u0646\u0646\u0646\u0646\u0647\u0647\u0647\u0647\u0648\u0648\u0649\u0649\u064a\u064a\u064a\u064a\ufef5\ufef6\ufef7\ufef8\ufef9\ufefa\ufefb\ufefc\u061f\u061f\u061f".split(""),
U=["\u0621","\u0641"],ma=["\u063a","\u064a"],na=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],oa=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],fa=0,ca=1,X=2,ba=3,V=4,da=5,ga=6,ha=7,ia=8,ja=11,ka=12,pa="UBAT_L UBAT_R UBAT_EN UBAT_AN UBAT_ON UBAT_B UBAT_S UBAT_AL UBAT_WS UBAT_CS UBAT_ES UBAT_ET UBAT_NSM UBAT_LRE UBAT_RLE UBAT_PDF UBAT_LRO UBAT_RLO UBAT_BN".split(" "),Y=100;a=fa;d=ca;var M=X,S=ba,n=V,aa=da,ea=ga,q=ha,W=ia,L=
ja,B=ka,qa=[Y+0,a,a,a,a,Y+1,Y+2,Y+3,d,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,Y+4,n,n,n,a,n,a,n,a,n,n,n,a,a,n,n,a,a,a,a,a,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,a,a,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,a,a,a,a,a,a,a,a,a,a,a,a,a,a,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,a,a,n,n,a,a,n,n,a,a,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,
n,n,n,n,n,n,n,n,a,a,a,Y+5,q,q,Y+6,Y+7],ra=[[18,18,18,18,18,18,18,18,18,ea,aa,ea,W,aa,18,18,18,18,18,18,18,18,18,18,18,18,18,18,aa,aa,aa,ea,W,n,n,L,L,L,n,n,n,n,n,10,9,10,9,9,M,M,M,M,M,M,M,M,M,M,9,n,n,n,n,n,n,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,n,n,n,n,n,n,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,n,n,n,n,18,18,18,18,18,18,aa,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,9,n,L,L,L,L,n,n,n,n,a,n,n,18,n,n,L,L,M,M,n,a,n,n,n,M,a,n,n,n,n,n,a,a,a,
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,n,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,n,a,a,a,a,a,a,a,a],[a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,n,n,n,n,n,n,n,n,n,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,n,n,a,a,a,a,a,a,a,n,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,n,a,n,n,n,n,n,n,n,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,
B,d,B,d,B,B,d,B,B,d,B,n,n,n,n,n,n,n,n,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,n,n,n,n,n,d,d,d,d,d,n,n,n,n,n,n,n,n,n,n,n],[S,S,S,S,n,n,n,n,q,L,L,q,9,q,n,n,B,B,B,B,B,B,B,B,B,B,B,q,n,n,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,S,S,S,S,S,S,S,S,S,S,L,S,S,q,q,q,B,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,
q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,B,B,B,B,B,B,B,S,n,B,B,B,B,B,B,q,q,B,B,n,B,B,B,B,q,q,M,M,M,M,M,M,M,M,M,M,q,q,q,q,q,q],[q,q,q,q,q,q,q,q,q,q,q,q,q,q,n,q,q,B,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,n,n,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,B,B,B,B,B,B,B,B,B,B,B,
q,n,n,n,n,n,n,n,n,n,n,n,n,n,n,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,d,B,B,B,B,B,B,B,B,B,d,d,n,n,n,n,d,n,n,n,n,n],[W,W,W,W,W,W,W,W,W,W,W,18,18,18,a,d,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,W,aa,13,14,15,16,17,9,L,L,L,L,L,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,9,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,W,18,18,18,18,18,n,n,n,n,n,18,18,18,18,18,18,M,a,n,n,M,M,M,M,M,M,10,10,n,n,n,a,M,M,M,M,M,M,M,M,M,M,10,10,n,n,n,n,a,a,a,a,a,a,a,a,a,a,a,a,a,n,n,
n,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n],[a,a,a,a,a,a,a,n,n,n,n,n,n,n,n,n,n,n,n,a,a,a,a,a,n,n,n,n,n,d,B,d,d,d,d,d,d,d,d,d,d,10,d,d,d,d,d,d,d,d,d,d,d,d,d,n,d,d,d,d,d,n,d,n,d,d,n,d,d,n,d,d,d,d,d,d,d,d,d,d,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,
q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q],[B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,B,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,B,B,B,B,B,B,B,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,9,n,9,n,n,9,n,n,n,n,n,n,n,n,n,L,n,n,10,10,n,n,n,n,n,L,L,n,n,n,n,n,q,q,q,q,q,n,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,
q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,q,n,n,18],[n,n,n,L,L,L,n,n,n,n,n,10,9,10,9,9,M,M,M,M,M,M,M,M,M,M,9,n,n,n,n,n,n,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,n,n,n,n,n,n,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,n,n,n,n,n,n,n,n,n,n,n,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,
a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,a,n,n,n,a,a,a,a,a,a,n,n,a,a,a,a,a,a,n,n,a,a,a,a,a,a,n,n,a,a,a,n,n,n,L,L,n,n,n,L,L,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n]];return h})},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],function(h,a,d,k){return h("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;return b[a]?b[a]:b[a]={s:"_"+a+"Setter",
g:"_"+a+"Getter"}},postscript:function(a){a&&this.set(a)},_get:function(a,d){return"function"===typeof this[d.g]?this[d.g]():this[a]},get:function(a){return this._get(a,this._getAttrNames(a))},set:function(a,d){if("object"===typeof a){for(var b in a)a.hasOwnProperty(b)&&"_watchCallbacks"!=b&&this.set(b,a[b]);return this}b=this._getAttrNames(a);var e=this._get(a,b);b=this[b.s];var c;"function"===typeof b?c=b.apply(this,Array.prototype.slice.call(arguments,1)):this[a]=d;if(this._watchCallbacks){var f=
this;k(c,function(){f._watchCallbacks(a,e,d)})}return this},_changeAttrValue:function(a,d){var b=this.get(a);this[a]=d;this._watchCallbacks&&this._watchCallbacks(a,b,d);return this},watch:function(a,h){var b=this._watchCallbacks;if(!b)var e=this,b=this._watchCallbacks=function(a,c,d,g){var f=function(b){if(b){b=b.slice();for(var f=0,g=b.length;f<g;f++)b[f].call(e,a,c,d)}};f(b["_"+a]);g||f(b["*"])};h||"function"!==typeof a?a="_"+a:(h=a,a="*");var c=b[a];"object"!==typeof c&&(c=b[a]=[]);c.push(h);a=
{};a.unwatch=a.remove=function(){var a=d.indexOf(c,h);-1<a&&c.splice(a,1)};return a}})})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define("require exports ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Polygon ../../../../geometry/Polyline ../../../../geometry/SpatialReference ../../../../geometry/support/boundsUtils ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/support/spatialReferenceUtils ../../engine/webgl/definitions ../../engine/webgl/fontUtils ../../engine/webgl/GeometryUtils ../../engine/webgl/TextShapingNew ../../engine/webgl/TileClipper ../../engine/webgl/util/BidiText".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w,r,t,A,C){function z(a){switch(a){case "left":return 1;case "right":return-1;case "center":case "justify":return 0}}function v(a){switch(a){case "top":return-1;case "middle":return 0;case "baseline":case "bottom":return 1}}function y(a){switch(a){case "left":return 0;case "right":return 1;case "center":case "justify":return.5}}function D(a,b,c){if(!c)return a;var f=C.bidiText(b.text),e=f[0],f=f[1],d=y(b.horizontalAlignment||"center"),g=z(b.horizontalAlignment||
"center");c=(new t([c.glyphMosaicItems],u.TEXT_MAX_WIDTH,u.TEXT_LINE_HEIGHT,u.TEXT_SPACING,[0,.5*-u.TEXT_LINE_HEIGHT],.5*(1-g),0,d)).getShaping(e,f);e=w.getFontDecorationTop(b.font);isNaN(e)||t.addDecoration(c,e);c=t.getBox(c);b=k.pt2px(b.font.size)/Q;a[0]=b*c.x;a[1]=b*c.y;a[2]=b*c.width;a[3]=b*c.height;return a}function F(a,b){return Math.ceil((a-b)/(2*b))}function G(a,b){var c;c=f.isPolygon(a)?a.rings:a.paths;for(var e=0;e<c.length;e++)for(var d=0,g=c[e];d<g.length;d++)g[d][0]+=b;return a}function E(a,
b,c){if(Array.isArray(a)){var f=a[0];if(f>b){var e=F(f,b);a[0]=f+-2*e*b}else f<c&&(e=F(f,c),a[0]=f+-2*e*c)}else f=a.x,f>b?(e=F(f,b),a=a.clone().offset(-2*e*b,0)):f<c&&(e=F(f,c),a=a.clone().offset(-2*e*c,0));return a}Object.defineProperty(a,"__esModule",{value:!0});a.ensureClosedRings=function(a){if(f.isPolygon(a)){var b=0;for(a=a.rings;b<a.length;b++){var c=a[b];3>c.length||c[0][0]===c[c.length-1][0]&&c[0][1]===c[c.length-1][1]||c.push(c[0])}}};a.getBounds=function(a,b,e,d,g,h,l,p,u){if(!d)return a[0]=
a[1]=a[2]=a[3]=0,b[0]=b[1]=b[2]=b[3]=0,a;var t=e.symbol;!t&&h&&(t=h.getSymbol(e,{scale:p}));if(!t)return a;if(f.isPoint(d))switch(e=d.x,d=d.y,t.type){case "simple-marker":case "picture-marker":h=t;var w,y;g=k.pt2px(h.xoffset);b=k.pt2px(h.yoffset);t=r.C_DEG_TO_RAD*h.angle;switch(h.type){case "simple-marker":w=y=k.pt2px(h.size);break;case "picture-marker":w=k.pt2px(h.width),y=k.pt2px(h.height)}w*=.5;y*=.5;0!==t&&(h=Math.cos(t),t=Math.sin(t),p=w*t+y*h,w=w*h+y*t,y=p);w=l*(g+w);l*=b+y;l=Math.sqrt(w*w+
l*l);b=m.normalizeMapX(e-l,u);e=m.normalizeMapX(e+l,u);b>e&&(u=x.getInfo(u))&&(e=u.valid,u=e[1],b=e[0],e=u);a[0]=b;a[1]=d-l;a[2]=e;a[3]=d+l;break;case "text":0===b[2]&&0===b[3]&&D(b,t,g);h=t;g=z(h.horizontalAlignment||"center");y=v(h.verticalAlignment||"middle");t=l*k.pt2px(h.xoffset);w=l*k.pt2px(h.yoffset);p=r.C_DEG_TO_RAD*h.angle;h=l*b[2];l*=b[3];if(0!==p){b=Math.cos(p);p=Math.sin(p);var A=h*p+l*b;h=h*b+l*p;l=A}b=t+g*h+h;l=w+y*l+l;l=Math.sqrt(b*b+l*l);b=m.normalizeMapX(e-l,u);e=m.normalizeMapX(e+
l,u);b>e&&(u=x.getInfo(u))&&(e=u.valid,u=e[1],b=e[0],e=u);a[0]=b;a[1]=d-l;a[2]=e;a[3]=d+l}else{c.getBoundsXY(a,d);d=b[0];if(0===d){a:switch(d=0,t.type){case "simple-fill":case "picture-fill":d=t.outline;if(!d){d=0;break a}d=d.width;break;case "simple-line":d=t.width;break;case "simple-marker":d=t.size;break;case "picture-marker":d=Math.max(t.width,t.height);break;case "text":d=[0,0,0,0],D(d,t,g),d=Math.max(d[0],d[1])}b[0]=d}d=l*d/2;a[0]-=d;a[1]-=d;a[2]+=d;a[3]+=d}return a};a.isMarkerSymbol=function(a){return"simple-marker"===
a||"picture-marker"===a||"text"===a};a.graphicGeometryToNumber=function(a){switch(a.geometry.type){case "polyline":return 1;case "polygon":case "extent":return 2}return 0};a.getXAnchorDirection=z;a.getYAnchorDirection=v;a.getJustification=y;var J=b.vec2f32.create(),H=b.vec2f32.create(),I=b.vec2f32.create(),K=b.vec2f32.create(),N=b.vec2f32.create(),O=b.vec2f32.create(),P=b.vec2f32.create();a.isPointOnPolyline=function(a,c,f,e){b.vec2.set(I,c,f);a=a.paths;for(var d,g,h,k,l,m,p,r,u=Infinity,t=0;t<a.length;t++){var w=
a[t];if(!(2>w.length))for(var v=1;v<w.length;v++)d=w[v-1][0],h=w[v-1][1],g=w[v][0],k=w[v][1],l=Math.min(d,g)-e,m=Math.min(h,k)-e,p=Math.max(d,g)+e,r=Math.max(h,k)+e,c<l||c>p||f<m||f>r||(b.vec2.set(J,d,h),b.vec2.set(H,g,k),b.vec2.subtract(K,H,J),b.vec2.subtract(N,J,I),b.vec2.scale(O,K,b.vec2.dot(K,N)/b.vec2.dot(K,K)),b.vec2.subtract(P,N,O),d=b.vec2.dot(P,P),u>d&&(u=d))}return Math.sqrt(u)<=e};a.getMarkerSymbolBounds=function(a,b,c,f,e,d){var g,h,l=e*k.pt2px(f.xoffset),m=e*k.pt2px(f.yoffset),p=r.C_DEG_TO_RAD*
f.angle;switch(f.type){case "simple-marker":g=h=.5*e*k.pt2px(f.size);break;case "picture-marker":g=.5*e*k.pt2px(f.width),h=.5*e*k.pt2px(f.height)}e=r.C_DEG_TO_RAD*d;f=Math.cos(e);e=Math.sin(e);b+=l*f-m*e;c+=l*e+m*f;0!==p&&(l=Math.cos(p),p=Math.sin(p),m=g*p+h*l,g=g*l+h*p,h=m);a[0]=b-g;a[1]=c-h;a[2]=b+g;a[3]=c+h;return a};a.getTextSymbolBounds=function(a,b,c,f,e,d,g){var h=v(f.verticalAlignment||"baseline"),l="baseline"===(f.verticalAlignment||"baseline"),m=d*k.pt2px(f.xoffset),p=d*k.pt2px(f.yoffset);
f=k.pt2px(f.font.size)/24;var u=r.C_DEG_TO_RAD*g;g=Math.cos(u);u=Math.sin(u);b=b+(m*g-p*u)+d*e[0];c=c+(m*u+p*g)+d*((l?25*f:e[1]+(1-h)*e[3]*.5)+4*f);a[0]=b;a[1]=c-d*e[3];a[2]=b+d*e[2];a[3]=c;return a};a.normalizeCentralMeridian=function(a){var b,c,f,e,g,h=null;if(!a)return d.resolve(null);b=a.spatialReference;c=p.getInfo(b);g=b.isWebMercator?102100:4326;f=R[g].maxX;e=R[g].minX;b=R[g].plus180Line;g=R[g].minus180Line;var k;if(c)if("mesh"===a.type)k=a;else if("point"===a.type)k=E(a.clone(),f,e);else if("multipoint"===
a.type)k=a.clone(),k.points=k.points.map(function(a){return E(a,f,e)});else if("extent"===a.type){var m=a.clone();k=m._normalize(!1,!1,c);k=k.rings?new l(k):k}else a.extent?(m=a.extent,c=2*F(m.xmin,e)*f,a=0===c?a.clone():G(a.clone(),c),m.offset(c,0),m.intersects(b)&&m.xmax!==f?h=a:m.intersects(g)&&m.xmin!==e?h=a:k=a):k=a.clone();else return d.resolve(a);return null!==h?(h=(new A.CutVertical).cut(h,f),d.resolve(h)):d.resolve(k)};var Q=24,R={102100:{maxX:2.0037508342788905E7,minX:-2.0037508342788905E7,
plus180Line:new g({paths:[[[2.0037508342788905E7,-2.0037508342788905E7],[2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:e.WebMercator}),minus180Line:new g({paths:[[[-2.0037508342788905E7,-2.0037508342788905E7],[-2.0037508342788905E7,2.0037508342788905E7]]],spatialReference:e.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new g({paths:[[[180,-180],[180,180]]],spatialReference:e.WebMercator}),minus180Line:new g({paths:[[[-180,-180],[-180,180]]],spatialReference:e.WebMercator})}}})},
"esri/geometry/support/boundsUtils":function(){define(["require","exports","./jsonUtils"],function(h,a,d){function k(a){return function(b,c){return null==b?c:null==c?b:a(b,c)}}function b(a,b,d,g){var f=d?3:2;if(!b.length||!b[0].length)return null;for(var h=b[0][0],k=h[0],h=h[1],l=b[0][0],m=l[0],l=l[1],p=void 0,x=void 0,v=void 0,y=void 0,D=0;D<b.length;D++)for(var F=b[D],G=0;G<F.length;G++){var E=F[G],J=E[0],H=E[1],k=e(k,J),h=e(h,H),m=c(m,J),l=c(l,H);d&&2<E.length&&(J=E[2],p=e(p,J),x=c(x,J));g&&E.length>
f&&(y=E[f],v=e(p,y),y=c(x,y))}if(d)return g?(a[0]=k,a[1]=h,a[2]=p,a[3]=v,a[4]=m,a[5]=l,a[6]=x,a[7]=y):(a[0]=k,a[1]=h,a[2]=p,a[3]=m,a[4]=l,a[5]=x),a;if(g)return a[0]=k,a[1]=h,a[2]=v,a[3]=m,a[4]=l,a[5]=y,a;a[0]=k;a[1]=h;a[2]=m;a[3]=l;return a}function l(a,b,c,e,d,g){c=b.xmin;e=b.xmax;var f=b.ymin,h=b.ymax,k=b.zmin,l=b.zmax,m=b.mmin;b=b.mmax;if(d)return k=k||0,l=l||0,g?(a[0]=c,a[1]=f,a[2]=k,a[3]=m||0,a[4]=e,a[5]=h,a[6]=l,a[7]=b||0):(a[0]=c,a[1]=f,a[2]=k,a[3]=e,a[4]=h,a[5]=l),a;if(g)return a[0]=c,a[1]=
f,a[2]=m||0,a[3]=e,a[4]=h,a[5]=b||0,a;a[0]=c;a[1]=f;a[2]=e;a[3]=h;return a}function g(a,b,d,g,h,k){var f=d?3:2;g=g&&k;d=d&&h;if(!b.length||!b[0].length)return null;for(var l=b[0],m=l[0],l=l[1],p=b[0],u=p[0],p=p[1],w=void 0,y=void 0,x=void 0,F=void 0,G=0;G<b.length;G++){var E=b[G],J=E[0],H=E[1],m=e(m,J),l=e(l,H),u=c(u,J),p=c(p,H);d&&2<E.length&&(J=E[2],w=e(w,J),y=c(y,J));g&&E.length>f&&(F=E[f],x=e(w,F),F=c(y,F))}if(h)return w=w||0,y=y||0,k?(a[0]=m,a[1]=l,a[2]=w,a[3]=x||0,a[4]=u,a[5]=p,a[6]=y,a[7]=
F||0):(a[0]=m,a[1]=l,a[2]=w,a[3]=u,a[4]=p,a[5]=y),a;if(k)return a[0]=m,a[1]=l,a[2]=x||0,a[3]=u,a[4]=p,a[5]=F||0,a;a[0]=m;a[1]=l;a[2]=u;a[3]=p;return a}Object.defineProperty(a,"__esModule",{value:!0});var e=k(Math.min),c=k(Math.max);a.getBoundsXY=function(a,c){if(d.isPolyline(c))return b(a,c.paths,!1,!1);if(d.isPolygon(c))return b(a,c.rings,!1,!1);if(d.isMultipoint(c))return g(a,c.points,!1,!1,!1,!1);if(d.isExtent(c))return l(a,c);d.isPoint(c)&&(a[0]=c.x,a[1]=c.y,a[2]=c.x,a[3]=c.y);return a};a.getRingsOrPathsBounds=
b;a.getExtentBounds=l;a.getPointsBounds=g})},"esri/views/2d/engine/webgl/TileClipper":function(){define(["require","exports","./definitions","./Geometry","./GeometryUtils"],function(h,a,d,k,b){Object.defineProperty(a,"__esModule",{value:!0});var l=function(){return function(a,b,f){this.ratio=a;this.x=b;this.y=f}}();h=function(){function a(a,b,e,g,h){void 0===g&&(g=8);void 0===h&&(h=8);this.lines=[];this.starts=[];this.pixelRatio=g;this.pixelMargin=h;this.tileSize=d.TILE_SIZE*g;this.dz=a;this.yPos=
b;this.xPos=e}a.prototype.setExtent=function(a){this.finalRatio=this.tileSize/a*(1<<this.dz);var b=this.pixelRatio*this.pixelMargin,b=b/this.finalRatio;a>>=this.dz;b>a&&(b=a);this.margin=b;this.xmin=a*this.xPos-b;this.ymin=a*this.yPos-b;this.xmax=this.xmin+a+2*b;this.ymax=this.ymin+a+2*b};a.prototype.reset=function(a){this.type=a;this.lines=[];this.starts=[];this.line=null;this.start=0};a.prototype.moveTo=function(a,b){this._pushLine();this._prevIsIn=this._isIn(a,b);this._moveTo(a,b,this._prevIsIn);
this._prevPt=new k.Point(a,b);this._firstPt=new k.Point(a,b);this._dist=0};a.prototype.lineTo=function(a,b){var c=this._isIn(a,b),f=new k.Point(a,b),e=k.Point.distance(this._prevPt,f),d,g,h;if(c)this._prevIsIn?this._lineTo(a,b,!0):(d=this._prevPt,g=f,a=this._intersect(g,d),this.start=this._dist+e*(1-this._r),this._lineTo(a.x,a.y,!0),this._lineTo(g.x,g.y,!0));else if(this._prevIsIn)g=this._prevPt,d=f,a=this._intersect(g,d),this._lineTo(a.x,a.y,!0),this._lineTo(d.x,d.y,!1);else{var t=this._prevPt;if(!(t.x<=
this.xmin&&f.x<=this.xmin||t.x>=this.xmax&&f.x>=this.xmax||t.y<=this.ymin&&f.y<=this.ymin||t.y>=this.ymax&&f.y>=this.ymax)){a=[];if(t.x<this.xmin&&f.x>this.xmin||t.x>this.xmin&&f.x<this.xmin)b=(this.xmin-t.x)/(f.x-t.x),h=t.y+b*(f.y-t.y),h<=this.ymin?g=!1:h>=this.ymax?g=!0:a.push(new l(b,this.xmin,h));if(t.x<this.xmax&&f.x>this.xmax||t.x>this.xmax&&f.x<this.xmax)b=(this.xmax-t.x)/(f.x-t.x),h=t.y+b*(f.y-t.y),h<=this.ymin?g=!1:h>=this.ymax?g=!0:a.push(new l(b,this.xmax,h));if(t.y<this.ymin&&f.y>this.ymin||
t.y>this.ymin&&f.y<this.ymin)b=(this.ymin-t.y)/(f.y-t.y),h=t.x+b*(f.x-t.x),h<=this.xmin?d=!1:h>=this.xmax?d=!0:a.push(new l(b,h,this.ymin));if(t.y<this.ymax&&f.y>this.ymax||t.y>this.ymax&&f.y<this.ymax)b=(this.ymax-t.y)/(f.y-t.y),h=t.x+b*(f.x-t.x),h<=this.xmin?d=!1:h>=this.xmax?d=!0:a.push(new l(b,h,this.ymax));if(0===a.length)d?g?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):g?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(1<a.length&&
a[0].ratio>a[1].ratio)this.start=this._dist+e*a[1].ratio,this._lineTo(a[1].x,a[1].y,!0),this._lineTo(a[0].x,a[0].y,!0);else for(this.start=this._dist+e*a[0].ratio,d=0;d<a.length;d++)this._lineTo(a[d].x,a[d].y,!0)}this._lineTo(f.x,f.y,!1)}this._dist+=e;this._prevIsIn=c;this._prevPt=f};a.prototype.close=function(){if(2<this.line.length){var a=this._firstPt,b=this._prevPt;a.x===b.x&&a.y===b.y||this.lineTo(a.x,a.y);a=this.line;for(b=a.length;4<=b;)if(a[0].x===a[1].x&&a[0].x===a[b-2].x||a[0].y===a[1].y&&
a[0].y===a[b-2].y)a.pop(),a[0].x=a[b-2].x,a[0].y=a[b-2].y,--b;else break}};a.prototype.result=function(a){void 0===a&&(a=!0);this._pushLine();if(0===this.lines.length)return null;3===this.type&&a&&g.simplify(this.tileSize,this.margin*this.finalRatio,this.lines);return this.lines};a.prototype.resultWithStarts=function(){if(2!==this.type)throw Error("Only valid for lines");this._pushLine();var a=this.lines,b=a.length;if(0===b)return null;for(var e=[],d=0;d<b;d++)e.push({line:a[d],start:this.starts[d]||
0});return e};a.prototype._isIn=function(a,b){return a>=this.xmin&&a<=this.xmax&&b>=this.ymin&&b<=this.ymax};a.prototype._intersect=function(a,b){var c,f,e;if(b.x>=this.xmin&&b.x<=this.xmax)f=b.y<=this.ymin?this.ymin:this.ymax,e=(f-a.y)/(b.y-a.y),c=a.x+e*(b.x-a.x);else if(b.y>=this.ymin&&b.y<=this.ymax)c=b.x<=this.xmin?this.xmin:this.xmax,e=(c-a.x)/(b.x-a.x),f=a.y+e*(b.y-a.y);else{f=b.y<=this.ymin?this.ymin:this.ymax;c=b.x<=this.xmin?this.xmin:this.xmax;var d=(c-a.x)/(b.x-a.x),g=(f-a.y)/(b.y-a.y);
d<g?(e=d,f=a.y+d*(b.y-a.y)):(e=g,c=a.x+g*(b.x-a.x))}this._r=e;return new k.Point(c,f)};a.prototype._pushLine=function(){this.line&&(1===this.type?0<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?1<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&3<this.line.length&&(this.lines.push(this.line),this.starts.push(this.start)));this.line=[];this.start=0};a.prototype._moveTo=function(a,b,e){3!==this.type?e&&(a=Math.round((a-
(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new k.Point(a,b))):(e||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line.push(new k.Point(a,b)),this._is_v=this._is_h=!1)};a.prototype._lineTo=function(a,b,e){if(3!==this.type)if(e){a=Math.round((a-(this.xmin+
this.margin))*this.finalRatio);b=Math.round((b-(this.ymin+this.margin))*this.finalRatio);if(0<this.line.length&&(e=this.line[this.line.length-1],e.equals(a,b)))return;this.line.push(new k.Point(a,b))}else this.line&&0<this.line.length&&this._pushLine();else if(e||(a<this.xmin&&(a=this.xmin),a>this.xmax&&(a=this.xmax),b<this.ymin&&(b=this.ymin),b>this.ymax&&(b=this.ymax)),a=Math.round((a-(this.xmin+this.margin))*this.finalRatio),b=Math.round((b-(this.ymin+this.margin))*this.finalRatio),this.line&&
0<this.line.length){e=this.line[this.line.length-1];var c=e.x===a,f=e.y===b;c&&f||(this._is_h&&c?(e.x=a,e.y=b,e=this.line[this.line.length-2],e.x===a&&e.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(e=this.line[this.line.length-2],this._is_h=e.x===a,this._is_v=e.y===b)):(this._is_h=e.x===a,this._is_v=e.y===b)):this._is_v&&f?(e.x=a,e.y=b,e=this.line[this.line.length-2],e.x===a&&e.y===b?(this.line.pop(),1>=this.line.length?this._is_v=this._is_h=!1:(e=this.line[this.line.length-
2],this._is_h=e.x===a,this._is_v=e.y===b)):(this._is_h=e.x===a,this._is_v=e.y===b)):(this.line.push(new k.Point(a,b)),this._is_h=c,this._is_v=f))}else this.line.push(new k.Point(a,b))};return a}();a.TileClipper=h;h=function(){function a(){}a.prototype.setExtent=function(a){this._ratio=4096===a?1:4096/a};a.prototype.reset=function(a){this.type=a;this.lines=[];this.line=null};a.prototype.moveTo=function(a,b){this.line&&this.lines.push(this.line);this.line=[];var c=this._ratio;this.line.push(new k.Point(Math.round(a*
c),Math.round(b*c)))};a.prototype.lineTo=function(a,b){var c=this._ratio;this.line.push(new k.Point(Math.round(a*c),Math.round(b*c)))};a.prototype.close=function(){var a=this.line;a&&!a[0].isEqual(a[a.length-1])&&a.push(a[0])};a.prototype.result=function(){this.line&&this.lines.push(this.line);if(0===this.lines.length)return null;3===this.type&&1!==this._ratio&&g.simplify(4096,64,this.lines);return this.lines};return a}();a.SimpleBuilder=h;var g=function(){function a(){}a.simplify=function(b,e,d){if(d){var c=
-e,f=b+e,g=-e,h=b+e;b=[];e=[];for(var k=d.length,l=0;l<k;++l){var m=d[l];if(m&&!(2>m.length))for(var C=m[0],z=void 0,v=m.length,y=1;y<v;++y)z=m[y],C.x===z.x&&(C.x<=c&&(C.y>z.y?(b.push(l),b.push(y),b.push(0),b.push(-1)):(e.push(l),e.push(y),e.push(0),e.push(-1))),C.x>=f&&(C.y<z.y?(b.push(l),b.push(y),b.push(1),b.push(-1)):(e.push(l),e.push(y),e.push(1),e.push(-1)))),C.y===z.y&&(C.y<=g&&(C.x<z.x?(b.push(l),b.push(y),b.push(2),b.push(-1)):(e.push(l),e.push(y),e.push(2),e.push(-1))),C.y>=h&&(C.x>z.x?
(b.push(l),b.push(y),b.push(3),b.push(-1)):(e.push(l),e.push(y),e.push(3),e.push(-1)))),C=z}0!==b.length&&0!==e.length&&(a.fillParent(d,e,b),a.fillParent(d,b,e),c=[],a.calcDeltas(c,e,b),a.calcDeltas(c,b,e),a.addDeltas(c,d))}};a.fillParent=function(a,e,d){for(var c=d.length,f=e.length,g=0;g<f;g+=4){for(var h=e[g],k=e[g+1],l=e[g+2],m=a[h][k-1],h=a[h][k],k=8092,C=-1,z=0;z<c;z+=4)if(d[z+2]===l){var v=d[z],y=d[z+1],D=a[v][y-1],v=a[v][y];switch(l){case 0:case 1:b.between(m.y,D.y,v.y)&&b.between(h.y,D.y,
v.y)&&(D=Math.abs(v.y-D.y),D<k&&(k=D,C=z));break;case 2:case 3:b.between(m.x,D.x,v.x)&&b.between(h.x,D.x,v.x)&&(D=Math.abs(v.x-D.x),D<k&&(k=D,C=z))}}e[g+3]=C}};a.calcDeltas=function(b,e,d){for(var c=e.length,f=0;f<c;f+=4){var g=a.calcDelta(f,e,d,[]);b.push(e[f]);b.push(e[f+1]);b.push(e[f+2]);b.push(g)}};a.calcDelta=function(b,e,d,g){b=e[b+3];if(-1===b)return 0;var c=g.length;if(1<c&&g[c-2]===b)return 0;g.push(b);return a.calcDelta(b,d,e,g)+1};a.addDeltas=function(a,b){for(var c=a.length,e=0,f=0;f<
c;f+=4){var d=a[f+3];d>e&&(e=d)}for(f=0;f<c;f+=4){var g=b[a[f]],h=a[f+1],d=e-a[f+3];switch(a[f+2]){case 0:g[h-1].x-=d;g[h].x-=d;1===h&&(g[g.length-1].x-=d);h===g.length-1&&(g[0].x-=d);break;case 1:g[h-1].x+=d;g[h].x+=d;1===h&&(g[g.length-1].x+=d);h===g.length-1&&(g[0].x+=d);break;case 2:g[h-1].y-=d;g[h].y-=d;1===h&&(g[g.length-1].y-=d);h===g.length-1&&(g[0].y-=d);break;case 3:g[h-1].y+=d,g[h].y+=d,1===h&&(g[g.length-1].y+=d),h===g.length-1&&(g[0].y+=d)}}};return a}();h=function(){function a(){this.linesIn=
[];this.linesOut=[]}a.prototype.cut=function(a,b){this.xCut=b;var c;if(a.rings)this.closed=!0,c=a.rings,this.minPts=4;else if(a.paths)this.closed=!1,c=a.paths,this.minPts=2;else return null;for(var e=0;e<c.length;e++)if((b=c[e])&&!(b.length<this.minPts)){for(var d=!0,f=0;f<b.length;f++){var g=b[f];d?(this.moveTo(g),d=!1):this.lineTo(g)}this.closed&&this.close()}this._pushLineIn();this._pushLineOut();c=[];g=0;for(e=this.linesIn;g<e.length;g++)(b=e[g])&&b.length>=this.minPts&&c.push(b);e=-2*this.xCut;
d=0;for(f=this.linesOut;d<f.length;d++)if((b=f[d])&&b.length>=this.minPts){for(var h=0,k=b;h<k.length;h++)g=k[h],g[0]+=e;c.push(b)}this.closed?a.rings=c:a.paths=c;return a};a.prototype.moveTo=function(a){this._pushLineIn();this._pushLineOut();this._prevSide=this._side(a[0]);this._moveTo(a[0],a[1],this._prevSide);this._firstPt=this._prevPt=a};a.prototype.lineTo=function(a){var b=this._side(a[0]);if(-1===b*this._prevSide){var c=this._intersect(this._prevPt,a);this._lineTo(this.xCut,c,0);this._prevSide=
0}this._lineTo(a[0],a[1],b);this._prevSide=b;this._prevPt=a};a.prototype.close=function(){var a=this._firstPt,b=this._prevPt;a[0]===b[0]&&a[1]===b[1]||this.lineTo(a);this._checkClosingPt(this.lineIn);this._checkClosingPt(this.lineOut)};a.prototype._moveTo=function(a,b,e){this.closed?(this.lineIn.push([0>=e?a:this.xCut,b]),this.lineOut.push([0<=e?a:this.xCut,b])):(0>=e&&this.lineIn.push([a,b]),0<=e&&this.lineOut.push([a,b]))};a.prototype._lineTo=function(a,b,e){this.closed?(this._addPolyVertex(this.lineIn,
0>=e?a:this.xCut,b),this._addPolyVertex(this.lineOut,0<=e?a:this.xCut,b)):0>e?(0===this._prevSide&&this._pushLineOut(),this.lineIn.push([a,b])):0<e?(0===this._prevSide&&this._pushLineIn(),this.lineOut.push([a,b])):0>this._prevSide?(this.lineIn.push([a,b]),this.lineOut.push([a,b])):0<this._prevSide&&(this.lineOut.push([a,b]),this.lineIn.push([a,b]))};a.prototype._addPolyVertex=function(a,b,e){var c=a.length;1<c&&a[c-1][0]===b&&a[c-2][0]===b?a[c-1][1]=e:a.push([b,e])};a.prototype._checkClosingPt=function(a){var b=
a.length;3<b&&a[0][0]===this.xCut&&a[b-2][0]===this.xCut&&a[1][0]===this.xCut&&(a[0][1]=a[b-2][1],a.pop())};a.prototype._side=function(a){return a<this.xCut?-1:a>this.xCut?1:0};a.prototype._intersect=function(a,b){return a[1]+(this.xCut-a[0])/(b[0]-a[0])*(b[1]-a[1])};a.prototype._pushLineIn=function(){this.lineIn&&this.lineIn.length>=this.minPts&&this.linesIn.push(this.lineIn);this.lineIn=[]};a.prototype._pushLineOut=function(){this.lineOut&&this.lineOut.length>=this.minPts&&this.linesOut.push(this.lineOut);
this.lineOut=[]};return a}();a.CutVertical=h})},"esri/views/2d/engine/webgl/mesh/templates/WGLLineTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../color ../../definitions ../../enums ../../enums ../../LineTess ../../number ../../TileClipper ../../Utils ../../WGLDisplayRecord ./WGLMeshTemplate".split(" "),function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w){Object.defineProperty(a,"__esModule",{value:!0});
var r=k.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate"),t=f.allocTriangles(20),A=f.allocTriangles(20),C=[f.allocExtrudeVectors(),f.allocExtrudeVectors()],z=f.allocExtrudeVectors(),v=g.TILE_SIZE+8,y=new f.Tessellator({distanceAlongCorrection:!0}),D=new p.TileClipper(0,0,0,1,8);D.setExtent(g.TILE_SIZE);h=function(a){function g(b,c,d,f,g,h,k,l,m,p,r,t){var u=a.call(this)||this;u.capType=h;u.joinType=k;u.fillColor=l;u.tl=m;u.br=p;u.hasPattern=r;u.isDashed=t;u.geometryType=e.WGLGeometryType.LINE;
u.halfWidth=0<f?.5*(f+1/g):0;u._materialStore=b;u.vvFlags=c;u.materialId=u._materialStore.createSpriteMaterial(d,u.geometryType,c);return u}d(g,a);g.fromSimpleLine=function(a,c,e,d,f){var h=e.color,k="solid"!==e.style&&"none"!==e.style,p=x.getCapType(e.cap||"round",k),u=x.getJoinType(e.join||"round"),h=h&&"none"!==e.style&&l.premultiplyAlphaRGBA(h)||0;"none"===e.style&&(h=0);if(!d)return new g(a,c,d,b.pt2px(e.width),f,p,u,h,0,0,!1,k);var r=d.rect,t=r.x+1+d.width,w=r.y+1+d.height,r=m.i1616to32(r.x+
1,r.y+1),t=m.i1616to32(t,w);return new g(a,c,d,b.pt2px(e.width),f,p,u,h,r,t,!0,k)};g.fromPictureLineSymbol=function(a,b,c,e){r.error("PictureLineSymbol support does not exist!");return null};g.prototype.writeMesh=function(a,b,e,d,f,g,h){if(this.vvFlags&c.WGLVVFlag.COLOR||0!==this.fillColor){g=this._materialStore.get(this.materialId);var k=b.indexVector,l=b.get("geometry");b=b.get("visibility");var m=this.halfWidth,p=new u(d,this.geometryType,this.materialId),t=this._getOffset(l,g);p.vertexFrom=t;
p.indexFrom=k.length;switch(e){case "esriGeometryPolyline":e=this._clipLines(f.geometry.paths);if(0===e.length)break;this._write(p,k,l,b,t,d,m,e,g,h);a.push(p);break;case "esriGeometryPolygon":e=this._clipLines(f.geometry.rings);if(0===e.length)break;this._write(p,k,l,b,t,d,m,e,g,h);a.push(p);break;default:r.error("Unable to handle geometryType: "+e)}}};g.prototype._clipLines=function(a){for(var b=[],c=!1,e=0;e<a.length;){var d=[],f=a[e];D.reset(2);var g=f[0],h=g[0],g=g[1];if(c)D.moveTo(h,g);else{if(-8>
h||h>v||-8>g||g>v){c=!0;continue}d.push({x:h,y:g})}for(var k=!1,l=f.length,m=1;m<l;++m)if(h+=f[m][0],g+=f[m][1],c)D.lineTo(h,g);else{if(-8>h||h>v||-8>g||g>v){k=!0;break}d.push({x:h,y:g})}if(k)c=!0;else{if(c){if(d=D.resultWithStarts())for(c=0;c<d.length;c++)b.push(d[c])}else b.push({line:d,start:0});e++;c=!1}}return b};g.prototype._getOffset=function(a,b){b=b.materialKeyInfo.hasVV()?11:8;return a.length/b};g.prototype._write=function(a,b,c,e,d,g,h,k,l,m){for(var p=0,r=0;r<k.length;r++){var u=k[r],
w=u.line;if(!(2>w.length))for(var v=w[0],A=w[w.length-1],x=A.x-v.x,v=A.y-v.y,x=1E-6>x*x+v*v,P=u.start%65535,u=C[1],v=0;v<w.length;v++){var Q=w[v],A=u===C[v%2]?C[(v+1)%2]:C[v%2],R=0===v,E=v===w.length-1;E&&x&&!this.hasPattern?f.copyExtrudeVectors(A,z):(this._computeExtrudeVectors(A,v,w,x),p+=this._writeVertices(c,e,g,h,Q.x,Q.y,A,P,p,l,m),null==A.capCenter||x&&E||this._writePieIndices(a,b,d,A),x&&R&&!this.hasPattern&&f.copyExtrudeVectors(z,A));R||this._writeBridgeIndices(a,b,d,u,A);if(!E){var E=w[v+
1],R=[E.x-Q.x,E.y-Q.y],D=f.length(R),R=[R[0]/D,R[1]/D],D=P+D;if(65535<D){var F=(65535-P)/(D-P),P=Q.x+(E.x-Q.x)*F,Q=Q.y+(E.y-Q.y)*F,E=u;y.buttCap(E,R,R);p+=this._writeVertices(c,e,g,h,P,Q,E,65535,p,l,m);y.bridge(t,A,E);this._writeBridgeIndices(a,b,d,A,E);y.buttCap(E,R,R);P=D-65535}else P=D,u=A}}}a.vertexCount=p};g.prototype._writeVertices=function(a,b,c,e,d,f,g,h,k,l,p){var u=0,r=m.i1616to32(d,f),t=g.vectors;g=t.items;for(t=t.count;u<t;++u){var v=g[u].vector,w=v[0],v=v[1],y=g[u].texCoords,A=y[0],x=
y[1],z=g[u].direction,y=z[0],P=z[1],z=m.i1616to32(h,31*e),w=m.i8888to32(Math.round(31*w),Math.round(31*v),Math.round(31*A),Math.round(31*x)),v=m.i8888to32(Math.round(31*y),Math.round(31*P),0,0);a.push(r);a.push(c);a.push(this.fillColor);a.push(w);a.push(z);a.push(this.tl);a.push(this.br);a.push(v);this._writeVV(a,p,l);b.push(255);g[u].base={index:k+u,point:[d,f]}}return u};g.prototype._writeVV=function(a,b,c){c.materialKeyInfo.hasVV()&&(a.push(b[e.VVType.SIZE]),a.push(b[e.VVType.COLOR]),a.push(b[e.VVType.OPACITY]))};
g.prototype._writeBridgeIndices=function(a,b,c,e,d){y.bridge(t,e,d);for(e=0;e<t.count;++e)d=t.items[e],b.push(c+d.v1.base.index),b.push(c+d.v2.base.index),b.push(c+d.v3.base.index),a.indexCount+=3};g.prototype._writePieIndices=function(a,b,c,e){y.pie(A,e);for(e=0;e<A.count;++e){var d=A.items[e];b.push(c+d.v1.base.index);b.push(c+d.v2.base.index);b.push(c+d.v3.base.index);a.indexCount+=3}};g.prototype._computeExtrudeVectors=function(a,b,c,e){var d=c[b],g=[void 0,void 0],h=[void 0,void 0];if(0<b&&b<
c.length-1){var k=c[(b+c.length-1)%c.length],l=c[(b+1)%c.length];f.normalize(g,[d.x-k.x,d.y-k.y]);f.normalize(h,[l.x-d.x,l.y-d.y])}else if(0===b)l=c[(b+1)%c.length],f.normalize(h,[l.x-d.x,l.y-d.y]),e?(k=c[c.length-2],f.normalize(g,[d.x-k.x,d.y-k.y])):g=h;else if(b===c.length-1)k=c[(b+c.length-1)%c.length],f.normalize(g,[d.x-k.x,d.y-k.y]),e?(k=c[1],f.normalize(h,[k.x-d.x,k.y-d.y])):h=g;else{console.error("Vertex index 'i' out of range.");return}e||0!==b?e||b!==c.length-1?this._computeJoinExtrudeVectors(a,
g,h):this._computeCapExtrudeVectors(a,g,h,f.CapPosition.END):this._computeCapExtrudeVectors(a,g,h,f.CapPosition.START)};g.prototype._computeCapExtrudeVectors=function(a,b,c,d){switch(this.capType){case e.CapType.BUTT:y.buttCap(a,b,c);break;case e.CapType.ROUND:var g=f.getNumberOfSlices(Math.PI);y.roundCap(a,b,c,d,g,d===f.CapPosition.START?-1:1);break;case e.CapType.SQUARE:this.isDashed?y.squareCapForDashedLines(a,b,c,d):y.squareCap(a,b,c,d);break;default:r.error("Encountered unknown cap type: "+this.capType+
", defaulting to BUTT"),y.buttCap(a,b,c)}};g.prototype._computeJoinExtrudeVectors=function(a,b,c){var d=f.getRads(b,c);if(d>Math.PI-.05)y.rectJoin(a,b,c);else if(this.joinType===e.JoinType.MITER||.1>d).05>d?y.fastMiterJoin(a,b,c):d<f.MITER_SAFE_RADS?y.miterJoin(a,b,c):y.bevelJoin(a,b,c,f.SYSTEM_MAG_LIMIT);else if(this.joinType===e.JoinType.BEVEL)y.bevelJoin(a,b,c,1);else if(this.joinType===e.JoinType.ROUND){var g=f.getNumberOfSlices(d);2.3>d?2>g||.5>d?y.bevelJoin(a,b,c,1):y.roundJoin(a,b,c,g):y.unitRoundJoin(a,
b,c,g)}};return g}(w.default);a.default=h})},"esri/views/2d/engine/webgl/LineTess":function(){define(["require","exports"],function(h,a){function d(a){var b={items:[],count:0},c;for(c=0;c<a;++c)b.items.push(void 0);return b}function k(a,b){z.vector[0]=a.vector[0];z.vector[1]=a.vector[1];z.texCoords[0]=a.texCoords[0];z.texCoords[1]=a.texCoords[1];z.direction[0]=a.direction[0];z.direction[1]=a.direction[1];z.base=a.base;a.vector[0]=b.vector[0];a.vector[1]=b.vector[1];a.texCoords[0]=b.texCoords[0];a.texCoords[1]=
b.texCoords[1];a.direction[0]=b.direction[0];a.direction[1]=b.direction[1];a.base=b.base;b.vector[0]=z.vector[0];b.vector[1]=z.vector[1];b.texCoords[0]=z.texCoords[0];b.texCoords[1]=z.texCoords[1];b.direction[0]=z.direction[0];b.direction[1]=z.direction[1];b.base=z.base}function b(a,b){return a[0]*b[0]+a[1]*b[1]}function l(a){return Math.sqrt(b(a,a))}function g(a,b){var c=l(b);a[0]=b[0]/c;a[1]=b[1]/c;return a}function e(a,b){a[0]=-b[1];a[1]=b[0];return a}function c(a,b){return a[0]*b[1]-a[1]*b[0]}
function f(a,b){a[0]=-b[0];a[1]=-b[1];return a}function m(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;return a}function p(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return a}function x(a,c){a=b(a,c);return.999<a?0:-.999>a?Math.PI:Math.acos(a)}function u(a,b,c,e,d){if(0===e)a.count=0;else{var f=l(b),g=m(v[0],b,1/f);c=m(v[1],c,1/f);g=x(g,c);g=(d?-1:1)*g/e;d=Math.cos(g);g=Math.sin(g);c=b[0];var h=b[1];for(b=0;b<e-1;++b)f=c,c=d*f-g*h,h=g*f+d*h,a.items[b][0]=c,a.items[b][1]=h;a.count=e-1}}function w(a){var b=a.count,c=Math.floor(b/
2),e;for(e=0;e<c;++e){var d=a.items[e];a.items[e]=a.items[b-e-1];a.items[b-e-1]=d}}Object.defineProperty(a,"__esModule",{value:!0});var r;(function(a){a[a.ENTRY=1]="ENTRY";a[a.EXIT=2]="EXIT";a[a.CAP=3]="CAP"})(r=a.VectorRole||(a.VectorRole={}));var t;(function(a){a[a.START=1]="START";a[a.END=2]="END"})(t=a.CapPosition||(a.CapPosition={}));a.SYSTEM_MAG_LIMIT=3.8;a.MITER_SAFE_RADS=2*Math.acos(1/a.SYSTEM_MAG_LIMIT);var A=a.SYSTEM_MAG_LIMIT*a.SYSTEM_MAG_LIMIT,C=8/(2*Math.PI);a.allocTriangles=function(a){var b=
{items:[],count:0},c;for(c=0;c<a;++c)b.items.push({v1:{vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0]},v2:{vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0]},v3:{vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0]}});return b};a.allocExtrudeVectors=function(){var a={items:[],count:0},b;for(b=0;30>b;++b)a.items.push({vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0]});b={};b[r.ENTRY]=d(20);b[r.EXIT]=
d(20);b[r.CAP]=d(20);return{vectors:a,lists:b}};a.copyExtrudeVectors=function(a,b){var c;for(c=0;c<b.vectors.count;++c)a.vectors.items[c].vector[0]=b.vectors.items[c].vector[0],a.vectors.items[c].vector[1]=b.vectors.items[c].vector[1],a.vectors.items[c].texCoords[0]=b.vectors.items[c].texCoords[0],a.vectors.items[c].texCoords[1]=b.vectors.items[c].texCoords[1],a.vectors.items[c].direction[0]=b.vectors.items[c].direction[0],a.vectors.items[c].direction[1]=b.vectors.items[c].direction[1],a.vectors.items[c].base=
b.vectors.items[c].base;a.vectors.count=b.vectors.count;var e=b.lists[r.ENTRY],d=a.lists[r.ENTRY],f=b.lists[r.EXIT],g=a.lists[r.EXIT],h=b.lists[r.CAP],k=a.lists[r.CAP];for(c=0;c<e.count;++c)d.items[c]=e.items[c];d.count=e.count;for(c=0;c<f.count;++c)g.items[c]=f.items[c];g.count=f.count;for(c=0;c<h.count;++c)k.items[c]=h.items[c];k.count=h.count;a.capCenter=b.capCenter};var z={vector:[void 0,void 0],texCoords:[void 0,void 0],direction:[void 0,void 0],base:void 0};a.swapExtrudeVectors=k;var v=[];for(h=
0;32>h;++h)v.push([void 0,void 0]);var y=function(a){var b={items:[],count:0},c;for(c=0;c<a;++c)b.items.push([void 0,void 0]);return b}(8);a.length=l;a.normalize=g;a.getNumberOfSlices=function(a){return Math.max(Math.round(a*C),1)};a.getRads=x;a.reverse=w;var D=[void 0,void 0],F=[void 0,void 0],G=[0,0],E=[0,0],J=[0,0],H=[0,0],I=Math.cos(Math.PI/4),K=Math.sin(Math.PI/4),N=Math.sqrt(2);h=function(){function a(a){this._distanceAlongCorrection=a.distanceAlongCorrection}a.prototype.bridge=function(a,b,
c){var e=b.vectors;b=b.lists[r.EXIT];var d=c.vectors,f=c.lists[r.ENTRY],g,h;if(b.count===f.count+1)c=b.items,g=e.items,h=f.items,d=d.items;else if(f.count===b.count+1)c=f.items,g=d.items,h=b.items,d=e.items;else if(b.count===f.count)c=f.items,g=d.items,h=b.items,d=e.items;else{console.error("Cannot bridge "+b.count+" to "+f.count+".");a.count=0;return}e=b.count+f.count-2;a.count=e;D[0]=c;D[1]=h;F[0]=g;F[1]=d;for(b=0;b<e;++b)c=a.items[b],g=(b+0)%2,g=F[g][D[g][Math.floor((b+0)/2)]],c.v1.vector[0]=g.vector[0],
c.v1.vector[1]=g.vector[1],c.v1.texCoords[0]=g.texCoords[0],c.v1.texCoords[1]=g.texCoords[1],c.v1.direction[0]=g.direction[0],c.v1.direction[1]=g.direction[1],c.v1.base=g.base,g=(b+1)%2,g=F[g][D[g][Math.floor((b+1)/2)]],c.v2.vector[0]=g.vector[0],c.v2.vector[1]=g.vector[1],c.v2.texCoords[0]=g.texCoords[0],c.v2.texCoords[1]=g.texCoords[1],c.v2.direction[0]=g.direction[0],c.v2.direction[1]=g.direction[1],c.v2.base=g.base,g=(b+2)%2,g=F[g][D[g][Math.floor((b+2)/2)]],c.v3.vector[0]=g.vector[0],c.v3.vector[1]=
g.vector[1],c.v3.texCoords[0]=g.texCoords[0],c.v3.texCoords[1]=g.texCoords[1],c.v3.direction[0]=g.direction[0],c.v3.direction[1]=g.direction[1],c.v3.base=g.base,g=c.v1.base&&c.v1.base.point||G,h=c.v2.base&&c.v2.base.point||G,d=c.v3.base&&c.v3.base.point||G,E[0]=g[0]+c.v1.vector[0],E[1]=g[1]+c.v1.vector[1],J[0]=h[0]+c.v2.vector[0],J[1]=h[1]+c.v2.vector[1],H[0]=d[0]+c.v3.vector[0],H[1]=d[1]+c.v3.vector[1],0>(J[0]-E[0])*(H[1]-E[1])-(H[0]-E[0])*(J[1]-E[1])||k(c.v2,c.v3)};a.prototype.pie=function(a,b){if(0===
b.lists[r.CAP].count)a.count=0;else if(1===b.lists[r.CAP].count)console.error("A single vector is not enough to define a pie."),a.count=0;else{a.count=b.lists[r.CAP].count-1;var c;for(c=0;c<a.count;++c){var e=a.items[c],d=b.vectors.items[b.lists[r.CAP].items[c]];e.v1.vector[0]=d.vector[0];e.v1.vector[1]=d.vector[1];e.v1.texCoords[0]=d.texCoords[0];e.v1.texCoords[1]=d.texCoords[1];e.v1.direction[0]=d.direction[0];e.v1.direction[1]=d.direction[1];e.v1.base=d.base;d=b.vectors.items[b.lists[r.CAP].items[c+
1]];e.v2.vector[0]=d.vector[0];e.v2.vector[1]=d.vector[1];e.v2.texCoords[0]=d.texCoords[0];e.v2.texCoords[1]=d.texCoords[1];e.v2.direction[0]=d.direction[0];e.v2.direction[1]=d.direction[1];e.v2.base=d.base;d=b.vectors.items[b.capCenter];e.v3.vector[0]=d.vector[0];e.v3.vector[1]=d.vector[1];e.v3.texCoords[0]=d.texCoords[0];e.v3.texCoords[1]=d.texCoords[1];e.v3.direction[0]=d.direction[0];e.v3.direction[1]=d.direction[1];e.v3.base=d.base;var d=e.v1.base&&e.v1.base.point||G,f=e.v2.base&&e.v2.base.point||
G,g=e.v3.base&&e.v3.base.point||G;E[0]=d[0]+e.v1.vector[0];E[1]=d[1]+e.v1.vector[1];J[0]=f[0]+e.v2.vector[0];J[1]=f[1]+e.v2.vector[1];H[0]=g[0]+e.v3.vector[0];H[1]=g[1]+e.v3.vector[1];0>(J[0]-E[0])*(H[1]-E[1])-(H[0]-E[0])*(J[1]-E[1])||k(e.v2,e.v3)}}};a.prototype.buttCap=function(a,b,c){this.fastMiterJoin(a,b,c)};a.prototype.roundCap=function(a,b,c,e,d,f){void 0===f&&(f=0);this.fastMiterJoin(a,b,c);c=e===t.START?0:1;e=e===t.START?1:0;a.capCenter=a.vectors.count;b=a.vectors.items[a.capCenter];b.vector[0]=
0;b.vector[1]=0;b.texCoords[0]=0;b.texCoords[1]=0;b.direction[0]=0;b.direction[1]=0;++a.vectors.count;u(y,a.vectors.items[c].vector,a.vectors.items[e].vector,d,!1);d=a.vectors.count;b=a.lists[r.CAP];b.items[0]=c;c=a.vectors.items[c].texCoords[1];var g=a.vectors.items[e].texCoords[1],h;for(h=0;h<y.count;++h){var k=f*(1-Math.abs(y.count/2-h)/(y.count/2)),l=c+h/(y.count-1)*(g-c),m=y.items[h],p=a.vectors.items[d+h];p.vector[0]=m[0];p.vector[1]=m[1];p.texCoords[0]=k;p.texCoords[1]=l;p.direction[0]=0;p.direction[1]=
0;b.items[h+1]=d+h}b.items[y.count+1]=e;b.count=y.count+2;a.vectors.count=d+y.count};a.prototype.squareCap=function(a,b,c,e){this.fastMiterJoin(a,b,c);b=e===t.START?0:1;c=e===t.START?1:0;var d=v[0],f=v[1],g=v[2],h=v[3];e=v[4];var k=a.vectors.items[b].vector;d[0]=I*k[0]-K*k[1];d[1]=K*k[0]+I*k[1];m(h,d,N);f[0]=I*d[0]-K*d[1];f[1]=K*d[0]+I*d[1];g[0]=I*f[0]-K*f[1];g[1]=K*f[0]+I*f[1];m(e,g,N);b=a.vectors.items[b];b.vector[0]=h[0];b.vector[1]=h[1];a=a.vectors.items[c];a.vector[0]=e[0];a.vector[1]=e[1]};
a.prototype.squareCapForDashedLines=function(a,b,c,d){if(d===t.START){b=e(v[0],c);c=f(v[4],b);d=v[1];var g=v[2],h=v[3];d[0]=I*b[0]-K*b[1];d[1]=K*b[0]+I*b[1];g[0]=I*d[0]-K*d[1];g[1]=K*d[0]+I*d[1];h[0]=I*g[0]-K*g[1];h[1]=K*g[0]+I*g[1];g=v[5];g[0]=0;g[1]=0;a.capCenter=0;var k=a.vectors.items;k[0].vector[0]=g[0];k[0].vector[1]=g[1];k[0].direction[0]=0;k[0].direction[1]=0;k[0].texCoords[0]=0;k[0].texCoords[1]=0;k[1].vector[0]=b[0];k[1].vector[1]=b[1];k[1].direction[0]=0;k[1].direction[1]=0;k[1].texCoords[0]=
0;k[1].texCoords[1]=-1;k[2].vector[0]=d[0]*N;k[2].vector[1]=d[1]*N;k[2].direction[0]=0;k[2].direction[1]=0;k[2].texCoords[0]=-1;k[2].texCoords[1]=-1;k[3].vector[0]=h[0]*N;k[3].vector[1]=h[1]*N;k[3].direction[0]=0;k[3].direction[1]=0;k[3].texCoords[0]=-1;k[3].texCoords[1]=1;k[4].vector[0]=c[0];k[4].vector[1]=c[1];k[4].direction[0]=0;k[4].direction[1]=0;k[4].texCoords[0]=0;k[4].texCoords[1]=1;a.vectors.count=5;a.lists[r.CAP].count=4;a.lists[r.CAP].items[0]=1;a.lists[r.CAP].items[1]=2;a.lists[r.CAP].items[2]=
3;a.lists[r.CAP].items[3]=4;a.lists[r.ENTRY].count=0;a.lists[r.EXIT].count=3;a.lists[r.EXIT].items[0]=1;a.lists[r.EXIT].items[1]=0;a.lists[r.EXIT].items[2]=4}else b=e(v[0],c),c=f(v[4],b),d=v[1],g=v[2],h=v[3],d[0]=I*c[0]-K*c[1],d[1]=K*c[0]+I*c[1],g[0]=I*d[0]-K*d[1],g[1]=K*d[0]+I*d[1],h[0]=I*g[0]-K*g[1],h[1]=K*g[0]+I*g[1],g=v[5],g[0]=0,g[1]=0,a.capCenter=0,k=a.vectors.items,k[0].vector[0]=g[0],k[0].vector[1]=g[1],k[0].direction[0]=0,k[0].direction[1]=0,k[0].texCoords[0]=0,k[0].texCoords[1]=0,k[1].vector[0]=
c[0],k[1].vector[1]=c[1],k[1].direction[0]=0,k[1].direction[1]=0,k[1].texCoords[0]=0,k[1].texCoords[1]=1,k[2].vector[0]=d[0]*N,k[2].vector[1]=d[1]*N,k[2].direction[0]=0,k[2].direction[1]=0,k[2].texCoords[0]=1,k[2].texCoords[1]=1,k[3].vector[0]=h[0]*N,k[3].vector[1]=h[1]*N,k[3].direction[0]=0,k[3].direction[1]=0,k[3].texCoords[0]=1,k[3].texCoords[1]=-1,k[4].vector[0]=b[0],k[4].vector[1]=b[1],k[4].direction[0]=0,k[4].direction[1]=0,k[4].texCoords[0]=0,k[4].texCoords[1]=-1,a.vectors.count=5,a.lists[r.CAP].count=
4,a.lists[r.CAP].items[0]=1,a.lists[r.CAP].items[1]=2,a.lists[r.CAP].items[2]=3,a.lists[r.CAP].items[3]=4,a.lists[r.ENTRY].count=3,a.lists[r.ENTRY].items[0]=4,a.lists[r.ENTRY].items[1]=0,a.lists[r.ENTRY].items[2]=1,a.lists[r.EXIT].count=0};a.prototype.fastMiterJoin=function(a,b,c){c=e(v[0],c);b=f(v[1],c);var d=a.vectors.items[0];d.vector[0]=c[0];d.vector[1]=c[1];d.texCoords[0]=0;d.texCoords[1]=-1;d.direction[0]=0;d.direction[1]=0;c=a.vectors.items[1];c.vector[0]=b[0];c.vector[1]=b[1];c.texCoords[0]=
0;c.texCoords[1]=1;c.direction[0]=0;c.direction[1]=0;a.vectors.count=2;b=a.lists[r.ENTRY];b.items[0]=0;b.items[1]=1;b.count=2;b=a.lists[r.EXIT];b.items[0]=0;b.items[1]=1;b.count=2;a.lists[r.CAP].count=0;a.capCenter=void 0};a.prototype.miterJoin=function(a,c,d){var h=e(v[0],c),k=e(v[1],d),l=v[2];l[0]=h[0]+k[0];l[1]=h[1]+k[1];k=g(v[3],l);h=b(k,h);k=m(v[4],k,1/h);h=f(v[5],k);this._distanceAlongCorrection?(l=a.vectors.items[0],l.vector[0]=k[0],l.vector[1]=k[1],l.texCoords[0]=0,l.texCoords[1]=-1,l.direction[0]=
c[0],l.direction[1]=c[1],l=a.vectors.items[1],l.vector[0]=h[0],l.vector[1]=h[1],l.texCoords[0]=0,l.texCoords[1]=1,l.direction[0]=c[0],l.direction[1]=c[1],c=a.vectors.items[2],c.vector[0]=k[0],c.vector[1]=k[1],c.texCoords[0]=0,c.texCoords[1]=-1,c.direction[0]=d[0],c.direction[1]=d[1],c=a.vectors.items[3],c.vector[0]=h[0],c.vector[1]=h[1],c.texCoords[0]=0,c.texCoords[1]=1,c.direction[0]=d[0],c.direction[1]=d[1],a.vectors.count=4,d=a.lists[r.ENTRY],d.items[0]=0,d.items[1]=1,d.count=2,d=a.lists[r.EXIT],
d.items[0]=2,d.items[1]=3):(l=a.vectors.items[0],l.vector[0]=k[0],l.vector[1]=k[1],l.texCoords[0]=0,l.texCoords[1]=-1,l.direction[0]=0,l.direction[1]=0,l=a.vectors.items[1],l.vector[0]=h[0],l.vector[1]=h[1],l.texCoords[0]=0,l.texCoords[1]=1,l.direction[0]=0,l.direction[1]=0,a.vectors.count=2,d=a.lists[r.ENTRY],d.items[0]=0,d.items[1]=1,d.count=2,d=a.lists[r.EXIT],d.items[0]=0,d.items[1]=1);d.count=2;a.lists[r.CAP].count=0;a.capCenter=void 0};a.prototype.bevelJoin=function(a,d,h,k){var l=k*k;k=c(d,
h);var u=0<k?[-1,1]:[1,-1],t=u[0],u=u[1],y=0<k?f(v[0],e(v[1],d)):e(v[2],d),x=0<k?f(v[3],e(v[4],h)):e(v[5],h),z=v[6];z[0]=y[0]+x[0];z[1]=y[1]+x[1];var C=g(v[7],z),D=f(v[8],C),F=b(C,y),z=c(C,y),G=Math.abs(z/F),z=1+G*G,E=z<A?[G,this._distanceAlongCorrection]:[Math.sqrt(A-1),!0],H=E[0],E=E[1],J=z<l?[G,this._distanceAlongCorrection]:[Math.sqrt(l-1),!0],G=J[0];(J=J[1])&&E?(E=a.vectors.items[0],p(E.vector,f(v[9],y),m(v[10],f(v[11],d),H)),E.texCoords[0]=0,E.texCoords[1]=t,E.direction[0]=this._distanceAlongCorrection?
d[0]:0,E.direction[1]=this._distanceAlongCorrection?d[1]:0,D=a.vectors.items[1],p(D.vector,f(v[12],x),m(v[13],h,H)),D.texCoords[0]=0,D.texCoords[1]=t,D.direction[0]=this._distanceAlongCorrection?h[0]:0,D.direction[1]=this._distanceAlongCorrection?h[1]:0,t=a.vectors.items[2],t.vector[0]=0,t.vector[1]=0,t.texCoords[0]=0,t.texCoords[1]=0,t.direction[0]=0,t.direction[1]=0,t=a.vectors.items[3],p(t.vector,y,m(v[14],d,G)),t.texCoords[0]=0,t.texCoords[1]=u,t.direction[0]=this._distanceAlongCorrection?d[0]:
0,t.direction[1]=this._distanceAlongCorrection?d[1]:0,d=a.vectors.items[4],p(d.vector,x,m(v[15],f(v[16],h),G)),d.texCoords[0]=0,d.texCoords[1]=u,d.direction[0]=this._distanceAlongCorrection?h[0]:0,d.direction[1]=this._distanceAlongCorrection?h[1]:0,a.vectors.count=5,h=a.lists[r.ENTRY],h.items[0]=0,h.items[1]=2,h.items[2]=3,h.count=3,h=a.lists[r.EXIT],h.items[0]=1,h.items[1]=2,h.items[2]=4,h.count=3,z<l?(l=a.lists[r.CAP],l.count=0,a.capCenter=void 0):(l=a.lists[r.CAP],l.items[0]=3,l.items[1]=4,l.count=
2,a.capCenter=2)):!J&&E?(E=a.vectors.items[0],p(E.vector,f(v[9],y),m(v[10],f(v[11],d),H)),E.texCoords[0]=0,E.texCoords[1]=t,E.direction[0]=this._distanceAlongCorrection?d[0]:0,E.direction[1]=this._distanceAlongCorrection?d[1]:0,D=a.vectors.items[1],p(D.vector,f(v[12],x),m(v[13],h,H)),D.texCoords[0]=0,D.texCoords[1]=t,D.direction[0]=this._distanceAlongCorrection?h[0]:0,D.direction[1]=this._distanceAlongCorrection?h[1]:0,t=a.vectors.items[2],t.vector[0]=0,t.vector[1]=0,t.texCoords[0]=0,t.texCoords[1]=
0,t.direction[0]=0,t.direction[1]=0,t=a.vectors.items[3],m(t.vector,C,1/F),t.texCoords[0]=0,t.texCoords[1]=u,t.direction[0]=0,t.direction[1]=0,a.vectors.count=4,h=a.lists[r.ENTRY],h.items[0]=0,h.items[1]=2,h.items[2]=3,h.count=3,h=a.lists[r.EXIT],h.items[0]=1,h.items[1]=2,h.items[2]=3,h.count=3,a.lists[r.CAP].count=0,a.capCenter=void 0):J&&!E?(E=a.vectors.items[0],m(E.vector,D,1/F),E.texCoords[0]=0,E.texCoords[1]=t,E.direction[0]=0,E.direction[1]=0,D=a.vectors.items[1],D.vector[0]=0,D.vector[1]=0,
D.texCoords[0]=0,D.texCoords[1]=0,D.direction[0]=0,D.direction[1]=0,t=a.vectors.items[2],p(t.vector,y,m(v[9],d,G)),t.texCoords[0]=0,t.texCoords[1]=u,t.direction[0]=this._distanceAlongCorrection?d[0]:0,t.direction[1]=this._distanceAlongCorrection?d[1]:0,t=a.vectors.items[3],p(t.vector,x,m(v[10],f(v[11],h),G)),t.texCoords[0]=0,t.texCoords[1]=u,t.direction[0]=this._distanceAlongCorrection?h[0]:0,t.direction[1]=this._distanceAlongCorrection?h[1]:0,a.vectors.count=4,h=a.lists[r.ENTRY],h.items[0]=0,h.items[1]=
1,h.items[2]=2,h.count=3,h=a.lists[r.EXIT],h.items[0]=0,h.items[1]=1,h.items[2]=3,h.count=3,z<l?(l=a.lists[r.CAP],l.count=0,a.capCenter=void 0):(l=a.lists[r.CAP],l.items[0]=2,l.items[1]=3,l.count=2,a.capCenter=1)):J||E||(E=a.vectors.items[0],m(E.vector,D,1/F),E.texCoords[0]=0,E.texCoords[1]=t,E.direction[0]=0,E.direction[1]=0,D=a.vectors.items[1],m(D.vector,C,1/F),D.texCoords[0]=0,D.texCoords[1]=u,D.direction[0]=0,D.direction[1]=0,a.vectors.count=2,h=a.lists[r.ENTRY],h.items[0]=0,h.items[1]=1,h.count=
2,h=a.lists[r.EXIT],h.items[0]=0,h.items[1]=1,h.count=2,a.lists[r.CAP].count=0,a.capCenter=void 0);0>k&&(w(a.lists[r.ENTRY]),w(a.lists[r.EXIT]))};a.prototype.roundJoin=function(a,d,h,k){var l=c(d,h),t=0<l?[-1,1]:[1,-1],x=t[0],t=t[1],z=0<l?f(v[0],e(v[1],d)):e(v[2],d),C=0<l?f(v[3],e(v[4],h)):e(v[5],h),D=v[6];D[0]=z[0]+C[0];D[1]=z[1]+C[1];var E=g(v[7],D),D=f(v[8],E),F=b(E,z),E=c(E,z),E=Math.abs(E/F),G=1+E*E<A?[E,this._distanceAlongCorrection]:[Math.sqrt(A-1),!0],E=G[0];G[1]?(G=a.vectors.items[0],G.vector[0]=
z[0],G.vector[1]=z[1],G.texCoords[0]=0,G.texCoords[1]=t,G.direction[0]=0,G.direction[1]=0,G=a.vectors.items[1],G.vector[0]=C[0],G.vector[1]=C[1],G.texCoords[0]=0,G.texCoords[1]=t,G.direction[0]=0,G.direction[1]=0,G=a.vectors.items[2],p(G.vector,f(v[9],z),m(v[10],f(v[11],d),E)),G.texCoords[0]=0,G.texCoords[1]=x,G.direction[0]=this._distanceAlongCorrection?d[0]:0,G.direction[1]=this._distanceAlongCorrection?d[1]:0,d=a.vectors.items[3],p(d.vector,f(v[12],C),m(v[13],h,E)),d.texCoords[0]=0,d.texCoords[1]=
x,d.direction[0]=this._distanceAlongCorrection?h[0]:0,d.direction[1]=this._distanceAlongCorrection?h[1]:0,h=a.vectors.items[4],h.vector[0]=0,h.vector[1]=0,h.texCoords[0]=0,h.texCoords[1]=0,h.direction[0]=0,h.direction[1]=0,a.vectors.count=5,h=a.lists[r.ENTRY],h.items[0]=2,h.items[1]=4,h.items[2]=0,h.count=3,h=a.lists[r.EXIT],h.items[0]=3,h.items[1]=4,h.items[2]=1,h.count=3,a.capCenter=4):(G=a.vectors.items[0],G.vector[0]=z[0],G.vector[1]=z[1],G.texCoords[0]=0,G.texCoords[1]=t,G.direction[0]=0,G.direction[1]=
0,G=a.vectors.items[1],G.vector[0]=C[0],G.vector[1]=C[1],G.texCoords[0]=0,G.texCoords[1]=t,G.direction[0]=0,G.direction[1]=0,G=a.vectors.items[2],m(G.vector,D,1/F),G.texCoords[0]=0,G.texCoords[1]=x,G.direction[0]=0,G.direction[1]=0,d=a.vectors.items[3],d.vector[0]=0,d.vector[1]=0,d.texCoords[0]=0,d.texCoords[1]=0,d.direction[0]=0,d.direction[1]=0,a.vectors.count=4,h=a.lists[r.ENTRY],h.items[0]=2,h.items[1]=3,h.items[2]=0,h.count=3,h=a.lists[r.EXIT],h.items[0]=2,h.items[1]=3,h.items[2]=1,h.count=3,
a.capCenter=3);u(y,z,C,k,0>l);k=a.vectors.count;z=a.lists[r.CAP];for(C=z.items[0]=0;C<y.count;++C)h=y.items[C],x=a.vectors.items[k+C],x.vector[0]=h[0],x.vector[1]=h[1],x.texCoords[0]=0,x.texCoords[1]=t,x.direction[0]=0,x.direction[1]=0,z.items[C+1]=k+C;z.items[y.count+1]=1;z.count=y.count+2;a.vectors.count=k+y.count;0>l&&(w(a.lists[r.ENTRY]),w(a.lists[r.EXIT]))};a.prototype.unitRoundJoin=function(a,b,d,g){var h=c(b,d),k=0<h?[-1,1]:[1,-1],l=k[0],k=k[1];b=0<h?f(v[0],e(v[1],b)):e(v[2],b);d=0<h?f(v[3],
e(v[4],d)):e(v[5],d);var m=a.vectors.items[0];m.vector[0]=b[0];m.vector[1]=b[1];m.texCoords[0]=0;m.texCoords[1]=k;m.direction[0]=0;m.direction[1]=0;m=a.vectors.items[1];m.vector[0]=d[0];m.vector[1]=d[1];m.texCoords[0]=0;m.texCoords[1]=k;m.direction[0]=0;m.direction[1]=0;m=a.vectors.items[2];f(m.vector,b);m.texCoords[0]=0;m.texCoords[1]=l;m.direction[0]=0;m.direction[1]=0;m=a.vectors.items[3];f(m.vector,d);m.texCoords[0]=0;m.texCoords[1]=l;m.direction[0]=0;m.direction[1]=0;l=a.vectors.items[4];l.vector[0]=
0;l.vector[1]=0;l.texCoords[0]=0;l.texCoords[1]=0;l.direction[0]=0;l.direction[1]=0;a.vectors.count=5;l=a.lists[r.ENTRY];l.items[0]=2;l.items[1]=0;l.count=2;l=a.lists[r.EXIT];l.items[0]=3;l.items[1]=1;l.count=2;a.capCenter=4;u(y,b,d,g,0>h);g=a.vectors.count;b=a.lists[r.CAP];for(l=b.items[0]=0;l<y.count;++l)d=y.items[l],m=a.vectors.items[g+l],m.vector[0]=d[0],m.vector[1]=d[1],m.texCoords[0]=0,m.texCoords[1]=k,m.direction[0]=0,m.direction[1]=0,b.items[l+1]=g+l;b.items[y.count+1]=1;b.count=y.count+2;
a.vectors.count=g+y.count;0>h&&(w(a.lists[r.ENTRY]),w(a.lists[r.EXIT]))};a.prototype.rectJoin=function(a,b,c){b=e(v[0],b);c=e(v[1],c);var d=a.vectors.items[0];d.vector[0]=b[0];d.vector[1]=b[1];d.texCoords[0]=0;d.texCoords[1]=-1;d.direction[0]=0;d.direction[1]=0;d=a.vectors.items[1];d.vector[0]=c[0];d.vector[1]=c[1];d.texCoords[0]=0;d.texCoords[1]=-1;d.direction[0]=0;d.direction[1]=0;d=a.vectors.items[2];f(d.vector,b);d.texCoords[0]=0;d.texCoords[1]=1;d.direction[0]=0;d.direction[1]=0;b=a.vectors.items[3];
f(b.vector,c);b.texCoords[0]=0;b.texCoords[1]=1;b.direction[0]=0;b.direction[1]=0;a.vectors.count=4;b=a.lists[r.ENTRY];b.items[0]=0;b.items[1]=2;b.count=2;b=a.lists[r.EXIT];b.items[0]=1;b.items[1]=3;b.count=2;a.capCenter=void 0};return a}();a.Tessellator=h})},"esri/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix-2/gl-matrix ../../color ../../definitions ../../enums ../../number ../../WGLDisplayRecord ./WGLMeshTemplate".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p){Object.defineProperty(a,"__esModule",{value:!0});var x=k.getLogger("esri.views.2d.engine.webgl.WGLMeshTemplate");h=function(a){function h(b,d,e,g,h,k,m,p,u,w,x){var t=a.call(this)||this;t.geometryType=c.WGLGeometryType.MARKER;var r=l.vec2f32.create(),v=l.mat2df32.create();m=0===m?0:Math.max(m,2);p=0===p?0:Math.max(p,2);var y=x.sdf?.5:1;l.mat2d.translate(v,v,l.vec2f32.fromValues(y*e,y*-g));h&&l.mat2d.rotate(v,v,3.14159265359/180*h);t._materialStore=b;t.vvFlags=d;t._materialId=
b.createSpriteMaterial(x,t.geometryType,d);t._fillColor=k;t._outlineColor=u;t._sizeOutlineWidth=f.i8888to32(m,p,w,0);b=Math.round(x.rect.x/4)-128;d=Math.round(x.rect.y/4)-128;h=b+Math.round(x.rect.width/4);x=d+Math.round(x.rect.height/4);l.vec2.set(r,-.5*m,-.5*p);l.vec2.transformMat2d(r,r,v);t._offsetAndTexUpperLeft=f.i8888to32(r[0],r[1],b,d);l.vec2.set(r,.5*m,-.5*p);l.vec2.transformMat2d(r,r,v);t._offsetAndTexUpperRight=f.i8888to32(r[0],r[1],h,d);l.vec2.set(r,-.5*m,.5*p);l.vec2.transformMat2d(r,
r,v);t._offsetAndTexBottomLeft=f.i8888to32(r[0],r[1],b,x);l.vec2.set(r,.5*m,.5*p);l.vec2.transformMat2d(r,r,v);t._offsetAndTexBottomRight=f.i8888to32(r[0],r[1],h,x);t.height=p;t.width=m;t.xOffset=e;t.yOffset=g;return t}d(h,a);h.fromPictureMarker=function(a,c,d,f,g){g=Math.round(b.pt2px(d.width));var k=Math.round(b.pt2px(d.height)),l=e.PICTURE_FILL_COLOR,m=Math.round(b.pt2px(d.xoffset||0)),p=Math.round(b.pt2px(d.yoffset||0));return new h(a,c,m,p,d.angle,l,g,k,0,0,f)};h.fromSimpleMarker=function(a,
c,d,e,f){f=g.premultiplyAlphaRGBA(d.color);var k=Math.round(b.pt2px(d.size)),l=Math.round(b.pt2px(d.xoffset||0)),m=Math.round(b.pt2px(d.yoffset||0)),p=d.outline,t=(p&&p.color&&g.premultiplyAlphaRGBA(p.color))|0,p=(p&&p.width&&Math.round(b.pt2px(p.width)))|0;return new h(a,c,l,m,d.angle,f,k,k,t,p,e)};h.prototype.writeMesh=function(a,b,c,d,e,f,g){f=this._materialStore.get(this._materialId);var h=b.indexVector,k=b.get("geometry");b=b.get("visibility");var l=new m(d,this.geometryType,this._materialId),
p=this._getOffset(k,f);a.push(l);l.vertexFrom=p;l.indexFrom=h.length;switch(c){case "esriGeometryPoint":c=e.geometry;a=c.x;c=c.y;this._writeVertices(l,k,b,d,this._getPos(a,c),f,g);this._writeIndices(l,h,p);break;case "esriGeometryPolyline":this._writeMany(l,h,k,b,p,d,e.geometry.paths[0],f,g);break;case "esriGeometryPolygon":(c=e.centroid)?(a=c.x,c=c.y,this._writeVertices(l,k,b,d,this._getPos(a,c),f,g),this._writeIndices(l,h,p)):x.error("Tried to render polygon geometries as markers, but found no centroid!");
break;case "esriGeometryMultipoint":this._writeMany(l,h,k,b,p,d,e.geometry.points,f,g);break;default:x.error("Unable to handle geometryType: "+c)}};h.prototype._getPos=function(a,b){return f.i1616to32(a,b)};h.prototype._writeMany=function(a,b,c,d,e,f,g,h,k){for(var l=0,m=0,p=0,t=0;t<g.length;t++){var u=g[t],r=u[0],u=u[1];this._writeVertices(a,c,d,f,this._getPos(r+l,u+m),h,k);this._writeIndices(a,b,e+p);l+=r;m+=u;p+=4}};h.prototype._getOffset=function(a,b){b=b.materialKeyInfo.hasVV()?10:6;return a.length/
b};h.prototype._writeVertices=function(a,b,c,d,e,f,g){b.push(e);b.push(this._offsetAndTexUpperLeft);b.push(d);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);this._writeVV(b,g,f);c.push(255);b.push(e);b.push(this._offsetAndTexUpperRight);b.push(d);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);this._writeVV(b,g,f);c.push(255);b.push(e);b.push(this._offsetAndTexBottomLeft);b.push(d);b.push(this._fillColor);b.push(this._outlineColor);
b.push(this._sizeOutlineWidth);this._writeVV(b,g,f);c.push(255);b.push(e);b.push(this._offsetAndTexBottomRight);b.push(d);b.push(this._fillColor);b.push(this._outlineColor);b.push(this._sizeOutlineWidth);this._writeVV(b,g,f);c.push(255);a.vertexCount+=4};h.prototype._writeVV=function(a,b,d){d.materialKeyInfo.hasVV()&&(a.push(b[c.VVType.SIZE]),a.push(b[c.VVType.COLOR]),a.push(b[c.VVType.OPACITY]),a.push(b[c.VVType.ROTATION]))};h.prototype._writeIndices=function(a,b,c){b.push(c+0);b.push(c+1);b.push(c+
2);b.push(c+1);b.push(c+3);b.push(c+2);a.indexCount+=6};return h}(p.default);a.default=h})},"esri/views/2d/engine/webgl/mesh/templates/WGLTemplateStore":function(){define("require exports ../../../../../../core/tsSupport/awaiterHelper ../../../../../../core/tsSupport/generatorHelper ../../../../../../symbols ../../../../../../core/Error ../../../../../../core/Logger ../../../../../../core/promiseUtils ../../enums ./WGLFillTemplate ./WGLLineTemplate ./WGLMarkerTemplate ./WGLTextTemplate ../../util/BidiText ../../util/Lock ../../util/Result ../../util/vvFlagUtils".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w,r,t){function A(a,b){var c=a.length;a.push(null);b.then(function(b){return a[c]=b});return a}Object.defineProperty(a,"__esModule",{value:!0});var C=g.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),z=[],v=new b.SimpleFillSymbol({color:"black",outline:null}),y=new b.SimpleMarkerSymbol({size:"14px",color:"black",outline:null}),D=new b.SimpleLineSymbol({color:"black",width:"2px"});h=function(){function a(a,b){this._templateIdCounter=this._idCounter=
0;this._idToTemplateGroup=new Map;this._symbolToTemplate=new Map;this._fetchQueue=[];this._idToResolver=new Map;this._pixelRatio=1;this._lock=new w.default;this._fetchResource=a;this._pixelRatio=b}Object.defineProperty(a.prototype,"_markerError",{get:function(){return this._errorTemplates.marker[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_fillError",{get:function(){return this._errorTemplates.fill[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"_lineError",
{get:function(){return this._errorTemplates.line[0]},enumerable:!0,configurable:!0});a.prototype.createTemplateGroup=function(a,b,c,d){this._initErrorTemplates(c);var e=this._hashSymbol(a);if(!this._symbolToTemplate.has(e)){var f=[];b&&this._createMeshTemplates(f,c,b,d,this._pixelRatio,!0);this._createMeshTemplates(f,c,a,d,this._pixelRatio,!1);a=this._createGroupId();this._idToTemplateGroup.set(a,f);this._symbolToTemplate.set(e,a)}return this._symbolToTemplate.get(e)};a.prototype.getTemplateGroup=
function(a){return this._idToTemplateGroup.has(a)?this._idToTemplateGroup.get(a):z};a.prototype.finalize=function(){return this._fetchQueue.length||this._lock.isHeld()?w.withLock(this._lock,this._fetchAllQueuedResources.bind(this)):e.resolve()};a.prototype._initErrorTemplates=function(a){if(!this._errorTemplates){var b=this._pixelRatio,c=this._createMeshTemplates([],a,v,0,b,!1),d=this._createMeshTemplates([],a,y,0,b,!1);a=this._createMeshTemplates([],a,D,0,b,!1);this._errorTemplates={fill:c,marker:d,
line:a}}};a.prototype._fetchAllQueuedResources=function(){var a=this;if(!this._fetchQueue.length)return e.resolve();var b=this._fetchQueue;this._fetchQueue=[];return this._fetchResource(b).then(function(b){for(var c=0;c<b.length;c++){var d=b[c],e=d.id,d=d.mosaicItem;a._idToResolver.get(e)(d);a._idToResolver.delete(e)}}).catch(function(c){"cancel"===c.dojoType?a._fetchQueue=a._fetchQueue.concat(b):C.error(new l("mapview-template-store","Unable to fetch requested texture resources",c))})};a.prototype._createGroupId=
function(){return this._idCounter++};a.prototype._createTemplateId=function(){return this._templateIdCounter++};a.prototype._getCodepoints=function(a){a=u.bidiText(a.text)[0];for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c));return b};a.prototype._getMosaicItem=function(a){var b=this,c=this._createTemplateId(),d="text"===a.type&&this._getCodepoints(a),f=e.create(function(a){return b._idToResolver.set(c,a)});this._fetchQueue.push({symbol:a.toJSON(),id:c,glyphIds:d});return f};a.prototype._hashSymbol=
function(a){return a.id?a.id:JSON.stringify(a)};a.prototype._createSMS=function(a,b,c,e){return d(this,void 0,void 0,function(){var d,f;return k(this,function(g){switch(g.label){case 0:return[4,this._getMosaicItem(b)];case 1:return d=g.sent().spriteMosaicItem,f=t.getMarkerVVFlags(c),r.ok(d,C)?[2,p.default.fromSimpleMarker(a,f,b,d,e)]:[2,this._markerError]}})})};a.prototype._createPMS=function(a,b,c,e){return d(this,void 0,void 0,function(){var d,f;return k(this,function(g){switch(g.label){case 0:return[4,
this._getMosaicItem(b)];case 1:return d=g.sent().spriteMosaicItem,f=t.getMarkerVVFlags(c),r.ok(d,C)?[2,p.default.fromPictureMarker(a,f,b,d,e)]:[2,this._markerError]}})})};a.prototype._createSFS=function(a,b,c,e,g){return d(this,void 0,void 0,function(){var d,h;return k(this,function(k){switch(k.label){case 0:return[4,this._getMosaicItem(b)];case 1:return d=k.sent().spriteMosaicItem,h=t.getFillVVFlags(c),r.ok(d,C)?[2,f.default.fromSimpleFill(a,h,b,d,e,g)]:[2,this._fillError]}})})};a.prototype._createPFS=
function(a,b,c,e,g){return d(this,void 0,void 0,function(){var d,h;return k(this,function(k){switch(k.label){case 0:return[4,this._getMosaicItem(b)];case 1:return d=k.sent().spriteMosaicItem,h=t.getFillVVFlags(c),r.ok(d,C)?[2,f.default.fromPictureFill(a,h,b,d,e,g)]:[2,this._fillError]}})})};a.prototype._createSLS=function(a,b,c,e,f){return d(this,void 0,void 0,function(){var d,g;return k(this,function(h){switch(h.label){case 0:return[4,this._getMosaicItem(b)];case 1:return d=h.sent().spriteMosaicItem,
g=t.getLineVVFlags(c,f),r.ok(d,C)?[2,m.default.fromSimpleLine(a,g,b,d,e)]:[2,this._lineError]}})})};a.prototype._createTS=function(a,b,c,e){return d(this,void 0,void 0,function(){var d,f;return k(this,function(g){switch(g.label){case 0:return[4,this._getMosaicItem(b)];case 1:return d=g.sent().glyphMosaicItems,f=t.getTextVVFlags(c),[2,x.default.fromText(a,f,b,e,d)]}})})};a.prototype._createMeshTemplates=function(a,b,d,e,f,g){if(-1!==d.type.indexOf("3d"))return C.error("3D symbols are not supported with MapView"),
a;switch(d.type){case c.EsriSymbolTypeKebab.SIMPLE_MARKER:return A(a,this._createSMS(b,d,e,f));case c.EsriSymbolTypeKebab.PICTURE_MARKER:return A(a,this._createPMS(b,d,e,f));case c.EsriSymbolTypeKebab.SIMPLE_FILL:return A(a,this._createSFS(b,d,e,f,g)),d.outline&&A(a,this._createSLS(b,d.outline,e,f,!0)),a;case c.EsriSymbolTypeKebab.PICTURE_FILL:return A(a,this._createPFS(b,d,e,f,g)),d.outline&&A(a,this._createSLS(b,d.outline,e,f,!0)),a;case c.EsriSymbolTypeKebab.SIMPLE_LINE:return A(a,this._createSLS(b,
d,e,f,!1));case c.EsriSymbolTypeKebab.TEXT:return A(a,this._createTS(b,d,e,f));default:return C.error("Unable to create mesh template for unknown symbol type: "+d.type),a}};return a}();a.default=h})},"esri/views/2d/engine/webgl/mesh/templates/WGLFillTemplate":function(){define("require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/earcut/earcut ../../color ../../definitions ../../enums ../../enums ../../number ../../TileClipper ../../WGLDisplayRecord ../Tesselator ./WGLMeshTemplate".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w){Object.defineProperty(a,"__esModule",{value:!0});var r=k.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLFillTemplate"),t=[],A=[];h=function(a){function h(b,d,f,g,h,k,l,m,t){var r=a.call(this)||this;r.fillColor=g;r.tl=h;r.br=k;r.aux1=l;r.aux2=m;r.isBFS=t;r.geometryType=c.WGLGeometryType.FILL;r.useLibtess=!0;r._tesselator=new u.default;r.vvFlags=d;r._materialStore=b;r.materialId=r._materialStore.createSpriteMaterial(f,r.geometryType,d);r._tileClipper=
new p.TileClipper(0,0,0,1,8);r._tileClipper.setExtent(e.TILE_SIZE);return r}d(h,a);h.fromSimpleFill=function(a,b,c,d,e,f){void 0===f&&(f=!1);c=(e=c.color)&&"none"!==c.style&&g.premultiplyAlphaRGBA(e)||0;if(!d)return new h(a,b,null,c,0,0,0,0,f);e=d.rect;var k=e.x+1,l=e.y+1,p=e.x+1+d.width,u=e.y+1+d.height;e=m.i1616to32(k,l);var r=m.i1616to32(p,u),k=m.i8888to32(m.nextHighestPowerOfTwo(p-k),m.nextHighestPowerOfTwo(u-l),0,0),l=m.i1616to32(128,128);return new h(a,b,d,c,e,r,k,l,f)};h.fromPictureFill=function(a,
c,d,f,g,k){void 0===k&&(k=!1);g=e.PICTURE_FILL_COLOR;var l=f.rect,p=l.x+1,u=l.y+1,l=p+f.width,r=u+f.height,p=m.i1616to32(p,u),l=m.i1616to32(l,r),r=m.nextHighestPowerOfTwo(b.pt2px(d.width));255<r&&(r=255);u=m.nextHighestPowerOfTwo(b.pt2px(d.height));255<u&&(u=255);var t=b.pt2px(d.xoffset)+128;255<t&&(t=255);var v=b.pt2px(-d.yoffset)+128;255<v&&(v=255);r=m.i8888to32(r,u,t,v);d=m.i1616to32(128*d.xscale,128*d.yscale);return new h(a,c,f,g,p,l,r,d,k)};h.prototype.writeMesh=function(a,b,c,d,e,g,h){t.length=
0;if(this.vvFlags&f.WGLVVFlag.COLOR||0!==this.fillColor)if("esriGeometryPolygon"!==c)r.error("Unable to handle geometryType: "+c);else{var k=e.geometry,k=(e=this._isClippingRequired(k))?this._clip(k,!this.useLibtess):k.rings;return this.useLibtess?this._writeMeshLibtess(a,b,c,d,k,e,g,h):this._writeMeshEarcut(a,b,c,d,k,e,g,h)}};h.prototype._isClippingRequired=function(a){var b=e.TILE_SIZE+8,c=0;for(a=a.rings;c<a.length;c++){var d=a[c],f=d.length;if(!(3>f)){var g=d[0][0],h=d[0][1];if(-8>g||g>b||-8>
h||h>b)return!0;for(var k=1;k<f;++k)if(g+=d[k][0],h+=d[k][1],-8>g||g>b||-8>h||h>b)return!0}}return!1};h.prototype._clip=function(a,b){var c;this._tileClipper.reset(3);for(var d=0,e=a.rings;d<e.length;d++){var f=e[d],g=f.length;if(!(3>g)){a=f[0][0];c=f[0][1];this._tileClipper.moveTo(a,c);for(var h=1;h<g;++h)a+=f[h][0],c+=f[h][1],this._tileClipper.lineTo(a,c);this._tileClipper.close()}}return this._tileClipper.result(b)};h.prototype._writeMeshLibtess=function(a,b,c,d,e,f,g,h){if(e&&e.length){c=this._materialStore.get(this.materialId);
g=[];var k=b.indexVector,l=b.get("geometry");b=b.get("visibility");var m=new x(d,this.geometryType,this.materialId),p=this._getOffset(l,c);m.vertexFrom=p;m.indexFrom=k.length;this._tesselator.beginPolygon(t,g);for(var u=0;u<e.length;u++){var r=e[u];if(!(3>r.length)){this._tesselator.beginContour();var w=void 0,v=void 0;f?(w=r[0].x,v=r[0].y):(w=r[0][0],v=r[0][1]);var y=[w,v,0];this._tesselator.addVertex(y,y);for(y=1;y<r.length-1;y++){var A=void 0,z=void 0;f?(w=r[y].x,v=r[y].y):(A=r[y][0],z=r[y][1],
w+=A,v+=z);A=[w,v,0];this._tesselator.addVertex(A,A)}this._tesselator.endContour()}}this._tesselator.endPolygon();this._writeVerticesLibTess(m,l,b,d,t,c,h);this._writeIndicesLibTess(m,k,p,g);0<m.indexCount&&a.push(m)}};h.prototype._writeMeshEarcut=function(a,b,c,d,e,f,g,h){if(e&&e.length){c=this._materialStore.get(this.materialId);g=b.indexVector;var k=b.get("geometry");b=b.get("visibility");var l=new x(d,this.geometryType,this.materialId),m=this._getOffset(k,c);l.vertexFrom=m;l.indexFrom=g.length;
a.push(l);for(var p=a=0,u=0;u<e.length;u++){var r=e[u],w=p,v=void 0,y=void 0;f?(v=r[0].x,y=r[0].y):(v=r[0][0],y=r[0][1]);t[p++]=v;t[p++]=y;for(var z=0,C=1;C<r.length;++C){var D=void 0,F=void 0;f?(D=v,F=y,v=r[C].x,y=r[C].y,D=v-D,F=y-F):(D=r[C][0],F=r[C][1],v+=D,y+=F);z-=D*(y+y+F);t[p++]=v;t[p++]=y}0<z?(0<w-a&&(this._write(l,g,k,b,m,d,t,A,a,w,c,h),a=w),A.length=0):0>z?0<w-a?A.push(.5*(w-a)):p=w:p=w}0<p-a&&this._write(l,g,k,b,m,d,t,A,a,p,c,h);t.length=A.length=0}};h.prototype._write=function(a,b,c,d,
e,f,g,h,k,m,p,u){e=l(g.slice(k,m),h,2);e.length&&(k=this._getOffset(c,p),this._writeVertices(a,c,d,f,g,h,p,u),this._writeIndices(a,b,k,e))};h.prototype._getOffset=function(a,b){b=b.materialKeyInfo.hasVV()?9:7;return a.length/b};h.prototype._writeVertices=function(a,b,c,d,e,f,g,h){for(f=0;f<e.length;f+=2){var k=m.i1616to32(e[f],e[f+1]);b.push(k);b.push(d);b.push(this.fillColor);b.push(this.tl);b.push(this.br);b.push(this.aux1);b.push(this.aux2);this._writeVV(b,h,g);c.push(255);a.vertexCount++}};h.prototype._writeIndices=
function(a,b,c,d){for(var e=0;e<d.length;e+=3)b.push(c+d[e]),b.push(c+d[e+1]),b.push(c+d[e+2]),a.indexCount+=3};h.prototype._writeVerticesLibTess=function(a,b,c,d,e,f,g){for(var h=0;h<e.length;h+=2){var k=m.i1616to32(e[h],e[h+1]);b.push(k);b.push(d);b.push(this.fillColor);b.push(this.tl);b.push(this.br);b.push(this.aux1);b.push(this.aux2);this._writeVV(b,g,f);c.push(255);a.vertexCount++}};h.prototype._writeIndicesLibTess=function(a,b,c,d){for(var e=0;e<d.length;e++)b.push(c+d[e]),a.indexCount++};
h.prototype._writeVV=function(a,b,d){d.materialKeyInfo.hasVV()&&(this.isBFS?(a.writeF32(1E-30),a.writeF32(1E-30)):(a.push(b[c.VVType.COLOR]),a.push(b[c.VVType.OPACITY])))};return h}(w.default);a.default=h})},"esri/views/2d/engine/webgl/mesh/Tesselator":function(){define(["require","exports","../../../../../core/Logger","../../../../../core/libs/libtess/libtess"],function(h,a,d,k){Object.defineProperty(a,"__esModule",{value:!0});var b=d.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");
h=function(){function a(){this._indexCounter=this._currentVertexIndex=0;this._triangleIndices=[-1,-1,-1];this.glu=new k.GluTesselator;this.glu.gluTessCallback(k.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_END,this._endcallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_ERROR,
this._errorcallback.bind(this));this.glu.gluTessCallback(k.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this));this.glu.gluTessProperty(k.gluEnum.GLU_TESS_WINDING_RULE,k.windingRule.GLU_TESS_WINDING_ODD)}a.prototype.beginPolygon=function(a,b){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._indexCounter=this._currentVertexIndex=0;this.glu.gluTessBeginPolygon(a);this._indices=b};a.prototype.endPolygon=function(){this.glu.gluTessEndPolygon()};a.prototype.beginContour=
function(){this.glu.gluTessBeginContour()};a.prototype.endContour=function(){this.glu.gluTessEndContour()};a.prototype.addVertex=function(a,b){this.glu.gluTessVertex(a,b)};a.prototype._vertexCallback=function(a,b){b[b.length]=a[0];b[b.length]=a[1];this._triangleIndices[this._currentVertexIndex]=-1;if(2<=this._currentVertexIndex){for(a=0;3>a;a++)-1===this._triangleIndices[a]&&(this._triangleIndices[a]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[a];this._currentVertexIndex=
0}else this._currentVertexIndex++};a.prototype._begincallback=function(a){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._currentVertexIndex=0};a.prototype._endcallback=function(){this._currentVertexIndex=0};a.prototype._errorcallback=function(a){b.error("Encountered error during tesselation: "+a)};a.prototype._combinecallback=function(a,b,c){return[a[0],a[1],a[2]]};a.prototype._edgeCallback=function(a){};return a}();a.default=h})},"esri/core/libs/libtess/libtess":function(){define([],
function(){var h={DEBUG:!1,assert:function(a,d){if(h.DEBUG&&!a)throw Error("Assertion failed"+(d?": "+d:""));},GLU_TESS_MAX_COORD:1E150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,
GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,
GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},geom:{}};h.geom.vertEq=function(a,d){return a.s===d.s&&a.t===d.t};h.geom.vertLeq=function(a,d){return a.s<d.s||a.s===d.s&&a.t<=d.t};h.geom.edgeEval=function(a,d,k){h.assert(h.geom.vertLeq(a,d)&&h.geom.vertLeq(d,k));var b=d.s-a.s,l=k.s-d.s;return 0<b+l?b<l?d.t-a.t+b/(b+l)*(a.t-k.t):d.t-k.t+l/(b+l)*(k.t-a.t):0};h.geom.edgeSign=function(a,d,k){h.assert(h.geom.vertLeq(a,d)&&h.geom.vertLeq(d,k));
var b=d.s-a.s,l=k.s-d.s;return 0<b+l?(d.t-k.t)*b+(d.t-a.t)*l:0};h.geom.transLeq=function(a,d){return a.t<d.t||a.t===d.t&&a.s<=d.s};h.geom.transEval=function(a,d,k){h.assert(h.geom.transLeq(a,d)&&h.geom.transLeq(d,k));var b=d.t-a.t,l=k.t-d.t;return 0<b+l?b<l?d.s-a.s+b/(b+l)*(a.s-k.s):d.s-k.s+l/(b+l)*(k.s-a.s):0};h.geom.transSign=function(a,d,k){h.assert(h.geom.transLeq(a,d)&&h.geom.transLeq(d,k));var b=d.t-a.t,l=k.t-d.t;return 0<b+l?(d.s-k.s)*b+(d.s-a.s)*l:0};h.geom.edgeGoesLeft=function(a){return h.geom.vertLeq(a.dst(),
a.org)};h.geom.edgeGoesRight=function(a){return h.geom.vertLeq(a.org,a.dst())};h.geom.vertL1dist=function(a,d){return Math.abs(a.s-d.s)+Math.abs(a.t-d.t)};h.geom.vertCCW=function(a,d,h){return 0<=a.s*(d.t-h.t)+d.s*(h.t-a.t)+h.s*(a.t-d.t)};h.geom.interpolate_=function(a,d,h,b){a=0>a?0:a;h=0>h?0:h;return a<=h?0===h?(d+b)/2:d+a/(a+h)*(b-d):b+h/(a+h)*(d-b)};h.geom.edgeIntersect=function(a,d,k,b,l){var g,e;h.geom.vertLeq(a,d)||(g=a,a=d,d=g);h.geom.vertLeq(k,b)||(g=k,k=b,b=g);h.geom.vertLeq(a,k)||(g=a,
a=k,k=g,g=d,d=b,b=g);h.geom.vertLeq(k,d)?h.geom.vertLeq(d,b)?(g=h.geom.edgeEval(a,k,d),e=h.geom.edgeEval(k,d,b),0>g+e&&(g=-g,e=-e),l.s=h.geom.interpolate_(g,k.s,e,d.s)):(g=h.geom.edgeSign(a,k,d),e=-h.geom.edgeSign(a,b,d),0>g+e&&(g=-g,e=-e),l.s=h.geom.interpolate_(g,k.s,e,b.s)):l.s=(k.s+d.s)/2;h.geom.transLeq(a,d)||(g=a,a=d,d=g);h.geom.transLeq(k,b)||(g=k,k=b,b=g);h.geom.transLeq(a,k)||(g=a,a=k,k=g,g=d,d=b,b=g);h.geom.transLeq(k,d)?h.geom.transLeq(d,b)?(g=h.geom.transEval(a,k,d),e=h.geom.transEval(k,
d,b),0>g+e&&(g=-g,e=-e),l.t=h.geom.interpolate_(g,k.t,e,d.t)):(g=h.geom.transSign(a,k,d),e=-h.geom.transSign(a,b,d),0>g+e&&(g=-g,e=-e),l.t=h.geom.interpolate_(g,k.t,e,b.t)):l.t=(k.t+d.t)/2};h.mesh={};h.mesh.makeEdge=function(a){var d=h.mesh.makeEdgePair_(a.eHead);h.mesh.makeVertex_(d,a.vHead);h.mesh.makeVertex_(d.sym,a.vHead);h.mesh.makeFace_(d,a.fHead);return d};h.mesh.meshSplice=function(a,d){var k=!1,b=!1;a!==d&&(d.org!==a.org&&(b=!0,h.mesh.killVertex_(d.org,a.org)),d.lFace!==a.lFace&&(k=!0,h.mesh.killFace_(d.lFace,
a.lFace)),h.mesh.splice_(d,a),b||(h.mesh.makeVertex_(d,a.org),a.org.anEdge=a),k||(h.mesh.makeFace_(d,a.lFace),a.lFace.anEdge=a))};h.mesh.deleteEdge=function(a){var d=a.sym,k=!1;a.lFace!==a.rFace()&&(k=!0,h.mesh.killFace_(a.lFace,a.rFace()));a.oNext===a?h.mesh.killVertex_(a.org,null):(a.rFace().anEdge=a.oPrev(),a.org.anEdge=a.oNext,h.mesh.splice_(a,a.oPrev()),k||h.mesh.makeFace_(a,a.lFace));d.oNext===d?(h.mesh.killVertex_(d.org,null),h.mesh.killFace_(d.lFace,null)):(a.lFace.anEdge=d.oPrev(),d.org.anEdge=
d.oNext,h.mesh.splice_(d,d.oPrev()));h.mesh.killEdge_(a)};h.mesh.addEdgeVertex=function(a){var d=h.mesh.makeEdgePair_(a),k=d.sym;h.mesh.splice_(d,a.lNext);d.org=a.dst();h.mesh.makeVertex_(k,d.org);d.lFace=k.lFace=a.lFace;return d};h.mesh.splitEdge=function(a){var d=h.mesh.addEdgeVertex(a).sym;h.mesh.splice_(a.sym,a.sym.oPrev());h.mesh.splice_(a.sym,d);a.sym.org=d.org;d.dst().anEdge=d.sym;d.sym.lFace=a.rFace();d.winding=a.winding;d.sym.winding=a.sym.winding;return d};h.mesh.connect=function(a,d){var k=
!1,b=h.mesh.makeEdgePair_(a),l=b.sym;d.lFace!==a.lFace&&(k=!0,h.mesh.killFace_(d.lFace,a.lFace));h.mesh.splice_(b,a.lNext);h.mesh.splice_(l,d);b.org=a.dst();l.org=d.org;b.lFace=l.lFace=a.lFace;a.lFace.anEdge=l;k||h.mesh.makeFace_(b,a.lFace);return b};h.mesh.zapFace=function(a){var d=a.anEdge,k=d.lNext,b;do if(b=k,k=b.lNext,b.lFace=null,null===b.rFace()){b.oNext===b?h.mesh.killVertex_(b.org,null):(b.org.anEdge=b.oNext,h.mesh.splice_(b,b.oPrev()));var l=b.sym;l.oNext===l?h.mesh.killVertex_(l.org,null):
(l.org.anEdge=l.oNext,h.mesh.splice_(l,l.oPrev()));h.mesh.killEdge_(b)}while(b!==d);d=a.prev;a=a.next;a.prev=d;d.next=a};h.mesh.meshUnion=function(a,d){var h=a.fHead,b=a.vHead,l=a.eHead,g=d.fHead,e=d.vHead;d=d.eHead;g.next!==g&&(h.prev.next=g.next,g.next.prev=h.prev,g.prev.next=h,h.prev=g.prev);e.next!==e&&(b.prev.next=e.next,e.next.prev=b.prev,e.prev.next=b,b.prev=e.prev);d.next!==d&&(l.sym.next.sym.next=d.next,d.next.sym.next=l.sym.next,d.sym.next.sym.next=l,l.sym.next=d.sym.next);return a};h.mesh.deleteMesh=
function(a){};h.mesh.makeEdgePair_=function(a){var d=new h.GluHalfEdge,k=new h.GluHalfEdge,b=a.sym.next;k.next=b;b.sym.next=d;d.next=a;a.sym.next=k;d.sym=k;d.oNext=d;d.lNext=k;k.sym=d;k.oNext=k;return k.lNext=d};h.mesh.splice_=function(a,d){var h=a.oNext,b=d.oNext;h.sym.lNext=d;b.sym.lNext=a;a.oNext=b;d.oNext=h};h.mesh.makeVertex_=function(a,d){var k=d.prev,b=new h.GluVertex(d,k);k.next=b;d.prev=b;d=b.anEdge=a;do d.org=b,d=d.oNext;while(d!==a)};h.mesh.makeFace_=function(a,d){var k=d.prev,b=new h.GluFace(d,
k);k.next=b;d.prev=b;b.anEdge=a;b.inside=d.inside;d=a;do d.lFace=b,d=d.lNext;while(d!==a)};h.mesh.killEdge_=function(a){var d=a.next;a=a.sym.next;d.sym.next=a;a.sym.next=d};h.mesh.killVertex_=function(a,d){var h=a.anEdge,b=h;do b.org=d,b=b.oNext;while(b!==h);d=a.prev;a=a.next;a.prev=d;d.next=a};h.mesh.killFace_=function(a,d){var h=a.anEdge,b=h;do b.lFace=d,b=b.lNext;while(b!==h);d=a.prev;a=a.next;a.prev=d;d.next=a};h.normal={};h.normal.S_UNIT_X_=1;h.normal.S_UNIT_Y_=0;h.normal.projectPolygon=function(a,
d,k,b){var l=!1,g=[d,k,b];0===d&&0===k&&0===b&&(h.normal.computeNormal_(a,g),l=!0);k=h.normal.longAxis_(g);d=a.mesh.vHead;if(h.TRUE_PROJECT){h.normal.normalize_(g);b=[0,0,0];var e=[0,0,0];b[k]=0;b[(k+1)%3]=h.normal.S_UNIT_X_;b[(k+2)%3]=h.normal.S_UNIT_Y_;k=h.normal.dot_(b,g);b[0]-=k*g[0];b[1]-=k*g[1];b[2]-=k*g[2];h.normal.normalize_(b);e[0]=g[1]*b[2]-g[2]*b[1];e[1]=g[2]*b[0]-g[0]*b[2];e[2]=g[0]*b[1]-g[1]*b[0];h.normal.normalize_(e);for(g=d.next;g!==d;g=g.next)g.s=h.normal.dot_(g.coords,b),g.t=h.normal.dot_(g.coords,
e)}else for(b=(k+1)%3,e=(k+2)%3,k=0<g[k]?1:-1,g=d.next;g!==d;g=g.next)g.s=g.coords[b],g.t=k*g.coords[e];l&&h.normal.checkOrientation_(a)};h.normal.dot_=function(a,d){return a[0]*d[0]+a[1]*d[1]+a[2]*d[2]};h.normal.normalize_=function(a){var d=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];h.assert(0<d);d=Math.sqrt(d);a[0]/=d;a[1]/=d;a[2]/=d};h.normal.longAxis_=function(a){var d=0;Math.abs(a[1])>Math.abs(a[0])&&(d=1);Math.abs(a[2])>Math.abs(a[d])&&(d=2);return d};h.normal.computeNormal_=function(a,d){var k=[-2*h.GLU_TESS_MAX_COORD,
-2*h.GLU_TESS_MAX_COORD,-2*h.GLU_TESS_MAX_COORD],b=[2*h.GLU_TESS_MAX_COORD,2*h.GLU_TESS_MAX_COORD,2*h.GLU_TESS_MAX_COORD],l=[],g=[],e;a=a.mesh.vHead;for(e=a.next;e!==a;e=e.next)for(var c=0;3>c;++c){var f=e.coords[c];f<b[c]&&(b[c]=f,g[c]=e);f>k[c]&&(k[c]=f,l[c]=e)}e=0;k[1]-b[1]>k[0]-b[0]&&(e=1);k[2]-b[2]>k[e]-b[e]&&(e=2);if(b[e]>=k[e])d[0]=0,d[1]=0,d[2]=1;else{k=0;b=g[e];l=l[e];g=[0,0,0];b=[b.coords[0]-l.coords[0],b.coords[1]-l.coords[1],b.coords[2]-l.coords[2]];c=[0,0,0];for(e=a.next;e!==a;e=e.next)c[0]=
e.coords[0]-l.coords[0],c[1]=e.coords[1]-l.coords[1],c[2]=e.coords[2]-l.coords[2],g[0]=b[1]*c[2]-b[2]*c[1],g[1]=b[2]*c[0]-b[0]*c[2],g[2]=b[0]*c[1]-b[1]*c[0],f=g[0]*g[0]+g[1]*g[1]+g[2]*g[2],f>k&&(k=f,d[0]=g[0],d[1]=g[1],d[2]=g[2]);0>=k&&(d[0]=d[1]=d[2]=0,d[h.normal.longAxis_(b)]=1)}};h.normal.checkOrientation_=function(a){for(var d=0,h=a.mesh.fHead,b=h.next;b!==h;b=b.next){var l=b.anEdge;if(!(0>=l.winding)){do d+=(l.org.s-l.dst().s)*(l.org.t+l.dst().t),l=l.lNext;while(l!==b.anEdge)}}if(0>d)for(a=a.mesh.vHead,
d=a.next;d!==a;d=d.next)d.t=-d.t};h.render={};h.render.renderMesh=function(a,d,k){for(var b=!1,l=-1,g=d.fHead.prev;g!==d.fHead;g=g.prev)if(g.inside){b||(a.callBeginCallback(h.primitiveType.GL_TRIANGLES),b=!0);var e=g.anEdge;h.assert(e.lNext.lNext.lNext===e,"renderMesh called with non-triangulated mesh");do{if(k){var c=e.rFace().inside?0:1;l!==c&&(l=c,a.callEdgeFlagCallback(!!l))}a.callVertexCallback(e.org.data);e=e.lNext}while(e!==g.anEdge)}b&&a.callEndCallback()};h.render.renderBoundary=function(a,
d){for(var k=d.fHead.next;k!==d.fHead;k=k.next)if(k.inside){a.callBeginCallback(h.primitiveType.GL_LINE_LOOP);var b=k.anEdge;do a.callVertexCallback(b.org.data),b=b.lNext;while(b!==k.anEdge);a.callEndCallback()}};h.sweep={};h.sweep.SENTINEL_COORD_=4*h.GLU_TESS_MAX_COORD;h.sweep.TOLERANCE_NONZERO_=!1;h.sweep.computeInterior=function(a){a.fatalError=!1;h.sweep.removeDegenerateEdges_(a);h.sweep.initPriorityQ_(a);h.sweep.initEdgeDict_(a);for(var d;null!==(d=a.pq.extractMin());){for(;;){var k=a.pq.minimum();
if(null===k||!h.geom.vertEq(k,d))break;k=a.pq.extractMin();h.sweep.spliceMergeVertices_(a,d.anEdge,k.anEdge)}h.sweep.sweepEvent_(a,d)}d=a.dict.getMin().getKey();a.event=d.eUp.org;h.sweep.doneEdgeDict_(a);h.sweep.donePriorityQ_(a);h.sweep.removeDegenerateFaces_(a.mesh);a.mesh.checkMesh()};h.sweep.addWinding_=function(a,d){a.winding+=d.winding;a.sym.winding+=d.sym.winding};h.sweep.edgeLeq_=function(a,d,k){a=a.event;d=d.eUp;k=k.eUp;if(d.dst()===a)return k.dst()===a?h.geom.vertLeq(d.org,k.org)?0>=h.geom.edgeSign(k.dst(),
d.org,k.org):0<=h.geom.edgeSign(d.dst(),k.org,d.org):0>=h.geom.edgeSign(k.dst(),a,k.org);if(k.dst()===a)return 0<=h.geom.edgeSign(d.dst(),a,d.org);d=h.geom.edgeEval(d.dst(),a,d.org);a=h.geom.edgeEval(k.dst(),a,k.org);return d>=a};h.sweep.deleteRegion_=function(a,d){d.fixUpperEdge&&h.assert(0===d.eUp.winding);d.eUp.activeRegion=null;a.dict.deleteNode(d.nodeUp);d.nodeUp=null};h.sweep.fixUpperEdge_=function(a,d){h.assert(a.fixUpperEdge);h.mesh.deleteEdge(a.eUp);a.fixUpperEdge=!1;a.eUp=d;d.activeRegion=
a};h.sweep.topLeftRegion_=function(a){var d=a.eUp.org;do a=a.regionAbove();while(a.eUp.org===d);a.fixUpperEdge&&(d=h.mesh.connect(a.regionBelow().eUp.sym,a.eUp.lNext),h.sweep.fixUpperEdge_(a,d),a=a.regionAbove());return a};h.sweep.topRightRegion_=function(a){var d=a.eUp.dst();do a=a.regionAbove();while(a.eUp.dst()===d);return a};h.sweep.addRegionBelow_=function(a,d,k){var b=new h.ActiveRegion;b.eUp=k;b.nodeUp=a.dict.insertBefore(d.nodeUp,b);return k.activeRegion=b};h.sweep.isWindingInside_=function(a,
d){switch(a.windingRule){case h.windingRule.GLU_TESS_WINDING_ODD:return 0!==(d&1);case h.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==d;case h.windingRule.GLU_TESS_WINDING_POSITIVE:return 0<d;case h.windingRule.GLU_TESS_WINDING_NEGATIVE:return 0>d;case h.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return 2<=d||-2>=d}h.assert(!1);return!1};h.sweep.computeWinding_=function(a,d){d.windingNumber=d.regionAbove().windingNumber+d.eUp.winding;d.inside=h.sweep.isWindingInside_(a,d.windingNumber)};h.sweep.finishRegion_=
function(a,d){var k=d.eUp,b=k.lFace;b.inside=d.inside;b.anEdge=k;h.sweep.deleteRegion_(a,d)};h.sweep.finishLeftRegions_=function(a,d,k){var b=d;for(d=d.eUp;b!==k;){b.fixUpperEdge=!1;var l=b.regionBelow(),g=l.eUp;if(g.org!==d.org){if(!l.fixUpperEdge){h.sweep.finishRegion_(a,b);break}g=h.mesh.connect(d.lPrev(),g.sym);h.sweep.fixUpperEdge_(l,g)}d.oNext!==g&&(h.mesh.meshSplice(g.oPrev(),g),h.mesh.meshSplice(d,g));h.sweep.finishRegion_(a,b);d=l.eUp;b=l}return d};h.sweep.addRightEdges_=function(a,d,k,b,
l,g){var e=!0;do h.assert(h.geom.vertLeq(k.org,k.dst())),h.sweep.addRegionBelow_(a,d,k.sym),k=k.oNext;while(k!==b);for(null===l&&(l=d.regionBelow().eUp.rPrev());;){b=d.regionBelow();k=b.eUp.sym;if(k.org!==l.org)break;k.oNext!==l&&(h.mesh.meshSplice(k.oPrev(),k),h.mesh.meshSplice(l.oPrev(),k));b.windingNumber=d.windingNumber-k.winding;b.inside=h.sweep.isWindingInside_(a,b.windingNumber);d.dirty=!0;!e&&h.sweep.checkForRightSplice_(a,d)&&(h.sweep.addWinding_(k,l),h.sweep.deleteRegion_(a,d),h.mesh.deleteEdge(l));
e=!1;d=b;l=k}d.dirty=!0;h.assert(d.windingNumber-k.winding===b.windingNumber);g&&h.sweep.walkDirtyRegions_(a,d)};h.sweep.callCombine_=function(a,d,k,b,l){var g=[d.coords[0],d.coords[1],d.coords[2]];d.data=null;d.data=a.callCombineCallback(g,k,b);null===d.data&&(l?a.fatalError||(a.callErrorCallback(h.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),a.fatalError=!0):d.data=k[0])};h.sweep.spliceMergeVertices_=function(a,d,k){var b=[null,null,null,null];b[0]=d.org.data;b[1]=k.org.data;h.sweep.callCombine_(a,
d.org,b,[.5,.5,0,0],!1);h.mesh.meshSplice(d,k)};h.sweep.vertexWeights_=function(a,d,k,b,l){var g=h.geom.vertL1dist(d,a),e=h.geom.vertL1dist(k,a),c=l+1;b[l]=.5*e/(g+e);b[c]=.5*g/(g+e);a.coords[0]+=b[l]*d.coords[0]+b[c]*k.coords[0];a.coords[1]+=b[l]*d.coords[1]+b[c]*k.coords[1];a.coords[2]+=b[l]*d.coords[2]+b[c]*k.coords[2]};h.sweep.getIntersectData_=function(a,d,k,b,l,g){var e=[0,0,0,0],c=[k.data,b.data,l.data,g.data];d.coords[0]=d.coords[1]=d.coords[2]=0;h.sweep.vertexWeights_(d,k,b,e,0);h.sweep.vertexWeights_(d,
l,g,e,2);h.sweep.callCombine_(a,d,c,e,!0)};h.sweep.checkForRightSplice_=function(a,d){var k=d.regionBelow(),b=d.eUp,l=k.eUp;if(h.geom.vertLeq(b.org,l.org)){if(0<h.geom.edgeSign(l.dst(),b.org,l.org))return!1;h.geom.vertEq(b.org,l.org)?b.org!==l.org&&(a.pq.remove(b.org.pqHandle),h.sweep.spliceMergeVertices_(a,l.oPrev(),b)):(h.mesh.splitEdge(l.sym),h.mesh.meshSplice(b,l.oPrev()),d.dirty=k.dirty=!0)}else{if(0>h.geom.edgeSign(b.dst(),l.org,b.org))return!1;d.regionAbove().dirty=d.dirty=!0;h.mesh.splitEdge(b.sym);
h.mesh.meshSplice(l.oPrev(),b)}return!0};h.sweep.checkForLeftSplice_=function(a,d){var k=d.regionBelow();a=d.eUp;var b=k.eUp;h.assert(!h.geom.vertEq(a.dst(),b.dst()));if(h.geom.vertLeq(a.dst(),b.dst())){if(0>h.geom.edgeSign(a.dst(),b.dst(),a.org))return!1;d.regionAbove().dirty=d.dirty=!0;k=h.mesh.splitEdge(a);h.mesh.meshSplice(b.sym,k);k.lFace.inside=d.inside}else{if(0<h.geom.edgeSign(b.dst(),a.dst(),b.org))return!1;d.dirty=k.dirty=!0;k=h.mesh.splitEdge(b);h.mesh.meshSplice(a.lNext,b.sym);k.rFace().inside=
d.inside}return!0};h.sweep.checkForIntersect_=function(a,d){var k=d.regionBelow(),b=d.eUp,l=k.eUp,g=b.org,e=l.org,c=b.dst(),f=l.dst(),m=new h.GluVertex;h.assert(!h.geom.vertEq(f,c));h.assert(0>=h.geom.edgeSign(c,a.event,g));h.assert(0<=h.geom.edgeSign(f,a.event,e));h.assert(g!==a.event&&e!==a.event);h.assert(!d.fixUpperEdge&&!k.fixUpperEdge);if(g===e||Math.min(g.t,c.t)>Math.max(e.t,f.t))return!1;if(h.geom.vertLeq(g,e)){if(0<h.geom.edgeSign(f,g,e))return!1}else if(0>h.geom.edgeSign(c,e,g))return!1;
h.geom.edgeIntersect(c,g,f,e,m);h.assert(Math.min(g.t,c.t)<=m.t);h.assert(m.t<=Math.max(e.t,f.t));h.assert(Math.min(f.s,c.s)<=m.s);h.assert(m.s<=Math.max(e.s,g.s));h.geom.vertLeq(m,a.event)&&(m.s=a.event.s,m.t=a.event.t);var p=h.geom.vertLeq(g,e)?g:e;h.geom.vertLeq(p,m)&&(m.s=p.s,m.t=p.t);if(h.geom.vertEq(m,g)||h.geom.vertEq(m,e))return h.sweep.checkForRightSplice_(a,d),!1;if(!h.geom.vertEq(c,a.event)&&0<=h.geom.edgeSign(c,a.event,m)||!h.geom.vertEq(f,a.event)&&0>=h.geom.edgeSign(f,a.event,m)){if(f===
a.event)return h.mesh.splitEdge(b.sym),h.mesh.meshSplice(l.sym,b),d=h.sweep.topLeftRegion_(d),b=d.regionBelow().eUp,h.sweep.finishLeftRegions_(a,d.regionBelow(),k),h.sweep.addRightEdges_(a,d,b.oPrev(),b,b,!0),!0;if(c===a.event)return h.mesh.splitEdge(l.sym),h.mesh.meshSplice(b.lNext,l.oPrev()),k=d,d=h.sweep.topRightRegion_(d),g=d.regionBelow().eUp.rPrev(),k.eUp=l.oPrev(),l=h.sweep.finishLeftRegions_(a,k,null),h.sweep.addRightEdges_(a,d,l.oNext,b.rPrev(),g,!0),!0;0<=h.geom.edgeSign(c,a.event,m)&&(d.regionAbove().dirty=
d.dirty=!0,h.mesh.splitEdge(b.sym),b.org.s=a.event.s,b.org.t=a.event.t);0>=h.geom.edgeSign(f,a.event,m)&&(d.dirty=k.dirty=!0,h.mesh.splitEdge(l.sym),l.org.s=a.event.s,l.org.t=a.event.t);return!1}h.mesh.splitEdge(b.sym);h.mesh.splitEdge(l.sym);h.mesh.meshSplice(l.oPrev(),b);b.org.s=m.s;b.org.t=m.t;b.org.pqHandle=a.pq.insert(b.org);h.sweep.getIntersectData_(a,b.org,g,c,e,f);d.regionAbove().dirty=d.dirty=k.dirty=!0;return!1};h.sweep.walkDirtyRegions_=function(a,d){for(var k=d.regionBelow();;){for(;k.dirty;)d=
k,k=k.regionBelow();if(!d.dirty&&(k=d,d=d.regionAbove(),null===d||!d.dirty))break;d.dirty=!1;var b=d.eUp,l=k.eUp;b.dst()!==l.dst()&&h.sweep.checkForLeftSplice_(a,d)&&(k.fixUpperEdge?(h.sweep.deleteRegion_(a,k),h.mesh.deleteEdge(l),k=d.regionBelow(),l=k.eUp):d.fixUpperEdge&&(h.sweep.deleteRegion_(a,d),h.mesh.deleteEdge(b),d=k.regionAbove(),b=d.eUp));if(b.org!==l.org)if(b.dst()===l.dst()||d.fixUpperEdge||k.fixUpperEdge||b.dst()!==a.event&&l.dst()!==a.event)h.sweep.checkForRightSplice_(a,d);else if(h.sweep.checkForIntersect_(a,
d))break;b.org===l.org&&b.dst()===l.dst()&&(h.sweep.addWinding_(l,b),h.sweep.deleteRegion_(a,d),h.mesh.deleteEdge(b),d=k.regionAbove())}};h.sweep.connectRightVertex_=function(a,d,k){var b=k.oNext,l=d.regionBelow(),g=d.eUp,e=l.eUp,c=!1;g.dst()!==e.dst()&&h.sweep.checkForIntersect_(a,d);h.geom.vertEq(g.org,a.event)&&(h.mesh.meshSplice(b.oPrev(),g),d=h.sweep.topLeftRegion_(d),b=d.regionBelow().eUp,h.sweep.finishLeftRegions_(a,d.regionBelow(),l),c=!0);h.geom.vertEq(e.org,a.event)&&(h.mesh.meshSplice(k,
e.oPrev()),k=h.sweep.finishLeftRegions_(a,l,null),c=!0);c?h.sweep.addRightEdges_(a,d,k.oNext,b,b,!0):(b=h.geom.vertLeq(e.org,g.org)?e.oPrev():g,b=h.mesh.connect(k.lPrev(),b),h.sweep.addRightEdges_(a,d,b,b.oNext,b.oNext,!1),b.sym.activeRegion.fixUpperEdge=!0,h.sweep.walkDirtyRegions_(a,d))};h.sweep.connectLeftDegenerate_=function(a,d,k){var b=d.eUp;if(h.geom.vertEq(b.org,k))h.assert(h.sweep.TOLERANCE_NONZERO_),h.sweep.TOLERANCE_NONZERO_&&h.sweep.spliceMergeVertices_(a,b,k.anEdge);else if(h.geom.vertEq(b.dst(),
k)){if(h.assert(h.sweep.TOLERANCE_NONZERO_),h.sweep.TOLERANCE_NONZERO_){d=h.sweep.topRightRegion_(d);var b=d.regionBelow(),l=b.eUp.sym,g=l.oNext,e=g;b.fixUpperEdge&&(h.assert(g!==l),h.sweep.deleteRegion_(a,b),h.mesh.deleteEdge(l),l=g.oPrev());h.mesh.meshSplice(k.anEdge,l);h.geom.edgeGoesLeft(g)||(g=null);h.sweep.addRightEdges_(a,d,l.oNext,e,g,!0)}}else h.mesh.splitEdge(b.sym),d.fixUpperEdge&&(h.mesh.deleteEdge(b.oNext),d.fixUpperEdge=!1),h.mesh.meshSplice(k.anEdge,b),h.sweep.sweepEvent_(a,k)};h.sweep.connectLeftVertex_=
function(a,d){var k=new h.ActiveRegion;k.eUp=d.anEdge.sym;var k=a.dict.search(k).getKey(),b=k.regionBelow(),l=k.eUp,g=b.eUp;0===h.geom.edgeSign(l.dst(),d,l.org)?h.sweep.connectLeftDegenerate_(a,k,d):(b=h.geom.vertLeq(g.dst(),l.dst())?k:b,k.inside||b.fixUpperEdge?(l=b===k?h.mesh.connect(d.anEdge.sym,l.lNext):h.mesh.connect(g.dNext(),d.anEdge).sym,b.fixUpperEdge?h.sweep.fixUpperEdge_(b,l):h.sweep.computeWinding_(a,h.sweep.addRegionBelow_(a,k,l)),h.sweep.sweepEvent_(a,d)):h.sweep.addRightEdges_(a,k,
d.anEdge,d.anEdge,null,!0))};h.sweep.sweepEvent_=function(a,d){a.event=d;for(var k=d.anEdge;null===k.activeRegion;)if(k=k.oNext,k===d.anEdge){h.sweep.connectLeftVertex_(a,d);return}d=h.sweep.topLeftRegion_(k.activeRegion);var b=d.regionBelow(),k=b.eUp,b=h.sweep.finishLeftRegions_(a,b,null);b.oNext===k?h.sweep.connectRightVertex_(a,d,b):h.sweep.addRightEdges_(a,d,b.oNext,k,k,!0)};h.sweep.addSentinel_=function(a,d){var k=new h.ActiveRegion,b=h.mesh.makeEdge(a.mesh);b.org.s=h.sweep.SENTINEL_COORD_;b.org.t=
d;b.dst().s=-h.sweep.SENTINEL_COORD_;b.dst().t=d;a.event=b.dst();k.eUp=b;k.windingNumber=0;k.inside=!1;k.fixUpperEdge=!1;k.sentinel=!0;k.dirty=!1;k.nodeUp=a.dict.insert(k)};h.sweep.initEdgeDict_=function(a){a.dict=new h.Dict(a,h.sweep.edgeLeq_);h.sweep.addSentinel_(a,-h.sweep.SENTINEL_COORD_);h.sweep.addSentinel_(a,h.sweep.SENTINEL_COORD_)};h.sweep.doneEdgeDict_=function(a){for(var d=0,k;null!==(k=a.dict.getMin().getKey());)k.sentinel||(h.assert(k.fixUpperEdge),h.assert(1===++d)),h.assert(0===k.windingNumber),
h.sweep.deleteRegion_(a,k);a.dict=null};h.sweep.removeDegenerateEdges_=function(a){for(var d=a.mesh.eHead,k,b=d.next;b!==d;b=k){k=b.next;var l=b.lNext;h.geom.vertEq(b.org,b.dst())&&b.lNext.lNext!==b&&(h.sweep.spliceMergeVertices_(a,l,b),h.mesh.deleteEdge(b),b=l,l=b.lNext);if(l.lNext===b){if(l!==b){if(l===k||l===k.sym)k=k.next;h.mesh.deleteEdge(l)}if(b===k||b===k.sym)k=k.next;h.mesh.deleteEdge(b)}}};h.sweep.initPriorityQ_=function(a){var d=new h.PriorityQ;a.pq=d;a=a.mesh.vHead;var k;for(k=a.next;k!==
a;k=k.next)k.pqHandle=d.insert(k);d.init()};h.sweep.donePriorityQ_=function(a){a.pq.deleteQ();a.pq=null};h.sweep.removeDegenerateFaces_=function(a){for(var d,k=a.fHead.next;k!==a.fHead;k=d)d=k.next,k=k.anEdge,h.assert(k.lNext!==k),k.lNext.lNext===k&&(h.sweep.addWinding_(k.oNext,k),h.mesh.deleteEdge(k))};h.tessmono={};h.tessmono.tessellateMonoRegion_=function(a){a=a.anEdge;for(h.assert(a.lNext!==a&&a.lNext.lNext!==a);h.geom.vertLeq(a.dst(),a.org);a=a.lPrev());for(;h.geom.vertLeq(a.org,a.dst());a=a.lNext);
for(var d=a.lPrev(),k;a.lNext!==d;)if(h.geom.vertLeq(a.dst(),d.org)){for(;d.lNext!==a&&(h.geom.edgeGoesLeft(d.lNext)||0>=h.geom.edgeSign(d.org,d.dst(),d.lNext.dst()));)k=h.mesh.connect(d.lNext,d),d=k.sym;d=d.lPrev()}else{for(;d.lNext!==a&&(h.geom.edgeGoesRight(a.lPrev())||0<=h.geom.edgeSign(a.dst(),a.org,a.lPrev().org));)k=h.mesh.connect(a,a.lPrev()),a=k.sym;a=a.lNext}for(h.assert(d.lNext!==a);d.lNext.lNext!==a;)k=h.mesh.connect(d.lNext,d),d=k.sym};h.tessmono.tessellateInterior=function(a){for(var d,
k=a.fHead.next;k!==a.fHead;k=d)d=k.next,k.inside&&h.tessmono.tessellateMonoRegion_(k)};h.tessmono.discardExterior=function(a){for(var d,k=a.fHead.next;k!==a.fHead;k=d)d=k.next,k.inside||h.mesh.zapFace(k)};h.tessmono.setWindingNumber=function(a,d,k){for(var b,l=a.eHead.next;l!==a.eHead;l=b)b=l.next,l.rFace().inside!==l.lFace.inside?l.winding=l.lFace.inside?d:-d:k?h.mesh.deleteEdge(l):l.winding=0};h.Dict=function(a,d){this.head_=new h.DictNode;this.frame_=a;this.leq_=d};h.Dict.prototype.deleteDict_=
function(){};h.Dict.prototype.insertBefore=function(a,d){do a=a.prev;while(null!==a.key&&!this.leq_(this.frame_,a.key,d));d=new h.DictNode(d,a.next,a);a.next.prev=d;return a.next=d};h.Dict.prototype.insert=function(a){return this.insertBefore(this.head_,a)};h.Dict.prototype.deleteNode=function(a){a.next.prev=a.prev;a.prev.next=a.next};h.Dict.prototype.search=function(a){var d=this.head_;do d=d.next;while(null!==d.key&&!this.leq_(this.frame_,a,d.key));return d};h.Dict.prototype.getMin=function(){return this.head_.next};
h.Dict.prototype.getMax=function(){return this.head_.prev};h.DictNode=function(a,d,h){this.key=a||null;this.next=d||this;this.prev=h||this};h.DictNode.prototype.getKey=function(){return this.key};h.DictNode.prototype.getSuccessor=function(){return this.next};h.DictNode.prototype.getPredecessor=function(){return this.prev};h.GluTesselator=function(){this.state_=h.GluTesselator.tessState_.T_DORMANT;this.errorCallback_=this.mesh=this.lastEdge_=null;this.normal_=[0,0,0];this.windingRule=h.windingRule.GLU_TESS_WINDING_ODD;
this.fatalError=!1;this.combineCallback_=this.event=this.pq=this.dict=null;this.boundaryOnly_=!1;this.polygonData_=this.meshCallback_=this.endCallback_=this.vertexCallback_=this.edgeFlagCallback_=this.beginCallback_=null};h.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2};h.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(h.GluTesselator.tessState_.T_DORMANT)};h.GluTesselator.prototype.gluTessProperty=function(a,d){switch(a){case h.gluEnum.GLU_TESS_TOLERANCE:return;
case h.gluEnum.GLU_TESS_WINDING_RULE:switch(d){case h.windingRule.GLU_TESS_WINDING_ODD:case h.windingRule.GLU_TESS_WINDING_NONZERO:case h.windingRule.GLU_TESS_WINDING_POSITIVE:case h.windingRule.GLU_TESS_WINDING_NEGATIVE:case h.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:this.windingRule=d;return}break;case h.gluEnum.GLU_TESS_BOUNDARY_ONLY:this.boundaryOnly_=!!d;return;default:this.callErrorCallback(h.gluEnum.GLU_INVALID_ENUM);return}this.callErrorCallback(h.gluEnum.GLU_INVALID_VALUE)};h.GluTesselator.prototype.gluGetTessProperty=
function(a){switch(a){case h.gluEnum.GLU_TESS_TOLERANCE:return 0;case h.gluEnum.GLU_TESS_WINDING_RULE:return a=this.windingRule,h.assert(a===h.windingRule.GLU_TESS_WINDING_ODD||a===h.windingRule.GLU_TESS_WINDING_NONZERO||a===h.windingRule.GLU_TESS_WINDING_POSITIVE||a===h.windingRule.GLU_TESS_WINDING_NEGATIVE||a===h.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),a;case h.gluEnum.GLU_TESS_BOUNDARY_ONLY:return h.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(h.gluEnum.GLU_INVALID_ENUM)}return!1};
h.GluTesselator.prototype.gluTessNormal=function(a,d,h){this.normal_[0]=a;this.normal_[1]=d;this.normal_[2]=h};h.GluTesselator.prototype.gluTessCallback=function(a,d){d=d?d:null;switch(a){case h.gluEnum.GLU_TESS_BEGIN:case h.gluEnum.GLU_TESS_BEGIN_DATA:this.beginCallback_=d;break;case h.gluEnum.GLU_TESS_EDGE_FLAG:case h.gluEnum.GLU_TESS_EDGE_FLAG_DATA:this.edgeFlagCallback_=d;break;case h.gluEnum.GLU_TESS_VERTEX:case h.gluEnum.GLU_TESS_VERTEX_DATA:this.vertexCallback_=d;break;case h.gluEnum.GLU_TESS_END:case h.gluEnum.GLU_TESS_END_DATA:this.endCallback_=
d;break;case h.gluEnum.GLU_TESS_ERROR:case h.gluEnum.GLU_TESS_ERROR_DATA:this.errorCallback_=d;break;case h.gluEnum.GLU_TESS_COMBINE:case h.gluEnum.GLU_TESS_COMBINE_DATA:this.combineCallback_=d;break;case h.gluEnum.GLU_TESS_MESH:this.meshCallback_=d;break;default:this.callErrorCallback(h.gluEnum.GLU_INVALID_ENUM)}};h.GluTesselator.prototype.gluTessVertex=function(a,d){var k=!1,b=[0,0,0];this.requireState_(h.GluTesselator.tessState_.T_IN_CONTOUR);for(var l=0;3>l;++l){var g=a[l];g<-h.GLU_TESS_MAX_COORD&&
(g=-h.GLU_TESS_MAX_COORD,k=!0);g>h.GLU_TESS_MAX_COORD&&(g=h.GLU_TESS_MAX_COORD,k=!0);b[l]=g}k&&this.callErrorCallback(h.errorType.GLU_TESS_COORD_TOO_LARGE);this.addVertex_(b,d)};h.GluTesselator.prototype.gluTessBeginPolygon=function(a){this.requireState_(h.GluTesselator.tessState_.T_DORMANT);this.state_=h.GluTesselator.tessState_.T_IN_POLYGON;this.mesh=new h.GluMesh;this.polygonData_=a};h.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(h.GluTesselator.tessState_.T_IN_POLYGON);
this.state_=h.GluTesselator.tessState_.T_IN_CONTOUR;this.lastEdge_=null};h.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(h.GluTesselator.tessState_.T_IN_CONTOUR);this.state_=h.GluTesselator.tessState_.T_IN_POLYGON};h.GluTesselator.prototype.gluTessEndPolygon=function(){this.requireState_(h.GluTesselator.tessState_.T_IN_POLYGON);this.state_=h.GluTesselator.tessState_.T_DORMANT;h.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]);h.sweep.computeInterior(this);
if(!this.fatalError){var a=this.mesh;this.boundaryOnly_?h.tessmono.setWindingNumber(a,1,!0):h.tessmono.tessellateInterior(a);this.mesh.checkMesh();if(this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)this.boundaryOnly_?h.render.renderBoundary(this,this.mesh):h.render.renderMesh(this,this.mesh,!!this.edgeFlagCallback_);if(this.meshCallback_){h.tessmono.discardExterior(this.mesh);this.meshCallback_(this.mesh);this.polygonData_=this.mesh=null;return}}h.mesh.deleteMesh(this.mesh);
this.mesh=this.polygonData_=null};h.GluTesselator.prototype.requireState_=function(a){this.state_!==a&&this.gotoState_(a)};h.GluTesselator.prototype.gotoState_=function(a){for(;this.state_!==a;)if(this.state_<a)switch(this.state_){case h.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(h.errorType.GLU_TESS_MISSING_BEGIN_POLYGON);this.gluTessBeginPolygon(null);break;case h.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(h.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case h.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(h.errorType.GLU_TESS_MISSING_END_CONTOUR);
this.gluTessEndContour();break;case h.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(h.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}};h.GluTesselator.prototype.addVertex_=function(a,d){var k=this.lastEdge_;null===k?(k=h.mesh.makeEdge(this.mesh),h.mesh.meshSplice(k,k.sym)):(h.mesh.splitEdge(k),k=k.lNext);k.org.data=d;k.org.coords[0]=a[0];k.org.coords[1]=a[1];k.org.coords[2]=a[2];k.winding=1;k.sym.winding=-1;this.lastEdge_=k};h.GluTesselator.prototype.callBeginCallback=
function(a){this.beginCallback_&&this.beginCallback_(a,this.polygonData_)};h.GluTesselator.prototype.callVertexCallback=function(a){this.vertexCallback_&&this.vertexCallback_(a,this.polygonData_)};h.GluTesselator.prototype.callEdgeFlagCallback=function(a){this.edgeFlagCallback_&&this.edgeFlagCallback_(a,this.polygonData_)};h.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)};h.GluTesselator.prototype.callCombineCallback=function(a,d,h){return this.combineCallback_?
this.combineCallback_(a,d,h,this.polygonData_)||null:null};h.GluTesselator.prototype.callErrorCallback=function(a){this.errorCallback_&&this.errorCallback_(a,this.polygonData_)};h.GluFace=function(a,d){this.next=a||this;this.prev=d||this;this.anEdge=null;this.inside=!1};h.GluHalfEdge=function(a){this.next=a||this;this.activeRegion=this.lFace=this.org=this.lNext=this.oNext=this.sym=null;this.winding=0};h.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace};h.GluHalfEdge.prototype.dst=function(){return this.sym.org};
h.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext};h.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym};h.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym};h.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext};h.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym};h.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym};h.GluMesh=function(){this.vHead=new h.GluVertex;this.fHead=new h.GluFace;this.eHead=new h.GluHalfEdge;this.eHeadSym=
new h.GluHalfEdge;this.eHead.sym=this.eHeadSym;this.eHeadSym.sym=this.eHead};h.GluMesh.prototype.checkMesh=function(){if(h.DEBUG){var a=this.fHead,d=this.vHead,k=this.eHead,b,l;for(b=b=a;(l=b.next)!==a;b=l){h.assert(l.prev===b);b=l.anEdge;do h.assert(b.sym!==b),h.assert(b.sym.sym===b),h.assert(b.lNext.oNext.sym===b),h.assert(b.oNext.sym.lNext===b),h.assert(b.lFace===l),b=b.lNext;while(b!==l.anEdge)}h.assert(l.prev===b&&null===l.anEdge);for(b=b=d;(a=b.next)!==d;b=a){h.assert(a.prev===b);b=a.anEdge;
do h.assert(b.sym!==b),h.assert(b.sym.sym===b),h.assert(b.lNext.oNext.sym===b),h.assert(b.oNext.sym.lNext===b),h.assert(b.org===a),b=b.oNext;while(b!==a.anEdge)}h.assert(a.prev===b&&null===a.anEdge&&null===a.data);for(d=d=k;(b=d.next)!==k;d=b)h.assert(b.sym.next===d.sym),h.assert(b.sym!==b),h.assert(b.sym.sym===b),h.assert(null!==b.org),h.assert(null!==b.dst()),h.assert(b.lNext.oNext.sym===b),h.assert(b.oNext.sym.lNext===b);h.assert(b.sym.next===d.sym&&b.sym===this.eHeadSym&&b.sym.sym===b&&null===
b.org&&null===b.dst()&&null===b.lFace&&null===b.rFace())}};h.GluVertex=function(a,d){this.next=a||this;this.prev=d||this;this.data=this.anEdge=null;this.coords=[0,0,0];this.pqHandle=this.t=this.s=0};h.PriorityQ=function(){this.verts_=[];this.order_=null;this.size_=0;this.initialized_=!1;this.heap_=new h.PriorityQHeap};h.PriorityQ.prototype.deleteQ=function(){this.verts_=this.order_=this.heap_=null};h.PriorityQ.prototype.init=function(){this.order_=[];for(var a=0;a<this.size_;a++)this.order_[a]=a;
a=function(a){return function(b,d){return h.geom.vertLeq(a[b],a[d])?1:-1}}(this.verts_);this.order_.sort(a);this.initialized_=!0;this.heap_.init();if(h.DEBUG)for(var d=0+this.size_-1,a=0;a<d;++a)h.assert(h.geom.vertLeq(this.verts_[this.order_[a+1]],this.verts_[this.order_[a]]))};h.PriorityQ.prototype.insert=function(a){if(this.initialized_)return this.heap_.insert(a);var d=this.size_++;this.verts_[d]=a;return-(d+1)};h.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();
var a=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var d=this.heap_.minimum();if(h.geom.vertLeq(d,a))return this.heap_.extractMin()}do--this.size_;while(0<this.size_&&null===this.verts_[this.order_[this.size_-1]]);return a};h.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var a=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var d=this.heap_.minimum();if(h.geom.vertLeq(d,a))return d}return a};h.PriorityQ.prototype.remove=function(a){if(0<=
a)this.heap_.remove(a);else for(a=-(a+1),h.assert(a<this.verts_.length&&null!==this.verts_[a]),this.verts_[a]=null;0<this.size_&&null===this.verts_[this.order_[this.size_-1]];)--this.size_};h.PriorityQHeap=function(){this.heap_=h.PriorityQHeap.reallocNumeric_([0],h.PriorityQHeap.INIT_SIZE_+1);this.verts_=[null,null];this.handles_=[0,0];this.size_=0;this.max_=h.PriorityQHeap.INIT_SIZE_;this.freeList_=0;this.initialized_=!1;this.heap_[1]=1};h.PriorityQHeap.INIT_SIZE_=32;h.PriorityQHeap.reallocNumeric_=
function(a,d){for(var h=Array(d),b=0;b<a.length;b++)h[b]=a[b];for(;b<d;b++)h[b]=0;return h};h.PriorityQHeap.prototype.init=function(){for(var a=this.size_;1<=a;--a)this.floatDown_(a);this.initialized_=!0};h.PriorityQHeap.prototype.insert=function(a){var d=++this.size_;2*d>this.max_&&(this.max_*=2,this.handles_=h.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1));var k;0===this.freeList_?k=d:(k=this.freeList_,this.freeList_=this.handles_[this.freeList_]);this.verts_[k]=a;this.handles_[k]=d;
this.heap_[d]=k;this.initialized_&&this.floatUp_(d);return k};h.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_};h.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]};h.PriorityQHeap.prototype.extractMin=function(){var a=this.heap_,d=this.verts_,h=this.handles_,b=a[1],l=d[b];0<this.size_&&(a[1]=a[this.size_],h[a[1]]=1,d[b]=null,h[b]=this.freeList_,this.freeList_=b,0<--this.size_&&this.floatDown_(1));return l};h.PriorityQHeap.prototype.remove=function(a){var d=
this.heap_,k=this.verts_,b=this.handles_;h.assert(1<=a&&a<=this.max_&&null!==k[a]);var l=b[a];d[l]=d[this.size_];b[d[l]]=l;l<=--this.size_&&(1>=l?this.floatDown_(l):h.geom.vertLeq(k[d[l>>1]],k[d[l]])?this.floatDown_(l):this.floatUp_(l));k[a]=null;b[a]=this.freeList_;this.freeList_=a};h.PriorityQHeap.prototype.floatDown_=function(a){for(var d=this.heap_,k=this.verts_,b=this.handles_,l=d[a];;){var g=a<<1;g<this.size_&&h.geom.vertLeq(k[d[g+1]],k[d[g]])&&(g+=1);h.assert(g<=this.max_);var e=d[g];if(g>
this.size_||h.geom.vertLeq(k[l],k[e])){d[a]=l;b[l]=a;break}d[a]=e;b[e]=a;a=g}};h.PriorityQHeap.prototype.floatUp_=function(a){for(var d=this.heap_,k=this.verts_,b=this.handles_,l=d[a];;){var g=a>>1,e=d[g];if(0===g||h.geom.vertLeq(k[e],k[l])){d[a]=l;b[l]=a;break}d[a]=e;b[e]=a;a=g}};h.ActiveRegion=function(){this.nodeUp=this.eUp=null;this.windingNumber=0;this.fixUpperEdge=this.dirty=this.sentinel=this.inside=!1};h.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()};
h.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()};return h})},"esri/views/2d/engine/webgl/util/Lock":function(){define(["require","exports","../../../../../core/promiseUtils"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._resolver=null}a.prototype.isHeld=function(){return!!this._resolver};a.prototype.acquire=function(){var a=this;if(this._resolver)return this._resolver.promise.then(function(){return a.acquire()});
this._resolver=d.createResolver();return d.resolve()};a.prototype.release=function(){var a=this._resolver;this._resolver=null;a.resolve()};return a}();a.default=h;a.withLock=function(a,b){return a.acquire().then(function(){return b()}).then(function(){return a.release()}).catch(function(b){a.release();throw b;})}})},"esri/views/2d/layers/features/support/TileStore":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/tsSupport/decorateHelper @dojo/framework/shim/Set ../../../../../core/has ../../../../../core/libs/rbush/rbush ./Tile ../../../support/Evented ../../../tiling/TileKey".split(" "),
function(h,a,d,k,b,l,g,e,c,f){Object.defineProperty(a,"__esModule",{value:!0});var m={added:[],removed:[]},p=new b.default,x=new f(0,0,0,0);h=function(a){function b(b){var c=a.call(this)||this;c._tiles=new Map;c._index=g(9,l("csp-restrictions")?function(a){return{minX:a.bounds[0],minY:a.bounds[1],maxX:a.bounds[2],maxY:a.bounds[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]);c.tiles=[];c.tileScheme=b;return c}d(b,a);b.prototype.destroy=function(){this._tiles.clear()};b.prototype.has=function(a){return this._tiles.has(a)};
b.prototype.get=function(a){return this._tiles.get(a)};b.prototype.findByKey=function(a){return this._tiles.get(a.id)};b.prototype.intersections=function(a,b){var c="string"===typeof a?this.get(a):a;if(!c)return[];var d=b*c.resolution;b=c.bounds[0]-d;a=c.bounds[1]-d;for(var e=c.bounds[2]+d,c=c.bounds[3]+d,d=[],f=0,g=this._index.search({minX:b,minY:a,maxX:e,maxY:c});f<g.length;f++){var h=g[f],k=h.bounds.slice();k[0]=Math.max(k[0],b);k[1]=Math.max(k[1],a);k[2]=Math.min(k[2],e);k[3]=Math.min(k[3],c);
0<k[2]-k[0]&&0<k[3]-k[1]&&d.push({bounds:k,tile:h})}return d};b.prototype.boundsIntersections=function(a){return this._index.search({minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]})};b.prototype.setViewState=function(a){var b=this.tileScheme.getTileCoverage(a,0);if(b){a=b.spans;var b=b.lodInfo,c=b.level;if(0<a.length)for(var d=0;d<a.length;d++)for(var f=a[d],g=f.row,h=f.colTo,k=f.colFrom;k<=h;k++){var l=x.set(c,g,b.normalizeCol(k),b.getWorldForColumn(k)).id;p.add(l);this.has(l)||(f=new e.default(this.tileScheme,
l),this._tiles.set(l,f),this._index.insert(f),this.tiles.push(f),m.added.push(f))}for(a=this.tiles.length-1;0<=a;a--)f=this.tiles[a],p.has(f.id)||(this._tiles.delete(f.id),this.tiles.splice(a,1),this._index.remove(f),m.removed.push(f));(m.added.length||m.removed.length)&&this.emit("update",m);p.clear();m.added.length=0;m.removed.length=0}};return b}(c.default);a.default=h})},"esri/core/libs/rbush/rbush":function(){define(["../quickselect/quickselect"],function(h){function a(b,c){if(!(this instanceof
a))return new a(b,c);this._maxEntries=Math.max(4,b||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));c&&("function"===typeof c?this.toBBox=c:this._initFormat(c));this.clear()}function d(a,b){k(a,0,a.children.length,b,a)}function k(a,c,d,e,f){f||(f=p(null));f.minX=Infinity;f.minY=Infinity;f.maxX=-Infinity;f.maxY=-Infinity;for(var g;c<d;c++)g=a.children[c],b(f,a.leaf?e(g):g);return f}function b(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);
a.maxY=Math.max(a.maxY,b.maxY);return a}function l(a,b){return a.minX-b.minX}function g(a,b){return a.minY-b.minY}function e(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function c(a){return a.maxX-a.minX+(a.maxY-a.minY)}function f(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function m(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function p(a){return{children:a,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function x(a,
b,c,d,e){for(var f=[b,c],g;f.length;)c=f.pop(),b=f.pop(),c-b<=d||(g=b+Math.ceil((c-b)/d/2)*d,h(a,g,b,c,e),f.push(b,g,g,c))}a.prototype={all:function(){return this._all(this.data,[])},search:function(a){var b=this.data,c=[],d=this.toBBox;if(!m(a,b))return c;for(var e=[],g,h,k,l;b;){g=0;for(h=b.children.length;g<h;g++)k=b.children[g],l=b.leaf?d(k):k,m(a,l)&&(b.leaf?c.push(k):f(a,l)?this._all(k,c):e.push(k));b=e.pop()}return c},collides:function(a){var b=this.data,c=this.toBBox;if(!m(a,b))return!1;for(var d=
[],e,g,h,k;b;){e=0;for(g=b.children.length;e<g;e++)if(h=b.children[e],k=b.leaf?c(h):h,m(a,k)){if(b.leaf||f(a,k))return!0;d.push(h)}b=d.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0,c=a.length;b<c;b++)this.insert(a[b]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(b=this.data,this.data=a,a=b),this._insert(a,this.data.height-
a.height-1,!0)):this.data=a;return this},insert:function(a){a&&this._insert(a,this.data.height-1);return this},clear:function(){this.data=p([]);return this},remove:function(a,b){if(!a)return this;for(var c=this.data,d=this.toBBox(a),e=[],g=[],h,k,l,m;c||e.length;){c||(c=e.pop(),k=e[e.length-1],h=g.pop(),m=!0);if(c.leaf){a:{l=a;var p=c.children,u=b;if(u){for(var w=0;w<p.length;w++)if(u(l,p[w])){l=w;break a}l=-1}else l=p.indexOf(l)}if(-1!==l){c.children.splice(l,1);e.push(c);this._condense(e);break}}m||
c.leaf||!f(c,d)?k?(h++,c=k.children[h],m=!1):c=null:(e.push(c),g.push(h),h=0,k=c,c=c.children[0])}return this},toBBox:function(a){return a},compareMinX:l,compareMinY:g,toJSON:function(){return this.data},fromJSON:function(a){this.data=a;return this},_all:function(a,b){for(var c=[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},_build:function(a,b,c,e){var f=c-b+1,g=this._maxEntries,h;if(f<=g)return h=p(a.slice(b,c+1)),d(h,this.toBBox),h;e||(e=Math.ceil(Math.log(f)/
Math.log(g)),g=Math.ceil(f/Math.pow(g,e-1)));h=p([]);h.leaf=!1;h.height=e;var f=Math.ceil(f/g),g=f*Math.ceil(Math.sqrt(g)),k,l,m;for(x(a,b,c,g,this.compareMinX);b<=c;b+=g)for(l=Math.min(b+g-1,c),x(a,b,l,f,this.compareMinY),k=b;k<=l;k+=f)m=Math.min(k+f-1,l),h.children.push(this._build(a,k,m,e-1));d(h,this.toBBox);return h},_chooseSubtree:function(a,b,c,d){for(var f,g,h,k,l,m,p,t;;){d.push(b);if(b.leaf||d.length-1===c)break;p=t=Infinity;f=0;for(g=b.children.length;f<g;f++)h=b.children[f],l=e(h),m=(Math.max(h.maxX,
a.maxX)-Math.min(h.minX,a.minX))*(Math.max(h.maxY,a.maxY)-Math.min(h.minY,a.minY))-l,m<t?(t=m,p=l<p?l:p,k=h):m===t&&l<p&&(p=l,k=h);b=k||b.children[0]}return b},_insert:function(a,c,d){var e=this.toBBox;d=d?a:e(a);var e=[],f=this._chooseSubtree(d,this.data,c,e);f.children.push(a);for(b(f,d);0<=c;)if(e[c].children.length>this._maxEntries)this._split(e,c),c--;else break;this._adjustParentBBoxes(d,e,c)},_split:function(a,b){var c=a[b],e=c.children.length,f=this._minEntries;this._chooseSplitAxis(c,f,e);
e=this._chooseSplitIndex(c,f,e);e=p(c.children.splice(e,c.children.length-e));e.height=c.height;e.leaf=c.leaf;d(c,this.toBBox);d(e,this.toBBox);b?a[b-1].children.push(e):this._splitRoot(c,e)},_splitRoot:function(a,b){this.data=p([a,b]);this.data.height=a.height+1;this.data.leaf=!1;d(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,c){var d,f,g,h,l,m,p;l=m=Infinity;for(d=b;d<=c-b;d++)f=k(a,0,d,this.toBBox),g=k(a,d,c,this.toBBox),h=Math.max(0,Math.min(f.maxX,g.maxX)-Math.max(f.minX,g.minX))*Math.max(0,
Math.min(f.maxY,g.maxY)-Math.max(f.minY,g.minY)),f=e(f)+e(g),h<l?(l=h,p=d,m=f<m?f:m):h===l&&f<m&&(m=f,p=d);return p},_chooseSplitAxis:function(a,b,c){var d=a.leaf?this.compareMinX:l,e=a.leaf?this.compareMinY:g,f=this._allDistMargin(a,b,c,d);b=this._allDistMargin(a,b,c,e);f<b&&a.children.sort(d)},_allDistMargin:function(a,d,e,f){a.children.sort(f);f=this.toBBox;var g=k(a,0,d,f),h=k(a,e-d,e,f),l=c(g)+c(h),m,p;for(m=d;m<e-d;m++)p=a.children[m],b(g,a.leaf?f(p):p),l+=c(g);for(m=e-d-1;m>=d;m--)p=a.children[m],
b(h,a.leaf?f(p):p),l+=c(h);return l},_adjustParentBBoxes:function(a,c,d){for(;0<=d;d--)b(c[d],a)},_condense:function(a){for(var b=a.length-1,c;0<=b;b--)0===a[b].children.length?0<b?(c=a[b-1].children,c.splice(c.indexOf(a[b]),1)):this.clear():d(a[b],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+
a[2]+", maxY: a"+a[3]+"};")}};return a})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function h(d,b,l,g,e){for(;g>l;){if(600<g-l){var c=g-l+1,f=b-l+1,k=Math.log(c),p=.5*Math.exp(2*k/3),k=.5*Math.sqrt(k*p*(c-p)/c)*(0>f-c/2?-1:1);h(d,b,Math.max(l,Math.floor(b-f*p/c+k)),Math.min(g,Math.floor(b+(c-f)*p/c+k)),e)}c=d[b];f=l;p=g;a(d,l,b);for(0<e(d[g],c)&&a(d,l,g);f<p;){a(d,f,p);f++;for(p--;0>e(d[f],c);)f++;for(;0<e(d[p],c);)p--}0===e(d[l],c)?a(d,l,p):(p++,a(d,p,g));p<=b&&(l=
p+1);b<=p&&(g=p-1)}}function a(a,b,d){var g=a[b];a[b]=a[d];a[d]=g}function d(a,b){return a<b?-1:a>b?1:0}return function(a,b,l,g,e){h(a,b,l||0,g||a.length-1,e||d)}})},"esri/views/2d/layers/features/support/Tile":function(){define("require exports @dojo/framework/shim/Set ../../../../../core/ArrayPool ../../../../../geometry/support/aaBoundingRect ../../../../../tasks/support/QuantizationParameters ../../../tiling/TileKey".split(" "),function(h,a,d,k,b,l,g){function e(a,b){var c=a.bounds,d=b.bounds;
return a.key.id!==b.key.id&&a.key.world===b.key.world&&c[0]<=d[0]&&c[1]<=d[1]&&c[2]>=d[2]&&c[3]>=d[3]}Object.defineProperty(a,"__esModule",{value:!0});a.isParentOf=e;a.isChildOf=function(a,b){return e(b,a)};h=function(){function a(a,c){this.bounds=b.create();this.key=new g(0,0,0,0);this.objectIds=new d.default;this.key.set(c);c=a.getLODInfoAt(this.key);this.tileInfoView=a;this.tileInfoView.getTileBounds(this.bounds,this.key,!0);this.resolution=c.resolution;this.scale=c.scale;this.level=c.level;this.needsClear=
!0}Object.defineProperty(a.prototype,"id",{get:function(){return this.key.id},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new a(this.tileInfoView,this.id)};a.prototype.createChildTiles=function(){for(var b=this.key.getChildKeys(),c=k.acquire(),d=0;d<b.length;d++)c[d]=new a(this.tileInfoView,b[d]);return c};a.prototype.getQuantizationParameters=function(){return l.default.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],
ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})};return a}();a.Tile=h;a.default=h})},"esri/views/2d/support/Evented":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this._listeners={}}a.prototype.on=function(a,b){var d=this;null==this._listeners[a]&&(this._listeners[a]=new Map);var g={};this._listeners[a].set(g,b);return{remove:function(){return d._listeners[a].delete(g)}}};
a.prototype.once=function(a,b){var d=this.on(a,function(a){d.remove();b(a)});return d};a.prototype.emit=function(a,b){this.hasEventListener(a)&&this._listeners[a].forEach(function(a){return a(b)})};a.prototype.hasEventListener=function(a){return null!=this._listeners[a]&&0<this._listeners[a].size};return a}();a.default=h})},"esri/views/2d/layers/graphics/GraphicProcessingQueue":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/scheduling ../../../../core/accessorSupport/decorators".split(" "),
function(h,a,d,k,b,l,g){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function b(b){b=a.call(this,b)||this;b._queue=new Map;b._onGoingGraphic=null;b._onGoingPromise=null;b._scheduledNextHandle=null;b._timestamp=Date.now();b._next=b._next.bind(b);b._finalize=b._finalize.bind(b);return b}d(b,a);Object.defineProperty(b.prototype,"length",{get:function(){return this._queue.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return 0<this._queue.size||
null!==this._onGoingPromise},enumerable:!0,configurable:!0});b.prototype.cancel=function(a){this._onGoingGraphic&&this._onGoingGraphic.graphic===a&&(this._onGoingPromise.cancel(),this._onGoingGraphic=this._onGoingPromise=null);this._queue.delete(a);this._scheduleNext();this.notifyChange("updating")};b.prototype.clear=function(){this._queue.clear();this._onGoingPromise&&(this._onGoingPromise.cancel(),this._onGoingGraphic=this._onGoingPromise=null);this._cancelNext();this.notifyChange("updating")};
b.prototype.has=function(a){return this._queue.has(a)};b.prototype.isOngoing=function(a){return this._onGoingGraphic&&this._onGoingGraphic.graphic===a};b.prototype.push=function(a,b,c){this._queue.has(a)||(this._queue.set(a,{graphic:a,addOrUpdate:b,timestamp:c||this._timestamp}),this._scheduleNext(),this.notifyChange("updating"))};b.prototype.refresh=function(){this._timestamp=Date.now();this.reset()};b.prototype.reset=function(){var a=this._onGoingGraphic;a&&this.push(a.graphic,a.addOrUpdate,this._timestamp)};
b.prototype._finalize=function(){this._onGoingPromise=this._onGoingGraphic=null;this.notifyChange("updating");this._scheduleNext()};b.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)};b.prototype._scheduleNext=function(){this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingGraphic||(this._scheduledNextHandle=l.schedule(this._next))};b.prototype._next=function(){if(null==this._scheduledNextHandle||0===this._queue.size||
this._onGoingGraphic)this._scheduledNextHandle=null;else{this._scheduledNextHandle=null;var a=this._peek(),b=a.graphic,c=a.addOrUpdate;this._queue.delete(b);this._onGoingGraphic=a;this._onGoingPromise=this.process(b,c,this._timestamp);this._onGoingPromise.then(this._finalize,this._finalize);this.notifyChange("updating")}};b.prototype._peek=function(){var a=this,b=Number.NEGATIVE_INFINITY,c=null;this._queue.forEach(function(d,e){e=a._timestamp-d.timestamp;isNaN(e)?c=d:e===b?c=d:e>b&&(b=e,c=d)});return c};
k([g.property({readOnly:!0})],b.prototype,"length",null);k([g.property({readOnly:!0})],b.prototype,"updating",null);k([g.property({constructOnly:!0})],b.prototype,"process",void 0);return b=k([g.subclass()],b)}(g.declared(b));a.default=h})},"esri/views/2d/layers/graphics/GraphicStore":function(){define("require exports ../../../../core/tsSupport/assignHelper @dojo/framework/shim/Map ../../../../core/has ../../../../core/screenUtils ../../../../core/libs/rbush/rbush ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/contains ../../../../geometry/support/jsonUtils ../../../../geometry/support/normalizeUtils ../../engine/webgl/util/iterator ./GraphicStoreItem ./graphicsUtils ../../../vectorTiles/GeometryUtils".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x,u,w){function r(a,b,c,d,e){t.minX=b;t.minY=c;t.maxX=d;t.maxY=e;return a.search(t)}Object.defineProperty(a,"__esModule",{value:!0});var t={minX:0,minY:0,maxX:0,maxY:0},A=e.create(),C=e.create();h=function(){function a(a,c,d,e,f){this.renderer=e;this._graphics=f;this._index=g(9,b("csp-restrictions")?function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]);this._itemByGraphic=new k.default;this._currentLevel=
-Infinity;this._tileInfoView=a;this._uidFieldName=d;if(a=a.getClosestInfoForScale(c))this._currentLevel=a.level,this._resolution=this._tileInfoView.getTileResolution(a.level);this._updateGraphicZorder=this._updateGraphicZorder.bind(this)}a.prototype.hitTest=function(a,b,d,g,h){a=m.normalizeMapX(a,this._tileInfoView.spatialReference);var k=.5*g*d;C[0]=a-k;C[1]=b-k;C[2]=a+k;C[3]=b+k;d=.5*g*(d+50);d=r(this._index,a-d,b-d,a+d,b+d);if(!d||0===d.length)return[];for(var p=e.create(),t=h?function(c,d,f){var g=
w.C_DEG_TO_RAD*h,l=Math.cos(g),g=Math.sin(g);d=((1+d)*c[0]+(1-d)*c[2])/2;f=((1+f)*c[1]+(1-f)*c[3])/2;var m=a-d,t=b-f;d=d+l*m+g*t;l=f-g*m+l*t;p[0]=d-k;p[1]=l-k;p[2]=d+k;p[3]=l+k;return e.intersects(c,p)}:function(a){return e.intersects(a,C)},v=[],x,y=0;y<d.length;y++){var z=d[y];switch(f.getJsonType(z.geometry)){case "esriGeometryPoint":x=this._getSymbol(z.graphic);if(!x)continue;var D=z.geometry,F=void 0,G=void 0;"text"===x.type?(F=u.getXAnchorDirection(x.horizontalAlignment||"center"),G=u.getYAnchorDirection(x.verticalAlignment||
"middle"),u.getTextSymbolBounds(A,D.x,D.y,x,z.size,this._resolution,h)):(G=F=0,u.getMarkerSymbolBounds(A,D.x,D.y,x,this._resolution,h));t(A,F,G)&&v.push(z);break;case "esriGeometryPolyline":x=this._getSymbol(z.graphic);if(!x)continue;x=1.5*g*window.devicePixelRatio*l.pt2px(x.width);u.isPointOnPolyline(z.geometry,a,b,x)&&v.push(z);break;case "esriGeometryEnvelope":x=z.geometry;x=e.fromValues(x.xmin,x.ymin,x.xmax,x.ymax);e.intersects(x,C)&&v.push(z);break;case "esriGeometryPolygon":c.polygonContainsPoint(z.geometry,
{x:a,y:b})&&v.push(z);break;case "esriGeometryMultipoint":if(D=this._getSymbol(z.graphic))for(var F=z.geometry.points,Z=G=void 0,T=0;T<F.length;T++)if("text"===D.type?(x=D,G=u.getXAnchorDirection(x.horizontalAlignment||"center"),Z=u.getYAnchorDirection(x.verticalAlignment||"middle"),u.getTextSymbolBounds(A,F[T][0],F[T][1],x,z.size,this._resolution,h)):(Z=G=0,u.getMarkerSymbolBounds(A,F[T][0],F[T][1],D,this._resolution,h)),t(A,G,Z)){v.push(z);break}}}v.sort(function(a,b){var c=u.graphicGeometryToNumber(a.graphic),
d=u.graphicGeometryToNumber(b.graphic);return c===d?b.zorder-a.zorder:c-d});return v.map(function(a){return a.graphic})};a.prototype.getGraphicData=function(a,b){var c=this._itemByGraphic.get(b);if(!c)return null;var e=r(this._index,a.bounds[0],a.bounds[1],a.bounds[2],a.bounds[3]);e.sort(function(a,b){return a.zorder-b.zorder});var f=e.indexOf(c),e=0===f||-1===f?-1:e[f-1].graphic.uid;a={originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]};var f=c.getGeometryQuantized(a),
g=d({},c.graphic.attributes);g[this._uidFieldName]=b.uid;return{centroid:x.default.getCentroidQuantized(c,a,this.renderer,this._scale),geometry:f,attributes:g,symbol:b.symbol,insertAfter:e}};a.prototype.queryTileData=function(a){var b=e.pad(a.bounds,50*a.resolution,e.create()),b=r(this._index,b[0],b[1],b[2],b[3]),c=[];this._createTileGraphics(c,b,{originPosition:"upperLeft",scale:[a.resolution,a.resolution],translate:[a.bounds[0],a.bounds[3]]});return c};a.prototype.has=function(a){return this._itemByGraphic.has(a)};
a.prototype.getBounds=function(a){return this._itemByGraphic.has(a)?this._itemByGraphic.get(a).bounds:null};a.prototype.add=function(a,b,c){if(a)return b=x.default.acquire(a,c,b,this.renderer,this._resolution,this._scale,this._tileInfoView.spatialReference),this._itemByGraphic.set(a,b),this._itemByGraphic.forEach(this._updateGraphicZorder),c&&this._index.insert(b),b.bounds};a.prototype.remove=function(a){if(this._itemByGraphic.has(a)){var b=this._itemByGraphic.get(a);this._index.remove(b);this._itemByGraphic.delete(a);
this._itemByGraphic.forEach(this._updateGraphicZorder)}};a.prototype.reorder=function(a){this._itemByGraphic.has(a)&&this._itemByGraphic.forEach(this._updateGraphicZorder)};a.prototype.update=function(a,b,c){var d=this._itemByGraphic.get(a),f=e.clone(d.bounds);d.size[0]=d.size[1]=0;this._index.remove(d);d.set(a,c,b,this.renderer,this._resolution,this._scale,this._tileInfoView.spatialReference);c&&this._index.insert(d);return{oldBounds:f,newBounds:d.bounds}};a.prototype.updateLevel=function(a){var b=
this;this._currentLevel!==a&&(this._currentLevel=a,this._resolution=this._tileInfoView.getTileResolution(a),this._scale=this._tileInfoView.getTileScale({level:a,row:0,col:0,world:0}),a=this._itemByGraphic.values(),p.forEachIter(a,function(a){b._index.remove(a);a.updateBounds(b.renderer,b._resolution,b._scale,b._tileInfoView.spatialReference);a.geometry&&b._index.insert(a)}))};a.prototype.clear=function(){this._itemByGraphic.clear();this._index.clear()};a.prototype._createTileGraphics=function(a,b,
c){var e=this._uidFieldName;b.sort(function(a,b){return a.zorder-b.zorder});for(var f,g,h,k,l=0;l<b.length;l++){h=b[l];f=h.graphic;g=h.getGeometryQuantized(c);k=0===l?-1:b[l-1].graphic.uid;var m=d({},h.graphic.attributes);m[e]=f.uid;a.push({centroid:x.default.getCentroidQuantized(h,c,this.renderer,this._scale),geometry:g,attributes:m,symbol:f.symbol,insertAfter:k})}};a.prototype._getSymbol=function(a){return a.symbol?a.symbol:this.renderer?this.renderer.getSymbol(a,{scale:this._scale}):null};a.prototype._updateGraphicZorder=
function(a,b){a.zorder=this._graphics.indexOf(b)};return a}();a.default=h})},"esri/views/2d/layers/graphics/GraphicStoreItem":function(){define("require exports ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/jsonUtils ../../../../geometry/support/quantizationUtils ./graphicsUtils".split(" "),function(h,a,d,k,b,l,g){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(){this.bounds=d.create();this.graphic=null;this.size=
[0,0,0,0]}a.acquire=function(b,d,e,g,h,k,l){void 0===b&&(b=null);var c;0===a._pool.length?c=new a:(c=a._pool.pop(),this._set.delete(c));c.acquire(b,d,e,g,h,k,l);return c};a.release=function(a){a&&!this._set.has(a)&&(a.release(),this._pool.push(a),this._set.add(a))};a.getCentroidQuantized=function(a,d,e,h){if(b.isPolygon(a.geometry)){var c=a.graphic.symbol;!c&&e&&(c=e.getSymbol(a.graphic,{scale:h}));if(!c)return null;if(g.isMarkerSymbol(c.type))return a=k.polygonCentroid(a.geometry),l.quantizePoint(d,
{},{x:a[0],y:a[1]},!1,!1)}return null};a.prototype.acquire=function(a,b,d,e,g,h,k){void 0===a&&(a=null);a&&this.set(a,b,d,e,g,h,k)};a.prototype.release=function(){this.geometry=this.graphic=null};a.prototype.set=function(a,b,d,e,h,k,l){this.graphic=a;this.geometry=b;g.getBounds(this.bounds,this.size,a,b,d,e,h,k,l)};a.prototype.updateBounds=function(a,b,d,e){g.getBounds(this.bounds,this.size,this.graphic,this.geometry,null,a,b,d,e)};a.prototype.getGeometryQuantized=function(a){return l.quantizeGeometry(a,
this.geometry)};a._pool=[];a._set=new Set;return a}();a.default=h})},"esri/views/layers/GraphicsView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(h,a,d,k,b,l){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.graphics=null;b.renderer=null;b.view=null;return b}d(b,a);k([l.property()],b.prototype,"graphics",void 0);k([l.property()],
b.prototype,"renderer",void 0);k([l.property()],b.prototype,"view",void 0);return b=k([l.subclass("esri.views.layers.GraphicsView")],b)}(l.declared(b))})},"esri/views/2d/navigation/MapViewNavigation":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Viewpoint ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../geometry/Point ../viewpointUtils ./ZoomBox ./actions/Pan ./actions/Pinch ./actions/Rotate".split(" "),
function(h,a,d,k,b,l,g,e,c,f,m,p,x){Object.defineProperty(a,"__esModule",{value:!0});var u=new b({targetGeometry:new e}),w=[0,0];h=function(a){function b(b){b=a.call(this)||this;b._endTimer=null;b.animationManager=null;return b}d(b,a);b.prototype.initialize=function(){this.pan=new m({navigation:this});this.rotate=new x({navigation:this});this.pinch=new p({navigation:this});this.zoomBox=new f({view:this.view,navigation:this})};b.prototype.destroy=function(){this.zoomBox.destroy();this.animationManager=
this.zoomBox=null};b.prototype.begin=function(){this._set("interacting",!0)};b.prototype.end=function(){var a=this;this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=0);this._endTimer=setTimeout(function(){a._set("interacting",!1)},0)};b.prototype.zoom=function(a,b){void 0===b&&(b=this._getDefaultAnchor());this.stop();this.begin();if(this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return 1>a?this.zoomIn(b):this.zoomOut(b);this.setViewpoint(b,a,0,[0,0])};b.prototype.zoomIn=
function(a){void 0===a&&(a=this._getDefaultAnchor());var b=this.view,c=b.scale,d=b.constraints.snapToNextScale(c);return b.goTo(this._scaleAndRotateViewpoint(u,a,d/c,0))};b.prototype.zoomOut=function(a){void 0===a&&(a=this._getDefaultAnchor());var b=this.view,c=b.scale,d=b.constraints.snapToPreviousScale(c);return b.goTo(this._scaleAndRotateViewpoint(u,a,d/c,0))};b.prototype.setViewpoint=function(a,b,c,d){this.begin();this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,
a,b,c,d);this.end()};b.prototype.animateViewpoint=function(a,b,c){return this.view.goTo(this._scaleAndRotateViewpoint(u,a,b,c))};b.prototype.continousRotateClockwise=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){c.rotateBy(a,a,-1)})};b.prototype.continousRotateCounterclockwise=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){c.rotateBy(a,a,1)})};b.prototype.resetRotation=function(){this.view.rotation=
0};b.prototype.continousPanLeft=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){c.translateBy(a,a,[-10,0])})};b.prototype.continousPanRight=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){c.translateBy(a,a,[10,0])})};b.prototype.continousPanUp=function(){var a=this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){c.translateBy(a,a,[0,10])})};b.prototype.continousPanDown=function(){var a=
this.get("view.viewpoint");this.animationManager.animateContinous(a,function(a){c.translateBy(a,a,[0,-10])})};b.prototype.stop=function(){this.pan.stopMomentumNavigation();this.animationManager.stop();this.end();this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=0)};b.prototype._getDefaultAnchor=function(){var a=this.view.size;w[0]=.5*a[0];w[1]=.5*a[1];return w};b.prototype._scaleAndRotateViewpoint=function(a,b,d,e){var f=this.view,g=f.size,h=f.padding,k=f.constraints,l=f.viewpoint,m=f.scale*
d,f=k.canZoomInTo(m),k=k.canZoomOutTo(m);return 1>d&&!f||1<d&&!k?l:c.padAndScaleAndRotateBy(a,l,d,e,b,g,h)};b.prototype._scaleRotateTranslateViewpoint=function(a,b,d,e,f){var g=this.view,h=g.size,k=g.padding,l=g.constraints,m=g.viewpoint,p=g.scale*d,g=l.canZoomInTo(p),l=l.canZoomOutTo(p);if(1>d&&!g||1<d&&!l)d=1;c.translateBy(m,m,f);return c.padAndScaleAndRotateBy(a,m,d,e,b,h,k)};k([g.property()],b.prototype,"animationManager",void 0);k([g.property({type:Boolean,readOnly:!0})],b.prototype,"interacting",
void 0);k([g.property()],b.prototype,"pan",void 0);k([g.property()],b.prototype,"pinch",void 0);k([g.property()],b.prototype,"rotate",void 0);k([g.property()],b.prototype,"view",void 0);k([g.property()],b.prototype,"zoomBox",void 0);return b=k([g.subclass("esri.views.2d.navigation.MapViewNavigation")],b)}(g.declared(l));a.default=h})},"esri/views/2d/navigation/ZoomBox":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(h,a,d,k,b,l){return function(a){function b(b){b=a.call(this,b)||this;b._container=null;b._overlay=null;b._backgroundShape=null;b._boxShape=null;b._box={x:0,y:0,width:0,height:0};b._redraw=b._redraw.bind(b);return b}d(b,a);b.prototype.destroy=function(){this.view=null};Object.defineProperty(b.prototype,"view",{set:function(a){var b=this;this._handles&&this._handles.forEach(function(a){a.remove()});this._handles=null;this._destroyOverlay();this._set("view",a);a&&(a.on("drag",["Shift"],function(a){return b._handleDrag(a,
1)}),a.on("drag",["Shift","Ctrl"],function(a){return b._handleDrag(a,-1)}))},enumerable:!0,configurable:!0});b.prototype._start=function(a,b,d,e){this._createContainer();this._createOverlay();this.navigation.begin()};b.prototype._update=function(a,b,d,e){this._box.x=a;this._box.y=b;this._box.width=d;this._box.height=e;this._rafId||(this._rafId=requestAnimationFrame(this._redraw))};b.prototype._end=function(a,b,d,e,g){var c=this.view;a=c.toMap(a+.5*d,b+.5*e);d=Math.max(d/c.width,e/c.height);-1===g&&
(d=1/d);this._destroyOverlay();this.navigation.end();c.goTo({center:a,scale:c.scale*d})};b.prototype._updateBox=function(a,b,d,e){var c=this._boxShape;c.setAttributeNS(null,"x",""+a);c.setAttributeNS(null,"y",""+b);c.setAttributeNS(null,"width",""+d);c.setAttributeNS(null,"height",""+e);c.setAttributeNS(null,"class","esri-zoom-box__outline")};b.prototype._updateBackground=function(a,b,d,e){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(a,b,d,e,this.view.width,this.view.height))};b.prototype._createContainer=
function(){var a=document.createElement("div");a.className="esri-zoom-box__container";this.view.root.appendChild(a);this._container=a};b.prototype._createOverlay=function(){var a=this.view.width,b=this.view.height,d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M 0 0 L "+a+" 0 L "+a+" "+b+" L 0 "+b+" Z");d.setAttributeNS(null,"class","esri-zoom-box__overlay-background");a=document.createElementNS("http://www.w3.org/2000/svg","rect");b=document.createElementNS("http://www.w3.org/2000/svg",
"svg");b.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");b.setAttributeNS(null,"class","esri-zoom-box__overlay");b.appendChild(d);b.appendChild(a);this._container.appendChild(b);this._backgroundShape=d;this._boxShape=a;this._overlay=b};b.prototype._destroyOverlay=function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container=this._backgroundShape=this._boxShape=this._overlay=null};b.prototype._toSVGPath=
function(a,b,d,e,g,h){d=a+d;e=b+e;return"M 0 0 L "+g+" 0 L "+g+" "+h+" L 0 "+h+" ZM "+a+" "+b+" L "+a+" "+e+" L "+d+" "+e+" L "+d+" "+b+" Z"};b.prototype._handleDrag=function(a,b){var c=a.x,d=a.y,e=a.origin.x,f=a.origin.y,g;c>e?(g=e,e=c-e):(g=c,e-=c);d>f?(c=f,d-=f):(c=d,d=f-d);switch(a.action){case "start":this._start(g,c,e,d);break;case "update":this._update(g,c,e,d);break;case "end":this._end(g,c,e,d,b)}a.stopPropagation()};b.prototype._redraw=function(){if(this._rafId&&(this._rafId=null,this._overlay)){var a=
this._box,b=a.x,d=a.y,e=a.width,a=a.height;this._updateBox(b,d,e,a);this._updateBackground(b,d,e,a);this._rafId=requestAnimationFrame(this._redraw)}};k([l.property()],b.prototype,"navigation",void 0);k([l.property()],b.prototype,"view",null);return b=k([l.subclass("esri.views.2d.navigation.ZoomBox")],b)}(l.declared(b))})},"esri/views/2d/navigation/actions/Pan":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/gl-matrix ../../viewpointUtils ../../../navigation/PanPlanarMomentumEstimator".split(" "),
function(h,a,d,k,b,l,g,e,c){return function(a){function b(b){var d=a.call(this)||this;d.animationTime=0;d.momentumEstimator=new c.PanPlanarMomentumEstimator(500,6,.92);d.momentum=null;d.tmpMomentum=g.vec3f64.create();d.momentumFinished=!1;d.viewpoint=e.create();d.watch("momentumFinished",function(a){a&&d.navigation.stop()});return d}d(b,a);b.prototype.begin=function(a,b){this.navigation.begin();this.momentumEstimator.reset();this.addToEstimator(b);this.previousDrag=b};b.prototype.update=function(a,
b){this.addToEstimator(b);var c=b.center.x,d=b.center.y,f=this.previousDrag,c=f?f.center.x-c:-c,d=f?d-f.center.y:d;a.viewpoint=e.translateBy(this.viewpoint,a.viewpoint,[c||0,d||0]);this.previousDrag=b};b.prototype.end=function(a,b){this.addToEstimator(b);this.momentum=this.momentumEstimator.evaluateMomentum();this.animationTime=0;if(this.momentum)this.onAnimationUpdate(a);this.previousDrag=null;this.navigation.end()};b.prototype.addToEstimator=function(a){var b=g.vec3f64.fromValues(-a.center.x,a.center.y,
0);this.momentumEstimator.add(b,b,.001*a.timestamp)};b.prototype.onAnimationUpdate=function(a){var b=this;this.navigation.animationManager.animateContinous(a.viewpoint,function(c,d){b.momentumFinished=!b.momentum||b.momentum.isFinished(b.animationTime);d*=.001;if(!b.momentumFinished){var f=b.momentum.valueDelta(b.animationTime,d);g.vec3.scale(b.tmpMomentum,b.momentum.direction,f);a.viewpoint=e.translateBy(c,c,b.tmpMomentum)}b.animationTime+=d})};b.prototype.stopMomentumNavigation=function(){this.momentum&&
(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())};k([l.property()],b.prototype,"momentumFinished",void 0);k([l.property()],b.prototype,"viewpoint",void 0);k([l.property()],b.prototype,"navigation",void 0);return b=k([l.subclass("esri.views.2d.navigation.actions.Pan")],b)}(l.declared(b))})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/gl-matrix ./FilteredFiniteDifference ./Momentum".split(" "),
function(h,a,d,k,b,l){Object.defineProperty(a,"__esModule",{value:!0});var g=function(a){function b(b,c,d,e,g){b=a.call(this,b,c,d)||this;b.sceneVelocity=e;b.direction=g;return b}d(b,a);b.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,b)};return b}(l.Momentum);a.PanPlanarMomentum=g;h=function(){function a(a,d,e){void 0===a&&(a=300);void 0===d&&(d=12);void 0===e&&(e=.84);this.minimumInitialVelocity=a;this.stopVelocity=d;this.friction=e;this.time=
new b.FilteredFiniteDifference(.6);this.screen=[new b.FilteredFiniteDifference(.4),new b.FilteredFiniteDifference(.4)];this.scene=[new b.FilteredFiniteDifference(.6),new b.FilteredFiniteDifference(.6),new b.FilteredFiniteDifference(.6)];this.tmpDirection=k.vec3f64.create()}a.prototype.add=function(a,b,d){this.time.hasLastValue&&.015>this.time.computeDelta(d)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(b[0]),this.scene[1].update(b[1]),this.scene[2].update(b[2]),this.time.update(d))};
a.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,
b,d){k.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var c=k.vec3.length(this.tmpDirection);0<c&&k.vec3.scale(this.tmpDirection,this.tmpDirection,1/c);return new g(a,b,d,c/this.time.filteredDelta,this.tmpDirection)};return a}();a.PanPlanarMomentumEstimator=h})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(h,a){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a){this.gain=
a}a.prototype.update=function(a){if(this.hasLastValue){var b=this.computeDelta(a);this.updateDelta(b)}this.lastValue=a};a.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(a.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});a.prototype.computeDelta=function(a){return a-
this.lastValue};a.prototype.updateDelta=function(a){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*a:a};return a}();a.FilteredFiniteDifference=h})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(h,a,d){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,d,g){this._initialVelocity=a;this._stopVelocity=d;this._friction=g;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){return this.valueFromInitialVelocity(this._initialVelocity,a)};a.prototype.valueDelta=function(a,d){var b=this.value(a);return this.value(a+
d)-b};a.prototype.valueFromInitialVelocity=function(a,d){d=Math.min(d,this.duration);var b=1-this.friction;return a*(Math.pow(b,d)-1)/Math.log(b)};return a}();a.Momentum=h})},"esri/views/2d/navigation/actions/Pinch":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/gl-matrix ../../viewpointUtils ../../../navigation/RotationMomentumEstimator ../../../navigation/ZoomMomentumEstimator".split(" "),
function(h,a,d,k,b,l,g,e,c,f){return function(a){function b(b){var d=a.call(this,b)||this;d._animationTime=0;d._momentumFinished=!1;d._rotationMomentumEstimator=new c.RotationMomentumEstimator(.6,.15,.95);d._rotationDirection=1;d._zoomDirection=1;d._zoomMomentumEstimator=new f.ZoomMomentumEstimator;d._zoomOnly=null;d.zoomMomentum=null;d.rotateMomentum=null;d.viewpoint=e.create();d.watch("_momentumFinished",function(a){a&&d.navigation.stop()});return d}d(b,a);b.prototype.begin=function(a,b){this.navigation.begin();
this._rotationMomentumEstimator.reset();this._zoomMomentumEstimator.reset();this._zoomOnly=null;this._previousAngle=this._startAngle=b.angle;this._previousRadius=this._startRadius=b.radius;this._previousCenter=b.center;this._updateTimestamp=null;a.constraints.rotationEnabled&&this.addToRotateEstimator(0,b.timestamp);this.addToZoomEstimator(b,1)};b.prototype.update=function(a,b){null===this._updateTimestamp&&(this._updateTimestamp=b.timestamp);var c=b.angle,d=b.radius,e=b.center,f=Math.abs(180*(c-
this._startAngle)/Math.PI),g=Math.abs(d-this._startRadius),h=this._startRadius/d;if(this._previousRadius){var k=d/this._previousRadius,l=180*(c-this._previousAngle)/Math.PI;this._rotationDirection=0<=l?1:-1;this._zoomDirection=1<=k?1:-1;a.constraints.rotationEnabled?(null===this._zoomOnly&&200<b.timestamp-this._updateTimestamp&&(this._zoomOnly=0<g-f),null===this._zoomOnly||this._zoomOnly?l=0:this.addToRotateEstimator(c-this._startAngle,b.timestamp)):l=0;this.addToZoomEstimator(b,h);this.navigation.setViewpoint([e.x,
e.y],1/k,l,[this._previousCenter.x-e.x,e.y-this._previousCenter.y])}this._previousAngle=c;this._previousRadius=d;this._previousCenter=e};b.prototype.end=function(a,b){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum();this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum();this._animationTime=0;if(this.rotateMomentum||this.zoomMomentum)this.onAnimationUpdate(a);this.navigation.end()};b.prototype.addToRotateEstimator=function(a,b){this._rotationMomentumEstimator.add(a,
.001*b)};b.prototype.addToZoomEstimator=function(a,b){this._zoomMomentumEstimator.add(b,.001*a.timestamp)};b.prototype.canZoomIn=function(a){var b=a.scale;a=a.constraints.effectiveMaxScale;return 0===a||b>a};b.prototype.canZoomOut=function(a){var b=a.scale;a=a.constraints.effectiveMinScale;return 0===a||b<a};b.prototype.onAnimationUpdate=function(a){var b=this;this.navigation.animationManager.animateContinous(a.viewpoint,function(c,d){var f=!b.canZoomIn(a)&&1<b._zoomDirection||!b.canZoomOut(a)&&1>
b._zoomDirection,h=!b.rotateMomentum||b.rotateMomentum.isFinished(b._animationTime),f=f||!b.zoomMomentum||b.zoomMomentum.isFinished(b._animationTime);d*=.001;b._momentumFinished=h&&f;if(!b._momentumFinished){var h=b.rotateMomentum?Math.abs(b.rotateMomentum.valueDelta(b._animationTime,d))*b._rotationDirection*180/Math.PI:0,f=b.zoomMomentum?Math.abs(b.zoomMomentum.valueDelta(b._animationTime,d)):1,k=g.vec2f64.create(),l=g.vec2f64.create();if(b._previousCenter){g.vec2.set(k,b._previousCenter.x,b._previousCenter.y);
e.getPaddingScreenTranslation(l,a.size,a.padding);g.vec2.add(k,k,l);var l=a.constraints,m=a.scale,p=m*f;1>f&&!l.canZoomInTo(p)?(f=m/l.effectiveMaxScale,b.zoomMomentum=null,b.rotateMomentum=null):1<f&&!l.canZoomOutTo(p)&&(f=m/l.effectiveMinScale,b.zoomMomentum=null,b.rotateMomentum=null);e.scaleAndRotateBy(c,a.viewpoint,f,h,k,a.size)}}b._animationTime+=d})};b.prototype.stopMomentumNavigation=function(){if(this.rotateMomentum||this.zoomMomentum)this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),
this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop()};k([l.property()],b.prototype,"_momentumFinished",void 0);k([l.property()],b.prototype,"viewpoint",void 0);k([l.property()],b.prototype,"navigation",void 0);return b=k([l.subclass("esri.views.2d.navigation.actions.Pinch")],b)}(l.declared(b))})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],
function(h,a,d,k){Object.defineProperty(a,"__esModule",{value:!0});h=function(a){function b(b,d,c,f){void 0===b&&(b=3);void 0===d&&(d=.01);void 0===c&&(c=.95);void 0===f&&(f=12);return a.call(this,b,d,c,f)||this}d(b,a);b.prototype.add=function(b,d){if(this.value.hasLastValue){var c=this.value.lastValue;for(b-=c;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=c+b}a.prototype.add.call(this,b,d)};return b}(k.MomentumEstimator);a.RotationMomentumEstimator=h})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/support/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),
function(h,a,d,k,b,l){Object.defineProperty(a,"__esModule",{value:!0});h=function(){function a(a,c,d,g){void 0===a&&(a=2.5);void 0===c&&(c=.01);void 0===d&&(d=.95);void 0===g&&(g=12);this.minimumInitialVelocity=a;this.stopVelocity=c;this.friction=d;this.maxVelocity=g;this.value=new b.FilteredFiniteDifference(.8);this.time=new b.FilteredFiniteDifference(.3)}a.prototype.add=function(a,b){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;if(this.value.hasFilteredDelta){var c=this.value.computeDelta(a);
0>this.value.filteredDelta*c&&this.value.reset()}}this.time.update(b);this.value.update(a)};a.prototype.reset=function(){this.value.reset();this.time.reset()};a.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var a=this.value.filteredDelta/this.time.filteredDelta,a=k.clamp(a,-this.maxVelocity,this.maxVelocity);return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};a.prototype.createMomentum=function(a,b,d){return new l.Momentum(a,
b,d)};return a}();a.MomentumEstimator=h})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(h,a,d,k,b){Object.defineProperty(a,"__esModule",{value:!0});var l=function(a){function b(b,d,e){return a.call(this,b,d,e)||this}d(b,a);b.prototype.value=function(b){b=a.prototype.value.call(this,b);return Math.exp(b)};b.prototype.valueDelta=function(b,d){var c=a.prototype.value.call(this,b);
b=a.prototype.value.call(this,b+d);return Math.exp(b-c)};return b}(k.Momentum);a.ZoomMomentum=l;h=function(a){function b(b,d,e,g){void 0===b&&(b=2.5);void 0===d&&(d=.01);void 0===e&&(e=.95);void 0===g&&(g=12);return a.call(this,b,d,e,g)||this}d(b,a);b.prototype.add=function(b,d){a.prototype.add.call(this,Math.log(b),d)};b.prototype.createMomentum=function(a,b,d){return new l(a,b,d)};return b}(b.MomentumEstimator);a.ZoomMomentumEstimator=h})},"esri/views/2d/navigation/actions/Rotate":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/gl-matrix ../../viewpointUtils".split(" "),
function(h,a,d,k,b,l,g,e){var c=g.vec2f64.create(),f=g.vec2f64.create();return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._previousCenter=g.vec2f64.create();b.viewpoint=e.create();return b}d(b,a);b.prototype.begin=function(a,b){this.navigation.begin();g.vec2.set(this._previousCenter,b.center.x,b.center.y)};b.prototype.update=function(a,b){var d=a.state,h=d.size,d=d.padding;g.vec2.set(c,b.center.x,b.center.y);e.getAnchor(f,h,d);a.viewpoint=e.rotateBy(this.viewpoint,a.content.viewpoint,
e.angleBetween(f,this._previousCenter,c));g.vec2.copy(this._previousCenter,c)};b.prototype.end=function(a,b){this.navigation.end()};k([l.property()],b.prototype,"viewpoint",void 0);k([l.property()],b.prototype,"navigation",void 0);return b=k([l.subclass("esri.views.2d.actions.Rotate")],b)}(l.declared(b))})},"*noref":1}});
define("require exports ./engine/Stage ./LabelManager ./layers/support/GraphicsView2D ./navigation/MapViewNavigation".split(" "),function(h,a,d,k,b,l){Object.defineProperty(a,"__esModule",{value:!0});a.Stage=d.Stage;a.LabelManager=k.default;a.GraphicsView2D=b.default;a.MapViewNavigation=l.default});