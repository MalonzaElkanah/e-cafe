// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry ../../../../Graphic ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/geometryEngine ../../../../geometry/support/boundsUtils ../../../../geometry/support/coordsUtils ../../../../symbols/SimpleFillSymbol ../../../../symbols/SimpleLineSymbol ../../../../symbols/SimpleMarkerSymbol ./drawUtils ./GraphicMover".split(" "),
function(N,O,y,g,n,p,z,A,B,q,f,r,v,w,x,C,t,m,D){var E=function(){return function(e,c,a,b){this.graphics=e;this.mover=c;this.dx=a;this.dy=b;this.type="move-start"}}(),F=function(){return function(e,c,a,b){this.graphics=e;this.mover=c;this.dx=a;this.dy=b;this.type="move"}}(),G=function(){return function(e,c,a,b){this.graphics=e;this.mover=c;this.dx=a;this.dy=b;this.type="move-stop"}}(),H=function(){return function(e,c,a){this.graphics=e;this.mover=c;this.angle=a;this.type="rotate-start"}}(),I=function(){return function(e,
c,a){this.graphics=e;this.mover=c;this.angle=a;this.type="rotate"}}(),J=function(){return function(e,c,a){this.graphics=e;this.mover=c;this.angle=a;this.type="rotate-stop"}}(),K=function(){return function(e,c,a,b){this.graphics=e;this.mover=c;this.xScale=a;this.yScale=b;this.type="scale-start"}}(),L=function(){return function(e,c,a,b){this.graphics=e;this.mover=c;this.xScale=a;this.yScale=b;this.type="scale"}}(),M=function(){return function(e,c,a,b){this.graphics=e;this.mover=c;this.xScale=a;this.yScale=
b;this.type="scale-stop"}}();return function(e){function c(a){a=e.call(this,a)||this;a._activeHandleGraphic=null;a._centerGraphicSymbol=new t({style:"circle",size:4,color:[255,255,255,1],outline:{color:[0,12,207],width:1}});a._defaultFillSymbol=new x({color:[12,207,255,.075],outline:{join:"round",color:[0,12,207],width:2}});a._dashedFillSymbol=new x({color:[0,0,0,0],outline:{style:"dash",color:[150,150,150,.5],width:2}});a._defaultGraphicSymbol=new t({style:"square",size:8,color:[255,255,255,1],outline:{color:[0,
12,207],width:1}});a._handles=new B;a._mover=null;a._rotateGraphicOffset=20;a._rotateGraphicHoverSymbol=new t({style:"circle",size:10,color:[255,255,255,1],outline:{color:[0,12,207],width:1}});a._rotateGraphicSymbol=new t({style:"circle",size:8,color:[255,255,255,1],outline:{color:[0,12,207],width:1}});a._rotationAngle=0;a._rotateLineGraphic=null;a._rotateLineGraphicSymbol=new C({color:[0,12,207],width:2});a._startInfo=null;a._totalDx=0;a._totalDy=0;a._xScale=1;a._yScale=1;a.callbacks={onMoveStart:function(a){},
onMove:function(a){},onMoveStop:function(a){},onScaleStart:function(a){},onScale:function(a){},onScaleStop:function(a){},onRotateStart:function(a){},onRotate:function(a){},onRotateStop:function(a){}};a.centerGraphic=null;a.backgroundGraphic=null;a.enableMovement=!0;a.enableRotation=!0;a.enableScaling=!0;a.graphics=[];a.handleGraphics=[];a.layer=null;a.preserveAspectRatio=!1;a.rotateGraphic=null;a.showCenterGraphic=!0;a.view=null;a._getBounds=function(){var a=[0,0,0,0];return function(b,c){var d;b[0]=
Number.POSITIVE_INFINITY;b[1]=Number.POSITIVE_INFINITY;b[2]=Number.NEGATIVE_INFINITY;b[3]=Number.NEGATIVE_INFINITY;for(var u=0;u<c.length;u++)if(d=c[u]){var e=void 0,f=void 0,h=void 0,g=void 0;"point"===d.type?(e=h=d.x,f=g=d.y):("multipoint"===d.type?(e=w.geometryToCoordinates(d),d=v.getRingsOrPathsBounds(a,[e])):"extent"===d.type?d=[d.xmin,d.ymin,d.xmax,d.ymax]:(e=w.geometryToCoordinates(d),d=v.getRingsOrPathsBounds(a,e)),e=d[0],f=d[1],h=d[2],g=d[3]);b[0]=Math.min(e,b[0]);b[1]=Math.min(f,b[1]);b[2]=
Math.max(h,b[2]);b[3]=Math.max(g,b[3])}return b}}();return a}y(c,e);c.prototype.initialize=function(){var a=this;this._setup();this._handles.add([q.whenOnce(this,"view.ready",function(){a.view&&a.view.map&&a.view.map.add(a.layer)}),q.pausable(this,"preserveAspectRatio",function(){a._activeHandleGraphic&&(a._scaleGraphic(a._activeHandleGraphic),a._updateGraphics())}),q.pausable(this,"view.scale",function(){a._updateRotateGraphic();a._updateRotateLineGraphic()}),q.pausable(this,"graphics",function(){return a.refresh()}),
q.pausable(this,"layer",function(b,d){d&&a._resetGraphics(d);a.refresh()})])};c.prototype.destroy=function(){this._reset();this._handles.removeAll();this._handles=null};Object.defineProperty(c.prototype,"state",{get:function(){var a=!!this.get("view.ready"),b=!(!this.get("graphics.length")||!this.get("layer"));return a&&b?"active":a?"ready":"disabled"},enumerable:!0,configurable:!0});c.prototype.isUIGraphic=function(a){var b=[];this.handleGraphics.length&&(b=b.concat(this.handleGraphics));this.backgroundGraphic&&
b.push(this.backgroundGraphic);this.centerGraphic&&b.push(this.centerGraphic);this.rotateGraphic&&b.push(this.rotateGraphic);this._rotateLineGraphic&&b.push(this._rotateLineGraphic);return b.length&&-1<b.indexOf(a)};c.prototype.move=function(a,b){if(this._mover&&this.graphics.length){for(var d=0,c=this.graphics;d<c.length;d++){var k=c[d],l=m.move(k.geometry,a,b,this.view);k.geometry=l}this.refresh();this._emitMoveStopEvent(a,b,null)}};c.prototype.scale=function(a,b){if(this._mover&&this.graphics.length){for(var d=
0,c=this.graphics;d<c.length;d++){var k=c[d],l=m.scale(k.geometry,a,b,this.view);k.geometry=l}this.refresh();this._emitScaleStopEvent(a,b,null)}};c.prototype.rotate=function(a,b){if(this._mover&&this.graphics.length){b||(b=new n.Point(this.handleGraphics[1].geometry.x,this.handleGraphics[3].geometry.y,this.view.spatialReference));for(var d=0,c=this.graphics;d<c.length;d++){var k=c[d],l=r.rotate(k.geometry,a,b);k.geometry=l}this.refresh();this._emitRotateStopEvent(a,null)}};c.prototype.refresh=function(){this._reset();
this._setup()};c.prototype.reset=function(){this.graphics=[]};c.prototype._setup=function(){"active"===this.state&&(this._setupGraphics(),this._setupMover(),this._updateGraphics())};c.prototype._reset=function(){this._resetGraphicStateVars();this._resetGraphics();this._mover&&this._mover.destroy();this._mover=null;this.view.container.style.cursor="default"};c.prototype._resetGraphicStateVars=function(){this._activeHandleGraphic=this._startInfo=null;this._totalDy=this._totalDx=0;this._yScale=this._xScale=
1;this._rotationAngle=0};c.prototype._resetGraphics=function(a){if(a=a||this.layer)a.removeMany(this.handleGraphics),a.remove(this.backgroundGraphic),a.remove(this.centerGraphic),a.remove(this.rotateGraphic),a.remove(this._rotateLineGraphic);a=0;for(var b=this.handleGraphics;a<b.length;a++)b[a].destroy();this._set("handleGraphics",[]);this.backgroundGraphic&&(this.backgroundGraphic.destroy(),this._set("backgroundGraphic",null));this.centerGraphic&&(this.centerGraphic.destroy(),this._set("centerGraphic",
null));this.rotateGraphic&&(this.rotateGraphic.destroy(),this._set("rotateGraphic",null));this._rotateLineGraphic&&(this._rotateLineGraphic.destroy(),this._rotateLineGraphic=null)};c.prototype._setupMover=function(){var a=this,b=[].concat(this.handleGraphics);this.enableMovement&&(b=b.concat(this.graphics,this.backgroundGraphic));this.enableRotation&&b.push(this.rotateGraphic);this.showCenterGraphic&&b.push(this.centerGraphic);this._mover=new D({enableMoveAllGraphics:!1,view:this.view,graphics:b,
callbacks:{onGraphicClick:function(b){return a._onGraphicClickCallback(b)},onGraphicMoveStart:function(b){return a._onGraphicMoveStartCallback(b)},onGraphicMove:function(b){return a._onGraphicMoveCallback(b)},onGraphicMoveStop:function(b){return a._onGraphicMoveStopCallback(b)},onGraphicPointerOver:function(b){return a._onGraphicPointerOverCallback(b)},onGraphicPointerOut:function(b){return a._onGraphicPointerOutCallback(b)}}})};c.prototype._getStartInfo=function(a){var b=this._getBoxBounds([0,0,
0,0]),d=b[0],c=b[1],k=b[2],b=b[3];a=a.geometry;return{width:Math.abs(k-d),height:Math.abs(b-c),centerX:(k+d)/2,centerY:(b+c)/2,startX:a.x,startY:a.y,graphicInfos:this._getGraphicInfos(),box:this.backgroundGraphic.geometry,rotate:this.rotateGraphic.geometry}};c.prototype._getGraphicInfos=function(){var a=this;return this.graphics.map(function(b){return a._getGraphicInfo(b)})};c.prototype._getGraphicInfo=function(a){a=a.geometry;var b=this._getBounds([0,0,0,0],[a]),d=b[0],c=b[1],k=b[2],b=b[3];return{width:Math.abs(k-
d),height:Math.abs(b-c),centerX:(k+d)/2,centerY:(b+c)/2,geometry:a}};c.prototype._onGraphicClickCallback=function(a){var b=a.graphic;(b===this.rotateGraphic||-1<this.handleGraphics.indexOf(b))&&a.viewEvent.stopPropagation()};c.prototype._onGraphicMoveStartCallback=function(a){var b=a.graphic;this._resetGraphicStateVars();this._hideGraphicsBeforeUpdate();this.backgroundGraphic.symbol=this._dashedFillSymbol;this._startInfo=this._getStartInfo(b);b===this.rotateGraphic?this._emitRotateStartEvent(this._rotationAngle,
b):-1<this.handleGraphics.indexOf(b)?(this._activeHandleGraphic=b,this._emitScaleStartEvent(this._xScale,this._yScale,b)):this._emitMoveStartEvent(a.dx,a.dy,b)};c.prototype._onGraphicMoveCallback=function(a){var b=a.graphic;if(this._startInfo)if(-1<this.handleGraphics.indexOf(b))this._scaleGraphic(b),this._emitScaleEvent(this._xScale,this._yScale,b);else if(b===this.rotateGraphic)this._rotateGraphic(b),this._emitRotateEvent(this._rotationAngle,b);else{var d=a.dx;a=a.dy;this._totalDx+=d;this._totalDy+=
a;this._moveGraphic(b,d,a);this._emitMoveEvent(d,a,b)}};c.prototype._onGraphicMoveStopCallback=function(a){a=a.graphic;this._startInfo?(this._updateGraphics(),this._showGraphicsAfterUpdate(),this.backgroundGraphic.symbol=this._defaultFillSymbol,a===this.rotateGraphic?this._emitRotateStopEvent(this._rotationAngle,a):-1<this.handleGraphics.indexOf(a)?this._emitScaleStopEvent(this._xScale,this._yScale,a):this._emitMoveStopEvent(this._totalDx,this._totalDy,a),this._resetGraphicStateVars()):this.refresh()};
c.prototype._onGraphicPointerOverCallback=function(a){var b=this.view.rotation,d=a.index;a.graphic===this.rotateGraphic&&(this.rotateGraphic.symbol=this._rotateGraphicHoverSymbol);8>d&&(d=0<=b&&45>b?d%8:45<=b&&90>b?(d+1)%8:90<=b&&135>b?(d+2)%8:135<=b&&180>b?(d+3)%8:180<=b&&225>b?(d+4)%8:225<=b&&270>b?(d+5)%8:270<=b&&315>b?(d+6)%8:(d+7)%8);switch(d){case 0:a="nwse-resize";break;case 1:a="ns-resize";break;case 2:a="nesw-resize";break;case 3:a="ew-resize";break;case 4:a="nwse-resize";break;case 5:a=
"ns-resize";break;case 6:a="nesw-resize";break;case 7:a="ew-resize";break;default:a="pointer"}this.view.container.style.cursor=a};c.prototype._onGraphicPointerOutCallback=function(a){a.graphic===this.rotateGraphic&&(this.rotateGraphic.symbol=this._rotateGraphicSymbol);"default"!==this.view.container.style.cursor&&(this.view.container.style.cursor="default")};c.prototype._scaleGraphic=function(a){var b=this.handleGraphics.indexOf(a),d=this._startInfo,c=d.centerX,k=d.centerY,l=d.startX,d=d.startY;1!==
b&&5!==b||this._updateX(a,c);3!==b&&7!==b||this._updateY(a,k);a=a.geometry;var e=a.x,f=a.y,h=this.view.state.transform,g=h[0]*e+h[2]*f+h[4],p=h[1]*e+h[3]*f+h[5];a=this._startInfo.graphicInfos.map(function(a){return a.geometry});if(this.preserveAspectRatio){this._xScale=this._yScale=m.getScaleRatio(h[0]*c+h[2]*k+h[4],h[1]*c+h[3]*k+h[5],h[0]*l+h[2]*d+h[4],h[1]*l+h[3]*d+h[5],g,p);for(l=0;l<a.length;l++)b=a[l],d=a.indexOf(b),this.graphics[d].geometry=m.scale(b,this._xScale,this._yScale,this.view,[c,k]);
this._updateBackgroundGraphic()}else{g=this._startInfo;h=g.width;g=g.height;e-=l;f=d-f;if(1===b||5===b)e=0;else if(3===b||7===b)f=0;if(0!==e||0!==f){this._xScale=(h+(l>c?e:-1*e))/h||1;this._yScale=(g+(d<k?f:-1*f))/g||1;if(1===b||5===b)this._xScale=1;else if(3===b||7===b)this._yScale=1;b=(c+e/2-c)/this.view.state.resolution;l=(k+f/2-k)/this.view.state.resolution;d=m.scale(this._startInfo.box,this._xScale,this._yScale,this.view);this.backgroundGraphic.geometry=m.move(d,b,l,this.view,!0);b=this._getGraphicInfo(this.backgroundGraphic);
l=b.centerX;d=b.centerY;e=(l-c)/this.view.state.resolution;f=-1*(d-k)/this.view.state.resolution;for(h=0;h<a.length;h++)b=a[h],g=a.indexOf(b),b=m.scale(b,this._xScale,this._yScale,this.view,[c,k]),this.graphics[g].geometry=m.move(b,e,f,this.view,!0);this.centerGraphic.geometry=new n.Point(l,d,this.view.spatialReference)}}};c.prototype._rotateGraphic=function(a){var b=this._startInfo,c=b.centerX,e=b.centerY,k=b.startX,f=b.startY,g=b.box,b=b.rotate;a=a.geometry;var p=a.x,h=a.y;a=new n.Point(c,e,this.view.spatialReference);
this._rotationAngle=m.getRotationAngle(c,e,k,f,p,h);c=this._startInfo.graphicInfos.map(function(a){return a.geometry});for(e=0;e<c.length;e++)f=c[e],k=c.indexOf(f),f=r.rotate(f,this._rotationAngle,a),this.graphics[k].geometry=f;this.backgroundGraphic.geometry=r.rotate(g,this._rotationAngle,a);this.rotateGraphic.geometry=r.rotate(b,this._rotationAngle,a)};c.prototype._moveGraphic=function(a,b,c){if(-1<this.graphics.indexOf(a)){var d=this.backgroundGraphic.geometry;this.backgroundGraphic.geometry=m.move(d,
b,c,this.view);for(var e=0,f=this.graphics;e<f.length;e++)d=f[e],d!==a&&(d.geometry=m.move(d.geometry,b,c,this.view))}else a===this.centerGraphic&&(d=this.backgroundGraphic.geometry,this.backgroundGraphic.geometry=m.move(d,b,c,this.view));if(a===this.backgroundGraphic||a===this.centerGraphic)for(a=0,e=this.graphics;a<e.length;a++)d=e[a],d.geometry=m.move(d.geometry,b,c,this.view)};c.prototype._setupGraphics=function(){this._set("centerGraphic",new p(null,this._centerGraphicSymbol));this.showCenterGraphic&&
this.layer.add(this.centerGraphic);this._set("backgroundGraphic",new p(null,this._defaultFillSymbol));this.layer.add(this.backgroundGraphic);this._rotateLineGraphic=new p(null,this._rotateLineGraphicSymbol);this._set("rotateGraphic",new p(null,this._rotateGraphicSymbol));this.enableRotation&&!this._hasExtentGraphic()&&(this.layer.add(this._rotateLineGraphic),this.layer.add(this.rotateGraphic));for(var a=0;8>a;a++)this.handleGraphics.push(new p(null,this._defaultGraphicSymbol));this.enableScaling&&
this.layer.addMany(this.handleGraphics)};c.prototype._updateGraphics=function(){this._updateBackgroundGraphic();this._updateHandleGraphics();this._updateCenterGraphic();this._updateRotateGraphic();this._updateRotateLineGraphic()};c.prototype._hideGraphicsBeforeUpdate=function(){this.centerGraphic.visible=!1;this.rotateGraphic.visible=!1;this._rotateLineGraphic.visible=!1;this.handleGraphics.forEach(function(a){return a.visible=!1})};c.prototype._showGraphicsAfterUpdate=function(){this.enableRotation&&
(this._rotateLineGraphic.visible=!0,this.rotateGraphic.visible=!0);this.showCenterGraphic&&(this.centerGraphic.visible=!0);this.enableScaling&&this.handleGraphics.forEach(function(a){return a.visible=!0})};c.prototype._updateHandleGraphics=function(){var a=this,b=this._getCoordinates(!0);this.handleGraphics.forEach(function(c,e){e=b[e];a._updateXY(c,e[0],e[1])})};c.prototype._updateBackgroundGraphic=function(){var a=this._getCoordinates();this.backgroundGraphic.geometry=new n.Polygon({rings:a,spatialReference:this.view.spatialReference})};
c.prototype._updateCenterGraphic=function(){var a=this._getBoxBounds([0,0,0,0]);this.centerGraphic.geometry=new n.Point((a[2]+a[0])/2,(a[3]+a[1])/2,this.view.spatialReference)};c.prototype._updateRotateGraphic=function(){if(this.handleGraphics.length){var a=this.handleGraphics[1].geometry;this.rotateGraphic.geometry=new n.Point(a.x,a.y+this.view.state.resolution*this._rotateGraphicOffset,this.view.spatialReference)}};c.prototype._updateRotateLineGraphic=function(){if(this.handleGraphics.length&&this.rotateGraphic&&
this.rotateGraphic.geometry){var a=this.handleGraphics[1].geometry,b=this.rotateGraphic.geometry;this._rotateLineGraphic.geometry=new n.Polyline({paths:[[a.x,a.y],[b.x,b.y]],spatialReference:this.view.spatialReference})}};c.prototype._updateXY=function(a,b,c){a.geometry=new n.Point(b,c,this.view.spatialReference)};c.prototype._updateX=function(a,b){a.geometry=new n.Point(b,a.geometry.y,this.view.spatialReference)};c.prototype._updateY=function(a,b){a.geometry=new n.Point(a.geometry.x,b,this.view.spatialReference)};
c.prototype._hasExtentGraphic=function(){return this.graphics.some(function(a){return a&&a.geometry&&"extent"===a.geometry.type})};c.prototype._getBoxBounds=function(a){var b=this.graphics.map(function(a){return a.geometry});return this._getBounds(a,b)};c.prototype._getCoordinates=function(a){var b=this._getBoxBounds([0,0,0,0]),c=b[0],e=b[1],f=b[2],b=b[3];if(a){a=(c+f)/2;var g=(b+e)/2;return[[c,b],[a,b],[f,b],[f,g],[f,e],[a,e],[c,e],[c,g]]}return[[c,b],[f,b],[f,e],[c,e]]};c.prototype._emitMoveStartEvent=
function(a,b,c){a=new E(this.graphics,c,a,b);this.emit("move-start",a);if(this.callbacks.onMoveStart)this.callbacks.onMoveStart(a)};c.prototype._emitMoveEvent=function(a,b,c){a=new F(this.graphics,c,a,b);this.emit("move",a);if(this.callbacks.onMove)this.callbacks.onMove(a)};c.prototype._emitMoveStopEvent=function(a,b,c){a=new G(this.graphics,c,a,b);this.emit("move-stop",a);if(this.callbacks.onMoveStop)this.callbacks.onMoveStop(a)};c.prototype._emitRotateStartEvent=function(a,b){a=new H(this.graphics,
b,a);this.emit("rotate-start",a);if(this.callbacks.onRotateStart)this.callbacks.onRotateStart(a)};c.prototype._emitRotateEvent=function(a,b){a=new I(this.graphics,b,a);this.emit("rotate",a);if(this.callbacks.onRotate)this.callbacks.onRotate(a)};c.prototype._emitRotateStopEvent=function(a,b){a=new J(this.graphics,b,a);this.emit("rotate-stop",a);if(this.callbacks.onRotateStop)this.callbacks.onRotateStop(a)};c.prototype._emitScaleStartEvent=function(a,b,c){a=new K(this.graphics,c,a,b);this.emit("scale-start",
a);if(this.callbacks.onScaleStart)this.callbacks.onScaleStart(a)};c.prototype._emitScaleEvent=function(a,b,c){a=new L(this.graphics,c,a,b);this.emit("scale",a);if(this.callbacks.onScale)this.callbacks.onScale(a)};c.prototype._emitScaleStopEvent=function(a,b,c){a=new M(this.graphics,c,a,b);this.emit("scale-stop",a);if(this.callbacks.onScaleStop)this.callbacks.onScaleStop(a)};g([f.property()],c.prototype,"_rotateLineGraphic",void 0);g([f.property()],c.prototype,"callbacks",void 0);g([f.property({readOnly:!0})],
c.prototype,"centerGraphic",void 0);g([f.property({readOnly:!0})],c.prototype,"backgroundGraphic",void 0);g([f.property()],c.prototype,"enableMovement",void 0);g([f.property()],c.prototype,"enableRotation",void 0);g([f.property()],c.prototype,"enableScaling",void 0);g([f.property()],c.prototype,"graphics",void 0);g([f.property({readOnly:!0})],c.prototype,"handleGraphics",void 0);g([f.property()],c.prototype,"layer",void 0);g([f.property()],c.prototype,"preserveAspectRatio",void 0);g([f.property({readOnly:!0})],
c.prototype,"rotateGraphic",void 0);g([f.property()],c.prototype,"showCenterGraphic",void 0);g([f.property({dependsOn:["view.ready","graphics.length","layer"],readOnly:!0})],c.prototype,"state",null);g([f.property()],c.prototype,"view",void 0);return c=g([f.subclass("esri.views.2d.draw.support.Box")],c)}(f.declared(z,A))});