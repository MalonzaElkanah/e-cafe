// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils"],function(N,q,F,I){function y(a,b){var d=a||{},g=d.format,c=d.quality,k=d.rotation,d=d.disableSlice,e=b.padding||J,f;f=b.width-e.left-e.right;b=b.height-e.top-e.bottom;var p=0,e=0,l=f,m=b;if(a&&a.area){var p=Math.floor(a.area.x)||0,e=Math.floor(a.area.y)||0,h=null!=a.area.width?Math.floor(a.area.width):null,r=null!=a.area.height?Math.floor(a.area.height):null,l=l-p,m=m-e;null!=h&&null!=r?(l=Math.min(l,h),m=
Math.min(m,r)):null==h&&null!=r?(h=Math.min(l,h),m*=h/l,l=h):null!=h&&null==r&&(h=Math.min(m,r),l*=h/m,m=h)}a&&null!=a.width&&null!=a.height&&(h=a.width/a.height,r=l/m,r!==h&&(r<h?l=Math.floor(m*h):m=Math.floor(l/h)));p=Math.floor(Math.max(p,0));e=Math.floor(Math.max(e,0));f={x:p,y:e,width:Math.floor(Math.min(l,f-p)),height:Math.floor(Math.min(m,b-e))};b=f.width/f.height;e=l/m;e!==b&&(e>b?(b=Math.floor(f.width/e),f={x:f.x,y:Math.floor(f.y+(f.height-b)/2),width:f.width,height:b}):(b=Math.floor(f.height*
e),f={x:Math.floor(f.x+(f.width-b)/2),y:f.y,width:b,height:f.height}));b=K(a,f);a=b.width;b=b.height;a:switch(g){case "png":case "jpg":case "jpeg":break a;case null:case void 0:g=z;break a;default:I.neverReached(g),g=z}e=L[g];c=null!=c?c:e;return{format:g,quality:0>c?0:100<c?100:c,area:f,width:a,height:b,rotation:k,disableSlice:d||!1}}function A(a,b){return a.toDataURL(M[b.format],b.quality/100)}function B(a,b,d){d||(t||(t=document.createElement("canvas"),t.width=1,t.height=1),d=t);return d.getContext("2d").createImageData(a,
b)}function K(a,b){if(!a)return b;var d=a.width;a=a.height;if(null!=d&&null!=a)return{width:Math.floor(d),height:Math.floor(a)};if(null==d&&null==a)return b;b=b.width/b.height;return null==a?{width:Math.floor(d),height:Math.floor(d/b)}:{width:Math.floor(a*b),height:Math.floor(a)}}Object.defineProperty(q,"__esModule",{value:!0});q.completeUserSettings=y;q.toRenderSettings=function(a,b){var d=y(a,b),g=d.area,c=d.width/g.width,k=b.padding,e=k.left+k.right,f=k.top+k.bottom;return{framebufferWidth:Math.floor((b.width-
e)*c+e),framebufferHeight:Math.floor((b.height-f)*c+f),region:{x:Math.floor(g.x*c)+k.left,y:Math.floor(g.y*c)+k.top,width:d.width,height:d.height},format:d.format,quality:d.quality,rotation:d.rotation,pixelRatio:c,layers:a&&a.layers?a.layers:[],disableSlice:d.disableSlice}};q.encodeResult=function(a,b,d,g){if(g.premultipliedAlpha)for(var c=a.data,k=c.length,e=0;e<k;e+=4){var f=c[e+3];0<f&&(f/=255,c[e+0]/=f,c[e+1]/=f,c[e+2]/=f)}d.width=a.width;d.height=a.height;c=d.getContext("2d");c.putImageData(a,
0,0);g.flipY&&(c.save(),c.globalCompositeOperation="copy",c.scale(1,-1),c.translate(0,-c.canvas.height),c.drawImage(c.canvas,0,0),c.restore());a=c.getImageData(0,0,a.width,a.height);b=A(d,b);d.width=0;d.height=0;return{dataUrl:b,data:a}};q.toDataUrl=A;q.createEmptyImageData=function(a,b,d){if(!a||!b)throw Error("Cannot construct image data without dimensions");if(u)try{return new ImageData(a,b)}catch(g){u=!1}return B(a,b,d)};q.wrapImageData=function(a,b,d,g){if(!b||!d)throw Error("Cannot construct image data without dimensions");
if(u)try{return new ImageData(a,b,d)}catch(c){u=!1}b=B(b,d,g);b.data.set(a,0);return b};q.resampleHermite=function(a,b,d,g,c,k,e,f){void 0===g&&(g=0);void 0===c&&(c=0);void 0===k&&(k=a.width-g);void 0===e&&(e=a.height-c);void 0===f&&(f=!1);var p=a.data,l=b.width,m=b.height,h=b.data;k/=l;e/=m;var r=Math.ceil(k/2),q=Math.ceil(e/2);a=a.width;for(var v=0;v<m;v++)for(var w=0;w<l;w++){for(var t=4*(w+(f?m-v-1:v)*l),u=0,G=0,y=0,z=0,A=0,H=0,B=(v+.5)*e,C=Math.floor(v*e);C<(v+1)*e;C++)for(var D=Math.abs(B-(C+
.5))/q,F=(w+.5)*k,D=D*D,E=Math.floor(w*k);E<(w+1)*k;E++){var n=Math.abs(F-(E+.5))/r,n=Math.sqrt(D+n*n);if(!(1<=n)){var n=2*n*n*n-3*n*n+1,x=4*(g+E+(c+C)*a),H=H+n*p[x+3],G=G+n;!d&&255>p[x+3]&&(n=n*p[x+3]/255);y+=n*p[x];z+=n*p[x+1];A+=n*p[x+2];u+=n}}h[t]=y/u;h[t+1]=z/u;h[t+2]=A/u;h[t+3]=H/G}return b};q.screenshotSuperSampleSettings=function(a,b){if(!b)return a;b=a.framebufferWidth;var d=a.framebufferHeight,g=a.region,c=Math.min(8,2048/Math.max(b,d));return 1.5>c?a:F({},a,{framebufferWidth:Math.round(b*
c),framebufferHeight:Math.round(d*c),pixelRatio:a.pixelRatio*c,resample:{region:{x:Math.round(g.x*c),y:Math.round(g.y*c),width:Math.round(g.width*c),height:Math.round(g.height*c)},width:b,height:d}})};var t=null,u=!0,M={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},z="jpg",L={png:100,jpg:98,jpeg:98},J={top:0,right:0,bottom:0,left:0}});