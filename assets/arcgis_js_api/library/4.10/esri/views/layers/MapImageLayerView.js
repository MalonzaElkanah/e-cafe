// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Error ../../core/promiseUtils ../../core/accessorSupport/decorators ../../renderers/support/clickToleranceUtils ./RefreshableLayerView".split(" "),function(n,p,h,c,k,f,d,l,m){return function(g){function b(b){return g.call(this,b)||this}h(b,g);b.prototype.fetchPopupFeatures=function(b){var d=this,e=this.layer;if(!b)return f.reject(new k("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",
{layer:e}));var c=this.get("view.scale"),e=e.allSublayers.toArray().filter(function(a){var b=0===a.minScale||c<=a.minScale,d=0===a.maxScale||c>=a.maxScale;return a.popupTemplate&&a.popupEnabled&&a.visible&&b&&d});return f.eachAlways(e.map(function(a){var c=a.createQuery(),e=l.calculateTolerance(a.renderer);c.geometry=d.createFetchPopupFeaturesQueryGeometry(b,e);c.outFields=a.get("popupTemplate.requiredFields");return a.queryFeatures(c).then(function(a){return a.features})})).then(function(a){return[].concat.apply([],
a.map(function(a){return a.value}).filter(Boolean))})};c([d.property()],b.prototype,"layer",void 0);return b=c([d.subclass("esri.views.layers.MapImageLayerView")],b)}(d.declared(m))});