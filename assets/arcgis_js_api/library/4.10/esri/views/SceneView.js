// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-class ../core/Accessor ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./DOMContainer".split(" "),function(p,f,k,a,g,b,e,c,d,m,l,h){var n={widthBreakpoint:{getValue:function(a){var b=a.viewSize[0];a=a.breakpoints;var c=this.values;return b<=a.xsmall?c.xsmall:b<=a.small?
c.small:b<=a.medium?c.medium:b<=a.large?c.large:c.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",
large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(a){var b=a.viewSize[1];a=a.breakpoints;var c=this.values;return b<=a.xsmall?c.xsmall:b<=a.small?c.small:b<=a.medium?c.medium:
b<=a.large?c.large:c.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",
large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(a){a=a.viewSize;var b=this.values;return a[1]>=a[0]?b.portrait:b.landscape},values:{portrait:"portrait",landscape:"landscape"},
valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},q={xsmall:544,small:768,medium:992,large:1200};return function(h){function e(){var a=null!==h&&h.apply(this,arguments)||this;a._breakpointsHandles=new d;a.breakpoints=q;a.orientation=null;a.widthBreakpoint=null;a.heightBreakpoint=null;return a}k(e,h);e.prototype.initialize=function(){this._breakpointsHandles.add([m.init(this,["breakpoints","size"],this._updateClassNames)])};e.prototype.destroy=
function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};e.prototype._updateClassNames=function(){if(this.container){var a=c.acquire(),b=c.acquire(),h=!1,e,l,d;for(e in n)l=this[e],d=n[e].getValue({viewSize:this.size,breakpoints:this.breakpoints}),l!==d&&(h=!0,this[e]=d,b.push(n[e].valueToClassName[l]),a.push(n[e].valueToClassName[d]));h&&(this._applyClassNameChanges(a,b),c.release(a),c.release(b))}};e.prototype._applyClassNameChanges=
function(a,c){var e=this.container;e&&(b.remove(e,c),b.add(e,a))};e.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var c in n)b.remove(a,n[c].valueToClassName[this[c]])};a([l.property({set:function(a){var b=this._get("breakpoints");if(a!==b){b=(b=a)&&b.xsmall<b.small&&b.small<b.medium&&b.medium<b.large;if(!b){var c=JSON.stringify(q,null,2);console.warn("provided breakpoints are not valid, using defaults:"+c)}a=b?a:q;this._set("breakpoints",g({},a))}}})],e.prototype,"breakpoints",
void 0);a([l.property()],e.prototype,"orientation",void 0);a([l.property()],e.prototype,"widthBreakpoint",void 0);a([l.property()],e.prototype,"heightBreakpoint",void 0);return e=a([l.subclass("esri.views.BreakpointsOwner")],e)}(l.declared(e,h))})},"esri/views/DOMContainer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom dojo/dom-construct dojo/on ../core/Accessor ../core/domUtils ../core/Evented ../core/Handles ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ./overlay/ViewOverlay ../widgets/Popup".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u){function r(a){a&&(d.orphan(a),a.parentNode&&a.parentNode.removeChild(a))}var y=[0,0];return function(c){function d(){var a=c.call(this)||this;a._domHandles=new l;a._freqInfo={freq:16,time:750};a._overlayRenderTaskHandle=null;a.height=0;a.position=null;a.resizing=!1;a.root=null;a.surface=null;a.suspended=!0;a.ui=null;a.userContent=null;a.width=0;a.watch("cursor",function(b){var c=a.surface;c&&c.setAttribute("data-cursor",b)});a.watch("interacting",function(b){var c=
a.surface;c&&c.setAttribute("data-interacting",b.toString())});return a}k(d,c);d.prototype.initialize=function(){var a=this;this.watch("ui",this._handleUIChange);this._wireUI(this.ui);this._focusHandle=this.on("focus",function(){return a.notifyChange("focused")});this._blurHandle=this.on("blur",function(){return a.notifyChange("focused")})};d.prototype.destroy=function(){this.ui.destroy();this.popup&&!this.popup.destroyed&&this.popup.destroy();this.container=null;this._domHandles.destroy();this._focusHandle&&
(this._focusHandle.remove(),this._focusHandle=null);this._blurHandle&&(this._blurHandle.remove(),this._blurHandle=null)};Object.defineProperty(d.prototype,"container",{set:function(a){var b=this,c=this._get("container");if(c!==a)if(this._domHandles.remove("dom-size"),this._stopMeasuring(),c&&(c.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),r(this.root),this._set("root",
null),r(this.userContent),this._set("userContent",null)),a){a.classList.add("esri-view");c=document.createElement("div");for(c.className="esri-view-user-storage";a.hasChildNodes();)c.appendChild(a.firstChild);a.appendChild(c);c=document.createElement("div");c.className="esri-view-root";a.insertBefore(c,a.firstChild);this._set("root",c);var d=document.createElement("div");d.className="esri-view-surface";d.setAttribute("role","application");d.tabIndex=0;g.setSelectable(d,!1);c.appendChild(d);this._set("surface",
d);var e=new t;c.appendChild(e.surface);this._set("overlay",e);e.watch("needsRender",function(a){a&&!b._overlayRenderTaskHandle?b._overlayRenderTaskHandle=h.addFrameTask({render:function(){b.overlay.render()}}):b._overlayRenderTaskHandle&&(b._overlayRenderTaskHandle.remove(),b._overlayRenderTaskHandle=null)});this._forceReadyCycle();this._domHandles.add(n.init(this,"size",function(a){var b=a[1];d.classList.toggle("esri-view-surface--inset-outline",a[0]>=document.body.clientWidth||b>=document.body.clientHeight)}),
"dom-size");this._set("container",a);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"focused",{get:function(){var a=document.activeElement===this.surface;return document.hasFocus()&&a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"popup",{get:function(){return this._get("popup")||new u({view:this})},
set:function(a){var b=this._get("popup");b&&b!==a&&b.destroy();this._set("popup",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"size",{get:function(){return[this.width,this.height]},enumerable:!0,configurable:!0});d.prototype.blur=function(){this.surface&&this.surface.blur()};d.prototype.focus=function(){this.surface&&this.surface.focus()};d.prototype.pageToContainer=function(a,b,c){var d=this.position;a-=d[0];b-=d[1];c?(c[0]=a,c[1]=b):c=[a,b];return c};d.prototype.containerToPage=
function(a,b,c){var d=this.position;a+=d[0];b+=d[1];c?(c[0]=a,c[1]=b):c=[a,b];return c};d.prototype._handleUIChange=function(a,b){b&&(this._domHandles.remove("ui"),b.destroy());a&&this._wireUI(a);this._set("ui",a)};d.prototype._wireUI=function(a){this._domHandles.remove("ui");a&&(a.view=this,this._domHandles.add([n.init(this,"root",function(c){a.container=c?b.create("div",null,c):null}),n.init(this,"popup",function(b,c){c&&a.remove(c,"popup");b&&(b.view=a.view,a.add(b,{key:"popup",position:"manual"}))})],
"ui"))};d.prototype._stopMeasuring=function(){this._domHandles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};d.prototype._startMeasuring=function(){var a=this,b=this._freqInfo;b.freq=16;b.time=750;this._domHandles.add([e(window,"resize",function(){b.freq=16;b.time=750}),h.addFrameTask({prepare:function(b){var c=a._measure(),d=a._freqInfo;d.time+=b.deltaTime;c&&(d.freq=16,a._get("resizing")||a._set("resizing",!0));d.time<d.freq||(d.time=0,a._position()||c?d.freq=16:d.freq=Math.min(750,
2*d.freq),!c&&512<=d.freq&&a._get("resizing")&&a._set("resizing",!1))}})],"measuring");this._measure();this._position()};d.prototype._measure=function(){var a=this.container,b=a?a.clientWidth:0,c=a?a.clientHeight:0;if(0===b||0===c||"hidden"===window.getComputedStyle(a).visibility)return this.suspended||this._set("suspended",!0),!1;var a=this.width,d=this.height;if(b===a&&c===d)return this.suspended&&this._set("suspended",!1),!1;this._set("width",b);this._set("height",c);this.suspended&&this._set("suspended",
!1);this.emit("resize",{oldWidth:a,oldHeight:d,width:b,height:c});return!0};d.prototype._position=function(){var a=this.container,b=this.position,c=(a.ownerDocument||window.document).defaultView,a=a.getBoundingClientRect();y[0]=a.left+c.pageXOffset;y[1]=a.top+c.pageYOffset;return b&&y[0]===b[0]&&y[1]===b[1]?!1:(this._set("position",[y[0],y[1]]),!0)};a([q.property({value:null,cast:function(a){return g.byId(a)}})],d.prototype,"container",null);a([q.property({readOnly:!0,dependsOn:["surface"]})],d.prototype,
"focused",null);a([q.property({readOnly:!0})],d.prototype,"height",void 0);a([q.property({type:u})],d.prototype,"popup",null);a([q.property({type:t})],d.prototype,"overlay",void 0);a([q.property({readOnly:!0})],d.prototype,"position",void 0);a([q.property({readOnly:!0})],d.prototype,"resizing",void 0);a([q.property({readOnly:!0})],d.prototype,"root",void 0);a([q.property({value:null,dependsOn:["width","height"],readOnly:!0})],d.prototype,"size",null);a([q.property({readOnly:!0})],d.prototype,"surface",
void 0);a([q.property({readOnly:!0})],d.prototype,"suspended",void 0);a([q.property()],d.prototype,"ui",void 0);a([q.property({readOnly:!0})],d.prototype,"userContent",void 0);a([q.property({readOnly:!0})],d.prototype,"width",void 0);return d=a([q.subclass("esri.views.DOMContainer")],d)}(q.declared(c,m))})},"esri/core/domUtils":function(){define(["require","exports","../widgets/support/widget"],function(p,f,k){function a(a){return k.isWidgetBase(a)?a.domNode:a}Object.defineProperty(f,"__esModule",
{value:!0});f.show=function(g){if(g=a(g))g.style.display="block"};f.getNode=a;f.hide=function(g){if(g=a(g))g.style.display="none"};f.toggle=function(g){if(g=a(g))g.style.display="none"===g.style.display?"block":"none"};f.orphan=function(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)}})},"esri/views/overlay/ViewOverlay":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators maquette".split(" "),
function(p,f,k,a,g,b,e,c,d){return function(b){function l(){var a=null!==b&&b.apply(this,arguments)||this;a.items=new e;a._callbacks=new Map;a._projector=d.createProjector();a._hiddenProjector=d.createProjector();return a}k(l,b);Object.defineProperty(l.prototype,"needsRender",{get:function(){return 0<this.items.length},enumerable:!0,configurable:!0});l.prototype.initialize=function(){var a=this,b=document.createElement("div");b.className="esri-overlay-surface";g.setSelectable(b,!1);this._set("surface",
b);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style","visibility: hidden;");b.appendChild(this._hiddenSurface);this._itemsChangeHandle=this.items.on("change",function(b){b.added.map(function(b){var c=function(){return b.render()};a._callbacks.set(b,c);a._projector.append(a.surface,c)});b.removed.map(function(b){var c=a._projector.detach(a._callbacks.get(b));a.surface.removeChild(c.domNode);a._callbacks.delete(b)})})};l.prototype.addItem=function(a){this.items.add(a)};
l.prototype.removeItem=function(a){this.items.remove(a)};l.prototype.destroy=function(){this.items.removeAll();this._itemsChangeHandle.remove();this._projector=this._callbacks=null};l.prototype.render=function(){this._projector.renderNow()};l.prototype.computeBoundingRect=function(a){var b=this._hiddenSurface,c=this._hiddenProjector,d=null,e=function(){return d=a.render()};c.append(b,e);c.renderNow();var l={left:0,top:0,right:0,bottom:0};if(d&&d.domNode){var h=d.domNode.getBoundingClientRect();l.left=
h.left;l.top=h.top;l.right=h.right;l.bottom=h.bottom}for(c.detach(e);b.firstChild;)b.removeChild(b.firstChild);return l};l.prototype.overlaps=function(a,b){a=this.computeBoundingRect(a);b=this.computeBoundingRect(b);return Math.max(a.left,b.left)<=Math.min(a.right,b.right)&&Math.max(a.top,b.top)<=Math.min(a.bottom,b.bottom)};Object.defineProperty(l.prototype,"hasVisibleItems",{get:function(){return this.items.some(function(a){return a.visible})},enumerable:!0,configurable:!0});l.prototype.renderCanvas=
function(a){if(this.items.some(function(a){return a.visible})){var b=a.getContext("2d");b.save();b.font="10px "+getComputedStyle(this.surface).fontFamily;this.items.forEach(function(a){b.save();a.renderCanvas(b);b.restore()});b.restore()}};a([c.property({readOnly:!0})],l.prototype,"surface",void 0);a([c.property({readOnly:!0})],l.prototype,"items",void 0);a([c.property({readOnly:!0,dependsOn:["items.length"]})],l.prototype,"needsRender",null);return l=a([c.subclass("esri.views.overlay.ViewOverlay")],
l)}(c.declared(b))})},"esri/widgets/Popup":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-geometry dojo/i18n!../nls/common dojo/i18n!./Popup/nls/Popup dojo/keys ../core/Handles ../core/lang ../core/Logger ../core/watchUtils ../core/accessorSupport/decorators ./Feature ./Spinner ./Widget ./Popup/PopupViewModel ./support/widget ./support/widgetUtils".split(" "),function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,
u,r,y,x,z){function w(a,b){return void 0===b?"esri-popup__"+a:"esri-popup__"+a+"-"+b}var B={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},C=h.getLogger("esri.widgets.Popup");return function(h){function r(a){var b=h.call(this)||this;b._blurContainer=!1;b._containerNode=null;b._mainContainerNode=null;b._featureMenuNode=null;b._actionsMenuNode=null;b._focusContainer=!1;b._focusDockButton=!1;b._focusFeatureMenuButton=!1;b._focusActionsMenuButton=!1;b._focusFirstFeature=!1;b._focusFirstAction=
!1;b._handles=new m;b._pointerOffsetInPx=16;b._spinner=null;b.actions=null;b.alignment="auto";b.autoCloseEnabled=null;b.autoOpenEnabled=null;b.content=null;b.collapsed=!1;b.collapseEnabled=!0;b.dockEnabled=!1;b.featureCount=null;b.features=null;b.featureNavigationEnabled=!0;b.goToOverride=null;b.highlightEnabled=null;b.location=null;b.featureWidgets=[];b.promises=null;b.selectedFeature=null;b.selectedFeatureIndex=null;b.selectedFeatureWidget=null;b.spinnerEnabled=!0;b.title=null;b.updateLocationEnabled=
null;b.view=null;b.viewModel=new y;b.visible=null;b._addSelectedFeatureIndexHandle();b.own([n.watch(b,"viewModel.screenLocation",function(){return b._positionContainer()}),n.watch(b,["viewModel.visible","dockEnabled"],function(){return b._toggleScreenLocationEnabled()}),n.watch(b,"viewModel.screenLocation",function(a,c){!!a!==!!c&&b.reposition()}),n.watch(b,"viewModel.features",function(a){return b._createFeatureWidgets(a)}),n.watch(b,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),
function(){return b.reposition()}),n.watch(b,"spinnerEnabled",function(a){return b._spinnerEnabledChange(a)}),n.watch(b,"viewModel.view.size",function(a,c){return b._updateDockEnabledForViewSize(a,c)}),n.watch(b,"viewModel.view",function(a,c){return b._viewChange(a,c)}),n.watch(b,"viewModel.view.ready",function(a,c){return b._viewReadyChange(a,c)}),n.watch(b,["viewModel.waitingForResult","viewModel.location"],function(){return b._displaySpinner()}),n.watch(b,["featureWidgets","viewModel.selectedFeatureIndex"],
function(){return b._updateFeatureWidget()}),n.watch(b,"selectedFeatureWidget.viewModel.title",function(a){return b._setTitleFromFeatureWidget(a)}),n.watch(b,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],function(){return b._setContentFromFeatureWidget()}),n.whenFalse(b,"collapsed",function(){"xsmall"===b.get("viewModel.view.widthBreakpoint")&&b.visible&&b.collapseEnabled&&b.viewModel.centerAtLocation()})]);return b}k(r,h);r.prototype.destroy=function(){this._destroyFeatureWidgets();
this._destroySpinner();this._handles&&this._handles.destroy();this._handles=null};Object.defineProperty(r.prototype,"actionsMenuOpen",{get:function(){return this.viewModel.visible?this._get("actionsMenuOpen"):!1},set:function(a){this._set("actionsMenuOpen",!!a)},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},
enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||B},set:function(a){var b=g({},B),c=this.get("viewModel.view.breakpoints"),d={};c&&(d.width=c.xsmall,d.height=c.xsmall);a=g({},b,a);b=g({},b.breakpoint,d);d=a.breakpoint;!0===d?a.breakpoint=b:"object"===typeof d&&(a.breakpoint=g({},b,d));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,
"featureMenuOpen",{get:function(){return this.viewModel.visible?this._get("featureMenuOpen"):!1},set:function(a){this._set("featureMenuOpen",!!a)},enumerable:!0,configurable:!0});r.prototype.blur=function(){this.visible||C.warn("Popup cannot be blurred while visible is false");this._blurContainer=!0;this.scheduleRender()};r.prototype.clear=function(){};r.prototype.close=function(){this.visible=!1};r.prototype.focus=function(){this.visible||C.warn("Popup cannot be focused while visible is false");
this._focusContainer=!0;this.scheduleRender()};r.prototype.next=function(){return null};r.prototype.open=function(a){this._handles.remove("selected-index");var b={collapsed:a?!!a.collapsed:!1,actionsMenuOpen:a?!!a.actionsMenuOpen:!1,featureMenuOpen:a?!!a.featureMenuOpen:!1};"xsmall"===this.get("viewModel.view.widthBreakpoint")&&(b.collapsed=!0,a.updateLocationEnabled=!0);this.set(b);this.viewModel.open(a);this._addSelectedFeatureIndexHandle()};r.prototype.previous=function(){return null};r.prototype.reposition=
function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};r.prototype.triggerAction=function(a){return null};r.prototype.render=function(){var a,b,d,h,n,m,q,g=this.actionsMenuOpen,t=this.collapsed,r=this.collapseEnabled,u=this.dockEnabled,k=this.featureMenuOpen,B=this.featureNavigationEnabled,f=this.featureWidgets,y=this.visible,C=this.viewModel,D=C.allActions,E=C.content,ca=C.featureCount,Z=C.pendingPromisesCount,da=C.selectedFeatureIndex,p=C.title,ia=D&&D.length,ea=1<ca&&
B,B=1<ca&&k,D=1<ia&&g,t=r&&!B&&t,aa=ea&&this._getPageText(ca,da),ga=this._renderContent(),fa=z.isRTL(),ja=this.get("selectedFeatureWidget")?this.get("selectedFeatureWidget.viewModel.waitingForContent")||this.get("selectedFeatureWidget.viewModel.content"):ga,V=this.get("viewModel.view.widthBreakpoint"),ha=u?c.undock:c.dock,ca=this.currentAlignment,C=this.currentDockPosition,Z=Z?x.tsx("div",{key:w("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":e.loading,
title:e.loading},x.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})):null,ma=(a={},a["esri-icon-right-triangle-arrow"]=fa,a["esri-popup__pagination-previous-icon--rtl"]=fa,a["esri-icon-left-triangle-arrow"]=!fa,a["esri-popup__pagination-previous-icon"]=!fa,a);a=x.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",ma)});ma=x.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,
class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":c.previous,title:c.previous},a);a=(b={},b["esri-icon-left-triangle-arrow"]=fa,b["esri-popup__pagination-next-icon--rtl"]=fa,b["esri-icon-right-triangle-arrow"]=!fa,b["esri-popup__pagination-next-icon"]=!fa,b);b=x.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",a)});fa=x.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button",
"esri-popup__pagination-next"),"aria-label":c.next,title:c.next},b);a=z.cssTransition("enter","esri-popup--feature-updated");b=this.id+"-feature-menu";k=x.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":b,"aria-expanded":k,"aria-label":e.menu,
title:e.menu},aa);k=ea?[ma,Z||k,fa]:null;aa=this._wouldDockTo();aa=(d={},d["esri-icon-minimize"]=u,d["esri-popup__icon--dock-icon"]=!u,d["esri-icon-dock-right"]=!u&&("top-right"===aa||"bottom-right"===aa),d["esri-icon-dock-left"]=!u&&("top-left"===aa||"bottom-left"===aa),d["esri-icon-maximize"]=!u&&"top-center"===aa,d["esri-icon-dock-bottom"]=!u&&"bottom-center"===aa,d);d=x.tsx("span",{"aria-hidden":"true",class:this.classes(aa,"esri-popup__icon")});d="xsmall"!==V&&this.get("dockOptions.buttonEnabled")?
x.tsx("div",{role:"button","aria-label":ha,title:ha,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},d):null;r=!!(r&&p&&(ja||ia||ea));V=(h={},h["esri-popup__header-container--button"]=r,h);ha=r?"button":"heading";aa=r?t?e.expand:e.collapse:"";h=this.id+"-popup-title";p=p?x.tsx("div",{class:this.classes("esri-popup__header-container",
V),key:p,enterAnimation:a,id:h,role:ha,"aria-label":aa,title:aa,tabIndex:r?0:-1,bind:this,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed},x.tsx("h2",{class:"esri-popup__header-title",innerHTML:p})):null;V=x.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")});V=x.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":e.close,title:e.close},V);d=x.tsx("header",{class:"esri-popup__header"},
p,x.tsx("div",{class:"esri-popup__header-buttons"},d,V));V=this.id+"-popup-content";E=ja&&!t?x.tsx("article",{key:E,enterAnimation:a,id:V,class:"esri-popup__content"},ga):null;ja="bottom-left"===ca||"bottom-center"===ca||"bottom-right"===ca||"top-left"===C||"top-center"===C||"top-right"===C;ga="top-left"===ca||"top-center"===ca||"top-right"===ca||"bottom-left"===C||"bottom-center"===C||"bottom-right"===C;ha=g?e.close:e.open;a=(aa=(a=this._getSingleAction())&&this._renderAction({action:a,index:0,key:"actions",
singleButton:!0}))?x.tsx("div",{key:"single-action-container",class:"esri-popup__single-action-container"},aa):null;ha=!aa&&ia?x.tsx("div",{key:w("actions-menu-button"),class:this.classes("esri-popup__button","esri-popup__actions-menu-button"),role:"button",id:this.id+"-actions-menu-button","aria-haspopup":"true","aria-controls":g?this.id+"-actions-menu":null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,
"aria-label":ha,title:ha},x.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null;aa=(n={},n["esri-popup__navigation--with-single-action"]=1===ia,n);n=x.tsx("section",{key:w("navigation"),class:this.classes("esri-popup__navigation",aa)},k);n=ea||ia?x.tsx("div",{key:w("feature-buttons"),class:"esri-popup__footer"},n,ha,a):null;g=ia&&g?x.tsx("ul",{id:this.id+"-actions-menu",role:"menu","aria-labelledby":this.id+"-actions-menu-button",key:w("actions"),class:"esri-popup__actions",
bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},this._renderActions()):null;da=this._renderFeatureMenuNode(f,da,b);f=l.substitute({total:f.length},c.selectedFeatures);ea=x.tsx("section",{key:w("menu"),class:"esri-popup__feature-menu"},x.tsx("h2",{class:"esri-popup__feature-menu-header"},f),x.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},
da));f=u?null:x.tsx("div",{key:w("pointer"),class:"esri-popup__pointer",role:"presentation"},x.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}));da=this.get("selectedFeature.layer.title");ia=this.get("selectedFeature.layer.id");t=(m={},m["esri-popup--shadow"]=u,m["esri-popup--is-collapsible"]=r,m["esri-popup--is-collapsed"]=t,m);m=(q={},q["esri-popup--aligned-top-center"]=y&&"top-center"===ca,q["esri-popup--aligned-bottom-center"]=y&&"bottom-center"===ca,q["esri-popup--aligned-top-left"]=
y&&"top-left"===ca,q["esri-popup--aligned-bottom-left"]=y&&"bottom-left"===ca,q["esri-popup--aligned-top-right"]=y&&"top-right"===ca,q["esri-popup--aligned-bottom-right"]="bottom-right"===ca,q["esri-popup--is-docked"]=y&&u,q["esri-popup--shadow"]=y&&!u,q["esri-popup--is-docked-top-left"]=y&&"top-left"===C,q["esri-popup--is-docked-top-center"]=y&&"top-center"===C,q["esri-popup--is-docked-top-right"]=y&&"top-right"===C,q["esri-popup--is-docked-bottom-left"]=y&&"bottom-left"===C,q["esri-popup--is-docked-bottom-center"]=
y&&"bottom-center"===C,q["esri-popup--is-docked-bottom-right"]=y&&"bottom-right"===C,q["esri-popup--feature-menu-open"]=y&&B,q["esri-popup--actions-menu-open"]=y&&D,q);q=ja?[ea,g]:null;u=ga?[ea,g]:null;B=ja?n:null;D=ga?n:null;q=x.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",t),tabIndex:-1,role:"dialog","aria-labelledby":p?h:"","aria-describedby":E?V:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},
B,q,d,E,D,u);return x.tsx("div",{key:w("base"),class:this.classes("esri-popup",m),role:"presentation","data-layer-title":da,"data-layer-id":ia,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},y?[q,f]:null)};r.prototype._getSingleAction=function(){var a=this.viewModel.allActions;if(1===a.length)return a.find(function(a){return"button"===a.type})};r.prototype._featureMenuOpenChanged=function(a){a?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};r.prototype._actionsMenuOpenChanged=
function(a){a?this._focusFirstAction=!0:this._focusActionsMenuButton=!0};r.prototype._setTitleFromFeatureWidget=function(a){this.selectedFeatureWidget&&(this.viewModel.title=a||"")};r.prototype._setContentFromFeatureWidget=function(){var a=this.selectedFeatureWidget;a&&(this.viewModel.content=a)};r.prototype._handleFeatureMenuKeyup=function(a){a.keyCode===d.ESCAPE&&(a.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())};r.prototype._handleActionMenuKeyup=
function(a){a.keyCode===d.ESCAPE&&(a.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};r.prototype._handleFeatureMenuItemKeyup=function(a){var b=a.keyCode,c=this._featureMenuNode,e=a.currentTarget["data-feature-index"];if(c){var c=c.querySelectorAll("li"),l=c.length;b===d.UP_ARROW?(a.stopPropagation(),c[(e-1+l)%l].focus()):b===d.DOWN_ARROW?(a.stopPropagation(),c[(e+1+l)%l].focus()):b===d.HOME?(a.stopPropagation(),c[0].focus()):b===d.END&&(a.stopPropagation(),
c[c.length-1].focus())}};r.prototype._handleActionMenuItemKeyup=function(a){var b=a.keyCode,c=this._actionsMenuNode,e=a.currentTarget["data-action-index"];if(c){var c=c.querySelectorAll("li"),l=c.length;b===d.UP_ARROW?(a.stopPropagation(),c[(e-1+l)%l].focus()):b===d.DOWN_ARROW?(a.stopPropagation(),c[(e+1+l)%l].focus()):b===d.HOME?(a.stopPropagation(),c[0].focus()):b===d.END&&(a.stopPropagation(),c[c.length-1].focus())}};r.prototype._handleMainKeyup=function(a){var b=a.keyCode;b===d.LEFT_ARROW&&(a.stopPropagation(),
this.previous());b===d.RIGHT_ARROW&&(a.stopPropagation(),this.next())};r.prototype._spinnerEnabledChange=function(a){this._destroySpinner();a&&(a=this.get("viewModel.view"),this._createSpinner(a))};r.prototype._displaySpinner=function(){var a=this._spinner;if(a){var b=this.viewModel,c=b.location;b.waitingForResult?a.show({location:c}):a.hide()}};r.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}};r.prototype._renderAction=function(a){var b=this,c,d,e=a.action,h=a.index,
m=a.key;a=a.singleButton;var q=n.watch(e,"active className disabled id title image visible".split(" "),function(){return b.scheduleRender()});this._handles.add(q,m);var q=this.get("selectedFeature.attributes"),m=e.title,g=e.className,t=e.image,g=t||g?g:"esri-icon-default-action",m=m&&q?l.substitute(q,m):m,r=g&&q?l.substitute(q,g):g,q=t&&q?l.substitute(q,t):t,t=(c={},c["esri-icon-loading-indicator"]=e.active,c["esri-rotating"]=e.active,c["esri-popup__icon"]=!!g,c["esri-popup__action-image"]=!e.active&&
!!q,c);r&&(t[r]=!e.active);c=(d={},d["esri-popup__action"]="toggle"!==e.type,d["esri-popup__action-toggle"]="toggle"===e.type,d["esri-popup__action-toggle--on"]="toggle"===e.type&&e.value,d["esri-popup__button--disabled"]=e.disabled,d);d=x.tsx("span",{key:"text",class:"esri-popup__action-text"},m);d=[x.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",t),styles:this._getIconStyles(q)}),d];h=a?x.tsx("div",{key:e,role:"button",tabIndex:0,title:m,"aria-label":m,class:this.classes("esri-popup__button",
c),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":h,onclick:this._triggerAction,onkeydown:this._triggerAction},d):x.tsx("li",{key:e,role:"menuitem",tabIndex:0,title:m,"aria-label":m,class:this.classes("esri-popup__button",c),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":h,onclick:this._triggerAction,onkeydown:this._triggerAction},d);return e.visible?h:null};r.prototype._renderActions=function(){var a=this;this._handles.remove("actions");var b=this.viewModel.allActions;
if(b)return b.map(function(b,c){return a._renderAction({action:b,index:c,key:"actions"})}).toArray()};r.prototype._addSelectedFeatureIndexHandle=function(){var a=this,b=n.watch(this,"viewModel.selectedFeatureIndex",function(b,c){return a._selectedFeatureIndexUpdated(b,c)});this._handles.add(b,"selected-index")};r.prototype._selectedFeatureIndexUpdated=function(a,b){this.featureCount&&a!==b&&-1!==a&&(this.featureMenuOpen=this.actionsMenuOpen=!1)};r.prototype._updateFeatureWidget=function(){var a=this.featureWidgets[this.viewModel.selectedFeatureIndex]||
null;a&&!a.contentEnabled&&(a.contentEnabled=!0);this._set("selectedFeatureWidget",a)};r.prototype._destroyFeatureWidgets=function(){this.featureWidgets.forEach(function(a){return a.destroy()});this._set("featureWidgets",[])};r.prototype._createFeatureWidgets=function(a){var b=this.featureWidgets.slice(0),c=this.get("viewModel.view"),d=[];a.forEach(function(a,e){if(a){var l=null;b.some(function(c,d){c&&c.graphic===a&&(l=c,b.splice(d,1));return!!l});d[e]=l||new t({contentEnabled:!1,graphic:a,view:c})}});
b.forEach(function(a){return a&&a.destroy()});this._set("featureWidgets",d)};r.prototype._isScreenLocationWithinView=function(a,b){return-1<a.x&&-1<a.y&&a.x<=b.width&&a.y<=b.height};r.prototype._isOutsideView=function(a){var b=a.popupHeight,c=a.popupWidth,d=a.screenLocation,e=a.side;a=a.view;if(isNaN(c)||isNaN(b)||!a||!d)return!1;var l=a.padding;return"right"===e&&d.x+c/2>a.width-l.right||"left"===e&&d.x-c/2<l.left||"top"===e&&d.y-b<l.top||"bottom"===e&&d.y+b>a.height-l.bottom?!0:!1};r.prototype._determineCurrentAlignment=
function(){var a=this._pointerOffsetInPx,c=this._containerNode,d=this._mainContainerNode,e=this.viewModel,l=e.screenLocation,e=e.view;if(!l||!e||!c)return"top-center";if(!this._isScreenLocationWithinView(l,e))return this._get("currentAlignment")||"top-center";var h=d?window.getComputedStyle(d,null):null,d=h?parseInt(h.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,h=h?parseInt(h.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0,n=b.getContentBox(c),c=n.w+a,n=Math.max(n.h,d,h)+
a,a=this._isOutsideView({popupHeight:n,popupWidth:c,screenLocation:l,side:"right",view:e}),d=this._isOutsideView({popupHeight:n,popupWidth:c,screenLocation:l,side:"left",view:e}),h=this._isOutsideView({popupHeight:n,popupWidth:c,screenLocation:l,side:"top",view:e}),l=this._isOutsideView({popupHeight:n,popupWidth:c,screenLocation:l,side:"bottom",view:e});return d?h?"bottom-right":"top-right":a?h?"bottom-left":"top-left":h?l?"top-center":"bottom-center":"top-center"};r.prototype._getCurrentAlignment=
function(){var a=this.alignment;return this.dockEnabled?null:"auto"===a?this._determineCurrentAlignment():"function"===typeof a?a.call(this):a};r.prototype._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};r.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};r.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?this._determineCurrentDockPosition():"function"===
typeof a?a.call(this):a};r.prototype._getCurrentDockPosition=function(){return this.dockEnabled?this._getDockPosition():null};r.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};r.prototype._renderFeatureMenuItemNode=function(a,b,d){var l,h=b===d,n=(l={},l["esri-popup__feature-menu-item--selected"]=h,l);l=h?x.tsx("span",{key:w("feature-menu-selected-feature-"+d),title:c.selectedFeature,"aria-label":c.selectedFeature,class:"esri-icon-check-mark"}):null;a=x.tsx("span",
{innerHTML:a.title||e.untitled});return x.tsx("li",{role:"menuitem",tabIndex:-1,key:w("feature-menu-feature-"+d),class:this.classes(n,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":b,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},x.tsx("span",{class:"esri-popup__feature-menu-title"},a,l))};r.prototype._renderFeatureMenuNode=function(a,b,c){var d=this;return 1<a.length?x.tsx("ol",{class:"esri-popup__feature-menu-list",id:c,bind:this,
afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},a.map(function(a,c){return d._renderFeatureMenuItemNode(a,c,b)})):null};r.prototype._determineCurrentDockPosition=function(){var a=this.get("viewModel.view"),b=z.isRTL()?"top-left":"top-right";if(!a)return b;var c=a.padding||{left:0,right:0,top:0,bottom:0},c=a.width-c.left-c.right;return(a=a.get("breakpoints"))&&c<=a.xsmall?"bottom-center":b};r.prototype._renderContent=
function(){var a=this.get("viewModel.content");if("string"===typeof a)return x.tsx("div",{key:a,innerHTML:a});if(x.isWidget(a))return x.tsx("div",{key:a},a.render());if(a instanceof HTMLElement)return x.tsx("div",{key:a,bind:a,afterCreate:this._attachToNode});if(x.isWidgetBase(a))return x.tsx("div",{key:a,bind:a.domNode,afterCreate:this._attachToNode})};r.prototype._attachToNode=function(a){a.appendChild(this)};r.prototype._positionContainer=function(a){void 0===a&&(a=this._containerNode);a&&(this._containerNode=
a);if(a){var c=this.viewModel.screenLocation,d=b.getContentBox(a);if(c=this._calculatePositionStyle(c,d))a.style.top=c.top,a.style.left=c.left,a.style.bottom=c.bottom,a.style.right=c.right}};r.prototype._calculateFullWidth=function(a){var b=this.currentAlignment,c=this._pointerOffsetInPx;return"top-left"===b||"bottom-left"===b||"top-right"===b||"bottom-right"===b?a+c:a};r.prototype._calculateAlignmentPosition=function(a,b,c,d){var e=this.currentAlignment,l=this._pointerOffsetInPx;d/=2;var h=c.height-
b;c=c.width-a;var n=this.view.padding;if("bottom-center"===e)return{top:b+l-n.top,left:a-d-n.left};if("top-left"===e)return{bottom:h+l-n.bottom,right:c+l-n.right};if("bottom-left"===e)return{top:b+l-n.top,right:c+l-n.right};if("top-right"===e)return{bottom:h+l-n.bottom,left:a+l-n.left};if("bottom-right"===e)return{top:b+l-n.top,left:a+l-n.left};if("top-center"===e)return{bottom:h+l-n.bottom,left:a-d-n.left}};r.prototype._calculatePositionStyle=function(a,b){var c=this.view;if(c){if(this.dockEnabled)return{left:"",
top:"",right:"",bottom:""};if(a&&b&&(b=this._calculateFullWidth(b.w),a=this._calculateAlignmentPosition(a.x,a.y,c,b)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}}};r.prototype._viewChange=function(a,b){a&&b&&(this.close(),this.clear())};r.prototype._viewReadyChange=function(a,b){a?(a=this.get("viewModel.view"),this._wireUpView(a)):b&&(this.close(),this.clear())};r.prototype._wireUpView=
function(a){this._destroySpinner();a&&(this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions))};r.prototype._dockingThresholdCrossed=function(a,b,c){var d=a[0];a=a[1];var e=b[0];b=b[1];var l=c.width;c=c.height;return d<=l&&e>l||d>l&&e<=l||a<=c&&b>c||a>c&&b<=c};r.prototype._updateDockEnabledForViewSize=function(a,b){if(a&&b){var c=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},d=c.left+c.right,e=c.top+c.bottom,c=[],l=[];c[0]=a[0]-d;c[1]=a[1]-
e;l[0]=b[0]-d;l[1]=b[1]-e;a=this.dockOptions;this._dockingThresholdCrossed(c,l,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}};r.prototype._focusDockButtonNode=function(a){this._focusDockButton&&(this._focusDockButton=!1,a.focus())};r.prototype._mainContainerNodeUpdated=function(a){this._mainContainerNode=a;this._focusContainer?(this._focusContainer=!1,a.focus()):this._blurContainer&&(this._blurContainer=!1,a.blur())};r.prototype._featureMenuNodeUpdated=function(a){(this._featureMenuNode=
a)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};r.prototype._actionsMenuNodeUpdated=function(a){(this._actionsMenuNode=a)&&this._focusFirstAction&&(this._focusFirstAction=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};r.prototype._focusFeatureMenuButtonNode=function(a){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,a.focus())};r.prototype._focusActionsMenuButtonNode=function(a){this._focusActionsMenuButton&&(this._focusActionsMenuButton=
!1,a.focus())};r.prototype._featureMenuViewportNodeUpdated=function(a){a&&(a.scrollTop=0)};r.prototype._toggleScreenLocationEnabled=function(){var a=this.dockEnabled,b=this.viewModel;b&&(b.screenLocationEnabled=this.visible&&!a)};r.prototype._shouldDockAtCurrentViewSize=function(a){a=a.breakpoint;var b=this.get("viewModel.view.ui"),c=b.width,b=b.height;if(isNaN(c)||isNaN(b))return!1;c=a.hasOwnProperty("width")&&c<=a.width;a=a.hasOwnProperty("height")&&b<=a.height;return c||a};r.prototype._setDockEnabledForViewSize=
function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))};r.prototype._getPageText=function(a,b){return l.substitute({index:b+1,total:a},c.pageText)};r.prototype._destroySpinner=function(){var a=this._spinner,b=this.view;a&&(b&&b.ui.remove(this._spinner,"popup-spinner"),a.destroy(),this._spinner=null)};r.prototype._createSpinner=function(a){a&&(this._spinner=new u({view:a}),a.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};r.prototype._toggleCollapsed=function(){this.collapsed=
!this.collapsed};r.prototype._close=function(){this.close();this.view&&this.view.focus()};r.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};r.prototype._toggleFeatureMenu=function(){var a=!this.featureMenuOpen;this._featureMenuOpenChanged(a);this.actionsMenuOpen=!1;this.featureMenuOpen=a};r.prototype._toggleActionsMenu=function(){var a=!this.actionsMenuOpen;this._actionsMenuOpenChanged(a);this.featureMenuOpen=!1;this.actionsMenuOpen=
a};r.prototype._triggerAction=function(a){a=a.currentTarget["data-action-index"];var b=this.viewModel.allActions.getItemAt(a);b&&"toggle"===b.type&&(b.value=!b.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(a)};r.prototype._selectFeature=function(a){a=a.currentTarget["data-feature-index"];isNaN(a)||(this.viewModel.selectedFeatureIndex=a);this._focusFeatureMenuButton=!0;this.scheduleRender()};r.prototype._next=function(){this.next()};r.prototype._previous=function(){this.previous()};a([q.aliasOf("viewModel.actions"),
x.renderable()],r.prototype,"actions",void 0);a([q.property({dependsOn:["viewModel.visible"]}),x.renderable()],r.prototype,"actionsMenuOpen",null);a([q.property()],r.prototype,"alignment",void 0);a([q.aliasOf("viewModel.autoCloseEnabled")],r.prototype,"autoCloseEnabled",void 0);a([q.aliasOf("viewModel.autoOpenEnabled")],r.prototype,"autoOpenEnabled",void 0);a([q.aliasOf("viewModel.content"),x.renderable()],r.prototype,"content",void 0);a([q.property(),x.renderable()],r.prototype,"collapsed",void 0);
a([q.property(),x.renderable()],r.prototype,"collapseEnabled",void 0);a([q.property({readOnly:!0,dependsOn:["dockEnabled","alignment"]}),x.renderable()],r.prototype,"currentAlignment",null);a([q.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions"]}),x.renderable()],r.prototype,"currentDockPosition",null);a([q.property(),x.renderable()],r.prototype,"dockOptions",null);a([q.property(),x.renderable()],r.prototype,"dockEnabled",void 0);a([q.aliasOf("viewModel.featureCount"),
x.renderable()],r.prototype,"featureCount",void 0);a([q.property({dependsOn:["viewModel.visible"]}),x.renderable()],r.prototype,"featureMenuOpen",null);a([q.aliasOf("viewModel.features"),x.renderable()],r.prototype,"features",void 0);a([q.property(),x.renderable()],r.prototype,"featureNavigationEnabled",void 0);a([q.aliasOf("viewModel.goToOverride")],r.prototype,"goToOverride",void 0);a([q.aliasOf("viewModel.highlightEnabled")],r.prototype,"highlightEnabled",void 0);a([q.aliasOf("viewModel.location"),
x.renderable()],r.prototype,"location",void 0);a([q.property({readOnly:!0}),x.renderable()],r.prototype,"featureWidgets",void 0);a([q.aliasOf("viewModel.promises")],r.prototype,"promises",void 0);a([q.aliasOf("viewModel.selectedFeature"),x.renderable()],r.prototype,"selectedFeature",void 0);a([q.aliasOf("viewModel.selectedFeatureIndex"),x.renderable()],r.prototype,"selectedFeatureIndex",void 0);a([q.property({readOnly:!0}),x.renderable()],r.prototype,"selectedFeatureWidget",void 0);a([q.property()],
r.prototype,"spinnerEnabled",void 0);a([q.aliasOf("viewModel.title"),x.renderable()],r.prototype,"title",void 0);a([q.aliasOf("viewModel.updateLocationEnabled")],r.prototype,"updateLocationEnabled",void 0);a([q.aliasOf("viewModel.view")],r.prototype,"view",void 0);a([q.property({type:y}),x.renderable("viewModel.view.widthBreakpoint viewModel.allActions viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),
x.vmEvent(["triggerAction","trigger-action"])],r.prototype,"viewModel",void 0);a([q.aliasOf("viewModel.visible"),x.renderable()],r.prototype,"visible",void 0);a([q.aliasOf("viewModel.clear")],r.prototype,"clear",null);a([q.aliasOf("viewModel.next")],r.prototype,"next",null);a([q.aliasOf("viewModel.previous")],r.prototype,"previous",null);a([q.aliasOf("viewModel.triggerAction")],r.prototype,"triggerAction",null);a([x.accessibleHandler()],r.prototype,"_toggleCollapsed",null);a([x.accessibleHandler()],
r.prototype,"_close",null);a([x.accessibleHandler()],r.prototype,"_toggleDockEnabled",null);a([x.accessibleHandler()],r.prototype,"_toggleFeatureMenu",null);a([x.accessibleHandler()],r.prototype,"_toggleActionsMenu",null);a([x.accessibleHandler()],r.prototype,"_triggerAction",null);a([x.accessibleHandler()],r.prototype,"_selectFeature",null);a([x.accessibleHandler()],r.prototype,"_next",null);a([x.accessibleHandler()],r.prototype,"_previous",null);return r=a([q.subclass("esri.widgets.Popup")],r)}(q.declared(r))})},
"esri/widgets/Feature":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Feature/nls/Feature dojo/keys ../core/lang ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Feature/FeatureViewModel ./Feature/support/attachmentUtils ./support/uriUtils ./support/widget".split(" "),function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t){function u(a,b){return void 0===b?"esri-feature__"+a:"esri-feature__"+a+"-"+b}return function(l){function r(a){a=
l.call(this)||this;a._chartMap=new Map;a._activeMediaMap=new Map;a._chartRequirePromise=null;a._refreshTimers=new Map;a._mediaInfo=new Map;a.contentEnabled=null;a.graphic=null;a.title=null;a.view=null;a.viewModel=new h;return a}k(r,l);r.prototype.postInitialize=function(){var a=this;this.own(d.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}))};r.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();this._activeMediaMap=null;this._cancelChartModules();
this._destroyCharts()};r.prototype.render=function(){var a=t.tsx("div",{key:u("loading-container"),class:"esri-feature__loading-container"},t.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})),a=this.viewModel.waitingForContent?a:[this._renderContent(),this._renderLastEditInfo()];return t.tsx("div",{class:this.classes("esri-feature","esri-widget")},t.tsx("div",{class:"esri-feature__size-container"},t.tsx("div",{class:"esri-feature__main-container"},
a)))};r.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)};r.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};r.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};r.prototype._cancelChartModules=function(){var a=this._chartRequirePromise;a&&a.cancel();this._chartRequirePromise=null};r.prototype._destroyChart=function(a){var b=this._chartMap.get(a);b&&(b.chart.destroy(),b.tooltip.destroy());this._chartMap.delete(a)};r.prototype._destroyCharts=
function(){this._chartMap.forEach(function(a){a.chart.destroy();a.tooltip.destroy()});this._chartMap.clear()};r.prototype._renderContent=function(){this._destroyCharts();var a=this.viewModel.content;if("string"===typeof a)return t.tsx("div",{key:u("content-string"),innerHTML:a});if(t.isWidget(a))return t.tsx("div",{key:u("content-widget")},a.render());if(a instanceof HTMLElement)return t.tsx("div",{key:u("content-html-element"),bind:a,afterCreate:this._attachToNode});if(t.isWidgetBase(a))return t.tsx("div",
{key:u("content-dijit"),bind:a.domNode,afterCreate:this._attachToNode});if(Array.isArray(a))return a.length?t.tsx("div",{key:u("content-content-elements")},a.map(this._renderContentElement,this)):null};r.prototype._renderContentElement=function(a,b){switch(a.type){case "attachments":return this._renderAttachments(a,b);case "fields":return this._renderFields(a,b);case "media":return this._renderMedia(a,b);case "text":return this._renderText(a,b);default:return null}};r.prototype._renderAttachmentInfo=
function(a){var b,c,d=a.attachmentInfo,e=a.supportsResizeAttachments,l=d.contentType;a=d.name;var h=d.url,m=e&&n.isSupportedImage(l),q=-1===h.indexOf("?")?"?":"\x26",l=m?""+h+q+"w\x3d48":n.getIconPath(l),m=(b={},b["esri-feature__attachment-item-mask--icon"]=!m,b);b=(c={},c["esri-feature__attachments-image--resizable"]=e,c);return t.tsx("li",{class:"esri-feature__attachments-item",key:d},t.tsx("a",{class:"esri-feature__attachments-item-link",href:h,target:"_blank"},t.tsx("div",{class:this.classes(m,
"esri-feature__attachment-item-mask")},t.tsx("img",{alt:"",class:this.classes(b,"esri-feature__attachments-image"),src:l}),t.tsx("span",{class:"esri-feature__attachments-image-overlay"},t.tsx("span",{"aria-hidden":"true",class:"esri-feature__attachments-link-icon esri-icon-link-external"}))),t.tsx("span",{class:"esri-feature__attachments-filename"},a||g.noTitle)))};r.prototype._renderAttachments=function(a,b){var c=this,d,e=a.displayType,l=(b=a.attachmentInfos)&&b.length,h=this.get("graphic.layer.capabilities.operations.supportsResizeAttachments"),
e=(d={},d["esri-feature__attachments--list"]="preview"!==e,d["esri-feature__attachments--preview"]="preview"===e,d);return l?t.tsx("div",{key:u("attachments-element"),class:this.classes("esri-feature__attachments","esri-feature__content-element",e)},t.tsx("div",{class:"esri-feature__attachments-title"},g.attach),t.tsx("ul",{class:"esri-feature__attachments-items"},b.map(function(b,d){return c._renderAttachmentInfo({attachmentInfo:b,attachmentInfoIndex:d,supportsResizeAttachments:h,contentElement:a})}))):
null};r.prototype._forceLTR=function(a){return"\x26lrm;"+a};r.prototype._renderFieldInfo=function(a,b){var c,d=this.viewModel.formattedAttributes,e=d?d.content[b]||d.global:null,l=a.fieldName,d=a.label||l,e=e?null==e[l]?"":e[l]:"";a=!(!a.format||!a.format.dateFormat);e="number"!==typeof e||a?q.autoLink(e):this._forceLTR(e);a=(c={},c["esri-feature__field-data--date"]=a,c);return t.tsx("tr",{key:u("fields-element-info-row",b)},t.tsx("th",{key:u("fields-element-info-row-header",b),class:"esri-feature__field-header",
innerHTML:d}),t.tsx("td",{key:u("fields-element-info-row-data",b),class:this.classes("esri-feature__field-data",a),innerHTML:e}))};r.prototype._renderFields=function(a,b){var c=this;return(a=a.fieldInfos)?t.tsx("div",{key:u("fields-element",b),class:this.classes("esri-feature__fields","esri-feature__content-element")},t.tsx("table",{class:"esri-widget__table",summary:g.fieldsSummary,key:u("fields-element-table",b)},t.tsx("tbody",{key:u("fields-element-table-body",b)},a.map(function(a){return c._renderFieldInfo(a,
b)})))):null};r.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");if(a)return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};r.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};r.prototype._clearMediaRefreshTimer=function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers.delete(a))};r.prototype._getImageSource=function(a,b){var c=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");
var d=a[1],d=void 0===d?"":d;return""+a[0]+c+"timestamp\x3d"+b+(d?"#":"")+d};r.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&(b=b[a])&&"media"===b.type){var c=this._activeMediaMap.get(a);isNaN(c)&&(c=0);(b=b.mediaInfos[c])&&"image"===b.type&&b.refreshInterval&&this._setRefreshTimeout(a,b)}};r.prototype._setupMediaRefreshTimers=function(){var a=this;this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,
c){return a._setupMediaRefreshTimer(c)})};r.prototype._updateMediaInfoTimestamp=function(a,b){var c=Date.now();this._mediaInfo.set(b,{timestamp:c,sourceURL:this._getImageSource(a,c)});this.scheduleRender()};r.prototype._setRefreshTimeout=function(a,b){var c=this,d=b.refreshInterval,e=b.value;d&&(b=6E4*d,this._updateMediaInfoTimestamp(e.sourceURL,a),b=setInterval(function(){c._updateMediaInfoTimestamp(e.sourceURL,a)},b),this._refreshTimers.set(a,b))};r.prototype._renderMediaInfoType=function(a,b){var c=
a.title,c=void 0===c?"":c;if("image"===a.type){var d=a.value,e=a.refreshInterval,l=d.sourceURL,d=d.linkURL;a=this._shouldOpenInNewTab(d)?"_blank":"_self";l=(e=e?this._mediaInfo.get(b):null)?e.sourceURL:l;b=t.tsx("img",{alt:c,key:u("media-image-"+(e?e.timestamp:0),b),src:l});return(c=d?t.tsx("a",{title:c,href:d,target:a},b):null)?c:b}if(-1!==a.type.indexOf("chart"))return t.tsx("div",{key:u("chart",b),bind:this,"data-media-info":a,"data-content-element-index":b,class:"esri-feature__media-chart",afterCreate:this._getChartDependencies,
afterUpdate:this._getChartDependencies})};r.prototype._getChartDependencies=function(a){var b=this,d=a["data-media-info"],e=a["data-content-element-index"],l=d.value,h=l.theme||"Claro",n=d.type,m=h;"string"===typeof h&&(m=h.replace(/\./g,"/"));this._cancelChartModules();this._chartRequirePromise=c.create(function(a){return p(["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip","dojox/charting/themes/"+m],function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];return a(b)})}).then(function(c){b._renderChart(a,
e,n,l,c[0],c[1],c[2]);b._chartRequirePromise=null})};r.prototype._renderChart=function(a,b,c,d,e,l,h){a=new e(a,{margins:{l:4,t:4,r:4,b:4}});h&&a.setTheme(h);switch(c){case "pie-chart":a.addPlot("default",{type:"Pie",labels:!1});a.addSeries("Series A",d.series);break;case "line-chart":a.addPlot("default",{type:"Markers"});a.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});d.series.forEach(function(a,b){a.x=
b+1});a.addSeries("Series A",d.series);break;case "column-chart":a.addPlot("default",{type:"Columns",gap:3});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});a.addSeries("Series A",d.series);break;case "bar-chart":a.addPlot("default",{type:"Bars",gap:3}),a.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),a.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),a.addSeries("Series A",d.series)}c=new l(a);a.render();this._chartMap.set(b,{chart:a,
tooltip:c})};r.prototype._renderMediaInfo=function(a,b){this._destroyChart(b);var c=this._renderMediaInfoType(a,b),d=a.title?t.tsx("div",{key:u("media-title",b),class:"esri-feature__media-item-title",innerHTML:a.title}):null;a=a.caption?t.tsx("div",{key:u("media-caption",b),class:"esri-feature__media-item-caption",innerHTML:a.caption}):null;return t.tsx("div",{key:u("media-container",b),class:"esri-feature__media-item-container"},t.tsx("div",{key:u("media-item-container",b),class:"esri-feature__media-item"},
c),d,a)};r.prototype._renderMediaStatsItem=function(a,b,c){c="chart"===c?this.classes("esri-feature__media-chart-icon","esri-icon-chart"):this.classes("esri-feature__media-image-icon","esri-icon-media");return t.tsx("li",{class:"esri-feature__media-image-summary"},t.tsx("span",{"aria-hidden":"true",class:c}),t.tsx("span",{class:"esri-feature__media-count","aria-label":a},"("+b+")"))};r.prototype._renderMediaPageButton=function(a,b){var c=(a="previous"===a)?g.previous:g.next,d=a?this.classes("esri-feature__button",
"esri-feature__media-previous"):this.classes("esri-feature__button","esri-feature__media-next"),e=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),l=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon--rtl","esri-icon-left-triangle-arrow"),
h=a?this._previousClick:this._nextClick;return t.tsx("div",{key:u(a?"previous":"next",b),title:c,tabIndex:0,role:"button",class:d,"data-content-element-index":b,bind:this,onkeydown:h,onclick:h},t.tsx("span",{"aria-hidden":"true",class:e}),t.tsx("span",{"aria-hidden":"true",class:l}),t.tsx("span",{class:"esri-icon-font-fallback-text"},c))};r.prototype._handleMediaKeyup=function(a){var c=a.currentTarget["data-content-element-index"],d=a.keyCode;d===b.LEFT_ARROW&&(a.stopPropagation(),this.previousMedia(c));
d===b.RIGHT_ARROW&&(a.stopPropagation(),this.nextMedia(c))};r.prototype._renderMedia=function(a,b){var c;a=a.mediaInfos;var d=this._getMediaStats(a),e=d.total,l=(c={},c["esri-feature--media-pagination-visible"]=1<d.total,c);c=this._renderMediaStatsItem(g.numImages,d.images,"image");var d=this._renderMediaStatsItem(g.numCharts,d.charts,"chart"),h=this._renderMediaPageButton("previous",b),n=this._renderMediaPageButton("next",b),m=this._activeMediaMap.get(b);isNaN(m)&&(this._activeMediaMap.set(b,0),
m=0);return e?t.tsx("div",{key:u("media-element",b),"data-content-element-index":b,bind:this,onkeyup:this._handleMediaKeyup,class:this.classes("esri-feature__media","esri-feature__content-element",l)},t.tsx("ul",{class:"esri-feature__media-summary"},c,d),t.tsx("div",{key:u("media-element-container",b),class:"esri-feature__media-container"},h,this._renderMediaInfo(a[m],b),n)):null};r.prototype._renderLastEditInfo=function(){var a=this.viewModel.lastEditInfo;if(!a)return null;var b=a.user,a=e.substitute({date:a.date,
user:b},"edit"===a.type?b?g.lastEditedByUser:g.lastEdited:b?g.lastCreatedByUser:g.lastCreated);return t.tsx("div",{key:u("edit-info-element"),class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},a)};r.prototype._renderText=function(a,b){return a.text?t.tsx("div",{key:u("text-element",b),innerHTML:a.text,class:this.classes("esri-feature__text","esri-feature__content-element")}):null};r.prototype._attachToNode=function(a){a.appendChild(this)};r.prototype._getMediaStats=
function(a){var b=0,c=0;a.forEach(function(a){a=a.type;"image"===a?b++:-1!==a.indexOf("chart")&&c++});return{total:c+b,images:b,charts:c}};r.prototype._setContentElementMedia=function(a,b){this._clearMediaRefreshTimer(a);var c=this.viewModel.content;(c=(c=c&&c[a])&&c.mediaInfos)&&c.length&&(this._activeMediaMap.set(a,(b+c.length)%c.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};r.prototype._pageContentElementMedia=function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+
b;this._setContentElementMedia(a,b)};r.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};r.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};a([m.aliasOf("viewModel.contentEnabled")],r.prototype,"contentEnabled",void 0);a([m.aliasOf("viewModel.graphic")],r.prototype,"graphic",void 0);a([m.aliasOf("viewModel.title")],r.prototype,"title",void 0);a([m.aliasOf("viewModel.view")],r.prototype,"view",void 0);
a([m.property({type:h}),t.renderable(["viewModel.waitingForContent","viewModel.content","viewModel.lastEditInfo"])],r.prototype,"viewModel",void 0);a([t.accessibleHandler()],r.prototype,"_previousClick",null);a([t.accessibleHandler()],r.prototype,"_nextClick",null);return r=a([m.subclass("esri.widgets.Feature")],r)}(m.declared(l))})},"esri/widgets/Feature/FeatureViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper dojo/i18n!dojo/cldr/nls/number ../../Graphic ../../core/date ../../core/Error ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/throttle ../../core/watchUtils ../../core/accessorSupport/decorators ../../support/arcadeUtils ../../support/ContentElement/Text ../../support/ContentElement/Media/Chart/Series ../../support/FieldInfo/Format ../../tasks/support/AttachmentQuery ./support/featureUtils ./support/RelatedFeatures ../support/widget".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D){function E(a,b){return a&&"feature"===a.type?a.getField(b):null}function G(a){return a.replace(/[\u00A0-\u99999<>\&]/gim,function(a){return"\x26#"+a.charCodeAt(0)+";"})}var H=h.getLogger("esri.widgets.FeatureViewModel"),I=/^\s*expression\//i,N=new RegExp(""+b.group,"g"),S=new d("cancelled-query","cancelled feature query"),M=c.getFormat("short-date-short-time"),P="DateFormat"+M;return function(d){function h(a){var b=d.call(this)||this;b._handles=
new m;b._featurePromise=void 0;b._layerDateFields=null;b._expressionAttributes=null;b._graphicChangedThrottled=q.throttle(b._graphicChanged,1,b);b._effectivePopupTemplate=null;b.content=null;b.contentEnabled=!0;b.formattedAttributes=null;b.graphic=null;b.lastEditInfo=null;b.title="";b.view=null;b._handles.add(t.watch(b,"graphic graphic.sourceLayer.popupTemplate.title graphic.sourceLayer.popupTemplate.content graphic.sourceLayer.popupTemplate.fieldInfos graphic.sourceLayer.popupTemplate.lastEditInfoEnabled graphic.popupTemplate.title graphic.popupTemplate.content graphic.popupTemplate.fieldInfos graphic.popupTemplate.lastEditInfoEnabled contentEnabled".split(" "),
function(){return b._graphicChangedThrottled()}));return b}k(h,d);h.prototype.destroy=function(){this._clear();this._cancelFeatureQuery();this._handles.destroy();this._expressionAttributes=this._layerDateFields=this.graphic=this.view=this._handles=null};Object.defineProperty(h.prototype,"waitingForContent",{get:function(){return!!this._featurePromise},enumerable:!0,configurable:!0});h.prototype._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};
h.prototype._graphicChanged=function(){var a=this;this._cancelFeatureQuery();this._clear();var b=this.graphic;if(b){this._layerDateFields=(b=B.getSourceLayer(b))?this._getDateFields(b):[];var c=!1,b=this._queryFeature().catch(function(a){a!==S&&H.error("error","error loading template",a)}).then(function(){c=!0;a._featurePromise=null;a.notifyChange("waitingForContent")});c||(this._featurePromise=b,this.notifyChange("waitingForContent"))}};h.prototype._cancelFeatureQuery=function(){var a=this._featurePromise;
a&&"function"===typeof a.cancel&&a.cancel(S);this._featurePromise=null;this.notifyChange("waitingForContent")};h.prototype._compileContent=function(a,b){var c=this;if(a&&(a.nodeName||a&&D.isWidgetBase(a)||D.isWidget(a)))return a;if("string"===typeof a)return this._compileText(new y({text:a})).text;if(Array.isArray(a))return a.map(function(a,d){d=(d=b&&b[d])&&d.value;if("attachments"===a.type)return c._compileAttachments(a,d);if("fields"===a.type)return c._compileFields(a);if("media"===a.type)return c._compileMedia(a);
if("text"===a.type)return c._compileText(a)});a&&H.warn("invalid content type.")};h.prototype._compileFields=function(a){var b=this,c=this._effectivePopupTemplate;a=l.clone(a);var d=c&&c.expressionInfos,c=a.fieldInfos?void 0:c&&c.fieldInfos,c=a.fieldInfos||l.clone(c),e=[];c&&c.forEach(function(a){var c=a.fieldName.toLowerCase();if(!a.hasOwnProperty("visible")||a.visible)c=b._isExpressionField(c)?b._getExpressionInfo(d,c):null,a.label=c?c.title:a.label,e.push(a)});a.fieldInfos=e;return a};h.prototype._setImageValue=
function(a){var b=a.value,c=a.formattedAttributes;a=a.layer;var d=b.linkURL,e=b.sourceURL;e&&(e=this._fixTokens(e,a),b.sourceURL=this._substituteAttributes(c,e));d&&(a=this._fixTokens(d,a),b.linkURL=this._substituteAttributes(c,a))};h.prototype._compileMedia=function(a){var b=this,c=this._expressionAttributes,d=this._layerDateFields,e=this.graphic;a=l.clone(a);var h=a.mediaInfos,n=g({},e.attributes,c),m=B.getSourceLayer(e),q=this.formattedAttributes.global,r={dateFormat:{properties:d,formatter:P}};
a.mediaInfos=h&&h.map(function(a){if(a=l.clone(a)){var c=a.title?b._processFieldsInLinks(a.title,n):"",d=a.caption?b._processFieldsInLinks(a.caption,n):"";a.title=c?b._substituteAttributes(q,c,r):"";a.caption=d?b._substituteAttributes(q,d,r):"";if("image"===a.type)return c=a.value,b._setImageValue({value:c,formattedAttributes:q,layer:m}),a.value.sourceURL?a:void 0;if("pie-chart"===a.type||"line-chart"===a.type||"column-chart"===a.type||"bar-chart"===a.type)return c=a.value,b._setChartValue({value:c,
attributes:n,formattedAttributes:q,layer:m}),a}}).filter(Boolean);return a};h.prototype._substituteAttributes=function(a,b,c){return(""+this._removeEmptyHref(l.substitute(a,b,c))).trim()};h.prototype._compileText=function(a){var b=this._expressionAttributes,c=this._layerDateFields,d=this.graphic;(a=l.clone(a))&&a.text&&(d=g({},d.attributes,b),b=this.formattedAttributes.global,c={dateFormat:{properties:c,formatter:P}},d=this._processFieldsInLinks(a.text,d),a.text=this._substituteAttributes(b,d,c));
return a};h.prototype._formatEditInfo=function(a,b){var c=a.creatorField,d=a.creationDateField,e=a.editorField;if(b){a=b[a.editDateField];if("number"===typeof a)return b=b[e],c=l.substitute({myKey:a},"{myKey:"+P+"}"),{type:"edit",date:c,user:b};d=b[d];if("number"===typeof d)return b=b[c],c=l.substitute({myKey:d},"{myKey:"+P+"}"),{type:"create",date:c,user:b}}};h.prototype._compileLastEditInfo=function(){var a=this._effectivePopupTemplate,b=this.graphic;if(a){var a=a.lastEditInfoEnabled,c=b.get("sourceLayer.editFieldsInfo");
if(a&&c)return this._formatEditInfo(c,b.attributes)}};h.prototype._compileTitle=function(){var a=this._effectivePopupTemplate,b=this._layerDateFields,c=this.graphic,a=a&&a.title,d=g({},c.attributes,this._expressionAttributes),b={dateFormat:{properties:b,formatter:P}},e=this.formattedAttributes.global;return"function"===typeof a?a.call(null,{graphic:c}):"string"===typeof a&&a?(c=this._processFieldsInLinks(a,d),this._substituteAttributes(e,c,b)):""};h.prototype._getExpressionInfo=function(a,b){if(this._isExpressionField(b)){var c=
b.replace(I,"").toLowerCase(),d;a.some(function(a){if(a.name.toLowerCase()===c)return d=a,!0});return d}};h.prototype._fixTokens=function(a,b){return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,c,d){return(a=E(b,d))?"{"+a.name+"}":c})};h.prototype._encodeAttributes=function(a){var b=a?l.clone(a):{};Object.keys(b).forEach(function(a){var c=b[a];"string"===typeof c&&(c=encodeURIComponent(c).replace(/\'/g,"\x26apos;"),b[a]=c)});return b};h.prototype._formatAttributesToFieldInfos=function(a,b,c){var d=
this,e=l.clone(this._layerDateFields);a.forEach(function(h){var l=d._getFixedFieldName(h.fieldName,b);h.fieldName=l;c[l]=d._formatValue(c[l],{fieldInfos:a,fieldName:l,layer:b});e&&h.format&&h.format.dateFormat&&(h=e.indexOf(l),-1<h&&e.splice(h,1))})};h.prototype._getArcadeViewingMode=function(a){return a&&"local"===a.viewingMode?"localScene":"globalScene"};h.prototype._getViewInfo=function(){var a=this.view;if(a){var b="3d"===a.type?this._getArcadeViewingMode(a):"map";return r.getViewInfo({viewingMode:b,
scale:a.scale,spatialReference:a.spatialReference})}};h.prototype._formatAttributes=function(a){var b=this,c=this._expressionAttributes,d=this.graphic,e=d.attributes,d=B.getSourceLayer(d),e=e?l.clone(e):{},h=g({},e,c);this.addRelatedFeatureAttributes(h);a&&this._formatAttributesToFieldInfos(a,d,h);Object.keys(h).forEach(function(a){var c=h[a];null!=c&&(h[a]=b._getDomainName(a,c)||b._getTypeName(a)||r.applyTextFormattingHTML(c))});return h};h.prototype._formatValue=function(a,d){var e={dateFormat:{properties:this._layerDateFields,
formatter:P}},h=d.fieldName,n=this._getFieldInfo(d.fieldInfos,h),m=l.clone(n),n=d.preventPlacesFormatting;(d=E(d.layer,h))&&"date"===d.type&&(d=m.format||new z,d.dateFormat=d.dateFormat||"short-date-short-time",m.format=d);h=m&&m.format;if(null==a||!m||null==h)return a;var q=[];d=(m=!h.dateFormat&&(h.hasOwnProperty("places")||h.hasOwnProperty("digitSeparator")))&&h.hasOwnProperty("digitSeparator")?h.digitSeparator:!0;n=m&&null!=h.places&&(!n||0<h.places);m&&n&&q.push("places: "+Number(h.places));
n=m?n?"NumberFormat("+q.join(",")+")":"NumberFormat":h.dateFormat?"DateFormat"+(c.getFormat(h.dateFormat)||M):void 0;if(!n)return a;a=l.substitute({myKey:a},"{myKey:"+n+"}",e)||"";return m&&!d&&b.group?a.replace(N,""):a};h.prototype._getDomainName=function(a,b){if(this.isRelatedField(a))return null;var c=this.graphic,d=B.getSourceLayer(c);return d&&"feature"===d.type?(a=d.getFieldDomain(a,{feature:c}))&&"coded-value"===a.type?a.getName(b):null:null};h.prototype._getFieldInfo=function(a,b){if(a&&a.length&&
b){var c=b.toLowerCase(),d=void 0;a.some(function(a){if(a.fieldName&&a.fieldName.toLowerCase()===c)return d=a,!0});return d}};h.prototype._getTypeName=function(a){if(this.isRelatedField(a))return null;var b=this.graphic,c=B.getSourceLayer(b);return c&&"feature"===c.type&&a===c.typeIdField?(a=c.getFeatureType(b))?a.name:null:null};h.prototype._removeEmptyHref=function(a){return a.replace(/href=(""|'')/gi,"")};h.prototype._processFieldsInLinks=function(a,b){var c=this.get("graphic.layer");a=this._fixTokens(a,
c);var d=this._encodeAttributes(b),c=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi;return a?a.replace(c,function(a,c,e){c=(""+(c||e)).trim();return l.substitute(c&&"{"===c[0]?b:d,a)}):a};h.prototype._compileAttachments=function(a,b){a=l.clone(a);if(!b||b&&0===b.length)return a;a.attachmentInfos=b;return a};h.prototype._queryAttachments=function(){var a=this.graphic,b=B.getSourceLayer(a);if(!b)return n.resolve([]);if((b="scene"===b.type&&b.associatedLayer?b.associatedLayer:b)&&"feature"===b.type){var c=
b.objectIdField,d=(a=a.attributes)&&a[c],a=new w({objectIds:[d]});return b.queryAttachments(a).then(function(a){return a[d]||[]})}return n.resolve([])};h.prototype._queryContentElements=function(a){var b=this;if(!Array.isArray(a))return n.resolve();var c={};a.forEach(function(a,d){"attachments"===a.type&&(a=b._queryAttachments())&&(c[d]=a)});return Object.keys(c).length?n.eachAlways(c):n.resolve()};h.prototype._getContent=function(){var a=this._effectivePopupTemplate,b=this.graphic;if(!this.contentEnabled||
!b)return n.resolve();a=a&&a.content;b="function"===typeof a?a.call(null,{graphic:b}):a;return n.isThenable(b)?b:n.resolve(b)};h.prototype._enableGeometryOperations=function(){var a=this._effectivePopupTemplate;return a&&r.hasGeometryOperations(a)?r.enableGeometryOperations():n.resolve(!1)};h.prototype._queryFeature=function(){var a=this,b=this.graphic;this._effectivePopupTemplate=b&&b.getEffectivePopupTemplate();return this._enableGeometryOperations().then(function(){return a._getContent().then(function(b){return a._checkForRelatedFeatures(b).then(function(){a._expressionAttributes=
a._createFormattedExpressions();a._set("formattedAttributes",a._createFormattedAttributes(b));a._set("title",a._compileTitle());return a._queryContentElements(b).then(function(c){var d=a._compileLastEditInfo();a._set("lastEditInfo",d||null);c=a._compileContent(b,c);a._set("content",c||null);return c})})})})};h.prototype._isExpressionField=function(a){return I.test(a)};h.prototype._createCompiledExpressionDictionary=function(a){var b=new Map;if(!a)return b;a.forEach(function(a){return b.set(a.name,
r.createFunction(a.expression))});return b};h.prototype._getDateFields=function(a){return(a=a.fields)?a.filter(function(a){return"date"===a.type}).map(function(a){return a.name}):[]};h.prototype._formatArcadeArray=function(a){return'\x3cul class\x3d"esri-widget__list"\x3e'+a.map(function(a){return"\x3cli\x3e"+("string"===typeof a?G(a):a)+"\x3c/li\x3e"}).join("")+"\x3c/ul\x3e"};h.prototype._formatArcadeDictionary=function(a){return'\x3ctable class\x3d"esri-widget__table"\x3e'+a.keys().map(function(b){var c=
a.field(b),c="string"===typeof c?G(c):c;return"\x3ctr\x3e\x3cth\x3e"+b+"\x3c/th\x3e\x3ctd\x3e"+c+"\x3c/td\x3e\x3c/tr\x3e"}).join("")+"\x3c/table\x3e"};h.prototype._createFormattedExpressions=function(){var a=this,b=this._effectivePopupTemplate,c=this.graphic,b=b&&b.expressionInfos,d=this._createCompiledExpressionDictionary(b),e={};b&&b.forEach(function(b){var h="expression/"+b.name;b=d.get(b.name);var l=a._getViewInfo();b=r.executeFunction(b,r.createExecContext(c,l));e[h]="string"===typeof b?G(b):
Array.isArray(b)?a._formatArcadeArray(b):b&&"esri.arcade.Dictionary"===b.declaredClass?a._formatArcadeDictionary(b):b});return e};h.prototype._createFormattedAttributes=function(a){var b=this,c=this._effectivePopupTemplate,d={global:this._formatAttributes(c&&c.fieldInfos),content:[]};Array.isArray(a)&&a.forEach(function(a,c){"fields"===a.type&&a.fieldInfos&&(d.content[c]=b._formatAttributes(a.fieldInfos))});return d};h.prototype._getAllFieldInfos=function(a){var b=this._effectivePopupTemplate,c=[];
(b=b&&b.fieldInfos)&&c.push.apply(c,b);if(!a||!Array.isArray(a))return c;a.forEach(function(a){"fields"===a.type&&c.push.apply(c,a&&a.fieldInfos)});return c};h.prototype._checkForRelatedFeatures=function(a){var b=this.graphic;a=this._getAllFieldInfos(a);return this.queryRelatedInfos(b,a)};h.prototype._getChartOption=function(a){var c=a.value,d=a.attributes,e=a.formattedAttributes,h=a.fieldName,l=a.relatedFieldName,n=a.fieldInfos,m=a.index;a=B.getSourceLayer(this.graphic);var q=c.normalizeField,c=
c.tooltipField,q=q?this.isRelatedField(q)?d[this.getRelatedFieldInfo(q).fieldName]:d[q]:null,g=l&&void 0!==d[l]?d[l]:void 0!==d[h]?d[h]:e[h],g="string"===typeof g&&b.group?parseFloat(g.replace(N,"")):g,g=void 0===g?null:g&&q?g/q:g,m=new x({x:m,y:g});if(this.isRelatedField(h))return e=this.getRelatedFieldInfo(h),h=(h=this.getRelatedFieldInfo(c))?h.fieldName:null,n=this._formatValue(g,{fieldInfos:n,fieldName:l,layer:a,preventPlacesFormatting:!!q}),l=e?e.label||e.fieldName:l,m.tooltip=(h&&void 0!==d[h]?
d[h]:l)+": "+n,m;d=this._getFieldInfo(n,h);l=this._getFixedFieldName(h,a);d=d?d.label||d.fieldName:h;m.tooltip=(c&&void 0!==e[c]?e[c]:d)+": "+e[l];return m};h.prototype._getFixedFieldName=function(a,b){return(b=E(b,a))?b.name:a};h.prototype._getFixedFieldNames=function(a,b){var c=this;return a&&a.map(function(a){return c._getFixedFieldName(a,b)})};h.prototype._setChartValue=function(a){var b=this,c=a.value,d=a.attributes,e=a.formattedAttributes;a=a.layer;var h=this._effectivePopupTemplate,l=this.relatedInfoCount,
n=c.fields,m=c.normalizeField;c.fields=this._getFixedFieldNames(n,a);m&&(c.normalizeField=this._getFixedFieldName(m,a));if(n.some(function(a){return!!(null!=e[a]||b.isRelatedField(a)&&l)})){var q=h&&h.fieldInfos;n.forEach(function(a,h){b.isRelatedField(a)?c.series=c.series.concat(b._getRelatedChartInfos({fieldInfos:q,fieldName:a,formattedAttributes:e,value:c})):(a=b._getChartOption({value:c,index:h,attributes:d,formattedAttributes:e,fieldName:a,fieldInfos:q}),c.series.push(a))})}};h.prototype._getRelatedChartInfos=
function(a){var b=this,c=a.fieldInfos,d=a.fieldName,e=a.formattedAttributes,h=a.value,l=[];a=this.getRelatedFieldInfo(d);var n=a.fieldName,m=this.getRelatedInfo(a.layerId);if(!m)return l;a=m.relatedFeatures;m=m.relation;if(!m||!a)return l;m=m.cardinality;a.forEach(function(a,m){var q=a.attributes;q&&Object.keys(q).forEach(function(a){a===n&&l.push(b._getChartOption({value:h,index:m,attributes:q,formattedAttributes:e,fieldName:d,relatedFieldName:a,fieldInfos:c}))})});return"one-to-many"===m||"many-to-many"===
m?l:[l[0]]};a([u.property({readOnly:!0})],h.prototype,"content",void 0);a([u.property()],h.prototype,"contentEnabled",void 0);a([u.property({readOnly:!0})],h.prototype,"formattedAttributes",void 0);a([u.property({type:e})],h.prototype,"graphic",void 0);a([u.property({readOnly:!0})],h.prototype,"lastEditInfo",void 0);a([u.property({readOnly:!0})],h.prototype,"title",void 0);a([u.property()],h.prototype,"view",void 0);a([u.property({readOnly:!0})],h.prototype,"waitingForContent",null);return h=a([u.subclass("esri.widgets.FeatureViewModel")],
h)}(u.declared(C))})},"esri/core/throttle":function(){define(["require","exports"],function(p,f){function k(a,g,b,e){var c=null,d=1E3;"number"===typeof g?(d=g,e=b):(c=g,d=b);var m=0,l,h=function(){m=0;a.apply(e,l)};g=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c&&c.apply(e,a);l=a;d?m||(m=setTimeout(h,d)):h()};g.remove=function(){m&&(clearTimeout(m),m=0)};g.forceUpdate=function(){m&&(clearTimeout(m),h())};g.hasPendingUpdates=function(){return!!m};return g}Object.defineProperty(f,
"__esModule",{value:!0});f.throttle=k;f.default=k})},"esri/widgets/Feature/support/featureUtils":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.getSourceLayer=function(k){if(k)return k.get("sourceLayer")||k.get("layer")}})},"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q){var t=new Map,u=c.getLogger("esri.widgets.Popup.support.RelatedFeatures");return function(b){function c(a){a=b.call(this)||this;a.relatedInfoCount=null;a.relatedInfos=new Map;return a}k(c,b);c.prototype.destroy=function(){this.relatedInfos.clear()};c.prototype.addRelatedFeatureAttributes=function(a){var b=this;this.relatedInfos.forEach(function(c){return b._addRelatedFeatureAttribute(a,c)})};c.prototype.getRelatedFieldInfo=function(a){if(-1===a.indexOf("relationships/"))return null;
a=a.split("/").slice(1);return{layerId:a[0],fieldName:a[1]}};c.prototype.getRelatedInfo=function(a){return this.relatedInfos.get(a.toString())};c.prototype.isRelatedField=function(a){void 0===a&&(a="");return a?-1!==a.indexOf("relationships/"):!1};c.prototype.queryRelatedInfos=function(a,b){var c=this;this.relatedInfos.clear();var e=q.getSourceLayer(a);if(!e)return d.resolve();var h=b.filter(function(a){return a&&c.isRelatedField(a.fieldName)});if(!h||!h.length)return d.resolve();this._createRelatedInfos(b,
e);return this._queryLayerInfos(e).then(function(b){c._updateRelatedInfoLayerInfos(b);return c._queryRelatedFeatureMap(a).then(function(a){Object.keys(a).forEach(function(b){c._setRelatedFeatures(a[b],b.toString())});return a})})};c.prototype._addRelatedFeatureAttribute=function(a,b){var c=this;a&&b&&(b.relatedFeatures&&b.relatedFeatures&&b.relatedFeatures.forEach(function(d){return c._addAttributesFromFeature(a,d,b)}),b.relatedStatsFeatures&&b.relatedStatsFeatures&&b.relatedStatsFeatures.forEach(function(d){return c._addAttributesFromFeature(a,
d,b)}))};c.prototype._updateRelatedInfoLayerInfo=function(a,b){if(a=a.value)this.getRelatedInfo(b).layerInfo=a.data};c.prototype._updateRelatedInfoLayerInfos=function(a){var b=this;Object.keys(a).forEach(function(c){return b._updateRelatedInfoLayerInfo(a[c],c.toString())})};c.prototype._addAttributesFromFeature=function(a,b,c){var d=this;a&&b&&c&&Object.keys(b.attributes).forEach(function(e){var h=d._relatedFieldInfoToString({layerId:c.relation.id.toString(),fieldName:e});a[h]=b.attributes[e]})};
c.prototype._relatedFieldInfoToString=function(a){return a?"relationships/"+a.layerId+"/"+a.fieldName:""};c.prototype._createRelatedInfoForFieldInfo=function(a,b){var c=this.getRelatedFieldInfo(a.fieldName);if(c){var d=c.layerId,c=c.fieldName;d&&(b=this.getRelatedInfo(d)||this._createRelatedInfo(d,b))&&(b.relatedFields.push(c),a.statisticType&&(a=new n({statisticType:a.statisticType,onStatisticField:c,outStatisticFieldName:c}),b.outStatistics.push(a)))}};c.prototype._createRelatedInfos=function(a,
b){var c=this;a.forEach(function(a){return c._createRelatedInfoForFieldInfo(a,b)})};c.prototype._queryRelatedFeatureMap=function(a){var b=this,c={};this.relatedInfos.forEach(function(d,e){d.layerInfo&&(c[e]=b._queryRelatedLayerFeatures(a,d))});return d.eachAlways(c)};c.prototype._queryLayerInfos=function(a){var b=this,c={};this.relatedInfos.forEach(function(h,l){h=h.relation;if(!h)return l=new e("relation-required","A relation is required on a layer to retrieve related records."),u.error(l),d.reject(l);
h=h.relatedTableId;if(!h)return l=new e("A related table ID is required on a layer to retrieve related records."),u.error(l),d.reject(l);h=a.url+"/"+h;var n=t.get(h),m=n?n:b._queryLayerInfo(h);n||t.set(h,m);c[l]=m});return d.eachAlways(c)};c.prototype._queryLayerInfo=function(a){return g(a,{query:{f:"json"}})};c.prototype._queryRelatedLayerFeatures=function(a,b){var c=q.getSourceLayer(a).layerId.toString(),e=b.layerInfo,l=b.queryTask,n=b.relation;if(c=this._getDestinationRelation(e,c)){var n=n.keyField,
m=c.keyField,c="string"===this._getDestinationFieldType(e,c)?m+"\x3d'"+a.attributes[n]+"'":m+"\x3d"+a.attributes[n];a=l.execute(new h({where:c,outFields:b.relatedFields}));b=b.outStatistics&&0<b.outStatistics.length&&e.supportsStatistics?l.execute(new h({where:c,outFields:b.relatedFields,outStatistics:b.outStatistics})):null;return d.eachAlways({features:a,statsFeatures:b?b:d.resolve()})}return d.resolve()};c.prototype._setRelatedFeatures=function(a,b){if(b=this.getRelatedInfo(b)){var c=a.value;c&&
(a=c.features,c=c.statsFeatures,a=a&&a.value,b.relatedFeatures=a?a.features:[],a=c&&c.value,b.relatedStatsFeatures=a?a.features:[])}};c.prototype._getRelation=function(a,b){if("feature"!==b.type)return null;var c=null;b.relationships.some(function(b){if(b.id===parseInt(a,10))return c=b,!0});return c};c.prototype._createRelatedInfo=function(a,b){var c=this._getRelation(a,b);if(c){b=b.url+"/"+c.relatedTableId;var d=new l({url:b}),c={url:b,queryTask:d,relation:c,relatedFields:[],outStatistics:[]};this.relatedInfos.set(a,
c);return c}};c.prototype._getDestinationRelation=function(a,b){var c;a&&a.relationships&&a.relationships.some(function(a){if(""+a.relatedTableId===b)return c=a,!0});return c};c.prototype._getDestinationFieldType=function(a,b){var c=void 0;a.fields.some(function(a){if(a.name===b.keyField)return c=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a.type)?"number":"string",!0});return c};a([m.aliasOf("relatedInfos.size")],c.prototype,"relatedInfoCount",
void 0);a([m.property()],c.prototype,"relatedInfos",void 0);return c=a([m.subclass("esri.widgets.Popup.support.RelatedFeatures")],c)}(m.declared(b))})},"esri/widgets/Feature/support/attachmentUtils":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});var k=p.toUrl("../../../themes/base/images/files/");f.isSupportedImage=function(a){a=a.toLowerCase();return"image/bmp"===a||"image/emf"===a||"image/exif"===a||"image/gif"===a||"image/x-icon"===a||"image/jpeg"===
a||"image/png"===a||"image/tiff"===a||"image/x-wmf"===a};f.getIconPath=function(a){return a?"text/plain"===a?k+"text-32.svg":"application/pdf"===a?k+"pdf-32.svg":"text/csv"===a?k+"csv-32.svg":"application/gpx+xml"===a?k+"gpx-32.svg":"application/x-dwf"===a?k+"cad-32.svg":"application/postscript"===a||"application/json"===a||"text/xml"===a||"model/vrml"===a?k+"code-32.svg":"application/x-zip-compressed"===a||"application/x-7z-compressed"===a||"application/x-gzip"===a||"application/x-tar"===a||"application/x-gtar"===
a||"application/x-bzip2"===a||"application/gzip"===a||"application/x-compress"===a||"application/x-apple-diskimage"===a||"application/x-rar-compressed"===a||"application/zip"===a?k+"zip-32.svg":-1!==a.indexOf("image/")?k+"image-32.svg":-1!==a.indexOf("audio/")?k+"sound-32.svg":-1!==a.indexOf("video/")?k+"video-32.svg":-1!==a.indexOf("msexcel")||-1!==a.indexOf("ms-excel")||-1!==a.indexOf("spreadsheetml")?k+"excel-32.svg":-1!==a.indexOf("msword")||-1!==a.indexOf("ms-word")||-1!==a.indexOf("wordprocessingml")?
k+"word-32.svg":-1!==a.indexOf("powerpoint")||-1!==a.indexOf("presentationml")?k+"report-32.svg":k+"generic-32.svg":k+"generic-32.svg"}})},"esri/widgets/support/uriUtils":function(){define(["require","exports","dojo/i18n!./nls/uriUtils","../../core/lang"],function(p,f,k,a){function g(a){var c=null;b.some(function(b){b.pattern.test(a)&&(c=b);return!!c});return c}Object.defineProperty(f,"__esModule",{value:!0});var b=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:k.view},
{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Explorer"},{id:"arcgis-navigator",
pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:k.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:k.openInApp,
appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:k.openInApp,appName:"Microsoft Power Bi"}];f.autoLink=function(b){if("string"!==typeof b||!b)return b;var c=g(b);if(!c)return b;var d=b.match(c.pattern),d=a.substitute({appName:c.appName,hierPart:d&&d[2]},c.label);return b.replace(c.pattern,
"\x3ca "+(c.target?'target\x3d"'+c.target+'"':"")+'" href\x3d"$1"\x3e'+d+"\x3c/a\x3e")}})},"esri/widgets/Spinner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./support/AnchorElementViewModel ./support/widget".split(" "),function(p,f,k,a,g,b,e,c,d,m){return function(c){function h(a){a=c.call(this)||this;a._animationDelay=500;a._animationPromise=null;a.location=
null;a.view=null;a.visible=!1;a.viewModel=new d;return a}k(h,c);h.prototype.postInitialize=function(){var a=this;this.own([b.watch(this,"visible",function(b){return a._visibleChange(b)})])};h.prototype.destroy=function(){this._cancelAnimationPromise()};h.prototype.show=function(a){var b=this,c=a.location;a=a.promise;c&&(this.viewModel.location=c);this.visible=!0;c=function(){return b.hide()};a&&a.catch(function(){}).then(c)};h.prototype.hide=function(){this.visible=!1};h.prototype.render=function(){var a,
b=this.visible,c=!!this.viewModel.screenLocation,b=(a={},a["esri-spinner--start"]=b&&c,a["esri-spinner--finish"]=!b&&c,a);a=this._getPositionStyles();return m.tsx("div",{class:this.classes("esri-spinner",b),styles:a})};h.prototype._cancelAnimationPromise=function(){var a=this._animationPromise;a&&a.cancel();this._animationPromise=null};h.prototype._visibleChange=function(a){var b=this;a?this.viewModel.screenLocationEnabled=!0:(this._cancelAnimationPromise(),this._animationPromise=g.after(this._animationDelay).then(function(){b.viewModel.screenLocationEnabled=
!1;b._animationPromise=null}))};h.prototype._getPositionStyles=function(){var a=this.viewModel,b=a.screenLocation,a=a.view;if(!a||!b)return{};a=a.padding;return{left:b.x-a.left+"px",top:b.y-a.top+"px"}};a([e.aliasOf("viewModel.location")],h.prototype,"location",void 0);a([e.aliasOf("viewModel.view")],h.prototype,"view",void 0);a([e.property(),m.renderable()],h.prototype,"visible",void 0);a([e.property({type:d}),m.renderable(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],h.prototype,
"viewModel",void 0);return h=a([e.subclass("esri.widgets.Spinner")],h)}(e.declared(c))})},"esri/widgets/support/AnchorElementViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(p,f,k,a,g,b,e,c,d,m){return function(b){function h(a){var c=b.call(this)||this;c._anchorHandles=
new e;c.location=null;c.screenLocation=null;c.screenLocationEnabled=!1;c.view=null;c._anchorHandles.add([d.watch(c,["screenLocationEnabled","location","view.size","view.stationary"],function(){return c._updateScreenPointAndHandle()}),d.watch(c,["view","view.ready"],function(){return c._wireUpView()})]);return c}k(h,b);h.prototype.destroy=function(){this.view=null;this._anchorHandles&&this._anchorHandles.destroy();this._viewpointHandle=this._anchorHandles=null};h.prototype._wireUpView=function(){var a=
this;this._anchorHandles.remove("view");this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var b=this.view,b=c.pausable(b,"3d"===b.type?"camera":"viewpoint",function(){return a._viewpointChange()});this._anchorHandles.add(b,"view");this._viewpointHandle=b;this._toggleWatchingViewpoint()}};h.prototype._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};h.prototype._updateScreenPointAndHandle=function(){this._setScreenLocation();this._toggleWatchingViewpoint()};
h.prototype._toggleWatchingViewpoint=function(){var a=this._viewpointHandle,b=this.screenLocationEnabled;a&&(this.location&&b?a.resume():a.pause())};h.prototype._setScreenLocation=function(){var a=this.location,b=this.view,c=this.screenLocationEnabled,d=this.get("view.ready"),a=c&&a&&d?b.toScreen(a):null;this._set("screenLocation",a)};a([m.property()],h.prototype,"location",void 0);a([m.property({readOnly:!0})],h.prototype,"screenLocation",void 0);a([m.property()],h.prototype,"screenLocationEnabled",
void 0);a([m.property()],h.prototype,"view",void 0);return h=a([m.subclass("esri.widgets.support.AnchorElementViewModel")],h)}(m.declared(g,b))})},"esri/widgets/Popup/PopupViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/support/webMercatorUtils ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../views/support/layerViewUtils ./actions ../support/AnchorElementViewModel ../support/GoTo".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w){var B=b.ofType({key:"type",defaultKeyValue:"button",base:t,typeMap:{button:u,toggle:r}}),C=new B([x.zoomToFeature.clone()]),D=d.getLogger("esri.widgets.Popup.PopupViewModel");return function(b){function d(a){a=b.call(this)||this;a._handles=new c;a._pendingPromises=new Set;a._zoomToLocation=null;a._fetchingFeatures=null;a.actions=C;a.autoCloseEnabled=!1;a.autoOpenEnabled=!0;a.content=null;a.highlightEnabled=!0;a.title=null;a.updateLocationEnabled=
!1;a.view=null;a.visible=!1;a.zoomFactor=4;return a}k(d,b);d.prototype.initialize=function(){var a=this;this._handles.add([l.init(this,"autoOpenEnabled",this._autoOpenEnabledChange),this.on("view-change",this._autoClose),l.watch(this,["highlightEnabled","selectedFeature","visible","view"],this._highlightFeature),l.watch(this,"view.animation.state",function(b){a._zoomToLocation||(x.zoomToFeature.disabled="waiting-for-target"===b)}),this.on("trigger-action",function(b){return x.triggerAction({event:b,
view:a.view})})])};d.prototype.destroy=function(){this._cancelFetchingFeatures();this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.view=null};Object.defineProperty(d.prototype,"allActions",{get:function(){var a=this._get("allActions")||new B;a.removeAll();var b=this.selectedFeature&&("function"===typeof this.selectedFeature.getEffectivePopupTemplate&&this.selectedFeature.getEffectivePopupTemplate()||this.selectedFeature.popupTemplate),c=b&&b.actions;(b=b&&b.overwriteActions?
c:this.actions.concat(c))&&b.filter(Boolean).forEach(function(b){return a.add(b)});return a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"featureCount",{get:function(){return this.features.length},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"features",{get:function(){return this._get("features")||[]},set:function(a){a=a||[];this._set("features",a);var b=this.pendingPromisesCount,c=this.selectedFeatureIndex,d=this.promiseCount&&a.length;d&&b&&-1===c?this.selectedFeatureIndex=
0:d&&-1!==c||(this.selectedFeatureIndex=a.length?0:-1)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"location",{get:function(){return this._get("location")||null},set:function(a){var b=this.get("location"),c=this.get("view.spatialReference.isWebMercator");a&&a.get("spatialReference.isWGS84")&&c&&(a=q.geographicToWebMercator(a));this._set("location",a);a!==b&&this._centerAtLocation()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"pendingPromisesCount",{get:function(){return this._pendingPromises.size},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"waitingForResult",{get:function(){return 0<this.pendingPromisesCount&&0===this.featureCount},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"promiseCount",{get:function(){return this.promises.length},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"promises",{get:function(){return this._get("promises")||[]},set:function(a){var b=this,c=this._get("promises");c&&c.forEach(function(a){a&&"function"===
typeof a.cancel&&a.cancel()});this._pendingPromises.clear();this.features=[];Array.isArray(a)&&a.length?(this._set("promises",a),a=a.slice(0),a.forEach(function(a){b._pendingPromises.add(a);a.then(function(c){b._updatePendingPromises(a);b._updateFeatures(c)},function(){return b._updatePendingPromises(a)})})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"selectedFeature",{get:function(){var a=this.location,b=this.selectedFeatureIndex;
if(-1===b)return null;b=this.features[b];if(!b)return null;!this.updateLocationEnabled&&a||!b.geometry||(this.location=this._getPointFromGeometry(b.geometry));return b},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"selectedFeatureIndex",{get:function(){var a=this._get("selectedFeatureIndex");return"number"===typeof a?a:-1},set:function(a){var b=this.featureCount;a=isNaN(a)||-1>a||!b?-1:(a+b)%b;this._set("selectedFeatureIndex",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});d.prototype.centerAtLocation=function(){var a=this.location,b=this.view;return a&&b?this.callGoTo({target:{target:a,scale:b.scale}}):(a=new e("center-at-location:invalid-location-or-view","Cannot center at a location without a location and view.",{location:a,view:b}),D.error(a),m.reject(a))};d.prototype.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null})};
d.prototype.open=function(a){this.set(g({visible:!1},{updateLocationEnabled:!1,promises:[]},a));this._setVisibleWhenContentExists()};d.prototype.triggerAction=function(a){(a=this.allActions.getItemAt(a))&&this.emit("trigger-action",{action:a})};d.prototype.next=function(){this.selectedFeatureIndex+=1;return this};d.prototype.previous=function(){--this.selectedFeatureIndex;return this};d.prototype.zoomToLocation=function(){var a=this,b=this.location,c=this.selectedFeature,d=this.view,h=this.zoomFactor;
if(!b||!d)return b=new e("zoom-to:invalid-location-or-view","Cannot zoom to location without a location and view.",{location:b,view:d}),D.error(b),m.reject(b);var l="3d"===d.type,d=d.scale/h,h=this.get("selectedFeature.geometry"),l=(l?c:h&&c)||b,n=h||b,q=n&&"point"===n.type&&this._isScreenSize(c),b={target:l,scale:q?d:void 0};x.zoomToFeature.active=!0;x.zoomToFeature.disabled=!0;return this._zoomToLocation=b=this.callGoTo({target:b}).then(function(){q&&(a.location=n);x.zoomToFeature.active=!1;x.zoomToFeature.disabled=
!1;a._zoomToLocation=null}).catch(function(){x.zoomToFeature.active=!1;x.zoomToFeature.disabled=!1;a._zoomToLocation=null})};d.prototype._fetchFeatures=function(a){var b=this.view;return b&&a?b.fetchPopupFeatures(a):(a=new e("fetch-features:invalid-screenPoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:a,view:b}),D.error(a),m.reject(a))};d.prototype._autoOpenEnabledChange=function(){var a=this,b=this._handles,c=this.autoOpenEnabled;b.remove("auto-fetch-features");
c&&(c=l.on(this,"view","click",function(b){"mouse"===b.pointerType&&0!==b.button||a._fetchFeaturesAndOpen(b)}),b.add(c,"auto-fetch-features"))};d.prototype._cancelFetchingFeatures=function(){var a=this._fetchingFeatures;a&&a.cancel();this._fetchingFeatures=null};d.prototype._fetchFeaturesAndOpen=function(a){var b=this,c=a.screenPoint,d=a.mapPoint,h=this.view;this._cancelFetchingFeatures();this._fetchingFeatures=this._fetchFeatures(c).then(function(a){var c=a.promises;b._fetchingFeatures=null;h.popup.open({location:d,
promises:c});return a})};d.prototype._updatePendingPromises=function(a){a&&this._pendingPromises.has(a)&&(this._pendingPromises.delete(a),this.notifyChange("pendingPromisesCount"))};d.prototype._setVisibleWhenContentExists=function(){var a=this,b=this._handles,c=this.promiseCount;b.remove("pendingVisible");c?(c=l.init(this,"pendingPromisesCount",function(c){a.featureCount&&(a.set("visible",!0),b.remove("pendingVisible"));c||b.remove("pendingVisible")}),b.add(c,"pendingVisible")):this.set("visible",
!0)};d.prototype._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};d.prototype._isScreenSize=function(a){var b=this.view;if("3d"!==b.type||!a||"esri.Graphic"!==a.declaredClass)return!0;if((b=b.getViewForGraphic(a))&&b.whenGraphicBounds){var c=!1;b.whenGraphicBounds(a,{useViewElevation:!0}).then(function(a){c=!a||!a.boundingBox||a.boundingBox[0]===a.boundingBox[3]&&a.boundingBox[1]===a.boundingBox[4]&&a.boundingBox[2]===a.boundingBox[5]});return c}return!0};d.prototype._getPointFromGeometry=
function(a){return a?"point"===a.type?a:"extent"===a.type?a.center:"polygon"===a.type?a.centroid:"multipoint"===a.type||"polyline"===a.type?a.extent.center:null:null};d.prototype._isLocationOffScreen=function(a){return a?(a=this.view.toScreen(a))?!(0<=a.x&&a.x<=this.view.width&&0<=a.y&&a.y<=this.view.height):!1:!1};d.prototype._centerAtLocation=function(){var a=this.location;this.updateLocationEnabled&&a&&this._isLocationOffScreen(a)&&this.centerAtLocation()};d.prototype._highlightFeature=function(){var a=
this;this._handles.remove("highlight");var b=this.selectedFeature,c=this.highlightEnabled,d=this.view,h=this.visible;if(b&&d&&c&&h){var e=b.layer;e&&d.when().then(function(){d.whenLayerView(e).then(function(c){if(c&&y.hasHighlight(c)){var d=e.objectIdField,h=b.attributes;c=c.highlight(h&&h[d]||b);a._handles.add(c,"highlight")}})})}};d.prototype._updateFeatures=function(a){var b=this.features;a&&a.length&&(b.length?(a=a.filter(function(a){return-1===b.indexOf(a)}),this.features=b.concat(a)):this.features=
a)};a([h.property({type:B})],d.prototype,"actions",void 0);a([h.property({dependsOn:["actions.length","selectedFeature.sourceLayer.popupTemplate.actions.length","selectedFeature.sourceLayer.popupTemplate.overwriteActions","selectedFeature.popupTemplate.actions.length","selectedFeature.popupTemplate.overwriteActions"],readOnly:!0})],d.prototype,"allActions",null);a([h.property()],d.prototype,"autoCloseEnabled",void 0);a([h.property()],d.prototype,"autoOpenEnabled",void 0);a([h.property()],d.prototype,
"content",void 0);a([h.property({readOnly:!0,dependsOn:["features"]})],d.prototype,"featureCount",null);a([h.property()],d.prototype,"features",null);a([h.property()],d.prototype,"highlightEnabled",void 0);a([h.property({type:n})],d.prototype,"location",null);a([h.property({readOnly:!0,dependsOn:["promises"]})],d.prototype,"pendingPromisesCount",null);a([h.property({readOnly:!0,dependsOn:["featureCount","pendingPromisesCount"]})],d.prototype,"waitingForResult",null);a([h.property({readOnly:!0,dependsOn:["promises"]})],
d.prototype,"promiseCount",null);a([h.property()],d.prototype,"promises",null);a([h.property({value:null,readOnly:!0,dependsOn:["features","selectedFeatureIndex","updateLocationEnabled"]})],d.prototype,"selectedFeature",null);a([h.property({value:-1})],d.prototype,"selectedFeatureIndex",null);a([h.property({readOnly:!0,dependsOn:["view.ready"]})],d.prototype,"state",null);a([h.property()],d.prototype,"title",void 0);a([h.property()],d.prototype,"updateLocationEnabled",void 0);a([h.property()],d.prototype,
"view",void 0);a([h.property()],d.prototype,"visible",void 0);a([h.property()],d.prototype,"zoomFactor",void 0);a([h.property()],d.prototype,"centerAtLocation",null);a([h.property()],d.prototype,"clear",null);a([h.property()],d.prototype,"triggerAction",null);a([h.property()],d.prototype,"next",null);a([h.property()],d.prototype,"previous",null);a([h.property()],d.prototype,"zoomToLocation",null);return d=a([h.subclass("esri.widgets.Popup.PopupViewModel")],d)}(h.declared(z,w))})},"esri/views/support/layerViewUtils":function(){define(["require",
"exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.hasHighlight=function(k){return k&&"function"===typeof k.highlight}})},"esri/widgets/Popup/actions":function(){define("require exports dojo/i18n!../../nls/common dojo/i18n!./nls/Popup ../../core/Error ../../core/promiseUtils ../../support/actions/ActionButton".split(" "),function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});f.zoomToFeature=new e({id:"zoom-to-feature",title:a.zoom,className:"esri-icon-zoom-in-magnifying-glass"});
f.removeSelectedFeature=new e({id:"remove-selected-feature",title:k.remove,className:"esri-icon-trash"});f.all=[f.zoomToFeature,f.removeSelectedFeature];f.triggerAction=function(a){var c=a.view;a=a.event.action;var e=c&&c.popup;if(!a)return b.reject(new g("trigger-action:missing-arguments","Event has no action"));if(!e)return b.reject(new g("trigger-action:missing-arguments","view.popup is missing"));var l=a.disabled,h=a.id;if(!h)return b.reject(new g("trigger-action:invalid-action","action.id is missing"));
if(l)return b.reject(new g("trigger-action:invalid-action","Action is disabled"));if(h===f.zoomToFeature.id)return e.viewModel.zoomToLocation();if(h===f.removeSelectedFeature.id){e.close();a=e.selectedFeature;if(!a)return b.reject(new g("trigger-action:"+f.removeSelectedFeature.id,"selectedFeature is required",{selectedFeature:a}));(e=a.sourceLayer)?e.remove(a):c.graphics.remove(a);return b.resolve()}return b.reject(new g("trigger-action:unknown-action","Unable to identify action to perform",{action:a,
popup:e}))}})},"esri/widgets/support/GoTo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(p,f,k,a,g,b){return function(e){function c(){var a=null!==e&&e.apply(this,arguments)||this;a.goToOverride=null;a.view=null;return a}k(c,e);c.prototype.callGoTo=function(a){var b=this.view;return this.goToOverride?this.goToOverride(b,a):b.goTo(a.target,a.options)};a([b.property()],
c.prototype,"goToOverride",void 0);a([b.property()],c.prototype,"view",void 0);return c=a([b.subclass("esri.widgets.support.GoTo")],c)}(b.declared(g))})},"esri/views/PopupView":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/generatorHelper ../core/Accessor ../core/arrayUtils ../core/promiseUtils ../core/accessorSupport/decorators".split(" "),function(p,f,k,a,
g,b,e,c,d,m,l){return function(c){function h(){return null!==c&&c.apply(this,arguments)||this}a(h,c);h.prototype.fetchPopupFeatures=function(a){return this._fetchPopupFeaturesAsync(a)};h.prototype._fetchPopupFeaturesAsync=function(a){return b(this,void 0,void 0,function(){var b,c,h,l,n,q;return e(this,function(e){switch(e.label){case 0:return[4,this.when()];case 1:return e.sent(),[4,this._prepareFetchPopupFeatures(a)];case 2:return b=e.sent(),c=b.mapPoint,h=this._queryLayerPopupFeatures(b),l=m.resolve(b.clientOnlyGraphics),
n=[l].concat(h),q=m.eachAlwaysValues(n).then(d.concatAll),[2,{promise:q,location:c,promises:n}]}})})};h.prototype._queryLayerPopupFeatures=function(a){var b=a.mapPoint;return a.layerViewsAndGraphics.map(function(a){return a.layerView.fetchPopupFeatures(b,a.graphics)})};h.prototype._isValidPopupGraphic=function(a){return a&&!!a.getEffectivePopupTemplate()};h.prototype._prepareFetchPopupFeatures=function(a){return b(this,void 0,void 0,function(){var b,c,d,h,l,n,m;return e(this,function(e){switch(e.label){case 0:return[4,
this._popupHitTestGraphics(a)];case 1:return b=e.sent(),c=b.clientGraphics,d=b.mapPoint,h=this._getFetchPopupLayerViews(),l=this._graphicsPerFetchPopupLayerView(c,h),n=l.layerViewsAndGraphics,m=l.clientOnlyGraphics,[2,{clientOnlyGraphics:m,layerViewsAndGraphics:n,mapPoint:d}]}})})};h.prototype._popupHitTestGraphics=function(a){return b(this,void 0,void 0,function(){var b,c,d,h,l=this;return e(this,function(e){switch(e.label){case 0:return[4,this.popupHitTest(a)];case 1:return b=e.sent(),c=b.results,
d=b.mapPoint,h=c.map(function(a){return a.graphic}).filter(function(a){return l._isValidPopupGraphic(a)}),[2,{clientGraphics:h,mapPoint:d}]}})})};h.prototype._getFetchPopupLayerViews=function(){var a=this,b=[];this.allLayerViews.forEach(function(c){a._isValidPopupLayerView(c)&&b.push(c)});this._isValidPopupLayerView(this.graphicsView)&&b.push(this.graphicsView);return b};h.prototype._isValidPopupLayerView=function(a){return a&&(!("layer"in a)||!a.suspended)&&"function"===typeof a.fetchPopupFeatures};
h.prototype._graphicsPerFetchPopupLayerView=function(a,b){var c=[],d=new Map;b=b.map(function(a){var b=[];"layer"in a?d.set(a.layer,b):d.set(a.graphics,b);return{layerView:a,graphics:b}});for(var h=0;h<a.length;h++){var e=a[h],l=d.get(e.layer)||null;l?l.push(e):c.push(e)}return{layerViewsAndGraphics:b,clientOnlyGraphics:c}};return h=g([l.subclass("esri.views.PopupView")],h)}(l.declared(c))})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),
function(p,f,k,a,g,b,e,c,d,m){Object.defineProperty(f,"__esModule",{value:!0});p=function(l){function h(){var a=null!==l&&l.apply(this,arguments)||this;a.tilt=new m.default;a.altitude=new e.default;a.clipDistance=new c.default;a.collision=new d.default;return a}k(h,l);a([b.property({type:m.default})],h.prototype,"tilt",void 0);a([b.property({type:e.default})],h.prototype,"altitude",void 0);a([b.property({type:c.default})],h.prototype,"clipDistance",void 0);a([b.property({type:d.default})],h.prototype,
"collision",void 0);return h=a([b.subclass("esri.views.3d.constraints.Constraints")],h)}(b.declared(g));f.Constraints=p;f.default=p})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function d(){var a=
null!==b&&b.apply(this,arguments)||this;a.min=c.AltitudeDefault.min;a.max=c.AltitudeDefault.max;return a}k(d,b);Object.defineProperty(d.prototype,"mode",{get:function(){g.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.","","4.6");return"manual"},set:function(a){g.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
"","4.6")},enumerable:!0,configurable:!0});a([e.property({type:Number})],d.prototype,"min",void 0);a([e.property({type:Number})],d.prototype,"max",void 0);return d=a([e.subclass("esri.views.3d.constraints.AltitudeConstraint")],d)}(e.declared(b));f.AltitudeConstraint=p;f.default=p})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Logger ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,"__esModule",{value:!0});var m=b.getLogger("esri.views.3d.state.Constraints");p=function(b){function c(a){a=b.call(this)||this;a.collision=new h;a.distance=Infinity;a.minimumPoiDistance=4;return a}k(c,b);Object.defineProperty(c.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(a){"local"===this.mode?m.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",a)},enumerable:!0,
configurable:!0});c.prototype.clampAltitude=function(a){return this.altitude?d.clamp(a,this.altitude.min,this.altitude.max):a};c.prototype.clampTilt=function(a,b){if(!this.tilt)return b;a=this.tilt(a);return d.clamp(b,a.min,a.max)};c.prototype.clampDistance=function(a){return Math.min(a,this.distance)};c.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};c.prototype.createConstantMaxTilt=function(a){return function(b,c){void 0===
c&&(c=l);c.min=f.TiltDefault.min;c.max=a;return c}};c.prototype.createDefaultTiltLocal=function(){var a=this.collision.enabled?d.makePiecewiseLinearFunction([[4E3,f.TiltDefault.max],[1E4,d.deg2rad(88)],[6E6,d.deg2rad(88)]]):function(){return f.TiltDefault.max};return function(b,c){void 0===c&&(c=l);c.min=f.TiltDefault.min;c.max=a(b);return c}};c.prototype.createDefaultTiltGlobal=function(){var a=this.collision.enabled?d.makePiecewiseLinearFunction([[4E3,f.TiltDefault.max],[5E4,d.deg2rad(88)],[6E6,
d.deg2rad(88)],[2E7,f.TiltDefault.min]]):d.makePiecewiseLinearFunction([[3E5,f.TiltDefault.max],[3E6,d.deg2rad(88)],[6E6,d.deg2rad(88)],[2E7,f.TiltDefault.min]]);return function(b,c){void 0===c&&(c=l);c.min=f.TiltDefault.min;c.max=a(b);return c}};a([e.property()],c.prototype,"altitude",null);a([e.property({readOnly:!0})],c.prototype,"collision",void 0);a([e.property()],c.prototype,"distance",void 0);a([e.property({readOnly:!0})],c.prototype,"minimumPoiDistance",void 0);a([e.property()],c.prototype,
"tilt",void 0);a([e.property({constructOnly:!0})],c.prototype,"mode",void 0);return c=a([e.subclass("esri.views.3d.state.Constraints")],c)}(e.declared(g));f.Constraints=p;f.AltitudeDefault={min:-2E5,max:4*c.earthRadius};f.TiltDefault={min:d.deg2rad(.5),max:d.deg2rad(179.5)};var l={min:0,max:0},h=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.enabled=!0;a.elevationMargin=5;return a}k(c,b);a([e.property({type:Boolean})],c.prototype,"enabled",void 0);a([e.property({type:Number})],
c.prototype,"elevationMargin",void 0);return c=a([e.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],c)}(e.declared(g));f.default=p})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});p=function(e){function c(){var a=
null!==e&&e.apply(this,arguments)||this;a.mode="auto";return a}k(c,e);Object.defineProperty(c.prototype,"near",{get:function(){return this._get("near")},set:function(a){this._set("near",a);a>=this._get("far")&&(this.far=a+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});c.prototype.castNear=function(a){return Math.max(1E-8,a)};Object.defineProperty(c.prototype,"far",{get:function(){return this._get("far")},set:function(a){this._set("far",a);a<=this._get("near")&&(this.near=a-1E-9);this.mode=
"manual"},enumerable:!0,configurable:!0});c.prototype.castFar=function(a){return Math.max(1E-8,a)};c.prototype.autoUpdate=function(a,b){"auto"===this.mode&&(this._get("near")!==a&&this._set("near",a),this._get("far")!==b&&this._set("far",b))};a([b.property({type:Number,value:1E-8})],c.prototype,"near",null);a([b.cast("near")],c.prototype,"castNear",null);a([b.property({type:Number,value:1E-8})],c.prototype,"far",null);a([b.cast("far")],c.prototype,"castFar",null);a([b.property({type:String})],c.prototype,
"mode",void 0);return c=a([b.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],c)}(b.declared(g));f.ClipDistanceConstraint=p;f.default=p})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function c(){return null!==
b&&b.apply(this,arguments)||this}k(c,b);Object.defineProperty(c.prototype,"enabled",{set:function(a){g.deprecated("SceneView.constraint.collision.enabled","Use Map.ground.navigationConstraint instead","4.8");this._set("enabled",a)},enumerable:!0,configurable:!0});a([e.property({value:!0})],c.prototype,"enabled",null);return c=a([e.subclass("esri.views.3d.constraints.CollisionConstraint")],c)}(e.declared(b));f.CollisionConstraint=p;f.default=p})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints ../support/mathUtils".split(" "),
function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});var d=c.rad2deg(e.TiltDefault.min),m=c.rad2deg(e.TiltDefault.max);p=function(e){function h(){var a=null!==e&&e.apply(this,arguments)||this;a.mode="auto";return a}k(h,e);Object.defineProperty(h.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!0,configurable:!0});h.prototype.castMax=function(a){return c.clamp(a,d,m)};h.prototype.autoUpdate=function(a){"auto"===
this.mode&&this._get("max")!==a&&this._set("max",a)};a([b.property({type:String})],h.prototype,"mode",void 0);a([b.property({type:Number,value:m})],h.prototype,"max",null);a([b.cast("max")],h.prototype,"castMax",null);return h=a([b.subclass("esri.views.3d.constraints.TiltConstraint")],h)}(b.declared(g));f.TiltConstraint=p;f.default=p})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h){return function(l){function n(a){a=l.call(this,a)||this;a.atmosphere=new d.default;return a}k(n,l);t=n;n.fromWebsceneEnvironment=function(a){a=a.cloneConstructProperties();return new t(g({},a,{lighting:m.SceneViewLighting.fromWebsceneLighting(a.lighting)}))};n.prototype.castLighting=function(a){return a?a instanceof m.SceneViewLighting?a:a instanceof h?this.lighting?this.lighting.cloneWithWebsceneLighting(a):m.SceneViewLighting.fromWebsceneLighting(a):c.ensureType(m.SceneViewLighting,
a):new m.SceneViewLighting};n.prototype.clone=function(){return new t({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:b.clone(this.background)})};var t;a([e.property({type:d.default,json:{read:!1}})],n.prototype,"atmosphere",void 0);a([e.property()],n.prototype,"lighting",void 0);a([e.cast("lighting")],n.prototype,"castLighting",null);return n=t=a([e.subclass("esri.views.3d.environment.SceneViewEnvironment")],
n)}(e.declared(l))})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});p=function(e){function c(){return null!==e&&e.apply(this,arguments)||this}k(c,e);d=c;Object.defineProperty(c.prototype,"quality",{set:function(a){-1!==["low","high"].indexOf(a)&&
this._set("quality",a)},enumerable:!0,configurable:!0});c.prototype.clone=function(){return new d({quality:this.quality})};var d;a([b.property({type:String,value:"low"})],c.prototype,"quality",null);return c=d=a([b.subclass("esri.views.3d.environment.SceneViewAtmosphere")],c)}(b.declared(g));f.SceneViewAtmosphere=p;f.default=p})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),
function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function c(a){a=b.call(this,a)||this;a.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};a.cameraTrackingEnabled=!0;a.ambientOcclusionEnabled=!1;var c=(new Date).getFullYear(),c=new Date("March 15, "+c+" 12:00:00 UTC");a._set("defaultDate",c);a._set("date",c);return a}k(c,b);h=c;c.fromWebsceneLighting=function(a){return new h(g({},a.cloneConstructProperties()))};Object.defineProperty(c.prototype,
"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var b=this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);b&&this._set("date",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"date",{set:function(a){null!=a&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(a.getTime())))},enumerable:!0,configurable:!0});c.prototype.autoUpdate=function(a,b){var c=this._calculateTimezoneOffset(this.positionTimezoneInfo);
this.positionTimezoneInfo.hours=b.hours;this.positionTimezoneInfo.minutes=b.minutes;this.positionTimezoneInfo.seconds=b.seconds;b=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=!0,b=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())));var h=this._calculateTimezoneOffset(this.positionTimezoneInfo);c!==h&&(d.target=this,d.timezoneOffset=h,this.emit("timezone-will-change",d));if(null!=a)return b!==a.getTime()};c.prototype.clone=function(){var a=this._get("date")===this._get("defaultDate"),
b=new h(g({},this.cloneConstructProperties(),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled}));a&&b._set("date",b._get("defaultDate"));b.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;b.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;b.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;b.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return b};c.prototype.cloneWithWebsceneLighting=
function(a){var b=this.clone();null!=a.date&&(b.date=a.date);b.directShadowsEnabled=a.directShadowsEnabled;b.displayUTCOffset=a.displayUTCOffset;return b};c.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)};var h;a([e.property({type:Boolean})],c.prototype,"cameraTrackingEnabled",void 0);a([e.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);a([e.property({type:Date})],c.prototype,"defaultDate",null);a([e.property({type:Date})],
c.prototype,"date",null);return c=h=a([e.subclass("esri.views.3d.environment.SceneViewLighting")],c)}(e.declared(c,b));f.SceneViewLighting=p;var d={target:null,timezoneOffset:0};f.default=p})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(p,f,k,a,g,b){return function(e){function c(a){a=e.call(this,a)||this;a.date=null;a.directShadowsEnabled=
!1;a.displayUTCOffset=null;return a}k(c,e);d=c;c.prototype.readDate=function(a,b){return null!=b.datetime&&new Date(b.datetime)||null};c.prototype.writeDate=function(a,b,c){b[c]=a.getTime()};c.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};c.prototype.writedirectShadowsEnabled=function(a,b,c){a&&(b[c]=a)};c.prototype.writeDisplayUTCOffset=function(a,b){null!=a&&(b.displayUTCOffset=a)};c.prototype.clone=function(){return new d(this.cloneConstructProperties())};c.prototype.cloneConstructProperties=
function(){var a={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(a.date=new Date(this.date.getTime()));return a};var d;a([b.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],c.prototype,"date",void 0);a([b.reader("date",["datetime"])],c.prototype,"readDate",null);a([b.writer("date")],c.prototype,"writeDate",null);a([b.property({type:Boolean,json:{write:{target:"directShadows"}}})],c.prototype,
"directShadowsEnabled",void 0);a([b.reader("directShadowsEnabled",["directShadows"])],c.prototype,"readDirectShadowsEnabled",null);a([b.writer("directShadowsEnabled")],c.prototype,"writedirectShadowsEnabled",null);a([b.property({type:Number,json:{write:!0}})],c.prototype,"displayUTCOffset",void 0);a([b.writer("displayUTCOffset")],c.prototype,"writeDisplayUTCOffset",null);return c=d=a([b.subclass("esri.webscene.Lighting")],c)}(b.declared(g))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(p,f,k,a,g,b,e,c,d){var m=function(a,b,c){return{enabled:!c||!c.isPresentation}};return function(l){function h(a){a=l.call(this,a)||this;a.lighting=new c;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}k(h,l);n=h;h.prototype.clone=function(){return new n(this.cloneConstructProperties())};h.prototype.cloneConstructProperties=function(){return{lighting:c.prototype.clone.call(this.lighting),background:b.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var n;a([e.property({type:c,json:{write:!0}})],h.prototype,"lighting",void 0);a([e.property(d.backgroundProperty)],h.prototype,"background",void 0);a([e.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:m}}})],h.prototype,"atmosphereEnabled",void 0);a([e.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:m}}})],h.prototype,"starsEnabled",void 0);return h=n=a([e.subclass("esri.webscene.Environment")],h)}(e.declared(g))})},"esri/webscene/background/utils":function(){define(["require",
"exports","./Background","./ColorBackground"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p={base:k,key:"type",typeMap:{color:a}};f.backgroundProperty={types:p,json:{read:function(a){return function(b,e,c){if(!b)return b;for(var d in a.typeMap)if(b.type===d)return e=new a.typeMap[d],e.read(b,c),e}}(p),write:{overridePolicy:function(a,b,e){return{enabled:!e||!e.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators".split(" "),
function(p,f,k,a,g,b,e,c){var d=e.strict()({color:"color"});return function(b){function e(a){return b.call(this)||this}k(e,b);e.prototype.normalizeCtorArgs=function(a){a&&a.type&&(a=g({},a),delete a.type);return a};e.prototype.clone=function(){};a([c.property({type:d.apiValues,readOnly:!0,json:{type:d.jsonValues,read:!1,write:d.write}})],e.prototype,"type",void 0);return e=a([c.subclass("esri.webscene.background.Background")],e)}(c.declared(b))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(p,f,k,a,g,b,e,c,d){var m=g({},c.colorAndTransparencyProperty,{nonNullable:!0});return function(c){function d(a){a=c.call(this)||this;a.type="color";a.color=new b([0,0,0,1]);return a}k(d,c);l=d;d.prototype.clone=function(){return new l(this.cloneProperties())};d.prototype.cloneProperties=function(){return{color:this.color.clone()}};var l;a([e.enumeration.serializable()({color:"color"})],d.prototype,"type",void 0);a([e.property(m)],d.prototype,"color",void 0);return d=l=a([e.subclass("esri.webscene.background.ColorBackground")],
d)}(e.declared(d))})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z){Object.defineProperty(f,"__esModule",{value:!0});var w=h.vec3f64.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);p=function(b){function e(a){var d=b.call(this)||this;d.referencePointUpdateDelay=200;d.referencePointUpdateInterval=3E3;d.referencePointUpdateDistThreshold=1E6;d._referencePosUpdateQuery=null;d._referencePosMapCoordsRequested=null;d._viewHandles=new c;d._preserveAbsoluteDateTime=!1;d._trackingEnabled=!1;d._viewConnected=
!1;d._referencePosResetPreserveAbsoluteTime=!1;d.referencePosUpdateTimer=null;d._referencePosWGS84=null;d._referencePosMapCoords=null;d._mainLight=new x.MainLight;d._ambientLight=new x.AmbientLight;d._moonLight=new x.FillLight;d._environmentRenderer=null;d.debug=function(){return{set referencePointUpdateInterval(a){d.referencePointUpdateInterval=a},set referencePointUpdateDistThreshold(a){d.referencePointUpdateDistThreshold=a},set referencePosUpdateTimer(a){d.referencePosUpdateTimer=a},set referencePointUpdateDelay(a){d.referencePointUpdateDelay=
a}}}();d._resetReferencePosition();return d}k(e,b);e.prototype.destroy=function(){this._viewHandles.destroy();this.disposeRendering()};Object.defineProperty(e.prototype,"updating",{get:function(){return!this.noReferencePositionQueries&&(!!this._referencePosUpdateQuery||!!this._referencePosMapCoordsRequested)||this._environmentRenderer.updating},enumerable:!0,configurable:!0});e.prototype.updateReadyChange=function(a){a&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view)):!a&&
this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view))};e.prototype.disposeRendering=function(){this._environmentRenderer&&(this._environmentRenderer.destroy(),this._environmentRenderer=null);this._resetReferencePosition(!0)};e.prototype.connectView=function(a){var b=this;this._environmentRenderer=new u({view:a});this._viewHandles.add([this.view.watch("environment.lighting.date",function(a){return b._lightingDateHandler(a)},!0),this.view.watch("interacting,stationary",this._interactingStationaryHandler.bind(this)),
this.view.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.background.color"],this._updateRenderParamsHandler.bind(this)),this.view.watch("spatialReference",this._spatialReferenceHandler.bind(this)),m.init(this.view,"viewingMode",this._viewingModeHandler.bind(this)),m.init(this.view,"environment.lighting.cameraTrackingEnabled",this._updateCameraTracking.bind(this),!0),m.init(this,"view.state.camera",this._cameraHandler.bind(this,null),
!0),this.watch("noReferencePositionQueries",this._cameraHandler.bind(this,null))]);this._updateRenderParamsHandler();this._updateLightParams();this._cameraHandler()};e.prototype._updateCameraTracking=function(a){if(this._trackingEnabled=a)this._cameraHandler();else if(a=this.get("view.environment.lighting"))a.positionTimezoneInfo.autoUpdated=!1};e.prototype.disconnectView=function(a){this.disposeRendering();this._viewHandles.removeAll()};e.prototype._lightingDateHandler=function(a){if(a){var b=this.view.environment.lighting;
if(!b.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;var c=this.view.spatialReference;if(!(c.isWGS84||c.isWebMercator||(c=this.view.camera.position,this._referencePosMapCoords&&this._referencePosMapCoords.equals(c)))){this._requestReferencePositionUpdate(c);return}this._preupdateTracking(a);this._referencePosWGS84&&(c=r.positionToTimezone(this._referencePosWGS84,C),b.autoUpdate(null,c),this._trackingEnabled&&(b.positionTimezoneInfo.autoUpdated=!0))}this._updateLightParams(a)}};
e.prototype._preupdateTracking=function(a){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&this._cameraHandler(a)};e.prototype._cameraHandler=function(a){void 0===a&&(a=null);if(this.view.ready){var b=this.view.camera;if(b){var c=this.view.spatialReference;c.isWGS84||c.isWebMercator?this._cameraHandlerGlobal(b,a):this._cameraHandlerLocal(b,a)}}};e.prototype._cameraHandlerGlobal=function(a,b){a=a.position;this._referencePosWGS84||(this._referencePosWGS84=new n({spatialReference:q.WGS84}));
a.spatialReference.isWebMercator?t.webMercatorToGeographic(a,!1,this._referencePosWGS84):(this._referencePosWGS84.x=a.x,this._referencePosWGS84.y=a.y);this._referencePosWGS84.z=a.z;this._autoUpdateTimezone(a,b)||this._updateLightParams(b)};e.prototype._cameraHandlerLocal=function(a,b){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this.view.mapCoordsHelper&&this._referencePosWGS84&&
(this._referencePosWGS84.z=a.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};e.prototype._interactingStationaryHandler=function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()};e.prototype._updateLightParams=function(a){void 0===a&&(a=null);var b=this.view.environment.lighting;a=a||b.date;var b=this.view._stage,c;this._referencePosWGS84?(c=y.computeColorAndIntensity(a,this._referencePosWGS84),y.computeDirection(a,this._referencePosWGS84,
this.view.viewingMode,c.diffuse.direction)):c={diffuse:{color:[1,1,1],intensity:.55,direction:w},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};h.vec3.scale(this._mainLight.intensity,c.diffuse.color,c.diffuse.intensity*Math.PI);h.vec3.negate(this._mainLight.direction,c.diffuse.direction);h.vec3.scale(this._ambientLight.intensity,c.ambient.color,c.ambient.intensity);h.vec3.lerp(this._moonLight.intensity,D,E,c.globalFactor);h.vec3.scale(this._moonLight.intensity,this._moonLight.intensity,
(1-.5*c.globalFactor)*(1-.4*c.noonFactor*(1-c.globalFactor)));h.vec3.copy(this._moonLight.direction,c.diffuse.direction);b.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:c.globalFactor,groundLightingFactor:1-c.noonFactor});this._updateRenderParamsHandler()};e.prototype._autoUpdateTimezone=function(a,b){void 0===b&&(b=null);if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;var c=B;c.setTime((b||this.view.environment.lighting.date).getTime());
a=r.positionToTimezone(a,C);var d=this.view.environment.lighting.positionTimezoneInfo;if(!d.autoUpdated)d=a;else if(d.hours===a.hours&&d.minutes===a.minutes&&d.seconds===a.seconds)return!1;var e=c.getUTCHours()-(a.hours-d.hours),h=c.getUTCMinutes()-(a.minutes-d.minutes),d=c.getUTCSeconds()-(a.seconds-d.seconds);c.setUTCHours(e);c.setUTCMinutes(h);c.setUTCSeconds(d);return b?!1:this.view.environment.lighting.autoUpdate(c,a)};e.prototype._updateRenderParamsHandler=function(){var a=this.view._stage,
b=!0;this._referencePosWGS84&&(b=y.computeShadowsEnabled(this._referencePosWGS84,this.view.viewingMode));var c=this.view.environment.background,c=c instanceof z?{type:"color",color:h.vec4f64.fromArray(g.toUnitRGBA(c.color))}:{type:"color",color:h.vec4f64.fromValues(0,0,0,1)};a&&a.setRenderParams({shadowMap:this.view.environment.lighting.directShadowsEnabled&&b,ssao:this.view.environment.lighting.ambientOcclusionEnabled,background:c})};e.prototype._spatialReferenceHandler=function(){this._resetReferencePosition()};
e.prototype._viewingModeHandler=function(){this._resetReferencePosition()};e.prototype._resetReferencePosition=function(a){void 0===a&&(a=!1);this._cancelReferencePosUpdates();this._referencePosWGS84=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;a||this.notifyChange("updating")};e.prototype._requestReferencePositionUpdate=function(a,b){var c=this;void 0===b&&(b=!1);if(this.view.mapCoordsHelper.canProject()&&!this.noReferencePositionQueries&&
(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(a):this._referencePosMapCoordsRequested=a.clone(),this._referencePosResetPreserveAbsoluteTime=!!b,!this._referencePosUpdateQuery&&!this.referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var e=this._referencePosUpdateQuery=d.after(this.referencePointUpdateDelay).then(function(){if(c._referencePosUpdateQuery===e)return c._doReferencePositionUpdateQuery(function(){return c._referencePosUpdateQuery!==
e})}).catch(function(){}).then(function(){c._referencePosUpdateQuery===e&&(c._referencePosUpdateQuery=null,c.referencePosUpdateTimer||c._executePendingReferencePositionUpdate(),c.notifyChange("updating"))}),h=this.referencePosUpdateTimer=d.after(this.referencePointUpdateInterval).then(function(){c.referencePosUpdateTimer===h&&(c.referencePosUpdateTimer=null,c._referencePosUpdateQuery||c._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};e.prototype._doReferencePositionUpdateQuery=
function(a){var b=this;this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;return this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords).then(function(c){if(!a()&&!isNaN(c[0])&&!isNaN(c[1])){var d=b._referencePosMapCoords.z*
b.view.mapCoordsHelper.unitInMeters;b._referencePosWGS84?(b._referencePosWGS84.x=c[0],b._referencePosWGS84.y=c[1],b._referencePosWGS84.z=d):b._referencePosWGS84=new n({x:c[0],y:c[1],z:d,spatialReference:q.WGS84});b._referencePosChanged()}})};e.prototype._executePendingReferencePositionUpdate=function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)};e.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?
this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84)||this._updateLightParams()};e.prototype._exceedsReferencePosDistThreshold=function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this.view.mapCoordsHelper&&(a*=this.view.mapCoordsHelper.unitInMeters),a>this.referencePointUpdateDistThreshold):!0};e.prototype._cancelReferencePosUpdates=function(){this.referencePosUpdateTimer=this._referencePosUpdateQuery=null};e.FIXED_LIGHT_DIRECTION=w;a([l.property({type:Boolean,
dependsOn:["noReferencePositionQueries","_environmentRenderer.updating"],readOnly:!0})],e.prototype,"updating",null);a([l.property()],e.prototype,"noReferencePositionQueries",void 0);a([l.property({constructOnly:!0})],e.prototype,"view",void 0);a([l.property()],e.prototype,"_environmentRenderer",void 0);return e=a([l.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],e)}(l.declared(b,e));f.SceneViewEnvironmentManager=p;var B=new Date,C={hours:0,minutes:0,seconds:0},D=h.vec3f64.fromValues(.22,
.22,.33),E=h.vec3f64.fromValues(.22,.22,.22);f.default=p})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/compilerUtils ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),function(p,f,k,a,g,b,e,c,d,m,l,h,n){var q=[16,17];return function(g){function t(){var a=
null!==g&&g.apply(this,arguments)||this;a.needsRender=!1;a.didRender=!0;a._handles=new e;a._initContext=null;a._atmosphereReadyPromise=null;a._atmosphere=null;a._stars=null;return a}k(t,g);Object.defineProperty(t.prototype,"updating",{get:function(){return!(!this._atmosphereReadyPromise||this._atmosphereReadyPromise.isFulfilled())},enumerable:!0,configurable:!0});t.prototype.initialize=function(){this.view._stage.addRenderPlugin(q,this)};t.prototype.destroy=function(){this._atmosphere&&(this._atmosphere.destroy(),
this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._handles&&this._handles.removeAll();this.view&&(this.view._stage.removeRenderPlugin(this),this.view=null)};t.prototype.initializeRenderContext=function(a){this._initContext=a;this.setup()};t.prototype.setup=function(){var a=this;this._handles.add(c.when(this.view,"basemapTerrain",function(){return a._updateBasemapTerrain()}));this._handles.add([c.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],
function(){return a._updateAtmosphere()}),c.init(this.view,"environment.starsEnabled",function(){return a._updateStars()})])};t.prototype.uninitializeRenderContext=function(a){this._stars&&(this._stars.uninitializeRenderContext(a),this._stars.destroy(),this._stars=null);this._atmosphere&&(this._atmosphere.uninitializeRenderContext(a),this._atmosphere.destroy(),this._atmosphere=null)};t.prototype.render=function(a){var b=this.view.basemapTerrain;if(!(b&&b.loaded||"global"!==this.view.viewingMode))return!1;
b=!0;this._stars&&(b=this._stars.render(a)&&b);this._atmosphere&&(b=this._atmosphere.render(a)&&b);return b};t.prototype._updateStars=function(){var a=this.view.get("environment.starsEnabled")||!1;a&&!this._stars?(this._stars=new n(this.view),this._stars.initializeRenderContext(this._initContext),this.needsRender=!0):!a&&this._stars&&(this._stars.destroy(),this._stars=null,this.needsRender=!0)};t.prototype._updateAtmosphere=function(){var a=this,b=this._getAtmosphereType(this._initContext);if(this.atmosphereType!==
b)if(this.atmosphereType=b,this._atmosphereReadyPromise&&(this._atmosphereReadyPromise.cancel(),this._atmosphereReadyPromise=null),b=this._getAtmosphereClass(b)){var c=new b(this.view);c.initializeRenderContext(this._initContext);null==this._atmosphere&&(this._atmosphere=c,this.needsRender=!0);this._atmosphereReadyPromise=c.when(function(){a._atmosphere!==c&&(a._atmosphere&&(a._atmosphere.destroy(),a._atmosphere=null),a._atmosphere=c);a._atmosphereReadyPromise=null;a.needsRender=!0;a._updateBasemapTerrain();
a.notifyChange("updating")});this.notifyChange("updating")}else this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null,this.needsRender=!0),this._updateBasemapTerrain()};t.prototype._getAtmosphereClass=function(a){switch(a){case "none":return null;case "realistic":return l;case "panoramic":return m;case "simple":return h;default:b.neverReached(a)}};t.prototype._getAtmosphereType=function(a){var b=this.view.get("environment.atmosphereEnabled"),c=this.view.get("environment.atmosphere.quality"),
d=this.view.viewingMode;return b&&null!=c?"local"===d?"panoramic":"high"===c&&l.isSupported(a)?"realistic":"simple":"none"};t.prototype._updateBasemapTerrain=function(){var a=this.view.basemapTerrain;a&&(a.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};a([d.property()],t.prototype,"view",void 0);a([d.property()],t.prototype,"updating",null);return t=a([d.subclass("esri.views.3d.environment.EnvironmentRenderer")],t)}(d.declared(g))})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ./resources/SimpleAtmosphereTexture ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/Texture ../../webgl/Util ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u){p=function(){function e(a){this.needsRender=!1;this.didRender=!0;this.slot=16;this.view=a}e.prototype.destroy=function(){this._program&&(this._program.dispose(),this._program=null);this._texture&&(this._texture.dispose(),this._texture=null);this._readyPromise&&(this._readyPromise.cancel(),this._readyPromise=null)};e.prototype.when=function(a){return this._readyPromise.then(a)};e.prototype.initializeRenderContext=function(b){var c=this,d=b.rctx;this._program=
h.createProgram(d,m.colorPass,{panoramic:!0});this._vao=this._createVertexArrayObject(d);this._vaoCount=t.vertexCount(this._vao,"geometry");this._readyPromise=g.requestImage(a).then(function(a){c._texture=new n(b.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);c.needsRender=!0})};e.prototype.uninitializeRenderContext=function(a){this.destroy()};e.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass||null==this._texture)return!1;var b=a.rctx,c=this._program;
b.bindProgram(c);b.bindTexture(this._texture);c.setUniform1i("tex",0);c.setUniformMatrix4fv("proj",a.camera.projectionMatrix);var d=r;k.mat4.copy(d,a.camera.viewMatrix);d[12]=0;d[13]=0;d[14]=0;d[15]=1;c.setUniformMatrix4fv("view",r);c.setUniform4f("color",1,1,1,1);c.setUniform3fv("lightDirection",a.lightingData.direction);b.setDepthTestEnabled(!0);b.setFaceCullingEnabled(!0);b.setFrontFace(2305);b.setCullFace(1029);b.setDepthFunction(515);b.setBlendingEnabled(!0);b.setDepthWriteEnabled(!1);b.bindVAO(this._vao);
q.assertCompatibleVertexAttributeLocations(this._vao,c);b.drawArrays(4,0,this._vaoCount);b.setDepthWriteEnabled(!0);b.setBlendingEnabled(!1);b.setDepthFunction(513);b.setFaceCullingEnabled(!1);return!0};e.prototype._createVertexArrayObject=function(a){for(var e=c.createPolySphereGeometry(1,2,!1),h=e.indices[d.VertexAttrConstants.POSITION],n=0;n<h.length;n+=3){var g=h[n];h[n]=h[n+2];h[n+2]=g}for(var e=e.vertexAttributes[d.VertexAttrConstants.POSITION].data,g=y.createBuffer(h.length),q=g.position,n=
0;n<h.length;++n){var t=3*h[n];q.set(n,0,e[t]);q.set(n,1,e[t+1]);q.set(n,2,e[t+2])}return new u(a,m.colorPass.attributes,{geometry:b.glLayout(y)},{geometry:l.createVertex(a,35044,g.buffer)})};return e}();var r=k.mat4f64.create(),y=e.newLayout().vec3f("position");return p})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["require","exports"],function(p,f){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../request"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.dataURItoBlob=function(a){var g=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var b=new ArrayBuffer(g.length),e=new Uint8Array(b),c=0;c<g.length;c++)e[c]=g.charCodeAt(c);return new Blob([b],{type:a})};f.requestImage=function(a){return k(a,{responseType:"image"}).then(function(a){return a.data})}})},"esri/views/3d/support/buffer/glUtil":function(){define(["require",
"exports","../../../../core/tsSupport/assignHelper"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});var a={divisor:0,prefixA:!1};f.glLayout=function(b,e){void 0===e&&(e={});e=k({},a,e);var c=b.stride;return b.fieldNames.filter(function(a){a=b.fields.get(a).optional;return!(a&&a.glPadding)}).map(function(a){var d=b.fields.get(a),l=d.constructor.ElementCount,h;h=g[d.constructor.ElementType];if(!h)throw Error("BufferType not supported in WebGL");var n=d.offset,d=!(!d.optional||!d.optional.glNormalized);
return{name:e.prefixA?"a"+a[0].toUpperCase()+a.substr(1):a,stride:c,count:l,type:h,offset:n,normalized:d,divisor:e.divisor}})};var g={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView","./types"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});var g=function(){function a(a,b){this.layout=a;this.buffer="number"===typeof b?new ArrayBuffer(b*a.stride):b;b=0;for(var c=
a.fieldNames;b<c.length;b++){var d=c[b],e=a.fields.get(d);this[d]=new e.constructor(this.buffer,e.offset,this.stride)}}Object.defineProperty(a.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});a.prototype.getField=function(a,b){return(a=this[a])&&a.elementCount===b.ElementCount&&a.elementType===b.ElementType?a:null};a.prototype.slice=
function(b,d){return new a(this.layout,this.buffer.slice(b*this.stride,d*this.stride))};return a}(),b=function(){function b(){this.stride=0;this.fields=new Map;this.fieldNames=[]}b.prototype.vec2f=function(a,b){this.appendField(a,k.BufferViewVec2f,b);return this};b.prototype.vec2f64=function(a,b){this.appendField(a,k.BufferViewVec2f64,b);return this};b.prototype.vec3f=function(a,b){this.appendField(a,k.BufferViewVec3f,b);return this};b.prototype.vec3f64=function(a,b){this.appendField(a,k.BufferViewVec3f64,
b);return this};b.prototype.vec4f=function(a,b){this.appendField(a,k.BufferViewVec4f,b);return this};b.prototype.vec4f64=function(a,b){this.appendField(a,k.BufferViewVec4f64,b);return this};b.prototype.mat3f=function(a,b){this.appendField(a,k.BufferViewMat3f,b);return this};b.prototype.mat3f64=function(a,b){this.appendField(a,k.BufferViewMat3f64,b);return this};b.prototype.mat4f=function(a,b){this.appendField(a,k.BufferViewMat4f,b);return this};b.prototype.mat4f64=function(a,b){this.appendField(a,
k.BufferViewMat4f64,b);return this};b.prototype.vec4u8=function(a,b){this.appendField(a,k.BufferViewVec4u8,b);return this};b.prototype.f32=function(a,b){this.appendField(a,k.BufferViewFloat,b);return this};b.prototype.f64=function(a,b){this.appendField(a,k.BufferViewFloat64,b);return this};b.prototype.u8=function(a,b){this.appendField(a,k.BufferViewUint8,b);return this};b.prototype.u16=function(a,b){this.appendField(a,k.BufferViewUint16,b);return this};b.prototype.i8=function(a,b){this.appendField(a,
k.BufferViewInt8,b);return this};b.prototype.vec2i8=function(a,b){this.appendField(a,k.BufferViewVec2i8,b);return this};b.prototype.vec2i16=function(a,b){this.appendField(a,k.BufferViewVec2i16,b);return this};b.prototype.vec2u8=function(a,b){this.appendField(a,k.BufferViewVec2u8,b);return this};b.prototype.vec4u16=function(a,b){this.appendField(a,k.BufferViewVec4u16,b);return this};b.prototype.u32=function(a,b){this.appendField(a,k.BufferViewUint32,b);return this};b.prototype.appendField=function(b,
d,e){var c=d.ElementCount*a.elementTypeSize(d.ElementType);this.fields.set(b,{size:c,constructor:d,offset:this.stride,optional:e});this.stride+=c;this.fieldNames.push(b)};b.prototype.alignTo=function(a){this.stride=Math.floor((this.stride+a-1)/a)*a;return this};b.prototype.hasField=function(a){return 0<=this.fieldNames.indexOf(a)};b.prototype.createBuffer=function(a){return new g(this,a)};b.prototype.createView=function(a){return new g(this,a)};b.prototype.clone=function(){var a=new b;a.stride=this.stride;
a.fields=new Map;this.fields.forEach(function(b,c){return a.fields.set(c,b)});a.fieldNames=this.fieldNames.slice();a.BufferType=this.BufferType;return a};return b}();f.InterleavedLayout=b;f.newLayout=function(){return new b}})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,
"__esModule",{value:!0});p=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}k(b,a);b.ElementType="f32";return b}(b.BufferViewScalarImpl);f.BufferViewFloat=p;p=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}k(b,a);b.ElementType="f32";return b}(e.BufferViewVec2Impl);f.BufferViewVec2f=p;p=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,
b,c,d,e)||this;b.elementType="f32";return b}k(b,a);b.ElementType="f32";return b}(c.BufferViewVec3Impl);f.BufferViewVec3f=p;p=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}k(b,a);b.ElementType="f32";return b}(d.BufferViewVec4Impl);f.BufferViewVec4f=p;p=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}k(b,a);b.ElementType="f32";return b}(a.BufferViewMat3Impl);
f.BufferViewMat3f=p;a=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d,e)||this;b.elementType="f64";return b}k(b,a);b.ElementType="f64";return b}(a.BufferViewMat3Impl);f.BufferViewMat3f64=a;a=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float32Array,b,c,d,e)||this;b.elementType="f32";return b}k(b,a);b.ElementType="f32";return b}(g.BufferViewMat4Impl);f.BufferViewMat4f=a;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float64Array,
b,c,d,e)||this;b.elementType="f64";return b}k(b,a);b.ElementType="f64";return b}(g.BufferViewMat4Impl);f.BufferViewMat4f64=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d,e)||this;b.elementType="f64";return b}k(b,a);b.ElementType="f64";return b}(b.BufferViewScalarImpl);f.BufferViewFloat64=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d,e)||this;b.elementType="f64";return b}k(b,a);b.ElementType="f64";return b}(e.BufferViewVec2Impl);
f.BufferViewVec2f64=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d,e)||this;b.elementType="f64";return b}k(b,a);b.ElementType="f64";return b}(c.BufferViewVec3Impl);f.BufferViewVec3f64=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Float64Array,b,c,d,e)||this;b.elementType="f64";return b}k(b,a);b.ElementType="f64";return b}(d.BufferViewVec4Impl);f.BufferViewVec4f64=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint8Array,
b,c,d,e)||this;b.elementType="u8";return b}k(b,a);b.ElementType="u8";return b}(b.BufferViewScalarImpl);f.BufferViewUint8=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint8Array,b,c,d,e)||this;b.elementType="u8";return b}k(b,a);b.ElementType="u8";return b}(e.BufferViewVec2Impl);f.BufferViewVec2u8=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint8Array,b,c,d,e)||this;b.elementType="u8";return b}k(b,a);b.ElementType="u8";return b}(c.BufferViewVec3Impl);f.BufferViewVec3u8=
g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint8Array,b,c,d,e)||this;b.elementType="u8";return b}k(b,a);b.ElementType="u8";return b}(d.BufferViewVec4Impl);f.BufferViewVec4u8=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint16Array,b,c,d,e)||this;b.elementType="u16";return b}k(b,a);b.ElementType="u16";return b}(b.BufferViewScalarImpl);f.BufferViewUint16=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint16Array,b,c,d,e)||this;b.elementType=
"u16";return b}k(b,a);b.ElementType="u16";return b}(e.BufferViewVec2Impl);f.BufferViewVec2u16=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint16Array,b,c,d,e)||this;b.elementType="u16";return b}k(b,a);b.ElementType="u16";return b}(c.BufferViewVec3Impl);f.BufferViewVec3u16=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint16Array,b,c,d,e)||this;b.elementType="u16";return b}k(b,a);b.ElementType="u16";return b}(d.BufferViewVec4Impl);f.BufferViewVec4u16=g;
g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint32Array,b,c,d,e)||this;b.elementType="u32";return b}k(b,a);b.ElementType="u32";return b}(b.BufferViewScalarImpl);f.BufferViewUint32=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint32Array,b,c,d,e)||this;b.elementType="u32";return b}k(b,a);b.ElementType="u32";return b}(e.BufferViewVec2Impl);f.BufferViewVec2u32=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint32Array,b,c,d,e)||this;b.elementType=
"u32";return b}k(b,a);b.ElementType="u32";return b}(c.BufferViewVec3Impl);f.BufferViewVec3u32=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Uint32Array,b,c,d,e)||this;b.elementType="u32";return b}k(b,a);b.ElementType="u32";return b}(d.BufferViewVec4Impl);f.BufferViewVec4u32=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int8Array,b,c,d,e)||this;b.elementType="i8";return b}k(b,a);b.ElementType="i8";return b}(b.BufferViewScalarImpl);f.BufferViewInt8=g;g=function(a){function b(b,
c,d,e){void 0===c&&(c=0);b=a.call(this,Int8Array,b,c,d,e)||this;b.elementType="i8";return b}k(b,a);b.ElementType="i8";return b}(e.BufferViewVec2Impl);f.BufferViewVec2i8=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int8Array,b,c,d,e)||this;b.elementType="i8";return b}k(b,a);b.ElementType="i8";return b}(c.BufferViewVec3Impl);f.BufferViewVec3i8=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int8Array,b,c,d,e)||this;b.elementType="i8";return b}k(b,a);b.ElementType=
"i8";return b}(d.BufferViewVec4Impl);f.BufferViewVec4i8=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int16Array,b,c,d,e)||this;b.elementType="i16";return b}k(b,a);b.ElementType="i16";return b}(b.BufferViewScalarImpl);f.BufferViewInt16=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int16Array,b,c,d,e)||this;b.elementType="i16";return b}k(b,a);b.ElementType="i16";return b}(e.BufferViewVec2Impl);f.BufferViewVec2i16=g;g=function(a){function b(b,c,d,e){void 0===
c&&(c=0);b=a.call(this,Int16Array,b,c,d,e)||this;b.elementType="i16";return b}k(b,a);b.ElementType="i16";return b}(c.BufferViewVec3Impl);f.BufferViewVec3i16=g;g=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int16Array,b,c,d,e)||this;b.elementType="i16";return b}k(b,a);b.ElementType="i16";return b}(d.BufferViewVec4Impl);f.BufferViewVec4i16=g;b=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int32Array,b,c,d,e)||this;b.elementType="i32";return b}k(b,a);b.ElementType=
"i32";return b}(b.BufferViewScalarImpl);f.BufferViewInt32=b;e=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int32Array,b,c,d,e)||this;b.elementType="i32";return b}k(b,a);b.ElementType="i32";return b}(e.BufferViewVec2Impl);f.BufferViewVec2i32=e;c=function(a){function b(b,c,d,e){void 0===c&&(c=0);b=a.call(this,Int32Array,b,c,d,e)||this;b.elementType="i32";return b}k(b,a);b.ElementType="i32";return b}(c.BufferViewVec3Impl);f.BufferViewVec3i32=c;d=function(a){function b(b,c,d,e){void 0===
c&&(c=0);b=a.call(this,Int32Array,b,c,d,e)||this;b.elementType="i32";return b}k(b,a);b.ElementType="i32";return b}(d.BufferViewVec4Impl);f.BufferViewVec4i32=d})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function k(a,g,b,e,c){void 0===b&&(b=0);this.TypedArrayConstructor=a;this.elementCount=9;a=this.TypedArrayConstructor;void 0===e&&(e=9*a.BYTES_PER_ELEMENT);var d=0===g.byteLength?
0:b;this.typedBuffer=null==c?new a(g,d):new a(g,d,(c-b)/a.BYTES_PER_ELEMENT);this.typedBufferStride=e/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}k.prototype.getMat=function(a,g){a*=this.typedBufferStride;for(var b=0;9>b;b++)g[b]=this.typedBuffer[a+b];return g};k.prototype.setMat=function(a,g){a*=this.typedBufferStride;for(var b=0;9>b;b++)this.typedBuffer[a+b]=g[b]};k.prototype.get=
function(a,g){return this.typedBuffer[a*this.typedBufferStride+g]};k.prototype.set=function(a,g,b){this.typedBuffer[a*this.typedBufferStride+g]=b};k.prototype.copyFrom=function(a,g,b){var e=this.typedBuffer,c=g.typedBuffer;a*=this.typedBufferStride;g=b*g.typedBufferStride;for(b=0;9>b;++b)e[a+b]=c[g+b]};Object.defineProperty(k.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});k.ElementCount=9;return k}();f.BufferViewMat3Impl=p})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require",
"exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function k(a,g,b,e,c){void 0===b&&(b=0);this.TypedArrayConstructor=a;this.elementCount=16;a=this.TypedArrayConstructor;void 0===e&&(e=16*a.BYTES_PER_ELEMENT);var d=0===g.byteLength?0:b;this.typedBuffer=null==c?new a(g,d):new a(g,d,(c-b)/a.BYTES_PER_ELEMENT);this.typedBufferStride=e/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
k.prototype.getMat=function(a,g){a*=this.typedBufferStride;for(var b=0;16>b;b++)g[b]=this.typedBuffer[a+b];return g};k.prototype.setMat=function(a,g){a*=this.typedBufferStride;for(var b=0;16>b;b++)this.typedBuffer[a+b]=g[b]};k.prototype.get=function(a,g){return this.typedBuffer[a*this.typedBufferStride+g]};k.prototype.set=function(a,g,b){this.typedBuffer[a*this.typedBufferStride+g]=b};k.prototype.copyFrom=function(a,g,b){var e=this.typedBuffer,c=g.typedBuffer;a*=this.typedBufferStride;g=b*g.typedBufferStride;
for(b=0;16>b;++b)e[a+b]=c[g+b]};Object.defineProperty(k.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});k.ElementCount=16;return k}();f.BufferViewMat4Impl=p})},"esri/views/3d/support/buffer/internals/Scalar":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function k(a,g,b,e,c){void 0===b&&(b=0);this.TypedArrayConstructor=a;this.elementCount=1;a=this.TypedArrayConstructor;void 0===
e&&(e=a.BYTES_PER_ELEMENT);var d=0===g.byteLength?0:b;this.typedBuffer=null==c?new a(g,d):new a(g,d,(c-b)/a.BYTES_PER_ELEMENT);this.typedBufferStride=e/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}k.prototype.get=function(a){return this.typedBuffer[a*this.typedBufferStride]};k.prototype.set=function(a,g){this.typedBuffer[a*this.typedBufferStride]=g};Object.defineProperty(k.prototype,
"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});k.ElementCount=1;return k}();f.BufferViewScalarImpl=p})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/gl-matrix"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function a(a,b,e,c,d){void 0===e&&(e=0);this.TypedArrayConstructor=a;this.elementCount=2;a=this.TypedArrayConstructor;void 0===c&&(c=2*a.BYTES_PER_ELEMENT);
var g=0===b.byteLength?0:e;this.typedBuffer=null==d?new a(b,g):new a(b,g,(d-e)/a.BYTES_PER_ELEMENT);this.typedBufferStride=c/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,b){return k.vec2.set(b,this.typedBuffer[a*this.typedBufferStride],this.typedBuffer[a*this.typedBufferStride+1])};a.prototype.setVec=function(a,b){this.typedBuffer[a*this.typedBufferStride]=
b[0];this.typedBuffer[a*this.typedBufferStride+1]=b[1]};a.prototype.get=function(a,b){return this.typedBuffer[a*this.typedBufferStride+b]};a.prototype.set=function(a,b,e){this.typedBuffer[a*this.typedBufferStride+b]=e};a.prototype.copyFrom=function(a,b,e){var c=this.typedBuffer,d=b.typedBuffer;a*=this.typedBufferStride;b=e*b.typedBufferStride;c[a]=d[b];c[a+1]=d[b+1]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});a.ElementCount=
2;return a}();f.BufferViewVec2Impl=p})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/gl-matrix"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function a(a,b,e,c,d){void 0===e&&(e=0);this.TypedArrayConstructor=a;this.elementCount=3;a=this.TypedArrayConstructor;void 0===c&&(c=3*a.BYTES_PER_ELEMENT);var g=0===b.byteLength?0:e;this.typedBuffer=null==d?new a(b,g):new a(b,g,(d-e)/a.BYTES_PER_ELEMENT);
this.typedBufferStride=c/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,b){return k.vec3.set(b,this.typedBuffer[a*this.typedBufferStride],this.typedBuffer[a*this.typedBufferStride+1],this.typedBuffer[a*this.typedBufferStride+2])};a.prototype.setVec=function(a,b){this.typedBuffer[a*this.typedBufferStride]=b[0];this.typedBuffer[a*this.typedBufferStride+
1]=b[1];this.typedBuffer[a*this.typedBufferStride+2]=b[2]};a.prototype.get=function(a,b){return this.typedBuffer[a*this.typedBufferStride+b]};a.prototype.set=function(a,b,e){this.typedBuffer[a*this.typedBufferStride+b]=e};a.prototype.copyFrom=function(a,b,e){var c=this.typedBuffer,d=b.typedBuffer;a*=this.typedBufferStride;b=e*b.typedBufferStride;c[a]=d[b];c[a+1]=d[b+1];c[a+2]=d[b+2]};Object.defineProperty(a.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});
a.ElementCount=3;return a}();f.BufferViewVec3Impl=p})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/gl-matrix"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function a(a,b,e,c,d){void 0===e&&(e=0);this.TypedArrayConstructor=a;this.elementCount=4;a=this.TypedArrayConstructor;void 0===c&&(c=4*a.BYTES_PER_ELEMENT);var g=0===b.byteLength?0:e;this.typedBuffer=null==d?new a(b,g):new a(b,g,(d-e)/
a.BYTES_PER_ELEMENT);this.typedBufferStride=c/a.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,b){return k.vec4.set(b,this.typedBuffer[a*this.typedBufferStride],this.typedBuffer[a*this.typedBufferStride+1],this.typedBuffer[a*this.typedBufferStride+2],this.typedBuffer[a*this.typedBufferStride+3])};a.prototype.setVec=function(a,b){this.typedBuffer[a*this.typedBufferStride]=
b[0];this.typedBuffer[a*this.typedBufferStride+1]=b[1];this.typedBuffer[a*this.typedBufferStride+2]=b[2];this.typedBuffer[a*this.typedBufferStride+3]=b[3]};a.prototype.get=function(a,b){return this.typedBuffer[a*this.typedBufferStride+b]};a.prototype.set=function(a,b,e){this.typedBuffer[a*this.typedBufferStride+b]=e};a.prototype.copyFrom=function(a,b,e){var c=this.typedBuffer,d=b.typedBuffer;a*=this.typedBufferStride;b=e*b.typedBufferStride;c[a]=d[b];c[a+1]=d[b+1];c[a+2]=d[b+2];c[a+3]=d[b+3]};Object.defineProperty(a.prototype,
"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});a.ElementCount=4;return a}();f.BufferViewVec4Impl=p})},"esri/views/3d/support/buffer/types":function(){define(["require","exports","../../../../core/compilerUtils"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.elementTypeSize=function(a){switch(a){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8;
default:k.neverReached(a)}};f.isSigned=function(a){switch(a){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0;default:k.neverReached(a)}};f.isInteger=function(a){switch(a){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1;default:k.neverReached(a)}};f.maximumValue=function(a){switch(a){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;
case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308;default:k.neverReached(a)}}})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./Util".split(" "),function(p,f,k,a,g,b,e){var c=g.Vec3Compact,d;(function(a){for(var c=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],d=[0,
0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],h=[0,0,1,0,1,1,0,1],l=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],n=Array(36),m=0;6>m;m++)for(var g=0;6>g;g++)n[6*m+g]=m;for(var q=Array(36),m=0;6>m;m++)q[6*m+0]=0,q[6*m+1]=1,q[6*m+2]=2,q[6*m+3]=2,q[6*m+4]=3,q[6*m+5]=0;a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var m=new Float32Array(24),g=0;8>g;g++)m[3*g]=c[g][0]*a[0],m[3*g+1]=c[g][1]*a[1],m[3*g+2]=c[g][2]*a[2];a={};a[e.VertexAttrConstants.POSITION]=new Uint32Array(l);
a[e.VertexAttrConstants.NORMAL]=new Uint32Array(n);a[e.VertexAttrConstants.UV0]=new Uint32Array(q);g={};g[e.VertexAttrConstants.POSITION]={size:3,data:m};g[e.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(d)};g[e.VertexAttrConstants.UV0]={size:2,data:new Float32Array(h)};return new b(g,a)}})(d||(d={}));var m;(function(a){var c=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],d=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],h=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,
2,4,2,3,4,3,0],l=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var m=new Float32Array(18),g=0;6>g;g++)m[3*g]=c[g][0]*a[0],m[3*g+1]=c[g][1]*a[1],m[3*g+2]=c[g][2]*a[2];a={};a[e.VertexAttrConstants.POSITION]=new Uint32Array(h);a[e.VertexAttrConstants.NORMAL]=new Uint32Array(l);g={};g[e.VertexAttrConstants.POSITION]={size:3,data:m};g[e.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(d)};return new b(g,a)}})(m||(m={}));var l;
(function(a){var c=k.vec3f32.fromValues(-.5,0,-.5),d=k.vec3f32.fromValues(.5,0,-.5),h=k.vec3f32.fromValues(0,0,.5),l=k.vec3f32.fromValues(0,.5,0),g=k.vec3f32.create(),m=k.vec3f32.create(),n=k.vec3f32.create(),q=k.vec3f32.create(),t=k.vec3f32.create();k.vec3.subtract(g,c,l);k.vec3.subtract(m,c,d);k.vec3.cross(n,g,m);k.vec3.normalize(n,n);k.vec3.subtract(g,d,l);k.vec3.subtract(m,d,h);k.vec3.cross(q,g,m);k.vec3.normalize(q,q);k.vec3.subtract(g,h,l);k.vec3.subtract(m,h,c);k.vec3.cross(t,g,m);k.vec3.normalize(t,
t);var u=[c,d,h,l],f=[0,-1,0,n[0],n[1],n[2],q[0],q[1],q[2],t[0],t[1],t[2]],I=[0,1,2,3,1,0,3,2,1,3,0,2],N=[0,0,0,1,1,1,2,2,2,3,3,3];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var c=new Float32Array(12),d=0;4>d;d++)c[3*d]=u[d][0]*a[0],c[3*d+1]=u[d][1]*a[1],c[3*d+2]=u[d][2]*a[2];a={};a[e.VertexAttrConstants.POSITION]=new Uint32Array(I);a[e.VertexAttrConstants.NORMAL]=new Uint32Array(N);d={};d[e.VertexAttrConstants.POSITION]={size:3,data:c};d[e.VertexAttrConstants.NORMAL]={size:3,
data:new Float32Array(f)};return new b(d,a)}})(l||(l={}));var h;(function(h){function r(a,b,c,d,e){if(Math.abs(k.vec3.dot(b,a))>e)return!1;k.vec3.cross(c,a,b);k.vec3.normalize(c,c);k.vec3.cross(d,c,a);k.vec3.normalize(d,d);return!0}function u(a,b,c,d,e,h,l){return r(a,b,e,h,l)||r(a,c,e,h,l)||r(a,d,e,h,l)}h.createBoxGeometry=d.createGeometry;h.createDiamondGeometry=m.createGeometry;h.createTetrahedronGeometry=l.createGeometry;h.createSphereGeometry=function(a,c,d,h,l,g,m){a=a||50;h=void 0!==h?h:-Math.PI;
l=void 0!==l?l:2*Math.PI;g=void 0!==g?g:.5*-Math.PI;m=void 0!==m?m:Math.PI;var n=Math.max(3,Math.floor(c)||8),q=Math.max(2,Math.floor(d)||6),r=(n+1)*(q+1);d=new Float32Array(3*r);c=new Float32Array(3*r);for(var r=new Float32Array(2*r),t=[],u=0,k=0;k<=q;k++){for(var w=[],f=k/q,z=g+f*m,B=Math.cos(z),x=0;x<=n;x++){var y=x/n,C=h+y*l,D=Math.cos(C)*B,E=Math.sin(z),C=-Math.sin(C)*B;d[3*u]=D*a;d[3*u+1]=E*a;d[3*u+2]=C*a;c[3*u]=D;c[3*u+1]=E;c[3*u+2]=C;r[2*u]=y;r[2*u+1]=f;w.push(u);++u}t.push(w)}a=new Uint32Array(2*
n*(q-1)*3);for(k=u=0;k<q;k++)for(x=0;x<n;x++)h=t[k][x],l=t[k][x+1],g=t[k+1][x+1],m=t[k+1][x],0===k?(a[u++]=h,a[u++]=g,a[u++]=m):k===q-1?(a[u++]=h,a[u++]=l,a[u++]=g):(a[u++]=h,a[u++]=l,a[u++]=g,a[u++]=g,a[u++]=m,a[u++]=h);e.assert(u===a.length);n={};n[e.VertexAttrConstants.POSITION]=a;n[e.VertexAttrConstants.NORMAL]=a;n[e.VertexAttrConstants.UV0]=a;q={};q[e.VertexAttrConstants.POSITION]={size:3,data:d};q[e.VertexAttrConstants.NORMAL]={size:3,data:c};q[e.VertexAttrConstants.UV0]={size:2,data:r};return new b(q,
n)};h.createPolySphereGeometry=function(a,d,h){function l(b,d){b>d&&(d=[d,b],b=d[0],d=d[1]);var e=b.toString()+"."+d.toString();if(n[e])return n[e];var h=g.length;g.length+=3;c.add(g,3*b,g,3*d,g,h);c.scale(g,h,a/c.length(g,h));h/=3;return n[e]=h}var g;h?(g=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],h=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(h=a*(1+Math.sqrt(5))/2,g=[-a,h,0,a,h,0,-a,-h,0,a,-h,0,0,-a,h,0,a,h,0,-a,-h,0,a,-h,h,0,-a,h,0,a,-h,0,-a,-h,0,a],h=new Uint32Array([0,
11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var m=0;m<g.length;m+=3)c.scale(g,m,a/c.length(g,m));for(var n={},m=0;m<d;m++){for(var q=h.length,r=new Uint32Array(4*q),t=0;t<q;t+=3){var u=h[t],k=h[t+1],w=h[t+2],f=l(u,k),z=l(k,w),x=l(w,u),y=4*t;r[y]=u;r[y+1]=f;r[y+2]=x;r[y+3]=k;r[y+4]=z;r[y+5]=f;r[y+6]=w;r[y+7]=x;r[y+8]=z;r[y+9]=f;r[y+10]=z;r[y+11]=x}h=r;n={}}d=new Float32Array(g);for(m=0;m<d.length;m+=3)c.normalize(d,
m);m={};m[e.VertexAttrConstants.POSITION]=h;m[e.VertexAttrConstants.NORMAL]=h;h={};h[e.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(g)};h[e.VertexAttrConstants.NORMAL]={size:3,data:d};return new b(h,m)};h.createPointGeometry=function(a,c,d,h,l,g,m){c=c?new Float32Array([c[0],c[1],c[2]]):new Float32Array([0,0,0]);a=a?new Float32Array([a[0],a[1],a[2]]):new Float32Array([0,0,1]);g=g?new Float32Array(g):new Float32Array([0,0]);var n=d?new Uint8Array([255*d[0],255*d[1],255*d[2],3<d.length?
255*d[3]:255]):new Uint8Array([255,255,255,255]),q=null!=h&&2===h.length?new Float32Array(h):new Float32Array([1,1]);h=new Uint32Array([0]);d={};d[e.VertexAttrConstants.POSITION]=h;d[e.VertexAttrConstants.NORMAL]=h;d[e.VertexAttrConstants.UV0]=h;d[e.VertexAttrConstants.COLOR]=h;d[e.VertexAttrConstants.SIZE]=h;var r={};r[e.VertexAttrConstants.POSITION]={size:3,data:c};r[e.VertexAttrConstants.NORMAL]={size:3,data:a};r[e.VertexAttrConstants.UV0]={size:g.length,data:g};r[e.VertexAttrConstants.COLOR]=
{size:4,data:n};r[e.VertexAttrConstants.SIZE]={size:2,data:q};null!=l&&(l=new Float32Array([l[0],l[1],l[2],l[3]]),d[e.VertexAttrConstants.AUXPOS1]=h,r[e.VertexAttrConstants.AUXPOS1]={size:4,data:l});null!=m&&(m=new Float32Array([m[0],m[1],m[2],m[3]]),d[e.VertexAttrConstants.AUXPOS2]=h,r[e.VertexAttrConstants.AUXPOS2]={size:4,data:m});return new b(r,d,b.DefaultOffsets,"point")};h.createPointArrayGeometry=function(a,c){for(var d=new Float32Array(3*a.length),h=new Float32Array(c?3*a.length:3),l=new Uint32Array(a.length),
g=new Uint32Array(a.length),m=0;m<a.length;m++)d[3*m]=a[m][0],d[3*m+1]=a[m][1],d[3*m+2]=a[m][2],c&&(h[3*m]=c[m][0],h[3*m+1]=c[m][1],h[3*m+2]=c[m][2]),l[m]=m,g[m]=0;c||(h[0]=0,h[1]=1,h[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;m={};m[e.VertexAttrConstants.POSITION]=l;m[e.VertexAttrConstants.NORMAL]=c?l:g;m[e.VertexAttrConstants.UV0]=g;c={};c[e.VertexAttrConstants.POSITION]={size:3,data:d};c[e.VertexAttrConstants.NORMAL]={size:3,data:h};c[e.VertexAttrConstants.UV0]={size:2,data:a};return new b(c,m,
b.DefaultOffsets,"point")};h.createTriangleGeometry=function(){var a=new Float32Array([0,0,0,0,0,100,100,0,0]),c=new Uint32Array([0,1,2]),d=new Float32Array([0,1,0]),h=new Uint32Array([0,0,0]),l=new Float32Array([0,0]),m=new Uint32Array([0,0,0]),g={};g[e.VertexAttrConstants.POSITION]=c;g[e.VertexAttrConstants.NORMAL]=h;g[e.VertexAttrConstants.UV0]=m;c={};c[e.VertexAttrConstants.POSITION]={size:3,data:a};c[e.VertexAttrConstants.NORMAL]={size:3,data:d};c[e.VertexAttrConstants.UV0]={size:2,data:l};return new b(c,
g)};h.createSquareGeometry=function(a){var c=new Float32Array(12);if(a)for(var d=0;4>d;d++)for(var h=0;3>h;h++)c[3*d+h]=a[d][h];else c[0]=-1,c[1]=-1,c[2]=0,c[3]=1,c[4]=-1,c[5]=0,c[6]=1,c[7]=1,c[8]=0,c[9]=-1,c[10]=1,c[11]=0;var l=new Uint32Array([0,1,2,2,3,0]);a=new Float32Array([0,0,1]);var m=new Uint32Array([0,0,0,0,0,0]),d=new Float32Array([0,0,1,0,1,1,0,1]),h=new Uint8Array([255,255,255,255]),g={};g[e.VertexAttrConstants.POSITION]=l;g[e.VertexAttrConstants.NORMAL]=m;g[e.VertexAttrConstants.UV0]=
l;g[e.VertexAttrConstants.COLOR]=m;l={};l[e.VertexAttrConstants.POSITION]={size:3,data:c};l[e.VertexAttrConstants.NORMAL]={size:3,data:a};l[e.VertexAttrConstants.UV0]={size:2,data:d};l[e.VertexAttrConstants.COLOR]={size:4,data:h};return new b(l,g)};h.createConeGeometry=function(a,c,d,h,l,m){void 0===l&&(l=!0);void 0===m&&(m=!0);var g=0,n=k.vec3f32.fromValues(0,g,0),q=k.vec3f32.fromValues(0,g+a,0),r=k.vec3f32.fromValues(0,-1,0),t=k.vec3f32.fromValues(0,1,0);h&&(g=a,q=k.vec3f32.fromValues(0,0,0),n=
k.vec3f32.fromValues(0,g,0),r=k.vec3f32.fromValues(0,1,0),t=k.vec3f32.fromValues(0,-1,0));n=[q,n];r=[r,t];t=d+2;q=Math.sqrt(a*a+c*c);if(h)for(h=d-1;0<=h;h--)u=2*Math.PI/d*h,w=k.vec3f32.fromValues(Math.cos(u)*c,g,Math.sin(u)*c),n.push(w),u=k.vec3f32.fromValues(a*Math.cos(u)/q,-c/q,a*Math.sin(u)/q),r.push(u);else for(h=0;h<d;h++){var u=2*Math.PI/d*h,w=k.vec3f32.fromValues(Math.cos(u)*c,g,Math.sin(u)*c);n.push(w);u=k.vec3f32.fromValues(a*Math.cos(u)/q,c/q,a*Math.sin(u)/q);r.push(u)}a=new Uint32Array(6*
(d+2));d=new Uint32Array(6*(d+2));g=c=0;if(l){for(h=3;h<n.length;h++)a[c++]=1,a[c++]=h-1,a[c++]=h,d[g++]=0,d[g++]=0,d[g++]=0;a[c++]=n.length-1;a[c++]=2;a[c++]=1;d[g++]=0;d[g++]=0;d[g++]=0}if(m){for(h=3;h<n.length;h++)a[c++]=h,a[c++]=h-1,a[c++]=0,d[g++]=h,d[g++]=h-1,d[g++]=1;a[c++]=0;a[c++]=2;a[c++]=n.length-1;d[g++]=1;d[g++]=2;d[g++]=r.length-1}l=new Float32Array(3*t);for(h=0;h<t;h++)l[3*h]=n[h][0],l[3*h+1]=n[h][1],l[3*h+2]=n[h][2];m=new Float32Array(3*t);for(h=0;h<t;h++)m[3*h]=r[h][0],m[3*h+1]=r[h][1],
m[3*h+2]=r[h][2];n={};n[e.VertexAttrConstants.POSITION]=a;n[e.VertexAttrConstants.NORMAL]=d;r={};r[e.VertexAttrConstants.POSITION]={size:3,data:l};r[e.VertexAttrConstants.NORMAL]={size:3,data:m};return new b(r,n)};h.createCylinderGeometry=function(a,c,d,h,l,g){h=h?k.vec3f32.clone(h):k.vec3f32.fromValues(1,0,0);l=l?k.vec3f32.clone(l):k.vec3f32.fromValues(0,0,0);g=void 0===g?!0:g;var m=k.vec3f32.create();k.vec3.normalize(m,h);h=k.vec3f32.create();k.vec3.scale(h,m,Math.abs(a));var n=k.vec3f32.create();
k.vec3.scale(n,h,-.5);k.vec3.add(n,n,l);var q=k.vec3f32.fromValues(0,1,0);.2>Math.abs(1-k.vec3.dot(m,q))&&k.vec3.set(q,0,0,1);var r=k.vec3f32.create();k.vec3.cross(r,m,q);k.vec3.normalize(r,r);k.vec3.cross(q,r,m);var t=2*d+(g?2:0),u=d+(g?2:0);a=new Float32Array(3*t);l=new Float32Array(3*u);var w=new Float32Array(2*t),f=new Uint32Array(3*d*(g?4:2)),z=new Uint32Array(3*d*(g?4:2));g&&(a[3*(t-2)+0]=n[0],a[3*(t-2)+1]=n[1],a[3*(t-2)+2]=n[2],w[2*(t-2)]=0,w[2*(t-2)+1]=0,a[3*(t-1)+0]=a[3*(t-2)+0]+h[0],a[3*
(t-1)+1]=a[3*(t-2)+1]+h[1],a[3*(t-1)+2]=a[3*(t-2)+2]+h[2],w[2*(t-1)]=1,w[2*(t-1)+1]=1,l[3*(u-2)+0]=-m[0],l[3*(u-2)+1]=-m[1],l[3*(u-2)+2]=-m[2],l[3*(u-1)+0]=m[0],l[3*(u-1)+1]=m[1],l[3*(u-1)+2]=m[2]);for(var m=function(a,b,c){f[a]=b;z[a]=c},x=0,B=k.vec3f32.create(),y=k.vec3f32.create(),C=0;C<d;C++){var D=2*Math.PI/d*C;k.vec3.scale(B,q,Math.sin(D));k.vec3.scale(y,r,Math.cos(D));k.vec3.add(B,B,y);l[3*C+0]=B[0];l[3*C+1]=B[1];l[3*C+2]=B[2];k.vec3.scale(B,B,c);k.vec3.add(B,B,n);a[3*C+0]=B[0];a[3*C+1]=B[1];
a[3*C+2]=B[2];w[2*C+0]=C/d;w[2*C+1]=0;a[3*(C+d)+0]=a[3*C+0]+h[0];a[3*(C+d)+1]=a[3*C+1]+h[1];a[3*(C+d)+2]=a[3*C+2]+h[2];w[2*(C+d)+0]=C/d;w[2*C+1]=1;D=(C+1)%d;m(x++,C,C);m(x++,C+d,C);m(x++,D,D);m(x++,D,D);m(x++,C+d,C);m(x++,D+d,D)}if(g){for(C=0;C<d;C++)D=(C+1)%d,m(x++,t-2,u-2),m(x++,C,u-2),m(x++,D,u-2);for(C=0;C<d;C++)D=(C+1)%d,m(x++,C+d,u-1),m(x++,t-1,u-1),m(x++,D+d,u-1)}c={};c[e.VertexAttrConstants.POSITION]=f;c[e.VertexAttrConstants.NORMAL]=z;c[e.VertexAttrConstants.UV0]=f;d={};d[e.VertexAttrConstants.POSITION]=
{size:3,data:a};d[e.VertexAttrConstants.NORMAL]={size:3,data:l};d[e.VertexAttrConstants.UV0]={size:2,data:w};return new b(d,c)};h.createTubeGeometry=function(a,b,c,d,l){c=c||10;d=null!=d?d:!0;e.assert(1<a.length);for(var m=[],g=[],n=0;n<c;n++){m.push([0,-n-1,-((n+1)%c)-1]);var q=n/c*2*Math.PI;g.push([Math.cos(q)*b,Math.sin(q)*b])}return h.createPathExtrusionGeometry(g,a,[[0,0,0]],m,d,l)};h.createPathExtrusionGeometry=function(c,d,h,l,m,g){void 0===g&&(g=k.vec3f32.fromValues(0,0,0));var q=c.length,
r=new Float32Array(d.length*q*3+(6*h.length||0)),t=new Float32Array(d.length*q+(2*h.length||0)),w=new Float32Array(d.length*q*3+(h?6:0)),f=(d.length-1)*q*6+6*l.length,z=new Uint32Array(f),f=new Uint32Array(f),x=0,y=0,B=0,C=0,D=0,J=k.vec3f32.create(),F=k.vec3f32.create(),K=k.vec3f32.create(),L=k.vec3f32.create(),T=k.vec3f32.create(),R=k.vec3f32.create(),X=k.vec3f32.create(),ba=k.vec3f64.create(),ca=k.vec3f32.create(),Z=k.vec3f32.create(),da=k.vec3f32.create(),p=k.vec3f32.create(),ia=k.vec3f32.create(),
ea=a.plane.create();k.vec3.set(ca,0,1,0);k.vec3.subtract(F,d[1],d[0]);k.vec3.normalize(F,F);m?(k.vec3.add(ba,d[0],g),k.vec3.normalize(K,ba)):k.vec3.set(K,0,0,1);u(F,K,ca,ca,T,K,n);k.vec3.copy(L,K);k.vec3.copy(p,T);for(var aa=0;aa<h.length;aa++)k.vec3.scale(R,T,h[aa][0]),k.vec3.scale(ba,K,h[aa][2]),k.vec3.add(R,R,ba),k.vec3.add(R,R,d[0]),r[x++]=R[0],r[x++]=R[1],r[x++]=R[2],t[B++]=0;w[y++]=-F[0];w[y++]=-F[1];w[y++]=-F[2];for(aa=0;aa<l.length;aa++)z[C++]=0<l[aa][0]?l[aa][0]:-l[aa][0]-1+h.length,z[C++]=
0<l[aa][1]?l[aa][1]:-l[aa][1]-1+h.length,z[C++]=0<l[aa][2]?l[aa][2]:-l[aa][2]-1+h.length,f[D++]=0,f[D++]=0,f[D++]=0;for(var ga=h.length,aa=h.length-1,fa=0;fa<d.length;fa++){var ja=!1;0<fa&&(k.vec3.copy(J,F),fa<d.length-1?(k.vec3.subtract(F,d[fa+1],d[fa]),k.vec3.normalize(F,F)):ja=!0,k.vec3.add(Z,J,F),k.vec3.normalize(Z,Z),k.vec3.add(da,d[fa-1],L),a.plane.fromPositionAndNormal(d[fa],Z,ea),a.plane.intersectRay(ea,a.ray.wrap(da,J),ba)?(k.vec3.subtract(ba,ba,d[fa]),k.vec3.normalize(K,ba),k.vec3.cross(T,
Z,K),k.vec3.normalize(T,T)):u(Z,L,p,ca,T,K,n),k.vec3.copy(L,K),k.vec3.copy(p,T));m&&(k.vec3.add(ba,d[fa],g),k.vec3.normalize(ia,ba));for(var V=0;V<q;V++)if(k.vec3.scale(R,T,c[V][0]),k.vec3.scale(ba,K,c[V][1]),k.vec3.add(R,R,ba),k.vec3.normalize(X,R),w[y++]=X[0],w[y++]=X[1],w[y++]=X[2],m?t[B++]=k.vec3.dot(R,ia):t[B++]=R[2],k.vec3.add(R,R,d[fa]),r[x++]=R[0],r[x++]=R[1],r[x++]=R[2],!ja){var ha=(V+1)%q;z[C++]=ga+V;z[C++]=ga+q+V;z[C++]=ga+ha;z[C++]=ga+ha;z[C++]=ga+q+V;z[C++]=ga+q+ha;for(ha=0;6>ha;ha++)f[D++]=
z[C-6+ha]-aa}ga+=q}c=d[d.length-1];for(aa=0;aa<h.length;aa++)k.vec3.scale(R,T,h[aa][0]),k.vec3.scale(ba,K,h[aa][1]),k.vec3.add(R,R,ba),k.vec3.add(R,R,c),r[x++]=R[0],r[x++]=R[1],r[x++]=R[2],t[B++]=0;h=y/3;w[y++]=F[0];w[y++]=F[1];w[y++]=F[2];q=ga-q;for(aa=0;aa<l.length;aa++)z[C++]=0<=l[aa][0]?ga+l[aa][0]:-l[aa][0]-1+q,z[C++]=0<=l[aa][2]?ga+l[aa][2]:-l[aa][2]-1+q,z[C++]=0<=l[aa][1]?ga+l[aa][1]:-l[aa][1]-1+q,f[D++]=h,f[D++]=h,f[D++]=h;l={};l[e.VertexAttrConstants.POSITION]=z;l[e.VertexAttrConstants.NORMAL]=
f;z={};z[e.VertexAttrConstants.POSITION]={size:3,data:r};z.zOffset={size:1,data:t};z[e.VertexAttrConstants.NORMAL]={size:3,data:w};return new b(z,l)};h.createPolylineGeometry=function(a,c){e.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");e.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");e.assert(void 0===c||c.length===a.length,"createPolylineGeometry: need same number of points and normals");e.assert(void 0===c||3===c[0].length,"createPolylineGeometry(): malformed normal");
for(var d=new Float32Array(3*a.length),h=new Uint32Array(2*(a.length-1)),l=0,m=0,g=0;g<a.length;g++){for(var n=0;3>n;n++)d[l++]=a[g][n];0<g&&(h[m++]=g-1,h[m++]=g)}l={};m={};l[e.VertexAttrConstants.POSITION]=h;m[e.VertexAttrConstants.POSITION]={size:3,data:d};if(c){for(var d=new Float32Array(3*c.length),q=0,g=0;g<a.length;g++)for(n=0;3>n;n++)d[q++]=c[g][n];l[e.VertexAttrConstants.NORMAL]=h;m[e.VertexAttrConstants.NORMAL]={size:3,data:d}}return new b(m,l,b.DefaultOffsets,"line")};h.addVertexColors=
function(a,c){var d=c||[1,1,1,1];c=new Uint8Array(4);c[0]=255*d[0];c[1]=255*d[1];c[2]=255*d[2];c[3]=255*(3<d.length?d[3]:1);var d={},h=a.getVertexAttr(),l;for(l in h)d[l]=h[l];d[e.VertexAttrConstants.COLOR]={size:4,data:c};c={};for(l in a.indices)c[l]=a.indices[l];c[e.VertexAttrConstants.COLOR]=new Uint32Array(c[e.VertexAttrConstants.POSITION].length);return a=new b(d,c,a.componentOffsets,a.primitiveType)};h.addNormals=function(a){var b=a.getVertexAttr();a=a.indices;for(var c=g.Vec3Compact.subtract,
d=new Float32Array(a.position.length/3*3),h=b.position.data,l=0,m=a.position,n=new Uint32Array(m.length),r=0;r<m.length;r+=3){c(h,3*m[r],h,3*m[r+2],t,0);c(h,3*m[r],h,3*m[r+1],q,0);k.vec3.cross(q,q,t);k.vec3.normalize(q,q);var u=l/3;d[l++]=q[0];d[l++]=q[1];d[l++]=q[2];n[r]=u;n[r+1]=u;n[r+2]=u}b[e.VertexAttrConstants.NORMAL]={size:3,data:d,offsetIdx:0,strideIdx:3};a[e.VertexAttrConstants.NORMAL]=n};h.cgToGIS=function(a,b){void 0===b&&(b=a);var c=a.getVertexAttr();a=c.position.data;var c=c.normal.data,
d=b.getVertexAttr(),e=d.position.data,d=d.normal.data;if(c)for(var h=0;h<c.length;h+=3){var l=c[h+1];d[h+1]=-c[h+2];d[h+2]=l}if(a)for(h=0;h<a.length;h+=3)l=a[h+1],e[h+1]=-a[h+2],e[h+2]=l;return b};h.makeOrthoBasisDirUp=r;h.makeOrthoBasisDirUpFallback=u})(h||(h={}));var n=.99619469809,q=k.vec3f32.create(),t=k.vec3f32.create();return h})},"esri/views/3d/support/geometryUtils":function(){define("require exports ./geometryUtils/axisAngle ./geometryUtils/boundedPlane ./geometryUtils/frustum ./geometryUtils/lineSegment ./geometryUtils/plane ./geometryUtils/ray ./geometryUtils/sphere ./geometryUtils/triangle ./geometryUtils/vector".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){Object.defineProperty(f,"__esModule",{value:!0});f.plane=e;f.boundedPlane=a;f.triangle=m;f.lineSegment=b;f.ray=c;f.sphere=d;f.frustum=g;f.vector=l;f.axisAngle=k})},"esri/views/3d/support/geometryUtils/axisAngle":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../stack","./vector"],function(p,f,k,a,g){function b(a){void 0===a&&(a=f.UP);return[a[0],a[1],a[2],a[3]]}function e(a,d,e,l,h){void 0===h&&(h=b());h[0]=a;h[1]=d;h[2]=e;h[3]=
l;return h}Object.defineProperty(f,"__esModule",{value:!0});f.create=b;f.wrap=function(b,d,m,l){return e(b,d,m,l,a.sv4d.get())};f.wrapAxisAngle=function(b,d){return e(b[0],b[1],b[2],d,a.sv4d.get())};f.copy=function(a,d){void 0===d&&(d=b());return e(a[0],a[1],a[2],a[3],d)};f.fromValues=e;f.fromAxisAndAngle=function(a,d,e){void 0===e&&(e=b());k.vec3.copy(e,a);e[3]=d;return e};f.fromPoints=function(a,d,e){void 0===e&&(e=b());k.vec3.cross(e,a,d);k.vec3.normalize(e,e);e[3]=g.angle(a,d);return e};f.UP=
[0,0,1,0]})},"esri/views/3d/support/stack":function(){define(["require","exports","../../../core/VectorStack"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.sv2d=k.VectorStack.createVec2f64();f.sv3d=k.VectorStack.createVec3f64();f.sv4d=k.VectorStack.createVec4f64();f.sm4d=k.VectorStack.createMat4f64();f.sq4d=k.VectorStack.createQuatf64()})},"esri/core/VectorStack":function(){define(["require","exports","./nextTick","./libs/gl-matrix-2/gl-matrix"],function(p,f,k,a){Object.defineProperty(f,
"__esModule",{value:!0});p=function(){function b(a,b,d){var c=this;this.itemByteSize=a;this.itemCreate=b;this.bufferPtr=0;this.items=[];this.itemsPtr=0;a=Math.ceil(d/this.itemByteSize);this.buffer=new ArrayBuffer(a*this.itemByteSize);this.tickHandle=k.before(function(){return c.reset()});for(b=0;b<a;b++)this.create();this.reset()}b.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null)};b.prototype.get=function(){0===this.itemsPtr&&k(function(){});if(this.itemsPtr<
this.items.length)return this.items[this.itemsPtr++];this.growIfNeeded();return this.create()};b.prototype.reset=function(){this.itemsPtr=0};b.prototype.create=function(){var a=this.itemCreate(this.buffer,this.bufferPtr);this.bufferPtr+=this.itemByteSize;this.items.push(a);this.itemsPtr++;return a};b.prototype.growIfNeeded=function(){if(this.bufferPtr+this.itemByteSize>this.buffer.byteLength){var a=new ArrayBuffer(2*this.buffer.byteLength);(new Uint8Array(a)).set(new Uint8Array(this.buffer));this.buffer=
a}};b.createVec2f64=function(e){void 0===e&&(e=g);return new b(16,a.vec2f64.createView,e)};b.createVec3f64=function(e){void 0===e&&(e=g);return new b(24,a.vec3f64.createView,e)};b.createVec4f64=function(e){void 0===e&&(e=g);return new b(32,a.vec4f64.createView,e)};b.createMat3f64=function(e){void 0===e&&(e=g);return new b(72,a.mat3f64.createView,e)};b.createMat4f64=function(e){void 0===e&&(e=g);return new b(128,a.mat4f64.createView,e)};b.createQuatf64=function(e){void 0===e&&(e=g);return new b(32,
a.quatf64.createView,e)};return b}();f.VectorStack=p;var g=4096;f.default=p})},"esri/views/3d/support/geometryUtils/vector":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../mathUtils"],function(p,f,k,a){function g(a,e){return k.vec3.dot(a,e)/k.vec3.length(a)}Object.defineProperty(f,"__esModule",{value:!0});f.projectPoint=function(a,e,c){e=g(a,e);return k.vec3.scale(c,a,e)};f.projectPointSignedLength=g;f.angle=function(b,e){b=k.vec3.dot(b,e)/(k.vec3.length(b)*
k.vec3.length(e));return-a.acos(b)}})},"esri/views/3d/support/geometryUtils/boundedPlane":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/gl-matrix ../mathUtils ../stack ./lineSegment ./plane ./ray ./vector".split(" "),function(p,f,k,a,g,b,e,c,d,m,l,h){function n(a){void 0===a&&(a=f.UP);return{plane:m.create(a.plane),origin:b.vec3f64.clone(a.origin),basis1:b.vec3f64.clone(a.basis1),basis2:b.vec3f64.clone(a.basis2)}}
function q(a,b){void 0===b&&(b=n());return t(a.origin,a.basis1,a.basis2,b)}function t(a,c,d,e){void 0===e&&(e=n());b.vec3.copy(e.origin,a);b.vec3.copy(e.basis1,c);b.vec3.copy(e.basis2,d);m.fromVectorsAndPoint(d,c,a,e.plane);a=e;1E-6<Math.abs(b.vec3.dot(a.basis1,a.basis2)/(b.vec3.length(a.basis1)*b.vec3.length(a.basis2)))&&I.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(b.vec3.dot(a.basis1,a.plane))&&I.warn("fromValues()","Basis vectors and plane normal are not perpendicular");
1E-6<Math.abs(-b.vec3.dot(a.plane,a.origin)-a.plane[3])&&I.warn("fromValues()","Plane offset is not consistent with plane origin");return e}function u(a,d,e){a!==e&&q(a,e);a=b.vec3.scale(c.sv3d.get(),a.plane,d);b.vec3.add(e.origin,e.origin,a);e.plane[3]-=d;return e}function r(a,c){void 0===c&&(c=n());var d=(a[2]-a[0])/2,e=(a[3]-a[1])/2;b.vec3.set(c.origin,a[0]+d,a[1]+e,0);b.vec3.set(c.basis1,d,0,0);b.vec3.set(c.basis2,0,e,0);m.fromValues(0,0,1,0,c.plane);return c}function y(a,b,c){return m.intersectRay(a.plane,
b,c)?D(a,c):!1}function x(a,d,h){var l=N.get(),g=N.get();H(a,d,l,g);for(var g=Number.POSITIVE_INFINITY,n=0,q=P;n<q.length;n++){var r=G(a,q[n],S.get()),t=c.sv3d.get();m.intersectLineSegment(l,r,t)&&(r=e.directionFromTo(c.sv3d.get(),d.origin,t),r=Math.abs(e.acos(b.vec3.dot(d.direction,r))),r<g&&(g=r,b.vec3.copy(h,t)))}return g===Number.POSITIVE_INFINITY?z(a,d,h):h}function z(a,d,e){if(y(a,d,e))return e;var h=N.get(),g=N.get();H(a,d,h,g);for(var n=Number.POSITIVE_INFINITY,q=0,r=P;q<r.length;q++){var t=
G(a,r[q],S.get()),u=c.sv3d.get();m.intersectLineSegmentClamp(h,t,u)&&(t=l.distance2(d,u),m.isPointInside(g,u)&&t<n&&(n=t,b.vec3.copy(e,u)))}B(a,d.origin)<n&&b.vec3.copy(e,d.origin);return e}function w(a,d,e){var l=a.origin,g=a.basis1,m=a.basis2;d=b.vec3.subtract(c.sv3d.get(),d,l);g=h.projectPointSignedLength(g,d)/b.vec3.length(g);m=h.projectPointSignedLength(m,d)/b.vec3.length(m);a=h.projectPointSignedLength(a.plane,d);return b.vec3.set(e,g,m,a)}function B(a,d){d=w(a,d,c.sv3d.get());var e=a.basis2;
a=b.vec3.length(a.basis1);e=b.vec3.length(e);a=Math.max(Math.abs(d[0])-a,0);e=Math.max(Math.abs(d[1])-e,0);d=d[2];return a*a+e*e+d*d}function C(a,b){var c=-a.plane[3];return h.projectPointSignedLength(a.plane,b)-c}function D(a,d){var e=b.vec3.subtract(c.sv3d.get(),d,a.origin);d=b.vec3.squaredLength(a.basis1);var h=b.vec3.squaredLength(a.basis2),l=b.vec3.dot(a.basis1,e);a=b.vec3.dot(a.basis2,e);return 0>-l-d&&0>l-d&&0>-a-h&&0>a-h}function E(a,c){var d=S.get();b.vec3.copy(d.origin,a.origin);b.vec3.copy(d.vector,
c);return d}function G(a,d,e){var h=a.basis1,l=a.basis2;a=a.origin;var g=b.vec3.scale(c.sv3d.get(),h,d.origin[0]),m=b.vec3.scale(c.sv3d.get(),l,d.origin[1]);b.vec3.add(e.origin,g,m);b.vec3.add(e.origin,e.origin,a);h=b.vec3.scale(c.sv3d.get(),h,d.direction[0]);d=b.vec3.scale(c.sv3d.get(),l,d.direction[1]);b.vec3.scale(e.vector,b.vec3.add(h,h,d),2);return e}function H(a,b,c,d){a=a.plane;m.fromVectorsAndPoint(a,b.direction,b.origin,c);m.fromVectorsAndPoint(c,a,b.origin,d)}Object.defineProperty(f,"__esModule",
{value:!0});var I=a.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");p=function(){return function(){this.plane=m.create();this.origin=b.vec3f64.create();this.basis1=b.vec3f64.create();this.basis2=b.vec3f64.create()}}();f.BoundedPlaneClass=p;f.create=n;f.wrap=function(a,b,c){var d=M.get();d.origin=a;d.basis1=b;d.basis2=c;d.plane=m.fromVectorsAndPoint(c,b,a,m.wrap(0,0,0,0));return d};f.copy=q;f.fromValues=t;f.elevate=u;f.setExtent=function(a,b,c){r(b,c);u(c,C(a,a.origin),c);return c};f.fromAABoundingRect=
r;f.intersectRay=y;f.intersectRayClosestSilhouette=function(a,d,e){if(y(a,d,e))return e;a=x(a,d,c.sv3d.get());b.vec3.add(e,d.origin,b.vec3.scale(c.sv3d.get(),d.direction,b.vec3.distance(d.origin,a)/b.vec3.length(d.direction)));return e};f.closestPointOnSilhouette=x;f.closestPoint=z;f.projectPoint=function(a,e,h){var l=m.projectPoint(a.plane,e,c.sv3d.get());e=d.projectPointClamp(E(a,a.basis1),l,-1,1,c.sv3d.get());l=d.projectPointClamp(E(a,a.basis2),l,-1,1,c.sv3d.get());b.vec3.subtract(h,b.vec3.add(c.sv3d.get(),
e,l),a.origin);return h};f.projectPointLocal=w;f.distance2=B;f.distance=function(a,b){return Math.sqrt(B(a,b))};f.distanceToSilhouette=function(a,b){for(var c=Number.NEGATIVE_INFINITY,e=0,h=P;e<h.length;e++){var l=G(a,h[e],S.get()),l=d.distance2(l,b);l>c&&(c=l)}return Math.sqrt(c)};f.extrusionContainsPoint=function(a,b){return m.isPointInside(a.plane,b)&&D(a,b)};f.axisAt=function(a,c,d,e){switch(d){case 0:b.vec3.copy(e,a.basis1);b.vec3.normalize(e,e);break;case 1:b.vec3.copy(e,a.basis2);b.vec3.normalize(e,
e);break;case 2:b.vec3.copy(e,a.plane);break;default:k.neverReached(d)}return e};f.altitudeAt=C;f.setAltitudeAt=function(a,d,e,h){var l=C(a,d);a=b.vec3.scale(c.sv3d.get(),a.plane,e-l);b.vec3.add(h,d,a);return h};f.transform=function(a,c,d){a!==d&&q(a,d);b.mat4.invert(O,c);b.mat4.transpose(O,O);b.vec3.transformMat4(d.basis1,a.basis1,O);b.vec3.transformMat4(d.basis2,a.basis2,O);b.vec3.transformMat4(d.plane,a.plane,O);b.vec3.transformMat4(d.origin,a.origin,c);m.setOffsetFromPoint(d.plane,d.origin,d.plane);
return d};f.UP={plane:m.create(),origin:b.vec3f64.fromValues(0,0,0),basis1:b.vec3f64.fromValues(1,0,0),basis2:b.vec3f64.fromValues(0,1,0)};var N=new g.ObjectStack(m.create),S=new g.ObjectStack(d.create),M=new g.ObjectStack(function(){return{origin:null,basis1:null,basis2:null,plane:null}}),P=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],O=b.mat4f64.create()})},"esri/core/ObjectStack":function(){define(["require",
"exports","./nextTick"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function g(a,e){void 0===e&&(e=8);var b=this;this.allocator=a;this.items=[];this.itemsPtr=0;this.tickHandle=k.before(function(){return b.reset()});this.grow(e)}g.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null)};g.prototype.get=function(){0===this.itemsPtr&&k(function(){});this.itemsPtr===this.items.length&&this.grow();return this.items[this.itemsPtr++]};
g.prototype.reset=function(){this.itemsPtr=0};g.prototype.grow=function(b){void 0===b&&(b=this.items.length);for(var e=0;e<Math.max(8,Math.min(b,a));e++)this.items.push(this.allocator())};return g}();f.ObjectStack=p;var a=1024;f.default=p})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/gl-matrix ../mathUtils ../stack".split(" "),function(p,f,k,a,g,b){function e(b){return b?{origin:a.vec3f64.clone(b.origin),
vector:a.vec3f64.clone(b.vector)}:{origin:a.vec3f64.create(),vector:a.vec3f64.create()}}function c(a,b){var c=q.get();c.origin=a;c.vector=b;return c}function d(b,c,d){void 0===d&&(d=e());a.vec3.copy(d.origin,b);a.vec3.copy(d.vector,c);return d}function m(c,d){d=a.vec3.subtract(b.sv3d.get(),d,c.origin);var e=a.vec3.dot(c.vector,d),h=a.vec3.dot(c.vector,c.vector),e=g.clamp(e/h,0,1);c=a.vec3.subtract(b.sv3d.get(),a.vec3.scale(b.sv3d.get(),c.vector,e),d);return a.vec3.dot(c,c)}function l(c,d,e,h,l){var m=
c.vector,n=c.origin;d=a.vec3.subtract(b.sv3d.get(),d,n);n=a.vec3.length(m);d=a.vec3.dot(m,d)/n;a.vec3.scale(l,m,g.clamp(d,e,h));return a.vec3.add(l,l,c.origin)}function h(c,d,e,h){var l=c.origin,m=a.vec3.add(b.sv3d.get(),l,c.vector);c=d.origin;var n=a.vec3.add(b.sv3d.get(),c,d.vector),q=b.sv3d.get();d=b.sv3d.get();q[0]=l[0]-c[0];q[1]=l[1]-c[1];q[2]=l[2]-c[2];d[0]=n[0]-c[0];d[1]=n[1]-c[1];d[2]=n[2]-c[2];if(1E-6>Math.abs(d[0])&&1E-6>Math.abs(d[1])&&1E-6>Math.abs(d[2]))return!1;n=b.sv3d.get();n[0]=m[0]-
l[0];n[1]=m[1]-l[1];n[2]=m[2]-l[2];if(1E-6>Math.abs(n[0])&&1E-6>Math.abs(n[1])&&1E-6>Math.abs(n[2]))return!1;var m=q[0]*d[0]+q[1]*d[1]+q[2]*d[2],r=d[0]*n[0]+d[1]*n[1]+d[2]*n[2],t=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],u=(n[0]*n[0]+n[1]*n[1]+n[2]*n[2])*t-r*r;if(1E-6>Math.abs(u))return!1;q=(m*r-(q[0]*n[0]+q[1]*n[1]+q[2]*n[2])*t)/u;m=(m+r*q)/t;e&&(q=g.clamp(q,0,1),m=g.clamp(m,0,1));e=b.sv3d.get();r=b.sv3d.get();e[0]=l[0]+q*n[0];e[1]=l[1]+q*n[1];e[2]=l[2]+q*n[2];r[0]=c[0]+m*d[0];r[1]=c[1]+m*d[1];r[2]=c[2]+m*d[2];
h.tA=q;h.tB=m;h.pA=e;h.pB=r;h.distance2=a.vec3.squaredDistance(e,r);return!0}Object.defineProperty(f,"__esModule",{value:!0});f.create=e;f.wrap=c;f.copy=function(a,b){void 0===b&&(b=e());return d(a.origin,a.vector,b)};f.fromValues=d;f.fromPoints=function(b,c,d){void 0===d&&(d=e());a.vec3.copy(d.origin,b);a.vec3.subtract(d.vector,c,b);return d};f.distance2=m;f.distance=function(a,b){return Math.sqrt(m(a,b))};f.projectPoint=function(a,b,c){return l(a,b,0,1,c)};f.projectPointClamp=l;f.closestRayDistance2=
function(d,e){if(h(d,c(e.origin,e.direction),!1,n)){e=n.tA;var l=n.pB,m=n.distance2;if(0<=e&&1>=e)return m;if(0>e)return a.vec3.squaredDistance(d.origin,l);if(1<e)return a.vec3.squaredDistance(a.vec3.add(b.sv3d.get(),d.origin,d.vector),l)}return null};f.closestLineSegmentPoint=function(b,c,d){return h(b,c,!0,n)?(a.vec3.copy(d,n.pA),!0):!1};f.closestLineSegmentDistance2=function(a,b){return h(a,b,!0,n)?n.distance2:null};var n={tA:0,tB:0,pA:a.vec3f64.create(),pB:a.vec3f64.create(),distance2:0},q=new k.ObjectStack(function(){return{origin:null,
vector:null}})})},"esri/views/3d/support/geometryUtils/plane":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../mathUtils","../stack"],function(p,f,k,a,g){function b(a){void 0===a&&(a=f.UP);return[a[0],a[1],a[2],a[3]]}function e(a,d){void 0===d&&(d=b());return c(a[0],a[1],a[2],a[3],d)}function c(a,c,d,e,h){void 0===h&&(h=b());h[0]=a;h[1]=c;h[2]=d;h[3]=e;return h}function d(a,c,d){void 0===d&&(d=b());k.vec3.copy(d,c);c=k.vec3.dot(c,c);1E-5<Math.abs(c-1)&&k.vec3.scale(d,
d,1/Math.sqrt(c));m(d,a,d);return d}function m(a,b,c){a!==c&&e(a,c);c[3]=-k.vec3.dot(c,b);return c}function l(a,c,e,h){void 0===h&&(h=b());a=k.vec3.cross(g.sv3d.get(),c,a);return d(e,a,h)}function h(a,b,c){a=k.vec3.scale(g.sv3d.get(),a,k.vec3.dot(a,b));k.vec3.subtract(c,b,a);return c}function n(a,b){return k.vec3.dot(a,b)+a[3]}function q(b,c,d,e,h,l){var m=k.vec3.dot(b,d);if(0===m)return!1;b=-(k.vec3.dot(b,c)+b[3])/m;h&&(b=e?Math.max(0,b):a.clamp(b,0,1));if(0>b||!e&&1<b)return!1;k.vec3.add(l,c,k.vec3.scale(l,
d,b));return!0}Object.defineProperty(f,"__esModule",{value:!0});f.create=b;f.wrap=function(a,b,d,e){return c(a,b,d,e,g.sv4d.get())};f.copy=e;f.fromValues=c;f.fromNormalAndOffset=function(a,c,d){void 0===d&&(d=b());k.vec3.copy(d,a);d[3]=c;return d};f.fromPositionAndNormal=d;f.fromPoints=function(a,c,d,e){void 0===e&&(e=b());return l(k.vec3.subtract(g.sv3d.get(),a,c),k.vec3.subtract(g.sv3d.get(),d,c),a,e)};f.setOffsetFromPoint=m;f.negate=function(a,b){b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};
f.fromVectorsAndPoint=l;f.intersectRay=function(a,b,c){return q(a,b.origin,b.direction,!0,!1,c)};f.intersectLineSegment=function(a,b,c){return q(a,b.origin,b.vector,!1,!1,c)};f.intersectLineSegmentClamp=function(a,b,c){return q(a,b.origin,b.vector,!1,!0,c)};f.isSphereFullyInside=function(a,b){var c=b.radius;return 0<=n(a,b.center)-c};f.isSphereFullyOutside=function(a,b){var c=b.radius;return 0>n(a,b.center)+c};f.isPointInside=function(a,b){return 0<=n(a,b)};f.isPointOutside=function(a,b){return 0>
n(a,b)};f.isAABBFullyInside=function(a,b){var c=b[0],d=b[1],e=b[2],h=b[3],l=b[4];b=b[5];return 0<=a[0]*(0<a[0]?c:h)+a[1]*(0<a[1]?d:l)+a[2]*(0<a[2]?e:b)+a[3]};f.clip=function(a,b){var c=k.vec3.dot(a,b.ray.direction);a=-n(a,b.ray.origin);if(0>a&&0<=c)return!1;if(-1E-6<c&&1E-6>c)return 0<a;if((0>a||0>c)&&!(0>a&&0>c))return!0;a/=c;0<c?a<b.c1&&(b.c1=a):a>b.c0&&(b.c0=a);return b.c0<=b.c1};f.projectPoint=function(a,b,c){var d=k.vec3.scale(g.sv3d.get(),a,-a[3]);b=k.vec3.subtract(g.sv3d.get(),b,d);a=h(a,b,
g.sv3d.get());k.vec3.add(c,a,d);return c};f.projectVector=h;f.distance=function(a,b){return Math.abs(n(a,b))};f.signedDistance=n;f.UP=[0,0,1,0]})},"esri/views/3d/support/geometryUtils/ray":function(){define(["require","exports","../../../../core/ObjectStack","../../../../core/libs/gl-matrix-2/gl-matrix","../stack"],function(p,f,k,a,g){function b(b){return b?{origin:a.vec3f64.clone(b.origin),direction:a.vec3f64.clone(b.direction)}:{origin:a.vec3f64.create(),direction:a.vec3f64.create()}}function e(c,
d,e){void 0===e&&(e=b());a.vec3.copy(e.origin,c);a.vec3.copy(e.direction,d);return e}function c(b,c){b=a.vec3.cross(g.sv3d.get(),a.vec3.normalize(g.sv3d.get(),b.direction),a.vec3.subtract(g.sv3d.get(),c,b.origin));return a.vec3.dot(b,b)}function d(){return{origin:null,direction:null}}Object.defineProperty(f,"__esModule",{value:!0});f.create=b;f.wrap=function(a,b){var c=m.get();c.origin=a;c.direction=b;return c};f.copy=function(a,c){void 0===c&&(c=b());return e(a.origin,a.direction,c)};f.fromValues=
e;f.fromScreen=function(c,d,e){void 0===e&&(e=b());var h=a.vec3.set(g.sv3d.get(),d[0],d[1],0);c.unprojectPoint(h,e.origin);d=a.vec3.set(g.sv3d.get(),d[0],d[1],1);c=c.unprojectPoint(d,g.sv3d.get());a.vec3.subtract(e.direction,c,e.origin);return e};f.fromScreenAtEye=function(c,d,e){void 0===e&&(e=b());a.vec3.copy(e.origin,c.eye);d=a.vec3.set(g.sv3d.get(),d[0],d[1],1);c=c.unprojectPoint(d,g.sv3d.get());a.vec3.subtract(e.direction,c,e.origin);return e};f.distance2=c;f.distance=function(a,b){return Math.sqrt(c(a,
b))};f.closestPoint=function(b,c,d){c=a.vec3.dot(b.direction,a.vec3.subtract(d,c,b.origin));a.vec3.add(d,b.origin,a.vec3.scale(d,b.direction,c));return d};f.createWrapper=d;var m=new k.ObjectStack(d)})},"esri/views/3d/support/geometryUtils/frustum":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/gl-matrix ../stack ./clipRay ./plane".split(" "),function(p,f,k,a,g,b,e){function c(b){if(b){var c=b.planes;b=b.points;return{planes:[e.create(c[0]),e.create(c[1]),
e.create(c[2]),e.create(c[3]),e.create(c[4]),e.create(c[5])],points:[a.vec3f64.clone(b[0]),a.vec3f64.clone(b[1]),a.vec3f64.clone(b[2]),a.vec3f64.clone(b[3]),a.vec3f64.clone(b[4]),a.vec3f64.clone(b[5]),a.vec3f64.clone(b[6]),a.vec3f64.clone(b[7])]}}return{planes:[e.create(),e.create(),e.create(),e.create(),e.create(),e.create()],points:[a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create(),a.vec3f64.create()]}}function d(b,
d,h){void 0===h&&(h=c());for(var l=0;6>l;l++)e.copy(b[l],h.planes[l]);for(l=0;8>l;l++)a.vec3.copy(h.points[l],d[l]);return h}function m(a){var b=a.planes;a=a.points;e.fromPoints(a[4],a[0],a[3],b[0]);e.fromPoints(a[1],a[5],a[6],b[1]);e.fromPoints(a[4],a[5],a[1],b[2]);e.fromPoints(a[3],a[2],a[6],b[3]);e.fromPoints(a[0],a[1],a[2],b[4]);e.fromPoints(a[5],a[4],a[7],b[5])}function l(a,b){a=a.planes;for(var c=0;6>c;c++)if(!e.clip(a[c],b))return!1;return!0}Object.defineProperty(f,"__esModule",{value:!0});
f.create=c;f.copy=function(a,b){void 0===b&&(b=c());return d(a.planes,a.points,b)};f.fromValues=d;f.fromMatrix=function(b,d,e){void 0===e&&(e=c());var l=e.points;b=a.mat4.multiply(g.sm4d.get(),d,b);a.mat4.invert(b,b);for(d=0;8>d;++d){var n=a.vec4.transformMat4(g.sv4d.get(),h[d],b);a.vec3.set(l[d],n[0]/n[3],n[1]/n[3],n[2]/n[3])}m(e);return e};f.recomputePlanes=m;f.intersectsSphere=function(a,b){a=a.planes;for(var c=0;6>c;c++)if(e.isSphereFullyInside(a[c],b))return!1;return!0};f.intersectsRay=function(a,
c){return l(a,b.fromRay(c,n.get()))};f.intersectsLineSegment=function(a,c,d){return l(a,b.fromLineSegmentAndDirection(c,d,n.get()))};f.intersectsPoint=function(a,b){a=a.planes;for(var c=0;6>c;c++)if(0<e.signedDistance(a[c],b))return!1;return!0};f.intersectsAABB=function(a,b){a=a.planes;for(var c=0;6>c;c++)if(e.isAABBFullyInside(a[c],b))return!1;return!0};f.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};var h=[a.vec4f64.fromValues(-1,
-1,-1,1),a.vec4f64.fromValues(1,-1,-1,1),a.vec4f64.fromValues(1,1,-1,1),a.vec4f64.fromValues(-1,1,-1,1),a.vec4f64.fromValues(-1,-1,1,1),a.vec4f64.fromValues(1,-1,1,1),a.vec4f64.fromValues(1,1,1,1),a.vec4f64.fromValues(-1,1,1,1)],n=new k.ObjectStack(b.create)})},"esri/views/3d/support/geometryUtils/clipRay":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/gl-matrix ../stack ./ray".split(" "),function(p,f,k,a,g,b){function e(a){return a?{ray:b.create(a.ray),
c0:a.c0,c1:a.c1}:{ray:b.create(),c0:0,c1:Number.MAX_VALUE}}function c(a,c,d,m){void 0===m&&(m=e());b.copy(a,m.ray);m.c0=c;m.c1=d;return m}function d(c,d,m){void 0===m&&(m=e());var h=a.vec3.length(c.vector);b.fromValues(c.origin,d,m.ray);m.c0=0;m.c1=h;return m}Object.defineProperty(f,"__esModule",{value:!0});f.create=e;f.wrap=function(a,b,c){var d=m.get();d.ray=a;d.c0=b;d.c1=c;return d};f.copy=function(a,b){void 0===b&&(b=e());return c(a.ray,a.c0,a.c1,b)};f.fromValues=c;f.fromRay=function(a,c){void 0===
c&&(c=e());b.copy(a,c.ray);c.c0=0;c.c1=Number.MAX_VALUE;return c};f.fromLineSegment=function(b,c){void 0===c&&(c=e());var h=a.vec3.normalize(g.sv3d.get(),b.vector);return d(b,h,c)};f.fromLineSegmentAndDirection=d;var m=new k.ObjectStack(function(){return{c0:0,c1:0,ray:null}})})},"esri/views/3d/support/geometryUtils/sphere":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/gl-matrix ../geometryUtils ../mathUtils ../stack ./ray".split(" "),
function(p,f,k,a,g,b,e,c,d,m){function l(a){return a?{radius:a.radius,center:b.vec3f64.clone(a.center)}:{radius:1,center:b.vec3f64.create()}}function h(a,b){void 0===b&&(b=l());return n(a.radius,a.center,b)}function n(a,c,d){void 0===d&&(d=l());b.vec3.copy(d.center,c);d.radius=a;return d}function q(a,c,e){var h=b.vec3.subtract(d.sv3d.get(),c.origin,a.center),l=b.vec3.dot(c.direction,c.direction),m=2*b.vec3.dot(c.direction,h);a=b.vec3.dot(h,h)-a.radius*a.radius;a=m*m-4*l*a;if(0>a)return!1;h=Math.sqrt(a);
a=(-m-h)/(2*l);l=(-m+h)/(2*l);if(0>a||l<a&&0<l)a=l;if(0>a)return!1;e&&b.vec3.add(e,c.origin,b.vec3.scale(d.sv3d.get(),c.direction,a));return!0}function t(a,c,h){var l=d.sv3d.get(),m=d.sm4d.get();b.vec3.cross(l,c.origin,c.direction);b.vec3.cross(h,l,c.origin);b.vec3.scale(h,h,1/b.vec3.length(h)*a.radius);a=r(a,c.origin);c=e.vector.angle(c.origin,h);b.mat4.identity(m);b.mat4.rotate(m,m,c+a,l);b.vec3.transformMat4(h,h,m);return h}function u(a,c,e){c=b.vec3.subtract(d.sv3d.get(),c,a.center);c=b.vec3.scale(d.sv3d.get(),
c,a.radius/b.vec3.length(c));return b.vec3.add(e,c,a.center)}function r(a,e){e=b.vec3.subtract(d.sv3d.get(),e,a.center);e=b.vec3.length(e);return c.acos(a.radius/(a.radius+Math.abs(a.radius-e)))}function y(a,e,h,l){a=b.vec3.subtract(d.sv3d.get(),e,a.center);switch(h){case 0:return a=c.cartesianToSpherical(a,d.sv3d.get()),a=a[2],b.vec3.set(l,-Math.sin(a),Math.cos(a),0);case 1:return a=c.cartesianToSpherical(a,d.sv3d.get()),h=a[1],a=a[2],e=Math.sin(h),b.vec3.set(l,-e*Math.cos(a),-e*Math.sin(a),Math.cos(h));
case 2:return b.vec3.normalize(l,a);default:k.neverReached(h)}}function x(a,c){c=b.vec3.subtract(d.sv3d.get(),c,a.center);return b.vec3.length(c)-a.radius}Object.defineProperty(f,"__esModule",{value:!0});var z=a.getLogger("esri.views.3d.support.geometryUtils.sphere");f.create=l;f.wrap=function(a,b){var c=w.get();c.radius=a;c.center=b||C;return c};f.copy=h;f.fromValues=n;f.elevate=function(a,c,d){a!==d&&b.vec3.copy(d.center,a.center);d.radius=a.radius+c;return d};f.setExtent=function(a,b,c){z.error("sphere.setExtent is not yet supported");
return a===c?c:h(a,c)};f.intersectRay=q;f.intersectScreen=function(a,b,c,d){b=m.fromScreenAtEye(b,c,B);return q(a,b,d)};f.intersectsRay=function(a,b){return q(a,b,null)};f.intersectRayClosestSilhouette=function(a,c,e){if(q(a,c,e))return e;a=t(a,c,d.sv3d.get());b.vec3.add(e,c.origin,b.vec3.scale(d.sv3d.get(),c.direction,b.vec3.distance(c.origin,a)/b.vec3.length(c.direction)));return e};f.closestPointOnSilhouette=t;f.closestPoint=function(a,b,c){if(q(a,b,c))return c;m.closestPoint(b,a.center,c);return u(a,
c,c)};f.projectPoint=u;f.distanceToSilhouette=function(a,c){c=b.vec3.subtract(d.sv3d.get(),c,a.center);c=b.vec3.squaredLength(c);return Math.sqrt(Math.abs(c-a.radius*a.radius))};f.angleToSilhouette=r;f.axisAt=y;f.altitudeAt=x;f.setAltitudeAt=function(a,c,e,h){var l=x(a,c);a=y(a,c,2,d.sv3d.get());e=b.vec3.scale(d.sv3d.get(),a,e-l);b.vec3.add(h,c,e);return h};var w=new g.ObjectStack(function(){return{center:null,radius:0}}),B=m.create(),C=b.vec3f64.create();Object.freeze(C)})},"esri/views/3d/support/geometryUtils/triangle":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/gl-matrix ../stack ./lineSegment".split(" "),
function(p,f,k,a,g,b){function e(b){return b?{p0:a.vec3f64.clone(b.p0),p1:a.vec3f64.clone(b.p1),p2:a.vec3f64.clone(b.p2)}:{p0:a.vec3f64.create(),p1:a.vec3f64.create(),p2:a.vec3f64.create()}}function c(b,c,d,l){void 0===l&&(l=e());a.vec3.copy(l.p0,b);a.vec3.copy(l.p1,c);a.vec3.copy(l.p2,d);return l}function d(b,c,d){var e=a.vec2.distance(b,c);c=a.vec2.distance(c,d);b=a.vec2.distance(d,b);d=(e+c+b)/2;e=d*(d-e)*(d-c)*(d-b);return 0>=e?0:Math.sqrt(e)}Object.defineProperty(f,"__esModule",{value:!0});f.create=
e;f.wrap=function(a,b,c){var d=l.get();d.p0=a;d.p1=b;d.p2=c;return d};f.copy=function(a,b){void 0===b&&(b=e());return c(a.p0,a.p1,a.p2,b)};f.fromValues=c;f.distance2=function(c,d){var e=c.p0,h=c.p1;c=c.p2;var l=a.vec3.subtract(g.sv3d.get(),h,e),n=a.vec3.subtract(g.sv3d.get(),c,h),k=a.vec3.subtract(g.sv3d.get(),e,c),f=a.vec3.subtract(g.sv3d.get(),d,e),z=a.vec3.subtract(g.sv3d.get(),d,h),w=a.vec3.subtract(g.sv3d.get(),d,c),B=a.vec3.cross(l,l,k),C=a.vec3.dot(a.vec3.cross(g.sv3d.get(),l,B),f),z=a.vec3.dot(a.vec3.cross(g.sv3d.get(),
n,B),z),w=a.vec3.dot(a.vec3.cross(g.sv3d.get(),k,B),w);if(0<C&&0<z&&0<w)return d=a.vec3.dot(B,f),d*d/a.vec3.dot(B,B);e=b.distance2(b.fromValues(e,l,m.get()),d);h=b.distance2(b.fromValues(h,n,m.get()),d);d=b.distance2(b.fromValues(c,k,m.get()),d);return Math.min(e,h,d)};f.areaPoints2d=d;f.area2d=function(a){return d(a.p0,a.p1,a.p2)};var m=new k.ObjectStack(b.create),l=new k.ObjectStack(function(){return{p0:null,p1:null,p2:null}})})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require",
"exports","./ComponentUtils","./geometryDataUtils","./Util"],function(p,f,k,a,g){return function(){function b(e,c,d,m){void 0===c&&(c=b.DefaultIndices);void 0===d&&(d=b.DefaultOffsets);void 0===m&&(m="triangle");this.preinterleaved=!1;var l={},h;for(h in e){var n=e[h],q=n.size;l[h]={data:n.data,size:q,offsetIdx:0,strideIdx:q}}if(c===b.DefaultIndices){c=g.getFirstObjectValue(l);e=a.generateDefaultIndexArray(c.data.length/c.size);c={};for(var t in l)c[t]=e}this._id=a.getNewId();this._vertexAttributes=
l;this._indices=c;this._componentOffsets=k.createOffsets(d);this._primitiveType=m}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentOffsets",{get:function(){return this._componentOffsets},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexCount",{get:function(){return g.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0});b.prototype.getVertexAttr=function(){return this.vertexAttributes};b.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}};
b.prototype.getIndices=function(a){return this._indices[a]};b.prototype.getAttribute=function(a){return this._vertexAttributes[a]};b.prototype.estimateGpuMemoryUsage=function(){var a=0;this._indices.position&&(a+=12*this._indices.position.length);this._indices.normal&&(a+=12*this._indices.normal.length);this._indices.uv0&&(a+=8*this._indices.uv0.length);this._indices.color&&(a+=4*this._indices.color.length);return a};b.DefaultIndices={};b.DefaultOffsets=new Uint32Array(0);return b}()})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require",
"exports","../../../../core/arrayUtils"],function(p,f,k){function a(a,b){if(null!=a){var c=a.isVisibleBit,d=a.data,e=8*d.BYTES_PER_ELEMENT;return b<d.length*e?n(c,d,b,e):!a.isVisibleBit}return!0}function g(a){return null===a.component?-1:a.component}function b(b,c,d,h,l){a(c,h)&&e(b,c,d,d[h],d[h+1]-1,l)}function e(a,b,c,d,e,h){c=(b=0<a.length?a[a.length-1]:null)?b.range[1]:-1;var l=b?b.options:null;c>=d||(c+1===d&&l===h?b.range[1]=e:a.push({range:[d,e],options:h}))}function c(a){void 0===a&&(a=!0);
return{isVisibleBit:!a,data:new Uint32Array(0)}}function d(a,b){return l(a,b,!0)}function m(a,b){return l(a,b,!1)}function l(a,b,c){var d=!1;a=a||t;d=a.isVisibleBit;a=a.data;b=q(b);var e=8*a.BYTES_PER_ELEMENT,h=a.length*e;c=c===d;if(0===a.length||0===b)d=!c;else if(h<b&&!c)d=!0;else{for(var l=u[e],h=u[0],m=0;m<a.length-1;m++)if(d=!c&&a[m]!==l||c&&a[m]!==h)return d;d=a.length-1;b=u[(b-1)%e+1];d=!c&&(a[d]&b)!==b||c&&(a[d]&b)!==h}return d}function h(a){return 0<a.length}function n(a,b,c,d){var e=c/d|
0;return 0!==(b[e]&1<<c-e*d)===a}function q(a){return Math.max(0,a.length-1)}Object.defineProperty(f,"__esModule",{value:!0});f.updateVisibility=function(a,b,d,e){if(d<q(b)){null==a&&(a=c());var h=a.isVisibleBit,l=a.data,m=8*l.BYTES_PER_ELEMENT,g=d/m|0,n=d-m*g;b=(q(b)-1)/m|0;var r=l;e=e===h;d<r.length*m||!e||(d=Math.max(g+1,Math.ceil(1.5*r.length)),d=Math.min(d,b+1),l=new Uint32Array(d),l.set(r));g<l.length&&(l[g]=l[g]&~(1<<n)|(e?1:0)<<n);a.data=l}return a};f.getVisibility=a;f.hideAllComponents=function(a){if(null==
a)a=c(!1);else{a.isVisibleBit=!0;for(var b=0;b<a.data.length;b++)a.data[b]=0}return a};f.unhideAllComponents=function(a){var b;if(null!=a)for(b=a,b.isVisibleBit=!1,a=0;a<b.data.length;a++)b.data[a]=0;return b};f.generateVisibleIndexRanges=function(a,b){var c;if(a)if(h(b))if(0===a.data.length)c=[],b=[[b[0],b[b.length-1]-1]],c=a.isVisibleBit?c:b;else{c=[];for(var d=a.isVisibleBit,e=a.data,l=8*e.BYTES_PER_ELEMENT,m=e.length*l,g=q(b),r=!1,t=0;t<m&&t<g;t++){var k=n(d,e,t,l);if(k!==r){var u=b[t];k?c.push([u,
0]):(r=c[c.length-1],r[1]=u-1);r=k}}a=!a.isVisibleBit;g>m&&a&&!r?c.push([b[m],b[g]-1]):r&&(r=c[c.length-1],r[1]=b[a?g:Math.min(g,m)]-1)}else c=[],c=a.isVisibleBit?c:null;else c=null;return c};f.addHighlight=function(a,b,c,d){a=a||[];b={component:b,options:c,id:d};a.push(b);c=g(b);for(d=a.length-1;0<d&&c<g(a[d-1]);)b=[a[d],a[d-1]],a[d-1]=b[0],a[d]=b[1],--d;return a};f.removeHighlight=function(a,b){return a?(a=a.filter(function(a){return a.id!==b}),0===a.length?null:a):a};f.generateHighlightedIndexRanges=
function(a,c,d){if(!c)return null;if(!h(d))return a&&a.isVisibleBit?null:c.map(function(a){return{range:null,options:a.options}});for(var l=d[0],g=d[d.length-1]-1,n=[],r=!m(a,d),t=0;t<c.length;++t){var k=c[t].options,u=c[t].component;if(null!==u)b(n,a,d,u,k);else if(r)e(n,a,d,l,g,k);else for(u=0;u<q(d);++u)b(n,a,d,u,k)}return 0<n.length?n:null};f.defaultVisibilities=c;f.isAllVisible=function(a,b){return!m(a,b)};f.isAllHidden=function(a,b){return!d(a,b)};f.hasVisible=d;f.hasHidden=m;var t=c();f.createOffsets=
function(a){return Array.isArray(a)?new Uint32Array(a):a};f.hasComponent=function(a,b){return b<q(a)};f.hasComponents=h;var u=[];for(p=0;65>p;p++)u.push(Math.pow(2,p)-1);f.componentCount=q;f.componentFind=function(a,b){a=k.binaryIndexOf(a,b,!0);return 0<=a?a:null}})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});var k=1,a=null;f.generateDefaultIndexArray=function(b){if(b>k||null==a){for(;b>
k;)k*=2;a=new Uint32Array(k);for(var e=0;e<k;e++)a[e]=e}return new Uint32Array(a.buffer,0,b)};var g=0;f.getNewId=function(){return g++}})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../../support/mathUtils"],function(p,f,k,a){function g(a,b){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new r(b);}function b(a){for(var b in a)return b}function e(a,b){a[12]=b[0];a[13]=b[1];a[14]=b[2]}function c(a,b){void 0===
b&&(b=0);for(var c=0,d=0;4>d;d++)c+=a[b+d]*x[d];return c}function d(a){return a-Math.floor(a)}Object.defineProperty(f,"__esModule",{value:!0});var m=k.vec4f64.create(),l=k.vec2f64.create(),h=k.vec2f64.create(),n=k.vec2f64.create(),q=k.vec2f64.create(),t=k.vec2f64.create(),u=k.vec2f64.create(),r=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};return a}();f.AssertException=r;f.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",
UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"};f.assert=g;f.verify=function(a,b){a||(console.log("Verify failed: "+b),console.log(Error("dummy").stack))};f.encodeInt16=function(b){return a.clamp(Math.round(32767*b),-32767,32767)};f.encodeNormal=function(a,b){var c=Math.abs(a[0]),d=Math.abs(a[1]),e=1/(c+d+Math.abs(a[2])),h=Math.min(a[2]*e,0);b[0]=(0>a[0]?-1:1)*(c*e-h);b[1]=(0>a[1]?-1:1)*(d*e-h)};f.fallbackIfUndefined=
function(a,b){return void 0===a?b:a};f.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};f.rgb2hex=function(b){var c=a.clamp(Math.round(255*b[0]),0,255),d=a.clamp(Math.round(255*b[1]),0,255);b=a.clamp(Math.round(255*b[2]),0,255);return"0x"+((c<<16)+(d<<8)+b).toString(16)};f.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};f.rayTriangle3D=function(a,b,c,d,e,h,l,m,g){void 0===g&&(g=k.vec3f64.create());var n=d[l]-c[h],q=d[l+1]-c[h+1],
r=d[l+2]-c[h+2];d=e[m]-c[h];l=e[m+1]-c[h+1];e=e[m+2]-c[h+2];var t=b[1]*e-l*b[2],u=b[2]*d-e*b[0],f=b[0]*l-d*b[1];m=n*t+q*u+r*f;if(-1E-5<m&&1E-5>m)return!1;m=1/m;var w=a[0]-c[h],z=a[1]-c[h+1];a=a[2]-c[h+2];g[1]=m*(w*t+z*u+a*f);if(0>g[1]||1<g[1])return!1;c=z*r-q*a;a=a*n-r*w;n=w*q-n*z;g[2]=m*(b[0]*c+b[1]*a+b[2]*n);if(0>g[2]||1<g[1]+g[2])return!1;g[0]=m*(d*c+l*a+e*n);return!0};f.rayBoxTest=function(a,b,c,d){var e,h=(c[0]-a[0])/b[0],l=(d[0]-a[0])/b[0];h>l&&(e=h,h=l,l=e);var m=(c[1]-a[1])/b[1],g=(d[1]-a[1])/
b[1];m>g&&(e=m,m=g,g=e);if(h>g||m>l)return!1;m>h&&(h=m);g<l&&(l=g);c=(c[2]-a[2])/b[2];a=(d[2]-a[2])/b[2];c>a&&(e=c,c=a,a=e);if(h>a||c>l)return!1;a<l&&(l=a);return 0>l?!1:!0};f.rayRay2D=function(a,b,c,d,e,h){void 0===h&&(h=k.vec2f64.create());var l=(d[e]-c[e])*(b[0]-a[0])-(d[0]-c[0])*(b[e]-a[e]);if(0===l)return!1;c=((d[0]-c[0])*(a[e]-c[e])-(d[e]-c[e])*(a[0]-c[0]))/l;h[0]=a[0]+c*(b[0]-a[0]);h[1]=a[e]+c*(b[e]-a[e]);return!0};f.project=function(a,b,c,d,e){e||(e=a);m[0]=a[0];m[1]=a[1];m[2]=a[2];m[3]=1;
k.vec4.transformMat4(m,m,b);2<e.length&&(e[2]=-m[2]);k.vec4.transformMat4(m,m,c);g(0!==m[3]);e[0]=m[0]/m[3];e[1]=m[1]/m[3];e[2]=m[2]/m[3];e[0]=(.5*e[0]+.5)*d[2]+d[0];e[1]=(.5*e[1]+.5)*d[3]+d[1]};f.getFirstObjectKey=b;f.getFirstObjectValue=function(a){return a[b(a)]};f.objectEmpty=function(a){for(var b in a)return!1;return!0};f.logWithBase=function(a,b){return Math.log(a)/Math.log(b)};f.setMatrixTranslation=e;f.setMatrixTranslation3=function(a,b,c,d){a[12]=b;a[13]=c;a[14]=d};f.getMatrixTranslation=
function(a,b){void 0===b&&(b=k.vec3f64.create());b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};f.createTranslationMatrix=function(a,b){a=k.mat4.identity(a);e(a,b);return a};f.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};f.fovx2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/b)};f.fovy2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/c)};f.fovx2fovd=function(a,
b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/b)};f.fovy2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/c)};f.fovd2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};f.fovd2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};f.pointLineSegmentDistanceSquared2D=function(b,c,d){q[0]=c[0]-b[0];q[1]=c[1]-b[1];t[0]=d[0]-b[0];t[1]=d[1]-b[1];u[0]=d[0];u[1]=d[1];c=k.vec2.dot(t,q);d=k.vec2.dot(q,q);c=a.clamp(c/d,0,
1);n[0]=q[0]*c;n[1]=q[1]*c;l[0]=b[0]+n[0];l[1]=b[1]+n[1];k.vec2.subtract(h,u,l);b=k.vec2.dot(h,h);c=k.vec2.dot(t,t);d=k.vec2.dot(q,q);var e=k.vec2.dot(n,n);if(e>c||e>d)b=Number.MAX_VALUE;return b};f.packFloatRGBA=function(b,c,e){void 0===e&&(e=0);b=a.clamp(b,0,z);for(var h=0;4>h;h++)c[e+h]=Math.floor(256*d(b*y[h]))};f.unpackFloatRGBA=c;var y=[1,256,65536,16777216],x=[1/256,1/65536,1/16777216,1/4294967296],z=c(new Uint8ClampedArray([255,255,255,255]));f.inverseProjectionInfo=function(a,b,c,d,e){0===
a[11]?(d[0]=2/(b*a[0]),d[1]=2/(c*a[5]),d[2]=(1+a[12])/a[0],d[3]=(1+a[13])/a[5],k.vec2.set(e,0,1)):(d[0]=-2/(b*a[0]),d[1]=-2/(c*a[5]),d[2]=(1-a[8])/a[0],d[3]=(1-a[9])/a[5],k.vec2.set(e,1,0))}})},"esri/views/3d/webgl-engine/shaders/SimpleAtmospherePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});f.colorPass={name:"simple-atmosphere-color",
shaders:function(b){return{vertexShader:g.glslifyDefineMap({PANORAMIC:b.panoramic})+a.resolveIncludes("environment/simpleAtmosphere.vert"),fragmentShader:g.glslifyDefineMap({PANORAMIC:b.panoramic})+a.resolveIncludes("environment/simpleAtmosphere.frag")}},attributes:k.Default3D};f.fadePass={name:"simple-atmosphere-fade",shaders:{vertexShader:a.resolveIncludes("environment/simpleAtmosphereFade.vert"),fragmentShader:a.resolveIncludes("environment/simpleAtmosphereFade.frag")},attributes:k.Default3D}})},
"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}})},"esri/views/3d/webgl-engine/shaders/sources/resolver":function(){define(["require",
"exports","./shaderRepository","../../../../webgl/ShaderCompiler"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});var g=new a(function(a){var b=k;a.split("/").forEach(function(a){b&&(b=b[a])});return b});f.resolveIncludes=function(a){return g.resolveIncludes(a)}})},"esri/views/3d/webgl-engine/shaders/sources/shaderRepository":function(){define(["require","exports"],function(p,f){return{edgeRenderer:{"adjustProjectedPosition.glsl":"uniform vec2 uDepthBias;\r\nuniform vec2 uViewportDimInv;\r\n\r\n// Utility function to check for NaN values\r\nbool isNaN(float val) {\r\n  return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\r\n  // important: some nVidias failed to cope with version below.\r\n  // Probably wrong optimization.\r\n  /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\r\n}\r\n\r\n// An offset in xy screen space, along the projected normal of the edge\r\n// This reduces depth fighting when looking at a face from a flat angle\r\nvec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\r\n  float offsetXY \x3d uDepthBias.x;\r\n  float offsetZ  \x3d uDepthBias.y;\r\n\r\n  // screen space pixel offset\r\n  // we multiply by two to account for the fact that NDC go from -1 to 1\r\n  // we multiply by projPos.w to compensate for the perspective divison that happens later\r\n  // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\r\n  // towards the camera\r\n  vec4 projNormal \x3d uProj * uView * vec4(worldNormal, 0.0);\r\n\r\n  return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\r\n}\r\n\r\n// A z-offset, using a depth based heuristic.\r\nfloat calculateProjectedBiasZ(vec4 projPos) {\r\n  float offsetZ \x3d uDepthBias.y;\r\n  return sqrt(projPos.z) * offsetZ;\r\n}\r\n\r\nvec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\r\n  vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\r\n\r\n  // we currently have to do this check because some geometries come with 0 length edge normals.\r\n  // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\r\n  if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\r\n    projPos.xy +\x3d offsetXY;\r\n  }\r\n\r\n  projPos.z +\x3d calculateProjectedBiasZ(projPos);\r\n\r\n  return projPos;\r\n}\r\n",
"edgeRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec4 vColor;\r\nvarying float vRadius;\r\nvarying vec3 vPosition;\r\nvarying vec3 vWorldPosition;\r\nvarying float vLineLengthPixels;\r\nvarying float vSizeFalloffFactor;\r\nvarying float vLineIndex;\r\n\r\n// At which coverage threshold we discard a fragment completely\r\n#define COVERAGE_TEST_THRESHOLD 0.01\r\n\r\n#include \x3cedgeRenderer/lineOffset.glsl\x3e\r\n\r\nvec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\r\n  float lineOffset \x3d calculateLineOffset();\r\n  float positionX \x3d position.x - lineOffset;\r\n\r\n  if (radius \x3c 1.0) {\r\n    // Handle this specifically for subpixel sizes:\r\n    // 1. Compute correct coverage (note coverage is computed by\r\n    //    0.5 - dist, so we make sure that that will lead to correct\r\n    //    subpixel coverage\r\n    // 2. Ignore rounded caps\r\n    float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\r\n    float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\r\n\r\n    float coverage \x3d min(coverageX, coverageY);\r\n\r\n    return vec2(0.5 - coverage, 0.0);\r\n  }\r\n  else {\r\n    // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\r\n    float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\r\n\r\n    vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\r\n    return vec2(length(lineToPosition) - radius, positionOnCap / radius);\r\n  }\r\n}\r\n\r\nvoid main() {\r\n\r\n  float radius \x3d vRadius * calculateLinePressure();\r\n\r\n  vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\r\n  float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\r\n\r\n#ifdef ANTIALIASING\r\n\r\n  const float coverageLimit \x3d COVERAGE_TEST_THRESHOLD;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n  // Use subpixel coverage computation when lines get subpixel widths\r\n  // so we still render them appropriately. Otherwise discard anything\r\n  // that is not fully within the line\r\n  float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n  if (coverage \x3c coverageLimit) {\r\n    discard;\r\n  }\r\n\r\n  discardBySlice(vWorldPosition);\r\n\r\n  float alpha \x3d vColor.a * coverage;\r\n\r\n  gl_FragColor \x3d vec4(vColor.rgb, alpha);\r\n}\r\n",
"edgeRenderer.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n// Transformations\r\nuniform mat4 uProj;\r\nuniform mat4 uView;\r\nuniform mat4 uModel;\r\nuniform vec3 uCameraPosition;\r\n\r\n// Line configuration\r\n\r\n// Conversion constants\r\nuniform vec2 uPixelToNDC;\r\nuniform vec2 uNDCToPixel;\r\nuniform float uPixelRatio;\r\n\r\n// Inputs\r\nattribute vec3 aPosition0;\r\nattribute vec3 aPosition1;\r\nattribute float aVariantOffset;\r\nattribute float aVariantStroke;\r\nattribute float aVariantExtension;\r\n\r\n#ifdef SILHOUETTE\r\n\r\nattribute vec3 aNormalA;\r\nattribute vec3 aNormalB;\r\n\r\n#else /* SILHOUETTE */\r\n\r\nattribute vec3 aNormal;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\nattribute vec2 aSideness;\r\nattribute vec2 aPackedAttributes;\r\n\r\nstruct UnpackedAttributes {\r\nvec2 sideness;\r\nvec2 sidenessNorm;\r\nfloat lineWidthPixels;\r\nfloat extensionLengthPixels;\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\nfloat type;\r\n\r\n#endif\r\n};\r\n\r\n// Output required to compute color\r\nvarying vec4 vColor;\r\n\r\n// Output required to compute distance to line/caps\r\nvarying vec3 vPosition;\r\nvarying vec3 vWorldPosition;\r\nvarying float vRadius;\r\nvarying float vLineLengthPixels;\r\nvarying float vSizeFalloffFactor;\r\n\r\n#include \x3cedgeRenderer/adjustProjectedPosition.glsl\x3e\r\n#include \x3cedgeRenderer/styleOutputs.glsl\x3e\r\n#include \x3cedgeRenderer/lineAmplitude.glsl\x3e\r\n#include \x3cedgeRenderer/util.glsl\x3e\r\n\r\nvec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n  vec2 sideness \x3d unpackedAttributes.sideness;\r\n  vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n  vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\r\n\r\n  vec4 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\r\n  vec4 projPosV0 \x3d uProj * viewPosV0;\r\n  vec4 projPosV1 \x3d uProj * viewPosV1;\r\n  vec4 projPos \x3d uProj * viewPos;\r\n\r\n  vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\r\n  vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\r\n  float lineLengthPixels \x3d length(screenSpaceLinePixels);\r\n\r\n  float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\r\n  vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\r\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\r\n\r\n  float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\r\n  float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\r\n\r\n  float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\r\n  float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\r\n\r\n  vSizeFalloffFactor \x3d falloffFactor;\r\n\r\n  float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\r\n  float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\r\n\r\n#ifdef ANTIALIASING\r\n\r\n  const float aaPaddingPixels \x3d 1.0;\r\n\r\n  // Line size with padding\r\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\r\n  float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\r\n\r\n  // Line length with padding\r\n  float aaPaddedLineLengthPixels \x3d extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\r\n  float halfAAPaddedLineLengthPixels \x3d aaPaddedLineLengthPixels * 0.5;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n  // Even if there is no AA, we still want to do proper \x3c1px rendering,\r\n  // so we effectively clamp the pixel sizes to minimum of 1px and compute\r\n  // coverage in the fragment shader\r\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\r\n  float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\r\n\r\n  float halfAAPaddedLineLengthPixels \x3d max(extendedLineLengthPixels, 1.0) * 0.5;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n  // Half line width in NDC including padding for anti aliasing\r\n  vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\r\n  vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\r\n  vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\r\n\r\n  // Compute screen space position of vertex, offsetting for line size and end caps\r\n  vec2 ndcOffset \x3d (\r\n      screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\r\n    + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\r\n  );\r\n\r\n  projPos.xy +\x3d ndcOffset * projPos.w;\r\n  projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\r\n\r\n  projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\r\n\r\n  // Line length with end caps\r\n  float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\r\n\r\n  float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\r\n\r\n  // Position in pixels with origin at first vertex of line segment\r\n  vPosition \x3d vec3(\r\n    halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\r\n    pixelPositionAlongLine,\r\n    pixelPositionAlongLine / extendedLineLengthPixels\r\n  );\r\n\r\n  // The line width radius in pixels\r\n  vRadius \x3d lineWidthPixels * 0.5;\r\n  vLineLengthPixels \x3d extendedLineLengthPixels;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  gl_Position \x3d isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10.0, 10.0, 10.0, 1.0);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n  gl_Position \x3d projPos;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\n  if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) {\r\n    gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\r\n  }\r\n\r\n#elif (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  if (lineLengthPixels \x3c\x3d 3.0) {\r\n    gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\r\n  }\r\n\r\n#endif\r\n\r\n  return projPos;\r\n}\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\nUnpackedAttributes unpackAttributes(ComponentData component) {\r\n\r\n  vec2 sidenessNorm \x3d aSideness;\r\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n\r\n  float fType \x3d component.type;\r\n  float extensionLengthPixels \x3d component.extensionLength;\r\n  float lineWidth \x3d component.lineWidth;\r\n\r\n  if (fType \x3c\x3d 0.0) {\r\n    extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\r\n  }\r\n\r\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\r\n}\r\n\r\n#else /* (MODE \x3d\x3d MODE_UBER) */\r\n\r\nUnpackedAttributes unpackAttributes(ComponentData component) {\r\n  vec2 sidenessNorm \x3d aSideness;\r\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n  float extensionLengthPixels \x3d component.extensionLength;\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\r\n\r\n#endif\r\n\r\n  float lineWidth \x3d component.lineWidth;\r\n\r\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\r\n}\r\n\r\n#endif /* (MODE \x3d\x3d MODE_UBER) */\r\n\r\nvoid main() {\r\n  ComponentData component \x3d readComponentData();\r\n  UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\r\n\r\n  vec4 worldPosV0 \x3d uModel * vec4(aPosition0, 1.0);\r\n  vec4 worldPosV1 \x3d uModel * vec4(aPosition1, 1.0);\r\n\r\n  vec4 viewPosV0 \x3d uView * worldPosV0;\r\n  vec4 viewPosV1 \x3d uView * worldPosV1;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  vec3 worldNormal \x3d silhouetteWorldNormal(aNormalA, aNormalB);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n  vec3 worldNormal \x3d modelToWorldNormal(aNormal);\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n  // General geometric computation for all types of edges\r\n  vec4 projPos \x3d calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\r\n\r\n  // Component color\r\n  vColor \x3d component.color;\r\n\r\n  // Specific computation for different edge styles\r\n  calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\r\n}\r\n",
"lineAmplitude.glsl":"// Solid\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineAmplitudeSolid() {\r\n    return 0.0;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeSolid();\r\n  }\r\n\r\n#endif\r\n\r\n// Sketch\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform float uStrokesAmplitude;\r\n\r\n  float calculateLineAmplitudeSketch() {\r\n    return uStrokesAmplitude;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeSketch();\r\n  }\r\n\r\n#endif\r\n\r\n// Uber\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    float type \x3d unpackedAttributes.type;\r\n\r\n    if (type \x3c\x3d 0.0) {\r\n      return calculateLineAmplitudeSketch();\r\n    }\r\n    else {\r\n      return calculateLineAmplitudeSolid();\r\n    }\r\n  }\r\n\r\n#endif\r\n",
"lineOffset.glsl":"#include \x3cutil/encoding.glsl\x3e\r\n\r\n// Sketch\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform sampler2D uStrokesTexture;\r\n  uniform float uStrokesNormalizationScale;\r\n\r\n  varying vec2 vStrokeUV;\r\n\r\n  float calculateLineOffsetSketch() {\r\n    float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\r\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\r\n  }\r\n\r\n  float calculateLinePressureSketch() {\r\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetSketch();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureSketch();\r\n  }\r\n\r\n#endif\r\n\r\n// Solid\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineOffsetSolid() {\r\n    return 0.0;\r\n  }\r\n\r\n  float calculateLinePressureSolid() {\r\n    return 1.0;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetSolid();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureSolid();\r\n  }\r\n\r\n#endif\r\n\r\n// Uber\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n  varying float vType;\r\n\r\n  float calculateLineOffset() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLineOffsetSketch();\r\n    }\r\n    else {\r\n      return calculateLineOffsetSolid();\r\n    }\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLinePressureSketch();\r\n    }\r\n    else {\r\n      return calculateLinePressureSolid();\r\n    }\r\n  }\r\n#endif\r\n",
"styleOutputs.glsl":"#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform vec2 uStrokesTextureScale;\r\n  uniform float uStrokesLog2Resolution;\r\n  uniform float uStrokeVariants;\r\n\r\n  varying vec2 vStrokeUV;\r\n  varying float vLineIndex;\r\n\r\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\r\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n    float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\r\n\r\n    vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\r\n    vStrokeUV.x +\x3d aVariantOffset;\r\n\r\n    vLineIndex \x3d lineIndex;\r\n  }\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n  }\r\n#elif (MODE \x3d\x3d MODE_SKETCH)\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n  }\r\n#elif (MODE \x3d\x3d MODE_UBER)\r\n  varying float vType;\r\n\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    vType \x3d unpackedAttributes.type;\r\n\r\n    if (unpackedAttributes.type \x3c\x3d 0.0) {\r\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n    }\r\n  }\r\n#endif\r\n",
"util.glsl":"uniform float uDistanceFalloffFactor;\r\n\r\nfloat distanceBasedPerspectiveFactor(float distance) {\r\n  return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\r\n}\r\n\r\nuniform sampler2D uComponentDataTex;\r\nuniform vec2 uComponentDataTexInvDim;\r\n\r\nattribute float aComponentIndex;\r\n\r\n#define COMPONENT_COLOR_FIELD_OFFSET 0.0\r\n#define COMPONENT_OTHER_FIELDS_OFFSET 1.0\r\n#define COMPONENT_FIELD_COUNT 2.0\r\n\r\n#define LINE_WIDTH_FRACTION_FACTOR 8.0\r\n#define EXTENSION_LENGTH_OFFSET 128.0\r\n\r\n#define COMPONENT_TEX_WIDTH 4096.0\r\n\r\nvec2 componentTextureCoords(float componentIndex, float fieldOffset) {\r\n  float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\r\n\r\n  float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\r\n  float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\r\n\r\n  vec2 linearIndex \x3d vec2(\r\n    (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\r\n    (rowIndex + 0.5) * uComponentDataTexInvDim.y\r\n  );\r\n\r\n  return linearIndex;\r\n}\r\n\r\nstruct ComponentData {\r\n  vec4 color;\r\n  float lineWidth;\r\n  float extensionLength;\r\n  float type;\r\n};\r\n\r\nComponentData readComponentData() {\r\n  vec2 colorIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\r\n  vec2 otherIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\r\n\r\n  vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\r\n  vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\r\n\r\n  return ComponentData(\r\n    vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\r\n    otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\r\n    otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\r\n    -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\r\n  );\r\n}\r\n\r\nvec3 modelToWorldNormal(vec3 normal) {\r\n  return (uModel * vec4(normal, 0.0)).xyz;\r\n}\r\n\r\nvec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\r\n  return modelToWorldNormal(normalize(normalA + normalB));\r\n}\r\n\r\n// Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\r\n// fall-off exponentially\r\nfloat calculateExtensionLength(float extensionLength, float lineLength) {\r\n  return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\r\n}\r\n\r\n#ifdef SILHOUETTE\r\n\r\n// #uniforms: uView, uModel\r\nbool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\r\n  // transform the two face normals\r\n  vec3 viewNormalA \x3d (uView * uModel * vec4(normalA, 0.0)).xyz;\r\n  vec3 viewNormalB \x3d (uView * uModel * vec4(normalB, 0.0)).xyz;\r\n\r\n  // compute the direction from the edge to the camera\r\n  vec3 viewDir \x3d -viewPos.xyz;\r\n\r\n  // check which of the two faces are visible\r\n  // display the edge if exactly one of the two is visible\r\n  float faceAVisible \x3d dot(viewDir, viewNormalA); // positive if visible\r\n  float faceBVisible \x3d dot(viewDir, viewNormalB); // positive if visible\r\n\r\n  // 1 if exactly one face visible, 0 otherwise\r\n  return faceAVisible * faceBVisible \x3c 0.0;\r\n}\r\n\r\n#endif /* SILHOUETTE */\r\n"},
environment:{"realisticAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/color.glsl\x3e\r\n\r\n// Light\r\nuniform vec3 v3LightDir;      // The direction vector to the light source\r\nuniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\r\nuniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\r\n\r\n// Atmosphere\r\nconst float fKrESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\r\nconst float fKmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\r\n\r\n// Radii\r\nuniform vec4 v4Radii; // (fInnerRadius, fInnerRadius^2, fOuterRadius, fOuterRadius^2)\r\n\r\nfloat fInnerRadius \x3d v4Radii[0];   // The inner (planetary) radius\r\nfloat fInnerRadius2 \x3d v4Radii[1];  // fInnerRadius^2\r\nfloat fOuterRadius \x3d v4Radii[2];   // The outer (atmosphere) radius\r\nfloat fOuterRadius2 \x3d v4Radii[3];  // fOuterRadius^2\r\n\r\n// Atmosphere parameters:\r\n// fScale:                    1.0 / (fOuterRadius - fInnerRadius)\r\n// fScaleDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\r\n// fScaleOverScaleDepth:      fScale / fScaleDepth\r\n// fOneOverScaleDepth:        1.0 / fScaleDepth\r\n\r\n// fScaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\r\n// fScaleOverScaleDepthBlue:  fScale / fScaleDepthBlue\r\n// fOneOverScaleDepthBlue;    1.0 / fScaleDepthBlue\r\n\r\nuniform vec4 v4AtmosParams1; // (fScale, fScaleDepth, fScaleOverScaleDepth, fOneOverScaleDepth)\r\nuniform vec4 v4AtmosParams2; // (g, fScaleDepthBlue, fScaleOverScaleDepthBlue, fOneOverScaleDepthBlue)\r\n\r\nfloat fScale \x3d v4AtmosParams1.x;\r\nvec2 v2ScaleDepth \x3d vec2(v4AtmosParams1.y,v4AtmosParams2.y);//fScaleDepth, fScaleDepthBlue\r\nvec2 v2ScaleOverScaleDepth \x3d vec2(v4AtmosParams1.z,v4AtmosParams2.z);//fScaleOverScaleDepth, fScaleOverScaleDepthBlue\r\nvec2 v2OneOverScaleDepth \x3d vec2(v4AtmosParams1.w,v4AtmosParams2.w);//fOneOverScaleDepth, fOneOverScaleDepthBlue\r\n\r\n#ifndef HAZE\r\nuniform vec4 v4AtmosParams3; // (g2, fMiePhaseCoefficients, fLowerAlphaBlendBound, fOneOverOuterRadiusMinusAlphaBlendBound)\r\nuniform float fInnerFadeDistance;\r\nuniform float fAltitudeFade;\r\n\r\nfloat g \x3d v4AtmosParams2.x;\r\nfloat g2 \x3d v4AtmosParams3.x;\r\nfloat fMiePhaseCoefficients \x3d v4AtmosParams3.y;\r\nfloat fLowerAlphaBlendBound \x3d v4AtmosParams3.z;\r\nfloat fOneOverOuterRadiusMinusAlphaBlendBound \x3d v4AtmosParams3.w;\r\n#endif\r\n\r\n// Camera\r\nuniform vec3 v3CameraPos;     // The camera's current position\r\nuniform vec2 nearFar;\r\n\r\nuniform vec4 v4SphereComp;              // (fCameraHeight, fCameraHeight2, fC, fCSur)\r\nfloat fCameraHeight \x3d v4SphereComp[0];  // The camera's current height\r\nfloat fCameraHeight2 \x3d v4SphereComp[1]; // fCameraHeight^2\r\nfloat fC \x3d v4SphereComp[2];             // fCameraHeight2 - fOuterRadius2; // C \x3d ||o-c||^2 - r^2\r\nfloat fCSur \x3d v4SphereComp[3];          // fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C \x3d ||o-c||^2 - r^2\r\n\r\n// Camera HDR\r\n#ifdef HAZE\r\nconst float fExposure \x3d 1.5;\r\n#else\r\nconst float fExposure \x3d 2.0;\r\n#endif\r\n\r\n#ifdef HAZE\r\n// Depth texture\r\nuniform sampler2D tDepth;\r\n#endif\r\n\r\n// Testing variables\r\nuniform float showTest;\r\n\r\n// Varyings\r\nvarying vec3 v3EyeDir;\r\nvarying vec3 v3WorldRay;\r\nvarying vec2 vtc;\r\n\r\n// Loop constants for integral approximation\r\nconst float fSamples \x3d 5.0;\r\nconst int maxSamples \x3d 5;\r\n\r\n#ifdef HAZE\r\n  const float fOneOverGamma \x3d 1.0;//Gamma \x3d 1.0\r\n#else\r\n  const float fOneOverGamma \x3d 0.454545; // Gamma \x3d 2.2\r\n#endif\r\n  const vec3 v3OneOverGamma \x3d vec3(fOneOverGamma);\r\n\r\n// ToneMapping operators\r\nvec3 expTM(vec3 inputColor,float exposure){\r\n    return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\r\n}\r\n\r\n#ifndef HAZE\r\nvec3 reinhardTM(vec3 inputColor, float exposure){\r\n  vec3 intermediate \x3d inputColor *exposure;\r\n  intermediate /\x3d (1.0+intermediate);\r\n  return pow(intermediate, v3OneOverGamma);\r\n}\r\n#endif\r\n\r\n// Approximation for inner integral based on a radii ratio of 10.25:10\r\nfloat scale(float fCos){\r\n  float x \x3d 1.0 - fCos;\r\n  return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n}\r\n\r\nvoid main() {\r\n  vec3 cameraPosition \x3d v3CameraPos;\r\n\r\n  // Debug variables\r\n  vec3 test \x3d vec3(0.0,0.0,0.0);\r\n\r\n  // Obtain ray from Camera\r\n  vec3 worldSpaceRay \x3d normalize(v3WorldRay);\r\n\r\n  // Compute Atmosphere intersection; i.e. ray/sphere intersection\r\n  float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\r\n  float det \x3d B*B - 4.0 * fC; // det \x3d B^2 - 4.0* C\r\n\r\n  // idealized sphere intersection to discard early some pixels\r\n  float detSur \x3d B*B - 4.0 * fCSur; // det \x3d B^2 - 4.0* C\r\n\r\n  // the minimal sample start position:\r\n  // at the camera by default, on the earth radius surface if the camera is underground.\r\n  float fMinRayStart \x3d 0.0;\r\n#ifndef HAZE\r\n  // When the ray intersects the earth surface, fade the sky to a simple light direction\r\n  // based color. This is used to make sure we have a white background in underground\r\n  // mode (at noon).\r\n  float fSurfaceBlend \x3d 0.0;\r\n  vec4 surfaceColor \x3d vec4(0.0);\r\n  if (detSur \x3e\x3d 0.0) {\r\n    float nearSurfaceT \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\r\n    float farSurfaceT \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\r\n\r\n    if (nearSurfaceT \x3d\x3d 0.0) {\r\n      fMinRayStart \x3d farSurfaceT;\r\n    }\r\n\r\n    // Compute lighting at the point where the ray enters the earth surface\r\n    // Lighting computation is copied from the terrain shader.\r\n    vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurfaceT;\r\n    float fLightAngle \x3d dot(v3LightDir, normalize(vPos));\r\n    float fBrightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * fLightAngle)));\r\n\r\n    // Make the surface transparent based on altitude\r\n    surfaceColor \x3d vec4(fBrightness, fBrightness, fBrightness, 1.0 - fAltitudeFade);\r\n\r\n    // Fade based on the distance the ray travels below the earth surface\r\n    float fRelDist \x3d (farSurfaceT - nearSurfaceT) / fInnerFadeDistance;\r\n\r\n    // early exit\r\n    if (fRelDist \x3e 1.0) {\r\n      gl_FragColor \x3d surfaceColor;\r\n      return;\r\n    }\r\n\r\n    fSurfaceBlend \x3d smoothstep(0.0, 1.0, fRelDist * fRelDist);\r\n  }\r\n#endif\r\n\r\n  // Inside Atmosphere\r\n  if (det \x3e\x3d 0.0) {\r\n#ifdef HAZE\r\n    // only use red channel from depth texture.\r\n    // see 'Issues' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\r\n    float depthSample \x3d texture2D(tDepth, vtc).r;\r\n\r\n    float zNear \x3d nearFar[0];\r\n    float zFar \x3d nearFar[1];\r\n\r\n    // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\r\n    float zNorm \x3d 2.0 * depthSample - 1.0;\r\n    float linDepth \x3d 2.0 * zNear * zFar /\r\n      (zFar + zNear - zNorm * (zFar - zNear));\r\n\r\n    float rayEndT;\r\n    float altitudeAlpha \x3d 1.0;\r\n\r\n    // find intersections with ground, but only between the near and far\r\n    // clipping planes.\r\n    if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\r\n      vec3 cameraSpaceRay \x3d normalize(v3EyeDir);\r\n      cameraSpaceRay /\x3d cameraSpaceRay.z;\r\n      cameraSpaceRay *\x3d linDepth;\r\n\r\n      float cameraSpaceRayLength \x3d length(cameraSpaceRay);\r\n\r\n      vec3 v3World \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\r\n      float v3WorldRadius2 \x3d dot(v3World, v3World);\r\n\r\n      // Handle tall structures:\r\n      // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\r\n      float transitionStart \x3d fInnerRadius + 20000.0;\r\n      float transitionHeight \x3d 25000.0;\r\n      float transitionEnd \x3d transitionStart + transitionHeight;\r\n\r\n      float edge0 \x3d transitionStart * transitionStart;\r\n      float edge1 \x3d transitionEnd * transitionEnd;\r\n\r\n      altitudeAlpha \x3d 1.0 - clamp((v3WorldRadius2 - edge0) / (edge1 - edge0), 0.0, 1.0);\r\n      rayEndT \x3d cameraSpaceRayLength;\r\n\r\n      if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\r\n        float nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\r\n        float interp \x3d clamp(((fCameraHeight - fInnerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\r\n        rayEndT \x3d mix(cameraSpaceRayLength, nearSurfaceT, interp);\r\n      }\r\n    }\r\n#endif\r\n\r\n    float rayStartT \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\r\n#ifdef HAZE\r\n    float nearT \x3d abs(rayStartT);\r\n    float farT \x3d abs(rayEndT);\r\n#else\r\n    float rayEndT \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\r\n\r\n#endif\r\n\r\n    float fDistance; // calculate its scattering offset\r\n    // Calculate the ray's starting position\r\n    if (rayStartT \x3c fMinRayStart)\r\n    { // ray starts from camera or inner radius sphere to far\r\n      rayStartT \x3d fMinRayStart;\r\n#ifndef HAZE\r\n      // clamp to value at inner radius altitude\r\n      fDistance \x3d fScale * min(0.0, fInnerRadius - fCameraHeight);\r\n#endif\r\n    }\r\n#ifndef HAZE\r\n    else\r\n    { // outside atmosphere\r\n      fDistance \x3d -1.0;\r\n    }\r\n#endif\r\n\r\n    // Initialize the scattering loop variables\r\n    vec3 v3Start \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n\r\n#ifdef HAZE\r\n    vec3 v3End \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n\r\n    float fEndLength \x3d length(v3End);\r\n    float fAltitudeEnd \x3d fEndLength - fInnerRadius;\r\n    float fAltitudeStart \x3d length(v3Start) - fInnerRadius;\r\n\r\n    // for camera positions below altitude 0, invert the altitudes, to achieve\r\n    // a similar haze as above ground. Note that there is a small but visible change\r\n    // when the camera passes altitude 0.\r\n    if (fAltitudeStart \x3c 0.0) {\r\n      fAltitudeStart \x3d -fAltitudeStart;\r\n      fAltitudeEnd \x3d -fAltitudeEnd;\r\n    }\r\n\r\n    // computed for the original end point to get consistent light angles after possible inversions\r\n    float fLightAngle \x3d dot(v3LightDir, v3End) / fEndLength;\r\n\r\n    if (nearT \x3e farT)\r\n    {\r\n      if (fAltitudeStart \x3c fAltitudeEnd)\r\n      {\r\n        // Switch positive slopes for flipped rays\r\n        v3End \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n        v3Start \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n        worldSpaceRay *\x3d -1.0;\r\n        float fTmp \x3d fAltitudeStart;\r\n        fAltitudeStart \x3d fAltitudeEnd;\r\n        fAltitudeEnd \x3d fTmp;\r\n      }\r\n      else if (fAltitudeStart \x3d\x3d fAltitudeEnd)\r\n      { // create minuscule fake slope for integration if the slope is zero\r\n        fAltitudeStart +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\r\n        // slope for the camera function\r\n      }\r\n    }\r\n\r\n    // Calculate its scattering offset\r\n    // Assumes camera constrains of WSV 3.8\r\n    float fCameraDepth;\r\n    float fCameraDepthBlue;\r\n    if (fAltitudeStart \x3e fOuterRadius - fInnerRadius)\r\n    { // outside atmosphere\r\n      fDistance \x3d fInnerRadius - fOuterRadius;\r\n    } else\r\n    {\r\n      fDistance \x3d fAltitudeEnd - fAltitudeStart;\r\n    }\r\n\r\n#endif\r\n    vec2 v2OpticalStartDepth \x3d exp(fDistance * v2OneOverScaleDepth);\r\n\r\n    float fRayLength \x3d rayEndT - rayStartT;\r\n    float fSampleLength \x3d fRayLength / fSamples;\r\n    float fScaledLength \x3d fSampleLength * fScale;\r\n    vec3 v3SampleRay \x3d worldSpaceRay * fSampleLength;\r\n    vec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\r\n\r\n#ifdef HAZE\r\n    float fCameraAngle \x3d dot(-worldSpaceRay, v3End) / length(v3End);\r\n    float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n    vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth;\r\n\r\n    float scaledValues \x3d scale(fLightAngle) + fScaleCameraAngle;\r\n    vec2 v2ScaledValuesDepth \x3d scaledValues * v2ScaleDepth;\r\n#else\r\n    float fCameraAngle \x3d dot(worldSpaceRay, v3Start / length(v3Start));\r\n    float angleMultiplier \x3d fCameraAngle\x3e0.0?fCameraAngle:0.0;\r\n\r\n    float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n    vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\r\n#endif\r\n\r\n    // Loop variables\r\n    vec3 v3FrontColor \x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3FrontColorBlue \x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3Attenuate\x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3AttenuateBlue \x3d vec3(0.0, 0.0, 0.0);\r\n\r\n    // Now loop through the sample rays\r\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\r\n      float fHeight \x3d length(v3SamplePoint);\r\n      float fAltitude \x3d abs(fHeight - fInnerRadius);\r\n\r\n      vec2 v2Depth \x3d exp(-fAltitude * v2ScaleOverScaleDepth);\r\n#ifdef HAZE\r\n      vec2 v2Scatter \x3d v2Depth*v2ScaledValuesDepth-v2CameraOffset;\r\n#else\r\n      float fLightAngle \x3d dot(v3LightDir, v3SamplePoint) / fHeight;\r\n      float fCameraAngle \x3d dot(worldSpaceRay, v3SamplePoint) / fHeight;\r\n      float fTempScaledValues \x3d scale(fLightAngle) - scale(fCameraAngle);\r\n      vec2 v2Scatter \x3d v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\r\n#endif\r\n      v3Attenuate \x3d exp(-v2Scatter.x * v3InvWavelengthScaled);\r\n      v3AttenuateBlue \x3d exp(-v2Scatter.y * v3InvWavelengthScaled);\r\n\r\n      v3FrontColor +\x3d v3Attenuate * v2Depth.x;\r\n      v3FrontColorBlue +\x3d v3AttenuateBlue * v2Depth.y;\r\n\r\n      v3SamplePoint +\x3d v3SampleRay;\r\n    }\r\n\r\n    // Phase computation\r\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\r\n    float fCos \x3d clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\r\n    float fOnePlusCos2 \x3d fCos*fCos + 1.0;\r\n#ifdef HAZE\r\n    // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\r\n    vec3 colorCoefficients \x3d (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\r\n\r\n    // Scaled Length is only applied afterwards to save multiplications\r\n    vec3 v3Color \x3d colorCoefficients *v3FrontColor;\r\n    vec3 v3ColorBlue \x3d colorCoefficients *v3FrontColorBlue;\r\n#else\r\n    vec3 v3RayleighCoefficients \x3d (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\r\n    float fMieCoefficients \x3d fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\r\n\r\n    // Calculate the attenuation factor for the ground\r\n    vec3 v3Color \x3d v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\r\n    vec3 v3ColorBlue \x3d v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\r\n#endif\r\n\r\n    // HDR to LDR conversion\r\n    vec3 ldrBlue \x3d expTM(v3ColorBlue,2.0*fExposure);\r\n    vec3 ldrRed \x3d expTM(v3Color,fExposure);\r\n\r\n    // mix reddish and blueish atmosphere\r\n    vec3 LDR \x3d mix(ldrBlue,ldrRed,0.2);\r\n#ifdef HAZE\r\n    LDR *\x3d (1.0-fCameraAngle);\r\n    vec3 hsv \x3d rgb2hsv(LDR);\r\n    hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0); // boost haze saturation by 50%\r\n    LDR \x3d hsv2rgb(hsv);\r\n    vec3 finalColor \x3d LDR;\r\n    // when rendering we specify the blend functions such that\r\n    // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\r\n#else\r\n    // reinhard tonemapper for looking upwards\r\n    vec3 ldrReinhard \x3d reinhardTM(v3Color,fExposure);\r\n    LDR +\x3d angleMultiplier*ldrReinhard;\r\n\r\n    // height dependent parameter to smooth out reddish atmosphere\r\n    float side \x3d (rayEndT+rayStartT)*0.5;\r\n    float atmoHeight \x3d sqrt(fCameraHeight2 - side*side);\r\n    float h2 \x3d clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\r\n\r\n    vec3 finalColor \x3d LDR*h2;\r\n    vec3 hsv \x3d rgb2hsv(finalColor);\r\n    hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0); // boost sky saturation by 50%\r\n    finalColor \x3d hsv2rgb(hsv);\r\n#endif\r\n\r\n#ifndef HAZE\r\n    float atmosStrength \x3d clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\r\n    gl_FragColor \x3d vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\r\n    if (fSurfaceBlend \x3e 0.0) {\r\n      gl_FragColor \x3d mix(gl_FragColor, surfaceColor, fSurfaceBlend);\r\n    }\r\n#else\r\n    gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;\r\n#endif\r\n\r\n    // Debug variable overlay\r\n    if(showTest\x3e0.0){\r\n      gl_FragColor \x3d vec4(test,1.0);\r\n    }\r\n  } else { // Outside Atmosphere\r\n    gl_FragColor \x3d vec4(0.0);\r\n  }\r\n}\r\n",
"realisticAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n// Camera\r\nuniform vec2 halfSizeNearPlane;\r\nuniform vec3 v3CameraUp;\r\nuniform vec3 v3CameraRight;\r\nuniform vec3 v3CameraDir;\r\nuniform vec2 v2CameraCenterOffset;\r\n\r\n// Attributes\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\n// Varyings\r\nvarying vec3 v3WorldRay;\r\nvarying vec2 vtc;\r\n\r\n#ifdef HAZE\r\nvarying vec3 v3EyeDir;\r\n#endif\r\n\r\nvoid main(void) {\r\n  vec3 v3Pos \x3d position;\r\n  vtc \x3d uv0;\r\n  vec2 rayvtc \x3d uv0 - v2CameraCenterOffset;\r\n\r\n#ifdef HAZE\r\n  v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#else\r\n  vec3 v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#endif\r\n  v3WorldRay \x3d v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\r\n  gl_Position \x3d vec4(v3Pos, 1.0);\r\n}\r\n",
"simpleAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\nvarying float falloff;\r\n\r\n#ifndef PANORAMIC\r\nuniform float altitudeFade;\r\nvarying float innerFactor;\r\n#endif\r\n\r\nvoid main() {\r\n  vec4 texColor \x3d texture2D(tex, vtc);\r\n\r\n#ifdef PANORAMIC\r\n  gl_FragColor \x3d texColor * falloff;\r\n#else\r\n  vec4 atmosphereColor \x3d texColor * falloff;\r\n  vec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\r\n  gl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\r\n#endif\r\n}\r\n",
"simpleAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\n\r\n#ifndef PANORAMIC\r\nconst float TWICEPI \x3d 2.0*3.14159265;\r\nconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\r\n\r\nuniform vec3 silCircleCenter;\r\nuniform vec3 silCircleV1;\r\nuniform vec3 silCircleV2;\r\nuniform vec2 texV;\r\n\r\nuniform float innerScale;  // scale for inner rim\r\nvarying float innerFactor; // 0: outer atmosphere, 1: inner atmosphere\r\n#endif\r\n\r\nuniform vec3 lightDirection;\r\n\r\nattribute vec3 position;\r\nvarying vec2 vtc;\r\nvarying float falloff;\r\n\r\nvoid main(void) {\r\n\r\n#ifdef PANORAMIC\r\n\r\n  vec3 pos \x3d position;\r\n  float ndotl \x3d lightDirection.z;\r\n  vtc \x3d vec2(0.0, position.z+0.05);\r\n\r\n#else\r\n\r\n  innerFactor \x3d clamp(-position.z, 0.0, 1.0);\r\n  float scale \x3d position.y * (1.0 + innerFactor * innerScale);\r\n  float phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\r\n  vec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\r\n  float ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\r\n\r\n  vtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\r\n  vtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\r\n\r\n#endif\r\n\r\n  falloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\r\n\r\n  gl_Position \x3d proj * view * vec4(pos, 1.0);\r\n  gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n}\r\n",
"simpleAtmosphereFade.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","simpleAtmosphereFade.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\n\r\nuniform vec3 lightDirection;\r\nuniform vec3 cameraPosition;\r\n\r\nuniform float undergroundFadeAlpha;\r\n\r\nvarying vec4 color;\r\n\r\nvoid main(void) {\r\n  float ndotl \x3d dot(normalize(cameraPosition), lightDirection);\r\n  float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\r\n\r\n  color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\r\n\r\n  gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\r\n}\r\n",
"stars.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec4 vcolor;\r\nvarying float vsize;\r\n\r\nvoid main() {\r\n  float cap \x3d 0.7;\r\n  float scale \x3d 1.0/cap;\r\n  float helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\r\n  float alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\r\n  float intensity \x3d alpha*alpha*alpha;\r\n  if (vsize \x3c 3.0)\r\n    intensity *\x3d 0.5;\r\n  gl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\r\n  gl_FragColor.xyz *\x3d vcolor.xyz;\r\n}\r\n",
"stars.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform vec4 viewport;\r\nuniform float pixelRatio;\r\n\r\nattribute vec3 position;\r\nattribute vec4 color;\r\nattribute float size;\r\n\r\nvarying vec4 vcolor;\r\nvarying float vsize;\r\n\r\nvoid main(void) {\r\n  vec4 posProj \x3d proj * view * model*vec4(position*1.0e25,1.0);//move infinitely far away\r\n  gl_Position \x3d alignToPixelCenter(posProj, viewport.zw); //pixel align position\r\n  gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n  vcolor \x3d color / 1.2;\r\n  vsize \x3d size * 5.0 * pixelRatio;\r\n  gl_PointSize \x3d vsize;\r\n}\r\n"},
materials:{checkerBoard:{"checkerBoard.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec2 size;\r\nuniform vec4 color1;\r\nuniform vec4 color2;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main() {\r\n  vec2 uvScaled \x3d vUV / (2.0 * size);\r\n\r\n  vec2 uv \x3d fract(uvScaled - 0.25);\r\n  vec2 ab \x3d clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\r\n  float fade \x3d smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\r\n  float t \x3d mix(abs(ab.x + ab.y), 0.5, fade);\r\n\r\n  gl_FragColor \x3d mix(color2, color1, t);\r\n}\r\n",
"checkerBoard.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n  vUV \x3d uv0;\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n}\r\n"},color:{"color.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 eColor;\r\n#ifdef VERTEX_COLORS\r\nvarying vec4 vColor;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef VERTEX_COLORS\r\n  gl_FragColor \x3d vColor * eColor;\r\n#else\r\n  gl_FragColor \x3d eColor;\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\r\n}\r\n",
"color.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n#ifdef VERTEX_COLORS\r\nattribute vec4 color;\r\n\r\nvarying vec4 vColor;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#ifdef VERTEX_COLORS\r\n  vColor \x3d color * 0.003921568627451; // \x3d 1/255;\r\n#endif\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n"},
defaultMaterial:{"colorMixMode.glsl":"#include \x3cutil/color.glsl\x3e\r\n\r\n/*\r\n * The color mix modes are encoded in the symbol color as follows:\r\n *  - Fully transparent symbols are represented with alpha 0 for\r\n *    all color mix modes (except ignore).\r\n *  - color mix mode ignore is encoded as multiply with white\r\n *  - the other 3 color mix modes (tint, replace, multiply) are\r\n *    equally distributed on the remaining 255 alpha values, which\r\n *    gives us 85 possible alpha values\r\n *\r\n * alpha             0 : fully transparent\r\n * alpha in [  1 -  85]: tint\r\n * alpha in [ 86 - 170]: replace\r\n * alpha in [171 - 255]: multiply\r\n */\r\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\r\n  float symbolAlpha \x3d 0.0;\r\n\r\n  const float maxTint \x3d 85.0;\r\n  const float maxReplace \x3d 170.0;\r\n  const float scaleAlpha \x3d 3.0;\r\n\r\n  if (symbolColor.a \x3d\x3d 0.0) {\r\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\r\n    symbolAlpha \x3d 0.0;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxTint) {\r\n    colorMixMode \x3d 0; // tint\r\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxReplace) {\r\n    colorMixMode \x3d 3; // replace\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\r\n  }\r\n  else {\r\n    colorMixMode \x3d 1;  // multiply\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\r\n  }\r\n\r\n  return vec4(symbolColor.rgb, symbolAlpha);\r\n}\r\n\r\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  vec3 internalMixed \x3d internalColor * textureColor;\r\n  vec3 allMixed \x3d internalMixed * externalColor;\r\n\r\n  if (mode \x3d\x3d 1 /* multiply */) {\r\n    return allMixed;\r\n  }\r\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalColor;\r\n  }\r\n  else {\r\n    // tint (or something invalid)\r\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\r\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\r\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\r\n    return hsv2rgb(hsvOut);\r\n  }\r\n}\r\n\r\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  float internalMixed \x3d internalOpacity * textureOpacity;\r\n  float allMixed \x3d internalMixed * externalOpacity;\r\n\r\n  if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalOpacity;\r\n  }\r\n  else {\r\n    // multiply or tint (or something invalid)\r\n    return allMixed;\r\n  }\r\n}\r\n",
"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\r\n#endif\r\n\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n// material parameters\r\n//////////////////////////////////////////\r\nuniform vec3 ambient;\r\nuniform vec3 diffuse;\r\nuniform vec3 specular;\r\nuniform float opacity;\r\nuniform float layerOpacity;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#else\r\nuniform int colorMixMode;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\n#endif\r\n\r\n#ifdef RECEIVE_SSAO\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\nvarying vec3 vnormal;\r\n#if defined(VERTEXCOLORS)\r\nvarying vec4 vcolor;\r\n#endif\r\nvarying vec4 vcolorExt;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#include \x3cutil/shadow.glsl\x3e\r\n#endif\r\n\r\n#ifdef TREE_RENDERING\r\n  uniform mat4 view;\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  vec4 texColor \x3d textureLookup(tex, vtc);\r\n\r\n#ifdef TEXTURE_ALPHA_TEST\r\n  if (texColor.a * coverageCorrectionFactor(vtc) \x3c textureAlphaCutoff) {\r\n    discard;\r\n  }\r\n#endif\r\n#else /* TEXTURING */\r\n  vec4 texColor \x3d vec4(1.0);\r\n#endif /* TEXTURING */\r\n\r\n  vec3 viewDir \x3d vpos - camPos;\r\n\r\n  // compute normal\r\n  // TODO: this is not in sync with the normal pass\r\n#ifdef GROUND_NORMAL_SHADING\r\n#ifdef VIEWING_MODE_GLOBAL\r\n  vec3 normal \x3d normalize(vpos + localOrigin);\r\n#else\r\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n#else\r\n#ifdef DOUBLESIDED\r\n  vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\r\n#elif defined(WINDINGORDERDOUBLESIDED)\r\n  vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\r\n#else\r\n  vec3 normal \x3d vnormal;\r\n#endif\r\n  normal \x3d normalize(normal);\r\n#endif\r\n\r\n  // compute ssao\r\n#ifdef RECEIVE_SSAO\r\n  float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n  ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\r\n#else\r\n  float ssao \x3d 1.0;\r\n#endif\r\n\r\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\r\n  float additionalAmbientScale;\r\n  vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\r\n\r\n  // compute shadowing\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#elif defined(VIEWING_MODE_GLOBAL)\r\n  // at global scale (and in global scenes) we fall back to this approximation\r\n  // to shadow objects on the dark side of the earth\r\n  shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\r\n#endif\r\n\r\n  vec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\r\n#if defined(VERTEXCOLORS)\r\n  // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\r\n  vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n#else\r\n  // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\r\n  vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n#endif\r\n  albedo_+\x3d 0.25 * specular; // don't completely ignore specular for now\r\n\r\n  vec3 shadingNormal \x3d normal;\r\n\r\n  #ifdef TREE_RENDERING\r\n    // make sure we use unflipped normal\r\n    shadingNormal \x3d normalize(vnormal);\r\n\r\n    // make tree 20% brighter\r\n    albedo_ *\x3d 1.2;\r\n\r\n    // view forward vector in global coordinates\r\n    vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\r\n\r\n    // factor indicating how aligned the lighting direction and view axis are\r\n    float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\r\n\r\n    // we approximate the tree crown transmittance based on view direction and tree crown normal\r\n    float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadingNormal), 0.0, 1.0);\r\n\r\n    float treeRadialFalloff \x3d vcolor.r;\r\n    float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\r\n    additionalLight +\x3d backLightFactor * lightingMainIntensity;\r\n  #endif\r\n\r\n  vec3 shadedColor \x3d evaluateSceneLighting(shadingNormal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n  gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\n#ifdef INSTANCEDCOLOR\r\nattribute vec4 instanceColor;\r\n#endif\r\nattribute vec3 position;\r\n#ifdef COMPRESSED_NORMALS\r\nattribute vec2 normalCompressed;\r\n#else\r\nattribute vec3 normal;\r\n#endif\r\nvarying vec3 vpos;\r\nvarying vec3 vnormal;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\nuniform sampler2D uComponentColorTex;\r\nuniform vec2 uComponentColorTexInvDim;\r\n\r\nattribute float componentIndex;\r\n\r\nvec4 readComponentColor() {\r\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n  vec2 indexCoord \x3d vec2(\r\n    mod(normalizedIndex, 1.0),\r\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n  );\r\n  return texture2D(uComponentColorTex, indexCoord);\r\n}\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\nattribute vec4 color;\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\nattribute vec4 symbolColor;\r\n#endif\r\n\r\n#if defined(VERTEXCOLORS)\r\nvarying vec4 vcolor;\r\n#endif\r\n\r\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\r\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\r\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\r\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\r\n// This should be further cleaned up later with through the following issue:\r\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\r\nuniform vec4 externalColor;\r\nvarying vec4 vcolorExt;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE) || defined(VV_COLOR)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/constants.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\r\n\r\nvoid main() {\r\n\r\n#ifdef VERTEXCOLORS\r\n  vcolor \x3d color * 0.003921568627451; // \x3d 1/255\r\n#endif\r\n\r\n  vcolorExt \x3d externalColor;\r\n\r\n#ifdef INSTANCEDCOLOR\r\n  vcolorExt *\x3d instanceColor;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  vcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n  if (vcolorExt.a \x3c SYMBOL_ALPHA_CUTOFF) {\r\n    // Discard this vertex\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\r\n  }\r\n  else {\r\n    vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vnormal \x3d normalize(modelNormal * localNormal().xyz);\r\n\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n  #ifdef IOS_SAFARI_FIX\r\n    originDelta \x3d originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\r\n  #endif\r\n  vpos -\x3d originDelta;\r\n\r\n  #ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d model * localCenter().xyz + originDelta;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n  #endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n  vnormal \x3d normalize((modelNormal * localNormal()).xyz);\r\n  #ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * localCenter()).xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n  #endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n  }\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n\r\n#ifdef TEXTURING\r\n  #ifndef FLIPV\r\n    vtc \x3d uv0;\r\n  #else\r\n    vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n  #endif\r\n  #ifdef TEXTURE_ATLAS\r\n    regionV \x3d region;\r\n  #endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"commonFunctions.glsl":"#include \x3cmaterials/defaultMaterial/localPosition.glsl\x3e\r\n#include \x3cutil/doublePrecision.glsl\x3e\r\n\r\nvec3 calculateVPos() {\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  return model * localPosition().xyz;\r\n#else\r\n  return (model * localPosition()).xyz;\r\n#endif\r\n}\r\n\r\n#ifdef VERTICAL_OFFSET\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n#include \x3cutil/screenSizePerspective.glsl\x3e\r\n#endif\r\n\r\nvec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\r\n  float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\r\n  float verticalOffsetOffsetDistance \x3d verticalOffset.x * viewDistance;\r\n\r\n#ifdef VIEWING_MODE_GLOBAL\r\n  vec3 worldNormal \x3d normalize(worldPos + localOrigin);\r\n#else\r\n  vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\r\n\r\n  float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\r\n#else\r\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n  // Screen sized offset in world space, used for example for line callouts\r\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\r\n\r\n  return worldNormal * worldOffset;\r\n}\r\n#endif\r\n",
"commonInputs.glsl":"uniform mat4 proj;\r\nuniform mat4 view;\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\nuniform vec3 viewOriginHi;\r\nuniform vec3 viewOriginLo;\r\n#endif\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\nattribute vec3 modelOriginHi;\r\nattribute vec3 modelOriginLo;\r\nattribute mat3 model;\r\nattribute mat3 modelNormal;\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\nattribute mat4 model;\r\nattribute mat4 modelNormal;\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n#else /* INSTANCED */\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n#endif /* INSTANCED */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n// [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\r\nuniform vec4 verticalOffset;\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\nuniform vec4 screenSizePerspectiveAlignment;\r\n#endif\r\n#endif\r\n",
"constants.glsl":"#define SYMBOL_ALPHA_CUTOFF 0.001\r\n","depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#if defined(TEXTURING) \x26\x26 defined(TEXTURE_ALPHA_TEST)\r\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c textureAlphaCutoff) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n#ifndef BIAS_SHADOWMAP\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n}\r\n",
"depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nuniform vec2 nearFar;\r\nattribute vec3 position;\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n#ifdef IOS_SAFARI_FIX\r\n  originDelta \x3d originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\r\n#endif\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz + originDelta;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1.0);\r\n\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#if defined(TEXTURING) \x26\x26 defined(TEXTURE_ALPHA_TEST)\r\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c textureAlphaCutoff) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nattribute vec3 position;\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n#ifdef IOS_SAFARI_FIX\r\n  originDelta \x3d originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\r\n#endif\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz + originDelta;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"localCenter.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\r\n# ifdef VERTICAL_OFFSET\r\nvec4 localCenter() { return vvTransformPosition(vec3(0.0), instanceFeatureAttribute); }\r\n# endif\r\n#else\r\n# ifdef VERTICAL_OFFSET\r\nvec4 localCenter() { return vec4(vec3(0.0), 1.0); }\r\n# endif\r\n#endif\r\n","localNormal.glsl":"#include \x3cutil/normalEncoding.glsl\x3e\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n# ifdef COMPRESSED_NORMALS\r\nvec4 localNormal() { return vvTransformNormal(decodeNormal(normalCompressed), instanceFeatureAttribute); }\r\n# else\r\nvec4 localNormal() { return vvTransformNormal(normal, instanceFeatureAttribute); }\r\n# endif\r\n#else\r\n# ifdef COMPRESSED_NORMALS\r\nvec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\r\n# else\r\nvec4 localNormal() { return vec4(normal, 1.0); }\r\n# endif\r\n#endif\r\n",
"localPosition.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\r\nvec4 localPosition() { return vvTransformPosition(position, instanceFeatureAttribute); }\r\n#else\r\nvec4 localPosition() { return vec4(position, 1.0); }\r\n#endif\r\n","normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#if defined(TEXTURING) \x26\x26 defined(TEXTURE_ALPHA_TEST)\r\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c textureAlphaCutoff) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n}\r\n",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nuniform mat4 viewNormal;\r\nattribute vec3 position;\r\n#ifdef COMPRESSED_NORMALS\r\nattribute vec2 normalCompressed;\r\n#else\r\nattribute vec3 normal;\r\n#endif\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vnormal \x3d normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\r\n\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n#ifdef IOS_SAFARI_FIX\r\n  originDelta \x3d originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\r\n#endif\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz + originDelta;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n  vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"texturing.glsl":"float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\r\n  // from:\r\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\r\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\r\n  //   - http://www.linedef.com/virtual-texture-demo.html\r\n  float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\r\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\r\n}\r\n\r\n// based on https://medium.com/@bgolus/anti-aliased-alpha-test-the-esoteric-alpha-to-coverage-8b177335ae4f\r\nfloat coverageCorrectionFactor(vec2 uv) {\r\n#ifdef ALPHA_COVERAGE_CORRECTION\r\n  const float MipScale \x3d 0.25;\r\n  uv *\x3d texSize;\r\n#ifdef TEXTURE_ATLAS\r\n  uv *\x3d region.zw - region.xy;\r\n#endif\r\n  return 1.0 + max(0.0, calcMipMapLevel(dFdx(uv), dFdy(uv))) * MipScale;\r\n#else\r\n  return 1.0;\r\n#endif\r\n}\r\n\r\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\r\n  //[umin, vmin, umax, vmax]\r\n  vec2 atlasScale \x3d region.zw - region.xy;\r\n  vec2 uvAtlas \x3d fract(uv) * atlasScale + region.xy;\r\n\r\n  vec4 texColor;\r\n\r\n  // calculate derivative of continuous texture coordinate\r\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\r\n  vec2 dUVdx \x3d dFdx(uv) * atlasScale;\r\n  vec2 dUVdy \x3d dFdy(uv) * atlasScale;\r\n\r\n#ifdef GL_EXT_shader_texture_lod\r\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\r\n#else\r\n  // use bias to compensate for difference in automatic vs desired mipmap level\r\n  vec2 dUVdxAuto \x3d dFdx(uvAtlas);\r\n  vec2 dUVdyAuto \x3d dFdy(uvAtlas);\r\n  float mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\r\n  float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\r\n\r\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\r\n#endif\r\n}\r\n\r\nvec4 textureLookup(sampler2D tex, vec2 uv) {\r\n#ifdef TEXTURE_ATLAS\r\n  return textureAtlasLookup(tex, uv, regionV, texSize);\r\n#else\r\n  return texture2D(tex, uv);\r\n#endif\r\n}\r\n\r\n",
"texturingInputs.glsl":"#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\n\r\n#ifdef TEXTURE_ALPHA_TEST\r\nuniform float textureAlphaCutoff;\r\n#endif\r\n\r\nvarying vec2 vtc;\r\n\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n\r\n#endif\r\n"},hud:{"colorPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\r\n\r\nvoid main() {\r\n#include \x3cmaterials/hud/hudMain.glsl\x3e\r\n}\r\n","highlightPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvoid main() {\r\n#include \x3cmaterials/hud/hudMain.glsl\x3e\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  // Instead of deciding on a per-pixel basis if the highlight is occluded,\r\n  // do it for all highlight pixel based on the centroid occlusion. This\r\n  // is a temporary solution for:\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\r\n  if (voccluded \x3d\x3d 1.0) {\r\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n  } else {\r\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n#else\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n#endif\r\n}\r\n",
"hud.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec2 screenOffset;\r\nuniform vec2 anchorPos;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\nuniform vec4 screenSizePerspective;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\nvarying vec3 debugBorderCoords;\r\n#endif\r\n\r\nattribute vec2 uv0;\r\nattribute vec4 color;\r\nattribute vec2 size;\r\nattribute vec4 auxpos2;\r\n\r\nvarying vec4 vcolor;\r\n\r\nvarying vec2 vtc;\r\nvarying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvarying float voccluded;\r\n#endif\r\n\r\nvoid main(void) {\r\n  ProjectHUDAux projectAux;\r\n  vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n  if (rejectBySlice(projectAux.posModel)) {\r\n    // Project outside of clip plane\r\n    gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n    return;\r\n  }\r\n\r\n  vec2 inputSize;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\r\n\r\n  vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n\r\n#else\r\n\r\n  inputSize \x3d size;\r\n\r\n  vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n#ifdef VV_SIZE\r\n  // only use width (.xx) for proportional scaling\r\n  // (if no width was defined in vv, width\r\n  //  will be a copy of height vv)\r\n  inputSize *\x3d vvGetScale(auxpos2).xx;\r\n#endif\r\n\r\n  vec2 combinedSize \x3d inputSize * pixelRatio;\r\n  vec4 quadOffset \x3d vec4(0.0);\r\n\r\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\r\n  bool visible \x3d testVisibilityHUD(posProj);\r\n#endif\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvoccluded \x3d visible ? 0.0 : 1.0;\r\n#endif\r\n\r\n#ifdef OCCL_TEST\r\n  if (visible) {\r\n#endif\r\n    // UV goes from 0 to 1.99999, where the integer part is used\r\n    // for the normalized vertex coordinates, and the fractional\r\n    // part is used for texture sampling\r\n    vec2 uv01 \x3d floor(uv0);\r\n    vec2 uv \x3d uv0 - uv01;\r\n\r\n    // Displace icon based on anchor position (normalized for size) and\r\n    // absolute screen offset. anchorPos is [-0.5, 0.5]\r\n    quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n\r\n    // SDF primitives might be scaled so that the SDF texture resolution does\r\n    // not match the resolution of the canvas, but we still want to render\r\n    // outline-only ('cross' and 'x') primitives cleanly. Aligning to a screen\r\n    // pixel border at the geometry center achieves this, since SDF textures\r\n    // always have power of 2 dimensions.\r\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\r\n#else\r\n    posProj +\x3d quadOffset;\r\n\r\n    // Aligning vertex positions to the nearest (using 'floor') screen pixel\r\n    // border renders textures with pixel-perfect results. If the texture\r\n    // resolution does not match the canvas resolution then aligning is\r\n    // redundant.\r\n    if (inputSize.x \x3d\x3d size.x) {\r\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\r\n    }\r\n#endif\r\n\r\n    gl_Position \x3d posProj;\r\n\r\n    vtc \x3d uv;\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n    debugBorderCoords \x3d vec3(uv01, 1.0 / combinedSize);\r\n#endif\r\n\r\n    vsize \x3d inputSize;\r\n#ifdef OCCL_TEST\r\n  } else {\r\n    vtc \x3d vec2(.0);\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n    debugBorderCoords \x3d vec3(0.0);\r\n#endif\r\n\r\n  }\r\n#endif\r\n\r\n  gl_Position \x3d posProj;\r\n\r\n#ifdef VV_COLOR\r\n  vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors);\r\n#else\r\n  vcolor \x3d color / 255.0;\r\n#endif\r\n}\r\n",
"hudHeader.glsl":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/color.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\nuniform vec4 overrideColor;\r\nuniform vec4 outlineColor;\r\nuniform float outlineSize;\r\n\r\nvarying vec4 vcolor;\r\n\r\nvarying vec2 vtc;\r\nvarying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvarying float voccluded;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\nvarying vec3 debugBorderCoords;\r\n#endif\r\n",
"hudMain.glsl":"#ifdef SIGNED_DISTANCE_FIELD\r\n  vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n  vec4 fillPixelColor \x3d overrideColor * vcolor;\r\n\r\n  // Attempt to sample texel centers to avoid that thin cross outlines\r\n  // disappear with large symbol sizes.\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\r\n  const float txSize \x3d 128.0;\r\n  const float texelSize \x3d 1.0 / txSize;\r\n  // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\r\n  vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\r\n  vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\r\n\r\n  // Get distance and map it into [-0.5, 0.5]\r\n  float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\r\n\r\n  // Distance in output units (i.e. pixels)\r\n  float dist \x3d d * vsize.x;\r\n\r\n  // Create smooth transition from the icon into its outline\r\n  fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n  if (outlineSize \x3e 0.25) {\r\n    vec4 outlinePixelColor \x3d outlineColor;\r\n    float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\r\n\r\n    // Create smooth transition around outline\r\n    outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\r\n\r\n    // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\r\n    float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n    vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\r\n      vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n\r\n    gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\r\n  }\r\n\r\n  // visualize SDF:\r\n  // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\r\n#else\r\n\r\n  // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\r\n  // fragment color. Input textures should already be pre-multiplied and so\r\n  // don't require adjustment, but the override and vertex colors must be\r\n  // modulated by their alpha values.\r\n\r\n  gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiplyAlpha(overrideColor * vcolor);\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n   float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\r\n   gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);\r\n#endif\r\n\r\n  if (gl_FragColor.a \x3c 0.1) {\r\n    discard;\r\n  }\r\n",
"occlusionTest.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","occlusionTest.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vec4 posProjCenter;\r\n\r\n  // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\r\n  // are removed before the VBO is recompacted. If this is the case, then we just project outside\r\n  // of clip space.\r\n  if (dot(position, position) \x3e 0.0) {\r\n    // Render single point to center of the pixel to avoid subpixel filtering to affect\r\n    // the marker color\r\n    ProjectHUDAux projectAux;\r\n    vec4 posProj \x3d projectPositionHUD(projectAux);\r\n    posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n    vec3 vpos \x3d projectAux.posModel;\r\n    if (rejectBySlice(vpos)) {\r\n      // Project out of clip space\r\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n    }\r\n  }\r\n  else {\r\n    // Project out of clip space\r\n    posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n  }\r\n\r\n  gl_Position \x3d posProjCenter;\r\n  gl_PointSize \x3d 1.0;\r\n}\r\n"},
lineCallout:{"lineCallout.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\nuniform vec4 borderColor;\r\n\r\nvarying vec4 coverageSampling;\r\nvarying vec2 lineSizes;\r\n\r\nvoid main() {\r\n  // Mix between line and border coverage offsets depending on whether we need\r\n  // a border (based on the sidedness).\r\n  vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\r\n\r\n  // Mix between border and line color based on the line coverage (conceptually the line\r\n  // blends on top of the border background).\r\n  //\r\n  // Anti-alias by blending final result using the full (including optional border) coverage\r\n  // and the color alpha\r\n  float borderAlpha \x3d color.a * borderColor.a * coverage.y;\r\n  float colorAlpha \x3d color.a * coverage.x;\r\n\r\n  float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n  if (finalAlpha \x3c 0.01) {\r\n    discard;\r\n  }\r\n\r\n#else\r\n\r\n  // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\r\n  // need to divide by finalAlpha). We avoid the division here by setting the\r\n  // appropriate blending function in the material.\r\n  vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\r\n\r\n  gl_FragColor \x3d vec4(finalRgb, finalAlpha);\r\n\r\n#endif\r\n\r\n}\r\n",
"lineCallout.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nattribute vec2 uv0;\r\n\r\nuniform float lineSize;\r\nuniform vec2 pixelToNDC;\r\nuniform float borderSize;\r\nuniform vec2 screenOffset;\r\n\r\nvarying vec4 coverageSampling;\r\nvarying vec2 lineSizes;\r\n\r\nvoid main(void) {\r\n\r\n  ProjectHUDAux projectAux;\r\n  vec4 endPoint \x3d projectPositionHUD(projectAux);\r\n\r\n  vec3 vpos \x3d projectAux.posModel;\r\n  if (rejectBySlice(vpos)) {\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\r\n    return;\r\n  }\r\n\r\n#ifdef OCCL_TEST\r\n  if (!testVisibilityHUD(endPoint)) {\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\r\n    return;\r\n  }\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n  vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\r\n#else\r\n  vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n  // Add view dependent polygon offset to get exact same original starting point. This is mostly\r\n  // used to get the correct depth value\r\n  vec3 posView \x3d (view * (model * vec4(position, 1.0))).xyz;\r\n  applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\r\n\r\n  vec4 startPoint \x3d proj * vec4(posView, 1.0);\r\n\r\n  // Apply screen offset to both start and end point\r\n  vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\r\n\r\n  startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\r\n  endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\r\n\r\n  // Align start and end to pixel origin\r\n  vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\r\n  vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n#ifdef DEPTH_HUD_ALIGN_START\r\n  endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\r\n#else\r\n  startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\r\n#endif\r\n\r\n#endif\r\n\r\n  vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\r\n\r\n  // The direction of the line in screen space\r\n  vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\r\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\r\n  float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\r\n\r\n#else\r\n\r\n  float lineSizeScaled \x3d lineSize;\r\n  float borderSizeScaled \x3d borderSize;\r\n\r\n#endif\r\n\r\n  float halfPixelSize \x3d lineSizeScaled * 0.5;\r\n  // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\r\n  // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\r\n  // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\r\n  // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\r\n  float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\r\n  float halfPixelSizeInt \x3d floor(halfWholePixelSize);\r\n\r\n  // Sub-pixel offset if we need to grow sub-pixels to the left\r\n  float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\r\n\r\n  // Pixel offset aligning to whole pixels and adding subpixel offset if needed\r\n  float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\r\n\r\n  // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\r\n  float padding \x3d 1.0 + borderSizeScaled;\r\n  vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\r\n\r\n  // Offset x/y from the center of the line in screen space\r\n  projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\r\n\r\n  // Compute a coverage varying which we can use in the fragment shader to determine\r\n  // how much a pixel is actually covered by the line (i.e. to anti alias the line).\r\n  // This works by computing two coordinates that can be linearly interpolated and then\r\n  // subtracted to find out how far away from the line edge we are.\r\n  float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\r\n\r\n  float halfBorderSize \x3d 0.5 * borderSizeScaled;\r\n  float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\r\n  float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\r\n\r\n  float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\r\n\r\n  coverageSampling \x3d vec4(\r\n    // Edge coordinate\r\n    outerEdgeCoverageSampler,\r\n\r\n    // Border edge coordinate\r\n    outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\r\n\r\n    // Line offset\r\n    halfPixelSize - 0.5,\r\n\r\n    // Border offset\r\n    halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\r\n  );\r\n\r\n  lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\r\n\r\n  gl_Position \x3d projectedPosition;\r\n}\r\n"},
measurementArrow:{"measurementArrow.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform float outlineSize;\r\nuniform vec4 outlineColor;\r\nuniform float stripeLength;\r\nuniform vec4 stripeEvenColor;\r\nuniform vec4 stripeOddColor;\r\n\r\nvarying vec2 vtc;\r\nvarying float vlength;\r\nvarying float vradius;\r\n\r\n#define INV_SQRT2 (1.0 / sqrt(2.0))\r\n\r\nvec4 arrowColor(vec2 tc, float len) {\r\n  float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\r\n  d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\r\n  d \x3d min(d, 1.0 - abs(tc.y));\r\n\r\n  if (d \x3c 0.0) {\r\n    return vec4(0.0);\r\n  } else if (d \x3c outlineSize) {\r\n    return outlineColor;\r\n  } else {\r\n    return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\r\n  }\r\n}\r\n\r\nvoid main(void) {\r\n  vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\r\n  vec4 color \x3d arrowColor(ntc, vlength / vradius);\r\n  if (color.a \x3d\x3d 0.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d color;\r\n}\r\n",
"measurementArrow.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nuniform float width;\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv0;\r\nattribute float auxpos1;\r\n\r\nvarying vec2 vtc;\r\nvarying float vlength;\r\nvarying float vradius;\r\n\r\nvoid main(void) {\r\n  vec3 bitangent \x3d normal;\r\n\r\n  vtc \x3d uv0;\r\n  vlength \x3d auxpos1;\r\n  vradius \x3d 0.5 * width;\r\n\r\n  vec4 pos \x3d view * vec4((model * vec4(position + vradius * bitangent * uv0.y, 1.0)).xyz, 1.0);\r\n  gl_Position \x3d proj * pos;\r\n}\r\n"},
nativeLine:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 color;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  gl_FragColor \x3d highlightSlice(color, vpos);\r\n}\r\n","highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"nativeLine.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n"},pathMaterial:{"colorMixMode.glsl":"#include \x3cutil/color.glsl\x3e\r\n\r\n/*\r\n * The color mix modes are encoded in the symbol color as follows:\r\n *  - Fully transparent symbols are represented with alpha 0 for\r\n *    all color mix modes (except ignore).\r\n *  - color mix mode ignore is encoded as multiply with white\r\n *  - the other 3 color mix modes (tint, replace, multiply) are\r\n *    equally distributed on the remaining 255 alpha values, which\r\n *    gives us 85 possible alpha values\r\n *\r\n * alpha             0 : fully transparent\r\n * alpha in [  1 -  85]: tint\r\n * alpha in [ 86 - 170]: replace\r\n * alpha in [171 - 255]: multiply\r\n */\r\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\r\n  float symbolAlpha \x3d 0.0;\r\n\r\n  const float maxTint \x3d 85.0;\r\n  const float maxReplace \x3d 170.0;\r\n  const float scaleAlpha \x3d 3.0;\r\n\r\n  if (symbolColor.a \x3d\x3d 0.0) {\r\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\r\n    symbolAlpha \x3d 0.0;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxTint) {\r\n    colorMixMode \x3d 0; // tint\r\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxReplace) {\r\n    colorMixMode \x3d 3; // replace\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\r\n  }\r\n  else {\r\n    colorMixMode \x3d 1;  // multiply\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\r\n  }\r\n\r\n  return vec4(symbolColor.rgb, symbolAlpha);\r\n}\r\n\r\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  vec3 internalMixed \x3d internalColor * textureColor;\r\n  vec3 allMixed \x3d internalMixed * externalColor;\r\n\r\n  if (mode \x3d\x3d 1 /* multiply */) {\r\n    return allMixed;\r\n  }\r\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalColor;\r\n  }\r\n  else {\r\n    // tint (or something invalid)\r\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\r\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\r\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\r\n    return hsv2rgb(hsvOut);\r\n  }\r\n}\r\n\r\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  float internalMixed \x3d internalOpacity * textureOpacity;\r\n  float allMixed \x3d internalMixed * externalOpacity;\r\n\r\n  if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalOpacity;\r\n  }\r\n  else {\r\n    // multiply or tint (or something invalid)\r\n    return allMixed;\r\n  }\r\n}\r\n",
"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n// material parameters\r\n//////////////////////////////////////////\r\nuniform vec3 ambient;\r\nuniform vec3 diffuse;\r\nuniform vec3 specular;\r\nuniform float opacity;\r\nuniform float layerOpacity;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#else\r\nuniform int colorMixMode;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\n#endif\r\n\r\n#ifdef RECEIVE_SSAO\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\nvarying vec3 vnormal;\r\n#if defined(VERTEXCOLORS)\r\nvarying vec4 vcolor;\r\n#endif\r\nvarying vec4 vcolorExt;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#include \x3cutil/shadow.glsl\x3e\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/pathMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  vec4 texColor \x3d textureLookup(tex, vtc);\r\n  if (texColor.a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#else /* TEXTURING */\r\n  vec4 texColor \x3d vec4(1.0);\r\n#endif /* TEXTURING */\r\n\r\n  vec3 viewDir \x3d vpos - camPos;\r\n\r\n  // compute normal\r\n  // TODO: this is not in sync with the normal pass\r\n#ifdef GROUND_NORMAL_SHADING\r\n#ifdef VIEWING_MODE_GLOBAL\r\n  vec3 normal \x3d normalize(vpos + localOrigin);\r\n#else\r\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n#else\r\n#ifdef DOUBLESIDED\r\n  vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\r\n#elif defined(WINDINGORDERDOUBLESIDED)\r\n  vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\r\n#else\r\n  vec3 normal \x3d vnormal;\r\n#endif\r\n  normal \x3d normalize(normal);\r\n#endif\r\n\r\n  // compute ssao\r\n#ifdef RECEIVE_SSAO\r\n  float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n  ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\r\n#else\r\n  float ssao \x3d 1.0;\r\n#endif\r\n\r\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\r\n  float additionalAmbientScale;\r\n  vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\r\n\r\n  // compute shadowing\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#elif defined(VIEWING_MODE_GLOBAL)\r\n  // at global scale (and in global scenes) we fall back to this approximation\r\n  // to shadow objects on the dark side of the earth\r\n  shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\r\n#endif\r\n\r\n  vec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\r\n#if defined(VERTEXCOLORS)\r\n  // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\r\n  vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n#else\r\n  // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\r\n  vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n#endif\r\n  albedo_+\x3d 0.25 * specular; // don't completely ignore specular for now\r\n\r\n#ifdef TRANSPARENCY_DISCARD\r\n  if (opacity_ \x3c 0.001) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n#ifdef WIREFRAME\r\n  gl_FragColor \x3d vec4(matColor, opacity_);\r\n#else\r\n  vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n  gl_FragColor \x3d vec4(shadedColor, opacity_);\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec4 auxpos1; // direction offset\r\n#ifdef COMPRESSED_NORMALS\r\nattribute vec2 normalCompressed;\r\n#else\r\nattribute vec3 normal;\r\n#endif\r\nvarying vec3 vpos;\r\nvarying vec3 vnormal;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\nuniform sampler2D uComponentColorTex;\r\nuniform vec2 uComponentColorTexInvDim;\r\n\r\nattribute float componentIndex;\r\n\r\nvec4 readComponentColor() {\r\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n  vec2 indexCoord \x3d vec2(\r\n    mod(normalizedIndex, 1.0),\r\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n  );\r\n  return texture2D(uComponentColorTex, indexCoord);\r\n}\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\nattribute vec4 color;\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\nattribute vec4 symbolColor;\r\n#endif\r\n\r\n#if defined(VERTEXCOLORS)\r\nvarying vec4 vcolor;\r\n#endif\r\n\r\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\r\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\r\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\r\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\r\n// This should be further cleaned up later with through the following issue:\r\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\r\nuniform vec4 externalColor;\r\nvarying vec4 vcolorExt;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE) || defined(VV_COLOR)\r\nattribute vec4 auxpos2;\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/pathMaterial/localNormal.glsl\x3e\r\n#include \x3cmaterials/pathMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  vpos \x3d calculateVPos();\r\n\r\n  vnormal \x3d normalize((modelNormal * localNormal()).xyz);\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\n  vcolor \x3d color * 0.003921568627451; // \x3d 1/255\r\n#endif\r\n\r\n  vcolorExt \x3d externalColor;\r\n\r\n#ifdef VV_COLOR\r\n  vcolorExt *\x3d vvGetColor(auxpos2, vvColorValues, vvColorColors);\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n  // the v coordinate is stored in auxpos1.w\r\n#ifndef FLIPV\r\n  vtc \x3d vec2(uv0.x, auxpos1.w);\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-auxpos1.w);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"commonFunctions.glsl":"#include \x3cmaterials/pathMaterial/localPosition.glsl\x3e\r\n#include \x3cutil/doublePrecision.glsl\x3e\r\n\r\nvec3 calculateVPos() {\r\n  return (model * localPosition()).xyz;\r\n}","commonInputs.glsl":"uniform mat4 proj;\r\nuniform mat4 view;\r\n\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n\r\nuniform float size;\r\n\r\n// ---------------------------------------------- ++","depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/pathMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n#ifndef BIAS_SHADOWMAP\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n}\r\n",
"depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\r\n\r\nuniform vec2 nearFar;\r\nattribute vec3 position;\r\nattribute vec4 auxpos1; // direction offset\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE)\r\nattribute vec4 auxpos2;\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1.0);\r\n\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/pathMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec4 auxpos1; // direction offset\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE)\r\nattribute vec4 auxpos2;\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"localNormal.glsl":"#include \x3cutil/normalEncoding.glsl\x3e\r\n\r\n# ifdef COMPRESSED_NORMALS\r\nvec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\r\n# else\r\nvec4 localNormal() { return vec4(normal, 1.0); }\r\n# endif\r\n","localPosition.glsl":"#ifdef VV_SIZE\r\nvec4 localPosition() {\r\n    vec3 sizeScale \x3d vvGetScale(auxpos2);\r\n    vec3 positionOffset \x3d auxpos1.xyz*sizeScale;\r\n    return vec4( position+positionOffset, 1.0 );\r\n}\r\n#else\r\nvec4 localPosition() {\r\n    vec3 sizeScale \x3d vec3(size);\r\n    vec3 positionOffset \x3d auxpos1.xyz*sizeScale;\r\n    return vec4(position+positionOffset, 1.0);\r\n}\r\n#endif\r\n",
"normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/pathMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n}\r\n",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\r\n\r\nuniform mat4 viewNormal;\r\nattribute vec3 position;\r\nattribute vec4 auxpos1; // direction offset\r\n#ifdef COMPRESSED_NORMALS\r\nattribute vec2 normalCompressed;\r\n#else\r\nattribute vec3 normal;\r\n#endif\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\n#include \x3cmaterials/pathMaterial/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE)\r\nattribute vec4 auxpos2;\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/pathMaterial/localNormal.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n  vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"texturing.glsl":"float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\r\n  // from:\r\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\r\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\r\n  //   - http://www.linedef.com/virtual-texture-demo.html\r\n  float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\r\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\r\n}\r\n\r\n// based on https://medium.com/@bgolus/anti-aliased-alpha-test-the-esoteric-alpha-to-coverage-8b177335ae4f\r\nfloat coverageCorrectionFactor(vec2 uv) {\r\n#ifdef ALPHA_COVERAGE_CORRECTION\r\n  const float MipScale \x3d 0.25;\r\n  uv *\x3d texSize;\r\n#ifdef TEXTURE_ATLAS\r\n  uv *\x3d region.zw - region.xy;\r\n#endif\r\n  return 1.0 + max(0.0, calcMipMapLevel(dFdx(uv), dFdy(uv))) * MipScale;\r\n#else\r\n  return 1.0;\r\n#endif\r\n}\r\n\r\n#ifdef ALPHA_COVERAGE_CORRECTION\r\n  #define ALPHA_THRESHOLD 0.5\r\n#else\r\n  #define ALPHA_THRESHOLD 0.33\r\n#endif\r\n\r\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\r\n  //[umin, vmin, umax, vmax]\r\n  vec2 atlasScale \x3d region.zw - region.xy;\r\n  vec2 uvAtlas \x3d fract(uv) * atlasScale + region.xy;\r\n\r\n  vec4 texColor;\r\n\r\n  // calculate derivative of continuous texture coordinate\r\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\r\n  vec2 dUVdx \x3d dFdx(uv) * atlasScale;\r\n  vec2 dUVdy \x3d dFdy(uv) * atlasScale;\r\n\r\n#ifdef GL_EXT_shader_texture_lod\r\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\r\n#else\r\n  // use bias to compensate for difference in automatic vs desired mipmap level\r\n  vec2 dUVdxAuto \x3d dFdx(uvAtlas);\r\n  vec2 dUVdyAuto \x3d dFdy(uvAtlas);\r\n  float mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\r\n  float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\r\n\r\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\r\n#endif\r\n}\r\n\r\nvec4 textureLookup(sampler2D tex, vec2 uv) {\r\n#ifdef TEXTURE_ATLAS\r\n  return textureAtlasLookup(tex, uv, regionV, texSize);\r\n#else\r\n  return texture2D(tex, uv);\r\n#endif\r\n}\r\n\r\n",
"visualVariables.glsl":"\r\n#if defined(VV_SIZE)\r\n  uniform vec3 vvSizeMinSize;\r\n  uniform vec3 vvSizeMaxSize;\r\n  uniform vec3 vvSizeOffset;\r\n  uniform vec3 vvSizeFactor;\r\n\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\r\n  }\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  #define VV_COLOR_N 8\r\n  uniform float vvColorValues[VV_COLOR_N];\r\n  uniform vec4 vvColorColors[VV_COLOR_N];\r\n\r\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\r\n    float value \x3d featureAttribute.y;\r\n    if (value \x3c\x3d values[0]) {\r\n      return colors[0];\r\n    }\r\n\r\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n      if (values[i] \x3e\x3d value) {\r\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n        return mix(colors[i-1], colors[i], f);\r\n      }\r\n    }\r\n\r\n    return colors[VV_COLOR_N - 1];\r\n  }\r\n#endif\r\n\r\n\r\n\r\n"},
ribbonLine:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 eColor;\r\nvarying vec4 vColor;\r\nvarying vec2 vtc;\r\nvarying vec3 vpos;\r\n\r\n#ifdef STIPPLE\r\nuniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef STIPPLE\r\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightSlice(eColor * vColor, vpos);\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec2 vtc;\r\nvarying vec3 vpos;\r\n\r\n#ifdef STIPPLE\r\nuniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef STIPPLE\r\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n}\r\n","ribbonLine.vert":'#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nuniform float extLineWidth;\r\nuniform float nearPlane;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\nattribute vec4 color;\r\n\r\nvarying vec2 vtc;\r\nvarying vec4 vColor;\r\nvarying vec3 vpos;\r\n\r\nattribute float size;\r\n\r\n#ifndef WALL\r\nuniform float miterLimit;\r\nattribute vec3 auxpos1;\r\nattribute vec3 auxpos2;\r\n#endif\r\n\r\n#ifdef SCREENSCALE\r\nuniform vec2 screenSize;\r\n\r\nvec4 toScreenCoords(vec3 vertex) {\r\n  vec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\r\n  vClipSpace.xy *\x3d screenSize;\r\n  return vClipSpace/abs(vClipSpace.w);\r\n}\r\n\r\n#define VECTYPE vec2\r\n#define ZEROVEC vec2(0.0, 0.0)\r\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\r\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\r\n\r\n#else //ifdef SCREENSCALE\r\n\r\n#define VECTYPE vec3\r\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\r\n// these macros are only valid for "strip" type lines:\r\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\r\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*uv0.y \x3c 0.0\r\n\r\n#endif //ifdef SCREENSCALE\r\n\r\nfloat interp(float ncp, vec4 a, vec4 b) {\r\n  return (-ncp - a.z) / (b.z - a.z);\r\n}\r\n\r\n#ifdef SCREENSCALE\r\n\r\nvoid clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\r\n  float vnp \x3d nearPlane*0.99;\r\n\r\n  //We have four vertices per point on the line. Start and end vertices\r\n  //are treated differently --\x3e d \x3e 0, d \x3c 0\r\n  float d \x3d abs(uv0.y) - 1.1;\r\n\r\n  //current pos behind ncp --\x3e we need to clip\r\n  if(pos.z \x3e -nearPlane) {\r\n    if (d \x3c 0.0) {\r\n      //previous in front of ncp\r\n      if(prev.z \x3c -nearPlane) {\r\n        pos \x3d mix(prev, pos, interp(vnp, prev, pos));\r\n        next \x3d pos;\r\n      } else {\r\n        pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\r\n      }\r\n    }\r\n    //next in front of ncp\r\n    if(d \x3e 0.0) {\r\n      if(next.z \x3c -nearPlane) {\r\n        pos \x3d mix(pos, next, interp(vnp, pos, next));\r\n        prev \x3d pos;\r\n      } else {\r\n        pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\r\n      }\r\n    }\r\n  } else {\r\n    //current position visible\r\n    //previous behind ncp\r\n    if (prev.z \x3e -nearPlane) {\r\n      prev \x3d mix(pos, prev, interp(vnp, pos, prev));\r\n    }\r\n    //next behind ncp\r\n    if (next.z \x3e -nearPlane) {\r\n      next \x3d mix(next, pos, interp(vnp, next, pos));\r\n    }\r\n  }\r\n\r\n  pos\x3d proj * pos;\r\n  pos.xy *\x3d screenSize;\r\n  pos /\x3d pos.w;\r\n\r\n  next \x3d proj * next;\r\n  next.xy *\x3d screenSize;\r\n  next /\x3d next.w;\r\n\r\n  prev \x3d proj * prev;\r\n  prev.xy *\x3d screenSize;\r\n  prev /\x3d prev.w;\r\n}\r\n\r\n#endif // SCREENSCALE\r\n\r\nvoid main(void) {\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n\r\n#ifdef SCREENSCALE\r\n// Check for special value of uv0.y which is used by the Renderer when graphics\r\n// are removed before the VBO is recompacted. If this is the case, then we just\r\n// project outside of clip space.\r\nif (uv0.y \x3d\x3d 0.0) {\r\n  // Project out of clip space\r\n  gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n}\r\nelse {\r\n#endif\r\n\r\nfloat lineWidth \x3d extLineWidth + size;\r\n\r\n#ifdef SCREENSCALE\r\n\r\n#if 0\r\n  vec4 pos \x3d toScreenCoords(position.xyz);\r\n  vec2 left \x3d (pos - toScreenCoords(auxpos1)).xy;\r\n  vec2 right \x3d (toScreenCoords(auxpos2) - pos).xy;\r\n#else\r\n  vec4 pos  \x3d view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\r\n  vec4 prev \x3d view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\r\n  vec4 next \x3d view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\r\n\r\n  clipAndTransform(pos, prev, next);\r\n\r\n  vec2 left \x3d (pos - prev).xy;\r\n  vec2 right \x3d (next - pos).xy;\r\n#endif\r\n\r\n#else // ifdef SCREENSCALE\r\n  vec4 pos \x3d vec4(position, 1.0);\r\n#ifndef WALL\r\n  vec3 left \x3d position.xyz - auxpos1;\r\n  vec3 right \x3d auxpos2 - position.xyz;\r\n  vec3 up \x3d normalize(position.xyz);\r\n#endif // ifndef WALL\r\n#endif // ifdef SCREENSCALE\r\n\r\n#ifdef WALL\r\n  float displacementLen \x3d lineWidth;\r\n  vec3 displacementDir \x3d normalize(position.xyz);//vec3(0.0, 1.0, 0.0);\r\n#else // ifdef WALL\r\n\r\n  float leftLen \x3d length(left);\r\n  left \x3d (leftLen \x3e 0.001) ? left/leftLen : ZEROVEC;\r\n\r\n  float rightLen \x3d length(right);\r\n  right \x3d (rightLen \x3e 0.001) ? right/rightLen : ZEROVEC;\r\n\r\n  // determine if vertex is on the "outside or "inside" of the join\r\n  bool isOutside \x3d ISOUTSIDE;\r\n\r\n  // compute miter join position first\r\n  float displacementLen \x3d lineWidth;\r\n  VECTYPE displacementDir \x3d normalize(left + right);\r\n  displacementDir \x3d PERPENDICULAR(displacementDir);\r\n  if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\r\n    float nDotSeg \x3d dot(displacementDir, left);\r\n    displacementLen /\x3d length(nDotSeg*left - displacementDir);\r\n\r\n    // limit displacement of inner vertices\r\n    if (!isOutside) {\r\n      displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\r\n    }\r\n  }\r\n\r\n  if (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\r\n    // convert to bevel join if miterLimit is exceeded\r\n    if (leftLen \x3c 0.001) {\r\n      displacementDir \x3d right;\r\n    }\r\n    else if (rightLen \x3c 0.001) {\r\n      displacementDir \x3d left;\r\n    }\r\n    else {\r\n      displacementDir \x3d (abs(uv0.y) - 1.1 \x3c 0.0) ? left : right;\r\n    }\r\n    displacementDir \x3d normalize(displacementDir);\r\n    displacementDir \x3d PERPENDICULAR(displacementDir);\r\n    displacementLen \x3d lineWidth;\r\n  }\r\n\r\n#endif // ifdef WALL\r\n\r\n#ifdef SCREENSCALE\r\n  pos.xy +\x3d displacementDir * floor(uv0.y + 0.5) * displacementLen;\r\n  pos.xy /\x3d screenSize;\r\n#else\r\n  pos.xyz +\x3d displacementDir * floor(uv0.y + 0.5) * displacementLen;\r\n  pos \x3d proj * view * model * pos;\r\n#endif\r\n\r\n  vtc \x3d uv0;\r\n  vColor \x3d color * 0.003921568627451; // \x3d 1/255\r\n  gl_Position \x3d pos;\r\n\r\n#ifdef SCREENSCALE\r\n  }\r\n#endif\r\n}\r\n'},
slicePlane:{"slicePlane.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 backgroundColor;\r\nuniform vec4 gridColor;\r\nuniform float ratio;\r\nuniform float gridWidth;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main() {\r\n  const float LINE_WIDTH \x3d 1.0;\r\n\r\n  vec2 uvScaled \x3d vUV * gridWidth;\r\n  vec2 gridUV \x3d (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\r\n  vec2 grid \x3d (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\r\n\r\n  // mask aliasing along edges\r\n  grid.x *\x3d step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\r\n  grid.y *\x3d step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\r\n\r\n  float gridFade \x3d max(grid.x, grid.y);\r\n\r\n  float gridAlpha \x3d gridColor.a * gridFade;\r\n\r\n  // premultiply alpha in output\r\n  gl_FragColor \x3d\r\n    vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\r\n    vec4(gridColor.rgb, 1.0) * gridAlpha;\r\n}\r\n",
"slicePlane.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n  vUV \x3d uv0;\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n}\r\n"}},misc:{"blendLayers.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec2 uv;\r\n\r\nuniform sampler2D tex;\r\nuniform float opacity;\r\n\r\nvoid main() {\r\n  vec4 color \x3d texture2D(tex, uv);\r\n\r\n  // Note: output in pre-multiplied alpha for correct alpha compositing\r\n  gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\r\n}\r\n",
"blendLayers.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nuniform float scale;\r\nuniform vec2 offset;\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position, 1.0);\r\n  uv \x3d uv0 * scale + offset;;\r\n}\r\n","showDepth.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n\r\nuniform sampler2D depthTex;\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n// gl_FragColor \x3d vec4(vec3(texture2D(depthTex, vtc).a), 1.0);\r\n   gl_FragColor \x3d vec4(rgba2float(texture2D(depthTex, vtc)));\r\n// gl_FragColor \x3d texture2D(depthTex, vtc);\r\n}\r\n",
"showDepth.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nattribute vec2 position;\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d proj * vec4(position.x, position.y, .0, 1.0);\r\n  vtc \x3d uv0;\r\n}\r\n","simple.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","simple.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n}\r\n",
"texOnly.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\nuniform vec4 color;\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  vec4 texColor \x3d texture2D(tex, vtc);\r\n  gl_FragColor \x3d texColor * color;\r\n}\r\n","texOnly.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n  vtc \x3d uv0;\r\n}\r\n"},
pointRenderer:{"pointRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n\r\n#ifdef DEPTH_PASS\r\nvarying float depth;\r\n#else\r\nvarying vec3 vColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n  vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\r\n  float r2 \x3d dot(vOffset, vOffset);\r\n\r\n  if (r2 \x3e 0.25) {\r\n    discard;\r\n  }\r\n\r\n#ifdef DEPTH_PASS\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d vec4(vColor, 1.0);\r\n#endif\r\n}\r\n",
"pointRenderer.vert":"#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec3 aPosition;\r\nattribute vec3 aColor;\r\n\r\nuniform mat4 uModelViewMatrix;\r\nuniform mat4 uProjectionMatrix;\r\nuniform vec2 uScreenMinMaxSize;\r\nuniform vec2 uPointScale;\r\nuniform vec3 uClipMin;\r\nuniform vec3 uClipMax;\r\n\r\n#ifdef DEPTH_PASS\r\nuniform vec2 nearFar;\r\n\r\nvarying float depth;\r\n#else\r\nvarying vec3 vColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n  // Move clipped points outside of clipspace\r\n  if (aPosition.x \x3c uClipMin.x || aPosition.y \x3c uClipMin.y || aPosition.z \x3c uClipMin.z ||\r\n      aPosition.x \x3e uClipMax.x || aPosition.y \x3e uClipMax.y || aPosition.z \x3e uClipMax.z) {\r\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\r\n    gl_PointSize \x3d 0.0;\r\n    return;\r\n  }\r\n\r\n  if (rejectBySlice(aPosition)) {\r\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\r\n    gl_PointSize \x3d 0.0;\r\n    return;\r\n  }\r\n\r\n  // Position in camera space\r\n  vec4 camera \x3d uModelViewMatrix * vec4(aPosition, 1.0);\r\n\r\n  float pointSize \x3d uPointScale.x;\r\n  vec4 position \x3d uProjectionMatrix * camera;\r\n\r\n  // Calculate Size\r\n#ifdef DRAW_SCREEN_SIZE\r\n    float clampedScreenSize \x3d pointSize;\r\n#else\r\n    float pointRadius \x3d 0.5 * pointSize;\r\n    vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\r\n    vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\r\n    float radius \x3d abs(positionOffset.y - position.y);\r\n\r\n    float viewHeight \x3d uPointScale.y;\r\n\r\n    // screen diameter \x3d (2 * r / w) * (h / 2)\r\n    float screenPointSize \x3d (radius / position.w) * viewHeight;\r\n    float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\r\n\r\n    // Shift towards camera, to move rendered point out of terrain i.e. to\r\n    // the camera-facing end of the virtual point when considering it as a\r\n    // 3D sphere.\r\n    camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\r\n    position \x3d uProjectionMatrix * camera;\r\n#endif\r\n\r\n  gl_PointSize \x3d clampedScreenSize;\r\n  gl_Position \x3d position;\r\n\r\n#ifdef DEPTH_PASS\r\n  depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n#else\r\n  vColor \x3d aColor;\r\n#endif\r\n}\r\n"},
renderer:{highlight:{"apply.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Merging blurred outlines with source image, advanced version\r\n\r\n// Defines:\r\n// GRID_OPTIMIZATION (set or !set)\r\n// GRID_DEBUG (set or !set)\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\nuniform sampler2D origin;\r\n\r\nuniform vec4 color;\r\nuniform float outlineSize;\r\nuniform float blurSize;\r\nuniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main() {\r\n  #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\r\n    gl_FragColor \x3d vec4(uv, 0.0, 1.0);\r\n  #else\r\n    // Read the highlight intensity from the blurred highlight image\r\n    vec4 blurredHighlightValue \x3d texture2D(tex, uv);\r\n    float highlightIntensity \x3d blurredHighlightValue.a;\r\n\r\n    // Discard all pixels which are not affected by highlight\r\n    if (highlightIntensity \x3d\x3d 0.0) {\r\n      discard;\r\n    }\r\n\r\n    vec4 origin_color \x3d texture2D(origin, uv);\r\n\r\n    float outlineIntensity;\r\n    float fillIntensity;\r\n\r\n    // if occluded\r\n    if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\r\n      outlineIntensity \x3d color.w * opacities[1];\r\n      fillIntensity \x3d color.w * opacities[3];\r\n    }\r\n    // if unoccluded\r\n    else {\r\n      outlineIntensity \x3d color.w * opacities[0];\r\n      fillIntensity \x3d color.w * opacities[2];\r\n    }\r\n\r\n    float inner \x3d 1.0 - outlineSize / 9.0;\r\n    float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\r\n\r\n    float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\r\n    //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\r\n    float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\r\n    float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\r\n\r\n    // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n    // I.e., color should not be premultiplied with alpha\r\n    gl_FragColor \x3d vec4(color.xyz, intensity);\r\n  #endif\r\n}\r\n",
"apply.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 uv;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  attribute vec2 uv0;\r\n  uniform sampler2D coverageTex;\r\n#endif\r\n\r\nvoid main() {\r\n  #ifdef GRID_OPTIMIZATION\r\n    #ifdef GRID_DEBUG\r\n      vec4 cov \x3d texture2D(coverageTex, uv0);\r\n      // if no highlight pixel set in this block,\r\n      // or all pixels set, hide block\r\n      if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\r\n        gl_Position \x3d vec4(0.0);\r\n        return;\r\n      }\r\n      gl_Position \x3d vec4(position, .0, 1.0);\r\n      uv \x3d uv0;\r\n      return;\r\n    #else\r\n      vec4 cov \x3d texture2D(coverageTex, uv0);\r\n      // if no highlight pixel set in this block, hide block\r\n      if (cov.r \x3d\x3d 0.0) {\r\n        gl_Position \x3d vec4(0.0);\r\n        return;\r\n      }\r\n    #endif\r\n  #endif\r\n\r\n  gl_Position \x3d vec4(position, .0, 1.0);\r\n  uv \x3d position.xy * .5 + vec2(.5);\r\n}\r\n",
"blur.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Gaussian blur with linear sampling. Supports different number of samples, but\r\n// only 5 samples have proper weights. Uses linear texture interpolation to reduce\r\n// the number of samples taken.\r\n\r\n// Defines:\r\n// GRID_OPTIMIZATION (set or !set)\r\n// GAUSSIAN_SAMPLES (3,5,7)\r\n\r\n// This technique requires linear filtering on source texture\r\n// http://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  uniform vec2 blurSize;\r\n  varying vec3 blurCoordinate;\r\n#else\r\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n#endif\r\n\r\nvoid main() {\r\n  #ifdef GRID_OPTIMIZATION\r\n    vec2 uv \x3d blurCoordinate.xy;\r\n    vec4 center \x3d texture2D(tex, uv);\r\n\r\n    // do not blur if no pixel or all pixels in neighborhood are set\r\n    if (blurCoordinate.z \x3d\x3d 1.0) {\r\n      gl_FragColor \x3d center;\r\n    }\r\n    else {\r\n      vec4 sum \x3d vec4(0.0);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.154164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\r\n      #endif\r\n\r\n      gl_FragColor \x3d sum;\r\n    }\r\n  #else\r\n    vec4 sum \x3d vec4(0.0);\r\n\r\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\r\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\r\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\r\n      sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\r\n      sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\r\n    #endif\r\n\r\n    gl_FragColor \x3d sum;\r\n  #endif\r\n}\r\n",
"blur.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nattribute vec2 uv0;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  uniform sampler2D coverageTex;\r\n  varying vec3 blurCoordinate;\r\n#else\r\n  uniform vec2 blurSize;\r\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n#endif\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(position, 0.0, 1.0);\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    // sample the coverage texture at the block center\r\n    // and if no coverage detected, create degenerate triangle\r\n    vec4 cov \x3d texture2D(coverageTex, uv0);\r\n    if (cov.r \x3d\x3d 0.0) {\r\n      gl_Position \x3d vec4(0.0);\r\n    }\r\n\r\n    // create texture coordinate for blur center\r\n    // encode information about fully inside block in z coordinate\r\n    blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\r\n  #else\r\n    vec2 uv \x3d position.xy * .5 + vec2(.5);\r\n\r\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n      blurCoordinates[7] \x3d uv + blurSize * 7.1;\r\n      blurCoordinates[8] \x3d uv - blurSize * 7.1;\r\n    #endif\r\n  #endif\r\n}\r\n",
"downsample.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Smartly downsamples a texture, halfing its resolution. This allows for a square\r\n// screen region to check if none, any or all pixels were set.\r\n\r\n// The red channel is always ceiled after interpolating the 4 merged pixels.\r\n// This allows to evaluate:\r\n// any(pixels.red !\x3d 0.0) as red \x3d\x3d 1.0\r\n// none(pixels.red !\x3d 0.0) as red \x3d\x3d 0.0\r\n\r\n// The green and blue channels are set to floor(max(green, blue)).\r\n// This allows to evaluate:\r\n// all(pixels.green || pixels.blue) as green \x3d\x3d 1.0\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\nuniform vec2 invFramebufferDim;\r\n\r\nvoid main() {\r\n  vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\r\n  vec4 value \x3d texture2D(tex, coord);\r\n  float mx \x3d floor(max(value.g, value.b));\r\n  gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\r\n}\r\n",
"downsample.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(vec2(1.0) - position * 2.0, .0, 1.0);\r\n}\r\n"},laserLine:{"laserLine.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n\r\n//--------------------------------------------------------------------------\r\n// Uniforms\r\n//--------------------------------------------------------------------------\r\n\r\nuniform sampler2D depthMap;\r\n\r\nuniform vec2 nearFar;\r\nuniform vec4 projInfo;\r\nuniform vec2 zScale;\r\nuniform float maxPixelDistance;\r\n\r\n// focus plane in camera space\r\nuniform vec4 focusPlane;\r\n\r\n// focus sphere in camera space\r\nuniform vec4 focusSphere;\r\n\r\n// segment plane in camera space\r\nuniform vec4 segmentPlane;\r\n\r\n// line segment\r\nuniform vec3 segmentStart;\r\nuniform vec3 segmentEnd;\r\n\r\n// styling\r\nuniform vec3 glowColor;\r\nuniform float glowWidth;\r\nuniform vec3 innerColor;\r\nuniform float innerWidth;\r\nuniform float globalAlpha;\r\n\r\n//--------------------------------------------------------------------------\r\n// Inputs\r\n//--------------------------------------------------------------------------\r\n\r\nvarying vec2 uv;\r\n\r\n//--------------------------------------------------------------------------\r\n// Defines\r\n//--------------------------------------------------------------------------\r\n\r\n#define INFINITY 100000.0\r\n\r\n\r\n\r\n// reconstruct depth value from linear depth map\r\nfloat linearDepth(vec2 uv) {\r\n  return -(rgba2float(texture2D(depthMap, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\r\n}\r\n\r\n// reconstruct position in view space\r\nvec3 reconstructPosition(vec2 fragCoord, float depth) {\r\n  return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\r\n}\r\n\r\nfloat planeDistancePixels(vec4 plane, vec3 pos) {\r\n  // compute distance to plane\r\n  float dist \x3d dot(plane.xyz, pos) + plane.w;\r\n  // compute derivative of distance function with respect to pixels\r\n  float width \x3d fwidth(dist);\r\n  // normalize distance by the derivative to get a measurement with respect to pixels\r\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\r\n  dist /\x3d min(width, maxPixelDistance);\r\n  return abs(dist);\r\n}\r\n\r\nfloat sphereDistancePixels(vec4 sphere, vec3 pos) {\r\n  // compute distance to sphere\r\n  float dist \x3d distance(sphere.xyz, pos) - sphere.w;\r\n  // compute derivative of distance function with respect to pixels\r\n  float width \x3d fwidth(dist);\r\n  // normalize distance by the derivative to get a measurement with respect to pixels\r\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\r\n  dist /\x3d min(width, maxPixelDistance);\r\n  return abs(dist);\r\n}\r\n\r\nvec4 blendPremultiplied(vec4 source, vec4 dest) {\r\n  float oneMinusSourceAlpha \x3d 1.0 - source.a;\r\n\r\n  return vec4(\r\n    source.rgb + dest.rgb * oneMinusSourceAlpha,\r\n    source.a + dest.a * oneMinusSourceAlpha\r\n  );\r\n}\r\n\r\nvec4 premultipliedColor(vec3 rgb, float alpha) {\r\n  return vec4(rgb * alpha, alpha);\r\n}\r\n\r\n// computes laser line color based on distance in pixels\r\nvec4 laserLineProfile(float dist) {\r\n  if (dist \x3e glowWidth) {\r\n    return vec4(0.0);\r\n  }\r\n\r\n  float innerAlpha \x3d (1.0 - smoothstep(0.0, innerWidth, dist));\r\n  float glowAlpha \x3d pow(max(0.0, 1.0 - dist / glowWidth), 8.0);\r\n\r\n  return blendPremultiplied(\r\n    premultipliedColor(innerColor, innerAlpha),\r\n    premultipliedColor(glowColor, glowAlpha)\r\n  );\r\n}\r\n\r\nvoid main() {\r\n  // do not draw laserline on background\r\n  float depth \x3d linearDepth(uv);\r\n  if (-depth \x3d\x3d nearFar[0]) {\r\n    discard;\r\n  }\r\n\r\n  // reconstruct position in view space\r\n  vec3 pos \x3d reconstructPosition(gl_FragCoord.xy, depth);\r\n\r\n  // empirical hack to fade out laser line in problematic areas:\r\n  // the derivatives to normalize the distance function are valid inside smooth surfaces,\r\n  // but break down at depth discontinuities (e.g. edges). We fade out the laser lines in\r\n  // areas where depth valus have large variations in order to avoid this problem.\r\n  float ddepth \x3d fwidth(depth);\r\n  float depthDiscontinuityAlpha \x3d 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\r\n\r\n  // reconstruct normal using derivatives\r\n  vec3 normal \x3d normalize(cross(dFdx(pos), dFdy(pos)));\r\n\r\n  // distance to focus plane\r\n  float focusPlaneDistance \x3d planeDistancePixels(focusPlane, pos);\r\n\r\n  // distance to focus sphere\r\n  float focusSphereDistance \x3d sphereDistancePixels(focusSphere, pos);\r\n\r\n  // distance to segment plane\r\n  float segmentDistance \x3d INFINITY;\r\n  float segmentLength \x3d length(segmentEnd - segmentStart);\r\n  vec3 segmentDir \x3d (segmentEnd - segmentStart) / segmentLength;\r\n  float t \x3d dot(segmentDir, pos - segmentStart);\r\n\r\n  if (segmentLength \x3e 0.0 \x26\x26 t \x3e\x3d 0.0 \x26\x26 t \x3c\x3d segmentLength) {\r\n    segmentDistance \x3d planeDistancePixels(segmentPlane, pos);\r\n  }\r\n\r\n  // evaluate color profile for both planes and the sphere\r\n  vec4 focusPlaneColor \x3d laserLineProfile(focusPlaneDistance);\r\n  vec4 focusSphereColor \x3d laserLineProfile(focusSphereDistance);\r\n  vec4 segmentColor \x3d laserLineProfile(segmentDistance);\r\n\r\n  // empirical hack to fade out laser line when planes are nearly parallel\r\n  float focusPlaneAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, focusPlane.xyz)));\r\n  float focusSphereAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, normalize(pos - focusSphere.xyz))));\r\n  float segmentAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, segmentPlane.xyz)));\r\n\r\n  // combine colors\r\n  vec4 color \x3d max(\r\n    focusPlaneColor * focusPlaneAlpha,\r\n    max(\r\n      focusSphereColor * focusSphereAlpha,\r\n      segmentColor * segmentAlpha\r\n    )\r\n  );\r\n\r\n  gl_FragColor \x3d color * globalAlpha * depthDiscontinuityAlpha;\r\n}\r\n"},
occluded:{"combine.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D occludedColorMap;\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main() {\r\n  vec4 occludedColor \x3d texture2D(occludedColorMap, uv);\r\n  gl_FragColor \x3d occludedColor * vec4(1.0, 1.0, 1.0, 0.4);\r\n}\r\n"},offscreen:{"offscreen.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d texture2D(tex, vtc);\r\n}\r\n","offscreen.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position.xy, 0.0, 1.0);\r\n  vtc \x3d position.xy * 0.5 + 0.5;\r\n}\r\n",
"transparentToHUDVisibility.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d vec4(1.0 - texture2D(tex, vtc).a);\r\n}\r\n"},ssao:{"blur.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3crenderer/ssao/common.glsl\x3e\r\n\r\n#ifndef RADIUS\r\n#define RADIUS 4\r\n#endif\r\n\r\nuniform sampler2D normalMap;\r\nuniform sampler2D depthMap;\r\nuniform sampler2D tex;\r\n\r\nuniform vec2 blurSize;\r\n\r\nuniform float g_BlurFalloff;\r\nuniform float projScale;\r\n\r\nuniform vec2    nearFar;\r\n//set z scaling, used to prevent division in ortho mode\r\nuniform vec2 zScale;\r\n\r\nvarying vec2 uv;\r\n\r\nfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\r\n  float c \x3d texture2D(tex, uv).r;\r\n  float d \x3d getDepthLinear(depthMap, nearFar, uv);\r\n\r\n  float ddiff \x3d d - center_d;\r\n\r\n  float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\r\n\r\n  w_total +\x3d w;\r\n\r\n  return w*c;\r\n}\r\n\r\nvoid main(void) {\r\n  float b \x3d 0.0;\r\n  float w_total \x3d 0.0;\r\n\r\n  float center_d \x3d  getDepthLinear(depthMap, nearFar, uv);\r\n\r\n  float sharpness \x3d -0.05*projScale/(center_d*zScale.x+zScale.y);\r\n  for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\r\n    float rf \x3d float(r);\r\n    vec2 uvOffset \x3d uv + rf*blurSize;\r\n    b +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\r\n  }\r\n\r\n  gl_FragColor \x3d vec4(b/w_total);\r\n}\r\n",
"common.glsl":"#include \x3cutil/encoding.glsl\x3e\r\n\r\nfloat getDepthLinear(sampler2D depthMap, vec2 nearFar, vec2 ssC) {\r\n  return -(rgba2float(texture2D(depthMap, ssC))*(nearFar[1] - nearFar[0])+nearFar[0]);\r\n}\r\n","ssao.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3crenderer/ssao/common.glsl\x3e\r\n\r\n#ifndef SAMPLES\r\n#define SAMPLES 4\r\n#endif\r\n\r\nuniform mat4 projMatrixInv;\r\n\r\nuniform sampler2D normalMap;\r\nuniform sampler2D depthMap;\r\n\r\nuniform float intensity;\r\n\r\nuniform float projScale;\r\nuniform float radius;\r\nuniform vec2 nearFar;\r\nuniform vec4 projInfo;\r\nuniform vec2 screenDimensions;\r\n\r\n//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\r\nuniform vec3 pSphere[SAMPLES]; //tap position\r\nuniform vec2 rnmScale;\r\nuniform sampler2D rnm; //noise texture\r\n\r\n//set z scaling, used to prevent division in ortho mode\r\nuniform vec2 zScale;\r\n\r\nvarying vec2  uv;\r\nvarying vec4  camPos;\r\n\r\nfloat fallOffFunction(float vv, float vn, float bias) {\r\n  float radius2 \x3d radius * radius;\r\n\r\n  // A: From the HPG12 paper\r\n  // Note large epsilon to avoid overdarkening within cracks\r\n  // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\r\n\r\n  // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\r\n  float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\r\n\r\n  // C: Medium contrast (which looks better at high radii), no division.  Note that the\r\n  // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\r\n  // more computationally efficient and happens to be aesthetically pleasing.\r\n  // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\r\n\r\n  // D: Low contrast, no division operation\r\n  // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\r\n}\r\n\r\n\r\n/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\r\nfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\r\n  vec3 v \x3d Q - C;\r\n  float vv \x3d dot(v, v);\r\n  float vn \x3d dot(normalize(v), n_C);\r\n  return fallOffFunction(vv, vn, 0.1);\r\n}\r\n\r\n\r\n/**\r\n * Reconstruct camera-space P.xyz from screen-space S \x3d (x, y) in\r\n * pixels and camera-space z \x3c 0.  Assumes that the upper-left pixel center\r\n * is at (0.5, 0.5) [but that need not be the location at which the sample tap\r\n * was placed!]\r\n *\r\n * Costs 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\r\n */\r\nvec3 reconstructCSPosition(vec2 S, float z) {\r\n  return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\r\n}\r\n\r\nvoid main(void) {\r\n  //Hash function used in the HPG12 AlchemyAO paper\r\n  //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\r\n  //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\r\n  //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\r\n  vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n\r\n  float currentPixelDepth \x3d getDepthLinear(depthMap, nearFar, uv);\r\n\r\n  if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\r\n    gl_FragColor \x3d vec4(0.0);\r\n    return;\r\n  }\r\n\r\n  vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\r\n\r\n  // get the normal of current fragment\r\n  vec4 norm4 \x3d texture2D(normalMap, uv);\r\n  vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\r\n  bool isTerrain \x3d norm4.w\x3c0.5;\r\n\r\n  float sum \x3d .0;\r\n\r\n  vec4 occluderFragment;\r\n  vec3 ray;\r\n\r\n  vec3 tapPixelPos;\r\n\r\n  // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\r\n  // bug or deviation from CE somewhere else?\r\n  float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\r\n\r\n  for(int i \x3d 0; i \x3c SAMPLES; ++i) {\r\n    // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\r\n    //float ssR;\r\n    //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\r\n    // get the depth of the occluder fragment\r\n    //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\r\n\r\n    vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\r\n    vec2 offset \x3d vec2(-unitOffset*radius*ps);\r\n\r\n    //don't use current or very nearby samples\r\n    if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\r\n\r\n    vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\r\n    if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\r\n    vec2 tcTap \x3d tc/screenDimensions;\r\n    float occluderFragmentDepth \x3d getDepthLinear(depthMap, nearFar, tcTap);\r\n\r\n    if (isTerrain) {\r\n      bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\r\n      if (isTerrainTap) {\r\n        continue;\r\n      }\r\n    }\r\n\r\n    tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\r\n\r\n    sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\r\n  }\r\n\r\n  // output the result\r\n\r\n  float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\r\n\r\n  // Anti-tone map to reduce contrast and drag dark region farther\r\n  // (x^0.2 + 1.2 * x^4)/2.2\r\n  A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\r\n\r\n  //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\r\n  //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\r\n  //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\r\n  gl_FragColor \x3d vec4(A);\r\n}\r\n"}},
terrainRenderer:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n#include \x3cutil/screenSizePerspective.glsl\x3e\r\n#include \x3cutil/shadow.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cterrainRenderer/overlay.glsl\x3e\r\n\r\nuniform vec3 lightDirection;\r\nuniform vec3 viewDirection;\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\nuniform sampler2D tex;\r\nuniform float opacity;\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nstruct WireframeSettings {\r\n  float width;\r\n  float falloff;\r\n  float subdivision;\r\n  vec4 color;\r\n  float wireOpacity;\r\n  float surfaceOpacity;\r\n};\r\n\r\nuniform WireframeSettings wireframe;\r\n#endif\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\nvarying vec2 vtc;\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nvarying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\nvarying vec3 wpos;\r\nvarying vec3 wview;\r\nvarying vec3 wnormal;\r\nvarying vec3 wlight;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\nuniform vec4 screenSizePerspective;\r\n\r\nvarying float screenSizeDistanceToCamera;\r\nvarying float screenSizeCosAngle;\r\n#endif\r\n\r\nconst vec3 ambient \x3d vec3(0.2,0.2,0.2);\r\nconst vec3 diffuse \x3d vec3(0.8,0.8,0.8);\r\nconst float diffuseHardness \x3d 2.5;\r\nconst float sliceOpacity \x3d 0.2;\r\n\r\n#ifdef OVERLAY\r\nuniform sampler2D overlay0Tex;\r\nuniform sampler2D overlay1Tex;\r\nuniform float overlayOpacity;\r\nvarying vec4 vtcOverlay;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\nfloat lum(vec3 c) {\r\n  float max \x3d max(max(c.r, c.g), c.b);\r\n  float min \x3d min(min(c.r, c.g), c.b);\r\n  return (min + max) * 0.5;\r\n}\r\n\r\n#ifdef ATMOSPHERE\r\nvec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\r\n  vec3 surfaceColor   \x3d vec3(0.0);\r\n  vec3 fuzzySpecColor \x3d vec3(1.0);\r\n  vec3 subColor       \x3d vec3(0.0);\r\n  float rollOff       \x3d 1.0;\r\n\r\n  vec3 Ln \x3d normalize(lightPos);\r\n  vec3 Nn \x3d normalize(normal);\r\n  vec3 Hn \x3d normalize(view + Ln);\r\n\r\n  float ldn \x3d dot(Ln, Nn);\r\n  float diffComp \x3d max(0.0, ldn);\r\n  float vdn \x3d 1.0 - dot(view, Nn);\r\n  float ndv \x3d dot(view, Ln);\r\n\r\n  vec3 diffContrib \x3d surfaceColor * diffComp;\r\n  float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\r\n\r\n  vec3 subContrib \x3d subLamb * subColor;\r\n  vec3 vecColor \x3d vec3(vdn);\r\n\r\n  vec3 diffuseContrib \x3d (subContrib + diffContrib);\r\n  vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\r\n\r\n  return (diffContrib + specularContrib) * rollOff;\r\n}\r\n#endif\r\n\r\nvoid main() {\r\n  vec3 a \x3d ambient;\r\n\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#endif\r\n  float vndl \x3d dot(normalize(vnormal), lightDirection);\r\n  float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\r\n  vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\r\n\r\n  float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n\r\n  vec4 tileColor \x3d texture2D(tex, vtc) * opacity;\r\n\r\n#ifdef OVERLAY\r\n  vec4 overlayColor \x3d getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\r\n\r\n  // tileColor and overlayTexCols have pre-multiplied alpha\r\n  tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;\r\n#endif\r\n\r\n  if (rejectBySlice(vpos)) {\r\n    tileColor *\x3d sliceOpacity;\r\n  }\r\n\r\n  vec3 atm \x3d vec3(0.0);\r\n#ifdef ATMOSPHERE\r\n  float ndotl \x3d max(0.0, min(1.0, vndl));\r\n  atm \x3d atmosphere(wlight, wnormal, -viewDirection);\r\n  atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\r\n  atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\r\n  atm *\x3d tileColor.a; // premultiply with tile alpha\r\n#endif\r\n\r\n  vec3 albedo \x3d atm + tileColor.rgb;\r\n  vec3 normal \x3d normalize(vnormal);\r\n\r\n  // heuristic shading function used in the old terrain, now used to add ambient lighting\r\n  float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\r\n  vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n\r\n  gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n  // This is only used for debug rendering the screenSize perspective\r\n\r\n  float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\r\n\r\n  if (perspectiveScale \x3c\x3d 0.25) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\r\n  }\r\n  else if (perspectiveScale \x3c\x3d 0.5) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\r\n  }\r\n  else if (perspectiveScale \x3e\x3d 0.99) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\r\n  }\r\n\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n\r\n  vec2 vuvScaled \x3d vuv * wireframe.subdivision;\r\n  vec2 vuvMod \x3d fract(vuvScaled);\r\n\r\n  vec2 dVuv \x3d fwidth(vuvScaled);\r\n  dVuv \x3d max(vec2(0.00001), dVuv); // workaround against flickering skirts, see #10245\r\n\r\n  vec2 edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                                wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\r\n\r\n  float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n#ifdef WIREFRAME_TEXTURE\r\n  vec3 wireframeColor \x3d mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a);\r\n  float wireframeAlpha \x3d mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor);\r\n  gl_FragColor \x3d vec4(wireframeColor * wireframeAlpha, wireframeAlpha * gl_FragColor.a);\r\n#endif\r\n\r\n\r\n#ifdef TILE_BORDERS\r\n  dVuv \x3d fwidth(vuv);\r\n  edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                            wireframe.width * dVuv, min(vuv, 1.0 - vuv));\r\n  edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n  gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\r\n#endif\r\n\r\n#endif // defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n\r\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec3 origin;\r\nuniform vec4 texOffsetAndScale;\r\nuniform mat4 viewNormal;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\nvarying vec2 vtc;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nvarying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\nuniform vec3 lightDirection;\r\nvarying vec3 wpos;\r\nvarying vec3 wview;\r\nvarying vec3 wnormal;\r\nvarying vec3 wlight;\r\n#endif\r\n\r\n#ifdef OVERLAY\r\n// these variables combine two possible overlays into one by using a vec4:\r\n// components x/y are x/y of overlay 0, and components z/w are x/y of overlay 1\r\nuniform vec4 overlayTexOffset;\r\nuniform vec4 overlayTexScale;\r\nvarying vec4 vtcOverlay;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\nuniform vec4 screenSizePerspective;\r\n\r\nvarying float screenSizeDistanceToCamera;\r\nvarying float screenSizeCosAngle;\r\n\r\n#endif\r\n\r\nvoid main(void) {\r\n  vpos \x3d position;\r\n\r\n#ifdef SPHERICAL\r\n  vnormal \x3d normalize(vpos + origin);\r\n#else\r\n  vnormal \x3d vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\r\n#endif\r\n\r\nvec2 uv \x3d uv0;\r\nvpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\r\n\r\n#ifdef ATMOSPHERE\r\n  wpos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n  wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\r\n  wlight \x3d (view  * vec4(lightDirection, 1.0)).xyz;\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n  vuv \x3d uv;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n  vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n\r\n  screenSizeDistanceToCamera \x3d length(viewPos);\r\n\r\n  vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\r\n  screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\r\n\r\n#endif\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n  vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\r\n\r\n#ifdef OVERLAY\r\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\r\n#endif\r\n}\r\n",
"depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n#ifndef BIAS_SHADOWMAP\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n}\r\n","depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec2 nearFar;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#ifdef SPHERICAL\r\n  vec3 normal \x3d normalize(position + origin);\r\n#else\r\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1.0);\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n#include \x3cterrainRenderer/overlay.glsl\x3e\r\n\r\nuniform sampler2D overlay0Tex;\r\nuniform sampler2D overlay1Tex;\r\nuniform float overlayOpacity;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvarying vec4 vtcOverlay;\r\n\r\nvoid main() {\r\n  vec4 overlayColor \x3d getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\r\n\r\n  if (overlayColor.a \x3d\x3d 0.0) {\r\n    // Here we have to write black, instead of discarding the fragment in order to overwrite\r\n    // the highlights which might have been written by skirts of other tiles.\r\n    // As a consequence skirts are not visible, but terrain overwrites draped highlights.\r\n    gl_FragColor \x3d vec4(0.0);\r\n    return;\r\n  }\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec4 overlayTexScale;\r\nuniform vec4 overlayTexOffset;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vpos;\r\nvarying vec4 vtcOverlay;\r\n\r\nvoid main() {\r\n  #ifdef SPHERICAL\r\n    vec3 vnormal \x3d normalize(position + origin);\r\n  #else\r\n    vec3 vnormal \x3d vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\r\n  #endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\r\n\r\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n",
"normalPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n}\r\n","normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 viewNormal;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#ifdef SPHERICAL\r\n  vec4 normal \x3d vec4(normalize(position + origin), 1.0);\r\n#else\r\n  vec4 normal \x3d vec4(0.0, 0.0, 1.0, 1.0);\r\n#endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n  vnormal \x3d normalize((viewNormal * normal).xyz);\r\n}\r\n",
"overlay.glsl":"vec4 getOverlayColor(sampler2D overlay0Tex, sampler2D overlay1Tex, vec4 texCoords, float opacity) {\r\n  vec4 color \x3d vec4(0.0);\r\n\r\n  if ((texCoords.x \x3e 0.0) \x26\x26 (texCoords.x \x3c 1.0) \x26\x26 (texCoords.y \x3e 0.0) \x26\x26 (texCoords.y \x3c 1.0)) {\r\n    // inner overlay texture coordinates are within bounds -\x3e sample from inner overlay\r\n    color \x3d texture2D(overlay0Tex, texCoords.xy);\r\n  } else if ((texCoords.z \x3e 0.0) \x26\x26 (texCoords.z \x3c 1.0) \x26\x26 (texCoords.w \x3e 0.0) \x26\x26 (texCoords.w \x3c 1.0)) {\r\n    // sample from outer overlay\r\n    color \x3d texture2D(overlay1Tex, texCoords.zw);\r\n  }\r\n\r\n  return color * opacity;\r\n}\r\n",
"skirts.glsl":'vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\r\n  float skirtLength \x3d 0.0;\r\n\r\n  if (uv.x \x3e\x3d 2.0) {\r\n    skirtLength \x3d uv.y * skirtScale;\r\n    // decode original uv-coordinates (see "encodeSkirtPos")\r\n    vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\r\n    uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\r\n  }\r\n\r\n  return vpos - vnormal * skirtLength;\r\n}\r\n'},util:{"alignPixel.glsl":"vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\r\n  // From clip space to (0 : 1), bias towards right pixel edge\r\n  vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n  // Size of a pixel in range (0 : 1)\r\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n  // Round to nearest pixel center\r\n  vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\r\n\r\n  // Convert back to clip space\r\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n  return vec4(result, clipCoord.zw);\r\n}\r\n\r\nvec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\r\n  // From clip space to (0 : 1),\r\n  vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n  // Size of a pixel in range (0 : 1)\r\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n  // Round to nearest pixel border, (0 : 1)\r\n  vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\r\n\r\n  // Convert back to clip space\r\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n  return vec4(result, clipCoord.zw);\r\n}\r\n",
"color.glsl":"vec4 premultiplyAlpha(vec4 v) {\r\n  return vec4(v.rgb * v.a, v.a);\r\n}\r\n\r\nvec3 rgb2hsv(vec3 c) {\r\n  vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n  vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n  vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n  float d \x3d q.x - min(q.w, q.y);\r\n  float e \x3d 1.0e-10;\r\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n\r\nvec3 hsv2rgb(vec3 c) {\r\n  vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n  vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n",
"depth.glsl":"float calcFragDepth(const in float depth) {\r\n  //calc polygon offset\r\n  const float SLOPE_SCALE \x3d 2.0;\r\n  const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\r\n  float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\r\n  float result \x3d depth + SLOPE_SCALE * m + BIAS;\r\n  return clamp(result, .0, .999999);\r\n}\r\n","doublePrecision.glsl":"// based on https://www.thasler.com/blog/blog/glsl-part2-emu\r\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\r\n  vec3 t1 \x3d hiA + hiB;\r\n  vec3 e \x3d t1 - hiA;\r\n  vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\r\n  return t1 + t2;\r\n}\r\n",
"enableExtensions.glsl":"#define EXTENSIONS_ENABLED\r\n#extension GL_OES_standard_derivatives : enable\r\n#extension GL_EXT_shader_texture_lod : enable\r\n","encoding.glsl":"// This is the maximum float value representable as 32bit fixed point,\r\n// it is rgba2float(vec4(1)) inlined.\r\nconst float MAX_RGBA_FLOAT \x3d\r\n  255.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 / 256.0 / 256.0;\r\n\r\n// Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\r\nconst vec4 fixedPointFactors \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\r\n\r\nvec4 float2rgba(const float value) {\r\n  // Make sure value is in the domain we can represent\r\n  float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\r\n\r\n  // Decompose value in 32bit fixed point parts represented as\r\n  // uint8 rgba components. Decomposition uses the fractional part after multiplying\r\n  // by a power of 256 (this removes the bits that are represented in the previous\r\n  // component) and then converts the fractional part to 8bits.\r\n  vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\r\n\r\n  // Convert uint8 values (from 0 to 255) to floating point representation for\r\n  // the shader\r\n  const float toU8AsFloat \x3d 1.0 / 255.0;\r\n\r\n  return fixedPointU8 * toU8AsFloat;\r\n}\r\n\r\n// Factors to convert rgba back to float\r\nconst vec4 rgba2float_factors \x3d vec4(\r\n  255.0 / (256.0),\r\n  255.0 / (256.0 * 256.0),\r\n  255.0 / (256.0 * 256.0 * 256.0),\r\n  255.0 / (256.0 * 256.0 * 256.0 * 256.0)\r\n);\r\n\r\nfloat rgba2float(vec4 rgba) {\r\n  // Convert components from 0-\x3e1 back to 0-\x3e255 and then\r\n  // add the components together with their corresponding\r\n  // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\r\n  return dot(rgba, rgba2float_factors);\r\n}\r\n",
"fsPrecision.glsl":"#ifdef GL_FRAGMENT_PRECISION_HIGH\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n#else\r\nprecision mediump float;\r\nprecision mediump sampler2D;\r\n#endif\r\n","highlight.glsl":"vec4 highlightData(vec4 fragCoord, sampler2D depthTex, vec4 viewportPixelSize) {\r\n  float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - viewportPixelSize.xy) * viewportPixelSize.zw).r;\r\n  if (fragCoord.z \x3e sceneDepth + 5e-6) {\r\n    return vec4(1.0, 1.0, 0.0, 1.0);\r\n  }\r\n  else {\r\n    return vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n}\r\n",
"hud.glsl":"#include \x3cutil/screenSizePerspective.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec4 auxpos1;\r\n\r\nuniform mat4 proj;\r\n\r\nuniform mat4 view;\r\nuniform mat4 viewNormal;\r\n\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n\r\nuniform vec4 viewport;\r\n\r\nuniform vec3 camPos;\r\n\r\nuniform float polygonOffset;\r\nuniform float cameraGroundRelative;\r\nuniform float pixelRatio;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n// [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\r\nuniform vec4 verticalOffset;\r\n\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n// [ divisor, offset, minPixelSize, paddingPixels ]\r\nuniform vec4 screenSizePerspectiveAlignment;\r\n\r\n#endif\r\n\r\nuniform sampler2D hudVisibilityTexture;\r\n\r\n\r\n// Corresponds to cos(10 deg), used to compare against dot product of two vectors\r\nconst float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\r\n\r\nstruct ProjectHUDAux {\r\n  vec3 posModel;\r\n  vec3 posView;\r\n  vec3 vnormal;\r\n\r\n  float distanceToCamera;\r\n  float absCosAngle;\r\n};\r\n\r\n\r\n/**\r\n  * Apply the simulated polygon offset for HUD objects that improves\r\n  * issues with Z-fighting.\r\n  *\r\n  * @param posView {vec3} (inout) the position in view space. Will be modified in place.\r\n  * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\r\n  * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\r\n  *   and the view direction.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Attributes:\r\n  *     - auxpos1: contains centerOffset and pointGroundDistance\r\n  *\r\n  *   Uniforms:\r\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n  *         reduced flickering.\r\n  *     - viewport: the viewport [x, y, width, height]\r\n  */\r\nfloat applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\r\n  float pointGroundSign \x3d sign(pointGroundDistance);\r\n\r\n  if (pointGroundSign \x3d\x3d 0.0) {\r\n    pointGroundSign \x3d 1.0;\r\n  }\r\n\r\n  // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\r\n  // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\r\n  float groundRelative \x3d cameraGroundRelative * pointGroundSign;\r\n\r\n  // view angle dependent part of polygon offset emulation\r\n  // we take the absolute value because the sign that is dropped is\r\n  // instead introduced using the ground-relative position of the symbol and the camera\r\n  if (polygonOffset \x3e .0) {\r\n    float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\r\n\r\n    float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\r\n    float factor \x3d (1.0 - tanAlpha / viewport[2]);\r\n\r\n    // same side of the terrain\r\n    if (groundRelative \x3e 0.0) {\r\n      posView *\x3d factor;\r\n    }\r\n    // opposite sides of the terrain\r\n    else {\r\n      posView /\x3d factor;\r\n    }\r\n  }\r\n\r\n  return groundRelative;\r\n}\r\n\r\n/**\r\n  * Project the 3d position of a HUD object from world space to clip space. In addition\r\n  * to standard model view projection, it also emulates a polygon offset to\r\n  * help with points above/below ground and icon flickering. The resulting location\r\n  * is the anchor of the HUD object, i.e. the position that is used also for testing\r\n  * visibility of the HUD object. Note that the returned projected position is not\r\n  * aligned to a pixel center or border, it is up to the caller to align if necessary.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Attributes:\r\n  *     - position: contains the point world position\r\n  *     - normal: contains the world normal pointing up at the point\r\n  *     - auxpos1: contains centerOffset and pointGroundDistance\r\n  *\r\n  *   Uniforms:\r\n  *     - model: the object -\x3e world transformation matrix\r\n  *     - modelNormal: the object -\x3e world normal transformation matrix (inv transp of model)\r\n  *     - view: the world -\x3e view transformation matrix\r\n  *     - viewNormal: the world -\x3e view normal transformation matrix (inv transp of view)\r\n  *     - proj: the view -\x3e clip projection matrix\r\n  *     - verticalOffset: a vec4 containing:\r\n  *         - the screen height of the vertical offset\r\n  *         - the screen height of the vertical offset as a fraction of camera distance.\r\n  *         - the minimum world size vertical offset.\r\n  *         - the maximum world size vertical offset.\r\n  *       This will do a screen sized offset of the point along its normal (used for line callouts)\r\n  *     - screenSizePerspectiveAlignment: a vec3 containing\r\n  *         - the view distance dependent divisor\r\n  *         - the view distance dependent offset\r\n  *         - the minimum pixel size\r\n  *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\r\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n  *         reduced flickering.\r\n  *     - camPos: the position of the camera in world space\r\n  *     - viewport: the viewport [x, y, width, height]\r\n  */\r\nvec4 projectPositionHUD(out ProjectHUDAux aux) {\r\n  // centerOffset is in view space and is used to implement world size offsetting\r\n  // of labels with respect to objects. It also pulls the label towards the viewer\r\n  // so that the label is visible in front of the object.\r\n  vec3 centerOffset \x3d auxpos1.xyz;\r\n\r\n  // The pointGroundDistance is the distance of the geometry to the ground and is\r\n  // negative if the point is below the ground, or positive if the point is above\r\n  // ground.\r\n  float pointGroundDistance \x3d auxpos1.w;\r\n\r\n  aux.posModel \x3d (model * vec4(position, 1.0)).xyz;\r\n  aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\r\n  aux.vnormal \x3d (modelNormal * vec4(normal, 1.0)).xyz;\r\n\r\n  // Screen sized offset in world space, used for example for line callouts\r\n  // Note: keep this implementation in sync with the CPU implementation, see\r\n  //   - MaterialUtil.verticalOffsetAtDistance\r\n  //   - HUDMaterial.applyVerticalOffsetTransformation\r\n\r\n  aux.distanceToCamera \x3d length(aux.posView);\r\n\r\n  vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\r\n  float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\r\n\r\n  aux.absCosAngle \x3d abs(cosAngle);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\r\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\r\n#endif\r\n\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\r\n#else\r\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\r\n  vec3 modelOffset \x3d aux.vnormal * worldOffset;\r\n\r\n  aux.posModel +\x3d modelOffset;\r\n\r\n  vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\r\n  aux.posView +\x3d viewOffset;\r\n\r\n  // Since we elevate the object, we need to take that into account\r\n  // in the distance to ground\r\n  pointGroundDistance +\x3d worldOffset;\r\n\r\n#endif\r\n\r\n  float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\r\n\r\n#ifndef CENTER_OFFSET_UNITS_SCREEN\r\n  // Apply x/y in view space, but z in screen space (i.e. along posView direction)\r\n  aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\r\n\r\n  // Same material all have same z !\x3d 0.0 condition so should not lead to\r\n  // branch fragmentation and will save a normalization if it's not needed\r\n  if (centerOffset.z !\x3d 0.0) {\r\n    aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\r\n  }\r\n#endif\r\n\r\n  vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\r\n\r\n#ifdef CENTER_OFFSET_UNITS_SCREEN\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\r\n#else\r\n  float centerOffsetY \x3d centerOffset.y;\r\n#endif\r\n\r\n  posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;\r\n\r\n#endif\r\n\r\n  // constant part of polygon offset emulation\r\n  posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\r\n\r\n  return posProj;\r\n}\r\n\r\nuniform float uRenderTransparentlyOccludedHUD;\r\n\r\n/**\r\n  * Test for visibility of a HUD object.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Uniforms:\r\n  *     - hudVisibilityTexture: the texture that contains the visibility information\r\n  *     - markerColor: the special marker color that is used to write visibility information\r\n  *     - viewport: the viewport\r\n  */\r\nbool testVisibilityHUD(vec4 posProj) {\r\n  // For occlusion testing, use the nearest pixel center to avoid\r\n  // subpixel filtering messing up the color we use to test for\r\n  vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n  vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\r\n\r\n  // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\r\n  // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\r\n  // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\r\n\r\n  // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\r\n  if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\r\n    // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\r\n    // uRenderTransparentlyOccludedHUD \x3d 0.75\r\n    return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\r\n  }\r\n  // and visible pixels that are not occluded by semi-transparent geometry here\r\n  else {\r\n    return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\r\n  }\r\n\r\n  // return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r \x3e 0.0;\r\n}\r\n",
"normalEncoding.glsl":"vec3 decodeNormal(vec2 f) {\r\n    float z \x3d 1.0 - abs(f.x) - abs(f.y);\r\n    return vec3(f + sign(f) * min(z, 0.0), z);\r\n}\r\n","quad.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position.x, position.y, .0, 1.0);\r\n  uv \x3d position * .5 + vec2(.5);\r\n}\r\n","sceneLighting.glsl":"// Scene Lighting Definitions:\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\n// defines:\r\n//   - SH_ORDER: 1|2|3\r\n// input:\r\n//   - normal: vec3\r\n//   - albedo: vec3\r\n//   - shadow: float\r\n//   - ssao: float\r\n// return:\r\n//   - color: vec3\r\n\r\n// main light\r\n/////////////////////////////////////////\r\nuniform vec3 lightingMainDirection;\r\nuniform vec3 lightingMainIntensity;\r\n\r\n// ambient lighting\r\n/////////////////////////////////////////\r\n#ifndef SH_ORDER\r\n  #define SH_ORDER 2\r\n#endif\r\n\r\n#if SH_ORDER \x3d\x3d 0\r\n  uniform vec3 lightingAmbientSH0;\r\n#elif SH_ORDER \x3d\x3d 1\r\n  uniform vec4 lightingAmbientSH_R;\r\n  uniform vec4 lightingAmbientSH_G;\r\n  uniform vec4 lightingAmbientSH_B;\r\n#elif SH_ORDER \x3d\x3d 2\r\n  uniform vec3 lightingAmbientSH0;\r\n  uniform vec4 lightingAmbientSH_R1;\r\n  uniform vec4 lightingAmbientSH_G1;\r\n  uniform vec4 lightingAmbientSH_B1;\r\n  uniform vec4 lightingAmbientSH_R2;\r\n  uniform vec4 lightingAmbientSH_G2;\r\n  uniform vec4 lightingAmbientSH_B2;\r\n#endif\r\n\r\n// special tweaking\r\n//////////////////////////////////////////\r\nuniform float lightingFixedFactor;\r\nuniform float lightingGlobalFactor;\r\n\r\nuniform float ambientBoostFactor;\r\n\r\n// evaluation\r\n//////////////////////////////////////////\r\n\r\nvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\r\n  // evaluate the main light\r\n  #if defined(TREE_RENDERING)\r\n    // Special case for tree rendering:\r\n    // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\r\n    // facing away from the light. The idea is to get an effect where light is transmitted\r\n    // through the tree.\r\n    float minDot \x3d -0.5;\r\n    float dotRange \x3d 1.0 - minDot;\r\n    float dotNormalization \x3d 0.66; // guessed \x26 hand tweaked value, for an exact value we could precompute an integral over the sphere\r\n\r\n    float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\r\n  #else\r\n    float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\r\n  #endif\r\n\r\n  // move lighting towards (1.0, 1.0, 1.0) if requested\r\n  dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\r\n\r\n  vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\r\n\r\n  // evaluate the sh ambient light\r\n  #if SH_ORDER \x3d\x3d 0\r\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n  #elif SH_ORDER \x3d\x3d 1\r\n    vec4 sh0 \x3d vec4(\r\n      0.282095,\r\n      0.488603 * normal.x,\r\n      0.488603 * normal.z,\r\n      0.488603 * normal.y\r\n    );\r\n    vec3 ambientLight \x3d vec3(\r\n      dot(lightingAmbientSH_R, sh0),\r\n      dot(lightingAmbientSH_G, sh0),\r\n      dot(lightingAmbientSH_B, sh0)\r\n    );\r\n  #elif SH_ORDER \x3d\x3d 2\r\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n\r\n    vec4 sh1 \x3d vec4(\r\n      0.488603 * normal.x,\r\n      0.488603 * normal.z,\r\n      0.488603 * normal.y,\r\n      1.092548 * normal.x * normal.y\r\n    );\r\n    vec4 sh2 \x3d vec4(\r\n      1.092548 * normal.y * normal.z,\r\n      0.315392 * (3.0 * normal.z * normal.z - 1.0),\r\n      1.092548 * normal.x * normal.z,\r\n      0.546274 * (normal.x * normal.x - normal.y * normal.y)\r\n    );\r\n    ambientLight +\x3d vec3(\r\n      dot(lightingAmbientSH_R1, sh1),\r\n      dot(lightingAmbientSH_G1, sh1),\r\n      dot(lightingAmbientSH_B1, sh1)\r\n    );\r\n    ambientLight +\x3d vec3(\r\n      dot(lightingAmbientSH_R2, sh2),\r\n      dot(lightingAmbientSH_G2, sh2),\r\n      dot(lightingAmbientSH_B2, sh2)\r\n    );\r\n  #endif\r\n  ambientLight *\x3d (1.0 - ssao);\r\n\r\n  // inverse gamma correction on the albedo color\r\n  float gamma \x3d 2.1;\r\n  vec3 albedoGammaC \x3d pow(albedo, vec3(gamma));\r\n\r\n  // physically correct BRDF normalizes by PI\r\n  const float PI \x3d 3.14159;\r\n  vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\r\n  totalLight \x3d min(totalLight, vec3(PI, PI, PI));\r\n  vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\r\n\r\n  // apply gamma correction to the computed color\r\n  outColor \x3d pow(outColor, vec3(1.0/gamma));\r\n\r\n  return outColor;\r\n}\r\n\r\nvec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\r\n  // heuristic lighting model originally used in the terrain shading\r\n  // now used to generated additional ambient light\r\n\r\n#ifdef VIEWING_MODE_GLOBAL\r\n    float vndl \x3d -dot(normalize(worldPos), lightingMainDirection);\r\n#else\r\n    float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\r\n#endif\r\n\r\n  additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\r\n  return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n}\r\n",
"screenSizePerspective.glsl":"// Note that the implementation here should be kept in sync with the corresponding\r\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\r\n\r\n/**\r\n * Compute the screen size perspective lower bound from pre-computed screen\r\n * size perspective factors (or parameters, since both store the pixel lower\r\n * bound information in the same place). When computing the minimum size,\r\n * the padding (e.g. text halo) is scaled with the same factor as the\r\n * original size scales to reach the minimum size.\r\n *\r\n * {\r\n *    x: N/A\r\n *    y: N/A\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\r\n\r\n  // Original calculation:\r\n  //   padding \x3d 2 * factor.w\r\n  //   minSize \x3d factor.z\r\n  //\r\n  //   minSize + minSize / size * padding\r\n  //\r\n  // Incorporates padding (factor.w, e.g. text halo size) into the\r\n  // minimum bounds calculation, taking into account that padding\r\n  // would scale down proportionally to the size.\r\n  //\r\n  // Calculation below is the same, but avoids division by zero when\r\n  // size would be zero, without branching using step.\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\r\n\r\n  // nonZeroSize is 1 if size \x3e 0, and 0 otherwise\r\n  float nonZeroSize \x3d 1.0 - step(size, 0.0);\r\n\r\n  return (\r\n    factor.z * (\r\n      1.0 +\r\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\r\n                                   // proportionally scaled padding\r\n      2.0 * factor.w / (\r\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\r\n      )\r\n    )\r\n  );\r\n}\r\n\r\n/**\r\n * Computes the view angle dependent screen size perspective factor. The goal\r\n * of this factor is that:\r\n *\r\n *   1. There is no perspective when looking top-down\r\n *   2. There is a smooth and quick transition to full perspective when\r\n *      tilting.\r\n */\r\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\r\n  return absCosAngle * absCosAngle * absCosAngle;\r\n}\r\n\r\n/**\r\n * Precomputes a set of factors that can be used to apply screen size perspective\r\n * The factors are based on the viewing angle, distance to camera and the screen size\r\n * perspective parameters:\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n *\r\n * The result is a set of factors that can be used to apply the perspective:\r\n *\r\n * {\r\n *    x: distance based relative scale factor (0 -\x3e 1)\r\n *    y: view dependent scale factor\r\n *    z: minPixelSize (abs)\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\r\n */\r\n\r\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\r\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\r\n */\r\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\r\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n",
"shadow.glsl":'#include \x3cutil/encoding.glsl\x3e\r\n\r\n// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\r\n// once IE11 is fine with it, const should probably be re-introduced\r\nfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\r\n  //choose correct cascade\r\n  int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\r\n\r\n  if (i \x3e\x3d num) { return .0; }\r\n\r\n  mat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\r\n\r\n  vec4 lv \x3d mat * vec4(vpos, 1.0);\r\n  lv.xy /\x3d lv.w;\r\n\r\n  //vertex completely outside? -\x3e no shadow\r\n  vec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\r\n  if (lvpos.z \x3e\x3d 1.0) { return .0; }\r\n  if (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) { return .0; }\r\n\r\n  //calc coord in cascade texture\r\n  vec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\r\n\r\n  float texSize \x3d .5 / halfPxSz;\r\n\r\n  //filter, offset by half pixels\r\n  vec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\r\n\r\n  float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\r\n  return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\r\n}\r\n',
"slice.glsl":"#ifdef SLICE\r\nuniform vec3 slicePlaneOrigin;\r\nuniform vec3 slicePlaneBasis1;\r\nuniform vec3 slicePlaneBasis2;\r\n\r\nstruct SliceFactors {\r\n  float front;\r\n  float side0;\r\n  float side1;\r\n  float side2;\r\n  float side3;\r\n};\r\n\r\nSliceFactors calculateSliceFactors(vec3 pos) {\r\n  vec3 rel \x3d pos - slicePlaneOrigin;\r\n\r\n  vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\r\n  float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\r\n\r\n  float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\r\n  float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\r\n\r\n  float basis1Dot \x3d dot(slicePlaneBasis1, rel);\r\n  float basis2Dot \x3d dot(slicePlaneBasis2, rel);\r\n\r\n  return SliceFactors(\r\n    dot(slicePlaneNormal, pos) + slicePlaneW,\r\n    -basis1Dot - basis1Len2,\r\n    basis1Dot - basis1Len2,\r\n    -basis2Dot - basis2Len2,\r\n    basis2Dot - basis2Len2\r\n  );\r\n}\r\n\r\nbool sliceByFactors(SliceFactors factors) {\r\n  return factors.front \x3c 0.0\r\n    \x26\x26 factors.side0 \x3c 0.0\r\n    \x26\x26 factors.side1 \x3c 0.0\r\n    \x26\x26 factors.side2 \x3c 0.0\r\n    \x26\x26 factors.side3 \x3c 0.0;\r\n}\r\n\r\nbool sliceByPlane(vec3 pos) {\r\n  return sliceByFactors(calculateSliceFactors(pos));\r\n}\r\n\r\n#ifdef EXTENSIONS_ENABLED\r\n\r\nvec4 applySliceHighlight(vec4 color, vec3 pos) {\r\n  SliceFactors factors \x3d calculateSliceFactors(pos);\r\n\r\n  if (sliceByFactors(factors)) {\r\n    return color;\r\n  }\r\n\r\n  const float HIGHLIGHT_WIDTH \x3d 1.0;\r\n  const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\r\n\r\n  factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\r\n  factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\r\n  factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\r\n  factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\r\n  factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\r\n\r\n  float highlightFactor \x3d (1.0 - step(0.5, factors.front))\r\n    * (1.0 - step(0.5, factors.side0))\r\n    * (1.0 - step(0.5, factors.side1))\r\n    * (1.0 - step(0.5, factors.side2))\r\n    * (1.0 - step(0.5, factors.side3));\r\n\r\n  return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\r\n}\r\n\r\n#else // EXTENSIONS_ENABLED\r\n\r\n// GL_OES_standard_derivatives must be enabled for applySliceHighlight\r\n\r\n#endif // EXTENSIONS_ENABLED\r\n\r\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\r\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\r\n#define highlightSlice(_color_, _pos_) applySliceHighlight(_color_, _pos_)\r\n\r\n#else // SLICE\r\n\r\n#define rejectBySlice(_pos_) false\r\n#define discardBySlice(_pos_) {}\r\n#define highlightSlice(_color_, _pos_) (_color_)\r\n\r\n#endif // SLICE\r\n",
"visualVariables.glsl":"#if defined(VV_SIZE)\r\n  #define VV_CUSTOM_MODEL_MATRIX\r\n#endif\r\n\r\n#if defined(VV_SIZE)\r\n  uniform vec3 vvSizeMinSize;\r\n  uniform vec3 vvSizeMaxSize;\r\n  uniform vec3 vvSizeOffset;\r\n  uniform vec3 vvSizeFactor;\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n  uniform vec3 vvSizeValue;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  uniform mat3 vvSymbolRotation;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  uniform vec3 vvSymbolAnchor;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  #define VV_COLOR_N 8\r\n  uniform float vvColorValues[VV_COLOR_N];\r\n  uniform vec4 vvColorColors[VV_COLOR_N];\r\n#endif\r\n\r\n// Evaluation of size\r\n#if defined(VV_SIZE)\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\r\n  }\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return vvSizeValue;\r\n  }\r\n#endif\r\n\r\n// Applying the model matrix\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\r\n    return vec4(vvSymbolRotation * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\r\n  }\r\n\r\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\r\n    // Normal transform is the inverse transpose of model transform\r\n    return vec4(vvSymbolRotation * normal / vvGetScale(featureAttribute), 1.0);\r\n  }\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\r\n    float value \x3d featureAttribute.y;\r\n    if (value \x3c\x3d values[0]) {\r\n      return colors[0];\r\n    }\r\n\r\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n      if (values[i] \x3e\x3d value) {\r\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n        return mix(colors[i-1], colors[i], f);\r\n      }\r\n    }\r\n\r\n    return colors[VV_COLOR_N - 1];\r\n  }\r\n#endif\r\n",
"vsPrecision.glsl":"precision highp float;\r\nprecision highp sampler2D;\r\n"}}})},"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(p,f){return function(){function k(a){this.readFile=a}k.prototype.resolveIncludes=function(a){return this.resolve(a)};k.prototype.resolve=function(a,g){var b=this;void 0===g&&(g=new Map);if(g.has(a))return g.get(a);var e=this.read(a);if(!e)throw Error("cannot find shader file "+a);for(var c=/^\h?#include\s+<(\S+)>\h?/gm,d=c.exec(e),m=
[];null!=d;)m.push({path:d[1],start:d.index,length:d[0].length}),d=c.exec(e);var l=0,h="";m.forEach(function(a){h+=e.slice(l,a.start);h+=g.has(a.path)?"":b.resolve(a.path,g);l=a.start+a.length});h+=e.slice(l);g.set(a,h);return h};k.prototype.read=function(a){return this.readFile(a)};return k}()})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],function(p,f,k){function a(a,b,e){e=e||{};e="function"===typeof b.shaders?b.shaders(e):b.shaders;return new k(a,e.vertexShader,
e.fragmentShader,b.attributes)}Object.defineProperty(f,"__esModule",{value:!0});f.glslifyDefineMap=function(a){var b="",e;for(e in a){var c=a[e];if("boolean"===typeof c)c&&(b+="#define "+e+"\n");else if("number"===typeof c)b+="#define "+e+" "+c.toFixed()+"\n";else if("object"===typeof c){var d=c.options,m=0,l;for(l in d)b+="#define "+d[l]+" "+(m++).toFixed()+"\n";b+="#define "+e+" "+d[c.value]+"\n"}}return b};p=function(){function g(a){this._programCacheByTemplate=new Map;this._rctx=a}g.prototype.dispose=
function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});this._programCacheByTemplate=null};g.prototype.getProgram=function(b,e){var c=this;this._programCacheByTemplate.has(b)||this.addProgramTemplate(b,function(d){return a(c._rctx,b,d)});return this.getProgramTemplateInstance(b,e)};g.prototype.addProgramTemplate=function(a,e){this._programCacheByTemplate.set(a,{constructor:e,programs:new Map})};g.prototype.getProgramTemplateInstance=function(a,e){if(a=
this._programCacheByTemplate.get(a)){var b=e?JSON.stringify(e):"default";a.programs.has(b)||(e=a.constructor(e),a.programs.set(b,e));return a.programs.get(b)}return null};return g}();f.ProgramCache=p;f.createProgram=a})},"esri/views/webgl/Program":function(){define(["require","exports","../../core/has","./ShaderTranspiler"],function(p,f,k,a){return function(){function g(a,e,c,d,m){void 0===m&&(m={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=
this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};a||console.error("RenderingContext isn't initialized!");0===e.length&&console.error("Shaders source should not be empty!");this._context=a;this._vertexShaderSource=e;this._fragmentShaderSource=c;if(Array.isArray(m))for(a=0;a<
m.length;a++)this._defines[m[a]]="1";else this._defines=m;this._id=g._nextId++;this._locations=d}Object.defineProperty(g.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});g.prototype.getDefine=function(a){return this._defines[a]};g.prototype.dispose=
function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};g.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,e=a.createProgram();
a.attachShader(e,this._vShader);a.attachShader(e,this._fShader);for(var c in this._locations)a.bindAttribLocation(e,this._locations[c],c);a.linkProgram(e);a.getProgramParameter(e,a.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+a.getProgramParameter(e,a.VALIDATE_STATUS)+", gl error ["+a.getError()+"]infoLog: "+a.getProgramInfoLog(e));this._glName=e;this._initialized=!0}};g.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&
(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};g.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};g.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};g.prototype.setUniform1i=function(a,e){var b=this._nameToUniform1[a];if(void 0===
b||e!==b)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),e),this._nameToUniform1[a]=e};g.prototype.setUniform1f=function(a,e){var b=this._nameToUniform1[a];if(void 0===b||e!==b)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),e),this._nameToUniform1[a]=e};g.prototype.setUniform1fv=function(a,e){var b=this._nameToUniform1v[a];void 0!==b&&g._arraysEqual(e,b)||(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(a),
e),void 0===b?this._nameToUniform1v[a]=g._arrayCopy(e):g._arrayAssign(e,b))};g.prototype.setUniform2f=function(a,e,c){var b=this._nameToUniform2[a];if(void 0===b||e!==b[0]||c!==b[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),e,c),void 0===b?this._nameToUniform2[a]=[e,c]:(b[0]=e,b[1]=c)};g.prototype.setUniform2fv=function(a,e){var b=this._nameToUniform2[a];void 0!==b&&g._arraysEqual(e,b)||(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(a),
e),void 0===b?this._nameToUniform2[a]=g._arrayCopy(e):g._arrayAssign(e,b))};g.prototype.setUniform3f=function(a,e,c,d){var b=this._nameToUniform3[a];if(void 0===b||e!==b[0]||c!==b[1]||d!==b[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),e,c,d),void 0===b?this._nameToUniform3[a]=[e,c,d]:(b[0]=e,b[1]=c,b[2]=d)};g.prototype.setUniform3fv=function(a,e){var b=this._nameToUniform3[a];void 0!==b&&g._arraysEqual(e,b)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(a),
e),void 0===b?this._nameToUniform3[a]=g._arrayCopy(e):g._arrayAssign(e,b))};g.prototype.setUniform4f=function(a,e,c,d,m){var b=this._nameToUniform4[a];if(void 0===b||e!==b[0]||c!==b[1]||d!==b[2]||m!==b[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(a),e,c,d,m),void 0===b?this._nameToUniform4[a]=[e,c,d,m]:(b[0]=e,b[1]=c,b[2]=d,b[3]=m)};g.prototype.setUniform4fv=function(a,e){var b=this._nameToUniform4[a];void 0!==b&&g._arraysEqual(e,b)||(this._context.bindProgram(this),
this._context.gl.uniform4fv(this.getUniformLocation(a),e),void 0===b?this._nameToUniform4[a]=g._arrayCopy(e):g._arrayAssign(e,b))};g.prototype.setUniformMatrix3fv=function(a,e,c){void 0===c&&(c=!1);var b=this._nameToUniformMatrix3[a];void 0!==b&&(9===b.length?g._matrix3Equal(b,e):g._arraysEqual(e,b))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(a),c,e),void 0===b?this._nameToUniformMatrix3[a]=g._arrayCopy(e):g._arrayAssign(e,b))};g.prototype.setUniformMatrix4fv=
function(a,e,c){void 0===c&&(c=!1);var b=this._nameToUniformMatrix4[a];void 0!==b&&(16===b.length?g._matrix4Equal(b,e):g._arraysEqual(e,b))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(a),c,e),void 0===b?this._nameToUniformMatrix4[a]=g._arrayCopy(e):g._arrayAssign(e,b))};g._padToThree=function(a){var b=a.toString();1E3>a&&(b=("  "+a).slice(-3));return b};g.prototype._addLineNumbers=function(a){var b=2;return a.replace(/\n/g,function(){return"\n"+g._padToThree(b++)+
":"})};g.prototype._loadShader=function(b){var e=35633===b,c=e?this._vertexShaderSource:this._fragmentShaderSource,d;d="";for(var m in this._defines)d+="#define "+m+" "+this._defines[m]+"\n";d+=c;"webgl2"===this._context.contextVersion&&(d=a.transpileShader(d,e?"vertex":"fragment"));e=this._context.gl;b=e.createShader(b);e.shaderSource(b,d);e.compileShader(b);e.getShaderParameter(b,e.COMPILE_STATUS)||(console.error(e.getShaderInfoLog(b)),console.error(this._addLineNumbers(d)),"webgl2"===this._context.contextVersion&&
(console.log("Shader source before transpilation:"),console.log(c)));return b};g._matrix4Equal=function(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]&&a[3]===e[3]&&a[4]===e[4]&&a[5]===e[5]&&a[6]===e[6]&&a[7]===e[7]&&a[8]===e[8]&&a[9]===e[9]&&a[10]===e[10]&&a[11]===e[11]&&a[12]===e[12]&&a[13]===e[13]&&a[14]===e[14]&&a[15]===e[15]};g._matrix3Equal=function(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]&&a[3]===e[3]&&a[4]===e[4]&&a[5]===e[5]&&a[6]===e[6]&&a[7]===e[7]&&a[8]===e[8]};g._arraysEqual=
function(a,e){if(a.length!==e.length)return!1;for(var b=0;b<a.length;++b)if(a[b]!==e[b])return!1;return!0};g._arrayCopy=function(a){for(var b=[],c=0;c<a.length;++c)b.push(a[c]);return b};g._arrayAssign=function(a,e){for(var b=0;b<a.length;++b)e[b]=a[b]};g._nextId=0;return g}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(p,f,k,a){function g(a){return a.map(function(a){return"eof"!==a.type?a.data:""}).join("")}
function b(a,c,e,h){h=h||e;for(var d=0;d<a.length;d++){var l=a[d];if("ident"===l.type&&l.data===e)return h in c?c[h]++:c[h]=0,b(a,c,h+"_"+c[h],h)}return e}function e(a,b,c){void 0===c&&(c="afterVersion");var d={data:"\n",type:"whitespace"},e=function(b){return b<a.length?/[^\r\n]$/.test(a[b].data):!1},l=function(a){for(var b=-1,d=0,e=-1,h=0;h<a.length;h++){var l=a[h];"preprocessor"===l.type&&(l.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++d:l.data.match(/\#endif\s*.*/)&&--d);("afterVersion"===c||"afterPrecision"===
c)&&"preprocessor"===l.type&&/^#version/.test(l.data)&&(e=Math.max(e,h));if("afterPrecision"===c&&"keyword"===l.type&&"precision"===l.data){a:{for(l=h;l<a.length;l++){var m=a[l];if("operator"===m.type&&";"===m.data)break a}l=null}if(null===l)throw Error("precision statement not followed by any semicolons!");e=Math.max(e,l)}b<e&&0===d&&(b=h)}return b+1}(a);e(l-1)&&a.splice(l++,0,d);for(var m=0;m<b.length;m++){var g=b[m];a.splice(l++,0,g)}e(l-1)&&e(l)&&a.splice(l,0,d)}Object.defineProperty(f,"__esModule",
{value:!0});var c=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];f.transpileShader=function(d,m){d=a(d);var l;a:{l="100";var h="300 es";void 0===l&&(l="100");void 0===h&&(h="300 es");for(var n=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,q=0;q<d.length;q++){var t=d[q];if("preprocessor"===t.type){var u=n.exec(t.data);if(u)if(n=u[1].replace(/\s\s+/g," "),n===h){l=n;break a}else if(n===l){t.data="#version "+h;break a}else throw Error("unknown glsl version: "+
n);}}d.splice(0,0,{type:"preprocessor",data:"#version "+h},{type:"whitespace",data:"\n"});l=null}if("300 es"===l)throw Error("shader is already glsl 300 es");n=t=null;q={};u={};for(l=0;l<d.length;++l)switch(h=d[l],h.type){case "keyword":"vertex"===m&&"attribute"===h.data?h.data="in":"varying"===h.data&&(h.data="vertex"===m?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(h.data.trim())&&(h.data=h.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===m&&"gl_FragColor"===
h.data){if(!t){var t=b(d,q,"fragColor"),r=void 0;void 0===r&&(r="lowp");e(d,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}h.data=t}else"fragment"===m&&"gl_FragDepthEXT"===h.data&&(n||(n=b(d,q,"gl_FragDepth")),h.data=n);break;case "ident":if(0<=k.indexOf(h.data)){if(r="vertex"===m)a:{for(r=l-1;0<=r;r--){var f=
d[r];if("whitespace"!==f.type&&"block-comment"!==f.type)if("keyword"===f.type){if("attribute"===f.data||"in"===f.data){r=!0;break a}}else break}r=!1}if(r)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");h.data in u||(u[h.data]=b(d,q,h.data));h.data=u[h.data]}}for(l=d.length-1;0<=l;--l)h=d[l],"preprocessor"===h.type&&((m=h.data.match(/\#extension\s+(.*)\:/))&&m[1]&&0<=c.indexOf(m[1].trim())&&(m=d[l+1],d.splice(l,m&&"whitespace"===m.type?2:1)),(m=h.data.match(/\#ifdef\s+(.*)/))&&
m[1]&&0<=c.indexOf(m[1].trim())&&(h.data="#if 1"),(m=h.data.match(/\#ifndef\s+(.*)/))&&m[1]&&0<=c.indexOf(m[1].trim())&&(h.data="#if 0"));return g(d)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(p,f){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(p){"use strict;";return function(f){var k=p(),a=[],a=a.concat(k(f));return a=a.concat(k(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(p,f,k){"use strict;";var a="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function g(b){b.length&&y.push({type:a[q],
data:b,position:w,line:x,column:z})}function b(){r=r.length?[]:r;if("/"===u&&"*"===t)return w=n+h-1,q=0,u=t,h+1;if("/"===u&&"/"===t)return w=n+h-1,q=1,u=t,h+1;if("#"===t)return q=2,w=n+h,h;if(/\s/.test(t))return q=9,w=n+h,h;B=/\d/.test(t);C=/[^\w_]/.test(t);w=n+h;q=B?4:C?3:9999;return h}function e(){if(("\r"===t||"\n"===t)&&"\\"!==u)return g(r.join("")),q=999,h;r.push(t);u=t;return h+1}function c(){if("."===u&&/\d/.test(t))return q=5,h;if("/"===u&&"*"===t)return q=0,h;if("/"===u&&"/"===t)return q=
1,h;if("."===t&&r.length){for(;d(r););q=5;return h}if(";"===t||")"===t||"("===t){if(r.length)for(;d(r););g(t);q=999;return h+1}var a=2===r.length&&"\x3d"!==t;if(/[\w_\d\s]/.test(t)||a){for(;d(r););q=999;return h}r.push(t);u=t;return h+1}function d(a){var b=0,c,d;do{c=f.indexOf(a.slice(0,a.length+b).join(""));d=f[c];if(-1===c){if(0<b--+a.length)continue;d=a.slice(0,1).join("")}g(d);w+=d.length;r=r.slice(d.length);return r.length}while(1)}function m(){if("."===t||/[eE]/.test(t))return r.push(t),q=5,
u=t,h+1;if("x"===t&&1===r.length&&"0"===r[0])return q=11,r.push(t),u=t,h+1;if(/[^\d]/.test(t))return g(r.join("")),q=999,h;r.push(t);u=t;return h+1}function l(){"f"===t&&(r.push(t),u=t,h+=1);if(/[eE]/.test(t)||"-"===t&&/[eE]/.test(u))return r.push(t),u=t,h+1;if(/[^\d]/.test(t))return g(r.join("")),q=999,h;r.push(t);u=t;return h+1}var h=0,n=0,q=999,t,u,r=[],y=[],x=1,z=0,w=0,B=!1,C=!1,D="",E;return function(a){y=[];if(null!==a){a=a.replace?a.replace(/\r\n/g,"\n"):a;h=0;D+=a;for(E=D.length;t=D[h],h<
E;){a=h;switch(q){case 0:"/"===t&&"*"===u?(r.push(t),g(r.join("")),q=999):(r.push(t),u=t);h+=1;break;case 1:h=e();break;case 2:h=e();break;case 3:h=c();break;case 4:h=m();break;case 11:/[^a-fA-F0-9]/.test(t)?(g(r.join("")),q=999):(r.push(t),u=t,h+=1);break;case 5:h=l();break;case 9999:if(/[^\d\w_]/.test(t)){var d=r.join("");q=-1<p.indexOf(d)?8:-1<k.indexOf(d)?7:6;g(r.join(""));q=999}else r.push(t),u=t,h+=1;break;case 9:/[^\s]/g.test(t)?(g(r.join("")),q=999):(r.push(t),u=t,h+=1);break;case 999:h=b()}if(a!==
h)switch(D[a]){case "\n":z=0;++x;break;default:++z}}n+=h;D=D.slice(h);return y}r.length&&g(r.join(""));q=10;g("(eof)");return y}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/has","../3d/support/buffer/typedArrayUtil"],function(p,f,k,a){return function(){function g(a,e,c,d,m){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=a;this._bufferType=e;this._usage=c;this._id=g._nextId++;this._glName=this._context.gl.createBuffer();d&&this.setData(d,m)}g.createIndex=function(a,e,c,d){return new g(a,34963,e,c,d)};g.createVertex=
function(a,e,c){return new g(a,34962,e,c)};Object.defineProperty(g.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});g.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=
null),this._context=null)};g.prototype.setData=function(b,e){if(b){if("number"===typeof b){if(0>b&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&e)switch(this._indexType=e,this._size=b,e){case 5123:b*=2;break;case 5125:b*=4}}else e=b.byteLength,a.isUint16Array(b)&&(e/=2,this._indexType=5123),a.isUint32Array(b)&&(e/=4,this._indexType=5125),this._size=e;e=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,
b,this._usage);this._context.bindVAO(e)}};g.prototype.setSubData=function(b,e,c,d){void 0===e&&(e=0);void 0===c&&(c=0);if(b){(0>e||e>=this._size)&&console.error("offset is out of range!");var m=e,l=c,h=d,g=b.byteLength;a.isUint16Array(b)&&(g/=2,m*=2,l*=2,h*=2);a.isUint32Array(b)&&(g/=4,m*=4,l*=4,h*=4);void 0===d&&(d=g-1);c>=d&&console.error("end must be bigger than start!");e+c-d>this._size&&console.error("An attempt to write beyond the end of the buffer!");e=this._context.getBoundVAO();this._context.bindVAO(null);
this._context.bindBuffer(this);c=this._context.gl;b=ArrayBuffer.isView(b)?b.buffer:b;c.bufferSubData(this._bufferType,m,b.slice(l,h));this._context.bindVAO(e)}};g._nextId=0;return g}()})},"esri/views/3d/support/buffer/typedArrayUtil":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.forEach=function(k,a){if(k.forEach)k.forEach(a);else for(var g=0;g<k.length;g++)a(k[g],g,k)};f.slice=function(k,a,g){if(k.slice)return k.slice(a,g);void 0===a?a=0:
(0>a&&(a+=k.length),a=Math.min(k.length,Math.max(0,a)));void 0===g?g=k.length:(0>g&&(g+=k.length),g=Math.min(k.length,Math.max(0,g)));g=Math.max(0,g-a);for(var b=new k.constructor(g),e=0;e<g;e++)b[e]=k[a+e];return b};f.isArrayBuffer=function(k){return k instanceof ArrayBuffer||k&&k.constructor&&"ArrayBuffer"===k.constructor.name};f.isInt8Array=function(k){return k instanceof Int8Array||k&&k.constructor&&"Int8Array"===k.constructor.name};f.isUint8Array=function(k){return k instanceof Uint8Array||k&&
k.constructor&&"Uint8Array"===k.constructor.name};f.isInt16Array=function(k){return k instanceof Int16Array||k&&k.constructor&&"Int16Array"===k.constructor.name};f.isUint16Array=function(k){return k instanceof Uint16Array||k&&k.constructor&&"Uint16Array"===k.constructor.name};f.isInt32Array=function(k){return k instanceof Int32Array||k&&k.constructor&&"Int32Array"===k.constructor.name};f.isUint32Array=function(k){return k instanceof Uint32Array||k&&k.constructor&&"Uint32Array"===k.constructor.name};
f.isFloat32Array=function(k){return k instanceof Float32Array||k&&k.constructor&&"Float32Array"===k.constructor.name};f.isFloat64Array=function(k){return k instanceof Float64Array||k&&k.constructor&&"Float64Array"===k.constructor.name};f.toArray=function(k){for(var a=Array(k.length),g=0;g<k.length;g++)a[g]=k[g];return a}})},"esri/views/webgl/Texture":function(){define(["require","exports","../../core/has"],function(p,f,k){return function(){function a(g,b,e){this._glName=this._context=null;this._id=
-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=g;this._desc={pixelFormat:b.pixelFormat,internalFormat:b.internalFormat,dataType:b.dataType,target:b.target?b.target:3553,samplingMode:b.samplingMode?b.samplingMode:9729,wrapMode:b.wrapMode?b.wrapMode:10497,maxAnisotropy:b.maxAnisotropy,flipped:void 0!==b.flipped?b.flipped:!1,hasMipmap:void 0!==b.hasMipmap?b.hasMipmap:!1,unpackAlignment:b.unpackAlignment?b.unpackAlignment:4,width:b.width,height:b.height,
preMultiplyAlpha:void 0!==b.preMultiplyAlpha?b.preMultiplyAlpha:!1};this._id=++a._nextId;this.setData(e)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});a.prototype.dispose=function(){var a=this;if(this._context){if(this._glName){var b=
this._context.gl;this._boundToUnits.forEach(function(b){a._context.bindTexture(null,b)});b.deleteTexture(this._glName);this._glName=null}this._context=null}};a.prototype.resize=function(a,b){var e=this._desc;if(e.width!==a||e.height!==b)e.width=a,e.height=b,this.setData(null)};a.prototype.setData=function(g){var b=this._context.gl;this._glName||(this._glName=b.createTexture());void 0===g&&(g=null);null===g&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var e=this._context.getBoundTexture(0);
this._context.bindTexture(this,0);var c=this._desc;a._validateTexture(c);b.pixelStorei(b.UNPACK_ALIGNMENT,c.unpackAlignment);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,c.flipped?1:0);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c.preMultiplyAlpha?1:0);var d=c.pixelFormat,m=c.internalFormat?c.internalFormat:d;if(g instanceof ImageData||g instanceof HTMLImageElement||g instanceof HTMLCanvasElement||g instanceof HTMLVideoElement)c.width&&c.height&&console.assert(g.width===c.width&&g.height===c.height),b.texImage2D(b.TEXTURE_2D,
0,m,d,c.dataType,g),c.hasMipmap&&this.generateMipmap(),void 0===this._desc.width&&(this._desc.width=g.width),void 0===this._desc.height&&(this._desc.height=g.height);else{null!=c.width&&null!=c.height||console.error("Width and height must be specified!");b.DEPTH24_STENCIL8&&m===b.DEPTH_STENCIL&&(m=b.DEPTH24_STENCIL8);var l=c.width,h=c.height;if(null!=g&&"type"in g&&"compressed"===g.type)for(var n=0;;++n){b.compressedTexImage2D(b.TEXTURE_2D,n,m,l,h,0,g.levels[Math.min(n,g.levels.length-1)]);if(1===
l&&1===h||!c.hasMipmap)break;l=Math.max(1,l>>1);h=Math.max(1,h>>1)}else if(g)b.texImage2D(b.TEXTURE_2D,0,m,l,h,0,d,c.dataType,g),c.hasMipmap&&this.generateMipmap();else for(n=0;;++n){b.texImage2D(b.TEXTURE_2D,n,m,l,h,0,d,c.dataType,null);if(1===l&&1===h||!c.hasMipmap)break;l=Math.max(1,l>>1);h=Math.max(1,h>>1)}}a._applySamplingMode(b,this._desc);a._applyWrapMode(b,this._desc);a._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(e,0)};a.prototype.updateData=function(a,
b,e,c,d,m){m||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var l=this._context.gl,h=this._desc,g=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>b||0>e||c>h.width||d>h.height||b+c>h.width||e+d>h.height)&&console.error("An attempt to update out of bounds of the texture!");m instanceof ImageData||m instanceof HTMLImageElement||m instanceof HTMLCanvasElement||m instanceof HTMLVideoElement?(console.assert(m.width===
c&&m.height===d),l.texSubImage2D(l.TEXTURE_2D,a,b,e,h.pixelFormat,h.dataType,m)):l.texSubImage2D(l.TEXTURE_2D,a,b,e,c,d,h.pixelFormat,h.dataType,m);this._context.bindTexture(g,0)};a.prototype.generateMipmap=function(){var g=this._desc;g.hasMipmap||(g.hasMipmap=!0,a._validateTexture(g));9729===g.samplingMode?(this._samplingModeDirty=!0,g.samplingMode=9985):9728===g.samplingMode&&(this._samplingModeDirty=!0,g.samplingMode=9984);g=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var b=
this._context.gl;b.generateMipmap(b.TEXTURE_2D);this._context.bindTexture(g,0)};a.prototype.setSamplingMode=function(g){g!==this._desc.samplingMode&&(this._desc.samplingMode=g,a._validateTexture(this._desc),this._samplingModeDirty=!0)};a.prototype.setWrapMode=function(g){g!==this._desc.wrapMode&&(this._desc.wrapMode=g,a._validateTexture(this._desc),this._wrapModeDirty=!0)};a.prototype.applyChanges=function(){var g=this._context.gl,b=this._desc;this._samplingModeDirty&&(a._applySamplingMode(g,b),this._samplingModeDirty=
!1);this._wrapModeDirty&&(a._applyWrapMode(g,b),this._wrapModeDirty=!1)};a.prototype.setBoundToUnit=function(a,b){b?this._boundToUnits.add(a):this._boundToUnits.delete(a)};a._isPowerOfTwo=function(a){return 0===(a&a-1)};a._validateTexture=function(g){(0>g.width||0>g.height)&&console.error("Negative dimension parameters are not allowed!");a._isPowerOfTwo(g.width)&&a._isPowerOfTwo(g.height)||("number"===typeof g.wrapMode?33071!==g.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):
33071===g.wrapMode.s&&33071===g.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),g.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};a._applySamplingMode=function(a,b){var e=b.samplingMode;if(9985===e||9987===e)e=9729;else if(9984===e||9986===e)e=9728;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b.samplingMode)};a._applyWrapMode=function(a,b){"number"===typeof b.wrapMode?
(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b.wrapMode),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b.wrapMode)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b.wrapMode.s),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b.wrapMode.t))};a._applyAnisotropicFilteringParameters=function(a,b){if(null!=b.maxAnisotropy){var e=a.capabilities.textureFilterAnisotropic;e&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY,b.maxAnisotropy))}};a._nextId=0;return a}()})},"esri/views/webgl/Util":function(){define(["require",
"exports","../../core/tsSupport/assignHelper","../../core/Error"],function(p,f,k,a){function g(a){return a[0].stride}function b(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}Object.defineProperty(f,"__esModule",{value:!0});f.vertexCount=function(a,b){return a.vertexBuffers[b].size/g(a.layout[b])};f.getStride=g;f.getBytesPerElement=b;f.addDescriptor=function(a,
c,d,m,l,h){var e=b(m);if(0<a.length){var g=a[0].stride,t=g+e*d;a.forEach(function(a){return a.stride=t});a.push({name:c,count:d,type:m,offset:g,stride:t,normalized:l,divisor:h})}else a.push({name:c,count:d,type:m,offset:0,stride:e*d,normalized:l,divisor:h})};f.assertCompatibleVertexAttributeLocations=function(a,b){(a=a.locations===b.locations)||console.error("VertexAttributeLocations are incompatible");return a};f.hasAttribute=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return!0;return!1};
f.findAttribute=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return a[c];return null};f.copyFramebufferToTexture=function(a,b,d,m,l){void 0===l&&(l=0);var c=a.getBoundFramebufferObject(),e=a.getBoundTexture(0);a.bindFramebuffer(b);a.bindTexture(d,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,l,d.descriptor.pixelFormat,m[0],m[1],m[2],m[3],0);a.gl.flush();a.bindFramebuffer(c);a.bindTexture(e,0)};f.assert=function(b,c){if(!b)throw new a(c);};f.setBaseInstanceOffset=function(a,b){var c={},e;for(e in a)c[e]=
a[e].map(function(a){return a.divisor?k({},a,{baseInstance:b}):a});return c};f.bindVertexBufferLayout=function(a,b,d,m,l){var c=a.gl,e=a.capabilities.instancing;a.bindBuffer(d);m.forEach(function(a){var d=b[a.name],h=(l?l:0+a.baseInstance?a.baseInstance:0)*a.stride;void 0===d&&console.error("There is no location for vertex attribute '"+a.name+"' defined.");a.baseInstance&&!a.divisor&&console.error("Vertex attribute '"+a.name+"' uses baseInstanceOffset without divisor.");if(4>=a.count)c.vertexAttribPointer(d,
a.count,a.type,a.normalized,a.stride,a.offset+h),c.enableVertexAttribArray(d),a.divisor&&0<a.divisor&&e&&e.vertexAttribDivisor(d,a.divisor);else if(9===a.count)for(var m=0;3>m;m++)c.vertexAttribPointer(d+m,3,a.type,a.normalized,a.stride,a.offset+12*m+h),c.enableVertexAttribArray(d+m),a.divisor&&0<a.divisor&&e&&e.vertexAttribDivisor(d+m,a.divisor);else if(16===a.count)for(m=0;4>m;m++)c.vertexAttribPointer(d+m,4,a.type,a.normalized,a.stride,a.offset+16*m+h),c.enableVertexAttribArray(d+m),a.divisor&&
0<a.divisor&&e&&e.vertexAttribDivisor(d+m,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)})};f.unbindVertexBufferLayout=function(a,b,d,m){var c=a.gl,e=a.capabilities.instancing;a.bindBuffer(d);m.forEach(function(a){var d=b[a.name];if(4>=a.count)c.disableVertexAttribArray(d),a.divisor&&0<a.divisor&&e&&e.vertexAttribDivisor(d,0);else if(9===a.count)for(var h=0;3>h;h++)c.disableVertexAttribArray(d+h),a.divisor&&0<a.divisor&&e&&e.vertexAttribDivisor(d+h,0);else if(16===
a.count)for(h=0;4>h;h++)c.disableVertexAttribArray(d+h),a.divisor&&0<a.divisor&&e&&e.vertexAttribDivisor(d+h,0);else console.error("Unsupported vertex attribute element count: "+a.count)});a.unbindBuffer(34962)}})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","../../core/has","./Util"],function(p,f,k,a){return function(){function g(a,e,c,d,m){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=
a;this._layout=c;this._buffers=d;this._locations=e;m&&(this._indexBuffer=m);this._id=g._nextId++}Object.defineProperty(g.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"indexBuffer",{get:function(){return this._indexBuffer},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(b,c){return b+a._buffers[c].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});g.prototype.dispose=
function(a){void 0===a&&(a=!0);if(this._context){var b=this._context.capabilities.vao;b&&this._glName&&(b.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(a){for(var c in this._buffers)this._buffers[c].dispose(),delete this._buffers[c];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};g.prototype.initialize=function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var e=
a.createVertexArray();a.bindVertexArray(e);this._bindLayout();a.bindVertexArray(null);this._glName=e}this._initialized=!0}};g.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};g.prototype._bindLayout=function(){var b=this._buffers,e=!!this._context.capabilities.vao,c=this._layout,d=this._indexBuffer;b||console.error("Vertex buffer dictionary is empty!");var m=this._context.gl,l;for(l in b){var h=
b[l];h||console.error("Vertex buffer is uninitialized!");var g=c[l];g||console.error("Vertex element descriptor is empty!");a.bindVertexBufferLayout(this._context,this._locations,h,g)}d&&(e?m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,d.glName):this._context.bindBuffer(d))};g.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};g.prototype._unbindLayout=function(){var b=this._buffers,e=this._layout;b||console.error("Vertex buffer dictionary is empty!");
for(var c in b){var d=b[c];d||console.error("Vertex buffer is uninitialized!");a.unbindVertexBufferLayout(this._context,this._locations,d,e[c])}(b=this._indexBuffer)&&this._context.unbindBuffer(b.bufferType)};g._nextId=0;return g}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("require exports ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/gl-matrix ./atmosphereUtils ../support/earthUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/shaders/RealisticAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t){p=function(){function m(a){this.needsRender=!1;this.didRender=!0;this.slot=16;this._hazeSlot=17;this._renderData={texDepth:b.vec2f64.create(),v3CameraPos:b.vec3f64.create(),v3CameraUp:b.vec3f64.create(),v3CameraRight:b.vec3f64.create(),v3CameraDir:b.vec3f64.create(),halfSizeNearPlane:b.vec2f64.create(),v2CameraCenterOffset:b.vec2f64.create(),v4SphereComp:b.vec4f64.create(),v4AtmosParams1:b.vec4f64.create(),v4AtmosParams2:b.vec4f64.create(),v4AtmosParams3:b.vec4f64.create(),
v3InvWavelength:r,v3InvWavelengthScaled:y,v4Radii:b.vec4f64.create(),fScale:0,fScaleDepth:x,fLowerAlphaBlendBound:0,fScaleOverScaleDepth:0,fOneOverScaleDepth:0,fScaleDepthBlue:z,fOneOverScaleDepthBlue:B,fScaleOverScaleDepthBlue:0,g:C,g2:C*C,fMiePhaseCoefficients:D,showTest:0,nearFar:b.vec2f64.create(),fCameraHeight:0,fCameraHeight2:0,fC:0,fCSur:0,fInnerFadeDistance:0,fAltitudeFade:0};this._lowerElevationBoundRadius=0;this._earthRadius=c.earthRadius;this.view=a;this._updateRadius(c.earthRadius)}m.prototype.destroy=
function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&(this._hazeProgram.dispose(),this._hazeProgram=null);this._skyProgram&&(this._skyProgram.dispose(),this._skyProgram=null);this._vao&&(this._vao.dispose(),this._vao=null)};m.prototype.when=function(b){return a.resolve().then(b)};m.prototype.initializeRenderContext=function(a){var b=this;a=a.rctx;this._handles=new k;this._updateElevation({spatialReference:this.view.basemapTerrain.spatialReference,tile:this.view.basemapTerrain.rootTiles[0],
extent:this.view.basemapTerrain.rootTiles[0].extent});this._handles.add(g.on(this.view,"basemapTerrain","elevation-change",function(a){return b._updateElevation(a)},function(){return b._updateElevation()}));this._handles.add(g.on(this.view,"basemapTerrain","elevation-bounds-change",function(){return b._updateVisibleElevationBounds()},function(){return b._updateVisibleElevationBounds()}));this._hazeProgram=n.createProgram(a,l.program,{haze:!0});this._skyProgram=n.createProgram(a,l.program);this._vao=
this._createVertexArrayObject(a)};m.prototype.uninitializeRenderContext=function(a){this.destroy()};m.prototype.render=function(a){if(a.slot!==this._hazeSlot&&a.slot!==this.slot||0!==a.pass)return!1;this._update(a.camera);a.slot===this.slot&&this._renderSky(a);a.slot===this._hazeSlot&&this._renderHaze(a);this.needsRender=!1;return!0};m.prototype._renderSky=function(a){var b=a.rctx,c=this._skyProgram;b.bindProgram(c);b.setBlendFunctionSeparate(770,771,1,771);b.setDepthFunction(515);b.setDepthTestEnabled(!0);
c.setUniform4fv("v4AtmosParams3",this._renderData.v4AtmosParams3);this._renderCommon(c,a)};m.prototype._renderHaze=function(a){var b=this,c=a.rctx,d=a.offscreenRenderingHelper,e=this._hazeProgram;c.bindProgram(e);c.setBlendFunctionSeparate(1,769,0,1);d.renderDepthDetached(function(){c.setDepthTestEnabled(!1);c.bindTexture(d.depthTexture,0);e.setUniform1i("tDepth",0);b._renderCommon(e,a)})};m.prototype._renderCommon=function(a,b){var c=b.rctx;a.setUniform3fv("v3InvWavelength",this._renderData.v3InvWavelength);
a.setUniform3fv("v3InvWavelengthScaled",this._renderData.v3InvWavelengthScaled);a.setUniform3fv("v3LightDir",b.lightingData.direction);a.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp);a.setUniform3fv("v3CameraPos",this._renderData.v3CameraPos);a.setUniform3fv("v3CameraUp",this._renderData.v3CameraUp);a.setUniform3fv("v3CameraRight",this._renderData.v3CameraRight);a.setUniform3fv("v3CameraDir",this._renderData.v3CameraDir);a.setUniform2fv("nearFar",this._renderData.nearFar);a.setUniform2fv("halfSizeNearPlane",
this._renderData.halfSizeNearPlane);a.setUniform2fv("v2CameraCenterOffset",this._renderData.v2CameraCenterOffset);a.setUniform4fv("v4Radii",this._renderData.v4Radii);a.setUniform4fv("v4AtmosParams1",this._renderData.v4AtmosParams1);a.setUniform4fv("v4AtmosParams2",this._renderData.v4AtmosParams2);a.setUniform1f("showTest",this._renderData.showTest);a.setUniform1f("fInnerFadeDistance",this._renderData.fInnerFadeDistance);a.setUniform1f("fAltitudeFade",this._renderData.fAltitudeFade);c.setBlendingEnabled(!0);
c.setDepthWriteEnabled(!1);c.bindVAO(this._vao);q.assertCompatibleVertexAttributeLocations(this._vao,a);c.drawArrays(5,0,4);c.setDepthFunction(513);c.setDepthTestEnabled(!1);c.setDepthWriteEnabled(!0);c.setBlendingEnabled(!1);c.setBlendFunctionSeparate(770,771,1,771)};m.prototype._createVertexArrayObject=function(a){var b=E.createBuffer(4);b.position.setVec(0,[-1,-1,1]);b.position.setVec(1,[1,-1,1]);b.position.setVec(2,[-1,1,1]);b.position.setVec(3,[1,1,1]);b.uv0.setVec(0,[0,0]);b.uv0.setVec(1,[1,
0]);b.uv0.setVec(2,[0,1]);b.uv0.setVec(3,[1,1]);return new t(a,l.program.attributes,{geometry:d.glLayout(E)},{geometry:h.createVertex(a,35044,b.buffer)})};m.prototype._adjustRadiusForTesselation=function(a){return a*Math.cos(Math.PI/Math.pow(2,4)/16)};m.prototype._updateElevation=function(a){a=a?a.tile:this.view.basemapTerrain.rootTiles[0];0===a.lij[0]&&(a=this._adjustRadiusForTesselation(c.earthRadius+a.elevationBounds[0]),a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=
-1,this._updateVisibleElevationBounds()))};m.prototype._updateVisibleElevationBounds=function(){var a=this._adjustRadiusForTesselation(c.earthRadius+this.view.basemapTerrain.getElevationBounds()[0]);(0>this._earthRadius||a<this._earthRadius)&&this._updateRadius(a)};m.prototype._updateRadius=function(a){this._earthRadius=a;var c=a*a,d=a/10*10.25,h=d*d,l=1/(d-a),m=l/x,g=l/z,n=.3*(d-a)+a,q=1/(d-n),r=this._renderData;b.vec4.set(r.v4AtmosParams1,l,x,m,w);b.vec4.set(r.v4AtmosParams2,C,z,g,B);b.vec4.set(r.v4AtmosParams3,
C*C,D,n,q);b.vec4.set(r.v4Radii,a,c,d,h);r.fScale=l;r.fLowerAlphaBlendBound=n;r.fScaleOverScaleDepth=m;r.fScaleOverScaleDepthBlue=g;c=e.INNER_ATMOSPHERE_DEPTH;r.fInnerFadeDistance=2*Math.sqrt((2*a-c)*c)};m.prototype._update=function(a){a&&(b.vec3.negate(this._renderData.v3CameraDir,a.viewForward),b.vec3.copy(this._renderData.v3CameraUp,a.viewUp),b.vec3.copy(this._renderData.v3CameraRight,a.viewRight),this._renderData.fCameraHeight=b.vec3.length(a.eye),this._renderData.fCameraHeight2=this._renderData.fCameraHeight*
this._renderData.fCameraHeight,this._renderData.fC=this._renderData.fCameraHeight2-this._renderData.v4Radii[3],this._renderData.fCSur=this._renderData.fCameraHeight2-this._renderData.v4Radii[1],this._renderData.v4SphereComp=b.vec4f64.fromValues(this._renderData.fCameraHeight,this._renderData.fCameraHeight2,this._renderData.fC,this._renderData.fCSur),b.vec3.copy(this._renderData.v3CameraPos,a.eye),b.vec2.set(this._renderData.halfSizeNearPlane,Math.tan(a.fovX/2)/(a.width/a.fullWidth),Math.tan(a.fovY/
2)/(a.height/a.fullHeight)),b.vec2.set(this._renderData.v2CameraCenterOffset,(a.padding[3]+a.width/2)/a.fullWidth-.5,(a.padding[2]+a.height/2)/a.fullHeight-.5),b.vec2.set(this._renderData.nearFar,a.near,a.far),this._renderData.fAltitudeFade=e.computeInnerAltitudeFade(this._renderData.fCameraHeight-this._earthRadius))};m.isSupported=function(a){return a.rctx.capabilities.depthTexture};return m}();f=.02*Math.PI;var u=.004*Math.PI,r=b.vec3f64.fromValues(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,
4)),y=b.vec3f64.clone(r);b.vec3.scale(y,y,f);b.vec3.add(y,y,b.vec3f64.fromValues(u,u,u));var x=.25,z=.05,w=1/x,B=1/z,C=-.99999,D=(1-C*C)/(2+C*C)*1.5,E=m.newLayout().vec3f("position").vec2f("uv0");return p})},"esri/views/3d/environment/atmosphereUtils":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.computeInnerAltitudeFade=function(k){return Math.min(1,Math.max(0,(k-1E5)/9E5))};f.INNER_ATMOSPHERE_DEPTH=1E4})},"esri/views/3d/webgl-engine/shaders/RealisticAtmospherePrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});f.program={name:"realistic-atmosphere-color",shaders:function(b){return{vertexShader:g.glslifyDefineMap({HAZE:b.haze})+a.resolveIncludes("environment/realisticAtmosphere.vert"),fragmentShader:g.glslifyDefineMap({HAZE:b.haze})+a.resolveIncludes("environment/realisticAtmosphere.frag")}},attributes:k.Default3D}})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("require exports ../../../core/watchUtils ../../../core/libs/gl-matrix-2/gl-matrix ./atmosphereUtils ./resources/SimpleAtmosphereTexture ../support/earthUtils ../support/imageUtils ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x){function z(b,c,d,e,h){var l=a.vec3.length(b),m=e*Math.sqrt(l*l-e*e)/l,g=h.silCircleV1,n=h.silCircleV2;a.vec3.scale(h.silCircleCenter,b,Math.sqrt(e*e-m*m)/l);a.vec3.cross(g,b,c);1>a.vec3.squaredLength(g)&&a.vec3.cross(g,b,d);a.vec3.scale(g,g,m/a.vec3.length(g));a.vec3.cross(n,g,b);a.vec3.scale(n,n,m/a.vec3.length(n));return m}function w(b,c,d,e){a.vec3.add(I,e.silCircleCenter,e.silCircleV2);a.vec3.scale(N,I,E);a.mat4.lookAt(H,c,I,d);n.project(I,H,b.projectionMatrix,
b.viewport);n.project(N,H,b.projectionMatrix,b.viewport);return a.vec3.distance(I,N)/b.height}var B=-g.INNER_ATMOSPHERE_DEPTH,C=(e.earthRadius+B)/e.earthRadius,D=(e.earthRadius+0)/e.earthRadius,E=(e.earthRadius+3E5)/e.earthRadius,G=d.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);p=function(){function l(b){this.needsRender=!1;this.didRender=!0;this.slot=16;this._renderData={texV:a.vec2f64.create(),silCircleCenter:a.vec3f64.create(),silCircleV1:a.vec3f64.create(),
silCircleV2:a.vec3f64.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this.view=b}l.prototype.when=function(a){return this._readyPromise.then(a)};l.prototype.initializeRenderContext=function(a){var d=this,e=a.rctx;this._cameraChangeHandle=k.init(this.view,"state.camera",function(){return d.needsRender=!0},!0);this._program=u.createProgram(e,q.colorPass);this._fadeProgram=u.createProgram(e,q.fadePass);this._vao=this._createRibbon(e);this._vaoCount=y.vertexCount(this._vao,
"geometry");this._fadeVao=h.createQuadVAO(e);this._fadeVaoCount=y.vertexCount(this._fadeVao,"geometry");this._readyPromise=c.requestImage(b).then(function(a){d._texture=new r(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);d.needsRender=!0})};l.prototype.uninitializeRenderContext=function(a){this.destroy()};l.prototype.destroy=function(){this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null);this._texture&&(this._texture.dispose(),
this._texture=null);this._program&&(this._program.dispose(),this._program=null);this._fadeProgram&&(this._fadeProgram.dispose(),this._fadeProgram=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null);this._readyPromise&&(this._readyPromise.cancel(),this._readyPromise=null)};l.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass||null==this._texture)return!1;this._update(a.camera);var b=a.rctx,c=this._program;b.setDepthTestEnabled(!0);b.setDepthFunction(515);b.setBlendingEnabled(!0);
b.setDepthWriteEnabled(!1);b.setBlendFunctionSeparate(770,771,1,771);1>this._renderData.undergroundFadeAlpha&&(b.bindProgram(c),c.setUniformMatrix4fv("proj",a.camera.projectionMatrix),c.setUniformMatrix4fv("view",a.camera.viewMatrix),c.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),c.setUniform3fv("silCircleV1",this._renderData.silCircleV1),c.setUniform3fv("silCircleV2",this._renderData.silCircleV2),c.setUniform2fv("texV",this._renderData.texV),b.bindTexture(this._texture,0),c.setUniform1i("tex",
0),c.setUniform3fv("lightDirection",a.lightingData.direction),c.setUniform1f("altitudeFade",this._renderData.altitudeFade),c.setUniform1f("innerScale",this._renderData.innerScale),b.bindVAO(this._vao),b.drawArrays(4,0,this._vaoCount));0<this._renderData.undergroundFadeAlpha&&(b.bindProgram(this._fadeProgram),this._fadeProgram.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),this._fadeProgram.setUniform3fv("lightDirection",a.lightingData.direction),this._fadeProgram.setUniform3fv("cameraPosition",
a.camera.eye),b.bindVAO(this._fadeVao),b.drawArrays(5,0,this._fadeVaoCount));b.setBlendingEnabled(!1);b.setDepthWriteEnabled(!0);b.setDepthFunction(513);this.needsRender=!1;return!0};l.prototype._update=function(b){var c=a.vec3f64.create(),h=e.earthRadius,l=a.vec3.length(b.eye),m=l-h;this._renderData.undergroundFadeAlpha=0>m?Math.min(-m/5E3,1):0;var n=h+B,q=h+Math.max(50,m);this._renderData.innerScale=q*q/(Math.sqrt(q*q-h*h)*Math.sqrt(q*q-n*n)+h*n)-1;this._renderData.altitudeFade=g.computeInnerAltitudeFade(m);
a.vec3.scale(c,b.eye,(h+50)/l);z(c,b.center,b.up,h,this._renderData);c=w(b,c,b.up,this._renderData);l=G(m);n=.001953125;q=0+c*l*1;50<m&&(z(b.eye,b.center,b.up,h,this._renderData),b=w(b,b.eye,b.up,this._renderData),b=d.clamp((b-1.5)/(c-1.5),0,1),n=0+.001953125*b,q=0+1*d.lerp(1,c*l,b));a.vec2.set(this._renderData.texV,n,q)};l.prototype._createRibbon=function(a){var b=new Float32Array(1155),c=new Uint32Array(1920);b[0]=0;b[1]=0;b[2]=-1;for(var d=0;128>d;d++){var e=9*d+3;b[e+0]=d;b[e+1]=C;b[e+2]=-1;b[e+
3]=d;b[e+4]=D;b[e+5]=0;b[e+6]=d;b[e+7]=E;b[e+8]=1;var e=3*d+1,h=127===d?1:e+3,l=15*d;c[l+0]=e;c[l+1]=e+1;c[l+2]=h+1;c[l+3]=h+1;c[l+4]=h;c[l+5]=e;c[l+6]=e+1;c[l+7]=e+2;c[l+8]=h+2;c[l+9]=h+2;c[l+10]=h+1;c[l+11]=e+1;c[l+12]=e;c[l+13]=h;c[l+14]=0}e=S.createBuffer(c.length);h=e.position;for(d=0;d<c.length;++d)l=3*c[d],h.set(d,0,b[l]),h.set(d,1,b[l+1]),h.set(d,2,b[l+2]);return new x(a,q.colorPass.attributes,{geometry:m.glLayout(S)},{geometry:t.createVertex(a,35044,e.buffer)})};return l}();var H=a.mat4f64.create(),
I=a.vec3f64.create(),N=a.vec3f64.create(),S=l.newLayout().vec3f("position");return p})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});f.createQuadVAO=function(b,d){void 0===d&&(d=a.Pos2);var c=null;switch(d){case a.Pos3Tex:c=new Float32Array([-1,
-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case a.Pos3:c=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case a.Pos2Tex:c=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;default:c=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new e(b,k.Default3D,{geometry:d},{geometry:g.createVertex(b,35044,c)})};f.createEmptyTexture=function(a,d){void 0===d&&(d=4);return new b(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:d,height:d})};f.createColorTexture=function(a,
d,e){void 0===e&&(e=4);for(var c=new Uint8Array(e*e*4),h=0;h<c.length;h+=4)c[h+0]=255*d[0],c[h+1]=255*d[1],c[h+2]=255*d[2],c[h+3]=255*d[3];return new b(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:e},c)}})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];f.Pos3Tex=[{name:"position",
count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];f.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];f.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];f.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/environment/Stars":function(){define("require exports ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/gl-matrix ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/shaders/StarsPrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t){var u=g.getLogger("esri.views.3d.environment.Stars");f=function(){function m(a){this.slot=16;this.numBinaryFloats=2;this.numBinaryUInt8=1;this.bytesPerStar=9;this.needsRender=!1;this.didRender=!0;this._numStars=0;this._modelMatrix=c.mat4f64.create();this.view=a;this._loadDataPromise=this._loadBrightStarCatalogue()}m.prototype.destroy=function(){this._loadDataPromise.isFulfilled()||this._loadDataPromise.cancel();this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=
null);this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};m.prototype.initializeRenderContext=function(a){var b=this,c=a.rctx;this._program=n.createProgram(c,l.program);this._dateHandle=e.init(this.view,"environment.lighting.date",function(a){return b._update(a)});this._loadDataPromise.then(function(){b._numStars=b._starData.byteLength/b.bytesPerStar;var a=new Float32Array(b._starData,0,b._numStars*b.numBinaryFloats),d=new Uint8Array(b._starData,
b._numStars*b.numBinaryFloats*4,b._numStars*b.numBinaryUInt8);b._vao=b._createVertexArrayObject(c,a,d);b.needsRender=!0})};m.prototype.uninitializeRenderContext=function(a){this.destroy()};m.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass||null==this._starData)return!1;var b=a.rctx,c=this._program;b.bindProgram(c);c.setUniformMatrix4fv("view",a.camera.viewMatrix);c.setUniformMatrix4fv("proj",a.camera.projectionMatrix);c.setUniform4fv("viewport",a.camera.fullViewport);c.setUniformMatrix4fv("model",
this._modelMatrix);c.setUniform1f("pixelRatio",a.pixelRatio);b.setDepthTestEnabled(!0);b.setDepthFunction(515);b.setBlendingEnabled(!0);b.setBlendFunctionSeparate(770,771,1,771);b.setDepthWriteEnabled(!1);b.bindVAO(this._vao);q.assertCompatibleVertexAttributeLocations(this._vao,c);b.drawArrays(0,0,this._numStars);b.setBlendingEnabled(!1);b.setDepthWriteEnabled(!0);b.setDepthFunction(513);this.needsRender=!1;return!0};m.prototype._computeDayDuration=function(a){var b=new Date(a.getFullYear(),0,1,11,
58,56),c=new Date(a.getFullYear()+1,0,1,11,58,55);return(+a-+b)/(+c-+b)};m.prototype._update=function(a){if(a){var b=a.getHours()/12,d=a.getMinutes()/60*(2/24),e=a.getSeconds()/60*(2/1440),b=(b+d+e-.9972222)%2;a=2*this._computeDayDuration(a);d=this._modelMatrix;c.mat4.copy(d,x);c.mat4.rotateZ(d,d,-a*Math.PI);c.mat4.multiply(d,y,d);c.mat4.rotateZ(d,d,-b*Math.PI);this.needsRender=!0}};m.prototype._hexToRGB=function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,
6),16)]};m.prototype._unpackUint8Attributes=function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]};m.prototype._createVertexArrayObject=function(a,b,c){for(var e=z.createBuffer(this._numStars),m=e.position,g=e.color,n=e.size,q=0;q<this._numStars;q++){var k=b[2*q+0],u=b[2*q+1];m.set(q,0,-Math.cos(k)*Math.sin(u));m.set(q,1,-Math.sin(k)*Math.sin(u));m.set(q,2,-Math.cos(u));k=this._unpackUint8Attributes(c[q]);u=this._hexToRGB(r[k[1]]);
g.set(q,0,255*u[0]);g.set(q,1,255*u[1]);g.set(q,2,255*u[2]);g.set(q,3,255);n.set(q,k[0])}return new t(a,l.program.attributes,{geometry:d.glLayout(z)},{geometry:h.createVertex(a,35044,e.buffer)})};m.prototype._verifyStartData=function(b){if(!b)throw new a("stars:no-data-received","Failed to create stars because star catalogue is missing");b=b.byteLength/this.bytesPerStar;if(0!==b%1||5E4<b||5E3>b)throw new a("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};m.prototype._loadBrightStarCatalogue=
function(){var a=this;return w?(this._starData=w,b.resolve()):k(p.toUrl("./resources/stars.wsv"),{responseType:"array-buffer"}).then(function(b){b=b.data;a._verifyStartData(b);w=b;a._starData=b}).catch(function(a){a&&"cancel"!==a.dojoType&&u.error("loadBrightStarCatalogue",a.message);throw a;})};return m}();var r="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),
y=c.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),x=c.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),z=m.newLayout().vec3f("position").vec4u8("color").f32("size"),w=null;return f})},"esri/views/3d/webgl-engine/shaders/StarsPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(p,f,k,a){Object.defineProperty(f,
"__esModule",{value:!0});f.program={name:"stars",shaders:{vertexShader:a.resolveIncludes("environment/stars.vert"),fragmentShader:a.resolveIncludes("environment/stars.frag")},attributes:k.Default3D}})},"esri/views/3d/support/sunUtils":function(){define(["require","exports","../../../core/libs/gl-matrix-2/gl-matrix","../lib/SunCalc","./mathUtils"],function(p,f,k,a,g){function b(a,b,c,d){for(var e=[],h=0;h<c.length;h++)e[h]=(d[h]-c[h])*a/b+c[h];return e}Object.defineProperty(f,"__esModule",{value:!0});
f.settings={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};f.computeColorAndIntensity=function(c,e){var h,l,m,t,u=e.z,r=d;k.vec3.set(r.ambient.color,1,1,1);r.ambient.intensity=f.settings.global.ambient;k.vec3.set(r.diffuse.color,1,1,1);r.diffuse.intensity=f.settings.global.diffuse;
u=(Math.abs(u)-f.settings.local.altitude)/(f.settings.global.altitude-f.settings.local.altitude);u=g.clamp(u,0,1);r.globalFactor=u;e=a.getTimes(c,e.y,e.x);if(1>u){m=c.valueOf();var y,x;e.polarException===a.POLAR_EXCEPTION.MIDNIGHT_SUN?(y=m-36E5*(c.getHours()+48)-6E4*c.getMinutes(),x=y+432E6):e.polarException===a.POLAR_EXCEPTION.POLAR_NIGHT?(y=m-2,x=m-1):(y=e.sunrise.valueOf(),x=e.sunset.valueOf());var z=x-y;t=y+z/2;l=z/4;h=t-l;l=t+l;var w=.06*z,z=y-w/2;y+=w/2;var B=x-w/2,C=x+w/2;x=f.settings.local;
var D=[.01,x.ambientAtNight],E=[.8,.8,1],G=[.01,.01,.01],H=[x.diffuseAtTwilight,x.ambientAtTwilight],I=[1,.75,.75],N=[.8,.8,1],p=[.9*x.diffuseAtNoon,x.ambientAtNoon],M=[1,.98,.98],P=[.98,.98,1],O=[x.diffuseAtNoon,x.ambientAtNoon],W=[1,1,1],Q=[1,1,1];x=[0,0];var J=[0,0,0],w=[0,0,0];m<z||m>C?(x=D,J=G,w=E):m<y?(w=y-z,x=b(m-z,w,D,H),J=b(m-z,w,G,I),w=b(m-z,w,E,N)):m<h?(w=h-y,x=b(m-y,w,H,p),J=b(m-y,w,I,M),w=b(m-y,w,N,P)):m<t?(w=t-h,x=b(m-h,w,p,O),J=b(m-h,w,M,W),w=b(m-h,w,P,Q)):m<l?(w=l-t,x=b(m-t,w,O,p),
J=b(m-t,w,W,M),w=b(m-t,w,Q,P)):m<B?(w=B-l,x=b(m-l,w,p,H),J=b(m-l,w,M,I),w=b(m-l,w,P,N)):m<C&&(w=C-B,x=b(m-B,w,H,D),J=b(m-B,w,I,G),w=b(m-B,w,N,E));m=x[0];t=k.vec3f64.fromValues(J[0],J[1],J[2]);h=x[1];l=k.vec3f64.fromValues(w[0],w[1],w[2]);k.vec3.lerp(r.ambient.color,l,r.ambient.color,u);r.ambient.intensity=g.lerp(h,r.ambient.intensity,u);k.vec3.lerp(r.diffuse.color,t,r.diffuse.color,u);r.diffuse.intensity=g.lerp(m,r.diffuse.intensity,u)}u=c.valueOf();e.polarException===a.POLAR_EXCEPTION.MIDNIGHT_SUN?
(c=u-36E5*(c.getHours()+48)-6E4*c.getMinutes(),e=c+432E6):e.polarException===a.POLAR_EXCEPTION.POLAR_NIGHT?(c=u-2,e=u-1):(c=e.sunrise.valueOf(),e=e.sunset.valueOf());c=1-g.clamp(Math.abs(u-(c+(e-c)/2))/432E5,0,1);r.noonFactor=c;return r};f.computeDirection=function(b,d,h,n){n||(n=k.vec3f64.create());var l=c,m=k.mat4.identity(e);if("global"===h)a.getPosition(b,0,0,l),k.vec3.set(n,0,0,-1),k.mat4.rotateX(m,m,-l.azimuth),k.mat4.rotateY(m,m,-l.altitude);else{var u=f.settings.planarDirection;h=u.globalAngles;
u=(Math.abs(d.z)-u.localAltitude)/(u.globalAltitude-u.localAltitude);u=g.clamp(u,0,1);1>u?(a.getPosition(b,d.y,d.x,l),l.azimuth=(1-u)*l.azimuth+u*h.azimuth,l.altitude=(1-u)*l.altitude+u*h.altitude):(l.azimuth=h.azimuth,l.altitude=h.altitude);k.vec3.set(n,0,-1,0);k.mat4.rotateZ(m,m,-l.azimuth);k.mat4.rotateX(m,m,-l.altitude)}k.vec3.transformMat4(n,n,m);return n};f.computeShadowsEnabled=function(a,b){return"global"===b?!0:Math.abs(a.z)<f.settings.planarDirection.localAltitude};var e=k.mat4f64.create(),
c={azimuth:0,altitude:0},d={ambient:{color:k.vec3f64.create(),intensity:0},diffuse:{color:k.vec3f64.create(),intensity:0,direction:k.vec3f64.create()},globalFactor:0,noonFactor:0}})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function p(a){return new Date(864E5*(a+.5-2440588))}function f(a,b){return t(l(a)*h(x)-n(b)*l(x),h(a))}function k(a,b){return q(l(b)*h(x)+h(b)*l(x)*l(a))}function a(a,b,c){return t(l(a),h(a)*l(b)-n(c)*h(b))}function g(a,b,c){return q(l(b)*l(c)+h(b)*h(c)*h(a))}
function b(a){return r*(1.9148*l(a)+.02*l(2*a)+3E-4*l(3*a))}function e(a,c){a=r*(357.5291+.98560028*a);var d=b(a);a=a+d+102.9372*r+m;c||(c={dec:0,ra:0});c.dec=k(a,0);c.ra=f(a,0);return c}function c(a,b,c){return 2451545+a+.0053*l(b)-.0069*l(2*c)}function d(a){var b=r*(134.963+13.064993*a),c=r*(93.272+13.22935*a);a=r*(218.316+13.176396*a)+6.289*r*l(b);c=5.128*r*l(c);b=385001-20905*h(b);return{ra:f(a,c),dec:k(a,c),dist:b}}var m=Math.PI,l=Math.sin,h=Math.cos,n=Math.tan,q=Math.asin,t=Math.atan2,u=Math.acos,
r=m/180,y={dec:0,ra:0},x=23.4397*r,z={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(b,c,d,h){d=r*-d;c*=r;var l=b.valueOf()/864E5-.5+2440588-2451545;b=e(l,y);d=r*(280.16+360.9856235*l)-d-b.ra;h||(h={azimuth:0,altitude:0});h.azimuth=a(d,c,b.dec);h.altitude=g(d,c,b.dec);return h}},w=[[-.83,"sunrise","sunset"]];z.addTime=function(a,b,c){w.push([a,b,c])};z.getTimes=function(a,d,e){function g(a){var b=q,d=y;a=u((l(a)-l(b)*l(d))/(h(b)*h(d)));return c(9E-4+(a+n)/(2*m)+t,f,x)}
var n=r*-e,q=r*d,t=Math.round(a.valueOf()/864E5-.5+2440588-2451545-9E-4-n/(2*m));a=9E-4+(0+n)/(2*m)+t;var f=r*(357.5291+.98560028*a);d=b(f);var x=f+d+102.9372*r+m,y=k(x,0);a=c(a,f,x);d={solarNoon:p(a),nadir:p(a-.5),polarException:z.POLAR_EXCEPTION.NORMAL};var B,C,D,Q;e=0;for(B=w.length;e<B;e+=1)C=w[e],D=g(C[0]*r),Q=a-(D-a),d[C[1]]=p(Q),d[C[2]]=p(D);d.polarException=function(a){a=(l(a)-l(q)*l(y))/(h(q)*h(y));return-1>a?z.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?z.POLAR_EXCEPTION.POLAR_NIGHT:z.POLAR_EXCEPTION.NORMAL}(w[0][0]*
r);return d};z.getMoonPosition=function(b,c,e){e=r*-e;c*=r;var h=b.valueOf()/864E5-.5+2440588-2451545;b=d(h);e=r*(280.16+360.9856235*h)-e-b.ra;h=g(e,c,b.dec);h+=.017*r/n(h+10.26*r/(h+5.1*r));return{azimuth:a(e,c,b.dec),altitude:h,distance:b.dist}};z.getMoonFraction=function(a){var b=a.valueOf()/864E5-.5+2440588-2451545;a=e(b);b=d(b);a=u(l(a.dec)*l(b.dec)+h(a.dec)*h(b.dec)*h(a.ra-b.ra));a=t(149598E3*l(a),b.dist-149598E3*h(a));return(1+h(a))/2};return z})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/gl-matrix"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){return function(a,g,b){void 0===a&&(a=k.vec3f64.create());void 0===g&&(g=k.vec3f64.fromValues(.57735,.57735,.57735));void 0===b&&(b=!0);this.intensity=a;this.direction=g;this.castShadows=b}}();f.MainLight=p;p=function(){return function(a,g){void 0===a&&(a=k.vec3f64.create());void 0===g&&(g=k.vec3f64.fromValues(.57735,.57735,.57735));this.intensity=k.vec3f64.create();
this.direction=k.vec3f64.create();this.intensity=a;this.direction=g}}();f.FillLight=p;p=function(){return function(a){void 0===a&&(a=k.vec3f64.create());this.intensity=a}}();f.AmbientLight=p;p=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();f.SphericalHarmonicsLight=p})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyPan ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/ViewEvents ../../input/handlers/PreventContextMenu".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C){p=function(g){function f(){var a=null!==g&&g.apply(this,arguments)||this;a._handles=new b;return a}k(f,g);f.prototype.initialize=function(){var a=this;this.viewEvents=new B.ViewEvents(this.view);this._handles.add([e.whenNot(this.view,"ready",function(){return a._disconnect()}),e.when(this.view,"ready",function(){return a._connect()})])};f.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this._disconnect()};
Object.defineProperty(f.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});f.prototype._disconnect=
function(){this.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};f.prototype._connect=function(){var a=this.view;this._source=new z.BrowserEventSource(this.view.surface,a.input);var b=new w.InputManager(this._source);this._inputManager=b;b.installHandlers("prevent-context-menu",[new C.PreventContextMenu]);this._modeDragPan=new t.PinchAndPanNavigation(a,"primary");this._modeDragRotate=new m.DragRotate(a,
"secondary","center");this._modeDragZoom=new l.DragZoom(a,"tertiary");b.installHandlers("navigation",[new u.PointerDownCancelAnimation(a),new d.DoubleClickZoom(a),new h.GamepadNavigation(a),new n.KeyPan(a,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j"}),new q.MouseWheelZoom(a),new y.SingleKeyResetTilt(a,"p"),new r.SingleKeyResetHeading(a,"n"),new m.DragRotate(a,"primary","eye",["b"]),new m.DragRotate(a,"secondary","center",["b"]),new t.PinchAndPanNavigation(a,
"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new x.TwoFingerTilt(a)]);this.viewEvents.connect(b);this._updateMode()};f.prototype._updateMode=function(){var a=this.primaryDragAction,a=D.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};Object.defineProperty(f.prototype,"debug",{get:function(){return{inputManager:this._inputManager}},
enumerable:!0,configurable:!0});a([c.property()],f.prototype,"view",void 0);a([c.property({value:"pan"})],f.prototype,"primaryDragAction",null);a([c.property({value:"default"})],f.prototype,"mode",null);a([c.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],f.prototype,"hasPendingInputs",void 0);a([c.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],f.prototype,"latestPointerType",void 0);a([c.property()],f.prototype,"_inputManager",void 0);return f=a([c.subclass("esri.views.3d.input.SceneInputManager")],
f)}(c.declared(g));var D=new Map;f=new Map;g=new Map;f.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});f.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});g.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});g.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});D.set("default",f);D.set("pro",g);return p})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function c(a,c){var d=b.call(this,!0)||this;d.view=a;d.registerIncoming("double-click",c,function(a){return d.handleDoubleClick(a)});return d}k(c,b);c.prototype.handleDoubleClick=function(b){var c=b.data;if(e.eventMatchesPointerAction(c,"primary")){var d=this.view.state.isGlobal?new a.ZoomStepController(this.view,"animation"):new g.ZoomStepController(this.view,"animation");this.view.state.switchCameraController(d);
d.zoomStep(Math.log(.5)/Math.log(.6),[c.x,this.view.height-c.y]);b.stopPropagation()}};return c}(b.InputHandler);f.DoubleClickZoom=p})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(p,f,k,a,g,b,e,c,d,m){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function h(e,h){var l=b.call(this,e.state,e.sceneIntersectionHelper,"interaction"===h?null:void 0)||this;l.view=e;l.mode=h;l.zoomLocation=a.vec3f64.create();l.tmpCamera=new d;l.tmpViewDir=a.vec3f64.create();l.targetOnSphere=a.vec3f64.create();l.tmpCenter=a.vec3f64.create();l.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new d,interactionDirection:null,tiltMode:0};
l.sphere=c.sphere.create();return l}k(h,b);Object.defineProperty(h.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});h.prototype.zoomStep=function(b,c){if(this.active){var d=this.view.state,e=this.constraintOptions.interactionStartCamera;this.animation.finished?e.copyFrom(d.camera):this.animation.cameraAt(1,e);e=!1;0<b&&this.intersectionHelper.intersectScreen(c,this.zoomLocation)&&(e=!0);this.tmpCamera.copyFrom(d.camera);e?this.intersectionHelper.intersectRay(this.tmpCamera.ray,
this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:a.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,b),this.zoomLocation,c);this.begin(this.tmpCamera)}};h.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:m.outExpo}};h.prototype.updateCamera=function(b,d,h,l){this.sphere.radius=a.vec3.length(h);a.vec3.subtract(this.tmpViewDir,
b.center,b.eye);var m=a.vec3.length(this.tmpViewDir),n=m*d;1>=d&&4>n&&(n=4,d=n/m);1E-6>Math.abs(m-n)||(m=a.vec3.length(b.center),this.sphere.radius!==m&&a.vec3.scale(b.center,b.center,(this.sphere.radius+d*(m-this.sphere.radius))/m),a.vec3.scale(this.tmpViewDir,this.tmpViewDir,-d),a.vec3.add(b.eye,b.center,this.tmpViewDir),g.applyAll(this.view,b,this.constraintOptions),1E-12<a.vec3.squaredDistance(h,b.center)&&c.sphere.intersectScreen(this.sphere,b,l,this.targetOnSphere)&&e.panToPosition(this.sphere,
b,h,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0),g.applySurfaceCollision(this.view,b))};return h}(b.PointToPointAnimationController);f.ZoomStepController=p})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n){Object.defineProperty(f,"__esModule",{value:!0});f.applyTilt=m.apply;f.tiltError=m.error;f.applyAltitude=l.apply;f.altitudeError=l.error;f.applyDistance=h.apply;f.distanceError=h.error;f.applySurfaceCollision=n.apply;f.applyAll=function(a,b,c,d){void 0===c&&(c=t);void 0===d&&(d=b);var h=!1;d!==b&&d.copyFrom(b);d.markViewDirty();d.computeUp(a.state.mode);for(b=0;b<u;b++){for(var l=0,m=0,n=q;m<n.length;m++){var r=n[m];if(g.hasConstraintType(c.selection,r.type)){var k=
Math.abs(r.error(a,d,c));r.apply(a,d,c)&&(h=!0,l+=k)}}if(0===l)break}b=g.hasConstraintType(c.selection,8);a:switch(c.interactionType){case 4:c=1;break a;case 5:c=a.state.isGlobal?2:1;break a;default:c=0}b&&e.apply(a,d,c)&&(h=!0);h&&d.computeUp(a.state.mode);return h};f.pixelDistanceToInteractionFactor=function(a,b){a="number"===typeof a?a:k.vec2.distance(a,b);return d.inOutCubic(Math.min(1,a/150))};var q=[{type:1,error:function(a,b,d){return c.error(a,b,d)*b.distance},apply:c.apply},{type:2,error:a.error,
apply:a.apply},{type:4,error:b.error,apply:b.apply}],t={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},u=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ./common ../../support/geometryUtils ../../support/intersectionUtils ../../support/mathUtils".split(" "),function(p,f,k,a,g,b,e){function c(b,d,h){void 0===h&&(h=a.defaultApplyOptions);var l;l=b.state.constraints.altitude;
l=b.state.isGlobal&&l?2===h.interactionType&&a.hasConstraintType(h.selection,1)?!1:!0:!1;if(!l)return 0;var g=b.state.constraints.altitude;l=m;l.min=g.min;l.max=g.max;var n=h.interactionType;if(0!==n){var g=l.min,q=l.max,t=h.interactionStartCamera;h=h.interactionFactor;var n=2===n||1===n,k=c(b,t),t=0===k?0:b.renderCoordsHelper.getAltitude(t.eye);l.min=g;l.max=q;a.adjustRangeForInteraction(k,t,n,h,.05*t,l)}b=b.renderCoordsHelper.getAltitude(d.eye);b=e.clamp(b,l.min,l.max)-b;return 1E-6>=Math.abs(b)?
0:b}function d(a,b,c,d){a.renderCoordsHelper.worldUpAtPosition(b.eye,d);k.vec3.scale(d,d,c);return d}Object.defineProperty(f,"__esModule",{value:!0});f.apply=function(m,t,u,r){void 0===u&&(u=a.defaultApplyOptions);void 0===r&&(r=t);r!==t&&r.copyFrom(t);var q=c(m,t,u);if(0===q)return!1;var f=m.renderCoordsHelper,z=f.getAltitude(t.eye)+q;m=a.interactionDirectionTowardsConstraintMinimization(m,t,u.interactionDirection,d(m,t,e.sign(q),h),l);u=k.vec3.copy(n,t.viewForward);f.intersectInfiniteManifold(g.ray.wrap(t.eye,
m),z,r.eye)||f.setAltitude(z,r.eye);b.closestPointOnRay(t.eye,u,t.center,t.center);r.markViewDirty();return!0};f.error=c;var m={min:0,max:0},l=k.vec3f64.create(),h=k.vec3f64.create(),n=k.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../../support/mathUtils"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.hasConstraintType=function(a,b){return 0!==(a&b)};f.adjustRangeForInteraction=
function(a,b,e,c,d,m){0!==a&&(e?(m.min=Math.min(m.min,b),m.max=Math.max(m.max,b)):null!=c?(m.min-=Math.max(0,(b-m.min)*(1-c)),m.max+=Math.max(0,(b-m.max)*(1-c))):d&&(m.min-=Math.max(0,b-m.min-d),m.max+=Math.max(0,b-m.max-d)))};f.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};f.interactionDirectionTowardsConstraintMinimization=function(g,b,e,c,d){e||(e=b.viewForward);k.vec3.copy(d,e);k.vec3.scale(d,d,a.sign(k.vec3.dot(e,
c)));return d}})},"esri/views/3d/support/intersectionUtils":function(){define(["require","exports","../../../core/libs/gl-matrix-2/gl-matrix"],function(p,f,k){function a(a,b,m,l){var c=e;a?(m&&l&&(c.len=k.vec3.distance(b,m)),k.vec3.copy(c.dir,a)):l?(c.len=k.vec3.distance(b,m),k.vec3.subtract(c.dir,m,b),k.vec3.scale(c.dir,c.dir,1/c.len)):(k.vec3.subtract(c.dir,m,b),k.vec3.normalize(c.dir,c.dir));return c}function g(a,b){return-k.vec3.dot(b,a)-a[3]}function b(a,b,e,l){l.clip[0]=0;l.clip[1]=e?l.len:
Number.MAX_VALUE;for(e=0;e<a.length;e++){var c;var d=a[e],m=b;c=l;var t=k.vec3.dot(d,c.dir),d=g(d,m);0>d&&0<=t?c=!1:-1E-6<t&&1E-6>t?c=0<d:!(0>d||0>t)||0>d&&0>t?(d/=t,0<t?d<c.clip[1]&&(c.clip[1]=d):d>c.clip[0]&&(c.clip[0]=d),c=c.clip[0]<=c.clip[1]):c=!0;if(!c)return!1}return!0}Object.defineProperty(f,"__esModule",{value:!0});f.planeSphere=function(a,b,e){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]<e};f.frustumSphere=function(a,b,e){var c=b[0],d=b[1];b=b[2];return a[0][0]*c+a[0][1]*d+a[0][2]*b+a[0][3]>
e||a[1][0]*c+a[1][1]*d+a[1][2]*b+a[1][3]>e||a[2][0]*c+a[2][1]*d+a[2][2]*b+a[2][3]>e||a[3][0]*c+a[3][1]*d+a[3][2]*b+a[3][3]>e||a[4][0]*c+a[4][1]*d+a[4][2]*b+a[4][3]>e||a[5][0]*c+a[5][1]*d+a[5][2]*b+a[5][3]>e?!1:!0};f.frustumRay=function(c,d,e,l){e=a(l,d,e,!1);return b(c,d,null,e)};f.frustumPoint=function(a,b){for(var c=0;6>c;c++)if(0>g(a[c],b))return!1;return!0};f.frustumLineSegment=function(c,d,e,l){l=a(l,d,e,!0);return b(c,d,e,l)};f.closestPointOnRay=function(a,b,e,l){e=k.vec3.dot(b,k.vec3.subtract(l,
e,a));k.vec3.add(l,a,k.vec3.scale(l,b,e));return l};var e={dir:k.vec3f64.create(),len:0,clip:k.vec2f64.create()}})},"esri/views/3d/camera/constraintUtils/distance":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ./common ../../support/geometryUtils ../../support/mathUtils".split(" "),function(p,f,k,a,g,b){function e(b,d,h){void 0===h&&(h=a.defaultApplyOptions);if(!b.state.isLocal)return 0;var l=b.state.constraints.distance;if(!b.pointsOfInterest.surfaceOrigin.renderLocation||
Infinity===l)return 0;c.min=0;c.max=l;var l=c,m=h.interactionType;if(0!==m){var g=l.min,n=l.max,q=h.interactionStartCamera;h=h.interactionFactor;var m=1===m||4===m,t=e(b,q),q=0===t?0:k.vec3.distance(q.eye,b.pointsOfInterest.surfaceOrigin.renderLocation);l.min=g;l.max=n;a.adjustRangeForInteraction(t,q,m,h,.05*q,l)}b=k.vec3.distance(d.eye,b.pointsOfInterest.surfaceOrigin.renderLocation);b=c.max-b;return-1E-6<=b?0:b}Object.defineProperty(f,"__esModule",{value:!0});f.error=e;f.apply=function(c,q,t,u){void 0===
t&&(t=a.defaultApplyOptions);void 0===u&&(u=q);u!==q&&u.copyFrom(q);var n=e(c,q,t);if(0===n)return!1;var f=c.pointsOfInterest.surfaceOrigin,n=k.vec3.distance(q.eye,c.pointsOfInterest.surfaceOrigin.renderLocation)+n,x=k.vec3.copy(d,q.eye);t=a.interactionDirectionTowardsConstraintMinimization(c,q,t.interactionDirection,b.directionFromTo(h,q.eye,c.pointsOfInterest.surfaceOrigin.renderLocation),l);return g.sphere.intersectRay(g.sphere.wrap(n,f.renderLocation),g.ray.wrap(q.eye,t),u.eye)?(q=k.vec3.subtract(m,
u.eye,x),k.vec3.add(u.center,u.center,q),u.markViewDirty(),q=c.renderCoordsHelper.getAltitude(u.center),c.renderCoordsHelper.intersectInfiniteManifold(u.ray,q,u.center),u.markViewDirty(),!0):!1};var c={min:0,max:0},d=k.vec3f64.create(),m=k.vec3f64.create(),l=k.vec3f64.create(),h=k.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../intersectionUtils"],function(p,f,k,a){Object.defineProperty(f,
"__esModule",{value:!0});f.apply=function(b,e,c,d){void 0===c&&(c=0);void 0===d&&(d=e);var m=b.state.constraints;e!==d&&d.copyFrom(e);if(!m.collision.enabled)return!1;var l=a.surfaceElevationBelowEye(b,e);e=b.renderCoordsHelper.getAltitude(e.eye);m=l+m.collision.elevationMargin;if(e>=m)return!1;l=k.vec3.length(d.eye);k.vec3.subtract(g,d.center,d.eye);b.renderCoordsHelper.setAltitude(m,d.eye);1===c?k.vec3.add(d.center,d.eye,g):2===c&&k.vec3.scale(d.center,d.center,(l-e+m)/l);d.markViewDirty();return!0};
var g=k.vec3f64.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../support/earthUtils ../webgl-engine/lib/Selector".split(" "),function(p,f,k,a,g,b,e){function c(a,b){return a.renderCoordsHelper.fromRenderCoords(b,n,a.basemapTerrain.spatialReference)?a.basemapTerrain.getElevation(n)||0:0}function d(a,b,d){if(!a.state.isGlobal)return!1;var e=c(a,b);a=a.stateManager.constraintsManager.nearFarHeuristic.compute(b,
d,a.dataExtent,e,t).far;a*=a;return k.vec3.squaredDistance(b,d)>a}Object.defineProperty(f,"__esModule",{value:!0});f.eyeWithinExtent=function(a,b,c,d){return a.renderCoordsHelper.fromRenderCoords(b.eye,l,d)&&g.containsPoint(c,l)};f.surfaceElevationBelowEye=function(a,b){return c(a,b.eye)};f.surfaceElevationBelowRenderPoint=c;f.cameraOnContentAlongViewDirection=function(a,c,l,g){var n=a.state.camera.copy();c&&(n.eye=c);l&&(n.center=l);g&&(n.up=g);a:{c=n.ray;l=h;void 0===l&&(l=k.vec3f64.create());g=
m[a.viewingMode];g||(g=new e(a.viewingMode),g.enableBackfacesTerrain=!a.state.isGlobal,g.enableInvisibleTerrain=!0,m[a.viewingMode]=g);var r=a.state.isGlobal;if(!a.sceneIntersectionHelper.intersectRay(c,l,g)||d(a,c.origin,l))if(!a.renderCoordsHelper.intersectManifold(c,0,l)||d(a,c.origin,l))if(r)g=k.vec3.dot(c.origin,c.origin)-b.earthRadius*b.earthRadius,k.vec3.scale(l,c.direction,(0<g?Math.sqrt(g)/3:1)/k.vec3.length(c.direction)),k.vec3.add(l,l,c.origin);else{c=!1;break a}c=!0}c||k.vec3.copy(h,n.center);
l=a.state.constraints;g=l.minimumPoiDistance;k.vec3.squaredDistance(n.eye,h)<g&&(c=l.collision.enabled,k.vec3.copy(q,n.viewForward),k.vec3.scale(q,q,g),c?k.vec3.subtract(n.eye,h,q):k.vec3.add(h,n.eye,q),a=a.renderCoordsHelper,g=a.getAltitude(n.eye),l=l.collision.elevationMargin,c&&g<l&&(k.vec3.subtract(q,h,n.eye),a.setAltitude(l,n.eye),k.vec3.add(h,n.eye,q)));n.center=h;return n};var m={},l=k.vec3f64.create(),h=k.vec3f64.create(),n=new a,q=k.vec3f64.create(),t={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/Selector":function(){define("require exports ../../../../core/has ../../../../core/libs/gl-matrix-2/gl-matrix ./Object3D ./PerformanceTimer".split(" "),
function(p,f,k,a,g,b){var e=a.mat4f64.create(),c=a.vec3f64.create(),d=a.vec3f64.create(),m=a.vec3f64.create();p=function(){function b(b){this.minResult=new l;this.maxResult=new l;this._transform=a.mat4f64.create();this._transformInverse=new h({value:this._transform},a.mat4.invert,a.mat4f64.create);this._transformInverseTranspose=new h(this._transformInverse,a.mat4.transpose,a.mat4f64.create);this._transformTranspose=new h({value:this._transform},a.mat4.transpose,a.mat4f64.create);this._transformInverseRotation=
new h({value:this._transform},a.mat3.normalFromMat4,a.mat3f64.create);this.enableTerrain=this.enableHUDSelection=!0;this.enableInvisibleTerrain=!1;this.enableBackfacesTerrain=!0;this._p0=a.vec3f64.create();this._p1=a.vec3f64.create();this.performanceInfo={queryDuration:0,numObjectsTested:0};this.viewingMode=b||"global"}Object.defineProperty(b.prototype,"p0",{get:function(){return this._p0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"p1",{get:function(){return this._p1},enumerable:!0,
configurable:!0});b.prototype.init=function(a,b,c,d,e,h,l,m){this.minResult.init(b,c);this.maxResult.init(b,c);this._numObjectsTested=0;this.hudResults=[];this.run(a,b,c,d,e,h,l,m)};b.prototype.run=function(b,c,d,e,h,l,g,n){var q=this;this.point=e;this.camera=h;this.isSelection=g;a.vec3.copy(this._p0,c);a.vec3.copy(this._p1,d);this.filterPredicate=n;null==l&&(l=1E-5);this.tolerance=l;if(b&&0<b.length)for(c&&d&&a.vec3.subtract(m,d,c),c=function(a){q.intersectObject(a)},d=0;d<b.length;d++)if(e=b[d],
h=e.getSpatialQueryAccelerator?e.getSpatialQueryAccelerator():void 0)h.forEachAlongRay(this._p0,m,c),g&&h.forEachDegenerateObject(c);else for(h=0,e=e.getObjects();h<e.length;h++)c(e[h])};Object.defineProperty(b.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0});b.prototype.setTransform=function(b){a.mat4.copy(this._transform,b);this.invalidateLazyTransform()};Object.defineProperty(b.prototype,"transformInverse",{get:function(){return this._transformInverse.value},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});b.prototype.invalidateLazyTransform=
function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};b.prototype.intersectObject=function(b){var h=this;this._numObjectsTested++;for(var m=b.id,g=b.getGeometryRecords(),n=b.objectTransformation,q,k=0;k<g.length;k++){var t=g[k],f=t.geometry,D=t.material,E=t.instanceParameters;E.hidden||(q=f.id,a.mat4.copy(this._transform,n),a.mat4.multiply(this._transform,this._transform,t.getShaderTransformation()),
this.invalidateLazyTransform(),a.vec3.transformMat4(c,this.p0,this.transformInverse),a.vec3.transformMat4(d,this.p1,this.transformInverse),D.intersect(f,E,this._transform,this,c,d,function(a,c,d,g,n,r){0<=a&&(null==h.filterPredicate||h.filterPredicate(h._p0,h._p1,a))&&(n?(n=new l,n.init(h._p0,h._p1),n.set(b,m,a,c,e,g,r,q,d),h.hudResults.push(n)):((null==h.minResult.priority||g>=h.minResult.priority)&&(null==h.minResult.dist||a<h.minResult.dist)&&h.minResult.set(b,m,a,c,h._transform,g,null,q,d),(null==
h.maxResult.priority||g>=h.maxResult.priority)&&(null==h.maxResult.dist||a>h.maxResult.dist)&&h.maxResult.set(b,m,a,c,h._transform,g,null,q,d)))},t.shaderTransformation))}};b.DEFAULT_TOLERANCE=1E-5;return b}();var l=function(){function b(b,c){this._p0=a.vec3f64.create();this._p1=a.vec3f64.create();this._normal=a.vec3f64.create();this._transformation=a.mat4f64.create();this.init(b,c)}Object.defineProperty(b.prototype,"p0",{get:function(){return this._p0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"p1",{get:function(){return this._p1},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0});b.prototype.getIntersectionPoint=function(b){if(!this.hasIntersectionPoint)return!1;a.vec3.lerp(b,this.p0,this.p1,this.dist);return!0};b.prototype.getTransformedNormal=function(b){a.vec3.copy(n,this._normal);n[3]=0;a.vec4.transformMat4(n,n,this._transformation);a.vec3.copy(b,n);a.vec3.normalize(b,b);return b};
b.prototype.set=function(b,c,d,e,h,l,m,n,q){b instanceof g&&(b={type:"stage",obj:b});this.dist=d;a.vec3.copy(this._normal,e);a.mat4.copy(this._transformation,h);this.target=b;this.name=c;this.priority=l;this.center=m?a.vec3f64.clone(m):null;this.geometryId=n;this.triangleNr=q};b.prototype.copyFrom=function(b){a.vec3.copy(this._p0,b._p0);a.vec3.copy(this._p1,b._p1);this.dist=b.dist;this.target=b.target;this.name=b.name;this.priority=b.priority;this.center=b.center?a.vec3f64.clone(b.center):null;this.geometryId=
b.geometryId;this.triangleNr=b.triangleNr;this.intersector=b.intersector;a.vec3.copy(this._normal,b._normal);a.mat4.copy(this._transformation,b._transformation)};b.prototype.setIntersector=function(a){this.intersector=a};b.prototype.init=function(b,c){this.priority=this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";b?a.vec3.copy(this._p0,b):a.vec3.set(this._p0,0,0,0);c?a.vec3.copy(this._p1,c):a.vec3.set(this._p1,0,0,0)};return b}(),h=function(){function a(a,
b,c){this.original=a;this.update=b;this.dirty=!0;this.transform=c()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform},enumerable:!0,configurable:!0});return a}(),n=a.vec4f64.create();return p})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/mathUtils ./ComponentUtils ./GeometryRecord ./HighlightUtils ./IdGen ./ModelContentType ./Util".split(" "),
function(p,f,k,a,g,b,e,c,d,m){var l=m.assert,h=k.mat4f64.create();p=function(){function m(a){void 0===a&&(a={});this._bvObjectSpace=new n;this._bvWorldSpace=new n;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._allComponentsHiddenDirty=!0;this.id=m._idGen.gen(a.idHint);this.name=a.name;this.castShadow=null!=a.castShadow?a.castShadow:!0;this.metadata=a.metadata;this.objectTransformation=k.mat4f64.create();this._initializeGeometryRecords(a.geometries,a.materials,a.transformations,a.origins)}
m.prototype._initializeGeometryRecords=function(a,c,d,e){if(Array.isArray(a)){l(c.length===a.length,"Object3D: materials don't match geometries");l(d.length===a.length,"Object3D: transformations don't match geometries");this.geometryRecords=Array(a.length);this.geometries=a.slice();for(var h=0;h<a.length;h++)this.geometryRecords[h]=new b(a[h],c[h],k.mat4f64.clone(d[h]),{},e&&e[h]);this._hasVolatileTransformation=!1}else this.geometryRecords=[],this.geometries=[]};Object.defineProperty(m.prototype,
"parentLayer",{get:function(){return this._parentLayer},set:function(a){l(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!0,configurable:!0});m.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length};m.prototype.getFirstGeometryIndex=function(a){a=this.geometries.indexOf(a);l(-1<a,"Object3D.getFirstGeometryIndex: geometry not found");return a};m.prototype.findGeometryRecords=function(a){for(var b=[],c=0;c<this.geometries.length;c++)this.geometries[c]===
a&&b.push(this.geometryRecords[c]);return b};m.prototype.getGeometryRecord=function(a){l(0<=a&&a<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this.geometryRecords[a]};m.prototype.getGeometryRecords=function(){return this.geometryRecords};m.prototype.addGeometry=function(a,c,d,e,l,m){void 0===d&&(d=h);this.geometries.push(a);a=new b(a,c,k.mat4f64.clone(d),e||{},l,m);this.geometryRecords.push(a);this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.shaderTransformation});
this._notifyDirty("objGeometryAdded",a);this._invalidateBoundingVolume();this._allComponentsHiddenDirty=!0;return a};m.prototype.hasGeometry=function(a){return-1<this.geometries.indexOf(a)};m.prototype.removeGeometry=function(a){var b=this.geometryRecords.splice(a,1)[0];this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.shaderTransformation});this.geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",b);this._invalidateBoundingVolume();this._allComponentsHiddenDirty=
!0;return b};m.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};m.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[a]);this._invalidateBoundingVolume()};m.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a];if(!g.isAllHidden(c.instanceParameters.componentVisibilities,
c.geometry.data.componentOffsets)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden};m.prototype.areAllComponentsVisible=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a];if(!g.isAllVisible(c.instanceParameters.componentVisibilities,c.geometry.data.componentOffsets))return!1}return!0};m.prototype.hasComponents=function(){for(var a=!1,b=0;b<this.geometries.length&&!(a=g.hasComponents(this.geometries[b].data.componentOffsets));b++);return a};m.prototype.setComponentVisibility=
function(a,b,c){b=g.updateVisibility(a.instanceParameters.componentVisibilities,a.geometry.data.componentOffsets,b,c);a.instanceParameters.componentVisibilities=b;this._notifyDirty("visibilityChanged",a);this._allComponentsHiddenDirty=!0};m.prototype.setHidden=function(a,b){a.instanceParameters.hidden=!!b;this._notifyDirty("visibilityChanged",a)};m.prototype.isHidden=function(a){return!!a.instanceParameters.hidden};m.prototype.getComponentVisibility=function(a,b){return g.getVisibility(a.instanceParameters.componentVisibilities,
b)};m.prototype.hideAllComponents=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a],d=g.hideAllComponents(c.instanceParameters.componentVisibilities);c.instanceParameters.componentVisibilities=d}this._notifyDirty("visibilityChanged");this._allComponentsHiddenDirty=!0};m.prototype.unhideAllComponents=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var c=b[a],d=g.unhideAllComponents(c.instanceParameters.componentVisibilities);c.instanceParameters.componentVisibilities=
d}this._notifyDirty("visibilityChanged");this._allComponentsHiddenDirty=!0};m.prototype._setComponentHighlight=function(a,b,c,d){b=g.addHighlight(a.instanceParameters.componentHighlights,b,c,d);a.instanceParameters.componentHighlights=b};m.prototype.setComponentHighlight=function(a,b,c){var d=e.generateHighlightId();this._setComponentHighlight(a,b,c,d);this._notifyDirty("componentHighlightChanged");return d};m.prototype.highlightAllComponents=function(a){for(var b=e.generateHighlightId(),c=0,d=this.geometryRecords;c<
d.length;c++)this._setComponentHighlight(d[c],null,a,b);this._notifyDirty("componentHighlightChanged");return b};m.prototype.removeHighlights=function(a){for(var b=0,c=this.geometryRecords;b<c.length;b++){var d=c[b].instanceParameters,e=g.removeHighlight(d.componentHighlights,a);d.componentHighlights=e}this._notifyDirty("componentHighlightChanged")};m.prototype.getComponentFromTriangleNr=function(a,b){l(0<=a&&a<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");
return g.componentFind(this.geometryRecords[a].geometry.data.componentOffsets,3*b)};m.prototype.setGeometryTransformation=function(a,c){l(0<=a&&a<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var d=this.geometryRecords[a];c=new b(d.geometry,d.material,k.mat4f64.clone(c),d.instanceParameters);this.geometryRecords[a]=c;this._notifyDirty("objGeometryReplaced",[d,c]);this._invalidateBoundingVolume()};m.prototype.getObjectTransformation=function(){return k.mat4f64.clone(this.objectTransformation)};
m.prototype.setObjectTransformation=function(a){k.mat4.copy(this.objectTransformation,a);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")};m.prototype.getCombinedStaticTransformation=function(a,b){b=b||k.mat4f64.create();k.mat4.multiply(b,this.objectTransformation,a.getStaticTransformation());return b};m.prototype.getCombinedShaderTransformation=function(a,b){b=b||k.mat4f64.create();k.mat4.multiply(b,this.objectTransformation,a.getShaderTransformation());return b};m.prototype.hasVolativeTransformation=
function(){return this._hasVolatileTransformation};m.prototype.getCastShadow=function(){return this.castShadow};m.prototype.setCastShadow=function(a){this.castShadow=a};m.prototype.getMetadata=function(){return this.metadata};m.prototype.getName=function(){return this.name};m.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};m.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};
m.prototype.getCenter=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.center:this._bvWorldSpace.center};m.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};m.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var b=0;b<this.geometryRecords.length;++b){var c=this.geometries[b],d=this.geometryRecords[b],
c=c.boundingInfo;this._calculateTransformedBoundingVolume(c,this._bvObjectSpace,d.getShaderTransformation());this._calculateTransformedBoundingVolume(c,this._bvWorldSpace,this.getCombinedShaderTransformation(d))}k.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5);k.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);for(var d=k.vec3f64.create(),e=k.vec3f64.create(),h=a.maxScale(this.objectTransformation),b=0;b<this.geometryRecords.length;++b){var c=
this.geometries[b],l=this.geometryRecords[b].getShaderTransformation(),m=a.maxScale(l),c=c.boundingInfo;k.vec3.transformMat4(d,c.getCenter(),l);l=k.vec3.distance(d,this._bvObjectSpace.center);c=c.getBSRadius()*m;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,l+c);k.vec3.transformMat4(e,d,this.objectTransformation);m=k.vec3.distance(e,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,m+c*h)}this._bvDirty=!1}};m.prototype._calculateTransformedBoundingVolume=
function(a,b,c){var d=a.getBBMin();a=a.getBBMax();var e=k.vec3f64.clone(d),h=k.vec3f64.clone(a);k.vec3.transformMat4(e,e,c);k.vec3.transformMat4(h,h,c);for(var l=0;3>l;++l)b.bbMin[l]=Math.min(b.bbMin[l],e[l],h[l]),b.bbMax[l]=Math.max(b.bbMax[l],e[l],h[l]);for(l=0;3>l;++l){k.vec3.copy(e,d);k.vec3.copy(h,a);e[l]=a[l];h[l]=d[l];k.vec3.transformMat4(e,e,c);k.vec3.transformMat4(h,h,c);for(var m=0;3>m;++m)b.bbMin[m]=Math.min(b.bbMin[m],e[m],h[m]),b.bbMax[m]=Math.max(b.bbMax[m],e[m],h[m])}};m.prototype._invalidateBoundingVolume=
function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})};m.prototype._notifyDirty=function(a,b,c,e){this._parentLayer&&(c=c||d.OBJECT,this._parentLayer.notifyDirty(a,b,c,e||this))};m._idGen=new c;return m}();var n=function(){function a(){this.bbMin=k.vec3f64.create();this.bbMax=k.vec3f64.create();this.center=k.vec3f64.create();this.bsRadius=0}a.prototype.init=function(){k.vec3.set(this.bbMin,
Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);k.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);k.vec3.set(this.center,0,0,0);this.bsRadius=0};a.prototype.getCenter=function(){return this.center};a.prototype.getBSRadius=function(){return this.bsRadius};return a}();return p})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","./IdGen"],function(p,f,k){return function(){function a(g,b,e,c,d,m){this.id=a._idGen.gen(g.id);this.geometry=
g;this.material=b;this.transformation=e;this.instanceParameters=c;this.origin=d;this.shaderTransformation=m}a.prototype.getStaticTransformation=function(){return this.transformation};a.prototype.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation};a._idGen=new k;return a}()})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(p,f){return function(){function k(){this._count=0}k.prototype.gen=
function(a){null==a&&(a="a");return a+"_"+this._count++};return k}()})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports","./IdGen"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});var a=new k;f.generateHighlightId=function(){return a.gen("highlight")}})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(p,f){return function(){function k(){}k.LAYER="layers";k.OBJECT="objects";k.GEOMETRY="geometries";
k.MATERIAL="materials";k.TEXTURE="textures";return k}()})},"esri/views/3d/webgl-engine/lib/PerformanceTimer":function(){define(["require","exports","./Performance"],function(p,f,k){return function(){function a(a){this._filterSampleIndex=0;this._lastTime=NaN;this._numMeasurements=this._totalTime=0;this._filterSamples=Array(a);this.reset();this._filterSize=a}a.prototype.reset=function(){for(var a=this._filterSampleIndex=0;a<this._filterSize;a++)this._filterSamples[a]=NaN};a.prototype.start=function(){this._tsStart=
k.now()};a.prototype.stop=function(){this._lastTime=k.now()-this._tsStart;this._totalTime+=this._lastTime;this._numMeasurements++;this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize);return this._lastTime};a.prototype.getLast=function(){return this._lastTime};a.prototype.getLastFiltered=function(){for(var a=0,b=0;b<this._filterSamples.length;b++)a+=this._filterSamples[b];return a/this._filterSamples.length};
a.prototype.getAverage=function(){return this._totalTime/this._numMeasurements};a.prototype.getTotal=function(){return this._totalTime};a.prototype.getNumMeasurements=function(){return this._numMeasurements};return a}()})},"esri/views/3d/webgl-engine/lib/Performance":function(){define(["require","exports","../../../../core/now"],function(p,f,k){return{now:k}})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/gl-matrix ./common ../../state/utils/viewUtils ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils".split(" "),
function(p,f,k,a,g,b,e,c,d){function m(b,c,d,e,h){void 0===d&&(d=g.defaultApplyOptions);void 0===e&&(e=c);void 0===h&&(h=!0);c!==e&&e.copyFrom(c);z.eyeCenterDistance=0;z.requiresTwoSteps=!1;var n=l(b,c,d,void 0,z);if(0===n)return!1;a.mat4.identity(t);a.mat4.rotate(t,t,-n,c.viewRight);switch(d.tiltMode){case 1:a.vec3.transformMat4(q,c.viewForward,t);a.vec3.scale(q,q,z.eyeCenterDistance);a.vec3.add(e.center,c.eye,q);break;case 0:a.vec3.subtract(q,c.center,c.eye);a.vec3.transformMat4(q,q,t);a.vec3.subtract(e.eye,
c.center,q);break;default:k.neverReached(d.tiltMode)}a.vec3.transformMat4(e.up,e.up,t);e.markViewDirty();return z.requiresTwoSteps&&h?m(b,e,d,e,!1):!0}function l(m,q,t,f,z){void 0===t&&(t=g.defaultApplyOptions);void 0===f&&(f=g.defaultApplyOptions);if(!m.state.constraints.tilt)return 0;var w=m.state.constraints.tilt(q.distance,y);var B=t;if(0!==B.interactionType){var C=B.interactionStartCamera,D=B.interactionFactor,E=w.min,M=w.max,p=l(m,C,g.defaultApplyOptions,B),O=0===p?0:b.viewAngle(m.renderCoordsHelper,
C.center,C.eye);w.min=E;w.max=M;2===B.interactionType?(g.hasConstraintType(B.selection,2)&&n(m,C,w),g.adjustRangeForInteraction(p,O,!0,D,r,w)):g.adjustRangeForInteraction(p,O,!1,D,r,w)}2===f.interactionType&&g.hasConstraintType(f.selection,2)&&n(m,f.interactionStartCamera,w);if(1===t.tiltMode||1===f.tiltMode){a:{z&&(z.requiresTwoSteps=!1);switch(m.viewingMode){case "global":t=x;B=m.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;f=B+e.earthRadius;B=m.renderCoordsHelper.intersectManifold(q.ray,
B,u);t.eyeCenterDistance=q.distance;B?(t.eyeCenterDistance=a.vec3.distance(q.eye,u),t.tiltAtCenter=b.viewAngle(m.renderCoordsHelper,u,q.eye)):m.state.isLocal?t.tiltAtCenter=b.viewAngle(m.renderCoordsHelper,q.center,q.eye):(c.sphere.closestPointOnSilhouette(c.sphere.wrap(f),q.ray,u),t.eyeCenterDistance=a.vec3.distance(q.eye,u),t.tiltAtCenter=d.acos(-a.vec3.dot(q.viewForward,a.vec3.normalize(u,u))));t.radius=f;t.eyeRadius=a.vec3.length(q.eye);t.constraints=m.state.constraints;t.centerIsOnSurface=B;
q=d.clamp(t.tiltAtCenter,w.min,w.max);if(1E-9<Math.abs(t.tiltAtCenter-q)){if(t.centerIsOnSurface){q=t.constraints;m=f=t.tiltAtCenter;w=q.clampTilt(t.eyeCenterDistance,f);B=h(t,w);if(q.clampTilt(B,f)!==w)for(f=0;10>f&&1E-9<Math.abs(w-m);)B=(m+w)/2,C=h(t,B),C=q.clampTilt(C,B),1E-9<Math.abs(C-B)?m=B:w=B,f++;q=w;w=q;m=d.asin(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter));w=d.asin(t.radius/t.eyeRadius*Math.sin(w));m=t.eyeRadius>t.radius?m-w:w-m}else q=t.constraints.clampTilt(t.eyeCenterDistance,t.tiltAtCenter),
z&&q<Math.PI/2&&(z.requiresTwoSteps=!0,q=Math.PI/2-1E-5),m=t.tiltAtCenter-Math.PI/2-(q-Math.PI/2);z&&(z.eyeCenterDistance=h(t,q));z=m}else z=0;break a;case "local":f=b.viewAngle(m.renderCoordsHelper,q.center,q.eye);t=d.clamp(f,w.min,w.max);w=f-t;1E-9<Math.abs(w)?(z&&(f=m.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,m=m.renderCoordsHelper.getAltitude(q.eye)-f,t=Math.cos(t),z.eyeCenterDistance=1E-4<Math.abs(t)?m/t:q.distance),z=w):z=0;break a;default:k.neverReached(m.viewingMode)}z=
void 0}return z}z=b.viewAngle(m.renderCoordsHelper,q.center,q.eye);q=d.clamp(z,w.min,w.max);z-=q;z=1E-9<Math.abs(z)?z:0;return z}function h(a,b){if(!a.centerIsOnSurface)return a.eyeCenterDistance;b=Math.PI-d.clamp(b,0,Math.PI);var c=d.asin(a.radius/a.eyeRadius*Math.sin(b)),e=Math.sin(Math.PI-b-c)/Math.sin(b);return a.eyeRadius<a.radius&&1<e?Math.sin(Math.PI-b-(Math.PI-c))/Math.sin(b)*a.eyeRadius:e*a.eyeRadius}function n(b,c,h){if(!b.state.isLocal){var l=b.state.constraints;if(l.altitude){b=a.vec3.squaredLength(c.center);
var m=Math.sqrt(b);c=c.distance;var g=l.altitude.min+e.earthRadius,l=l.altitude.max+e.earthRadius,g=(g*g-c*c-b)/(-2*m*c);h.min=Math.max(h.min,Math.min(Math.PI-d.acos((l*l-c*c-b)/(-2*m*c)),h.max));h.max=Math.min(h.max,Math.PI-d.acos(g))}}}Object.defineProperty(f,"__esModule",{value:!0});f.apply=m;f.error=l;var q=a.vec3f64.create(),t=a.mat4f64.create(),u=a.vec3f64.create(),r=d.deg2rad(5),y={min:0,max:0},x={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},
z={eyeCenterDistance:0,requiresTwoSteps:!1}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../../support/mathUtils"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.viewAngle=function(e,c,d){e.worldUpAtPosition(c,g);k.vec3.subtract(b,d,c);e=k.vec3.length(b);return 0===e?0:a.acos(k.vec3.dot(b,g)/e)};var g=k.vec3f64.create(),b=k.vec3f64.create()})},"esri/views/animation/easing":function(){define(["require",
"exports"],function(p,f){function k(a){return a}function a(a){var b=2*(a-Math.sqrt((a-1)*a)),c=b/2/a;return function(d){return d<c?a*d*d:b*d-b+1}}function g(a,e){return function(b){return b<e?e*a(b/e):1-a((1-b)/(1-e))*(1-e)}}Object.defineProperty(f,"__esModule",{value:!0});f.linear=k;f.inQuad=function(a){return a*a};f.outQuad=function(a){return 1-f.inQuad(1-a)};f.inOutQuad=function(a){return.5>a?f.inQuad(2*a)/2:(f.outQuad(2*(a-.5))+1)/2};f.inCubic=function(a){return a*a*a};f.outCubic=function(a){return 1-
f.inCubic(1-a)};f.inOutCubic=function(a){return.5>a?f.inCubic(2*a)/2:(f.outCubic(2*(a-.5))+1)/2};f.inQuart=function(a){return a*a*a*a};f.outQuart=function(a){return 1-f.inQuart(1-a)};f.inOutQuart=function(a){return.5>a?f.inQuart(2*a)/2:(f.outQuart(2*(a-.5))+1)/2};f.inQuint=function(a){return a*a*a*a*a};f.outQuint=function(a){return 1-f.inQuint(1-a)};f.inOutQuint=function(a){return.5>a?f.inQuint(2*a)/2:(f.outQuint(2*(a-.5))+1)/2};f.inSine=function(a){return-Math.cos(a*Math.PI/2)+1};f.outSine=function(a){return 1-
f.inSine(1-a)};f.inOutSine=function(a){return.5>a?f.inSine(2*a)/2:(f.outSine(2*(a-.5))+1)/2};f.inExpo=function(a){return Math.pow(2,10*(a-1))};f.outExpo=function(a){return 1-f.inExpo(1-a)};f.inOutExpo=function(a){return.5>a?f.inExpo(2*a)/2:(f.outExpo(2*(a-.5))+1)/2};f.inCirc=function(a){return-(Math.sqrt(1-a*a)-1)};f.outCirc=function(a){return 1-f.inCirc(1-a)};f.inOutCirc=function(a){return.5>a?f.inCirc(2*a)/2:(f.outCirc(2*(a-.5))+1)/2};f.inCoastQuad=g(a(1),1);f.outCoastQuad=g(a(1),0);f.inOutCoastQuad=
g(a(1),.5);f.inCoastCubic=g(a(2),1);f.outCoastCubic=g(a(2),0);f.inOutCoastCubic=g(a(2),.5);f.inCoastQuart=g(a(3),1);f.outCoastQuart=g(a(3),0);f.inOutCoastQuart=g(a(3),.5);f.inCoastQuint=g(a(4),1);f.outCoastQuint=g(a(4),0);f.inOutCoastQuint=g(a(4),.5);f.named={linear:k,"in-quad":f.inQuad,"out-quad":f.outQuad,"in-out-quad":f.inOutQuad,"in-coast-quad":f.inCoastQuad,"out-coast-quad":f.outCoastQuad,"in-out-coast-quad":f.inOutCoastQuad,"in-cubic":f.inCubic,"out-cubic":f.outCubic,"in-out-cubic":f.inOutCubic,
"in-coast-cubic":f.inCoastCubic,"out-coast-cubic":f.outCoastCubic,"in-out-coast-cubic":f.inOutCoastCubic,"in-quart":f.inQuart,"out-quart":f.outQuart,"in-out-quart":f.inOutQuart,"in-coast-quart":f.inCoastQuart,"out-coast-quart":f.outCoastQuart,"in-out-coast-quart":f.inOutCoastQuart,"in-quint":f.inQuint,"out-quint":f.outQuint,"in-out-quint":f.inOutQuint,"in-coast-quint":f.inCoastQuint,"out-coast-quint":f.outCoastQuint,"in-out-coast-quint":f.inOutCoastQuint,"in-sine":f.inSine,"out-sine":f.outSine,"in-out-sine":f.inOutSine,
"in-expo":f.inExpo,"out-expo":f.outExpo,"in-out-expo":f.inOutExpo,"in-circ":f.inCirc,"out-circ":f.outCirc,"in-out-circ":f.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera".split(" "),function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(a){function b(b,
c,d){d=a.call(this,d)||this;d.viewState=b;d.intersectionHelper=c;d.hasTarget=!1;d.animation=new g.default(d.viewState.mode);return d}k(b,a);b.prototype.begin=function(a,b){this.hasTarget=!0;b=this.animationSettings(b);c.copyFrom(this.viewState.camera);this.intersectionHelper.intersectRay(c.ray,d)&&(c.center=d);this.animation.update(c,a,b);this.animation.finished&&this.finish()};b.prototype.finish=function(){this.animation.currentTime=this.animation.time;a.prototype.finish.call(this)};Object.defineProperty(b.prototype,
"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});b.prototype.stepController=function(b,c){a.prototype.stepController.call(this,b,c);this.hasTarget&&this.animation.step(b,c)};b.prototype.onControllerEnd=function(b){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,b),this.animation.currentTime=this.animation.time);a.prototype.onControllerEnd.call(this,b)};b.prototype.animationSettings=function(a){void 0===
a&&(a={});return{apex:{maximumDistance:this.viewState.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};return b}(b.AnimationController);f.PointToPointAnimationController=p;var c=new e,d=a.vec3f64.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});var c=a.vec3f64.create();p=function(){function d(a){this.currentTime=0;this.animation=new e.Animation(function(){return new g.default(a)});this._current=new g.default(a)}Object.defineProperty(d.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});d.prototype.update=
function(b,d,e){var h=this.animation.definition.source,l=this.animation.definition.target,m=a.vec3.subtract(c,d.center,b.center),g=a.vec3.length(m);1E-5<=g?(m[0]/=g,m[1]/=g,m[2]/=g):(m[0]=0,m[1]=1,m[0]=0);a.vec3.copy(h.lookAtDirection,m);a.vec3.copy(l.lookAtDirection,m);h.copyFromRenderCamera(b);l.copyFromRenderCamera(d);this._current.copyFrom(h);this.animation.update(h,l,e);this.currentTime=0;b.almostEquals(d,5E-4,!0)&&(this.currentTime=this.animation.time)};d.prototype.cameraAt=function(a,c){this.animation.cameraAt(a,
this._current);c=c||new b;this._current.copyToRenderCamera(c);return c};d.prototype.step=function(a,b){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,b)};return d}();f.Animation=p;f.default=p})},"esri/views/3d/animation/pointToPoint/Camera":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../../support/mathUtils"],function(p,f,k,a){Object.defineProperty(f,"__esModule",
{value:!0});var g=a.angle,b=a.lerp,e=a.slerp,c=k.vec3f64.create(),d=k.vec3f64.create(),m=k.vec3f64.create(),l=k.vec3f64.create(),h=k.vec3f64.create(),n=k.vec3f64.create(),q=k.vec3f64.fromValues(0,0,1),t=k.vec3f64.fromValues(0,1,0),u=k.vec3f64.fromValues(1,0,0),r=k.mat3f64.create();p=function(){function a(a){void 0===a&&(a="global");this.viewingMode=a;this.center=k.vec3f64.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=k.vec3f64.clone(t)}a.prototype.pixelsPerPanAtZoom=function(a){return this.size/
2/(this._zoomToPanScale*a)};a.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};a.prototype.pixelsPerRotateAtZoom=function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};a.prototype.compareTo=function(a,b){b||(b={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var c=k.vec3.length(this.center),d=k.vec3.length(a.center),c=(c+d)/2;b.pan=g(this.center,a.center)*c}else b.pan=k.vec3.distance(this.center,a.center);c=Math.abs(a.yaw-
this.yaw);c>=Math.PI&&(c=2*Math.PI-c);b.rotate=Math.max(c,Math.abs(a.pitch-this.pitch));b.sourceZoom=this.distance;b.targetZoom=a.distance;return b};a.prototype.interpolate=function(a,c,d){"global"===this.viewingMode?e(a.center,c.center,d.pan,this.center):k.vec3.lerp(this.center,a.center,c.center,d.pan);this.distance=b(a.distance,c.distance,d.zoom);this.pitch=b(a.pitch,c.pitch,d.rotate);a=a.yaw;c=c.yaw;Math.abs(c-a)>=Math.PI&&(a+=2*(a<c?1:-1)*Math.PI);this.yaw=b(a,c,d.rotate)};a.prototype.copyFrom=
function(a){k.vec3.copy(this.center,a.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;k.vec3.copy(this.lookAtDirection,a.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};a.prototype.copyFromRenderCamera=function(a){var b=this._lookAtOrientation(a.center,r);k.vec3.copy(this.center,a.center);k.vec3.subtract(l,a.center,a.eye);k.vec3.transformMat3(l,l,b);k.vec3.transformMat3(h,a.up,b);this.distance=k.vec3.length(l);l[0]/=this.distance;l[1]/=this.distance;
l[2]/=this.distance;this.pitch=this._eyeUpToPitch(l,h);this.yaw=this._eyeUpToYaw(l,h);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};a.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};a.prototype.copyToRenderCamera=function(a){var b=this._lookAtOrientation(this.center,r);k.mat3.transpose(b,b);this._axisAngleVec3(u,this.pitch-Math.PI/2,t,l);this._axisAngleVec3(q,this.yaw,l);this._axisAngleVec3(u,this.pitch-Math.PI/2,q,
h);this._axisAngleVec3(q,this.yaw,h);k.vec3.scale(l,l,this.distance);k.vec3.transformMat3(l,l,b);k.vec3.transformMat3(h,h,b);a.center=this.center;a.eye=k.vec3.subtract(l,this.center,l);a.up=h};a.prototype._axisAngleVec3=function(a,b,e,h){void 0===h&&(h=e);var l=Math.cos(b);b=Math.sin(b);k.vec3.scale(c,e,l);k.vec3.cross(d,a,e);k.vec3.scale(d,d,b);k.vec3.scale(m,a,(1-l)*k.vec3.dot(a,e));return k.vec3.add(h,k.vec3.add(h,c,d),m)};a.prototype._lookAtOrientation=function(a,b){this._upAtLookAt(a,m);k.vec3.cross(c,
this.lookAtDirection,m);k.vec3.normalize(c,c);0===c[0]&&0===c[1]&&0===c[2]&&k.vec3.copy(c,u);k.vec3.cross(d,m,c);k.vec3.normalize(d,d);b||(b=k.mat3f64.create());b[0]=c[0];b[1]=d[0];b[2]=m[0];b[3]=c[1];b[4]=d[1];b[5]=m[1];b[6]=c[2];b[7]=d[2];b[8]=m[2];return b};a.prototype._upAtLookAt=function(a,b){return"local"===this.viewingMode?k.vec3.copy(b,q):k.vec3.normalize(b,a)};a.prototype._eyeUpToPitch=function(a,b){return Math.PI-g(q,a)};a.prototype._eyeUpToYaw=function(a,b){.5>Math.abs(b[2])?(k.vec3.copy(n,
b),0<a[2]&&k.vec3.scale(n,n,-1)):k.vec3.copy(n,a);k.vec3.cross(d,n,q);k.vec3.normalize(d,d);return g(u,d,q)};return a}();f.default=p})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/geometryUtils ../../support/mathUtils ./Util".split(" "),function(p,f,k,a,g,b){function e(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];a=b[3]-a[3];return c*c+d*d+e*e+a*a}function c(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function d(a,
b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}p=function(){function q(b,c,d){void 0===b&&(b=k.vec3f64.create());void 0===c&&(c=k.vec3f64.create());void 0===d&&(d=k.vec3f64.fromValues(0,0,1));this._viewUp=k.vec3f64.create();this._viewForward=k.vec3f64.create();this._viewRight=k.vec3f64.create();this._ray=a.ray.createWrapper();this._viewport=k.vec4f64.fromValues(0,0,1,1);this._padding=k.vec4f64.create();this._fov=55/180*Math.PI;this._near=1;this._far=1E3;this._viewDirty=!0;this._viewMatrix=
k.mat4f64.create();this._projectionDirty=!0;this._projectionMatrix=k.mat4f64.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=k.mat4f64.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=k.mat4f64.create();this._frustumDirty=!0;this._frustum=a.frustum.create();this._fullViewport=null;this.relativeElevation=0;this._eye=k.vec3f64.clone(b);this._center=k.vec3f64.clone(c);this._up=k.vec3f64.clone(d);this._padding=k.vec4f64.create()}Object.defineProperty(q.prototype,
"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"ray",{get:function(){this._ray.origin=this.eye;this._ray.direction||(this._ray.direction=k.vec3f64.create());k.vec3.subtract(this._ray.direction,this.center,this.eye);return this._ray},
enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"viewMatrix",{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(a){k.mat4.copy(this._viewMatrix,a);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,
"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=
a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==a&&(this._far=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});
Object.defineProperty(q.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"y",{get:function(){return this._viewport[1]},set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,
configurable:!0});Object.defineProperty(q.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});
Object.defineProperty(q.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"fullViewport",{get:function(){this._fullViewport||
(this._fullViewport=k.vec4f64.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"padding",{get:function(){return this._padding},set:function(a){if(this._padding[0]!==
a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+this._padding[2]),k.vec4.copy(this._padding,a),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&
(k.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=this.width,b=this.height,c=this.near*Math.tan(this.fovY/2),d=c*this.aspect;k.mat4.frustum(this._projectionMatrix,-d*(1+2*this._padding[3]/a),d*(1+2*this._padding[1]/a),-c*(1+2*this._padding[2]/b),c*(1+2*this._padding[0]/
b),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){k.mat4.copy(this._projectionMatrix,a);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"fov",{get:function(){return this._fov},set:function(a){this._fov=a;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"fovX",{get:function(){return b.fovd2fovx(this._fov,
this.width,this.height)},set:function(a){this._fov=b.fovx2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"fovY",{get:function(){return b.fovd2fovy(this._fov,this.width,this.height)},set:function(a){this._fov=b.fovy2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,
"distance",{get:function(){return k.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"frustum",{get:function(){this._recomputeFrustum();return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=k.mat4f64.create()),k.mat4.invert(this._viewInverseTransposeMatrix,
this.viewMatrix),k.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"aboveGround",{get:function(){return 0<=this.relativeElevation},enumerable:!0,configurable:!0});q.prototype.copyFrom=
function(b){k.vec3.copy(this._eye,b._eye);k.vec3.copy(this._center,b._center);k.vec3.copy(this._up,b._up);k.vec4.copy(this._viewport,b._viewport);k.vec4.copy(this._padding,b._padding);this._near=b._near;this._far=b._far;this._fov=b._fov;this.relativeElevation=b.relativeElevation;b._viewDirty?this._viewDirty=!0:(k.mat4.copy(this._viewMatrix,b._viewMatrix),k.vec3.copy(this._viewRight,b._viewRight),k.vec3.copy(this._viewUp,b._viewUp),k.vec3.copy(this._viewForward,b._viewForward),this._viewDirty=!1);
b._projectionDirty?this._projectionDirty=!0:(k.mat4.copy(this._projectionMatrix,b._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;b._frustumDirty?this._frustumDirty=!0:(a.frustum.copy(b._frustum,this._frustum),this._frustumDirty=!1);b._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?k.mat4.copy(this._viewInverseTransposeMatrix,b._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=k.mat4f64.clone(b._viewInverseTransposeMatrix),
this._viewInverseTransposeMatrixDirty=!1);b._fullViewport?this._fullViewport?k.vec4.copy(this._fullViewport,b._fullViewport):this._fullViewport=k.vec4f64.clone(b._fullViewport):this._fullViewport=null;return this};q.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};q.prototype.copy=function(){var a=new q;a.copyFrom(this);return a};q.prototype.equivalent=function(a){return c(this._eye,a._eye)&&c(this._center,a._center)&&c(this._up,a._up)&&d(this._viewport,a._viewport)&&
d(this._padding,a._padding)&&this._near===a._near&&this._far===a._far&&this._fov===a._fov};q.prototype.almostEquals=function(a,b,c){void 0===c&&(c=!1);b=k.vec3.distance(this._eye,this._center)*(b||5E-4);b*=b;c?(g.directionFromTo(h,a._eye,a._center),g.directionFromTo(n,this._eye,this._center),c=1E-10):(k.vec3.copy(h,a._center),k.vec3.copy(n,this._center),c=b);return k.vec3.squaredDistance(a._eye,this._eye)<b&&k.vec3.squaredDistance(h,n)<c&&.001>Math.abs(a._fov-this._fov)&&.5>e(a._padding,this._padding)&&
.5>e(a._viewport,this._viewport)};q.prototype.markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};q.prototype.computePixelSizeAt=function(a){return this.computePixelSizeAtDist(k.vec3.distance(a,this._eye))};q.prototype.computePixelSizeAtDist=function(a){return 2*a*Math.tan(this.fovX/2)/this.width};q.prototype.computeDistanceFromRadius=function(a,b){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(b||1)))};q.prototype.setGLViewport=function(a){var b=this.viewport,
c=this.padding;a.setViewport(b[0]-c[3],b[1]-c[2],b[2]+c[1]+c[3],b[3]+c[0]+c[2])};q.prototype.applyProjection=function(a,b,c){void 0===c&&(c=!1);a!==m&&k.vec3.copy(m,a);m[3]=1;c&&(b[2]=-m[2]);k.vec4.transformMat4(m,m,this.projectionMatrix);k.vec3.scale(m,m,1/Math.abs(m[3]));a=this.fullViewport;b[0]=g.lerp(0,a[0]+a[2],.5+.5*m[0]);b[1]=g.lerp(0,a[1]+a[3],.5+.5*m[1]);c||(b[2]=.5*(m[2]+1));return b};q.prototype.projectPoint=function(a,b){m[0]=a[0];m[1]=a[1];m[2]=a[2];m[3]=1;k.vec4.transformMat4(m,m,this.viewProjectionMatrix);
if(0===m[3])return null;k.vec3.scale(m,m,1/Math.abs(m[3]));a=this.fullViewport;b[0]=g.lerp(0,a[0]+a[2],.5+.5*m[0]);b[1]=g.lerp(0,a[1]+a[3],.5+.5*m[1]);b[2]=.5*(m[2]+1);return b};q.prototype.unprojectPoint=function(a,b){k.mat4.multiply(l,this.projectionMatrix,this.viewMatrix);if(!k.mat4.invert(l,l))return null;var c=this.fullViewport;m[0]=2*(a[0]-c[0])/c[2]-1;m[1]=2*(a[1]-c[1])/c[3]-1;m[2]=2*a[2]-1;m[3]=1;k.vec4.transformMat4(m,m,l);if(0===m[3])return null;b[0]=m[0]/m[3];b[1]=m[1]/m[3];b[2]=m[2]/m[3];
return b};q.prototype.computeUp=function(a){"global"===a?this.computeUpGlobal():this.computeUpLocal()};q.prototype.computeUpGlobal=function(){k.vec3.subtract(h,this.center,this.eye);var a=k.vec3.length(this.center);1>a?(k.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(k.vec3.dot(h,this.center))>.9999*k.vec3.length(h)*a||(k.vec3.cross(this.up,h,this.center),k.vec3.cross(this.up,this.up,h),k.vec3.normalize(this.up,this.up),this.markViewDirty())};q.prototype.computeUpLocal=function(){g.directionFromTo(h,
this.eye,this.center);.9999>=Math.abs(h[2])&&(k.vec3.scale(h,h,h[2]),k.vec3.set(this.up,-h[0],-h[1],1-h[2]),k.vec3.normalize(this.up,this.up),this.markViewDirty())};q.prototype._compareAndSetView=function(a,b){c(a,b)||(k.vec3.copy(b,a),this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0)};q.prototype._recomputeFrustum=function(){this._frustumDirty&&(a.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};q.prototype._ensureViewClean=function(){this._viewDirty&&
(k.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),k.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),k.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),k.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return q}();var m=k.vec4f64.create(),l=k.mat4f64.create(),h=k.vec3f64.create(),n=k.vec3f64.create();return p})},
"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});var e={zoom:0,pan:0,rotate:0};p=function(){function c(c){this.createCamera=c;this.time=0;this.definition=new a.Definition(c);this.path=new b.Path}c.prototype.update=function(a,b,c){this.definition.update(a,b,c);this.path.update(this.definition,c);this.time=this._applyTimeSettings(this.path.time,
c);this.settings=c};c.prototype.cameraAt=function(a,b){b=b||this.createCamera();a=Math.min(Math.max(0,a),1);a=this.settings.easing?this.normalizedEasing(this.settings.easing,a,1E3*this.time):1<=this.time?this.normalizedEasing(k.inOutCoastQuad,a):this.normalizedEasing(k.outExpo,a);a=this.path.interpolateComponentsAt(a,e);b.interpolate(this.definition.source,this.definition.target,a);return b};c.prototype.normalizedEasing=function(a,b,c){c=a(0);var d=a(1);return(a(b)-c)/(d-c)};c.prototype._applyTimeSettings=
function(a,b){var c=null!=b.speedFactor?b.speedFactor:1;null!=b.duration?a=b.duration:null!=b.speedFactor&&(a/=c);return a=Math.min(Math.max(null!=b.minDuration?b.minDuration:g.defaultSettings.minDuration/c,a),null!=b.maxDuration?b.maxDuration:g.defaultSettings.maxDuration/c)};return c}();f.Animation=p;f.default=p})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function a(a){this.createCamera=
a;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:k.defaultSettings.desiredScreenFlow};this.source=a();this.target=a()}a.prototype.clone=function(){var g=new a(this.createCamera);g.copyFrom(this);return g};a.prototype.copyFrom=function(a){this.update(a.source,a.target,a.settings)};a.prototype.update=function(a,b,e){this.source!==a&&this.source.copyFrom(a);this.target!==b&&this.target.copyFrom(b);this.compared=this.source.compareTo(this.target,this.compared);
this.settings.desiredScreenFlow=null!=e.desiredScreenFlow?e.desiredScreenFlow:k.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};a.prototype.halfWindowPanAtZoom=function(a){a=this.target.pixelsPerPanAtZoom(a);return this.halfWindowSize/a};Object.defineProperty(a.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,configurable:!0});return a}();f.Definition=p;f.default=p})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),
function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(c){function d(a,d){var e=c.call(this)||this;e._preallocSegments=[new b.default,new b.default,new b.default];e.update(a,d);return e}k(d,c);d.prototype.update=function(a,b){if(a){this.definition?this.definition.copyFrom(a):this.definition=a.clone();var c=null;b&&b.apex&&(c=e.optimalDistance(a,b.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==c?this._updateWithoutApex():this._updateWithApex(c,
b.apex)}};d.prototype.segmentInterpolateComponentsAt=function(b,c,d){d=b.interpolateComponentsAt(c,d);b===this._ascensionSegment?d.zoom=a.outQuad(d.zoom):b===this._descensionSegment&&(d.zoom=a.inQuad(d.zoom));return d};d.prototype._updateWithApex=function(a,b){var c=this._preallocSegments,d=c[0],e=c[1],c=c[2],l=null!=b.ascensionFactor?b.ascensionFactor:.5;b=Math.min(1-l,null!=b.ascensionFactor?b.descensionFactor:.5);var m=1-l-b;d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();
d.definition.compared.targetZoom=a;d.definition.compared.pan=this.definition.compared.pan*l;d.definition.compared.rotate=this.definition.compared.rotate*l;d.update();this._ascensionSegment=d;this.segments.push(d);0<m&&(e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone(),e.definition.copyFrom(this.definition),e.definition.compared.sourceZoom=a,e.definition.compared.targetZoom=a,e.definition.compared.pan=this.definition.compared.pan*m,e.definition.compared.rotate=
this.definition.compared.rotate*m,e.update(),this.segments.push(e));c.definition?c.definition.copyFrom(this.definition):c.definition=this.definition.clone();c.definition.compared.sourceZoom=a;c.definition.compared.pan=this.definition.compared.pan*b;c.definition.compared.rotate=this.definition.compared.rotate*b;c.update();this._descensionSegment=c;this.segments.push(c)};d.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return d}(g.default);
f.Path=p;f.default=p})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function k(){this.segments=[]}Object.defineProperty(k.prototype,"time",{get:function(){return this.segments.reduce(function(a,g){return a+g.time},0)},enumerable:!0,configurable:!0});k.prototype.interpolateComponentsAt=function(a,g){a=Math.min(Math.max(a,0),1);a*=this.time;for(var b=0,e=0,c=this.definition,d=0;d<this.segments.length;d++){var m=
this.segments[d],l=m.definition;if(a<=m.time||d===this.segments.length-1)return g=this.segmentInterpolateComponentsAt(m,a/m.time,g),g.pan=c.hasPan?(b+l.compared.pan*g.pan)/c.compared.pan:1,g.rotate=c.hasRotate?(e+l.compared.rotate*g.rotate)/c.compared.rotate:1,a=g.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,b=this.segments[0].definition.compared.sourceZoom,e=this.segments[this.segments.length-1].definition.compared.targetZoom,g.zoom=c.hasZoom?(a-b)/(e-b):1,g;a-=m.time;
b+=l.compared.pan;e+=l.compared.rotate}};k.prototype.segmentInterpolateComponentsAt=function(a,g,b){return a.interpolateComponentsAt(g,b)};return k}();f.Path=p;f.default=p})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function k(a){a&&this.update(a)}k.prototype.update=function(a){a&&(this.definition?this.definition.copyFrom(a):this.definition=a.clone());this._updatePrecomputedVariables();
this._updatePixelFlow()};k.prototype._updatePrecomputedVariables=function(){var a=this.definition,g=a.compared,b=g.sourceZoom,e=g.targetZoom;this._zoomSign=b>e?1:-1;this._panPixelsAtSource=g.pan*a.source.pixelsPerPanAtZoom(b);a=(a.source.pixelsPerRotateAtZoom(b)+a.target.pixelsPerRotateAtZoom(e))/2;this._rotatePixels=g.rotate*a};k.prototype._updatePixelFlow=function(){var a=this.definition.compared.sourceZoom,g=this.definition.compared.targetZoom,b=this.definition,e=b.hasZoom,c=b.hasPan,b=b.hasRotate,
d=0,m=0;e&&(c&&(d=(g/a-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),b&&(m=Math.log(a/g)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;a=this.definition.desiredPixelFlow;e&&c&&b?(g=d+m+d*m,this._zoomPixelFlow=d*m/g*a,this._panPixelFlow=m/g*a,this._rotatePixelFlow=d/g*a):e&&c?(g=1+d,this._zoomPixelFlow=d/g*a,this._panPixelFlow=1/g*a):e&&b?(g=1+m,this._zoomPixelFlow=
m/g*a,this._rotatePixelFlow=1/g*a):c&&b?(d=this._panPixelsAtSource/this._rotatePixels,g=1+d,this._panPixelFlow=d/g*a,this._rotatePixelFlow=1/g*a):c?this._panPixelFlow=a:e?this._zoomPixelFlow=a:b&&(this._rotatePixelFlow=a);this.time=b?this.rotateTime:e?this.zoomTime:c?this.panTime:0};Object.defineProperty(k.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/
this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var a=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*a+1)/(a*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?
this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});k.prototype._interpolateComponentsZoom=function(a){if(0===a||1===a)return a;if(this.definition.hasZoom){var g=this.definition.compared.sourceZoom,b=this.definition.compared.targetZoom;return(g*Math.pow(g/b,-a)-g)/(b-g)}return a};k.prototype._interpolateComponentsPan=function(a){if(0===a||1===a)return a;if(this.definition.hasPan&&this.definition.hasZoom){var g=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;
return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,g*a*this.time)-1)/(g*Math.LN2)}return a};k.prototype._interpolateComponentsRotate=function(a){return a};k.prototype.interpolateComponentsAt=function(a,g){a=Math.min(Math.max(a,0),1);var b=this._interpolateComponentsZoom(a),e=this._interpolateComponentsPan(a);a=this._interpolateComponentsRotate(a);g?(g.zoom=b,g.pan=e,g.rotate=a):g={zoom:b,pan:e,rotate:a};return g};return k}();f.Segment=p;f.default=p})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require",
"exports","./functions"],function(p,f,k){function a(a,b){var e=Math.max(a.compared.sourceZoom,a.compared.targetZoom);a=a.source.zoomAtPixelsPerPan(a.desiredPixelFlow/a.compared.pan)/2;return a<e?null!=b.maximumDistance?e+(b.maximumDistance-e)/2:1.5*e:b.maximumDistance?Math.min(b.maximumDistance,a):a}Object.defineProperty(f,"__esModule",{value:!0});f.optimalDistance=function(g,b){var e=a(g,b),c={ascensionFactor:null!=b.ascensionFactor?b.ascensionFactor:.5,descensionFactor:null!=b.descensionFactor?
b.descensionFactor:.5},d=0===c.ascensionFactor,m=0===c.descensionFactor,l=d?k.tAscensionZoomOnly:k.tAscensionZoomPan,h=d?k.dtAscensionZoomOnly:k.dtAscensionZoomPan,n=d?k.ddtAscensionZoomOnly:k.ddtAscensionZoomPan,q=m?k.tDescensionZoomOnly:k.tDescensionZoomPan,t=m?k.dtDescensionZoomOnly:k.dtDescensionZoomPan,f=m?k.ddtDescensionZoomOnly:k.ddtDescensionZoomPan,d=function(a){return l(g,c,a)+k.tPanion(g,c,a)+q(g,c,a)},m=function(a){return h(g,c,a)+k.dtPanion(g,c,a)+t(g,c,a)},r=function(a){return n(g,c,
a)+k.ddtPanion(g,c,a)+f(g,c,a)},y=d(e),x=k.tBaseLine(g),z=b.maximumIterations||20,w=null!=b.maximumDistance?b.maximumDistance:Infinity;for(b=0;b<z;b++){var B=(m(e)+1E-6)/r(e);if(isNaN(B)||e>=w&&0>B){if(!isFinite(w))return null;e=w;y=d(e);break}e-=B;if(e<g.compared.sourceZoom||e<g.compared.targetZoom)return null;B=d(e);if(.005>=Math.abs(B-y)/y)break;y=B}return y>.7*x?null:e<g.compared.sourceZoom||e<g.compared.targetZoom?null:e}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require",
"exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.tAscensionZoomPan=function(k,a,g){var b=k.halfWindowPanAtZoom(g-k.compared.sourceZoom);return-k.halfWindowSize*(a.ascensionFactor*Math.LN2*k.compared.pan+b)*Math.log(k.compared.sourceZoom/g)/(k.desiredPixelFlow*Math.LN2*b)};f.dtAscensionZoomPan=function(k,a,g){var b=1/g,e=Math.log(k.compared.sourceZoom*b),c=1/k.desiredPixelFlow,d=1/Math.LN2;g-=k.compared.sourceZoom;var m=1/g;a=(a.ascensionFactor*Math.LN2*k.compared.pan+k.halfWindowPanAtZoom(g))/
k.halfWindowPanAtZoom(1);return k.halfWindowSize*b*c*d*m*a-k.halfWindowSize*e*c*d*m+k.halfWindowSize*e*c*d*a/(g*g)};f.ddtAscensionZoomPan=function(k,a,g){var b=g-k.compared.sourceZoom,e=1/b,c=1/g,d=Math.log(k.compared.sourceZoom*c);a=(a.ascensionFactor*Math.LN2*k.compared.pan+k.halfWindowPanAtZoom(b))/k.halfWindowPanAtZoom(1);return k.halfWindowSize*e*(-2*e*c*a+2*e*d+2*c-2*d*a/(b*b)-a/(g*g))/(k.desiredPixelFlow*Math.LN2)};f.tAscensionZoomOnly=function(k,a,g){return-k.halfWindowSize*Math.log(k.compared.sourceZoom/
g)/(k.desiredPixelFlow*Math.LN2)};f.dtAscensionZoomOnly=function(k,a,g){return k.halfWindowSize/(g*k.desiredPixelFlow*Math.LN2)};f.ddtAscensionZoomOnly=function(k,a,g){return-k.halfWindowSize/(g*g*k.desiredPixelFlow*Math.LN2)};f.tPanion=function(k,a,g){return-k.compared.pan*k.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(k.desiredPixelFlow*k.halfWindowPanAtZoom(g))};f.dtPanion=function(k,a,g){return k.compared.pan*k.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(k.desiredPixelFlow*
k.halfWindowPanAtZoom(g*g))};f.ddtPanion=function(k,a,g){return-2*k.compared.pan*k.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(k.desiredPixelFlow*k.halfWindowPanAtZoom(g*g*g))};f.tDescensionZoomPan=function(k,a,g){return k.halfWindowSize*(-k.halfWindowPanAtZoom(g)-a.descensionFactor*Math.LN2*k.compared.pan+k.halfWindowPanAtZoom(k.compared.targetZoom))*Math.log(g/k.compared.targetZoom)/(k.desiredPixelFlow*Math.LN2*k.halfWindowPanAtZoom(-g+k.compared.targetZoom))};f.dtDescensionZoomPan=
function(k,a,g){var b=Math.log(g/k.compared.targetZoom),e=1/k.desiredPixelFlow,c=1/Math.LN2,d=-g+k.compared.targetZoom,m=1/d;a=(-k.halfWindowPanAtZoom(g)-a.descensionFactor*Math.LN2*k.compared.pan+k.halfWindowPanAtZoom(k.compared.targetZoom))/k.halfWindowPanAtZoom(1);return-k.halfWindowSize*b*e*c*m+k.halfWindowSize*b*e*c*a/(d*d)+k.halfWindowSize*e*c*m*a/g};f.ddtDescensionZoomPan=function(k,a,g){var b=g-k.compared.targetZoom,e=1/b,c=1/g,d=Math.log(g/k.compared.targetZoom);a=(k.halfWindowPanAtZoom(g)+
a.descensionFactor*Math.LN2*k.compared.pan-k.halfWindowPanAtZoom(k.compared.targetZoom))/k.halfWindowPanAtZoom(1);return k.halfWindowSize*e*(-2*e*c*a-2*e*d+2*c+2*d*a/(b*b)-a/(g*g))/(k.desiredPixelFlow*Math.LN2)};f.tDescensionZoomOnly=function(k,a,g){return k.halfWindowSize*Math.log(g/k.compared.targetZoom)/(k.desiredPixelFlow*Math.LN2)};f.dtDescensionZoomOnly=function(k,a,g){return k.halfWindowSize/(g*k.desiredPixelFlow*Math.LN2)};f.ddtDescensionZoomOnly=function(k,a,g){return-k.halfWindowSize/(g*
g*k.desiredPixelFlow*Math.LN2)};f.tBaseLine=function(k){var a=Math.LN2*k.compared.pan,g=k.halfWindowPanAtZoom(k.compared.sourceZoom-k.compared.targetZoom),b=k.halfWindowSize*Math.log(k.compared.sourceZoom/k.compared.targetZoom)/(k.desiredPixelFlow*Math.LN2*g);return k.compared.sourceZoom<=k.compared.targetZoom?b*(a-g):b*(a+g)}})},"esri/views/3d/state/controllers/AnimationController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../ViewAnimation","./CameraController"],
function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function e(c){void 0===c&&(c=new a);var d=b.call(this)||this;d.viewAnimation=c;return d}k(e,b);Object.defineProperty(e.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(a){this._asyncResult&&this._asyncResult.reject();this._asyncResult=a;if(this.state===g.State.Finished||this.state===g.State.Stopped)this._asyncResult=
null,this.state===g.State.Finished?a.resolve():a.reject()},enumerable:!0,configurable:!0});e.prototype.onControllerStart=function(a){var c=this;b.prototype.onControllerStart.call(this,a);this.viewAnimation&&this.viewAnimation.when().catch(function(){}).then(function(){c.updateStateFromViewAnimation()})};e.prototype.updateStateFromViewAnimation=function(){!this.viewAnimation||this.state!==g.State.Ready&&this.state!==g.State.Running||(this.viewAnimation.state===a.State.FINISHED?this.finish():this.viewAnimation.state===
a.State.STOPPED&&(this.state=g.State.Stopped))};e.prototype.onControllerEnd=function(a){this.viewAnimation&&(this.viewAnimation.done||(this.state===g.State.Finished?this.viewAnimation.finish():this.state===g.State.Stopped&&this.viewAnimation.stop()));this._asyncResult&&(this.state===g.State.Finished?this._asyncResult.resolve():this._asyncResult.reject());b.prototype.onControllerEnd.call(this,a)};e.prototype.finish=function(){this.finishController()};return e}(g.CameraController);f.AnimationController=
p})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});var e;(function(a){a.Ready="ready";a.Rejected="rejected";a.Running="running";a.Stopped="stopped";a.Finished="finished"})(e=f.State||(f.State={}));p=function(c){function d(){var a=
null!==c&&c.apply(this,arguments)||this;a.state=e.Ready;return a}k(d,c);Object.defineProperty(d.prototype,"active",{get:function(){return this.state===e.Running},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isInteractive",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"canStop",{get:function(){return!1},enumerable:!0,configurable:!0});d.prototype.stopController=function(){return this.canStop?(this.state=e.Stopped,!0):!1};d.prototype.finishController=
function(){this.state=e.Finished};d.prototype.onControllerStart=function(a){this.state=e.Running};d.prototype.onControllerEnd=function(a){};d.prototype.stepController=function(a,b){};Object.defineProperty(d.prototype,"steppingFinished",{get:function(){return!1},enumerable:!0,configurable:!0});a([b.property({readOnly:!0,dependsOn:["state"]})],d.prototype,"active",null);a([b.property()],d.prototype,"state",void 0);return d=a([b.subclass()],d)}(b.declared(g));f.CameraController=p})},"esri/views/3d/state/utils/navigationUtils":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../support/geometryUtils/coordinateSystem ../../webgl-engine/lib/Camera".split(" "),
function(p,f,k,a,g,b,e,c,d){function m(a,b,c){var d=e.sm4d.get();k.mat4.identity(d);k.mat4.rotate(d,d,c[3],c);k.vec3.subtract(a.eye,a.eye,b);k.vec3.transformMat4(a.eye,a.eye,d);k.vec3.add(a.eye,a.eye,b);k.vec3.subtract(a.center,a.center,b);k.vec3.transformMat4(a.center,a.center,d);k.vec3.add(a.center,a.center,b);k.vec3.transformMat4(a.up,a.up,d);a.markViewDirty()}function l(a,b){k.vec3.set(b,0,0,0);for(var c=0;c<a.length;c++)k.vec3.add(b,b,a[c]);k.vec3.scale(b,b,1/a.length)}function h(b,c,d){return Math.sin(b/
k.vec3.length(c))*(d+a.earthRadius)}function n(a,b,c,d){c=g.ray.fromScreenAtEye(b,c,aa);g.sphere.closestPointOnSilhouette(a,c,H);return g.sphere.intersectRay(a,c,d)?k.vec3.squaredDistance(H,c.origin)<k.vec3.squaredDistance(d,c.origin)?(k.vec3.copy(d,H),!1):!0:(k.vec3.subtract(I,b.eye,b.center),k.vec3.normalize(I,I),g.plane.fromNormalAndOffset(I,-k.vec3.dot(k.vec3.normalize(I,I),H),N),g.plane.intersectRay(N,c,d),!1)}function q(a,c,d,e,h,l){k.vec3.cross(ia,a,c);k.vec3.subtract(da,a,c);k.vec3.length(a)<=
h||!e.aboveGround?(k.vec3.cross(d,da,e.eye),a=k.vec3.dot(a,c)/(k.vec3.length(a)*k.vec3.length(c)),l=Math.cos(b.clamp(b.cyclicalPI.normalize(b.deg2rad(l)),0,f.TiltThresholdPanningSpeed)),c=-b.acos(a)-Math.max(0,k.vec3.length(c)-h)/(l*h)):(k.vec3.subtract(S,e.eye,e.center),k.vec3.cross(d,da,S),c=-k.vec3.length(da)/h);k.vec3.normalize(d,d);k.vec3.scale(d,d,k.vec3.length(ia));return c}function t(a,c,d,e){e=Math.cos(b.clamp(b.cyclicalPI.normalize(b.deg2rad(e)),0,f.TiltThresholdPanningSpeed));c=c>d?-(c-
d)/(e*d):c<-d?Math.PI-(c+d)/(e*d):b.acos(c/d);return((a>d?-(a-d)/(e*d):a<-d?Math.PI-(a+d)/(e*d):b.acos(a/d))-c)*d}function u(a,b,c,d,e,h,l,m,g,n){g=t(a[2],b[2],l.radius,g);b=n?t(a[0],b[0],l.radius,180):b[0]-a[0];a=Math.sin(m)*b-Math.cos(m)*g;m=Math.cos(m)*b+Math.sin(m)*g;k.vec3.normalize(Z,e);e=n?a/Math.sqrt(Math.abs(Math.pow(l.radius,2)-Math.pow(k.vec3.dot(c,Z),2))):a/l.radius;c=m/Math.sqrt(Math.abs(Math.pow(l.radius,2)-Math.pow(k.vec3.dot(c,d),2)));k.vec2.set(h,e,c)}function r(a,b,d,e,h,l,m,g,n,
q){k.vec3.cross(ia,a,b);c.coordinateSystemFromOneAxisAndNormalVector(l.up,l.eye,W,Q,J);c.coordinateSystemFromOneAxisAndNormalVector([0,0,1],l.eye,M,P,O);k.vec3.copy(d,P);k.vec3.copy(e,M);k.vec3.normalize(d,d);k.vec3.scale(d,d,k.vec3.length(ia));c.vectorCoordinates(a,k.vec3.normalize(Q,Q),k.vec3.normalize(J,J),k.vec3.normalize(W,W),F);c.vectorCoordinates(b,Q,J,W,K);u(F,K,a,M,P,h,m,g,n,q)}function y(a,b,c,d,e,h,l){k.mat4.identity(R);k.mat4.identity(X);k.mat4.identity(ba);k.mat4.rotate(R,R,e,d);k.mat4.rotate(X,
X,l,h);k.mat4.multiply(ba,R,X);k.vec3.subtract(b,a,c);k.vec3.transformMat4(b,b,ba);k.vec3.add(b,b,c)}function x(a,b,c,d,e,h){k.mat4.identity(R);k.mat4.identity(X);k.mat4.identity(ba);k.mat4.rotate(R,R,d,c);k.mat4.rotate(X,X,h,e);k.mat4.multiply(ba,R,X);k.vec3.subtract(a.eye,a.eye,b);k.vec3.transformMat4(a.eye,a.eye,ba);k.vec3.add(a.eye,a.eye,b);k.vec3.subtract(a.center,a.center,b);k.vec3.transformMat4(a.center,a.center,ba);k.vec3.add(a.center,a.center,b);k.vec3.subtract(a.up,a.up,b);k.vec3.transformMat4(a.up,
a.up,ba);k.vec3.add(a.up,a.up,b);a.markViewDirty()}function z(a,b,c,d,e,h,l,m){a=Math.abs(a[2])<c*d||Math.abs(b)>c;return(Math.abs(h)>Math.PI-e||Math.abs(h)<e)&&a&&m.aboveGround&&l<f.PreservingHeadingThreshold.Tilt?!0:!1}function w(a,b,c,d,e,h){h?(g.axisAngle.fromPoints(c,d,T),m(b,a.center,T)):(c=q(c,d,ea,b,a.radius,e),m(b,a.center,g.axisAngle.wrapAxisAngle(ea,c)))}function B(a,b,c,d,e,h,l){var m=l?20:1;k.vec3.copy(ca,d);U.copyFrom(b);for(var g,n=0;n<m&&1E-12<k.vec3.squaredDistance(c,ca);n++)if(d=
k.vec3.squaredDistance(c,ca),r(c,ca,P,M,L,U,a,e,h,l),x(U,a.center,M,L[1],P,L[0]),y(ca,ca,a.center,M,L[1],P,L[0]),g=k.vec3.squaredDistance(c,ca),g<d||0===n)b.copyFrom(U);else break}Object.defineProperty(f,"__esModule",{value:!0});f.Earth=g.sphere.fromValues(a.earthRadius,k.vec3f64.create());f.normalizeCoordinate=function(a,b,c){c[0]=b[0]/a.fullWidth;c[1]=b[1]/a.fullHeight;return c};f.sphereOrSilhouettePointFromScreenPoint=function(a,b,c,d){b=g.ray.fromScreenAtEye(b,c,aa);c=g.sphere.intersectRay(a,
b,d);a=g.sphere.closestPointOnSilhouette(a,b,e.sv3d.get());return!c||k.vec3.squaredDistance(a,b.origin)<k.vec3.squaredDistance(d,b.origin)?(k.vec3.copy(d,a),!1):!0};f.rotationFromPointsAroundAxis=function(a,b,c){var d=e.sv3d.get(),h=e.sv3d.get(),l=e.sv3d.get();k.vec3.copy(h,a);k.vec3.copy(l,b);a=k.vec3.dot(h,c);b=k.vec3.dot(l,c);k.vec3.scale(d,c,a);k.vec3.subtract(h,h,d);k.vec3.normalize(h,h);k.vec3.scale(d,c,b);k.vec3.subtract(l,l,d);k.vec3.normalize(l,l);a=k.vec3.dot(h,l);k.vec3.cross(d,c,h);c=
k.vec3.dot(l,d);return Math.atan2(c,a)};f.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};f.applyRotation=m;f.intersectPlaneFromScreenPoint=function(a,b,c,d){return g.plane.intersectRay(a,g.ray.fromScreen(b,c,aa),d)};f.applyZoomToPoint=function(a,b,c,d){var h=e.sv3d.get();c=1-c;k.vec3.subtract(h,b,a.eye);var l=k.vec3.length(h),m=l*(1-c);0<=c&&m<d&&(m=d,c=-(m-l)/l);1E-6>Math.abs(l-m)||(k.vec3.scale(h,h,c),k.vec3.add(a.eye,a.eye,h),k.vec3.lerp(a.center,
a.center,b,c))};f.applyZoomOnSphere=function(a,b,c){k.vec2.set(C,b.padding[3]+b.width/2,b.padding[2]+b.height/2);g.sphere.intersectScreen(a,b,C,b.center);b.markViewDirty();a=b.distance;c*=a;1E-6>Math.abs(a-c)||(c=k.vec3.scale(e.sv3d.get(),b.viewForward,c),k.vec3.subtract(b.eye,b.center,c),b.markViewDirty())};var C=k.vec2f64.create();f.navPointToScreenPoint=function(a,b,c){k.vec2.set(c,b.x,a.fullHeight-b.y)};f.centroidOnSphere=function(a,b,c){l(b,c);k.vec3.normalize(c,c);k.vec3.scale(c,c,a)};f.centroid=
l;f.onSurfaceTiltToEyeTiltGlobal=h;f.offSurfaceTiltToEyeTiltGlobal=function(a,b,c){return h(Math.PI/2,b,c)+(a-Math.PI/2)};var D;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(D=f.PanMode||(f.PanMode={}));f.VerticalPanTresholds={Elevation:3E4,Angle:b.deg2rad(8)};f.PreservingHeadingThreshold={Pole:.95,Angle:b.deg2rad(18),Tilt:80};f.TiltThresholdPanningSpeed=b.deg2rad(80);f.pickPointAndInitSphere=function(a,b,c,d){var e=k.vec3f64.create(),h=g.sphere.create(),l=!0;a.intersectScreen(c,
e)?h.radius=k.vec3.length(e):(h.radius=b.aboveGround?Math.max(k.vec3.length(b.center),.9*f.Earth.radius):k.vec3.length(b.eye)-b.relativeElevation,d?n(h,b,c,e):l=g.sphere.intersectScreen(h,b,c,e));return{sphere:h,scenePickPoint:l?e:null}};f.decidePanMode=function(a,c,d){var e=k.vec3.length(a.eye);if(Math.abs(e-f.Earth.radius)>f.VerticalPanTresholds.Elevation)return D.Horizontal;if(a.aboveGround===c.radius>e)return D.Vertical;k.vec3.subtract(E,a.eye,d);k.vec3.normalize(E,E);return Math.abs(.5*Math.PI-
b.acos(k.vec3.dot(d,E)/k.vec3.length(d)))<f.VerticalPanTresholds.Angle?D.Vertical:D.Horizontal};var E=k.vec3f64.create();f.applyPanPlanar=function(a,b,c){k.vec3.subtract(G,c,b);k.vec3.subtract(a.eye,a.eye,G);k.vec3.subtract(a.center,a.center,G);a.markViewDirty()};var G=k.vec3f64.create();f.sphereOrPlanePointFromScreenPoint=n;var H=k.vec3f64.create(),I=k.vec3f64.create(),N=g.plane.create();f.rotationAngleAndAxisDirectRotation=q;var S=k.vec3f64.create();f.lengthFromPoints=t;f.rotationAnglesHeadingPreserving=
u;f.rotationAnglesAndAxesHeadingPreserving=r;f.rotatePointAroundTwoAxes=y;f.applyRotationWithTwoAxes=x;f.preserveHeadingThreshold=z;f.applyPanSphericalDirectRotation=w;f.applyPanSphericalPreserveHeading=B;f.panToPosition=function(a,c,d,e,h,l,m){z(d,k.vec3.dot(c.up,d),a.radius,f.PreservingHeadingThreshold.Pole,f.PreservingHeadingThreshold.Angle,-b.cyclicalPI.normalize(b.deg2rad(h)),l,c)?B(a,c,d,e,-b.cyclicalPI.normalize(b.deg2rad(h)),l,m):w(a,c,d,e,l,m)};var M=k.vec3f64.create(),P=k.vec3f64.create(),
O=k.vec3f64.create(),W=k.vec3f64.create(),Q=k.vec3f64.create(),J=k.vec3f64.create(),F=k.vec3f64.create(),K=k.vec3f64.create(),L=k.vec2f64.create(),T=g.axisAngle.create(),R=k.mat4f64.create(),X=k.mat4f64.create(),ba=k.mat4f64.create(),ca=k.vec3f64.create(),Z=k.vec3f64.create(),da=k.vec3f64.create(),U=new d,ia=k.vec3f64.create(),ea=k.vec3f64.create(),aa={origin:k.vec3f64.create(),direction:k.vec3f64.create()}})},"esri/views/3d/support/geometryUtils/coordinateSystem":function(){define(["require","exports",
"../../../../core/libs/gl-matrix-2/gl-matrix"],function(p,f,k){function a(a){return{operations:a,value:a.create()}}function g(a,b,c,e){return a.operations.setAltitudeAt(a.value,b,c,e)}Object.defineProperty(f,"__esModule",{value:!0});f.create=function(a){var b=a.operations;return{operations:b,value:b.create(a.value)}};f.setExtent=function(a,b,c){a.operations.setExtent(a.value,b,c.value);return c};f.createFromOperations=a;f.fromValues=function(b,c,e){void 0===e&&(e=a(b));e.operations=b;b.copy(c,e.value);
return e};f.wrap=function(a,b){e.operations=a;e.value=b;return e};f.normalAt=function(a,b,c){return a.operations.axisAt(a.value,b,2,c)};f.axisAt=function(a,b,c,e){return a.operations.axisAt(a.value,b,c,e)};f.intersectRay=function(a,b,c){return a.operations.intersectRay(a.value,b,c)};f.intersectsRay=function(a,b){return a.operations.intersectRay(a.value,b,null)};f.closestPoint=function(a,b,c){return a.operations.closestPoint(a.value,b,c)};f.intersectRayClosestSilhouette=function(a,b,c){return a.operations.intersectRayClosestSilhouette(a.value,
b,c)};f.closestPointOnSilhouette=function(a,b,c){return a.operations.closestPointOnSilhouette(a.value,b,c)};f.distanceToSilhouette=function(a,b){return a.operations.distanceToSilhouette(a.value,b)};f.altitudeAt=function(a,b){return a.operations.altitudeAt(a.value,b)};f.setAltitudeAt=g;f.setAltitudeOfTransformation=function(a,c,e,h){c!==h&&k.mat4.copy(h,c);k.vec3.set(b,h[12],h[13],h[14]);g(a,b,e,b);h[12]=b[0];h[13]=b[1];h[14]=b[2];return h};f.elevate=function(a,b,c){return a.operations.elevate(a.value,
b,c.value)};var b=k.vec3f64.create(),e={operations:null,value:null};f.vectorCoordinates=function(a,b,c,e,g){g[0]=k.vec3.dot(a,b);g[1]=k.vec3.dot(a,c);g[2]=k.vec3.dot(a,e);return g};f.coordinateSystemFromOneAxisAndNormalVector=function(a,b,e,h,g){k.vec3.copy(e,a);k.vec3.copy(c,b);k.vec3.normalize(c,c);k.vec3.cross(h,c,e);k.vec3.cross(g,h,e)};var c=k.vec3f64.create()})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../camera/constraintUtils ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function d(c,d){var h=b.call(this,c.state,c.sceneIntersectionHelper,"interaction"===d?null:void 0)||this;h.view=c;h.mode=d;h.zoomLocation=a.vec3f64.create();h.tmpCamera=new e;h.tmpRayDir=a.vec3f64.create();h.tmpCenter=a.vec3f64.create();h.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new e,interactionDirection:null,tiltMode:0};return h}k(d,b);Object.defineProperty(d.prototype,
"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});d.prototype.zoomStep=function(b,c){if(this.active){var d=this.view.state,e=this.constraintOptions.interactionStartCamera;this.animation.finished?e.copyFrom(d.camera):this.animation.cameraAt(1,e);this.tmpCamera.copyFrom(d.camera);0<b?(this.intersectionHelper.intersectScreenFreePointFallback(c,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.tmpCenter)&&(this.tmpCamera.center=
this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:a.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,b),this.zoomLocation,c);this.begin(this.tmpCamera)}};d.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:c.outExpo}};d.prototype.updateCamera=function(b,c,d,e){a.vec3.subtract(this.tmpRayDir,d,b.eye);e=a.vec3.length(this.tmpRayDir);var h=e*c;1>=c&&
4>h&&(h=4,c=h/e);1E-6>Math.abs(e-h)||(a.vec3.scale(this.tmpRayDir,this.tmpRayDir,c),a.vec3.subtract(b.eye,d,this.tmpRayDir),a.vec3.lerp(b.center,b.center,d,1-c),g.applyAll(this.view,b,this.constraintOptions))};return d}(b.PointToPointAnimationController);f.ZoomStepController=p})},"esri/views/input/InputHandler":function(){define(["require","exports","../../core/Logger","./EventMatch"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});var g=k.getLogger("esri.views.input.InputHandler");
p=function(){function c(a){this._manager=null;this._incoming={};this._outgoing={};this._outgoingEventTypes=this._incomingEventTypes=this._incomingEventMatches=null;this._hasSideEffects=a}Object.defineProperty(c.prototype,"incomingEventMatches",{get:function(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(var a in this._incoming)for(var b=0,c=this._incoming[a];b<c.length;b++)this._incomingEventMatches.push(c[b].match)}return this._incomingEventMatches},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"incomingEventTypes",{get:function(){this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(function(a){return a.eventType}));return this._incomingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"outgoingEventTypes",{get:function(){this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing));return this._outgoingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"hasSideEffects",{get:function(){return this._hasSideEffects},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasPendingInputs",{get:function(){return!1},enumerable:!0,configurable:!0});c.prototype.onInstall=function(a){var b=this;this._manager?g.error("This InputHandler has already been registered with an InputManager"):(a.setEventCallback(function(a){return b._handleEvent(a)}),a.setUninstallCallback(function(){return b._onUninstall()}),this._manager=a)};c.prototype.onUninstall=
function(){};c.prototype.registerIncoming=function(c,e,l){var d=this;"function"===typeof e?(l=e,e=[]):e=e||[];c="string"===typeof c?new a.EventMatch(c,e):c;var m=function(){d._incomingEventTypes=null;d._incomingEventMatches=null};e=function(a){var b=d._incoming[a.match.eventType];b&&(a=b.indexOf(a),b.splice(a,1),m(),d._manager&&d._manager.updateDependencies())};l=new b(c,l,{onPause:e,onRemove:e,onResume:function(a){var b=d._incoming[a.match.eventType];b&&-1===b.indexOf(a)&&(b.push(a),m(),d._manager&&
d._manager.updateDependencies())}});e=this._incoming[c.eventType];e||(e=[],this._incoming[c.eventType]=e);e.push(l);m();this._manager&&this._manager.updateDependencies();return l};c.prototype.registerOutgoing=function(a){var b=this;if(this._outgoing[a])throw Error("There is already a callback registered for this outgoing InputEvent: "+a);var c=new e(a,{onEmit:function(a,c,d,e){b._manager.emit(a.eventType,c,d,e)},onRemove:function(a){delete b._outgoing[a.eventType];b._manager.updateDependencies()}});
this._outgoing[a]=c;this._outgoingEventTypes=null;this._manager&&this._manager.updateDependencies();return c};c.prototype.startCapturingPointer=function(a){this._manager.setPointerCapture(a,!0)};c.prototype.stopCapturingPointer=function(a){this._manager.setPointerCapture(a,!1)};c.prototype.refreshHasPendingInputs=function(){this._manager.refreshHasPendingInputs()};c.prototype._onUninstall=function(){this._manager?(this.onUninstall(),this._manager=null):g.error("This InputHandler is not registered with an InputManager")};
c.prototype._handleEvent=function(a){var b=this._incoming[a.type];if(b)for(var c=0;c<b.length;c++){var d=b[c];if(d.match.matches(a)&&(d.callback(a),a.shouldStopPropagation()))break}};return c}();f.InputHandler=p;var b=function(){function a(a,b,c){this.match=a;this._callback=b;this._handler=c}a.prototype.pause=function(){this._handler.onPause(this)};a.prototype.resume=function(){this._handler.onResume(this)};a.prototype.remove=function(){this._handler.onRemove(this)};Object.defineProperty(a.prototype,
"callback",{get:function(){return this._callback},enumerable:!0,configurable:!0});return a}(),e=function(){function a(a,b){this.eventType=a;this._removed=!1;this._handler=b}a.prototype.emit=function(a,b,c){if(!this._removed)this._handler.onEmit(this,a,b,c)};a.prototype.remove=function(){this._removed=!0;this._handler.onRemove(this)};return a}()})},"esri/views/input/EventMatch":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function k(a,
g){void 0===g&&(g=[]);this.eventType=a;this.keyModifiers=g}k.prototype.matches=function(a){if(a.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;a=a.modifiers;for(var g=0,b=this.keyModifiers;g<b.length;g++)if(!a.has(b[g]))return!1;return!0};return k}();f.EventMatch=p})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.eventMatchesPointerAction=function(k,a){switch(a){case "primary":return"touch"===
k.pointerType||0===k.button;case "secondary":return"touch"!==k.pointerType&&2===k.button;case "tertiary":return"touch"!==k.pointerType&&1===k.button}};f.eventMatchesMousePointerAction=function(k,a){if("touch"===k.pointerType)return!1;switch(a){case "primary":return 0===k.button;case "secondary":return 2===k.button;case "tertiary":return 1===k.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function c(a,c,d,e){var h=b.call(this,!0)||this;h.view=a;h.pointerAction=c;h.pivotPoint=d;h.registerIncoming("drag",e,function(a){return h.handleDrag(a)});return h}k(c,b);c.prototype.handleDrag=function(b){var c=b.data;if(!(1<c.pointers.size)&&e.eventMatchesMousePointerAction(b.data,this.pointerAction)){var d=a.vec2f64.fromValues(c.center.x,this.view.height-c.center.y);switch(c.action){case "start":this.cameraController=
new g.RotateController(this.view,this.view.sceneIntersectionHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController.update(d);break;case "end":this.cameraController.end(),this.cameraController=null}b.stopPropagation()}};return c}(b.InputHandler);f.DragRotate=p})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../../support/mathUtils".split(" "),
function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,"__esModule",{value:!0});p=function(e){function l(b,c,d){var h=e.call(this)||this;h.view=b;h.intersectionHelper=c;h.pivot=d;h.lastPoint=a.vec2f64.create();h.tmpWorldUp=a.vec3f64.create();h.tmpViewDir=a.vec3f64.create();h.tmpRotCurPoint=a.vec2f64.create();h.tmpTransf=a.mat4f64.create();h.tmpAxis=a.vec3f64.create();h.pivotPos=a.vec3f64.create();h.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0};h.rotScale="center"===d?3:1.5;return h}k(l,e);l.prototype.begin=function(b){if(this.active){switch(this.pivot){case "eye":a.vec3.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||a.vec3.copy(this.pivotPos,this.beginCamera.center),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=
2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;c.normalizeCoordinate(this.beginCamera,b,this.lastPoint)}};l.prototype.update=function(a){if(this.active){var b;switch(this.pivot){case "eye":b=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,b=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,b,this.pivotPos);g.applyAll(this.view,this.currentCamera,this.constraintOptions)}};
l.prototype.end=function(){this.active&&this.finishController()};l.prototype.applyRotation=function(e,l,m,g){this.view.renderCoordsHelper.worldUpAtPosition(g,this.tmpWorldUp);c.normalizeCoordinate(e,l,this.tmpRotCurPoint);l=(this.tmpRotCurPoint[1]-this.lastPoint[1])*this.rotScale;var h=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;a.vec3.subtract(this.tmpViewDir,m,g);var n=a.vec3.length(this.tmpViewDir),n=d.acos(a.vec3.dot(this.tmpViewDir,this.tmpWorldUp)/n);if("eye"===this.pivot){var q=
.5*Math.PI-n,k=.495*Math.PI;l=q-Math.max(-k,Math.min(k,q+-.5*l))}l=d.clamp(l+n,b.TiltDefault.min,b.TiltDefault.max)-n;a.mat4.identity(this.tmpTransf);a.vec3.cross(this.tmpAxis,e.up,this.tmpViewDir);"center"===this.pivot&&(h=-h);a.mat4.rotate(this.tmpTransf,this.tmpTransf,h,this.tmpWorldUp);a.mat4.rotate(this.tmpTransf,this.tmpTransf,l,this.tmpAxis);a.vec3.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);a.vec3.add(m,g,this.tmpViewDir);a.vec3.transformMat4(e.up,e.up,this.tmpTransf);a.vec2.copy(this.lastPoint,
this.tmpRotCurPoint);e.markViewDirty()};return l}(e.InteractiveController);f.RotateController=p})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});p=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.beginCamera=new g;b.currentCamera=new g;return b}k(b,a);Object.defineProperty(b.prototype,
"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});b.prototype.stepController=function(b,d){a.prototype.stepController.call(this,b,d);d.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(d)};b.prototype.onControllerStart=function(b){a.prototype.onControllerStart.call(this,b);this.beginCamera.copyFrom(b);this.currentCamera.copyFrom(b)};b.prototype.onControllerEnd=function(b){b.copyViewFrom(this.currentCamera);a.prototype.onControllerEnd.call(this,b)};return b}(a.CameraController);
f.InteractiveController=p})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});p=function(d){function e(a,b,c){var e=d.call(this,!0)||this;e.view=a;e.pointerAction=
b;e.registerIncoming("drag",c,function(a){return e.handleDrag(a)});return e}k(e,d);e.prototype.handleDrag=function(d){var e=d.data;if(!(1<e.pointers.size)&&c.eventMatchesMousePointerAction(d.data,this.pointerAction)){var l=a.vec2f64.fromValues(e.center.x,this.view.height-e.center.y);switch(e.action){case "start":this.cameraController=this.view.state.isGlobal?new g.ZoomController(this.view,this.view.sceneIntersectionHelper):new b.ZoomController(this.view,this.view.sceneIntersectionHelper);this.view.state.switchCameraController(this.cameraController);
this.cameraController.begin(l);break;case "update":this.cameraController.update(l);break;case "end":this.cameraController.end(),this.cameraController=null}d.stopPropagation()}};return e}(e.InputHandler);f.DragZoom=p})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function d(d,e){var h=b.call(this)||this;h.view=d;h.intersectionHelper=e;h.pickPoint=a.vec3f64.create();h.tmpP0=a.vec2f64.create();h.panAxisAngle=c.axisAngle.create();h.tmpRayDir=a.vec3f64.create();h.targetOnSphere=a.vec3f64.create();h.dragBeginPoint=a.vec2f64.create();h.normalizedAnchorPoint=a.vec2f64.create();h.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};h.sphere=c.sphere.create();h.hasPickPoint=!1;return h}k(d,b);d.prototype.begin=function(b){this.active&&(a.vec2.copy(this.dragBeginPoint,b),e.normalizeCoordinate(this.beginCamera,b,this.normalizedAnchorPoint),b=e.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,b,!1),this.hasPickPoint=!!b.scenePickPoint,this.pickPoint=b.scenePickPoint,this.sphere=b.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};d.prototype.update=function(b){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;a.vec3.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var d=a.vec3.length(this.tmpRayDir);e.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var l=12*(this.tmpP0[1]-this.normalizedAnchorPoint[1]),m=d*Math.pow(2,l),k=this.view.state.constraints.minimumPoiDistance;0>l&&m<k&&(m=k);1E-6>Math.abs(d-m)||(this.hasPickPoint&&m<d&&(l=1-(1-m/d)*(1-this.sphere.radius/
a.vec3.length(this.currentCamera.center)),a.vec3.scale(this.currentCamera.center,this.currentCamera.center,l)),a.vec3.scale(this.tmpRayDir,this.tmpRayDir,-m/d),a.vec3.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),g.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(e.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,
this.targetOnSphere),c.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),e.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle)),g.applySurfaceCollision(this.view,this.currentCamera))}};d.prototype.end=function(){this.active&&this.finishController()};return d}(b.InteractiveController);f.ZoomController=p})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils".split(" "),
function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function l(d,e){var h=b.call(this)||this;h.view=d;h.intersectionHelper=e;h.tmpP=a.vec3f64.create();h.tmpN=a.vec3f64.create();h.tmpP0=a.vec2f64.create();h.tmpPoi=a.vec3f64.create();h.tmpRayDir=a.vec3f64.create();h.dragBeginPoint=a.vec2f64.create();h.normalizedAnchorPoint=a.vec2f64.create();h.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:a.vec3f64.create(),
tiltMode:0};h.plane=c.plane.create();return h}k(l,b);l.prototype.begin=function(b){this.active&&(a.vec2.copy(this.dragBeginPoint,b),e.normalizeCoordinate(this.beginCamera,b,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(b,this.tmpP),a.vec3.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center),a.vec3.normalize(this.tmpN,this.tmpN),0>this.tmpN[1]&&a.vec3.negate(this.tmpN,this.tmpN),c.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=
this.beginCamera)};l.prototype.update=function(b){if(this.active){e.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||a.vec3.copy(this.tmpPoi,this.currentCamera.center);e.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var c=4*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);a.vec2.copy(this.normalizedAnchorPoint,this.tmpP0);a.vec3.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var h=a.vec3.length(this.tmpRayDir),l=h*(1-c);a.vec3.copy(this.constraintOptions.interactionDirection,
this.tmpRayDir);a.vec3.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,d.sign(c)/h);var m=this.view.state.constraints.minimumPoiDistance;0<=c&&l<m&&(l=m,c=-(l-h)/h);1E-6>Math.abs(h-l)||(a.vec3.scale(this.tmpRayDir,this.tmpRayDir,c),a.vec3.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir),a.vec3.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,c),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?
Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),g.applyAll(this.view,this.currentCamera,this.constraintOptions))}};l.prototype.end=function(){this.active&&this.finishController()};return l}(b.InteractiveController);f.ZoomController=p})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadController ../../../input/InputHandler".split(" "),
function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(c){function d(b){var d=c.call(this,!0)||this;d.view=b;d.watchHandles=new a;d.handle=d.registerIncoming("gamepad",function(a){return d.handleEvent(a)});d.handle.pause();return d}k(d,c);d.prototype.onInstall=function(a){var b=this;c.prototype.onInstall.call(this,a);this.watchHandles.add([g.init(this.view.navigation.gamepad,"enabled",function(a){a?b.handle.resume():(b.handle.pause(),b.cameraController&&(b.cameraController.finishController(),
b.cameraController=null))}),this.view.navigation.gamepad.watch("device",function(a){b.cameraController&&a&&b.cameraController.device!==a&&(b.cameraController.finishController(),b.cameraController=null)})])};d.prototype.onUninstall=function(){this.watchHandles.removeAll();c.prototype.onUninstall.call(this)};d.prototype.handleEvent=function(a){var c=this.view.navigation.gamepad.device;if(!c||a.data.device===c)if((c=this.cameraController&&this.cameraController.active)||b.GamepadController.activatesFor(this.view,
a.data))c||(c=new b.GamepadController(this.view,a.data.device),this.view.state.switchCameraController(c)&&(this.cameraController=c)),this.cameraController&&this.cameraController.active&&this.cameraController.device===a.data.device&&this.cameraController.handleEvent(a.data)};return d}(e.InputHandler);f.GamepadNavigation=p})},"esri/views/3d/state/controllers/GamepadController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../../3d/support/earthUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../webgl-engine/lib/Camera ../../../navigation/gamepadUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y){Object.defineProperty(f,"__esModule",{value:!0});p=function(c){function n(a,b){var d=c.call(this)||this;d.view=a;d.device=b;d.transformation={translation:[0,0,0],heading:0,tilt:0};d.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new r,interactionFactor:0,interactionDirection:null,tiltMode:1};return d}k(n,c);n.prototype.handleEvent=function(a){var b=y.extractTransformation(a,this.view.navigation.gamepad,this.transformation);("end"===
a.action||y.isZeroTransformation(b))&&this.finishController()};n.prototype.onControllerStart=function(a){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;c.prototype.onControllerStart.call(this,a)};n.prototype.updateFilteredSurfaceElevation=function(a){this.filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*a};n.prototype.stepController=function(a,d){this.updateFilteredSurfaceElevation(a);this.currentCamera.copyViewFrom(d);
this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this.calculateControlTransformation(a,this.currentCamera,G);this.applyPan(G.pan);this.applyRotate(G.rotate);this.applyZoom(G.zoom);this.applyAscend(G.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;b.applyAll(this.view,this.currentCamera,this.constraintOptions);c.prototype.stepController.call(this,a,d)};n.prototype.applyRotate=function(a){if(a.enabled){var c=this.currentCamera,
d=c.center,e=c.up,h=c.eye;g.vec3.subtract(d,d,h);g.vec3.transformMat4(d,d,a.matrix);g.vec3.add(d,d,h);g.vec3.transformMat4(e,e,a.matrix);c.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;b.applyAll(this.view,c,this.constraintOptions)}};n.prototype.applyPan=function(a){if(a.enabled){var c=this.currentCamera,d=c.center,e=c.eye,h=c.up;g.vec3.transformMat4(e,e,a.matrix);g.vec3.transformMat4(d,d,a.matrix);this.view.state.isGlobal&&g.vec3.transformMat4(h,h,a.matrix);
c.markViewDirty();this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;b.applyAll(this.view,c,this.constraintOptions)}};n.prototype.applyZoom=function(a){if(a){var c=this.currentCamera,d=c.eye,c=c.viewForward;g.vec3.add(d,d,g.vec3.scale(u.sv3d.get(),c,a));this.currentCamera.markViewDirty();g.vec3.copy(H,c);g.vec3.negate(H,H);this.constraintOptions.interactionDirection=H;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;b.applyAll(this.view,this.currentCamera,
this.constraintOptions);this.constraintOptions.interactionDirection=null}};n.prototype.applyAscend=function(a){if(a){var c=this.currentCamera,d=c.center,c=c.eye,e=this.view.renderCoordsHelper.worldUpAtPosition(c,u.sv3d.get());this.constraintOptions.interactionDirection=g.vec3.copy(H,e);this.view.state.isGlobal?(e=g.vec3.length(c),a=(e+a)/e,g.vec3.scale(c,c,a),g.vec3.scale(d,d,a)):(a=g.vec3.scale(u.sv3d.get(),e,a),g.vec3.add(c,c,a),g.vec3.add(d,d,a));this.currentCamera.markViewDirty();this.updateCameraCenter();
this.constraintOptions.interactionType=5;this.constraintOptions.selection=8;b.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;b.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};n.prototype.calculateControlTransformation=function(a,b,c){c.zoom=0;c.ascend=0;c.pan.enabled=!1;g.mat4.identity(c.pan.matrix);c.rotate.enabled=!1;g.mat4.identity(c.rotate.matrix);a=this.computeVelocities(a);
this.view.state.isLocal?this.calculateControlTransformationLocal(a,b,c):this.calculateControlTransformationGlobal(a,b,c)};n.prototype.updateCameraCenter=function(){var a=this.currentCamera;this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(a.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a.center);this.currentCamera.markViewDirty()};n.prototype.calculateControlTransformationLocal=function(b,c,d){var h=c.viewRight,l=c.viewForward,n=this.transformation,
q=this.view.navigation.gamepad,l=g.vec3.set(u.sv3d.get(),l[0],l[1],0);g.vec3.normalize(l,l);var k=n.translation[0]*b.pan;0!==k&&(k=g.vec3.scale(u.sv3d.get(),h,k),g.mat4.translate(d.pan.matrix,d.pan.matrix,k),d.pan.enabled=!0);switch(q.mode){case "pan":q=-n.translation[1]*b.pan;0!==q&&(q=g.vec3.scale(u.sv3d.get(),l,q),g.mat4.translate(d.pan.matrix,d.pan.matrix,q),d.pan.enabled=!0);break;case "zoom":d.zoom=-n.translation[1]*b.zoom;break;default:a.neverReached(q.mode)}d.ascend=n.translation[2]*b.ascend;
q=-n.heading*b.rotate;0!==q&&(g.mat4.rotate(d.rotate.matrix,d.rotate.matrix,q,this.view.renderCoordsHelper.worldUpAtPosition(c.eye,u.sv3d.get())),d.rotate.enabled=!0);b=n.tilt*b.rotate;c=m.viewAngle(this.view.renderCoordsHelper,c.center,c.eye);if(c=t.clamp(c+b,e.TiltDefault.min,e.TiltDefault.max)-c)g.mat4.rotate(d.rotate.matrix,d.rotate.matrix,c,h),d.rotate.enabled=!0};n.prototype.calculateControlTransformationGlobal=function(a,b,c){var d=b.eye,e=b.viewRight,h=this.transformation,l=this.view.navigation.gamepad,
m=g.vec3.cross(u.sv3d.get(),e,d);g.vec3.normalize(m,m);g.vec3.negate(m,m);var n=h.translation[0]*a.pan;0!==n&&(g.mat4.rotate(c.pan.matrix,c.pan.matrix,n,m),c.pan.enabled=!0);switch(l.mode){case "pan":l=h.translation[1]*a.pan;0!==l&&(g.mat4.rotate(c.pan.matrix,c.pan.matrix,l,e),c.pan.enabled=!0);break;case "zoom":c.zoom=-h.translation[1]*a.zoom}l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;c.ascend=h.translation[2]*a.ascend;m=-h.heading*a.rotate;0!==m&&(g.mat4.rotate(c.rotate.matrix,
c.rotate.matrix,m,d),c.rotate.enabled=!0);a=this.clampTiltDeltaGlobalToValidRange(h.tilt*a.rotate,b.ray,l);0!==a&&(g.mat4.rotate(c.rotate.matrix,c.rotate.matrix,a,e),c.rotate.enabled=!0)};n.prototype.clampTiltDeltaGlobalToValidRange=function(a,b,c){var h=d.onSurfaceTiltToEyeTiltGlobal(e.TiltDefault.min,b.origin,c),n=0,k=0,n=u.sv3d.get();this.view.renderCoordsHelper.intersectManifold(b,c,n)?(n=m.viewAngle(this.view.renderCoordsHelper,n,b.origin),n=d.onSurfaceTiltToEyeTiltGlobal(n,b.origin,c),k=d.onSurfaceTiltToEyeTiltGlobal(e.TiltDefault.max,
b.origin,c)):(q.sphere.closestPointOnSilhouette(q.sphere.wrap(c+l.earthRadius),b,n),n=t.acos(-g.vec3.dot(b.direction,g.vec3.normalize(n,n))),n=d.offSurfaceTiltToEyeTiltGlobal(n,b.origin,c),k=d.offSurfaceTiltToEyeTiltGlobal(e.TiltDefault.max,b.origin,c));return t.clamp(n+a,h,k)-n};n.prototype.getPointAbsoluteSurfaceElevation=function(a,b,c){var d=this.view.renderCoordsHelper,e=d.getAltitude(a);b+=Math.abs(e-b);g.vec3.copy(c,a);d.setAltitude(b,c);return b};n.prototype.clampedDistanceToSurface=function(a,
b){var c=this.view.renderCoordsHelper,d=this.view.state.camera,e=h.headingTiltToDirectionUp(this.view,b,0,z,I).direction,e=c.intersectManifoldClosestSilhouette(q.ray.wrap(b,e),a,u.sv3d.get()),e=g.vec3.distance(b,e);a=c.intersectManifoldClosestSilhouette(q.ray.wrap(b,t.directionFromTo(u.sv3d.get(),b,d.center)),a,u.sv3d.get());b=g.vec3.distance(b,a);return Math.min(e,b)};n.prototype.computeHeadingRotateRadius=function(a){var b=this.view,c=b.renderCoordsHelper,d=b.state,b=d.isGlobal,d=c.intersectManifoldClosestSilhouette(d.camera.ray,
this.filteredSurfaceElevation,u.sv3d.get());if(b)return b=g.vec3.subtract(u.sv3d.get(),a,d),c=g.vec3.length(b),g.vec3.scale(b,b,1/c),a=g.vec3.normalize(u.sv3d.get(),a),a=t.acos(g.vec3.dot(a,b)),c*Math.sin(Math.min(w,a));a=g.vec3.copy(u.sv3d.get(),a);c.setAltitude(this.filteredSurfaceElevation,a);return g.vec3.distance(d,a)};n.prototype.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:C};n.prototype.computeVelocities=function(a){var b=this.filteredSurfaceElevation,
c=b+l.earthRadius,d=this.view.state,e=d.camera,h=d.isGlobal,m=u.sv3d.get(),g=this.getPointAbsoluteSurfaceElevation(e.eye,b,m),n=this.clampedDistanceToSurface(b,m),q=e.width/2,k=B*e.width,d=B*e.width,e=n*Math.tan(.5*e.fovX)/q,r=e/c,c=e/this.computeHeadingRotateRadius(m),h=(h?r:e)*k*a,b=g-b,b=Math.max(this.minimumAscendVelocity()*a,Math.pow(2,k*a/q)*b-b),n=Math.pow(2,k*a/q)*n-n;a*=t.clamp(c*d,D,E);return{pan:h,ascend:b,zoom:n,rotate:a}};n.activatesFor=function(a,b){a=y.extractTransformation(b,a.navigation.gamepad,
x);return!("end"===b.action||y.isZeroTransformation(a))};return n}(c.InteractiveController);f.GamepadController=p;var x={translation:[0,0,0],heading:0,tilt:0},z=80,w=t.deg2rad(z),B=.75,C=5,D=t.deg2rad(30),E=t.deg2rad(80),G={zoom:0,ascend:0,pan:{enabled:!1,matrix:g.mat4f64.create()},rotate:{enabled:!1,matrix:g.mat4f64.create()}},H=g.vec3f64.create(),I=n.createDirectionUp()})},"esri/views/3d/support/cameraUtils":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../Camera ../../../config ../../../core/Logger ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Camera".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x){function z(a){return"global"===a.viewingMode?t:q}function w(b,e,h){var l=b.renderSpatialReference,g=c.vec3.copy(K,e.viewForward),g=E(b,e.eye,g,e.up,L);b=b.spatialReference||m.WGS84;y.vectorToVector(e.eye,l,J,b)||(b=m.WGS84,y.vectorToVector(e.eye,l,J,b));return h?(h.position.x=J[0],h.position.y=J[1],h.position.z=J[2],h.position.spatialReference=b,h.heading=g.heading,h.tilt=g.tilt,h.fov=r.rad2deg(e.fov),h):new a(new d(J,b),g.heading,g.tilt,r.rad2deg(e.fov))}
function B(a,b,c){var d=a.state.camera,e=d.fovX,d=d.width/2;"global"===a.viewingMode&&null!=c&&(b*=Math.cos(r.deg2rad(c)));b/=a.renderCoordsHelper.unitInMeters;return d/(39.37*g.screenDPI/b)/Math.tan(e/2)}function C(a,b,c){var d=a.state.camera;b=39.37*g.screenDPI/(d.width/2/(b*Math.tan(d.fovX/2)));"global"===a.viewingMode&&(b/=Math.cos(r.deg2rad(c)));return b*=a.renderCoordsHelper.unitInMeters}function D(a,b,c,d,h,l){if(W(l)){var m=e.createResolver();S(a,d.heading,d.tilt,b,c,h,m);m.promise.then(function(b){return l.resolve(O(a,
b,d.fov))})}else return b=S(a,d.heading,d.tilt,b,c,h),O(a,b,d.fov,l)}function E(a,b,c,d,e){return z(a).directionToHeadingTilt(b,c,d,e)}function G(a,b,c){return a.basemapTerrain&&a.renderCoordsHelper.fromRenderCoords(b,T,a.spatialReference)&&a.basemapTerrain.getElevation(T)>T.z-1}function H(a,b,c){return a.renderCoordsHelper.fromRenderCoords(b,T,a.spatialReference)?a.elevationProvider.queryElevation(T).then(function(a){return a>T.z-10}):e.resolve(!1)}function I(a,b){var h=c.vec3f64.create();if(b)if(b instanceof
d){if(y.pointToVector(b,h,a.renderSpatialReference),null==b.z&&null!=a.basemapTerrain)return a.elevationProvider.queryElevation(b).then(function(b){null!=b&&a.renderCoordsHelper.setAltitude(b,h);return h})}else c.vec3.copy(h,b);else c.vec3.copy(h,a.state.camera.center);return e.resolve(h)}function N(a,b){var e=c.vec3f64.create();b&&b instanceof d?(y.pointToVector(b,e,a.renderSpatialReference),null==b.z&&null!=a.basemapTerrain&&(b=a.elevationProvider.getElevation(b),null!=b&&a.renderCoordsHelper.setAltitude(b,
e))):b?c.vec3.copy(e,b):c.vec3.copy(e,a.state.camera.center);return e}function S(a,b,c,e,h,l,m){var g=e&&e instanceof d?e:null;if(W(m))I(a,e).then(function(d){M(a,b,c,g,d,h,l,m)});else return e=N(a,e),M(a,b,c,g,e,h,l,m)}function M(a,b,d,e,h,l,g,n){e||(e=y.vectorToPoint(h,a.renderSpatialReference,a.spatialReference||m.WGS84));l=Math.max(l,a.state.constraints.minimumPoiDistance);var q=P(a,b,d,h,l,g),k=z(a).eyeForCenterWithHeadingTilt,r=k(h,l,q.heading,q.tilt);if(g===X.ADJUST&&"global"===a.viewingMode&&
0<d){var f=function(){var c=l,m=l,q=a.state.constraints.tilt(m),m=z(a).eyeTiltToLookAtTilt(h,m,d),m=Math.min(m,.5*Math.PI),q=q.min*(1-ba)+m*ba,c=z(a).lookAtTiltToEyeTilt(h,c,q);g=1>d-c?X.LOCKED:X.ADJUST;return M(a,b,c,e,h,l,g,n)};if(G(a,r.eye,r.tilt))return f();if(W(n)){H(a,r.eye,r.tilt).then(function(a){if(a)return f();n.resolve({eye:r.eye,up:r.up,center:c.vec3f64.clone(h),heading:r.heading,tilt:r.tilt})});return}}q={center:c.vec3f64.create(),eye:c.vec3f64.create(),up:c.vec3f64.create(),tilt:0,heading:0};
n&&!W(n)&&(q=n);q.eye=r.eye;q.up=r.up;q.center=c.vec3f64.clone(h);q.heading=r.heading;q.tilt=r.tilt;W(n)&&n.resolve(q);return q}function P(a,b,c,d,e,h){var l=0;if(h=h===X.ADJUST)if(l=a.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(e/l)/Math.LN2)h=!0;else{var g=a.renderSpatialReference,n=a.spatialReference||m.WGS84;h=y.vectorToPoint(d,g,n);g=y.vectorToPoint(a.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,g,n);l*=Math.tan(.5*a.state.camera.fov);h=5<g.distance(h)/l}h?(b=0,h=
a.state.constraints.tilt(e),h.max=Math.min(h.max,.5*Math.PI),h=h.min*(1-ba)+h.max*ba,c=z(a).eyeTiltToLookAtTilt(d,e,c),l=Math.min(c,h)):l=z(a).eyeTiltToLookAtTilt(d,e,c);c=l=a.state.constraints.clampTilt(e,l);c=z(a).lookAtTiltToEyeTilt(d,e,c);return{heading:b,tilt:c}}function O(b,c,d,e){b=y.vectorToPoint(c.eye,b.renderSpatialReference,b.spatialReference||m.WGS84);return b?e?(e.position=b,e.heading=c.heading,e.tilt=c.tilt,e.fov=d,e):new a(b,c.heading,c.tilt,d):null}function W(a){return a&&a.resolve&&
a.reject}Object.defineProperty(f,"__esModule",{value:!0});var Q=b.getLogger("esri.views.3d.support.cameraUtils"),J=c.vec3f64.create(),F=c.vec3f64.create(),K=c.vec3f64.create(),L={heading:0,tilt:0},T=new d,R=new r.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),X;(function(a){a[a.LOCKED=0]="LOCKED";a[a.ADJUST=1]="ADJUST"})(X=f.OrientationMode||(f.OrientationMode={}));f.headingTiltToDirectionUp=function(a,b,c,d,e){return z(a).headingTiltToDirectionUp(b,c,d,e)};f.externalToInternal=function(a,b){var d=
a.renderSpatialReference,e=z(a).headingTiltToDirectionUp,h=c.vec3f64.create();if(!y.pointToVector(b.position,h,d))return null;d=e(h,b.heading,b.tilt);c.vec3.scale(d.direction,d.direction,a.state.camera.distance);c.vec3.add(d.direction,d.direction,h);a=n.cameraOnContentAlongViewDirection(a,h,d.direction,d.up);a.fov=r.deg2rad(b.fov);return a};f.internalToExternal=w;f.scaleToDistance=B;f.distanceToScale=C;f.fromCenterScale=function(a,b,c,d,e,h){c=B(a,c,b.latitude);return D(a,b,c,d,e,h)};f.fromCenterDistance=
D;f.directionToHeadingTilt=E;f.getObserverForPointAtDistance=S;f.fromExtent=function(a,b,c,l,g,n){var q,k=0;null!=b.zmax&&null!=b.zmin&&(q=(b.zmax+b.zmin)/2,k=b.zmax-b.zmin);var r,f;if("global"===a.viewingMode){r=m.WebMercator;f=b.spatialReference||r;var t=new d(b.xmin,b.ymin,f),w=new d(b.xmax,b.ymax,f),t=h.project(t,r),w=h.project(w,r);if(null===t||null===w){W(n)&&n.reject();return}b=new d(R.center(t.x,w.x),(w.y+t.y)/2,r);null!=q&&(b.z=q);q=u.getGreatCircleSpanAt(b,t,w);r=q.lon;f=q.lat;R.diff(t.x,
w.x)>R.range/2&&(r+=u.halfEarthCircumference);r=Math.min(r,u.halfEarthCircumference);f=Math.min(f,u.halfEarthCircumference)}else t=a.spatialReference||m.WGS84,h.canProject(b,t)&&(b=h.project(b,t)),r=b.xmax-b.xmin,f=b.ymax-b.ymin,b=new d({x:b.xmin+.5*r,y:b.ymin+.5*f,z:q,spatialReference:t});q=a.state.camera;k=Math.max(1/Math.tan(q.fovX/2)*r*.5,1/Math.tan(q.fovY/2)*f*.5,1/Math.tan(q.fov/2)*k*.5)/1;if(W(n))q=e.createResolver(),S(a,c,l,b,k,g,q),q.promise.then(function(b){return n.resolve(O(a,b,a.camera.fov))});
else return c=S(a,c,l,b,k,g),O(a,c,a.camera.fov,n)};f.toExtent=function(a,b,c,d,e){b||(c||(c=a.state.camera),b=w(a,c,e));e=a.renderSpatialReference;var h;if(c)e=y.vectorToPoint(c.center,e,a.spatialReference||m.WGS84),h=c.distance;else{e=a.toMap(a.screenCenter);if(!e)return null;h=u.computeCarthesianDistance(b.position,e)}c||(c=a.state.camera);b=2*h*Math.tan(c.fovX/2)*1;c=2*h*Math.tan(c.fovY/2)*1;return"global"===a.viewingMode?t.toExtent(a,e,b,c,d):q.toExtent(a,e,b,c,d)};var ba=.7;f.observerToCamera=
O;f.scaleToZoom=function(a,b){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.levelAtScale(b);Q.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};f.zoomToScale=function(a,b){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.scaleAtLevel(b);Q.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};f.scaleToResolution=function(a,b){return a.spatialReference?l.getResolutionForScale(b,a.spatialReference):void 0};f.computeScale=
function(a,b,d){var e=a.renderSpatialReference;b||(b=a.state.camera);var h;h=m.WGS84;b instanceof x?(y.vectorToVector(b.center,e,F,h),h=F[1],b=b.distance):(h=b.position.latitude,y.pointToVector(b.position,J,e),y.pointToVector(d,F,e),b=c.vec3.distance(J,F));return C(a,b,h)}})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/Extent ./cameraUtilsInternal ./mathUtils ./projectionUtils".split(" "),function(p,f,k,a,
g,b,e){function c(a,c,e,h){void 0===h&&(h=g.createDirectionUp());k.mat4.identity(l);a=h.direction;var n=h.up;k.mat4.rotateZ(l,l,-b.deg2rad(c));k.mat4.rotateX(l,l,b.deg2rad(e));k.vec3.transformMat4(a,m,l);k.vec3.scale(a,a,-1);k.vec3.transformMat4(n,d,l);return h}Object.defineProperty(f,"__esModule",{value:!0});var d=k.vec3f64.fromValues(0,1,0),m=k.vec3f64.fromValues(0,0,1),l=k.mat4f64.create(),h=k.vec3f64.create(),n=k.vec3f64.create();f.headingTiltToDirectionUp=c;f.directionToHeadingTilt=function(a,
b,c,e){return g.directionToHeadingTilt(b,c,e,m,d)};f.eyeForCenterWithHeadingTilt=function(a,b,d,e){var h=c(a,d,e),l=k.vec3f64.create();k.vec3.scale(l,h.direction,-b);k.vec3.add(l,l,a);return{up:h.up,eye:l,heading:d,tilt:e}};f.lookAtTiltToEyeTilt=function(a,c,d){return b.rad2deg(d)};f.eyeTiltToLookAtTilt=function(a,c,d){return b.deg2rad(d)};f.toExtent=function(b,c,d,l,m){var g=b.renderSpatialReference;b=b.map&&b.spatialReference||c.spatialReference;e.pointToVector(c,h,g);e.pointToVector(c,n,g);h[0]-=
d/2;n[0]+=d/2;h[1]-=l/2;n[1]+=l/2;e.vectorToVector(h,g,h,b);e.vectorToVector(n,g,n,b);m?(m.xmin=h[0],m.ymin=h[1],m.xmax=n[0],m.ymax=n[1],m.spatialReference=b):m=new a(h[0],h[1],n[0],n[1],b);return m}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports","../../../core/libs/gl-matrix-2/gl-matrix","./mathUtils"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});var g=k.vec3f64.create(),b=k.vec3f64.create();f.createDirectionUp=function(){return{direction:k.vec3f64.create(),
up:k.vec3f64.create()}};f.directionToHeadingTilt=function(e,c,d,m,l){var h=g;k.vec3.normalize(h,e);var n=k.vec3.dot(h,m),q=0<n,n=Math.abs(n);.99<n&&(n=Math.abs(k.vec3.dot(c,m)),.99>n?(k.vec3.copy(h,c),q&&k.vec3.scale(h,h,-1)):h=null);c=0;h&&(k.vec3.scale(b,m,k.vec3.dot(m,h)),k.vec3.subtract(h,h,b),c=k.vec3.dot(h,l)/(k.vec3.length(h)*k.vec3.length(l)),k.vec3.cross(b,h,l),c=(0<k.vec3.dot(b,m)?1:-1)*a.rad2deg(a.acos(c)));e=a.rad2deg(a.acos(-k.vec3.dot(m,e)/k.vec3.length(e)));return d?(d.heading=c,d.tilt=
e,d):{heading:c,tilt:e}}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),function(p,f,k,a,g,b,e,c,d){function m(a,b,c,h){void 0===h&&(h=e.createDirectionUp());k.vec3.cross(r,a,n);0===k.vec3.dot(r,r)&&k.vec3.cross(r,a,q);k.mat4.identity(u);k.mat4.rotate(u,u,-d.deg2rad(b),
a);k.mat4.rotate(u,u,-d.deg2rad(c),r);b=h.up;c=h.direction;k.vec3.cross(b,r,a);k.vec3.normalize(b,b);k.vec3.transformMat4(b,b,u);k.vec3.normalize(c,a);k.vec3.negate(c,c);k.vec3.transformMat4(c,c,u);return h}function l(a){var b=a[1];a[1]=-a[2];a[2]=b}function h(a,b){b=m(b,a.heading,a.tilt);a.up=b.up;return a}Object.defineProperty(f,"__esModule",{value:!0});var n=k.vec3f64.fromValues(0,0,1),q=k.vec3.normalize(k.vec3f64.create(),k.vec3f64.fromValues(1,1,1)),t=new d.Cyclical(-180,180),u=k.mat4f64.create(),
r=k.vec3f64.create(),y=k.vec3f64.create();f.headingTiltToDirectionUp=m;f.directionToHeadingTilt=function(a,b,c,d){var h=r;k.vec3.normalize(h,a);k.vec3.cross(y,h,n);0===k.vec3.dot(y,y)&&k.vec3.cross(y,h,q);k.vec3.cross(y,y,h);return e.directionToHeadingTilt(b,c,d,h,y)};f.eyeForCenterWithHeadingTilt=function(a,b,c,e){var m={eye:k.vec3f64.create(),up:null,tilt:e,heading:c},g=r;g[0]=a[0];g[1]=a[2];g[2]=-a[1];c=d.deg2rad(c);var n=d.deg2rad(e);e=Math.sin(c);c=Math.cos(c);var q=Math.sin(n),f=Math.cos(n),
t=k.vec3.length(g);if(1E-8>Math.abs(n))n=b+t;else var u=t/q,w=d.asin(b/u),n=u*Math.sin(Math.PI-n-w);var u=q*b,f=f*b,w=c*u,z=n-f,y=z*z,x=b*b*q*q,q=c*c*x,x=e*e*x,B=g[1]*z,p=q*(q+y-g[1]*g[1]);if(0>p)return k.vec3.scale(m.eye,g,n/t),m.tilt=0,m;var J=Math.sqrt(p),p=q+y,B=0<c?-J+B:J+B;if(1E-8>Math.abs(p))return 1E-8>t?(m.eye[0]=0,m.eye[1]=0,m.eye[2]=b):k.vec3.scale(m.eye,g,n/t),m.tilt=0,l(m.eye),h(m,a);m.eye[1]=B/p;p=m.eye[1]*m.eye[1];b=1-p;B=Math.sqrt(b);w=q*p+x-2*w*m.eye[1]*B*z+b*y;if(1E-8>Math.abs(w))return k.vec3.scale(m.eye,
g,n/t),m.tilt=0,l(m.eye),h(m,a);m.eye[0]=(b*(n*g[0]-f*g[0])-u*B*(g[0]*m.eye[1]*c+g[2]*e))/w;m.eye[2]=(b*(n*g[2]-f*g[2])-u*B*(g[2]*m.eye[1]*c-g[0]*e))/w;k.vec3.scale(m.eye,m.eye,n);l(m.eye);return h(m,a)};f.lookAtTiltToEyeTilt=function(a,b,c){a=k.vec3.length(a);b=d.asin(b/(Math.sqrt(b*b+a*a-2*b*a*Math.cos(Math.PI-c))/Math.sin(c)));return d.rad2deg(c-b)};f.eyeTiltToLookAtTilt=function(a,b,c){c=d.deg2rad(c);a=k.vec3.length(a);return d.asin(b/(a/Math.sin(c)))+c};f.toExtent=function(e,h,l,m,n){function q(a){var b=
Math.PI/2;a=d.cyclical2PI.normalize(a,-b);a>b&&(a=Math.PI-a);return a}var k;k=h.latitude;h=h.longitude;var r=c.getLonDeltaForDistance(h,k,l)/2;l=h-r;h+=r;k=d.deg2rad(k);r=c.earthRadius;k=(1+Math.sin(k))/(1-Math.sin(k));var f=(k+1)*Math.tan(m/r/2);k=1.5*Math.PI-2*Math.atan(.5*(f+Math.sqrt(4*k+f*f)));m=k+m/r;k=q(k);m=q(m);m<k&&(r=m,m=k,k=r);k=Math.max(d.rad2deg(k),-90);m=Math.min(d.rad2deg(m),90);h=t.monotonic(l,h);180<h-l&&(r=(h-l-180)/2,l+=r,h-=r);n?(n.xmin=l,n.ymin=k,n.xmax=h,n.ymax=m,n.spatialReference=
g.WGS84):n=new a(l,k,h,m,g.WGS84);e.spatialReference&&e.spatialReference.isWebMercator&&b.geographicToWebMercator(n,!1,n);return n}})},"esri/views/navigation/gamepadUtils":function(){define(["require","exports","../../core/libs/gl-matrix-2/gl-matrix"],function(p,f,k){function a(a){var b=a*a;0>a&&(b*=-1);return b}Object.defineProperty(f,"__esModule",{value:!0});f.quadraticAccentuation=a;f.resetTransformation=function(a){a.translation[0]=0;a.translation[1]=0;a.translation[2]=0;a.heading=0;a.tilt=0;
return a};f.extractTransformation=function(g,b,e){var c=g.state;g=g.device;b="forward-down"===b.tiltDirection?1:-1;"standard"===g.deviceType?(e.translation[0]=a(c.axes[0]),e.translation[1]=a(c.axes[1]),e.translation[2]=a(c.buttons[7])-a(c.buttons[6]),e.heading=a(c.axes[2]),e.tilt=a(c.axes[3])):"spacemouse"===g.deviceType&&(e.translation[0]=1.2*a(c.axes[0]),e.translation[1]=1.2*a(c.axes[1]),e.translation[2]=2*-a(c.axes[2]),e.heading=1.2*a(c.axes[5]),e.tilt=1.2*a(c.axes[3]));e.tilt*=b;k.vec3.scale(e.translation,
e.translation,1);return e};f.isZeroTransformation=function(a){return 0===a.translation[0]&&0===a.translation[1]&&0===a.translation[2]&&0===a.heading&&0===a.tilt}})},"esri/views/3d/input/handlers/KeyPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/global/PanContinuousController","../../../input/InputHandler"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function e(c,d,e){var l,h=b.call(this,!0)||this;
h.view=c;h.keyToDirection=(l={},l[d.left]=a.Direction.LEFT,l[d.right]=a.Direction.RIGHT,l[d.forward]=a.Direction.FORWARD,l[d.backward]=a.Direction.BACKWARD,l[d.up]=a.Direction.UP,l[d.down]=a.Direction.DOWN,l);c.state.isGlobal&&(h.registerIncoming("key-down",e,function(a){return h.handleKeyDown(a)}),h.registerIncoming("key-up",e,function(a){return h.handleKeyUp(a)}));return h}k(e,b);e.prototype.handleKeyDown=function(b){if(!b.data.repeat){var c=this.keyToDirection[b.data.key];null!=c&&(this.cameraController&&
this.cameraController.active||(this.cameraController=new a.PanContinuousController(this.view),this.view.state.switchCameraController(this.cameraController)),this.cameraController.active&&this.handleKey(b,c,!0))}};e.prototype.handleKeyUp=function(a){var b=this.keyToDirection[a.data.key];null!=b&&this.cameraController&&this.cameraController.active&&this.handleKey(a,b,!1)};e.prototype.handleKey=function(a,b,e){e?this.cameraController.addDirection(b):this.cameraController.removeDirection(b);a.stopPropagation()};
return e}(g.InputHandler);f.KeyPan=p})},"esri/views/3d/state/controllers/global/PanContinuousController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../camera/constraintUtils ../CameraController ../../../support/earthUtils ../../../support/mathUtils".split(" "),function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});f.Direction={LEFT:1,RIGHT:2,FORWARD:4,BACKWARD:8,UP:16,DOWN:32};p=function(b){function d(c){var d=
b.call(this)||this;d.view=c;d.directionStatus=0;d.direction=a.vec3f64.create();d.tmpAxis=a.vec3f64.create();d.radiusChange=0;d.velocity=0;d.tmpP1=a.vec3f64.create();d.tmpTransf=a.mat4f64.create();return d}k(d,b);Object.defineProperty(d.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});d.prototype.addDirection=function(b){0===this.directionStatus&&a.vec3.set(this.direction,0,0,0);this.directionStatus&b||(this.directionStatus|=b,b&(f.Direction.LEFT|f.Direction.RIGHT|
f.Direction.FORWARD|f.Direction.BACKWARD)?(this.computePanAxis(b,this.tmpAxis),a.vec3.add(this.direction,this.direction,this.tmpAxis)):(b=this.directionStatus&(f.Direction.UP|f.Direction.DOWN),this.radiusChange=b===f.Direction.UP?1:b===f.Direction.DOWN?-1:0),this.velocity=this.computePanVelocity())};d.prototype.removeDirection=function(b){this.directionStatus&=~b;0===this.directionStatus&&this.active?this.finishController():b&(f.Direction.LEFT|f.Direction.RIGHT|f.Direction.FORWARD|f.Direction.BACKWARD)?
(this.computePanAxis(b,this.tmpAxis),a.vec3.subtract(this.direction,this.direction,this.tmpAxis),.01>a.vec3.length(this.direction)&&a.vec3.set(this.direction,0,0,0)):(b=this.directionStatus&(f.Direction.UP|f.Direction.DOWN),this.radiusChange=b===f.Direction.UP?1:b===f.Direction.DOWN?-1:0)};d.prototype.stepController=function(c,d){b.prototype.stepController.call(this,c,d);c*=this.velocity;var e=!1;if(0<Math.abs(this.radiusChange)){var e=1+c*this.radiusChange,h=d.viewForward,l=a.vec3.normalize(this.tmpP1,
d.center);(-.999<a.vec3.dot(h,l)||0>this.radiusChange)&&a.vec3.scale(d.center,d.center,e);a.vec3.scale(d.eye,d.eye,e);this.velocity=this.computePanVelocity();e=!0}.01<a.vec3.squaredLength(this.direction)&&(a.mat4.identity(this.tmpTransf),a.mat4.rotate(this.tmpTransf,this.tmpTransf,c,this.direction),a.vec3.transformMat4(d.eye,d.eye,this.tmpTransf),a.vec3.transformMat4(d.center,d.center,this.tmpTransf),a.vec3.transformMat4(d.up,d.up,this.tmpTransf),e=!0);e&&g.applyAll(this.view,d,{selection:14,interactionType:4,
interactionStartCamera:this.view.state.camera,interactionFactor:null,interactionDirection:null,tiltMode:0})};d.prototype.computePanAxis=function(b,c){var d=this.view.state.camera;a.vec3.subtract(c,d.center,d.eye);a.vec3.cross(c,c,d.up);if(b===f.Direction.LEFT||b===f.Direction.RIGHT)a.vec3.normalize(c,c),a.vec3.cross(c,c,d.center);b!==f.Direction.RIGHT&&b!==f.Direction.FORWARD||a.vec3.negate(c,c);a.vec3.normalize(c,c)};d.prototype.computePanVelocity=function(){var b=.5*Math.abs(a.vec3.length(this.view.state.camera.eye)-
e.earthRadius),b=c.clamp(b,1,2*e.earthRadius);return c.acos(1-b*b/(2*e.earthRadius*e.earthRadius))};return d}(b.CameraController);f.PanContinuousController=p})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function c(a,
c){var d=b.call(this,!0)||this;d.view=a;d.registerIncoming("mouse-wheel",c,function(a){return d.handleMouseWheel(a)});return d}k(c,b);c.prototype.handleMouseWheel=function(b){var c=b.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new a.ZoomStepController(this.view,"interaction"):new g.ZoomStepController(this.view,"interaction"),this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*c.deltaY,[c.x,
this.view.height-c.y]);b.stopPropagation()};return c}(b.InputHandler);f.MouseWheelZoom=p})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function c(a,c,d){var e=
b.call(this,!0)||this;e.view=a;e.pointerAction=c;e.lastEndTimestamp=0;e.lastTimestamp=0;e.registerIncoming("drag",d,function(a){return e.handleDrag(a)});return e}k(c,b);c.prototype.handleDrag=function(a){if("mouse"!==a.data.pointerType||e.eventMatchesMousePointerAction(a.data,this.pointerAction)){var b=a.timestamp-this.lastEndTimestamp,b=this.momentum&&this.momentum.active&&40>b;switch(a.data.action){case "start":case "update":if(b)break;this.controller&&this.controller.active?2<a.data.timestamp-
this.lastTimestamp&&(this.controller.update(a.data),this.lastTimestamp=a.timestamp):this.startController(a);break;case "end":case "removed":this.endController(a,!0);break;case "added":this.endController(a,!1),this.startController(a)}a.stopPropagation()}};c.prototype.endController=function(a,b){this.controller&&this.controller.active&&(this.lastEndTimestamp=a.timestamp,a=this.controller.end(a.data),b&&a&&(this.momentum=a,this.view.state.switchCameraController(this.momentum)));this.controller=null};
c.prototype.startController=function(a){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(a.data);this.lastTimestamp=a.timestamp};c.prototype.createController=function(){return this.view.state.isGlobal?new a.PinchAndPanController(this.view,this.view.sceneIntersectionHelper):new g.PinchAndPanController(this.view,this.view.sceneIntersectionHelper)};return c}(b.InputHandler);f.PinchAndPanNavigation=p})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/geometryUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B){Object.defineProperty(f,"__esModule",{value:!0});p=function(e){function f(c,d){var h=e.call(this)||this;h.view=c;h.intersectionHelper=d;h.smoothRotation=new b.ExponentialFalloff(.05);h.rotationAxis=a.vec3f64.create();h.panningPlane=u.plane.create();h.smoothScaling=new b.ExponentialFalloff(.05);h.zoomCenterScreen=a.vec2f64.create();h.zoomMomentumEstimator=new B.ZoomMomentumEstimator;h.rotationMomentumEstimator=new w.RotationMomentumEstimator;h.panSphericalMomentumEstimator=
new z.PanSphericalMomentumEstimator;h.panPlanarMomentumEstimator=new x.PanPlanarMomentumEstimator;h.adjustedSphere=t.sphere.create();h.tmp2d=a.vec2f64.create();h.tmp3d=a.vec3f64.create();h.tmpMat=a.mat4f64.create();h.tmpAxisAngle=t.axisAngle.create();h.beginScreenPoint=a.vec2f64.create();h.beginScenePoint=a.vec3f64.create();h.screenPickPoint=a.vec2f64.create();h.panMode=q.PanMode.Horizontal;h.tmpInteractionDirection=a.vec3f64.create();h.constraintOptions={selection:15,interactionType:0,interactionFactor:0,
interactionStartCamera:new y,interactionDirection:null,tiltMode:0};return h}k(f,e);f.prototype.begin=function(b){if(this.active){this.beginHeading=-r.cyclicalPI.normalize(r.deg2rad(this.view.camera.heading));this.beginRadius=b.radius;this.pointerCount=b.pointers.size;this.beginAngle=b.angle;this.smoothRotation.reset();n.navPointToScreenPoint(this.currentCamera,b.center,this.screenPickPoint);a.vec2.copy(this.beginScreenPoint,this.screenPickPoint);var c=n.pickPointAndInitSphere(this.intersectionHelper,
this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=c.scenePickPoint;this.sphere=c.sphere;a.vec3.copy(this.beginScenePoint,this.scenePickPoint);this.panMode=n.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);this.panMode===q.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(b):this.preparePlanarPanMode(b));this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};f.prototype.preparePlanarPanModeOverground=function(b){var c=
a.vec3.negate(this.tmp3d,this.beginCamera.viewForward);u.plane.fromPositionAndNormal(this.scenePickPoint,c,this.panningPlane);c=a.vec3f64.create();a.vec3.set(c,this.screenPickPoint[0],this.currentCamera.fullHeight,0);var d=a.vec3f64.create(),e=a.vec3.length(this.beginCamera.eye);this.adjustedSphere.radius=e<this.sphere.radius?e-100:this.sphere.radius;n.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,c,d);this.beginCamera.projectPoint(d,c);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],
.9*c[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&u.plane.fromPositionAndNormal(this.scenePickPoint,this.panningPlane,this.panningPlane);n.navPointToScreenPoint(this.currentCamera,b.center,this.tmp2d);n.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,this.tmp2d,this.beginScenePoint)};f.prototype.preparePlanarPanMode=function(b){var c=a.vec3.negate(this.tmp3d,this.beginCamera.viewForward);u.plane.fromPositionAndNormal(this.scenePickPoint,c,
this.panningPlane);var d=t.sphere.angleToSilhouette(this.sphere,this.currentCamera.eye),c=t.axisAngle.fromPoints(this.currentCamera.eye,this.scenePickPoint,this.tmpAxisAngle),d=-c[3]-(this.currentCamera.aboveGround?.25:.025)*d;if(0<d){var e=a.mat4.identity(this.tmpMat);a.mat4.rotate(e,e,-d,c);a.vec3.subtract(this.scenePickPoint,this.scenePickPoint,this.sphere.center);a.vec3.transformMat4(this.scenePickPoint,this.scenePickPoint,e);a.vec3.add(this.scenePickPoint,this.scenePickPoint,this.sphere.center);
u.plane.setOffsetFromPoint(this.panningPlane,this.scenePickPoint,this.panningPlane);n.navPointToScreenPoint(this.currentCamera,b.center,this.tmp2d);n.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,this.tmp2d,this.beginScenePoint)}};f.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<a.pointers.size;this.panMode===q.PanMode.Horizontal?(b&&this.zoomSpherical(a),this.panningSpherical(a),b&&this.rotateSpherical(a)):(b&&this.zoomPlanar(a),
this.panningPlanar(a),b&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};f.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===q.PanMode.Horizontal?new h.ZoomSphericalMomentumController(this.view,a,this.zoomCenterScreen,this.beginScenePoint,this.sphere.radius):new l.ZoomPlanarMomentumController(this.view,a,this.beginScenePoint);if(a=this.rotationMomentumEstimator.evaluateMomentum())return new m.RotationMomentumController(this.view,
a,this.sphere.center,this.rotationAxis);if(this.panMode===q.PanMode.Horizontal){if(a=this.panSphericalMomentumEstimator.evaluateMomentum())return new d.PanSphericalMomentumController(this.view,a)}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new c.PanPlanarMomentumController(this.view,a);return null};f.prototype.zoomSpherical=function(a){var b=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(b);n.applyZoomOnSphere(this.sphere,
this.currentCamera,this.smoothScaling.value);n.navPointToScreenPoint(this.currentCamera,a.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);g.applyAll(this.view,this.currentCamera,this.constraintOptions)};f.prototype.panningSpherical=function(b){n.navPointToScreenPoint(this.currentCamera,b.center,this.tmp2d);
n.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.tmp2d,this.tmp3d);n.preserveHeadingThreshold(this.beginScenePoint,a.vec3.dot(this.currentCamera.up,this.beginScenePoint),this.sphere.radius,.95,Math.PI/10,this.beginHeading,this.view.camera.tilt,this.beginCamera)?(n.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(this.tmp2d,
this.tmp3d,.001*b.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(n.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(this.tmp2d,this.tmp3d,.001*b.timestamp,this.beginCamera,this.sphere.radius,this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(this.screenPickPoint,
this.tmp2d);g.applyAll(this.view,this.currentCamera,this.constraintOptions)};f.prototype.rotateSpherical=function(b){a.vec3.normalize(this.rotationAxis,this.scenePickPoint);var c=this.smoothRotation.value,d=n.normalizeRotationDelta(b.angle-c),c=c+d;this.smoothRotation.gain=.00125*Math.min(Math.max(b.radius,40),120);this.smoothRotation.update(c);d=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(d,.001*b.timestamp);n.applyRotation(this.currentCamera,this.sphere.center,t.axisAngle.wrapAxisAngle(this.rotationAxis,
d));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(b.radius*c);g.applyAll(this.view,this.currentCamera,this.constraintOptions)};f.prototype.panningPlanar=function(a){n.navPointToScreenPoint(this.currentCamera,a.center,this.tmp2d);n.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,this.tmp2d,this.tmp3d)&&(n.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(this.tmp2d,
this.tmp3d,.001*a.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(this.beginScreenPoint,this.tmp2d),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),g.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};f.prototype.zoomPlanar=function(a){var b=this.beginRadius/a.radius;
this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(b);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);n.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);g.applyAll(this.view,this.currentCamera,this.constraintOptions)};
f.prototype.rotatePlanar=function(b){a.vec3.copy(this.rotationAxis,this.beginScenePoint);var c=this.smoothRotation.value,d=b.angle-c,d=n.normalizeRotationDelta(d);this.smoothRotation.gain=.00125*Math.min(Math.max(b.radius,40),120);this.smoothRotation.update(c+d);c=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*b.timestamp);n.applyRotation(this.currentCamera,this.sphere.center,t.axisAngle.wrapAxisAngle(this.rotationAxis,c));this.constraintOptions.interactionType=
2;this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(b.radius*c);g.applyAll(this.view,this.currentCamera,this.constraintOptions)};return f}(e.InteractiveController);f.PinchAndPanController=p})},"esri/views/3d/input/util":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function k(a){this._gain=a}k.prototype.reset=function(a){this._value=a};Object.defineProperty(k.prototype,"gain",{set:function(a){this._gain=
a},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});k.prototype.update=function(a){this._value=void 0===this._value?a:this._gain*a+(1-this._gain)*this._value};return k}();f.ExponentialFalloff=p})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../../../core/libs/gl-matrix-2/gl-matrix",
"./MomentumController"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function e(c,d){c=b.call(this,c,4)||this;c.momentum=d;c.tmpPan=a.vec3f64.create();return c}k(e,b);e.prototype.momentumStep=function(b,d){b=this.momentum.value(b);a.vec3.scale(this.tmpPan,this.momentum.direction,b);a.vec3.subtract(d.eye,d.eye,this.tmpPan);a.vec3.subtract(d.center,d.center,this.tmpPan);d.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return e}(g.MomentumController);
f.PanPlanarMomentumController=p})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});p=function(e){function c(a,c){c=e.call(this)||this;c.view=a;c.beginCamera=new b;c.elapsedTimeSec=0;c.constraintOptions={selection:15,interactionType:4,interactionFactor:0,
interactionStartCamera:new b,interactionDirection:null,tiltMode:0};return c}k(c,e);Object.defineProperty(c.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},enumerable:!0,configurable:!0});c.prototype.onControllerStart=function(a){this.beginCamera.copyFrom(a);this.constraintOptions.interactionStartCamera=this.beginCamera;e.prototype.onControllerStart.call(this,a)};c.prototype.stepController=function(b,c){c.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=
b;this.momentumStep(this.elapsedTimeSec,c);a.applyAll(this.view,c,this.constraintOptions)};return c}(g.AnimationController);f.MomentumController=p})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ./MomentumController ../../utils/navigationUtils".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});var e=a.vec3f64.create(),
c=a.vec3f64.create();p=function(d){function m(a,b){a=d.call(this,a,4)||this;a.momentum=b;return a}k(m,d);m.prototype.momentumStep=function(d,h){var l=this.momentum.value1(d);d=this.momentum.value2(d);a.vec3.copy(c,h.eye);a.vec3.normalize(c,c);a.vec3.cross(this.momentum.axis2,c,this.momentum.axis1);b.applyRotationWithTwoAxes(h,e,this.momentum.axis1,l,this.momentum.axis2,d)};return m}(g.MomentumController);f.PanSphericalMomentumController=p})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(c){function d(b,d,e,g){b=c.call(this,b,2)||this;b.momentum=d;b.axis=a.vec3f64.create();b.center=a.vec3f64.create();a.vec3.copy(b.axis,g);a.vec3.copy(b.center,e);return b}k(d,c);d.prototype.momentumStep=function(a,c){a=this.momentum.value(a);b.applyRotation(c,this.center,e.axisAngle.wrapAxisAngle(this.axis,a))};return d}(g.MomentumController);f.RotationMomentumController=p})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ./MomentumController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(c){function d(b,d,e){b=c.call(this,b,1)||this;b.momentum=d;b.zoomCenter=a.vec3f64.create();a.vec3.copy(b.zoomCenter,e);b.constraintOptions.interactionDirection=a.vec3f64.create();return b}k(d,c);d.prototype.momentumStep=function(c,d){a.vec3.copy(this.constraintOptions.interactionDirection,d.eye);c=this.momentum.valueDelta(0,c);b.applyZoomToPoint(d,this.zoomCenter,c,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=
e.directionFromTo(this.constraintOptions.interactionDirection,d.eye,this.constraintOptions.interactionDirection)};return d}(g.MomentumController);f.ZoomPlanarMomentumController=p})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function d(d,e,m,g,k){d=b.call(this,d,1)||this;d.momentum=e;d.screenCenter=a.vec2f64.create();d.sceneCenter=a.vec3f64.create();d.tmpSceneCenter=a.vec3f64.create();d.tmpZoomAxisAngle=c.axisAngle.create();d.sphere=c.sphere.create();a.vec2.copy(d.screenCenter,m);a.vec3.copy(d.sceneCenter,g);d.sphere.radius=k;return d}k(d,b);d.prototype.momentumStep=function(a,b){a=this.momentum.valueDelta(0,a);e.applyZoomOnSphere(this.sphere,
b,a);this.constraintOptions.interactionType=1;g.applyAll(this.view,b,this.constraintOptions);e.sphereOrPlanePointFromScreenPoint(this.sphere,b,this.screenCenter,this.tmpSceneCenter);c.axisAngle.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);e.applyRotation(b,this.sphere.center,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=4};return d}(b.MomentumController);f.ZoomSphericalMomentumController=p})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/gl-matrix ./FilteredFiniteDifference ./Momentum".split(" "),
function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});var e=function(a){function b(b,c,d,e,g){b=a.call(this,b,c,d)||this;b.sceneVelocity=e;b.direction=g;return b}k(b,a);b.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,b)};return b}(b.Momentum);f.PanPlanarMomentum=e;p=function(){function b(b,c,e){void 0===b&&(b=300);void 0===c&&(c=12);void 0===e&&(e=.84);this.minimumInitialVelocity=b;this.stopVelocity=c;this.friction=e;this.time=
new g.FilteredFiniteDifference(.6);this.screen=[new g.FilteredFiniteDifference(.4),new g.FilteredFiniteDifference(.4)];this.scene=[new g.FilteredFiniteDifference(.6),new g.FilteredFiniteDifference(.6),new g.FilteredFiniteDifference(.6)];this.tmpDirection=a.vec3f64.create()}b.prototype.add=function(a,b,c){this.time.hasLastValue&&.015>this.time.computeDelta(c)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(b[0]),this.scene[1].update(b[1]),this.scene[2].update(b[2]),this.time.update(c))};
b.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};b.prototype.createMomentum=function(b,
c,l){a.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var d=a.vec3.length(this.tmpDirection);0<d&&a.vec3.scale(this.tmpDirection,this.tmpDirection,1/d);return new e(b,c,l,d/this.time.filteredDelta,this.tmpDirection)};return b}();f.PanPlanarMomentumEstimator=p})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function k(a){this.gain=
a}k.prototype.update=function(a){if(this.hasLastValue){var g=this.computeDelta(a);this.updateDelta(g)}this.lastValue=a};k.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(k.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});k.prototype.computeDelta=function(a){return a-
this.lastValue};k.prototype.updateDelta=function(a){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*a:a};return k}();f.FilteredFiniteDifference=p})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function a(a,b,e){this._initialVelocity=a;this._stopVelocity=b;this._friction=e;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){return this.valueFromInitialVelocity(this._initialVelocity,a)};a.prototype.valueDelta=function(a,b){var e=this.value(a);return this.value(a+
b)-e};a.prototype.valueFromInitialVelocity=function(a,b){b=Math.min(b,this.duration);var e=1-this.friction;return a*(Math.pow(e,b)-1)/Math.log(e)};return a}();f.Momentum=p})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/gl-matrix ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});
var d=function(a){function b(b,c,d,e,l,g,m){void 0===g&&(g=0);b=a.call(this,b,c,d)||this;b.angularVelocity1=e;b.axis1=l;b.angularVelocity2=g;b.axis2=m;return b}k(b,a);b.prototype.value1=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,b)};b.prototype.value2=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,b)};return b}(c.Momentum);f.PanSphericalMomentum=d;p=function(){function c(c,d,g){void 0===c&&(c=300);void 0===d&&(d=
12);void 0===g&&(g=.84);this.minimumInitialVelocity=c;this.stopVelocity=d;this.friction=g;this.tmpAxis1=a.vec3f64.create();this.tmpAxis2=a.vec3f64.create();this.tmpAngles=a.vec2f64.create();this.time=new b.FilteredFiniteDifference(.3);this.screen=[new b.FilteredFiniteDifference(.4),new b.FilteredFiniteDifference(.4)];this.angle1=new e.FilteredValue(.6);this.angle2=new e.FilteredValue(.6);this.axis1=a.vec3f64.create();this.axis2=a.vec3f64.create();this.lastScene=a.vec3f64.create()}c.prototype.addMomentumDirectRotation=
function(b,c,d,e,m,k){if(this.time.hasLastValue){if(.01>this.time.computeDelta(d))return;e=g.rotationAngleAndAxisDirectRotation(this.lastScene,c,this.tmpAxis2,e,m,k);this.angle2.update(0);1E-5>a.vec3.squaredLength(this.tmpAxis2)?e=0:a.vec3.normalize(this.axis1,this.tmpAxis2);this.angle1.update(e);a.vec3.copy(this.lastScene,c)}this.screen[0].update(b[0]);this.screen[1].update(b[1]);this.time.update(d)};c.prototype.addMomentumPreserveHeading=function(b,c,d,e,m,k,r){if(this.time.hasLastValue){if(.01>
this.time.computeDelta(d))return;g.rotationAnglesAndAxesHeadingPreserving(this.lastScene,c,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,e,m,k,r,!1);1E-5>a.vec3.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),a.vec3.normalize(this.axis1,this.tmpAxis1),a.vec3.normalize(this.axis2,this.tmpAxis2));a.vec3.copy(this.lastScene,c)}this.screen[0].update(b[0]);this.screen[1].update(b[1]);this.time.update(d)};
c.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};c.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};c.prototype.createMomentum=function(a,b,c){return new d(a,b,
c,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return c}();f.PanSphericalMomentumEstimator=p})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function k(a){this.gain=a}k.prototype.update=function(a){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*a:a};k.prototype.reset=function(){this.filteredValue=
void 0};Object.defineProperty(k.prototype,"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!0,configurable:!0});return k}();f.FilteredValue=p})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(a){function b(b,c,d,g){void 0===b&&(b=3);void 0===c&&(c=.01);void 0===d&&(d=.95);void 0===g&&(g=
12);return a.call(this,b,c,d,g)||this}k(b,a);b.prototype.add=function(b,c){if(this.value.hasLastValue){var d=this.value.lastValue;for(b-=d;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=d+b}a.prototype.add.call(this,b,c)};return b}(a.MomentumEstimator);f.RotationMomentumEstimator=p})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/support/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,
"__esModule",{value:!0});p=function(){function e(a,b,e,l){void 0===a&&(a=2.5);void 0===b&&(b=.01);void 0===e&&(e=.95);void 0===l&&(l=12);this.minimumInitialVelocity=a;this.stopVelocity=b;this.friction=e;this.maxVelocity=l;this.value=new g.FilteredFiniteDifference(.8);this.time=new g.FilteredFiniteDifference(.3)}e.prototype.add=function(a,b){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;if(this.value.hasFilteredDelta){var c=this.value.computeDelta(a);0>this.value.filteredDelta*
c&&this.value.reset()}}this.time.update(b);this.value.update(a)};e.prototype.reset=function(){this.value.reset();this.time.reset()};e.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var b=this.value.filteredDelta/this.time.filteredDelta,b=a.clamp(b,-this.maxVelocity,this.maxVelocity);return Math.abs(b)<this.minimumInitialVelocity?null:this.createMomentum(b,this.stopVelocity,this.friction)};e.prototype.createMomentum=function(a,d,e){return new b.Momentum(a,d,e)};return e}();
f.MomentumEstimator=p})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});var b=function(a){function b(b,c,e){return a.call(this,b,c,e)||this}k(b,a);b.prototype.value=function(b){b=a.prototype.value.call(this,b);return Math.exp(b)};b.prototype.valueDelta=function(b,c){var d=a.prototype.value.call(this,b);b=a.prototype.value.call(this,
b+c);return Math.exp(b-d)};return b}(a.Momentum);f.ZoomMomentum=b;p=function(a){function c(b,c,e,h){void 0===b&&(b=2.5);void 0===c&&(c=.01);void 0===e&&(e=.95);void 0===h&&(h=12);return a.call(this,b,c,e,h)||this}k(c,a);c.prototype.add=function(b,c){a.prototype.add.call(this,Math.log(b),c)};c.prototype.createMomentum=function(a,c,e){return new b(a,c,e)};return c}(g.MomentumEstimator);f.ZoomMomentumEstimator=p})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r){Object.defineProperty(f,"__esModule",{value:!0});var y;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(y=f.PanMode||(f.PanMode={}));var x=a.vec3f64.fromValues(0,0,1),z=16/180*Math.PI;p=function(e){function f(c,d){var l=e.call(this)||this;l.view=c;l.intersectionHelper=d;l.rotationValueSmooth=new b.ExponentialFalloff(.05);l.scalingValueSmooth=new b.ExponentialFalloff(.05);l.planeHorizontal=h.plane.create();l.planeVertical=h.plane.create();
l.rotationMomentumEstimator=new u.RotationMomentumEstimator;l.panMomentumEstimator=new t.PanPlanarMomentumEstimator(300,12,.9);l.zoomMomentumEstimator=new r.ZoomMomentumEstimator;l.beginCenter=a.vec3f64.create();l.tmpPoints=[];l.beginCenterScreen=a.vec2f64.create();l.tmpCentroid3d=a.vec3f64.create();l.tmpCentroid2d=a.vec2f64.create();l.tmp2d=a.vec2f64.create();l.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new q,interactionDirection:null,tiltMode:0};
return l}k(f,e);f.prototype.begin=function(b){if(this.active){this.beginRadius=b.radius;this.pointerCount=b.pointers.size;this.beginAngle=b.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();l.navPointToScreenPoint(this.beginCamera,b.center,this.beginCenterScreen);h.plane.fromNormalAndOffset(x,0,this.planeHorizontal);var c=a.vec3f64.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,c);var d=a.vec3f64.create();a.vec3.negate(d,this.beginCamera.viewForward);
var e=a.vec3f64.create();a.vec3.copy(e,x);var g=a.vec3.dot(d,e);this.panMode=n.asin(0>g?-g:g)>=z?y.Horizontal:y.Vertical;h.plane.setOffsetFromPoint(this.planeHorizontal,c,this.planeHorizontal);0>h.plane.signedDistance(this.planeHorizontal,this.beginCamera.eye)&&h.plane.negate(this.planeHorizontal,this.planeHorizontal);this.panMode===y.Vertical?(a.vec3.scale(e,e,g),a.vec3.subtract(this.planeVertical,d,e),a.vec3.normalize(this.planeVertical,this.planeVertical),h.plane.setOffsetFromPoint(this.planeVertical,
c,this.planeVertical),this.computePlanePoints(b.pointers,this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(b.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);l.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};f.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<a.pointers.size,c=this.panMode===y.Horizontal?this.planeHorizontal:this.planeVertical,
d=this.beginCenter;if(b){var e=this.beginRadius/a.radius,m=.001875*Math.min(Math.max(a.radius,40),120);this.scalingValueSmooth.gain=m;this.scalingValueSmooth.update(e);l.applyZoomToPoint(this.currentCamera,d,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(Math.abs(a.radius-this.beginRadius));
g.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(a.pointers,c,this.currentCamera,this.tmpPoints);l.centroid(this.tmpPoints,this.tmpCentroid3d);l.navPointToScreenPoint(this.currentCamera,a.center,this.tmpCentroid2d);l.applyPanPlanar(this.currentCamera,d,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*a.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d);g.applyAll(this.view,this.currentCamera,this.constraintOptions);b&&(b=this.planeHorizontal,c=this.rotationValueSmooth.value,e=l.normalizeRotationDelta(a.angle-c),m=.00125*Math.min(Math.max(a.radius,40),120),this.rotationValueSmooth.gain=m,this.rotationValueSmooth.update(c+e),m=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(m,.001*a.timestamp),l.applyRotation(this.currentCamera,d,h.axisAngle.wrapAxisAngle(b,m)),this.constraintOptions.interactionType=
2,this.constraintOptions.interactionFactor=g.pixelDistanceToInteractionFactor(Math.abs(a.radius*m)),g.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};f.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();return(a=this.zoomMomentumEstimator.evaluateMomentum())?new m.ZoomPlanarMomentumController(this.view,a,this.beginCenter):(a=this.rotationMomentumEstimator.evaluateMomentum())?new d.RotationMomentumController(this.view,
a,this.beginCenter,this.planeHorizontal):(a=this.panMomentumEstimator.evaluateMomentum())?new c.PanPlanarMomentumController(this.view,a):null};f.prototype.computePlanePoints=function(b,c,d,e){e.length=b.size;var h=this.tmp2d,g=0;b.forEach(function(b){l.navPointToScreenPoint(d,b,h);void 0===e[g]&&(e[g]=a.vec3f64.create());l.intersectPlaneFromScreenPoint(c,d,h,e[g]);g+=1});return e};return f}(e.InteractiveController);f.PinchAndPanController=p})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(a){function b(b,c){var d=a.call(this,!0)||this;d.view=b;d.registerIncoming("pointer-down",c,function(a){return d.view.state.stopActiveCameraController()});return d}k(b,a);return b}(a.InputHandler);f.PointerDownCancelAnimation=p})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./SingleKey"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(a){function b(b,c,d){d=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",c,d)||this;d.view=b;d.key=c;return d}k(b,a);b.prototype.activate=function(){this.view.goTo({heading:0})};return b}(a.SingleKey);f.SingleKeyResetHeading=p})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(p,
f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(a){function b(b,c,d){var e=a.call(this,!0)||this;e.key=c;e.registerIncoming("key-down",d,function(a){return e._handleKeyDown(a)});return e}k(b,a);b.prototype._handleKeyDown=function(a){a.data.key===this.key&&(this.activate(),a.stopPropagation())};return b}(a.InputHandler);f.SingleKey=p})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],
function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(a){function b(b,c,d){d=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",c,d)||this;d.view=b;d.key=c;return d}k(b,a);b.prototype.activate=function(){this.view.goTo({tilt:0})};return b}(a.SingleKey);f.SingleKeyResetTilt=p})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../state/controllers/RotateController ../../../input/InputHandler".split(" "),
function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function c(a,c){void 0===c&&(c=!1);var d=b.call(this,!0)||this;d.view=a;d.invert=c;d.registerIncoming("vertical-two-finger-drag",function(a){return d.handleTwoFinger(a)});return d}k(c,b);c.prototype.handleTwoFinger=function(b){var c=a.vec2f64.fromValues(0,-b.data.delta*(this.invert?-1:1));switch(b.data.action){case "begin":this.cameraController=new g.RotateController(this.view,this.view.sceneIntersectionHelper,"center");
this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(c);break;case "update":this.cameraController.update(c);break;case "end":this.cameraController.end(),this.cameraController=null}};return c}(b.InputHandler);f.TwoFingerTilt=p})},"esri/views/input/BrowserEventSource":function(){define("require exports ../../core/has ../../core/libs/pep/pep ./keys ./gamepad/GamepadSource".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});var e=k("trident"),
c=k("edge"),d=k("chrome"),m=k("ff"),l=k("safari");p=function(){function n(c,d){var e=this;this.input=d;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._element=c;a.applyLocal(c);c.getAttribute("tabindex")||c.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,
"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._initialCssTouchAction=c.style.touchAction;c.style.touchAction="none";this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new b.GamepadSource(c,this.input);this._gamepadSource.onEvent=function(a){return e._callback("gamepad",a)}}n.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=
null;this._activePointerCaptures.forEach(function(b){a._element.releasePointerCapture(b)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._element.style.touchAction=this._initialCssTouchAction;this._element.removeEventListener("keydown",this._preventAltKeyDefault)};Object.defineProperty(n.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"activeEvents",
{set:function(a){var b=this,c;for(c in this._active)a&&a.has(c)||(this._element.removeEventListener(h[c],this._active[c]),delete this._active[c]);a&&a.forEach(function(a){if(!b._active[a]&&h[a]){var c=(b._eventHandlers[a]||b._handleDefault).bind(b,a);b._element.addEventListener(h[a],c);b._active[a]=c}});this._gamepadSource.pollingEnabled=a&&a.has("gamepad")},enumerable:!0,configurable:!0});n.prototype.setPointerCapture=function(a,b){b?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):
("pointerup"!==a.type&&this._element.releasePointerCapture(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};n.prototype._updateNormalizedPointerLikeEvent=function(a,b){var c=this._element.getBoundingClientRect();b.x=a.clientX-Math.round(c.left);b.y=a.clientY-Math.round(c.top);return b};n.prototype._handleKey=function(a,b){var c=g.eventKey(b);c&&"key-up"===a&&this._keyDownState.delete(c);b={native:b,key:c,repeat:c&&this._keyDownState.has(c)};c&&"key-down"===a&&this._keyDownState.add(b.key);
this._callback(a,b)};n.prototype._handlePointer=function(a,b){b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons,eventId:this._eventId++});this._callback(a,b)};n.prototype._handlePointerPreventDefault=function(a,b){var c=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons,eventId:this._eventId++});b.preventDefault();this._callback(a,c)};n.prototype._handleMouseWheel=
function(a,b){b.preventDefault();var h=b.deltaY;switch(b.deltaMode){case 0:if(e||c)h=h/document.documentElement.clientHeight*600;break;case 1:h*=30;break;case 2:h*=900}e||c?h*=.7:d||l?h*=.6:m&&(h*=1.375);var g=Math.abs(h);100<g&&(h=h/g*200/(1+Math.exp(-.02*(g-100))));b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,deltaY:h});this._callback(a,b)};n.prototype._handlePointerCaptureLost=function(a,b){this._activePointerCaptures.delete(b.pointerId);this._handleDefault(a,b)};n.prototype._handleDefault=
function(a,b){var c={native:b};b.preventDefault();this._callback(a,c)};n.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};return n}();f.BrowserEventSource=p;var h={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave",
"pointer-cancel":"pointercancel",focus:"focus",blur:"blur"}})},"esri/core/libs/pep/pep":function(){define(function(){function p(a,b){b=b||Object.create(null);var c=document.createEvent("Event");c.initEvent(a,b.bubbles||!1,b.cancelable||!1);a=2;for(var d;a<m.length;a++)d=m[a],c[d]=b[d]||l[a];c.buttons=b.buttons||0;a=0;a=b.pressure?b.pressure:c.buttons?.5:0;c.x=c.clientX;c.y=c.clientY;c.pointerId=b.pointerId||0;c.width=b.width||0;c.height=b.height||0;c.pressure=a;c.tiltX=b.tiltX||0;c.tiltY=b.tiltY||
0;c.pointerType=b.pointerType||"";c.hwTimestamp=b.hwTimestamp||0;c.isPrimary=b.isPrimary||!1;return c}function f(){this.array=[];this.size=0}function k(a,b,c,d){this.addCallback=a.bind(d);this.removeCallback=b.bind(d);this.changedCallback=c.bind(d);C&&(this.observer=new C(this.mutationWatcher.bind(this)))}function a(a){return"body /shadow-deep/ "+g(a)}function g(a){return'[touch-action\x3d"'+a+'"]'}function b(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; touch-action-delay: none; }"}function e(){if(H){E.forEach(function(c){String(c)===
c?(G+=g(c)+b(c)+"\n",I&&(G+=a(c)+b(c)+"\n")):(G+=c.selectors.map(g)+b(c.rule)+"\n",I&&(G+=c.selectors.map(a)+b(c.rule)+"\n"))});var c=document.createElement("style");c.textContent=G;document.head.appendChild(c)}}function c(a){if(!r.pointermap.has(a))throw a=Error("InvalidPointerId"),a.name="InvalidPointerId",a;}function d(a){if(!a.ownerDocument.contains(a))throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var m="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),
l=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],h=window.Map&&window.Map.prototype.forEach?Map:f;f.prototype={set:function(a,b){if(void 0===b)return this.delete(a);this.has(a)||this.size++;this.array[a]=b},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,b){return this.array.forEach(function(c,d){a.call(b,c,d,this)},this)}};var n=
"bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),q=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],t={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},u="undefined"!==typeof SVGElementInstance,r={pointermap:new h,eventMap:Object.create(null),
captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,b){var c=b.events;c&&(c.forEach(function(a){b[a]&&(this.eventMap[a]=b[a].bind(b))},this),this.eventSources[a]=b,this.eventSourceList.push(b))},register:function(a){for(var b=this.eventSourceList.length,c=0,d;c<b&&(d=this.eventSourceList[c]);c++)d.register.call(d,a)},unregister:function(a){for(var b=this.eventSourceList.length,c=0,d;c<b&&(d=this.eventSourceList[c]);c++)d.unregister.call(d,
a)},contains:function(a,b){try{return a.contains(b)}catch(U){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",
a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var b=a.type;(b=this.eventMap&&this.eventMap[b])&&b(a);a._handledByPE=!0}},listen:function(a,b){b.forEach(function(b){this.addEvent(a,b)},this)},unlisten:function(a,b){b.forEach(function(b){this.removeEvent(a,b)},this)},addEvent:function(a,b){a.addEventListener(b,
this.boundHandler)},removeEvent:function(a,b){a.removeEventListener(b,this.boundHandler)},makeEvent:function(a,b){this.captureInfo[b.pointerId]&&(b.relatedTarget=null);a=new p(a,b);b.preventDefault&&(a.preventDefault=b.preventDefault);a._target=a._target||b.target;return a},fireEvent:function(a,b){a=this.makeEvent(a,b);return this.dispatchEvent(a)},cloneEvent:function(a){for(var b=Object.create(null),c,d=0;d<n.length;d++)c=n[d],b[c]=a[c]||q[d],u&&("target"===c||"relatedTarget"===c)&&b[c]instanceof
SVGElementInstance&&(b[c]=b[c].correspondingUseElement);a.preventDefault&&(b.preventDefault=function(){a.preventDefault()});return b},getTarget:function(a){var b=this.captureInfo[a.pointerId];if(!b)return a._target;if(a._target===b||!(a.type in t))return b},propagate:function(a,b,c){for(var d=a.target,e=[];!d.contains(a.relatedTarget)&&d!==document;)e.push(d),d=d.parentNode;c&&e.reverse();e.forEach(function(c){a.target=c;b.call(this,a)},this)},setCapture:function(a,b){this.captureInfo[a]&&this.releaseCapture(a);
this.captureInfo[a]=b;var c=new p("gotpointercapture");c.pointerId=a;this.implicitRelease=this.releaseCapture.bind(this,a);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);c._target=b;this.asyncDispatchEvent(c)},releaseCapture:function(a){var b=this.captureInfo[a];if(b){var c=new p("lostpointercapture");c.pointerId=a;this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",
this.implicitRelease);c._target=b;this.asyncDispatchEvent(c)}},dispatchEvent:function(a){var b=this.getTarget(a);if(b)return b.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,a))}};r.boundHandler=r.eventHandler.bind(r);var y={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var b=
a.olderShadowRoot;!b&&(a=a.querySelector("shadow"))&&(b=a.olderShadowRoot);return b},allShadows:function(a){var b=[];for(a=this.shadow(a);a;)b.push(a),a=this.olderShadow(a);return b},searchRoot:function(a,b,c){if(a){var d=a.elementFromPoint(b,c),e;for(e=this.targetingShadow(d);e;){if(a=e.elementFromPoint(b,c))return d=this.targetingShadow(a),this.searchRoot(d,b,c)||a;e=this.olderShadow(e)}return d}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==
Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var b=a.clientX,c=a.clientY;a=this.owner(a.target);a.elementFromPoint(b,c)||(a=document);return this.searchRoot(a,b,c)}},x=Array.prototype.forEach.call.bind(Array.prototype.forEach),z=Array.prototype.map.call.bind(Array.prototype.map),w=Array.prototype.slice.call.bind(Array.prototype.slice),B=Array.prototype.filter.call.bind(Array.prototype.filter),C=window.MutationObserver||window.WebKitMutationObserver,D={subtree:!0,childList:!0,
attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};k.prototype={watchSubtree:function(a){this.observer&&y.canTarget(a)&&this.observer.observe(a,D)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(a)},installNewSubtree:function(a){x(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},
addElement:function(a){this.addCallback(a)},elementChanged:function(a,b){this.changedCallback(a,b)},concatLists:function(a,b){return a.concat(w(b))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var b=z(a,this.findElements,this);b.push(B(a,this.isElement));return b.reduce(this.concatLists,[])},
mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,this)):"attributes"===a.type&&this.elementChanged(a.target,a.oldValue)}};var E=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],G="",H=window.PointerEvent||window.MSPointerEvent,I=!window.ShadowDOMPolyfill&&
document.head.createShadowRoot,N=r.pointermap,S=[1,4,2,8,16],M=!1;try{M=1===(new MouseEvent("test",{buttons:1})).buttons}catch(Z){}var P={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){r.listen(a,this.events)},unregister:function(a){r.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var b=this.lastTouches,c=a.clientX;a=a.clientY;for(var d=0,e=b.length,h;d<e&&(h=b[d]);d++){var l=Math.abs(a-h.y);if(25>=
Math.abs(c-h.x)&&25>=l)return!0}},prepareEvent:function(a){var b=r.cloneEvent(a),c=b.preventDefault;b.preventDefault=function(){a.preventDefault();c()};b.pointerId=this.POINTER_ID;b.isPrimary=!0;b.pointerType=this.POINTER_TYPE;return b},prepareButtonsForMove:function(a,b){var c=N.get(this.POINTER_ID);a.buttons=0!==b.which&&c?c.buttons:0;b.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=N.get(this.POINTER_ID),c=this.prepareEvent(a);M||(c.buttons=S[c.button],b&&
(c.buttons|=b.buttons),a.buttons=c.buttons);N.set(this.POINTER_ID,a);b&&0!==b.buttons?r.move(c):r.down(c)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);M||this.prepareButtonsForMove(b,a);b.button=-1;N.set(this.POINTER_ID,a);r.move(b)}},mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=N.get(this.POINTER_ID),c=this.prepareEvent(a);if(!M){var d=S[c.button];c.buttons=b?b.buttons&~d:0;a.buttons=c.buttons}N.set(this.POINTER_ID,a);c.buttons&=~S[c.button];
0===c.buttons?r.up(c):r.move(c)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);M||this.prepareButtonsForMove(b,a);b.button=-1;N.set(this.POINTER_ID,a);r.enterOver(b)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);M||this.prepareButtonsForMove(b,a);b.button=-1;r.leaveOut(b)}},cancel:function(a){a=this.prepareEvent(a);r.cancel(a);this.deactivateMouse()},deactivateMouse:function(){N.delete(this.POINTER_ID)}},O=r.captureInfo,
W=y.findTarget.bind(y),Q=y.allShadows.bind(y),J=r.pointermap,F,K={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){F.enableOnSubtree(a)},unregister:function(a){},elementAdded:function(a){var b=a.getAttribute("touch-action"),c=this.touchActionToScrollType(b);c&&(a._scrollType=c,r.listen(a,this.events),Q(a).forEach(function(a){a._scrollType=c;r.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;r.unlisten(a,this.events);Q(a).forEach(function(a){a._scrollType=
void 0;r.unlisten(a,this.events)},this)},elementChanged:function(a,b){var c=a.getAttribute("touch-action"),d=this.touchActionToScrollType(c);b=this.touchActionToScrollType(b);d&&b?(a._scrollType=d,Q(a).forEach(function(a){a._scrollType=d},this)):b?this.elementRemoved(a):d&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var b=this.scrollTypes;if("none"===a)return"none";if(a===
b.XSCROLLER)return"X";if(a===b.YSCROLLER)return"Y";if(b.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===J.size||1===J.size&&J.has(1))this.firstTouch=a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=
function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var b=0;if("touchstart"===a||"touchmove"===a)b=1;return b},touchToPointer:function(a){var b=this.currentTouchEvent,c=r.cloneEvent(a),d=c.pointerId=a.identifier+2;c.target=O[d]||W(c);c.bubbles=!0;c.cancelable=!0;c.detail=this.clickCount;c.button=0;c.buttons=this.typeToButtons(b.type);c.width=a.radiusX||a.webkitRadiusX||
0;c.height=a.radiusY||a.webkitRadiusY||0;c.pressure=a.force||a.webkitForce||.5;c.isPrimary=this.isPrimaryTouch(a);c.pointerType=this.POINTER_TYPE;c.altKey=b.altKey;c.ctrlKey=b.ctrlKey;c.metaKey=b.metaKey;c.shiftKey=b.shiftKey;var e=this;c.preventDefault=function(){e.scrolling=!1;e.firstXY=null;b.preventDefault()};return c},processTouches:function(a,b){var c=a.changedTouches;this.currentTouchEvent=a;a=0;for(var d;a<c.length;a++)d=c[a],b.call(this,this.touchToPointer(d))},shouldScroll:function(a){if(this.firstXY){var b;
b=a.currentTarget._scrollType;if("none"===b)b=!1;else if("XY"===b)b=!0;else{a=a.changedTouches[0];var c="Y"===b?"X":"Y";b=Math.abs(a["client"+b]-this.firstXY[b])>=Math.abs(a["client"+c]-this.firstXY[c])}this.firstXY=null;return b}},findTouch:function(a,b){for(var c=0,d=a.length,e;c<d&&(e=a[c]);c++)if(e.identifier===b)return!0},vacuumTouches:function(a){var b=a.touches;if(J.size>=b.length){var c=[];J.forEach(function(a,d){1===d||this.findTouch(b,d-2)||c.push(a.out)},this);c.forEach(this.cancelOut,
this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){J.set(a.pointerId,{target:a.target,out:a,outTarget:a.target});r.enterOver(a);r.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var b=J.get(a.pointerId);
if(b){var c=b.out,d=b.outTarget;r.move(a);c&&d!==a.target&&(c.relatedTarget=a.target,a.relatedTarget=d,c.target=d,a.target?(r.leaveOut(c),r.enterOver(a)):(a.target=d,a.relatedTarget=null,this.cancelOut(a)));b.out=a;b.outTarget=a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||(r.up(a),r.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){r.cancel(a);r.leaveOut(a);
this.cleanUpPointer(a)},cleanUpPointer:function(a){J.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var b=P.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},b.push(a),b=function(a,b){b=a.indexOf(b);-1<b&&a.splice(b,1)}.bind(null,b,a),setTimeout(b,2500))}};F=new k(K.elementAdded,K.elementRemoved,K.elementChanged,K);var L=r.pointermap,T=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,R={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),
register:function(a){r.listen(a,this.events)},unregister:function(a){r.unlisten(a,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var b=a;T&&(b=r.cloneEvent(a),b.pointerType=this.POINTER_TYPES[a.pointerType]);return b},cleanup:function(a){L.delete(a)},MSPointerDown:function(a){L.set(a.pointerId,a);a=this.prepareEvent(a);r.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);r.move(a)},MSPointerUp:function(a){var b=this.prepareEvent(a);r.up(b);this.cleanup(a.pointerId)},
MSPointerOut:function(a){a=this.prepareEvent(a);r.leaveOut(a)},MSPointerOver:function(a){a=this.prepareEvent(a);r.enterOver(a)},MSPointerCancel:function(a){var b=this.prepareEvent(a);r.cancel(b);this.cleanup(a.pointerId)},MSLostPointerCapture:function(a){a=r.makeEvent("lostpointercapture",a);r.dispatchEvent(a)},MSGotPointerCapture:function(a){a=r.makeEvent("gotpointercapture",a);r.dispatchEvent(a)}},X,ba;window.navigator.msPointerEnabled?(X=function(a){c(a);d(this);0!==r.pointermap.get(a).buttons&&
this.msSetPointerCapture(a)},ba=function(a){c(a);this.msReleasePointerCapture(a)}):(X=function(a){c(a);d(this);0!==r.pointermap.get(a).buttons&&r.setCapture(a,this)},ba=function(a){c(a);r.releaseCapture(a,this)});var ca=window.PointerEvent||window.MSPointerEvent;return{dispatcher:r,Installer:k,PointerEvent:p,PointerMap:h,targetFinding:y,applyGlobal:function(){e();window.PointerEvent||(window.PointerEvent=p,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",
{value:window.navigator.msMaxTouchPoints,enumerable:!0}),r.registerSource("ms",R)):(r.registerSource("mouse",P),void 0!==window.ontouchstart&&r.registerSource("touch",K)),r.register(document));window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:X},releasePointerCapture:{value:ba}})},applyLocal:function(a){ca||(window.PointerEvent||(window.navigator.msPointerEnabled?r.registerSource("ms",R):(r.registerSource("mouse",P),void 0!==
window.ontouchstart&&r.registerSource("touch",K)),r.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=X.bind(a),a.releasePointerCapture=ba.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action","none"))}}})},"esri/views/input/keys":function(){define(["require","exports","../../core/has"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.primaryKey=k("mac")?"Meta":"Ctrl";var a={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",
33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(p=48;58>p;p++)a[p]=String.fromCharCode(p);for(p=1;25>p;p++)a[111+p]="F"+p;for(p=65;91>p;p++)a[p]=[String.fromCharCode(p+32),String.fromCharCode(p)];var g={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Esc:"Escape"};f.eventKey=function(b){if(void 0!==b.key)return g[b.key]||b.key;var e=a[b.keyCode];return Array.isArray(e)?b.shiftKey?e[1]:e[0]:e};f.isSystemModifier=
function(a){switch(a){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}}})},"esri/views/input/gamepad/GamepadSource":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/scheduling ./GamepadInputDevice ./GamepadState".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function e(a,d){var c=this;this.element=a;this.input=d;this.handleGamepadConnectedEvent=function(a){c.handleGamepadConnected(a.gamepad)};
this.handleGamepadDisconnectedEvent=function(a){a=a.gamepad;var d=c.inputDevices[a.index];d&&(c.emitGamepadEvent(a,b.extractState(d),!1),c.inputDevices[a.index]=void 0,c.latestUpdate[a.index]=void 0,c.input.gamepad.devices.remove(d))};this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(function(a){return c.handleGamepadConnected(a)}),window.addEventListener("gamepadconnected",this.handleGamepadConnectedEvent),
window.addEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent)}e.prototype.destroy=function(){this.pollingEnabled=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent))};Object.defineProperty(e.prototype,"onEvent",{set:function(a){this.callback=a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"pollingEnabled",{set:function(a){this.supported&&
(a?this.startPolling():this.stopPolling())},enumerable:!0,configurable:!0});e.prototype.handleGamepadConnected=function(a){var b=new g(a);"unknown"!==b.deviceType&&(this.inputDevices[a.index]=b,this.input.gamepad.devices.add(b))};e.prototype.startPolling=function(){var b=this;null==this.frameTask&&(this.frameTask=a.addFrameTask({update:function(){return b.readGamepadState()}}))};e.prototype.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=
[])};e.prototype.readGamepadState=function(){var a=this,d=document.hasFocus(),e=this.element.contains(document.activeElement),l="document"===this.input.gamepad.enabledFocusMode&&!d||"view"===this.input.gamepad.enabledFocusMode&&!e;this.forEachGamepad(function(c){var d=a.inputDevices[c.index];if(d){var e=a.latestUpdate[c.index],d=b.extractState(d),h=l||b.stateIdle(d);e&&(e.timestamp===c.timestamp||!e.active&&h||b.stateEqual(e.state,d))||a.emitGamepadEvent(c,d,!h)}})};e.prototype.forEachGamepad=function(a){for(var b=
window.navigator.getGamepads(),c=0;c<b.length;c++){var e=b[c];this.validate(e)&&a(e)}};e.prototype.emitGamepadEvent=function(a,b,e){var c=this.latestUpdate[a.index];if((c=c&&c.active)||e)this.latestUpdate[a.index]={timestamp:a.timestamp,state:b,active:e},this.callback&&this.callback({device:this.inputDevices[a.index],state:b,action:!c&&e?"start":c&&e?"update":"end"})};e.prototype.validate=function(a){if(!a||!a.connected)return!1;for(var b=0;b<a.axes.length;b++)if(isNaN(a.axes[b]))return!1;return!0};
return e}();f.GamepadSource=p})},"esri/views/input/gamepad/GamepadState":function(){define(["require","exports","../../3d/support/mathUtils"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.extractState=function(a){var g=a.native;return{buttons:g.buttons.map(function(a){return a.pressed?a.value?a.value:1:0}),axes:g.axes.map(function(b){var e=a.axisThreshold,c=Math.abs(b);b=c<e?0:k.sign(b)*(c-e)/(1-e);return b})}};f.stateEqual=function(a,g){if(a.axes.length!==g.axes.length||a.buttons.length!==
g.buttons.length)return!1;for(var b=0;b<a.axes.length;b++)if(a.axes[b]!==g.axes[b])return!1;for(b=0;b<a.buttons.length;b++)if(a.buttons[b]!==g.buttons[b])return!1;return!0};f.stateIdle=function(a){for(var g=0;g<a.axes.length;g++)if(0!==a.axes[g])return!1;for(g=0;g<a.buttons.length;g++)if(0!==a.buttons[g])return!1;return!0}})},"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Logger ../../core/now ../../core/accessorSupport/decorators ./keys ./recognizers ./handlers/LatestPointerType".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){Object.defineProperty(f,"__esModule",{value:!0});var h=b.getLogger("esri.views.input.InputManager");p=function(b){function g(a,c){a=b.call(this)||this;a._pointerCaptures=new Map;a._nameToGroup={};a._handlers=[];a._currentPropagation=null;a._sourceEvents=new Set;a._keyModifiers=new Set;a._activeKeyModifiers=new Set;a.primaryKey=d.primaryKey;a.latestPointerType="mouse";a._installRecognizers();return a}k(g,b);g.prototype.normalizeCtorArgs=function(a,b){this._browserEvents=
a;this._browserEvents.onEventReceived=this._onEventReceived.bind(this);this._recognizers=b;this._recognizers||(this._recognizers=m.defaults.map(function(a){return new a}));return{}};g.prototype.destroy=function(){for(var a=0,b=Object.keys(this._nameToGroup);a<b.length;a++)this.uninstallHandlers(b[a]);this._browserEvents=null};Object.defineProperty(g.prototype,"hasPendingInputs",{get:function(){return this._handlers.some(function(a){return a.handler.hasPendingInputs})},enumerable:!0,configurable:!0});
g.prototype.installHandlers=function(a,b){var c=this;if(this._nameToGroup[a])h.error("There is already an InputHandler group registered under the name `"+a+"`");else if(0===b.length)h.error("Can't register a group of zero handlers");else{var d={name:a,handlers:b.map(function(a,b){return{handler:a,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};this._nameToGroup[a]=d;a=function(a){var b=d.handlers[a];e._handlers.push(b);b.handler.onInstall({updateDependencies:function(){c.updateDependencies()},
emit:function(a,d,e,h){c._emitInputEvent(b.priorityIndex,a,d,e,h)},setPointerCapture:function(a,e){c._setPointerCapture(d,b,a,e)},setEventCallback:function(a){b.eventCallback=a},setUninstallCallback:function(a){b.uninstallCallback=a},refreshHasPendingInputs:function(){c.notifyChange("hasPendingInputs")}})};var e=this;for(b=d.handlers.length-1;0<=b;b--)a(b);this.updateDependencies()}};g.prototype.uninstallHandlers=function(a){var b=this._nameToGroup[a];b?(b.handlers.forEach(function(a){a.removed=!0;
a.uninstallCallback()}),delete this._nameToGroup[a],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):h.error("There is no InputHandler group registered under the name `"+a+"`")};g.prototype.hasHandlers=function(a){return void 0!==this._nameToGroup[a]};g.prototype.updateDependencies=function(){var a=new Set,b=new Set;this._handlersPriority=[];for(var c=this._handlers.length-1;0<=c;c--){var e=this._handlers[c];e.priorityIndex=c;this._handlersPriority.push(e)}this._handlersPriority=
this._sortHandlersPriority(this._handlersPriority);for(c=this._handlersPriority.length-1;0<=c;c--){e=this._handlersPriority[c];e.priorityIndex=c;var h=e.handler.hasSideEffects;if(!h)for(var l=0,g=e.handler.outgoingEventTypes;l<g.length;l++)if(a.has(g[l])){h=!0;break}if(h)for(l=0,g=e.handler.incomingEventMatches;l<g.length;l++){var m=g[l];a.add(m.eventType);for(var n=0,m=m.keyModifiers;n<m.length;n++){var q=m[n];d.isSystemModifier(q)||b.add(q)}}e.active=h}this._sourceEvents=a;this._keyModifiers=b;
0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)};g.prototype._setLatestPointerType=function(a){this._set("latestPointerType",a)};g.prototype._onEventReceived=function(a,b){"pointer-capture-lost"===a&&this._pointerCaptures.delete(b.native.pointerId);this._updateKeyModifiers(a,b);this._emitInputEventFromSource(a,
b,b.native?b.native.timestamp:void 0)};g.prototype._updateKeyModifiers=function(a,b){var c=this;if(b){var d=!1,e=function(){if(!d){var a=new Set;c._activeKeyModifiers.forEach(function(b){a.add(b)});c._activeKeyModifiers=a;d=!0}},h=function(a,b){b&&!c._activeKeyModifiers.has(a)?(e(),c._activeKeyModifiers.add(a)):!b&&c._activeKeyModifiers.has(a)&&(e(),c._activeKeyModifiers.delete(a))};if("key-down"===a||"key-up"===a){var l=b.key;this._keyModifiers.has(l)&&h(l,"key-down"===a)}a=b.native;h("Alt",!(!a||
!a.altKey));h("Ctrl",!(!a||!a.ctrlKey));h("Shift",!(!a||!a.shiftKey));h("Meta",!(!a||!a.metaKey));h("Primary",this._activeKeyModifiers.has(this.primaryKey))}};g.prototype._installRecognizers=function(){var a=this;this._latestPointerTypeHandler=new l.LatestPointerType(function(b){return a._setLatestPointerType(b)});0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])};g.prototype._setPointerCapture=
function(a,b,c,d){a=a.name+"-"+b.priorityIndex;b=this._pointerCaptures.get(c.pointerId)||new Set;this._pointerCaptures.set(c.pointerId,b);d?(b.add(a),1===b.size&&this._browserEvents&&this._browserEvents.setPointerCapture(c,!0)):b.has(a)&&(b.delete(a),0===b.size&&(this._pointerCaptures.delete(c.pointerId),this._browserEvents&&this._browserEvents.setPointerCapture(c,!1)))};g.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(a){return!a.removed});this.updateDependencies()};
g.prototype._emitInputEventFromSource=function(a,b,c){this._emitInputEvent(0,a,b,c)};g.prototype._emitInputEvent=function(a,b,c,d,h){d=void 0!==d?d:this._currentPropagation?this._currentPropagation.timestamp:e();b=new n(b,c,d,h||this._activeKeyModifiers);this._currentPropagation?this._currentPropagation.addedEvents.push(b):this._doNewPropagation(a,b)};g.prototype._doNewPropagation=function(a,b){for(a=this._currentPropagation={events:[b],addedEvents:[],currentHandler:this._handlersPriority[a],needsHandlerGarbageCollect:!1,
timestamp:b.timestamp};a.currentHandler;){if(a.currentHandler.removed)a.needsHandlerGarbageCollect=!0;else{b=a.events;var c=[];a.addedEvents=[];for(var d=0;d<b.length;d++){var e=b[d];a.currentHandler.active&&a.currentHandler.eventCallback(e);e.shouldStopPropagation()||c.push(e)}a.events=c.concat(a.addedEvents)}a.currentHandler=this._handlersPriority[a.currentHandler.priorityIndex+1]}a.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=null};g.prototype._compareHandlerPriority=
function(a,b){if(a.handler.hasSideEffects!==b.handler.hasSideEffects)return a.handler.hasSideEffects?1:-1;for(var c=0,d=a.handler.incomingEventMatches;c<d.length;c++)for(var e=d[c],h=function(a){if(e.eventType!==a.eventType)return"continue";var b=e.keyModifiers.filter(function(b){return-1!==a.keyModifiers.indexOf(b)});if(b.length===e.keyModifiers.length!==(b.length===a.keyModifiers.length))return{value:e.keyModifiers.length>a.keyModifiers.length?-1:1}},l=0,g=b.handler.incomingEventMatches;l<g.length;l++){var m=
h(g[l]);if("object"===typeof m)return m.value}return a.priorityIndex>b.priorityIndex?-1:1};g.prototype._sortHandlersPriority=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e=0;e<b.length&&0<=this._compareHandlerPriority(d,b[e]);)e++;b.splice(e,0,d)}return b};Object.defineProperty(g.prototype,"debug",{get:function(){var a=this,b=function(b){var c=a._setPointerCapture;a._setPointerCapture=function(){};b();a._setPointerCapture=c};return{injectEvent:function(c,d){b(function(){a._onEventReceived(c,
d)})},disablePointerCapture:b}},enumerable:!0,configurable:!0});a([c.property({readOnly:!0})],g.prototype,"hasPendingInputs",null);a([c.property({readOnly:!0})],g.prototype,"latestPointerType",void 0);return g=a([c.subclass("esri.views.input.InputManager")],g)}(c.declared(g));f.InputManager=p;var n=function(){function a(a,b,c,d){this.type=a;this.data=b;this.timestamp=c;this.modifiers=d;this._stopPropagation=!1}a.prototype.stopPropagation=function(){this._stopPropagation=!0};a.prototype.shouldStopPropagation=
function(){return this._stopPropagation};return a}()})},"esri/views/input/recognizers":function(){define("require exports ./recognizers/Drag ./recognizers/PointerClickHoldAndDrag ./recognizers/SingleAndDoubleClick ./recognizers/VerticalTwoFingerDrag".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});f.defaults=[a.PointerClickHoldAndDrag,g.SingleAndDoubleClick,k.Drag,b.VerticalTwoFingerDrag]})},"esri/views/input/recognizers/Drag":function(){define(["require","exports",
"../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(p,f,k,a,g){function b(a){var b=[];a.forEach(function(a){b.push(a.event)});return g.fitCircleLSQ(b)}function e(a){var c=b(a),e=0;a.forEach(function(a){for(var b=d(a,c),b=b-a.lastAngle;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=a.lastAngle+b;a.lastAngle=b;e+=b-a.initialAngle});e/=a.size||1;return{angle:e,radius:c.radius,center:c.center}}function c(a){var b=new Map;a.forEach(function(a,c){return b.set(c,a.event)});
return b}function d(a,b){a=a.event;return Math.atan2(a.y-b.center.y,a.x-b.center.x)}Object.defineProperty(f,"__esModule",{value:!0});p=function(a){function l(){var b=a.call(this,!1)||this;b.startStateModifiers=new Set;b.activePointerMap=new Map;b.isDragging=!1;b.drag=b.registerOutgoing("drag");b.registerIncoming("pointer-drag",b.handlePointerDrag.bind(b));b.registerIncoming("pointer-up",b.handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-capture-lost",b.handlePointerUpAndPointerLost.bind(b));
b.registerIncoming("pointer-cancel",b.handlePointerUpAndPointerLost.bind(b));return b}k(l,a);l.prototype.createPayload=function(a,b,d,e){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:b.buttons,timestamp:e,pointers:c(this.activePointerMap),pointer:b,angle:d.angle,radius:d.radius,center:d.center}};l.prototype.addPointer=function(a){var c=a.native.pointerId,h=e(this.activePointerMap).angle;a={event:a,initialAngle:0,lastAngle:0};this.activePointerMap.set(c,a);c=d(a,b(this.activePointerMap));
a.initialAngle=c;a.lastAngle=c;this.updatePointerAngles(h)};l.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var b=this.activePointerMap.get(a.native.pointerId);b?b.event=a:this.addPointer(a)}};l.prototype.removePointer=function(a){var b=e(this.activePointerMap).angle;this.activePointerMap.delete(a);this.updatePointerAngles(b)};l.prototype.updatePointerAngles=function(a){var b=e(this.activePointerMap);this.activePointerMap.forEach(function(c){c.initialAngle=d(c,b)-a;c.lastAngle=
d(c,b)-a})};l.prototype.emitEvent=function(a,b,c){var d=e(this.activePointerMap);this.drag.emit(this.createPayload(a,b,d,c),void 0,this.startStateModifiers)};l.prototype.handlePointerUpAndPointerLost=function(a){var b=a.data.native.pointerId,c=a.timestamp;this.activePointerMap.get(b)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),this.emitEvent("end",a.data,c),this.isDragging=!1,this.removePointer(b)):(this.removePointer(b),this.emitEvent("removed",a.data,a.timestamp)))};l.prototype.handlePointerDrag=
function(a){var b=a.data,c=b.currentEvent,d=a.timestamp;switch(b.action){case "start":case "update":this.isDragging?this.activePointerMap.has(c.native.pointerId)?(this.updatePointer(c),this.emitEvent("update",c,d)):(this.addPointer(c),this.emitEvent("added",c,d)):(this.updatePointer(c),this.pointerType=a.data.startEvent.pointerType,this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.emitEvent("start",c,d))}};return l}(a.InputHandler);f.Drag=p;(function(a){a[a.Left=
0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(f.Button||(f.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.manhattanDistance=function(k,a){return Math.abs(a.x-k.x)+Math.abs(a.y-k.y)};f.euclideanDistance=function(k,a){var g=a.x-k.x;k=a.y-k.y;return Math.sqrt(g*g+k*k)};f.fitCircleLSQ=function(k,a){a?(a.radius=
0,a.center.x=0,a.center.y=0):a={radius:0,center:{x:0,y:0}};if(0===k.length)return a;if(1===k.length)return a.center.x=k[0].x,a.center.y=k[0].y,a;if(2===k.length){var g=k[0];k=k[1];var b=[k.x-g.x,k.y-g.y],e=b[0],b=b[1];a.radius=Math.sqrt(e*e+b*b)/2;a.center.x=(g.x+k.x)/2;a.center.y=(g.y+k.y)/2;return a}for(var c=0,d=0,m=0;m<k.length;m++)c+=k[m].x,d+=k[m].y;for(var c=c/k.length,d=d/k.length,l=k.map(function(a){return a.x-c}),h=k.map(function(a){return a.y-d}),n=g=a=0,q=0,f=e=0,m=b=0;m<l.length;m++){var u=
l[m],r=h[m],y=u*u,x=r*r;a+=y;g+=x;n+=u*r;q+=y*u;e+=x*r;f+=u*x;b+=r*y}m=a;l=n;h=g;q=.5*(q+f);e=.5*(e+b);b=m*h-n*l;f=(q*h-e*l)/b;e=(m*e-n*q)/b;return{radius:Math.sqrt(f*f+e*e+(a+g)/k.length),center:{x:f+c,y:e+d}}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../InputHandler ./support".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});f.DefaultParameters={maximumClickDelay:300,
movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};p=function(e){function c(b,c,l,h,g){void 0===b&&(b=f.DefaultParameters.maximumClickDelay);void 0===c&&(c=f.DefaultParameters.movementUntilMouseDrag);void 0===l&&(l=f.DefaultParameters.movementUntilTouchDrag);void 0===h&&(h=f.DefaultParameters.holdDelay);void 0===g&&(g=a.default);var d=e.call(this,!1)||this;d.maximumClickDelay=b;d.movementUntilMouseDrag=c;d.movementUntilTouchDrag=l;d.holdDelay=h;d._clock=g;d._pointerState=new Map;d._pointerDrag=
d.registerOutgoing("pointer-drag");d._immediateClick=d.registerOutgoing("immediate-click");d._pointerHold=d.registerOutgoing("hold");d.registerIncoming("pointer-down",d._handlePointerDown.bind(d));d.registerIncoming("pointer-up",function(a){d._handlePointerLoss(a,"pointer-up")});d.registerIncoming("pointer-capture-lost",function(a){d._handlePointerLoss(a,"pointer-capture-lost")});d.registerIncoming("pointer-cancel",function(a){d._handlePointerLoss(a,"pointer-cancel")});d._moveHandle=d.registerIncoming("pointer-move",
d._handlePointerMove.bind(d));d._moveHandle.pause();return d}k(c,e);c.prototype.onUninstall=function(){this._pointerState.forEach(function(a){null!=a.holdTimeout&&(a.holdTimeout.remove(),a.holdTimeout=null)});e.prototype.onUninstall.call(this)};c.prototype._handlePointerDown=function(a){var b=this,c=a.data,d=c.native.pointerId,e=null;0===this._pointerState.size&&(e=this._clock.setTimeout(function(){var c=b._pointerState.get(d);c&&(c.isDragging||(b._pointerHold.emit(c.previousEvent,void 0,a.modifiers),
c.holdEmitted=!0),c.holdTimeout=null)},this.holdDelay));e={startEvent:c,previousEvent:c,startTimestamp:a.timestamp,isDragging:!1,downButton:c.native.button,holdTimeout:e,modifiers:new Set};this._pointerState.set(d,e);this.startCapturingPointer(c.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(a)};c.prototype._createPointerDragData=function(a,b,c){return{action:a,startEvent:b.startEvent,previousEvent:b.previousEvent,currentEvent:c}};c.prototype._handlePointerMove=function(a){var c=
a.data,d=this._pointerState.get(c.native.pointerId);d&&(d.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",d,c),void 0,d.modifiers):b.euclideanDistance(c,d.startEvent)>("touch"===c.native.pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&this.startDragging(a),d.previousEvent=c)};c.prototype.startDragging=function(a){var b=this,c=a.data,d=c.native.pointerId;this._pointerState.forEach(function(e){null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null);
e.isDragging||(e.modifiers=a.modifiers,e.isDragging=!0,d===e.startEvent.native.pointerId?b._pointerDrag.emit(b._createPointerDragData("start",e,c)):b._pointerDrag.emit(b._createPointerDragData("start",e,e.previousEvent),a.timestamp))})};c.prototype._handlePointerLoss=function(a,b){var c=a.data,d=c.native.pointerId,e=this._pointerState.get(d);e&&(null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null),e.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",e,"pointer-up"===b?
c:e.previousEvent),void 0,e.modifiers):"pointer-up"===b&&e.downButton===c.native.button&&a.timestamp-e.startTimestamp<=this.maximumClickDelay&&!e.holdEmitted&&this._immediateClick.emit(c),this._pointerState.delete(d),this.stopCapturingPointer(c.native),0===this._pointerState.size&&this._moveHandle.pause())};return c}(g.InputHandler);f.PointerClickHoldAndDrag=p})},"esri/core/clock":function(){define(["require","exports","./global"],function(p,f,k){function a(a){return{setTimeout:function(b,e){var c=
a.setTimeout(b,e);return{remove:function(){return a.clearTimeout(c)}}}}}Object.defineProperty(f,"__esModule",{value:!0});f.wrap=a;f.default=a(k)})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../../../core/iteratorUtils ../InputHandler ./support".split(" "),function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});f.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,
maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};p=function(b){function c(c,d,e,g,q){void 0===c&&(c=f.DefaultParameters.maximumDoubleClickDelay);void 0===d&&(d=f.DefaultParameters.maximumDoubleClickDistance);void 0===e&&(e=f.DefaultParameters.maximumDoubleTouchDelay);void 0===g&&(g=f.DefaultParameters.maximumDoubleTouchDistance);void 0===q&&(q=a.default);var h=b.call(this,!1)||this;h.maximumDoubleClickDelay=c;h.maximumDoubleClickDistance=d;h.maximumDoubleTouchDelay=e;h.maximumDoubleTouchDistance=
g;h._clock=q;h._pointerState=new Map;h._click=h.registerOutgoing("click");h._doubleClick=h.registerOutgoing("double-click");h.registerIncoming("immediate-click",h._handleImmediateClick.bind(h));h.registerIncoming("pointer-drag",h._handlePointerDrag.bind(h));h.registerIncoming("drag",h._handleDrag.bind(h));return h}k(c,b);c.prototype.onUninstall=function(){this._pointerState.forEach(function(a){null!=a.doubleClickTimeout&&(a.doubleClickTimeout.remove(),a.doubleClickTimeout=null)})};Object.defineProperty(c.prototype,
"hasPendingInputs",{get:function(){return!g.everyMap(this._pointerState,function(a){return null==a.doubleClickTimeout})},enumerable:!0,configurable:!0});c.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};c.prototype._handleImmediateClick=function(a){var b=a.data,c=this._pointerId(b),d=this._pointerState.get(c);if(d){var g="touch"===b.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;e.manhattanDistance(d.event.data,
b)>g?(this._clearDoubleClickTimeout(c,!0),this._startClick(a)):(this._clearDoubleClickTimeout(c,!1),this._doubleClick.emit(b,void 0,d.event.modifiers))}else this._startClick(a)};c.prototype._startClick=function(a){var b=this,c=this._pointerId(a.data);this._pointerState.set(c,{event:a,doubleClickTimeout:this._clock.setTimeout(function(){return b._doubleClickTimeoutExceeded(c)},"touch"===a.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};
c.prototype._handlePointerDrag=function(a){a=this._pointerId(a.data.currentEvent);this._clearDoubleClickTimeout(a,!0)};c.prototype._handleDrag=function(a){a=this._pointerId(a.data.pointer);this._clearDoubleClickTimeout(a,!0)};c.prototype._clearDoubleClickTimeout=function(a,b){var c=this._pointerState.get(a);c&&(c.doubleClickTimeout.remove(),c.doubleClickTimeout=null,b&&this._doubleClickTimeoutExceeded(a),this._pointerState.delete(a),this.refreshHasPendingInputs())};c.prototype._doubleClickTimeoutExceeded=
function(a){var b=this._pointerState.get(a);this._click.emit(b.event.data,void 0,b.event.modifiers);b.doubleClickTimeout=null;this._pointerState.delete(a);this.refreshHasPendingInputs()};return c}(b.InputHandler);f.SingleAndDoubleClick=p})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../DragEventSeparator","../InputHandler"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function e(c,
d){void 0===c&&(c=20);void 0===d&&(d=40);var e=b.call(this,!1)||this;e._threshold=c;e._maxDelta=d;e.state="ready";e.emittedArtificalEnd2=!1;e._vertical=e.registerOutgoing("vertical-two-finger-drag");e._artificalDrag=e.registerOutgoing("drag");e.dragEventSeparator=new a.DragEventSeparator({start:function(a,b){return e.observeStart(a,b)},update:function(a,b,c){return e.observeUpdate(a,b,c)},end:function(a,b){return e.observeEnd(a,b)}});e.registerIncoming("drag",function(a){return e.dragEventSeparator.handle(a)});
return e}k(e,b);Object.defineProperty(e.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0});e.prototype.observeStart=function(a,b){1===a&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),
b.stopPropagation());this.state=2===a?"ready":"failed"};e.prototype.observeUpdate=function(a,b,e){"failed"!==this.state&&2===a&&("active"===this.state?(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"update"}),b.stopPropagation()):this.checkMovementWithinLimits(b.data,e.data)?this.checkVerticalThresholdReached(b.data,e.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=b.data.center,this._artificalDrag.emit({action:"end",button:b.data.button,
buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),b.stopPropagation()):this.state="failed")};e.prototype.observeEnd=function(a,b){"active"===this.state&&(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",
b.stopPropagation())};e.prototype.checkMovementWithinLimits=function(a,b){var c=-Infinity,d=Infinity,e=-Infinity,g=Infinity;b.pointers.forEach(function(a){c=Math.max(c,a.x);d=Math.min(d,a.x);e=Math.max(e,a.y);g=Math.min(g,a.y)});var q=-Infinity,k=Infinity,f=-Infinity,r=Infinity;a.pointers.forEach(function(a){q=Math.max(q,a.x);k=Math.min(k,a.x);f=Math.max(f,a.y);r=Math.min(r,a.y)});return Math.abs(a.center.x-b.center.x)<this._threshold&&Math.abs(q-k-(c-d))<=this._maxDelta&&Math.abs(f-r-(e-g))<=this._maxDelta};
e.prototype.checkVerticalThresholdReached=function(a,b){var c=Math.abs(a.center.y-b.center.y);a.pointers.forEach(function(a,d){d=b.pointers.get(d);c=Math.min(c,Math.abs(a.y-d.y))});return c>=this._threshold};return e}(g.InputHandler);f.VerticalTwoFingerDrag=p})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function k(a){this.callbacks=a;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=
function(){return!0})}k.prototype.handle=function(a){var g=a.data,b=g.pointers.size;switch(g.action){case "start":this.currentCount=b;this.emitStart(a);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=b;this.emitStart(a);break;case "update":this.emitUpdate(a);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=b;this.emitStart(a);break;case "end":this.emitEnd(a),this.currentCount=0}this.previousEvent=a};k.prototype.emitStart=function(a){this.startEvent=
a;this.callbacks.condition(this.currentCount,a)&&this.callbacks.start(this.currentCount,a,this.startEvent)};k.prototype.emitUpdate=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.update(this.currentCount,a,this.startEvent)};k.prototype.emitEnd=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.end(this.currentCount,a,this.startEvent);this.startEvent=null};return k}();f.DragEventSeparator=p})},"esri/views/input/handlers/LatestPointerType":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(a){function b(b){var c=a.call(this,!0)||this;c._onChange=b;c._value="mouse";c.registerIncoming("pointer-down",function(a){c._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});c._moveHandler=c.registerIncoming("pointer-move",function(a){c._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});c._moveHandler.pause();return c}k(b,a);
b.prototype._setValue=function(a){a!==this._value&&("touch"===a?this._moveHandler.resume():this._moveHandler.pause(),this._value=a,this._onChange(a))};return b}(a.InputHandler);f.LatestPointerType=p})},"esri/views/input/ViewEvents":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/compilerUtils ../../geometry/ScreenPoint ../3d/support/mathUtils ./InputHandler".split(" "),function(p,f,k,a,g,b,e){function c(a){return!!m[a]}function d(a){for(var b=0;b<a.length;b++)if(!c(a[b]))return!1;
return!0}Object.defineProperty(f,"__esModule",{value:!0});var m={click:!0,"double-click":!0,"immediate-click":!0,hold:!0,drag:!0,"key-down":!0,"key-up":!0,"pointer-down":!0,"pointer-move":!0,"pointer-up":!0,"pointer-drag":!0,"mouse-wheel":!0,"pointer-enter":!0,"pointer-leave":!0,gamepad:!0,focus:!0,blur:!0},l;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"})(l||(l={}));p=function(){function a(a){this.handlers=new Map;this.counter=0;this.handlerCounts=new Map;this.view=
a;this.inputManager=null}a.prototype.connect=function(a){var b=this;a&&this.disconnect();this.inputManager=a;this.handlers.forEach(function(a,c){return b.inputManager.installHandlers(c,[a])})};a.prototype.disconnect=function(){var a=this;this.inputManager&&this.handlers.forEach(function(b,c){return a.inputManager.uninstallHandlers(c)});this.inputManager=null};a.prototype.destroy=function(){this.disconnect();this.handlers.clear();this.view=null};a.prototype.register=function(a,b,e){var l=this,g=Array.isArray(a)?
a:a.split(",");if(!d(g))return g.some(c)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;a=Array.isArray(b)?b:[];e=Array.isArray(b)?e:b;var m=this.createUniqueGroupName();b=new h(this.view,g,a,e);this.handlers.set(m,b);for(e=0;e<g.length;e++){a=g[e];var n=this.handlerCounts.get(a)||0;this.handlerCounts.set(a,n+1)}this.inputManager&&this.inputManager.installHandlers(m,[b]);return{remove:function(){return l.removeHandler(m,g)}}};
a.prototype.hasHandler=function(a){return!!this.handlerCounts.get(a)};a.prototype.removeHandler=function(a,b){if(this.handlers.has(a)){this.handlers.delete(a);for(var c=0;c<b.length;c++){var d=b[c],e=this.handlerCounts.get(d);void 0===e?console.error("Trying to remove handler for event that has no handlers registered: ",d):1===e?this.handlerCounts.delete(d):this.handlerCounts.set(d,e-1)}}this.inputManager&&this.inputManager.uninstallHandlers(a)};a.prototype.createUniqueGroupName=function(){this.counter+=
1;return"viewEvents_"+this.counter};return a}();f.ViewEvents=p;var h=function(c){function d(b,d,e,h){var g=c.call(this,!0)||this;g.view=b;for(b=0;b<d.length;b++){var l=d[b];switch(l){case "click":g.registerIncoming("click",e,function(a){return h(g.wrapClick(a))});break;case "double-click":g.registerIncoming("double-click",e,function(a){return h(g.wrapDoubleClick(a))});break;case "immediate-click":g.registerIncoming("immediate-click",e,function(a){return h(g.wrapImmediateClick(a))});break;case "hold":g.registerIncoming("hold",
e,function(a){return h(g.wrapHold(a))});break;case "drag":g.registerIncoming("drag",e,function(a){(a=g.wrapDrag(a))&&h(a)});break;case "key-down":g.registerIncoming("key-down",e,function(a){return h(g.wrapKeyDown(a))});break;case "key-up":g.registerIncoming("key-up",e,function(a){return h(g.wrapKeyUp(a))});break;case "pointer-down":g.registerIncoming("pointer-down",e,function(a){return h(g.wrapPointer(a,"pointer-down"))});break;case "pointer-move":g.registerIncoming("pointer-move",e,function(a){return h(g.wrapPointer(a,
"pointer-move"))});break;case "pointer-up":g.registerIncoming("pointer-up",e,function(a){return h(g.wrapPointer(a,"pointer-up"))});break;case "pointer-drag":g.registerIncoming("pointer-drag",e,function(a){return h(g.wrapPointerDrag(a))});break;case "mouse-wheel":g.registerIncoming("mouse-wheel",e,function(a){return h(g.wrapMouseWheel(a))});break;case "pointer-enter":g.registerIncoming("pointer-enter",e,function(a){return h(g.wrapPointer(a,"pointer-enter"))});break;case "pointer-leave":g.registerIncoming("pointer-leave",
e,function(a){return h(g.wrapPointer(a,"pointer-leave"))});break;case "gamepad":g.registerIncoming("gamepad",e,function(a){h(g.wrapGamepad(a))});break;case "focus":g.registerIncoming("focus",e,function(a){h(g.wrapFocus(a))});break;case "blur":g.registerIncoming("blur",e,function(a){h(g.wrapBlur(a))});break;default:a.neverReached(l)}}return g}k(d,c);d.prototype.wrapFocus=function(a){return{type:"focus",timestamp:a.timestamp,native:a.data.native,stopPropagation:function(){return a.stopPropagation()}}};
d.prototype.wrapBlur=function(a){return{type:"blur",timestamp:a.timestamp,native:a.data.native,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapClick=function(a){var b=a.data,c=b.x,d=b.y,e=b.eventId;return{type:"click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,screenPoint:new g(c,d),mapPoint:this.view.toMap(c,d),eventId:e,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapDoubleClick=function(a){var b=
a.data,c=b.x,d=b.y,e=b.eventId;return{type:"double-click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),eventId:e,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapImmediateClick=function(a){var b=a.data,c=b.x,d=b.y,e=b.eventId;return{type:"immediate-click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,
d),eventId:e,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapHold=function(a){var b=a.data,c=b.x,d=b.y;return{type:"hold",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapDrag=function(a){var c=a.data,d=c.center,e=d.x,d=d.y,h=c.action,g=c.pointerType,l=c.button;"start"===h&&(this.latestDragStart=c);if(this.latestDragStart){var m=
c.pointer.native,n=c.buttons,k=a.timestamp,q={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};"end"===h&&(this.latestDragStart=void 0);return{type:"drag",action:h,x:e,y:d,origin:q,pointerType:g,button:l,buttons:n,radius:c.radius,angle:b.rad2deg(c.angle),native:m,timestamp:k,stopPropagation:function(){return a.stopPropagation()}}}};d.prototype.wrapKeyDown=function(a){var b=a.data;return{type:"key-down",key:b.key,repeat:b.repeat,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};
d.prototype.wrapKeyUp=function(a){var b=a.data;return{type:"key-up",key:b.key,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapPointer=function(a,b){var c=a.data,d=c.native;return{type:b,x:c.x,y:c.y,pointerId:d.pointerId,pointerType:d.pointerType,button:c.button,buttons:c.buttons,native:d,timestamp:a.timestamp,eventId:c.eventId,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapPointerDrag=function(a){var b=a.data.currentEvent;
return{type:"pointer-drag",x:b.x,y:b.y,pointerId:a.data.startEvent.native.pointerId,pointerType:a.data.startEvent.native.pointerType,button:a.data.startEvent.button,buttons:b.buttons,action:a.data.action,origin:{x:a.data.startEvent.x,y:a.data.startEvent.y},native:b.native,timestamp:a.timestamp,eventId:b.eventId,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapMouseWheel=function(a){var b=a.data;return{type:"mouse-wheel",x:b.x,y:b.y,deltaY:b.deltaY,native:b.native,timestamp:a.timestamp,
stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapGamepad=function(a){var b=a.data,c=b.state;return{type:"gamepad",device:b.device,timestamp:a.timestamp,action:b.action,buttons:c.buttons,axes:c.axes,stopPropagation:function(){return a.stopPropagation()}}};return d}(e.InputHandler)})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(p,f,k,a){Object.defineProperty(f,"__esModule",
{value:!0});p=function(a){function b(){var b=a.call(this,!0)||this;b.registerIncoming("context-menu",function(a){a.data.native.preventDefault()});return b}k(b,a);return b}(a.InputHandler);f.PreventContextMenu=p;f.default=p})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/Handles ../../../../core/Logger ../../../../core/now ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingRect ./deconflictorDebug ../../support/debugFlags ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/geometryUtils/sphere ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w){function B(b){var c,d,e,h;return a(this,function(a){switch(a.label){case 0:c=[];for(d in b)c.push(d);e=0;a.label=1;case 1:if(!(e<c.length))return[3,4];h=c[e];return[4,b[h]];case 2:a.sent(),a.label=3;case 3:return e++,[3,1];case 4:return[2]}})}Object.defineProperty(f,"__esModule",{value:!0});var C=b.getLogger("esri.views.3d.graphics.Deconflictor"),D=m.vec4f64.create(),E=m.vec4f64.create(),G=m.vec4f64.create(),H=m.vec4f64.create(),I=m.vec3f64.fromValues(0,
0,0),N=t.sphere.create(),S=t.ray.create(),M=m.vec3f64.create(),P=l.create(),O=l.create(),W=function(){return function(){this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.pooled=this.visible=this.culled=!1}}(),Q=function(){return function(a,b,c){void 0===c&&(c={});this.graphics3DGraphic=a;this.slicePlaneEnabled=b;this.info=c}}(),J=function(){return function(a,b){void 0===b&&(b=new Map);this.graphics3DCore=a;this.graphics=b}}(),F;(function(a){a[a.Idle=0]="Idle";a[a.ProcessGraphics=1]="ProcessGraphics";
a[a.ProcessLabels=2]="ProcessLabels";a[a.CleanGraphics=3]="CleanGraphics";a[a.CleanLabels=4]="CleanLabels";a[a.SortGraphics=5]="SortGraphics";a[a.SortLabels=6]="SortLabels";a[a.DeconflictGraphics=7]="DeconflictGraphics";a[a.DeconflictLabels=8]="DeconflictLabels"})(F||(F={}));p=function(){function a(a){var b,e,h=this;this.handles=new g;this.delayedRunInterval=200;this.nextRunTimestamp=Number.POSITIVE_INFINITY;this.state=F.Idle;this.contexts=[];this.iterators=this.graphics=null;this.accBinsNumX=15;
this.accBinsNumY=20;this.accBinsSizeY=this.accBinsSizeX=0;this.accBins=null;this.accNumTests=0;this.iconMarginFactor=-.1;this.slicePlaneViewSpace=null;this.view=a;this.graphics=(b={},b[0]={active:{},visible:new c,remove:new c},b[1]={active:{},visible:new c,remove:new c},b);this.iterators=(e={},e[0]={active:null,visible:null,remove:null,sort:null},e[1]={active:null,visible:null,remove:null,sort:null},e);this.handles.add([a.watch("state.camera",function(){h.updateSlicePlane();h.setDirty(0)}),a.watch("map.ground.opacity",
function(a,b){1!==a&&1!==b||h.setDirty(0)}),d.init(a,"qualityProfile",function(a){h.delayedRunInterval="low"===a?1E3:200}),d.init(a,"slicePlane",function(){return h.updateSlicePlane()})]);this.frameWorker=a.resourceController.registerFrameWorker(function(a){return h.run(a)},function(a){return h.shouldRun(a)})}a.prototype.updateSlicePlane=function(){var a=this.view&&this.view.slicePlane;a?(this.slicePlaneViewSpace||(this.slicePlaneViewSpace=t.boundedPlane.create()),t.boundedPlane.transform(a,this.view.state.camera.viewMatrix,
this.slicePlaneViewSpace),this.slicePlaneChanged()):this.slicePlaneViewSpace&&(this.slicePlaneViewSpace=null,this.slicePlaneChanged())};a.prototype.slicePlaneChanged=function(){for(var a=0,b=this.contexts;a<b.length;a++)if(b[a].graphics3DCore.symbolCreationContext.slicePlaneEnabled){this.setDirty();break}};a.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.graphics[0].active=null;this.graphics[0].visible.clear();
this.graphics[0].remove.clear();this.graphics[1].active=null;this.graphics[1].visible.clear();this.graphics[1].remove.clear();this.view=this.iterators=this.graphics=null};a.prototype.addGraphicsOwner=function(a){var b=this,c=new J(a);this.contexts.push(c);this.setDirty(0);a=new K;a.addGraphic=function(a){b.addGraphic(c,a)};a.removeGraphic=function(a){b.removeGraphic(c,a)};a.labelingInfoChange=function(){b.layerPropertyChanged(c,"labelingInfo")};a.featureReductionChange=function(){b.layerPropertyChanged(c,
"featureReduction")};a.slicePlaneEnabledChange=function(){b.layerPropertyChanged(c,"slicePlaneEnabled")};a.clear=function(){c.graphics.forEach(function(a){b.removeGraphic(c,a.graphics3DGraphic)})};return a};a.prototype.removeGraphicsOwner=function(a){var b=this;a=this.findDeconflictionContext(a);if(-1!==a){var c=this.contexts.splice(a,1)[0];c.graphics.forEach(function(a){b.removeGraphic(c,a.graphics3DGraphic)});this.setDirty(0)}};a.prototype.setInitialIconVisibilityFlag=function(a,b){a=!this.isFeatureReductionEnabled(a);
b.setVisibilityFlag(2,a)};Object.defineProperty(a.prototype,"isDirty",{get:function(){return this.state!==F.Idle||Infinity!==this.nextRunTimestamp},enumerable:!0,configurable:!0});a.prototype.setDirty=function(a){void 0===a&&(a=this.delayedRunInterval);this.nextRunTimestamp>e()&&(this.nextRunTimestamp=e()+a)};a.prototype.shouldRun=function(a){return this.view.ready&&null!=this.view.state&&(Infinity!==this.nextRunTimestamp&&this.nextRunTimestamp<=e()||this.state!==F.Idle)};a.prototype.run=function(a){h.prepare(this.view);
switch(this.state){case F.Idle:this.nextRunTimestamp=Infinity,this.camera=this.view.state.camera,this.initBins(this.camera.fullWidth,this.camera.fullHeight),this.resetIterators();case F.ProcessGraphics:if(this.state=F.ProcessGraphics,!this.processActiveGraphics(0,a))break;case F.ProcessLabels:if(this.state=F.ProcessLabels,!this.processActiveGraphics(1,a))break;case F.CleanGraphics:if(this.state=F.CleanGraphics,!this.cleanVisibleGraphics(0,a))break;case F.CleanLabels:if(this.state=F.CleanLabels,!this.cleanVisibleGraphics(1,
a))break;case F.SortGraphics:if(this.state=F.SortGraphics,!this.sortVisibleGraphics(0,a))break;case F.SortLabels:if(this.state=F.SortLabels,!this.sortVisibleGraphics(1,a))break;case F.DeconflictGraphics:this.state=F.DeconflictGraphics;if(!this.deconflictVisibleGraphics(0,a))break;h.drawAccelerationStruct(this,this.graphics[0].visible);case F.DeconflictLabels:this.state=F.DeconflictLabels;if(!this.deconflictVisibleGraphics(1,a))break;h.drawAccelerationStruct(this,this.graphics[1].visible);default:this.state=
F.Idle}};a.prototype.findDeconflictionContext=function(a){for(var b=0;b<this.contexts.length;b++)if(this.contexts[b].graphics3DCore===a)return b;return-1};a.prototype.layerPropertyChanged=function(a,b){switch(b){case "featureReduction":b=!!this.isFeatureReductionEnabled(a.graphics3DCore);this.setGraphicsVisibilityFlags(a,b?!1:void 0);this.modifyGraphics(a,b,0);break;case "labelingInfo":b=this.isLabelDeconflictionEnabled(a.graphics3DCore);this.modifyGraphics(a,b,1);break;case "slicePlaneEnabled":var c=
a.graphics3DCore.symbolCreationContext.slicePlaneEnabled;a.graphics.forEach(function(a){a.slicePlaneEnabled=c});this.setDirty(0)}};a.prototype.modifyGraphics=function(a,b,c){var d=(b?this.addToActiveGraphics:this.removeFromActiveGraphics).bind(this);a.graphics.forEach(function(a){d(a,c)});this.setDirty(0)};a.prototype.addGraphic=function(a,b){var c=b.graphic.uid;b=new Q(b,a.graphics3DCore.symbolCreationContext.slicePlaneEnabled);a.graphics.set(c,b);this.isFeatureReductionEnabled(a.graphics3DCore)&&
this.addToActiveGraphics(b,0);this.isLabelDeconflictionEnabled(a.graphics3DCore)&&this.addToActiveGraphics(b,1);this.setDirty()};a.prototype.removeGraphic=function(a,b){b=b.graphic.uid;var c=a.graphics.get(b);c&&(this.removeFromActiveGraphics(c,0),this.removeFromActiveGraphics(c,1),a.graphics.delete(b),this.setDirty())};a.prototype.addToActiveGraphics=function(a,b){a.info[b]=new W;this.graphics[b].active[a.graphics3DGraphic.graphic.uid]=a};a.prototype.removeFromActiveGraphics=function(a,b){this.removeFromVisibleGraphics(a,
b);this.resetGraphicVisibility(a,b);delete a.info[b];delete this.graphics[b].active[a.graphics3DGraphic.graphic.uid]};a.prototype.addToVisibleGraphics=function(a,b){var c=a.info[b];c&&!c.pooled&&(this.graphics[b].visible.push(a),c.pooled=!0)};a.prototype.removeFromVisibleGraphics=function(a,b){var c=a.info[b];c&&c.pooled&&(this.graphics[b].remove.push(a),c.pooled=!1)};a.prototype.processActiveGraphics=function(a,b){for(var c=this.getOrCreateActiveGraphicsIterator(a),d="global"===this.view.viewingMode&&
1===this.view.map.ground.opacity&&this.camera&&0<this.camera.relativeElevation;!b.done();){var e=c.next();if(e.done)return this.resetActiveGraphicsIterator(a),!0;var h=(e=e.value)&&e.info[a];h&&(this.collectGraphics3DGraphics(e,a,d),h.culled?this.removeFromVisibleGraphics(e,a):this.addToVisibleGraphics(e,a))}return!1};a.prototype.cleanVisibleGraphics=function(a,b){for(var c=this.graphics[a],d=this.getOrCreateRemoveGraphicsIterator(a,b);!b.done();)if(d.next().done)return c.remove.clear(),this.resetRemoveGraphicsIterator(a),
!0;return!1};a.prototype.sortVisibleGraphics=function(a,b){for(var c=this.getOrCreateSortGraphicsIterator(a,function(b,c){return b.info[a]&&c.info[a]?c.info[a].posView-b.info[a].posView:Number.MAX_VALUE},b);!b.done();)if(c.next().done)return this.resetSortGraphicsIterator(a),!0;return!1};a.prototype.deconflictVisibleGraphics=function(a,b){for(var c=this.getOrCreateVisibleGraphicsIterator(a),d=1===a;!b.done();){var e=c.next();if(e.done)return this.resetVisibleGraphicsIterator(a),!0;var e=e.value,g=
e.info[a];if(g&&!g.culled){var l=e.graphics3DGraphic,l=!(d&&!1===l.areVisibilityFlagsSet(2))&&!this.doesIntersectExistingPoly(e,a);(g.visible=l)&&this.addToBins(e,a);this.setGraphicVisibility(e,a,l);h.drawPoly(g,l?"green":"red")}}return!1};a.prototype.resetIterators=function(){this.iterators[0].active=null;this.iterators[0].visible=null;this.iterators[0].remove=null;this.iterators[0].sort=null;this.iterators[1].active=null;this.iterators[1].visible=null;this.iterators[1].remove=null;this.iterators[1].sort=
null};a.prototype.getOrCreateActiveGraphicsIterator=function(a){var b=this.graphics[a];a=this.iterators[a];a.active||(a.active=B(b.active));return a.active};a.prototype.resetActiveGraphicsIterator=function(a){this.iterators[a].active=null};a.prototype.getOrCreateVisibleGraphicsIterator=function(a){var b=this.graphics[a];a=this.iterators[a];a.visible||(a.visible=b.visible.iterableForEach());return a.visible};a.prototype.resetVisibleGraphicsIterator=function(a){this.iterators[a].visible=null};a.prototype.getOrCreateRemoveGraphicsIterator=
function(a,b){var c=this.graphics[a];a=this.iterators[a];a.remove||(a.remove=c.visible.iterableRemoveMany(c.remove.data,function(){return b.done()}));return a.remove};a.prototype.resetRemoveGraphicsIterator=function(a){this.iterators[a].remove=null};a.prototype.getOrCreateSortGraphicsIterator=function(a,b,c){var d=this.graphics[a];a=this.iterators[a];a.sort||(a.sort=d.visible.iterableSort(b,function(){return c.done()}));return a.sort};a.prototype.resetSortGraphicsIterator=function(a){this.iterators[a].sort=
null};a.prototype.collectGraphics3DGraphics=function(a,b,c){var d=a.graphics3DGraphic;if(!d.destroyed){var e=1===b,h=e?d._labelGraphics:d._graphics,e=e?0:this.iconMarginFactor;b=a.info[b];if(!d.areVisibilityFlagsSet(0))b.culled=!0;else if(h&&h.length){for(var d=l.empty(P),g,k,f=0;f<h.length;f++){var B=h[f];if(B&&"object3d"===B.type){var F=B.stageObject,K=F?F.getNumGeometryRecords():0;if(!(1>K)){var X=F.getGeometryRecord(0),R=X.material;if(R instanceof z)if(1<K)C.warn("Graphic objects with more than 1 geometry record are not supported");
else{var K=this.camera,J=X.geometry.data.getVertexAttr();if(c&&(N.radius=q.earthRadius,m.vec3.sub(S.direction,F.getCenter(),this.camera.eye),m.vec3.copy(S.origin,this.camera.eye),r.intersectRay(N,S,M))){var ba=1-Math.abs(Math.tan(m.vec3.angle(F.getCenter(),S.direction)))/this.view.width,ba=Math.pow(ba,4),v=m.vec3.sqrDist(this.camera.eye,M),p=m.vec3.sqrDist(this.camera.eye,F.getCenter());if(ba*p>v){b.culled=!0;return}}if(!k){k=F.getCenter();X=X.origin.vec3;w.transformToWorld(k,X,D);w.transformToView(D,
X,K.viewMatrix,E);R.applyVerticalOffsetTransformation(E,J[x.VertexAttrConstants.NORMAL].data,F.objectTransformation,K,L);if(a.slicePlaneEnabled&&this.slicePlaneViewSpace&&t.boundedPlane.extrusionContainsPoint(this.slicePlaneViewSpace,E)){b.culled=!0;return}F=J[x.VertexAttrConstants.AUXPOS1].data;X="screen"!==R.getParams().centerOffsetUnits;w.transformToProjection(E,K.projectionMatrix,X?F:I,G);k=w.transformToNDC(G,H);X||(k[0]+=F[0]/K.fullWidth*2,k[1]+=F[1]/K.fullHeight*2);if(-1>k[0]||-1>k[1]||-1>k[2]||
1<=k[0]||1<=k[1])break;g=E[2];!n.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&b.visible&&(g*=.7)}B=B.getScreenSize(T);y.applyPrecomputedScaleFactorVec2(B,L.factor,B);R=l.offset(R.calculateRelativeScreenBounds(B,L.scaleAlignment,O),u.lerp(0,K.fullWidth,.5+.5*k[0]),u.lerp(0,K.fullHeight,.5+.5*k[1]));0!==e&&(B=e*Math.min(l.width(R),l.height(R)),R[0]-=B,R[1]-=B,R[2]+=B,R[3]+=B);l.expand(d,R)}}}}null!=g?(b.xMin=d[0],b.yMin=d[1],b.xMax=d[2],b.yMax=d[3],b.posView=g,b.culled=!1):b.culled=!0}}};a.prototype.doesIntersectExistingPoly=
function(a,b){var c=a.graphics3DGraphic.graphic.uid;a=a.info[b];for(var d=Math.floor(a.xMin/this.accBinsSizeX);d<=Math.floor(a.xMax/this.accBinsSizeX);d++)if(!(0>d||d>=this.accBinsNumX))for(var e=Math.floor(a.yMin/this.accBinsSizeY);e<=Math.floor(a.yMax/this.accBinsSizeY);e++)if(!(0>e||e>=this.accBinsNumY))for(var h=this.accBins[d][e],g=0;g<h.length;g++){var l=h.data[g],m=l.info[b];if(m&&m.visible&&l.graphics3DGraphic.graphic.uid!==c&&(this.accNumTests++,!(m.xMin>a.xMax||m.xMax<a.xMin||m.yMin>a.yMax||
m.yMax<a.yMin)))return!0}return!1};a.prototype.initBins=function(a,b){if(null==this.accBins){this.accBins=[];for(var d=0;d<this.accBinsNumX;d++){this.accBins.push([]);for(var e=this.accBins[this.accBins.length-1],h=0;h<this.accBinsNumY;h++)e.push(new c)}}for(d=0;d<this.accBinsNumX;d++)for(h=0;h<this.accBinsNumY;h++)this.accBins[d][h].clear();this.accBinsSizeX=a/this.accBinsNumX;this.accBinsSizeY=b/this.accBinsNumY;this.accNumTests=0};a.prototype.addToBins=function(a,b){b=a.info[b];for(var c=Math.floor(b.xMin/
this.accBinsSizeX);c<=Math.floor(b.xMax/this.accBinsSizeX);c++)if(!(0>c||c>=this.accBinsNumX))for(var d=Math.floor(b.yMin/this.accBinsSizeY);d<=Math.floor(b.yMax/this.accBinsSizeY);d++)0>d||d>=this.accBinsNumY||this.accBins[c][d].push(a)};a.prototype.isFeatureReductionEnabled=function(a){a=a.layer;return!(!a||!a.featureReduction||"selection"!==a.featureReduction.type)};a.prototype.isLabelDeconflictionEnabled=function(a){return a.labelsEnabled};a.prototype.setGraphicsVisibilityFlags=function(a,b){(a=
a.graphics3DCore.graphics3DGraphics)&&a.forEach(function(a){return a.setVisibilityFlag(2,b)})};a.prototype.setGraphicVisibility=function(a,b,c){a=a.graphics3DGraphic;a.destroyed||(a.setVisibilityFlag(2,c,b),1===b&&void 0!==c&&this.view.labeler.setLabelGraphicVisibility(a,c))};a.prototype.resetGraphicVisibility=function(a,b){this.setGraphicVisibility(a,b,void 0)};return a}();f.Deconflictor=p;var K=function(){return function(){}}();f.GraphicsOwner=K;var L={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},
scaleAlignment:0,minPixelSizeAlignment:0},T=m.vec2f64.create()})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/debugFlags"],function(p,f,k,a){function g(a,b,e,g,k){var h=c.height,l=d;l.beginPath();l.lineWidth=1;l.strokeStyle=k;l.moveTo(a,h-e);l.lineTo(b,h-e);l.stroke();l.lineTo(b,h-g);l.stroke();l.lineTo(b,h-e);l.stroke();l.lineTo(a,h-e);l.stroke();l.lineTo(a,h-e);l.stroke();l.closePath()}Object.defineProperty(f,
"__esModule",{value:!0});var b=!1,e=!1,c,d;f.drawAccelerationStruct=function(a,b){if(e&&d){for(var c=d,l=0,m=0;m<a.accBinsNumX;m++)for(var k=0;k<a.accBinsNumY;k++){var f=a.accBins[m][a.accBinsNumY-1-k],l=l+f.length,r=m*a.accBinsSizeX,y=(m+1)*a.accBinsSizeX,x=k*a.accBinsSizeY,z=(k+1)*a.accBinsSizeY;c.fillText(f.length.toFixed(),r+5,x+15);g(r,y,x,z,"blue")}c.fillText("total totalShownLabels: "+l,70,40);c.fillText("total visible labels: "+b.length,70,50);c.fillText("total numTests: "+a.accNumTests,70,
30)}};f.prepare=function(g){b=a.DECONFLICTOR_SHOW_OUTLINES;e=a.DECONFLICTOR_SHOW_GRID;if(b||e)null==c&&(c=document.createElement("canvas"),c.setAttribute("id","canvas2d"),g.surface.parentElement.style.position="relative",g.surface.parentElement.appendChild(c)),c.setAttribute("width",g.width+"px"),c.setAttribute("height",g.height+"px"),c.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;"),d=c.getContext("2d"),d.clearRect(0,0,g.width,g.height),d.font="12px Arial"};
f.drawPoly=function(a,c){b&&g(a.xMin,a.xMax,a.yMin,a.yMax,c)}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(p,f,k,a,g,b){return new (function(e){function c(){var a=null!==e&&e.apply(this,arguments)||this;a.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1;a.SCENEVIEW_LOCKING_LOG=!1;a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=
!1;a.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;a.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;a.DECONFLICTOR_SHOW_OUTLINES=!1;a.DECONFLICTOR_SHOW_GRID=!1;a.LABELS_SHOW_BORDER=!1;a.OVERLAY_DRAW_TEST_TEXTURE=!1;a.OVERLAY_SHOW_CENTER=!1;a.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1;a.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1;a.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!1;a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;a.DRAW_MESH_GEOMETRY_NORMALS=!1;a.FEATURE_TILE_FETCH_SHOW_TILES=!1;a.FEATURE_TILE_TREE_SHOW_TILES=
!1;a.ENABLE_PROFILE_DEPTH_RANGE=!1;a.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;a.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;return a}k(c,e);a([b.property()],c.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0);a([b.property()],c.prototype,"SCENEVIEW_LOCKING_LOG",void 0);a([b.property()],c.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);a([b.property()],c.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);a([b.property()],c.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);a([b.property()],
c.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);a([b.property()],c.prototype,"DECONFLICTOR_SHOW_GRID",void 0);a([b.property()],c.prototype,"LABELS_SHOW_BORDER",void 0);a([b.property()],c.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);a([b.property()],c.prototype,"OVERLAY_SHOW_CENTER",void 0);a([b.property()],c.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0);a([b.property()],c.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);a([b.property()],c.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",
void 0);a([b.property()],c.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);a([b.property()],c.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);a([b.property()],c.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);a([b.property()],c.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);a([b.property()],c.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);a([b.property()],c.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);a([b.property()],c.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",
void 0);return c=a([b.subclass()],c)}(b.declared(g)))})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","../../support/earthUtils","../../support/mathUtils"],function(p,f,k,a){function g(a){return Math.abs(a*a*a)}function b(a,b,c,d){void 0===d&&(d=h);var e=c.parameters;c=c.paddingPixelsOverride;d.scale=Math.min(e.divisor/(b-e.offset),1);d.factor=g(a);d.minPixelSize=e.minPixelSize;d.paddingPixels=c;return d}function e(a,b){return 0===a?b.minPixelSize:
b.minPixelSize*(1+2*b.paddingPixels/a)}function c(b,c){return Math.max(a.lerp(b*c.scale,b,c.factor),e(b,c))}function d(a,d,e){a=b(a,d,e);a.minPixelSize=0;a.paddingPixels=0;return c(1,a)}Object.defineProperty(f,"__esModule",{value:!0});f.getSettings=function(a){return new m(a,f.defaultDescription)};f.getLabelSettings=function(a){var b=f.defaultDescription.curvatureDependent;return new m(a,{curvatureDependent:{min:{curvature:b.min.curvature,tiltAngle:b.min.tiltAngle,scaleFallOffFactor:l.curvatureDependent.min.scaleFallOffFactor},
max:{curvature:b.max.curvature,tiltAngle:b.max.tiltAngle,scaleFallOffFactor:l.curvatureDependent.max.scaleFallOffFactor}},scaleStart:f.defaultDescription.scaleStart,scaleFallOffRange:f.defaultDescription.scaleFallOffRange,minPixelSize:l.minPixelSize})};f.perspectiveFactor=g;f.scaleFactor=b;f.applyScaleFactor=c;f.applyScaleFactorVec2=function(b,c,d){void 0===d&&(d=[0,0]);var h=Math.min(Math.max(c.scale,e(b[1],c)/b[1]),1);d[0]=a.lerp(b[0]*h,b[0],c.factor);d[1]=a.lerp(b[1]*h,b[1],c.factor);return d};
f.precomputeScale=d;f.precomputeScaleFactor=function(a,b,c,e){e.scale=d(a,b,c);e.factor=0;e.minPixelSize=c.parameters.minPixelSize;e.paddingPixels=c.paddingPixelsOverride;return e};f.applyPrecomputedScaleFactorVec2=function(a,b,c){void 0===c&&(c=[0,0]);b=Math.min(Math.max(b.scale,e(a[1],b)/a[1]),1);c[0]=a[0]*b;c[1]=a[1]*b;return c};f.scale=function(a,d,e,h){return c(a,b(d,e,h))};var m=function(){function b(a,b,c,d){void 0===c&&(c={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});
this.viewingMode=a;this.description=b;this.parameters=c;this._paddingPixelsOverride=d;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(b.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||
this.parameters.paddingPixels},enumerable:!0,configurable:!0});b.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};b.prototype.overridePadding=function(a){return a!==this.paddingPixelsOverride?new b(this.viewingMode,this.description,this.parameters,a):this};b.prototype.calculateParameters=function(a,b){var c=this.description,d=c.scaleStart,e=c.scaleFallOffRange,
c=c.minPixelSize,h=a.fovY,g=a.distance,l=this.calculateCurvatureDependentParameters(a),m=this.coverageCompensation(a,l),n=l.tiltAngle,l=l.scaleFallOffFactor,g=Math.sin(n)*g,n=.5*Math.PI-n-h*(.5-d*m),d=g/Math.cos(n),e=(d-g/Math.cos(n+h*e*m)*l)/(1-l);b.camera.fovY=a.fovY;b.camera.distance=a.distance;b.offset=e;b.divisor=d-e;b.minPixelSize=c;return b};b.prototype.calculateCurvatureDependentParametersLocal=function(a,b){void 0===b&&(b=n);b.tiltAngle=this.description.curvatureDependent.min.tiltAngle;b.scaleFallOffFactor=
this.description.curvatureDependent.min.scaleFallOffFactor;return b};b.prototype.calculateCurvatureDependentParametersGlobal=function(b,c){void 0===c&&(c=n);var d=this.description.curvatureDependent;b=1+b.distance/k.earthRadius;var e=[d.min.curvature,d.max.curvature],h=e[0];b=a.clamp((Math.sqrt(b*b-1)-h)/(e[1]-h),0,1);e=[d.min,d.max];d=e[0];e=e[1];c.tiltAngle=a.lerp(d.tiltAngle,e.tiltAngle,b);c.scaleFallOffFactor=a.lerp(d.scaleFallOffFactor,e.scaleFallOffFactor,b);return c};b.prototype.surfaceCoverageCompensationLocal=
function(a,b){return(a.fovY-b.tiltAngle)/a.fovY};b.prototype.surfaceCoverageCompensationGlobal=function(a,b){var c=k.earthRadius*k.earthRadius;b=b.tiltAngle+.5*Math.PI;var d=a.fovY;a=a.distance;a=a*a+c-2*Math.cos(b)*a*k.earthRadius;var e=Math.sqrt(a);return(Math.acos(Math.sqrt(a-c)/e)-Math.asin(k.earthRadius/(e/Math.sin(b)))+.5*d)/d};return b}();f.defaultDescription={curvatureDependent:{min:{curvature:a.deg2rad(10),tiltAngle:a.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:a.deg2rad(70),tiltAngle:a.deg2rad(40),
scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var l={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};f.copyParameters=function(a,b){b.camera.distance=a.camera.distance;b.camera.fovY=a.camera.fovY;b.divisor=a.divisor;b.offset=a.offset;b.minPixelSize=a.minPixelSize;return b};var h={scale:0,factor:0,minPixelSize:0,paddingPixels:0},n={tiltAngle:0,scaleFallOffFactor:0}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterialTexture ../lib/Material ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/HUDPrograms".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t){function u(b,c){void 0===c&&(c=w);if(b.textureIsSignedDistanceField){var d=b.anchorPos;b=b.distanceFieldBoundingBox;var e=c;e[0]=d[0]*(b[2]-b[0])+b[0];e[1]=d[1]*(b[3]-b[1])+b[1]}else a.vec2.copy(c,b.anchorPos);return c}var r={"bottom-left":a.vec2f64.fromValues(0,0),bottom:a.vec2f64.fromValues(.5,0),"bottom-right":a.vec2f64.fromValues(1,0),left:a.vec2f64.fromValues(0,.5),center:a.vec2f64.fromValues(.5,.5),right:a.vec2f64.fromValues(1,.5),"top-left":a.vec2f64.fromValues(0,
1),top:a.vec2f64.fromValues(.5,1),"top-right":a.vec2f64.fromValues(1,1)};p=function(d){function e(a,b){b=d.call(this,b)||this;b._textureDirty=!1;b.params=q.copyParameters(a,W);"string"===typeof b.params.anchorPos&&(b.params.anchorPos=r[b.params.anchorPos]);b.bufferWriter=new J(b);return b}k(e,d);e.prototype.dispose=function(){};e.prototype.getParameterValues=function(){return this.params};e.prototype.setParameterValues=function(a){for(var b in a)"textureId"===b&&h.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),
this.params[b]=a[b];this.notifyDirty("matChanged")};e.prototype.getParams=function(){return this.params};e.prototype.intersect=function(b,d,e,g,m,n,k,q){if(g.isSelection&&g.enableHUDSelection&&!c.isAllHidden(d.componentVisibilities,b.data.componentOffsets)){var r=b.data;b=this.params;m=d=1;a.mat3.fromMat4(H,e);if(q){m=q(S);d=m[0];m=m[5];q=H;n=q[0];var f=q[1],t=q[2],w=q[3],y=q[4],x=q[5],F=q[6],L=q[7],K=q[8],E=1/Math.sqrt(n*n+f*f+t*t),X=1/Math.sqrt(w*w+y*y+x*x),R=1/Math.sqrt(F*F+L*L+K*K);q[0]=n*E;q[1]=
f*E;q[2]=t*E;q[3]=w*X;q[4]=y*X;q[5]=x*X;q[6]=F*R;q[7]=L*R;q[8]=K*R}q=r.getVertexAttr()[h.VertexAttrConstants.POSITION];n=r.getVertexAttr()[h.VertexAttrConstants.SIZE];r=r.getVertexAttr()[h.VertexAttrConstants.NORMAL];h.assert(3<=q.size);f=g.point;t=g.camera;w=u(b);for(y=0;y<q.data.length/q.size;y++)x=y*q.size,a.vec3.set(B,q.data[x],q.data[x+1],q.data[x+2]),a.vec3.transformMat4(B,B,e),x=y*n.size,P[0]=n.data[x]*d,P[1]=n.data[x+1]*m,a.vec3.transformMat4(B,B,t.viewMatrix),x=y*r.size,a.vec3.set(C,r.data[x],
r.data[x+1],r.data[x+2]),this.applyVerticalOffsetTransformation(B,C,H,t,z),t.applyProjection(B,D),-1<D[0]&&(x=Math.floor(D[0]),L=Math.floor(D[1]),l.applyPrecomputedScaleFactorVec2(P,z.factor,P),x=x-M-(0<w[0]?P[0]*w[0]:0),F=x+P[0]+2*M,L=L-M-(0<w[1]?P[1]*w[1]:0),K=L+P[1]+2*M,b.textureIsSignedDistanceField&&(E=b.outlineSize/2,X=b.distanceFieldBoundingBox,x+=P[0]*X[0],L+=P[1]*X[1],F-=P[0]*(1-X[2]),K-=P[1]*(1-X[3]),x-=E,F+=E,L-=E,K+=E),f[0]>x&&f[0]<F&&f[1]>L&&f[1]<K&&(F=g.p0,L=g.p1,a.vec3.transformMat4(G,
B,a.mat4.invert(I,t.viewMatrix)),D[0]=f[0],D[1]=f[1],t.unprojectPoint(D,B),x=a.vec3f64.create(),a.vec3.subtract(x,L,F),L=1/a.vec3.length(x),a.vec3.scale(x,x,L),F=a.vec3.distance(F,B)*L,k(F,x,-1,1,!0,G)))}};e.prototype.normalAndViewAngle=function(b,c,d,e){void 0===e&&(e=N);a.vec3.transformMat3(e.normal,b,c);a.vec3.transformMat4(e.normal,e.normal,d.viewInverseTransposeMatrix);e.cosAngle=a.vec3.dot(E,O);return e};e.prototype.updateScaleInfo=function(a,b,c){b=this.params;b.screenSizePerspective?a.factor=
l.precomputeScaleFactor(N.cosAngle,c,b.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);b.screenSizePerspectiveAlignment?(a.scaleAlignment=l.precomputeScale(N.cosAngle,c,b.screenSizePerspectiveAlignment),a.minPixelSizeAlignment=b.screenSizePerspectiveAlignment.parameters.minPixelSize):(a.scaleAlignment=a.factor.scale,a.minPixelSizeAlignment=a.factor.minPixelSize)};e.prototype.applyVerticalOffsetTransformation=function(b,c,d,e,h,
l){var m=this.params;g.isMat4(d)&&(d=a.mat3.fromMat4(H,d));if(!m.verticalOffset||!m.verticalOffset.screenLength)return h&&(m.screenSizePerspective||m.screenSizePerspectiveAlignment)?(e=this.normalAndViewAngle(c,d,e),m=a.vec3.length(b),this.updateScaleInfo(h,e.cosAngle,m)):h&&(h.factor.scale=1,h.scaleAlignment=1),l?a.vec3.copy(l,b):b;c=this.normalAndViewAngle(c,d,e);d=a.vec3.length(b);e=q.verticalOffsetAtDistance(e,d,m.verticalOffset,c.cosAngle,m.screenSizePerspectiveAlignment||m.screenSizePerspective);
h&&this.updateScaleInfo(h,c.cosAngle,d);return a.vec3.add(l||b,b,a.vec3.scale(c.normal,c.normal,e))};e.prototype.getGLMaterials=function(){return{color:y,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:x}};e.prototype.getAllTextureIds=function(){return[this.params.textureId]};e.prototype.setTextureDirty=function(){this._textureDirty=!0};e.prototype.calculateRelativeScreenBounds=function(c,d,e){void 0===e&&(e=b.create());var h=this.params,g=e;void 0===g&&(g=w);a.vec2.copy(g,h.anchorPos);
g[0]*=-c[0];g[1]*=-c[1];g[0]+=h.screenOffset[0]*d;g[1]+=h.screenOffset[1]*d;e[2]=e[0]+c[0];e[3]=e[1]+c[1];return e};e.prototype.calculateAnchorPosForRendering=function(a){return u(this.params,a)};e.shouldRenderVisibilityDuringRenderPass=function(a){return 0===a||4};return e}(m);d=function(a){function b(b,c,d){c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=q.copyParameters(b.getParams());c.selectProgram();c.selectSlot();return c}k(b,a);b.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?
20:19};b.prototype.beginSlot=function(a){return a===this.mainSlot};b.prototype.getProgram=function(){return this.program};b.prototype.updateParameters=function(){this.params=q.copyParameters(this.material.getParameterValues());this.updateTexture(this.params.textureId);this.selectProgram();this.selectSlot()};b.prototype.bindRender=function(a,b){var c=this.params,d=this.getProgram();this.bindTexture(a,d);d.setUniform1i("hudVisibilityTexture",1);a.bindTexture(b.hudVisibilityTexture,1);a.setActiveTexture(0);
d.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===b.renderTransparentlyOccludedHUD?1:"notOccluded"===b.renderTransparentlyOccludedHUD?0:.75);b=b.pixelRatio||1;d.setUniform4fv("overrideColor",c.color);d.setUniform1f("pixelRatio",b);c.textureIsSignedDistanceField&&(d.setUniform4fv("outlineColor",c.outlineColor),d.setUniform1f("outlineSize",c.outlineSize*b));c.vvSizeEnabled&&(d.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),d.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),d.setUniform3fv("vvSizeOffset",
c.vvSizeOffset),d.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(d.setUniform1fv("vvColorValues",c.vvColorValues),d.setUniform4fv("vvColorColors",c.vvColorColors));d.setUniform2fv("texScale",c.texCoordScale);d.setUniform2f("screenOffset",2*c.screenOffset[0]*b,2*c.screenOffset[1]*b);d.setUniform2fv("anchorPos",u(c));c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setBlendingEnabled(!0);a.setBlendFunction(1,771)};b.prototype.bindProjection=function(a,
b){this.material._textureDirty&&(this.renderTexture(a),this.material._textureDirty=!1);var c=b.cameraAboveGround?1:-1,d=this.getProgram(),e=this.params;a.bindProgram(d);d.setUniform1f("cameraGroundRelative",c);d.setUniform1f("polygonOffset",e.shaderPolygonOffset);d.setUniform4fv("viewport",b.viewport);q.bindVerticalOffset(e.verticalOffset,b,d);d.setUniformMatrix4fv("viewNormal",b.viewInvTransp);e.screenSizePerspective&&(q.bindScreenSizePerspective(e.screenSizePerspective,b,d,"screenSizePerspective"),
q.bindScreenSizePerspective(e.screenSizePerspectiveAlignment||e.screenSizePerspective,b,d,"screenSizePerspectiveAlignment"))};b.prototype.releaseRender=function(a){a.setPolygonOffsetFillEnabled(!1);a.setBlendFunction(770,771);a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();q.bindView(a,b.view,c);q.bindCamPos(a,b.viewInvTransp,c);this.params.slicePlaneEnabled&&q.bindSlicePlane(b.origin,b.slicePlane,c)};b.prototype.bindInstance=function(a,b){a=this.getProgram();
a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return 4};return b}(d);var y=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;b.isOcclusionSlot=!1;return b}k(b,a);b.prototype.selectProgram=function(){var a=this.params;this.programOcclusionTestPixel=this.programRep.getProgram(t.occlusionPass,{verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===
a.centerOffsetUnits,slice:a.slicePlaneEnabled});this.program=this.programRep.getProgram(t.colorPass,{occlTest:a.occlusionTest,sdf:a.textureIsSignedDistanceField,vvSize:!!a.vvSizeEnabled,vvColor:!!a.vvColorEnabled,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,debugDrawBorder:!!a.debugDrawBorder,slice:a.slicePlaneEnabled})};b.prototype.getDrawMode=function(){return this.isOcclusionSlot?0:4};b.prototype.release=
function(a){a.setDepthFunction(513);this.isOcclusionSlot||this.releaseRender(a)};b.prototype.bind=function(a,b){this.bindProjection(a,b);var c=this.getProgram();a.setDepthTestEnabled(!0);a.setDepthFunction(515);this.isOcclusionSlot?(c.setUniform4f("color",1,1,1,1),c.setUniform1f("pixelRatio",b.pixelRatio||1)):(this.bindRender(a,b),this.bindTexture(a,c))};b.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program};b.prototype.getPrograms=function(){return[this.programOcclusionTestPixel,
this.program]};b.prototype.beginSlot=function(a){if(this.params.occlusionTest)return this.isOcclusionSlot=14===a,14===a||a===this.mainSlot;this.isOcclusionSlot=!1;return a===this.mainSlot};return b}(d),x=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}k(b,a);b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(t.highlightPass,{occlTest:a.occlusionTest,sdf:a.textureIsSignedDistanceField,vvSize:!!a.vvSizeEnabled,vvColor:!!a.vvColorEnabled,
verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,binaryHighlightOcclusion:a.binaryHighlightOcclusion,slice:a.slicePlaneEnabled})};b.prototype.bind=function(a,b){this.bindProjection(a,b);this.bindRender(a,b)};b.prototype.release=function(a){this.releaseRender(a)};return b}(d),z={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},w=a.vec2f64.create(),B=a.vec3f64.create(),
C=a.vec3f64.create(),D=a.vec3f64.create(),E=a.vec3f64.create(),G=a.vec3f64.create(),H=a.mat3f64.create(),I=a.mat4f64.create(),N={normal:E,cosAngle:0},S=a.mat4f64.create();a.mat4.identity(S);var M=1,P=[0,0],O=a.vec3f64.fromValues(0,0,1),W={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,
100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:r.center,shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},Q=e.newLayout().vec3f(h.VertexAttrConstants.POSITION).vec3f(h.VertexAttrConstants.NORMAL).vec2f(h.VertexAttrConstants.UV0).vec4u8(h.VertexAttrConstants.COLOR).vec2f(h.VertexAttrConstants.SIZE).vec4f(h.VertexAttrConstants.AUXPOS1).vec4f(h.VertexAttrConstants.AUXPOS2),
J=function(){function a(a){this.material=a;this.vertexBufferLayout=Q}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[h.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d,e){n.writePosition(b.indices[h.VertexAttrConstants.POSITION],b.vertexAttr[h.VertexAttrConstants.POSITION].data,a.transformation,d.position,e,6);n.writeNormal(b.indices[h.VertexAttrConstants.NORMAL],b.vertexAttr[h.VertexAttrConstants.NORMAL].data,
a.invTranspTransformation,d.normal,e,6);a=b.vertexAttr[h.VertexAttrConstants.UV0].data;var g=void 0,l=void 0,m=void 0,k=void 0;null==a||4>a.length?(a=this.material.getParameterValues(),l=g=0,m=a.texCoordScale[0],k=a.texCoordScale[1]):(g=a[0],l=a[1],m=a[2],k=a[3]);var m=Math.min(1.99999,m+1),k=Math.min(1.99999,k+1),q=b.indices[h.VertexAttrConstants.POSITION].length,r=d.uv0;a=e;for(c=0;c<q;++c)r.set(a,0,g),r.set(a,1,l),a+=1,r.set(a,0,m),r.set(a,1,l),a+=1,r.set(a,0,m),r.set(a,1,k),a+=1,r.set(a,0,m),
r.set(a,1,k),a+=1,r.set(a,0,g),r.set(a,1,k),a+=1,r.set(a,0,g),r.set(a,1,l),a+=1;n.writeColor(b.indices[h.VertexAttrConstants.COLOR],b.vertexAttr[h.VertexAttrConstants.COLOR].data,4,d.color,e,6);g=b.indices[h.VertexAttrConstants.SIZE];l=b.vertexAttr[h.VertexAttrConstants.SIZE].data;m=g.length;k=d.size;a=e;for(c=0;c<m;++c)for(var q=l[2*g[c]],r=l[2*g[c]+1],f=0;6>f;++f)k.set(a,0,q),k.set(a,1,r),a+=1;b.indices[h.VertexAttrConstants.AUXPOS1]&&b.vertexAttr[h.VertexAttrConstants.AUXPOS1]&&n.writeBufferVec4(b.indices[h.VertexAttrConstants.AUXPOS1],
b.vertexAttr[h.VertexAttrConstants.AUXPOS1].data,d.auxpos1,e,6);b.indices[h.VertexAttrConstants.AUXPOS2]&&b.vertexAttr[h.VertexAttrConstants.AUXPOS2]&&n.writeBufferVec4(b.indices[h.VertexAttrConstants.AUXPOS2],b.vertexAttr[h.VertexAttrConstants.AUXPOS2].data,d.auxpos2,e,6)};return a}();return p})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["require","exports"],function(p,f){function k(a){return a instanceof Float32Array&&16<=a.length}function a(a){return Array.isArray(a)&&16<=a.length}
Object.defineProperty(f,"__esModule",{value:!0});f.isMat4f32=k;f.isMat4f64=a;f.isMat4=function(g){return k(g)||a(g)}})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./GLMaterial","../materials/internal/MaterialUtil"],function(p,f,k,a,g){return function(a){function b(b,d,e,l,h){void 0===h&&(h=!1);b=a.call(this,b,d)||this;b.textureRep=e;b.textureId=l;b.initTransparent=h;b.glTextureRef=g.aquireIfNotUndefined(b.textureId,
e,b.initTransparent);return b}k(b,a);b.prototype.dispose=function(){g.releaseIfNotUndefined(this.textureId,this.textureRep)};b.prototype.updateTexture=function(a){a!==this.textureId&&(g.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=a,this.glTextureRef=g.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))};b.prototype.renderTexture=function(a){(a=this.textureRep.getTexture(this.textureId))&&a.dirty&&a.redraw&&a.redraw()};b.prototype.bindTexture=function(a,
b){null!=this.glTextureRef&&(b.setUniform1i("tex",0),a.bindTexture(this.glTextureRef.getGLTexture()))};b.prototype.bindTextureSize=function(a,b){null!=this.glTextureRef&&(a=this.glTextureRef.getGLTexture(),b.setUniform2f("texSize",a.descriptor.width,a.descriptor.height))};return b}(a)})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["require","exports"],function(p,f){return function(){function k(a,g){this.material=a;this.programRep=g}k.prototype.dispose=function(){};Object.defineProperty(k.prototype,
"materialId",{get:function(){return this.material.id},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderOccluded",{get:function(){return this.material.renderOccluded},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderPriority",{get:function(){return this.material.renderPriority},enumerable:!0,configurable:!0});k.prototype.isVisible=function(){return this.material.isVisible()};k.prototype.getPrograms=function(){return[this.getProgram()]};return k}()})},
"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../../../geometry/support/aaBoundingBox ../../../support/mathUtils ../../lib/ComponentUtils ../../lib/doublePrecisionUtils ../../lib/screenSizePerspectiveUtils ../../lib/Util".split(" "),function(p,f,k,a,g,b,e,c,d){function m(b,c,d,e,h){var g=n(c,d,z);a.setMin(y,b.getBBMin());a.setMax(y,b.getBBMax());if(q(y,c,g,e)){var g=b.getPrimitiveIndices(),k=b.getIndices(),
r=b.getPosition(),f=g?g.length:k.length/3;if(f>N&&(b=b.getChildren(),void 0!==b)){for(g=0;8>g;++g)void 0!==b[g]&&m(b[g],c,d,e,h);return}l(c,d,0,f,k,r,g,h)}}function l(a,b,c,d,e,g,l,m){var n=g.data,k=g.offsetIdx;g=g.strideIdx;var q=a[0],r=a[1];a=a[2];var f=b[0]-q,t=b[1]-r;for(b=b[2]-a;c<d;c++){var u=l?l[c]:c,z=k+g*e[3*u],x=k+g*e[3*u+1],y=k+g*e[3*u+2],C=n[z],F=n[z+1],D=n[z+2],z=n[x]-C,I=n[x+1]-F,x=n[x+2]-D,G=n[y]-C,H=n[y+1]-F,y=n[y+2]-D,E=t*y-H*b,K=b*G-y*f,J=f*H-G*t,v=z*E+I*K+x*J,C=q-C,N=r-F,p=a-D,
F=N*x-I*p,D=p*z-x*C,M=C*I-z*N;if(v>w){E=C*E+N*K+p*J;if(0>E||E>v)continue;K=f*F+t*D+b*M;if(0>K||E+K>v)continue}else if(v<-w){E=C*E+N*K+p*J;if(0<E||E<v)continue;K=f*F+t*D+b*M;if(0<K||E+K<v)continue}else continue;v=(G*F+H*D+y*M)/v;0<=v&&(z=h(z,I,x,G,H,y,B),m(v,z,u))}}function h(a,b,c,d,e,h,g){k.vec3.set(C,a,b,c);k.vec3.set(D,d,e,h);k.vec3.cross(g,C,D);k.vec3.normalize(g,g);return g}function n(a,b,c){return k.vec3.set(c,1/(b[0]-a[0]),1/(b[1]-a[1]),1/(b[2]-a[2]))}function q(a,b,c,d){var e=(a[0]-d-b[0])*
c[0],h=(a[3]+d-b[0])*c[0],g=Math.min(e,h),e=Math.max(e,h),h=(a[1]-d-b[1])*c[1],l=(a[4]+d-b[1])*c[1],g=Math.max(g,Math.min(h,l)),e=Math.min(e,Math.max(h,l));if(g>e)return!1;h=(a[2]-d-b[2])*c[2];a=(a[5]+d-b[2])*c[2];g=Math.max(g,Math.min(h,a));e=Math.min(e,Math.max(h,a));return g<=e}function t(a,b){b=b?t(b):{};for(var c in a){var d=a[c];d&&d.forEach&&(d=u(d));null==d&&c in b||(b[c]=d)}return b}function u(a){var b=[];a.forEach(function(a){return b.push(a)});return b}Object.defineProperty(f,"__esModule",
{value:!0});var r=k.mat4f64.create(),y=a.create(),x=d.VertexAttrConstants;f.IDENTITY=k.mat4f64.create();f.intersectTriangleGeometry=function(c,e,h,g,k,r,f){d.assert("triangle"===c.data.primitiveType);e=e&&e.componentVisibilities;g=g.tolerance;if(1<c.componentCount){h=n(k,r,z);var t=c.boundingInfo;a.setMin(y,t.getBBMin());a.setMax(y,t.getBBMax());if(q(y,k,h,g))for(var u=c.data,t=c.componentCount,w=u.getIndices(x.POSITION),B=u.getAttribute(x.POSITION),u=u.componentOffsets,C=0;C<t;C++)if(!e||b.getVisibility(e,
C)){var F=c.getComponentAABB(C,y);q(F,k,h,g)&&l(k,r,u[C]/3,u[C+1]/3,w,B,void 0,f)}}else e&&!b.getVisibility(e,0)||m(c.boundingInfo,k,r,g,f)};var z=k.vec3f64.create(),w=Math.pow(2,-52),B=k.vec3f64.create();f.intersectTriangles=l;var C=k.vec3f64.create(),D=k.vec3f64.create();f.computeNormal=h;f.intersectAabbInvDir=q;f.transformToWorld=function(a,b,c){return k.vec4.set(c,a[0]-b[0],a[1]-b[1],a[2]-b[2],1)};f.transformToView=function(a,b,c,d){k.mat4.translate(r,c,b);c=r;return k.vec4.transformMat4(d,a,
c)};f.transformToProjection=function(a,b,c,d){d[0]=a[0]+c[0];d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3];return k.vec4.transformMat4(d,d,b)};f.transformToNDC=function(a,b){return k.vec4.scale(b,a,1/Math.abs(a[3]))};f.applyScreenSizePerspectiveScale=function(a,b,d,e,h){return c.scale(a,e,d,h)};f.verticalOffsetAtDistance=function(a,b,d,e,h){var l=d.screenLength||0;h&&(l=c.scale(l,e,b,h));return g.clamp(l*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*b,d.minWorldLength||0,null!=d.maxWorldLength?d.maxWorldLength:
Infinity)};f.aquireIfNotUndefined=function(a,b,c){if(void 0!==a)return b.aquire(a,c)};f.releaseIfNotUndefined=function(a,b){void 0!==a&&b.release(a)};var E=k.mat4f32.create();f.bindView=function(a,b,c){k.mat4.translate(E,b,a);c.setUniform3fv("localOrigin",a);c.setUniformMatrix4fv("view",E)};f.bindCamPos=function(a,b,c){c.setUniform3f("camPos",b[3]-a[0],b[7]-a[1],b[11]-a[2])};var G=k.vec3f64.create(),H=k.vec3f64.create();f.bindViewOriginDouble=function(a,b){e.encodeDoubleArraySplit(a,G,H,3);b.setUniform3fv("viewOriginHi",
G);b.setUniform3fv("viewOriginLo",H)};var I=k.vec3f64.create();f.bindSlicePlane=function(a,b,c){k.vec3.subtract(I,b.origin,a);c.setUniform3fv("slicePlaneOrigin",I);c.setUniform3fv("slicePlaneBasis1",b.basis1);c.setUniform3fv("slicePlaneBasis2",b.basis2)};f.bindVerticalOffset=function(a,b,c){if(a){var d=b.fovY,e=b.viewport[3],h=void 0;void 0===h&&(h=S);h.screenLength=a.screenLength;h.perDistance=Math.tan(.5*d)/(.5*e);h.minWorldLength=a.minWorldLength;h.maxWorldLength=a.maxWorldLength;a=h;c.setUniform4f("verticalOffset",
a.screenLength*(b.pixelRatio||1),a.perDistance,a.minWorldLength,a.maxWorldLength)}};f.bindScreenSizePerspective=function(a,b,c,d){void 0===d&&(d="screenSizePerspectiveAlignment");if(a){var e=a.parameters;c.setUniform4f(d,e.divisor,e.offset,e.minPixelSize*(b.pixelRatio||1),a.paddingPixelsOverride)}};f.copyParameters=t;f.updateParameters=function(a,b){var c=!1,d;for(d in b){var e=b[d];void 0!==e&&(c=!0,Array.isArray(e)?a[d]=e.slice():a[d]=e)}return c};(function(a){function b(a){return(a.shadowMappingEnabled?
1:0)|(a.ssaoEnabled?2:0)}a.create=function(a,c){for(var d=[],e=0;2>e;e++)for(var h=0;2>h;h++){var g=b({shadowMappingEnabled:1===e,ssaoEnabled:1===h}),l=b({shadowMappingEnabled:1===e,ssaoEnabled:1===h&&a.receiveSSAO});d[g]=d[l]||c({receiveShadows:1===e,receiveSSAO:1===h&&a.receiveSSAO})}return{programs:d.filter(function(a){return null!=a}),byParameter:d}};a.lookup=function(a,c){return a.byParameter[b(c)]};a.programs=function(a){return a.programs}})(f.BindParametersMap||(f.BindParametersMap={}));f.colorMixModes=
{multiply:1,ignore:2,replace:3,tint:4};var N=1E3,S={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}})},"esri/geometry/support/aaBoundingBox":function(){define(["require","exports","../Extent","./aaBoundingRect"],function(p,f,k,a){function g(a){void 0===a&&(a=f.ZERO);return[a[0],a[1],a[2],a[3],a[4],a[5]]}function b(a,b,c,d,e,h,l){void 0===l&&(l=g());l[0]=a;l[1]=b;l[2]=c;l[3]=d;l[4]=e;l[5]=h;return l}function e(a){return a[0]>=a[3]?0:a[3]-a[0]}function c(a){return a[1]>=a[4]?0:a[4]-
a[1]}function d(a){return a[2]>=a[5]?0:a[5]-a[2]}function m(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a}function l(a){return 6===a.length}Object.defineProperty(f,"__esModule",{value:!0});f.create=g;f.fromValues=b;f.fromExtent=function(a,b){void 0===b&&(b=g());b[0]=a.xmin;b[1]=a.ymin;b[2]=a.zmin;b[3]=a.xmax;b[4]=a.ymax;b[5]=a.zmax;return b};f.toExtent=function(a,b){return isFinite(a[2])||isFinite(a[5])?new k({xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],zmin:a[2],zmax:a[5],
spatialReference:b}):new k({xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],spatialReference:b})};f.fromMinMax=function(a,b,c){void 0===c&&(c=g());c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=b[0];c[4]=b[1];c[5]=b[2];return c};f.expandPointInPlace=function(a,b){b[0]<a[0]&&(a[0]=b[0]);b[0]>a[3]&&(a[3]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[1]>a[4]&&(a[4]=b[1]);b[2]<a[2]&&(a[2]=b[2]);b[2]>a[5]&&(a[5]=b[2])};f.expand=function(b,c,d){void 0===d&&(d=b);l(c)?(d[0]=Math.min(b[0],c[0]),d[1]=Math.min(b[1],c[1]),d[2]=Math.min(b[2],
c[2]),d[3]=Math.max(b[3],c[3]),d[4]=Math.max(b[4],c[4]),d[5]=Math.max(b[5],c[5])):a.is(c)?(d[0]=Math.min(b[0],c[0]),d[1]=Math.min(b[1],c[1]),d[3]=Math.max(b[3],c[2]),d[4]=Math.max(b[4],c[3])):2===c.length?(d[0]=Math.min(b[0],c[0]),d[1]=Math.min(b[1],c[1]),d[3]=Math.max(b[3],c[0]),d[4]=Math.max(b[4],c[1])):3===c.length&&(d[0]=Math.min(b[0],c[0]),d[1]=Math.min(b[1],c[1]),d[2]=Math.min(b[2],c[2]),d[3]=Math.max(b[3],c[0]),d[4]=Math.max(b[4],c[1]),d[5]=Math.max(b[5],c[2]));return d};f.expandWithBuffer=
function(a,b,c,d,e){void 0===e&&(e=a);var h=a[0],g=a[1],l=a[2],m=a[3],n=a[4];a=a[5];for(var k=0;k<d;k++)h=Math.min(h,b[c+3*k]),g=Math.min(g,b[c+3*k+1]),l=Math.min(l,b[c+3*k+2]),m=Math.max(m,b[c+3*k]),n=Math.max(n,b[c+3*k+1]),a=Math.max(a,b[c+3*k+2]);e[0]=h;e[1]=g;e[2]=l;e[3]=m;e[4]=n;e[5]=a;return e};f.expandWithNestedArray=function(a,b,c,d){void 0===d&&(d=a);var e=b.length,h=a[0],g=a[1],l=a[2],m=a[3],n=a[4];a=a[5];if(c)for(c=0;c<e;c++){var k=b[c],h=Math.min(h,k[0]),g=Math.min(g,k[1]),l=Math.min(l,
k[2]),m=Math.max(m,k[0]),n=Math.max(n,k[1]);a=Math.max(a,k[2])}else for(c=0;c<e;c++)k=b[c],h=Math.min(h,k[0]),g=Math.min(g,k[1]),m=Math.max(m,k[0]),n=Math.max(n,k[1]);d[0]=h;d[1]=g;d[2]=l;d[3]=m;d[4]=n;d[5]=a;return d};f.allFinite=function(a){for(var b=0;6>b;b++)if(!isFinite(a[b]))return!1;return!0};f.width=e;f.depth=c;f.height=d;f.diameter=function(a){var b=e(a),h=d(a);a=c(a);return Math.sqrt(b*b+h*h+a*a)};f.center=function(a,b){void 0===b&&(b=[0,0,0]);b[0]=a[0]+e(a)/2;b[1]=a[1]+c(a)/2;b[2]=a[2]+
d(a)/2;return b};f.size=function(a,b){void 0===b&&(b=[0,0,0]);b[0]=e(a);b[1]=c(a);b[2]=d(a);return b};f.maximumDimension=function(a){return Math.max(e(a),d(a),c(a))};f.containsPoint=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[2]>=a[2]&&b[0]<=a[3]&&b[1]<=a[4]&&b[2]<=a[5]};f.containsPointWithMargin=function(a,b,c){return b[0]>=a[0]-c&&b[1]>=a[1]-c&&b[2]>=a[2]-c&&b[0]<=a[3]+c&&b[1]<=a[4]+c&&b[2]<=a[5]+c};f.contains=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[2]>=a[2]&&b[3]<=a[3]&&b[4]<=a[4]&&b[5]<=
a[5]};f.intersects=function(a,b){return Math.max(b[0],a[0])<=Math.min(b[3],a[3])&&Math.max(b[1],a[1])<=Math.min(b[4],a[4])&&Math.max(b[2],a[2])<=Math.min(b[5],a[5])};f.offset=function(a,b,c,d,e){void 0===e&&(e=a);e[0]=a[0]+b;e[1]=a[1]+c;e[2]=a[2]+d;e[3]=a[3]+b;e[4]=a[4]+c;e[5]=a[5]+d;return e};f.setMin=function(a,b,c){void 0===c&&(c=a);c[0]=b[0];c[1]=b[1];c[2]=b[2];c!==a&&(c[3]=a[3],c[4]=a[4],c[5]=a[5]);return c};f.setMax=function(a,b,c){void 0===c&&(c=a);c[3]=b[0];c[4]=b[1];c[5]=b[2];c!==a&&(c[0]=
a[0],c[1]=a[1],c[2]=a[2]);return a};f.set=m;f.empty=function(a){return a?m(a,f.NEGATIVE_INFINITY):g(f.NEGATIVE_INFINITY)};f.toRect=function(b,c){c||(c=a.create());c[0]=b[0];c[1]=b[1];c[2]=b[3];c[3]=b[4];return c};f.fromRect=function(a,b){a[0]=b[0];a[1]=b[1];a[3]=b[2];a[4]=b[3];return a};f.is=l;f.isPoint=function(a){return 0===e(a)&&0===c(a)&&0===d(a)};f.equals=function(a,b,c){if(null==a||null==b)return a===b;if(!l(a)||!l(b))return!1;if(c)for(var d=0;d<a.length;d++){if(!c(a[d],b[d]))return!1}else for(d=
0;d<a.length;d++)if(a[d]!==b[d])return!1;return!0};f.wrap=function(a,c,d,e,g,l){return b(a,c,d,e,g,l,h)};f.POSITIVE_INFINITY=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];f.NEGATIVE_INFINITY=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity];f.ZERO=[0,0,0,0,0,0];var h=g()})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["require","exports"],function(p,f){function k(a,e,c){for(var b=0;b<c;++b)e[2*b]=a[b],e[2*b+1]=a[b]-e[2*b]}Object.defineProperty(f,"__esModule",
{value:!0});f.encodeDouble=function(a,e){g[0]=a;g[1]=a-g[0];e[0]=g[0];e[1]=g[1]};f.encodeDoubleArray=k;f.decodeDoubleArray=function(a,e,c){for(var b=0;b<c;++b)e[b]=a[2*b]+a[2*b+1]};f.encodeDoubleArraySplit=function(b,e,c,d){for(var m=0;m<d;++m)a[0]=b[m],k(a,g,1),e[m]=g[0],c[m]=g[1]};var a=new Float64Array(1),g=new Float32Array(2)})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require","exports","./IdGen","./ModelContentType"],function(p,f,k,a){return function(){function g(a){this.supportsEdges=
!1;this._parentStage=null;this._visible=!0;this._renderOccluded=!1;this._renderPriority=0;this.id=g._idGen.gen(a)}Object.defineProperty(g.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0});g.prototype.addParentStage=function(a){this._parentStage=a};g.prototype.removeParentStage=function(a){this._parentStage=null};Object.defineProperty(g.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this.notifyDirty("matChanged"))},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(a){a!==this._renderPriority&&(this._renderPriority=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});g.prototype.isVisible=
function(){return this._visible};g.prototype.notifyDirty=function(b){this.parentStage&&this.parentStage.notifyDirty(a.MATERIAL,this,b)};g._idGen=new k;return g}()})},"esri/views/3d/webgl-engine/materials/internal/bufferWriters":function(){define(["require","exports","../../../support/buffer/BufferView","../../lib/Util"],function(p,f,k,a){function g(a,b,c,d,e){var h=c.typedBuffer;c=c.typedBufferStride;var g=a.length;d*=c;if(null==e||1===e)for(var l=0;l<g;++l){var m=2*a[l];h[d]=b[m];h[d+1]=b[m+1];d+=
c}else for(l=0;l<g;++l)for(var m=2*a[l],n=0;n<e;++n)h[d]=b[m],h[d+1]=b[m+1],d+=c}function b(a,b,c,d,e){var h=c.typedBuffer;c=c.typedBufferStride;var g=a.length;d*=c;if(null==e||1===e)for(var l=0;l<g;++l){var m=3*a[l];h[d]=b[m];h[d+1]=b[m+1];h[d+2]=b[m+2];d+=c}else for(l=0;l<g;++l)for(var m=3*a[l],n=0;n<e;++n)h[d]=b[m],h[d+1]=b[m+1],h[d+2]=b[m+2],d+=c}function e(a,b,c,d,e){var h=c.typedBuffer;c=c.typedBufferStride;var g=a.length;d*=c;if(null==e||1===e)for(var l=0;l<g;++l){var m=4*a[l];h[d]=b[m];h[d+
1]=b[m+1];h[d+2]=b[m+2];h[d+3]=b[m+3];d+=c}else for(l=0;l<g;++l)for(var m=4*a[l],n=0;n<e;++n)h[d]=b[m],h[d+1]=b[m+1],h[d+2]=b[m+2],h[d+3]=b[m+3],d+=c}function c(a,c,d,e,g,l){if(d){var h=e.typedBuffer;e=e.typedBufferStride;var m=a.length;g*=e;if(null==l||1===l)for(var n=0;n<m;++n){var k=3*a[n],q=c[k],f=c[k+1],r=c[k+2];h[g]=d[0]*q+d[4]*f+d[8]*r+d[12];h[g+1]=d[1]*q+d[5]*f+d[9]*r+d[13];h[g+2]=d[2]*q+d[6]*f+d[10]*r+d[14];g+=e}else for(n=0;n<m;++n)for(var k=3*a[n],q=c[k],f=c[k+1],r=c[k+2],k=d[0]*q+d[4]*
f+d[8]*r+d[12],u=d[1]*q+d[5]*f+d[9]*r+d[13],q=d[2]*q+d[6]*f+d[10]*r+d[14],f=0;f<l;++f)h[g]=k,h[g+1]=u,h[g+2]=q,g+=e}else b(a,c,e,g,l)}function d(a,c,d,e,g,l){if(d){var h=e.typedBuffer;e=e.typedBufferStride;var m=a.length;g*=e;if(null==l||1===l)for(var n=0;n<m;++n){var k=3*a[n],q=c[k],f=c[k+1],r=c[k+2];h[g]=d[0]*q+d[4]*f+d[8]*r;h[g+1]=d[1]*q+d[5]*f+d[9]*r;h[g+2]=d[2]*q+d[6]*f+d[10]*r;g+=e}else for(n=0;n<m;++n)for(var k=3*a[n],q=c[k],f=c[k+1],r=c[k+2],k=d[0]*q+d[4]*f+d[8]*r,u=d[1]*q+d[5]*f+d[9]*r,q=
d[2]*q+d[6]*f+d[10]*r,f=0;f<l;++f)h[g]=k,h[g+1]=u,h[g+2]=q,g+=e}else b(a,c,e,g,l)}function m(a,b,c,d,e,g){var h=d.typedBuffer;d=d.typedBufferStride;var l=a.length;e*=d;if(null==g||1===g)if(4===c)for(c=0;c<l;++c){var m=4*a[c];h[e]=b[m];h[e+1]=b[m+1];h[e+2]=b[m+2];h[e+3]=b[m+3];e+=d}else{if(3===c)for(c=0;c<l;++c)m=3*a[c],h[e]=b[m],h[e+1]=b[m+1],h[e+2]=b[m+2],h[e+3]=255,e+=d}else if(4===c)for(c=0;c<l;++c)for(var m=4*a[c],n=0;n<g;++n)h[e]=b[m],h[e+1]=b[m+1],h[e+2]=b[m+2],h[e+3]=b[m+3],e+=d;else if(3===
c)for(c=0;c<l;++c)for(m=3*a[c],n=0;n<g;++n)h[e]=b[m],h[e+1]=b[m+1],h[e+2]=b[m+2],h[e+3]=255,e+=d}function l(a,b,c,d,e,g,l){var h=e.typedBuffer;e=e.typedBufferStride;var m=a.length;g*=e;if(null==l||1===l)if(4===c)for(c=0;c<m;++c){var n=4*a[c];h[g]=b[n]*d[0];h[g+1]=b[n+1]*d[1];h[g+2]=b[n+2]*d[2];h[g+3]=b[n+3]*d[3];g+=e}else{if(3===c){var k=255*d[3];for(c=0;c<m;++c)n=3*a[c],h[g]=b[n]*d[0],h[g+1]=b[n+1]*d[1],h[g+2]=b[n+2]*d[2],h[g+3]=k,g+=e}}else if(4===c)for(c=0;c<m;++c)for(var n=4*a[c],f=0;f<l;++f)h[g]=
b[n]*d[0],h[g+1]=b[n+1]*d[1],h[g+2]=b[n+2]*d[2],h[g+3]=b[n+3]*d[3],g+=e;else if(3===c)for(k=255*d[3],c=0;c<m;++c)for(n=3*a[c],f=0;f<l;++f)h[g]=b[n]*d[0],h[g+1]=b[n+1]*d[1],h[g+2]=b[n+2]*d[2],h[g+3]=k,g+=e}Object.defineProperty(f,"__esModule",{value:!0});f.writeBufferVec2=g;f.writeBufferVec3=b;f.writeBufferVec4=e;f.writePosition=c;f.writeNormal=d;f.writeColor=m;f.writeMultipliedColor=l;f.writeDefaultAttributes=function(b,n,f,t,u,r,y){var h=0;for(f=f.fieldNames;h<f.length;h++){var q=f[h],w=b.vertexAttr[q],
B=b.indices[q];if(w&&B)switch(q){case a.VertexAttrConstants.POSITION:a.assert(3===w.size);(q=r.getField(q,k.BufferViewVec3f))&&c(B,w.data,t,q,y);break;case a.VertexAttrConstants.NORMAL:a.assert(3===w.size);(q=r.getField(q,k.BufferViewVec3f))&&d(B,w.data,u,q,y);break;case a.VertexAttrConstants.UV0:a.assert(2===w.size);(q=r.getField(q,k.BufferViewVec2f))&&g(B,w.data,q,y);break;case a.VertexAttrConstants.REGION:a.assert(4===w.size);(q=r.getField(q,k.BufferViewVec4u16))&&e(B,w.data,q,y);break;case a.VertexAttrConstants.COLOR:a.assert(3===
w.size||4===w.size);(q=r.getField(q,k.BufferViewVec4u8))&&(n&&n.color?l(B,w.data,w.size,n.color,q,y):m(B,w.data,w.size,q,y));break;case a.VertexAttrConstants.SYMBOLCOLOR:a.assert(3===w.size||4===w.size),(q=r.getField(q,k.BufferViewVec4u8))&&m(B,w.data,w.size,q,y)}}}})},"esri/views/3d/webgl-engine/shaders/HUDPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",
{value:!0});var b=function(a){return g.glslifyDefineMap({OCCL_TEST:a.occlTest,SIGNED_DISTANCE_FIELD:a.sdf,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:a.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:a.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:a.binaryHighlightOcclusion,SLICE:a.slice})};f.colorPass={name:"hud-color",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/hud/hud.vert"),
fragmentShader:b(e)+a.resolveIncludes("materials/hud/colorPass.frag")}},attributes:k.Default3D};f.highlightPass={name:"hud-highlight",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/hud/hud.vert"),fragmentShader:b(e)+a.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:k.Default3D};f.occlusionPass={name:"hud-occlusion",shaders:function(b){return{vertexShader:g.glslifyDefineMap({VERTICAL_OFFSET:b.verticalOffset,SCREEN_SIZE_PERSPECTIVE:b.screenSizePerspective,
CENTER_OFFSET_UNITS_SCREEN:b.centerOffsetUnitsScreen,SLICE:b.slice})+a.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:a.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:k.Default3D}})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../Color ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/LabelClass ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./graphicUtils ./labelPlacement ../../support/debugFlags ../../webgl-engine/Stage ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextTexture ../../webgl-engine/lib/TextTextureAtlas".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function f(a){a=b.call(this)||this;a.labelStageLayer=null;a.labels={};a.labelsToAdd={};a.labelsToRemove={};a.labelingContexts=[];a.idHint="__labeler";a.dirty=!1;return a}k(f,b);C=f;f.prototype.setup=function(){var a=this;this.handles||(this.handles=new e,this.handles.add([this.view.watch("state.camera",function(){return a.setDirty()})]));this.labelStageLayer||(this.labelStageLayer=new y(this.idHint,
{isPickable:!1},this.idHint+"_labels"),this.view._stage.add(r.ModelContentType.LAYER,this.labelStageLayer),this.view._stage.addToViewContent([this.labelStageLayer.id]),this.textTextureAtlas=new w(this.idHint+"_atlas",this.view),this.hudMaterialCollection=new x(this.view._stage),this.calloutMaterialCollection=new x(this.view._stage));this.handles.add(this.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a.needsIdleUpdate()},idleFrame:function(b){return a.idleUpdate(b)}}))};
f.prototype.dispose=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.labelStageLayer&&(this.view._stage.removeFromViewContent([this.labelStageLayer.id]),this.view._stage.remove(r.ModelContentType.LAYER,this.labelStageLayer.id),this.labelStageLayer=null,this.textTextureAtlas.dispose(),this.textTextureAtlas=null,this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null,this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelingContexts=
[];this.labels={};this.labelsToAdd={};this.labelsToRemove={}};f.prototype.isActiveLabelingContext=function(a){return a.active&&this.labelsEnabled(a)};f.prototype.activateLabelingContext=function(a){for(var b in a.labels){var c=a.labels[b];this.labels[b]=c;c.graphics3DGraphic.setVisibilityFlag(0,!0,1)}a.active=!0};f.prototype.deactivateLabelingContext=function(a){for(var b in a.labels){var c=a.labels[b];c.graphics3DGraphic.setVisibilityFlag(0,!1,1);c.rendered&&(this.labelsToRemove[b]=a.labels[b]);
delete this.labels[b];delete this.labelsToAdd[b]}a.active=!1};f.prototype.addLabelTextureToAtlas=function(a){for(var b=0,c=0;c<a.graphics3DGraphic._labelGraphics.length;c++){var d=a.graphics3DGraphic._labelGraphics[c];if(d._labelClass){var e=a.textTextures[b];b++;e&&this.textTextureAtlas.addTextTexture(e,d.stageObject)}}a.rendered=!0};f.prototype.removeLabelTextureFromAtlas=function(a){for(var b=a.graphics3DGraphic,c=0;c<b._labelGraphics.length;c++)a.textTextures[c]&&this.textTextureAtlas.removeTextTexture(a.textTextures[c],
b._labelGraphics[c].stageObject);a.rendered=!1};f.prototype.needsIdleUpdate=function(){return this.isDirty};f.prototype.idleUpdate=function(a){if(this.view.ready){for(var b=!!a,c=!1,d=!1,e=0,h=this.labelingContexts;e<h.length;e++){var g=h[e];if(this.isActiveLabelingContext(g)){if(!this.hasValidLabelClassContext(g)){if(this.hasInvalidLabelClassContext(g)){this.deactivateLabelingContext(g);continue}this.createLabelClassContext(g);if(this.hasPendingLabelClassContext(g)){c=!0;continue}if(!this.hasValidLabelClassContext(g))continue}for(var l in g.labelsToInitialize){if(b&&
a.done())return;var m=g.labelsToInitialize[l];!m.hasGraphics3DResources&&this.createGraphics3DResources(m)&&(this.labels[l]=m,d=!0);m.hasGraphics3DResources&&!m.hasTextTextureResources&&m.visible&&this.createTextTextureResources(m);(m.visible&&m.hasTextTextureResources||!m.visible&&m.hasGraphics3DResources)&&delete g.labelsToInitialize[l]}}}b&&d&&this.view.deconflictor.setDirty();for(l in this.labelsToRemove)this.removeLabelTextureFromAtlas(this.labelsToRemove[l]),delete this.labelsToRemove[l];for(l in this.labelsToAdd)this.addLabelTextureToAtlas(this.labelsToAdd[l]),
delete this.labelsToAdd[l];c||(this.dirty=!1)}};f.prototype.hasPendingLabelClassContext=function(a){return a.labelClassPromise&&!a.labelClassPromise.isResolved()};f.prototype.hasValidLabelClassContext=function(a){return a.labelClassContexts&&a.labelClassContexts.length};f.prototype.hasInvalidLabelClassContext=function(a){return null===a.labelClassContexts};f.prototype.createLabelClassContext=function(a){if(a.labelClassPromise)return a.labelClassPromise;a.labelClassPromise=a.layer.when(function(){a.scaleVisibility&&
a.scaleVisibility.updateScaleRangeActive();var b=a.graphics3DCore,d=b.layer.labelingInfo&&b.layer.labelingInfo.filter(function(a){return!!a.symbol});if(!d||0===d.length)return null;var e=Array(d.length),d=d.map(function(a,c){var d=a.symbol,g=q.getGraphics3DSymbol(b.getOrCreateGraphics3DSymbol(d)),l=null;h.isCalloutSupport(d)&&d.hasVisibleCallout()&&(l=n.make(d,b.symbolCreationContext));e[c]={labelClass:a,graphics3DSymbol:g,graphics3DCalloutSymbolLayer:l,options:a.getOptions(),calloutSymbolLayerIndex:0};
return g});return c.all(d).then(function(){return e})}).then(function(b){b&&(a.labelClassContexts=b)}).catch(function(){a.labelClassContexts=null});return a.labelClassPromise};f.prototype.destroyLabelClassContext=function(a){for(var b=0,c=a.labelClassContexts;b<c.length;b++){var d=c[b];--d.graphics3DSymbol.referenced;d.graphics3DSymbol=null}a.labelClassContexts=[];a.labelClassPromise=null};f.prototype.createLabelText=function(a,b,c,d){if(!l.evaluateWhere(b.where,a.attributes))return null;b=b.getLabelExpression();
return b.expression?l.buildLabelText(b.expression,a,d.fields,c):null};f.prototype.createTextSymbolGraphic=function(a,b,c,d,e){a={text:a,centerOffset:c.centerOffset,translation:c.translation,elevationOffset:c.elevationOffset,screenOffset:c.screenOffset,anchor:c.anchor,needsOffsetAdjustment:c.needsOffsetAdjustment,centerOffsetUnits:c.centerOffsetUnits,verticalOffset:c.verticalOffset,debugDrawBorder:u.LABELS_SHOW_BORDER};C.tmpGraphicCreationContext.graphic=b;C.tmpGraphicCreationContext.renderingInfo=
null;C.tmpGraphicCreationContext.layer=d;return e.createGraphics3DGraphic(C.tmpGraphicCreationContext,a,this.hudMaterialCollection,this.textTextureAtlas)};f.prototype.createLineCalloutGraphic=function(a,b,c,d,e){C.tmpGraphicCreationContext.graphic=a;C.tmpGraphicCreationContext.renderingInfo={symbol:b,needsOffsetAdjustment:d.needsOffsetAdjustment,translation:d.translation,elevationOffset:d.elevationOffset,screenOffset:d.screenOffset,centerOffset:d.centerOffset,centerOffsetUnits:d.centerOffsetUnits,
materialCollection:this.calloutMaterialCollection};C.tmpGraphicCreationContext.layer=e;return c.createGraphics3DGraphic(C.tmpGraphicCreationContext)};f.prototype.createGraphics3DResources=function(a){var b=a.graphics3DGraphic;if(b.destroyed)return!1;var c=a.labelingContext,d=!1,e=b.graphic,h=c.labelClassContexts,g=c.layer,l=this.labelsEnabled(c);if(!h||0===h.length||!b._graphics[0])return!1;for(var m=0;m<h.length;m++){var n=h[m],k=n.labelClass,f=this.createLabelText(e,k,n.options,g);if(f){var q=n.graphics3DSymbol,
r=null;q.symbol&&"label-3d"===q.symbol.type&&(r=q.symbol);var u=q.childGraphics3DSymbols[0],q=t.get({graphics3DGraphic:b,labelSymbol:r,labelClass:n.labelClass});if(u&&q){if(d=this.createTextSymbolGraphic(f,e,q,g,u)){if(d._labelClass=k,b.addLabelGraphic(d,this.labelStageLayer,this.view._stage),c.spatialIndex&&c.spatialIndex.add(b),b.setVisibilityFlag(0,l,1),b.setVisibilityFlag(1,void 0,1),b.setVisibilityFlag(2,!1,1),d=!0,n.graphics3DCalloutSymbolLayer&&q.hasLabelVerticalOffset&&(e=this.createLineCalloutGraphic(e,
r,n.graphics3DCalloutSymbolLayer,q,g)))n.calloutSymbolLayerIndex=b._labelGraphics.length,b.addLabelGraphic(e,this.labelStageLayer,this.view._stage)}else return!1;break}}}c.scaleVisibility&&d&&c.scaleVisibility.updateGraphicLabelScaleVisibility(b);return a.hasGraphics3DResources=!0};f.prototype.destroyGraphics3DResources=function(a){a.graphics3DGraphic.clearLabelGraphics();a.hasGraphics3DResources=!1};f.prototype.createTextTextureResources=function(a){var b=a.labelingContext,c=a.graphics3DGraphic,
e=b.labelClassContexts,b=b.layer,h=c.graphic;if(e&&0!==e.length&&c._graphics[0]){for(c=0;c<e.length;c++){var l=e[c],m=this.createLabelText(h,l.labelClass,l.options,b)||h.symbol&&h.symbol.text;if(m&&!(1>m.length)){var l=l.graphics3DSymbol.childGraphics3DSymbols[0].symbol,n=l.material?g.toUnitRGBA(l.material.color):B,k=l.halo&&l.halo.color&&0<l.halo.size,f=k?g.toUnitRGBA(l.halo.color):B,k=k?d.pt2px(l.halo.size):0,q=d.pt2px(l.size)||12,m=new z(m,{size:q,color:n,font:{family:l.font&&l.font.family?l.font.family:
"sans-serif",weight:l.font&&l.font.weight?l.font.weight:"normal",style:l.font&&l.font.style?l.font.style:"normal"},halo:{size:k,color:f}},b.id+"_label_"+h.uid);a.textTextures.push(m)}}a.hasTextTextureResources=!0}};f.prototype.destroyTextTextureResources=function(a){a.textTextures=[];a.hasTextTextureResources=!1};f.prototype.addGraphic=function(a,b){var c={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:a,graphics3DGraphic:b,textTextures:[]};b=b.graphic.uid;
a.labels[b]=c;this.isActiveLabelingContext(a)&&this.hasValidLabelClassContext(a)&&this.createGraphics3DResources(c)?this.labels[b]=c:a.labelsToInitialize[b]=c;this.setDirty(a.graphics3DCore.asyncUpdates);this.view.deconflictor.setDirty()};f.prototype.removeGraphic=function(a,b){b=b.graphic.uid;var c=a.labels[b];c&&(this.labels[b]&&(this.removeLabelTextureFromAtlas(c),delete this.labels[b],delete this.labelsToAdd[b],delete this.labelsToRemove[b]),c.hasTextTextureResources&&this.destroyTextTextureResources(c),
c.hasGraphics3DResources&&this.destroyGraphics3DResources(c),delete a.labels[b],delete a.labelsToInitialize[b],this.setDirty(a.graphics3DCore.asyncUpdates),this.view.deconflictor.setDirty())};f.prototype.labelsEnabled=function(a){return!0===a.layer.labelsVisible&&null!=a.layer.labelingInfo&&0<a.layer.labelingInfo.length};f.prototype.labelingInfoChange=function(a,b){if(b){for(var d=0;d<b.length;d++){var e=a.labels[b[d]];e&&(this.removeGraphic(a,e.graphics3DGraphic),this.addGraphic(a,e.graphics3DGraphic))}return c.create(function(a){return!0})}this.visibilityInfoChange(a);
this.resetLabels(a);return this.createLabelClassContext(a)};f.prototype.layerPropertyChanged=function(a,b){for(var c=function(c){var d=new Map,e;for(e in b.labels){var h=b.labels[e].graphics3DGraphic;d.set(h.graphic.uid,h)}c.graphics3DSymbol.childGraphics3DSymbols[0].layerPropertyChanged(a,d,function(a){return a._labelGraphics[0]});c.graphics3DCalloutSymbolLayer&&c.graphics3DCalloutSymbolLayer.layerPropertyChanged(a,d,function(a){return a._labelGraphics[c.calloutSymbolLayerIndex]})},d=0,e=b.labelClassContexts;d<
e.length;d++)c(e[d])};f.prototype.visibilityInfoChange=function(a){var b=a.layer.labelsVisible;b&&!a.active&&this.activateLabelingContext(a);!b&&a.active&&this.deactivateLabelingContext(a);this.setDirty(a.graphics3DCore.asyncUpdates)};f.prototype.resetLabels=function(a){for(var b in a.labels){var c=a.labels[b];this.labels[b]&&(this.removeLabelTextureFromAtlas(c),delete this.labels[b],delete this.labelsToAdd[b],delete this.labelsToRemove[b]);c.hasTextTextureResources&&this.destroyTextTextureResources(c);
c.hasGraphics3DResources&&this.destroyGraphics3DResources(c);c.visible=!1;c.rendered=!1;a.labelsToInitialize[b]=c}this.destroyLabelClassContext(a);this.labelStageLayer.invalidateSpatialQueryAccelerator();this.setDirty(a.graphics3DCore.asyncUpdates);this.view.deconflictor.setDirty()};f.prototype.findLabelingContext=function(a){for(var b=0,c=this.labelingContexts;b<c.length;b++){var d=c[b];if(d.graphics3DCore===a)return d}return null};f.prototype.addGraphicsOwner=function(a,b,c){var d=this;if(!this.findLabelingContext(a)){var e=
{graphics3DCore:a,layer:a.layer,scaleVisibility:b,spatialIndex:c,active:a.layer.labelsVisible,labelClassPromise:null,labelClassContexts:[],labels:{},labelsToInitialize:{}};this.labelingContexts.push(e);this.setDirty();return{addGraphic:function(a){return d.addGraphic(e,a)},removeGraphic:function(a){return d.removeGraphic(e,a)},layerLabelsEnabled:function(){return d.labelsEnabled(e)},labelingInfoChange:function(a){return d.labelingInfoChange(e,a)},elevationInfoChange:function(){return d.layerPropertyChanged("elevationInfo",
e)},slicePlaneEnabledChange:function(){return d.layerPropertyChanged("slicePlaneEnabled",e)},visibilityInfoChange:function(){return d.visibilityInfoChange(e)},reset:function(){return d.resetLabels(e)}}}};f.prototype.removeGraphicsOwner=function(a){if(a=this.findLabelingContext(a)){var b=this.labelingContexts.indexOf(a);this.labelingContexts.splice(b,1);for(var c in a.labels)this.removeGraphic(a,a.labels[c].graphics3DGraphic);this.setDirty()}};f.prototype.setLabelGraphicVisibility=function(a,b){a=
a.graphic.uid;var c=this.labels[a];c&&(b&&!c.rendered?(this.labelsToAdd[a]=c,c.hasTextTextureResources||(c.labelingContext.labelsToInitialize[a]=c)):!b&&c.rendered&&(this.labelsToRemove[a]=c),c.visible=b,this.setDirty(c.labelingContext.graphics3DCore.asyncUpdates))};Object.defineProperty(f.prototype,"labelStageLayerId",{get:function(){return this.labelStageLayer.id},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"isDirty",{get:function(){return this.dirty||this.textTextureAtlas&&
this.textTextureAtlas.isDirty},enumerable:!0,configurable:!0});f.prototype.setDirty=function(a){void 0===a&&(a=!0);this.dirty=!0;a||this.idleUpdate()};Object.defineProperty(f.prototype,"updating",{get:function(){return this.labelingContexts.some(function(a){return a.labelClassPromise&&!a.labelClassPromise.isResolved()})},enumerable:!0,configurable:!0});var C;f.tmpGraphicCreationContext={graphic:null,renderingInfo:null,layer:null};a([m.property({constructOnly:!0})],f.prototype,"view",void 0);a([m.property({type:Boolean,
readOnly:!0})],f.prototype,"updating",null);return f=C=a([m.subclass()],f)}(m.declared(b));f.Labeler=p;var B=[0,0,0,1]})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require","exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});var b=k.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");f.make=function(c,
d){if(!a.isCalloutSupport(c))return b.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+c.type+"' does not support callouts"),null;if(!c.callout)return null;var g=e[c.callout.type];return g?new g(c,d):(b.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+c.callout.type),null)};var e={line:g}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./symbolComplexity ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u){var r,y,x=t.VertexAttrConstants;p=function(d){function f(a,b){a=d.call(this,a,null,b,!0)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}k(f,d);f.prototype.destroy=function(){d.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(h.ModelContentType.MATERIAL,this._material.id),this._material=null)};f.prototype._prepareResources=function(){var a=this._getStageIdHint();
this._createMaterialsAndAddToStage(this._context.stage,a);this.resolve()};f.prototype.perInstanceMaterialParameters=function(a){var b=this.materialParameters;b.screenOffset=a.screenOffset||[0,0];b.centerOffsetUnits=a.centerOffsetUnits||"world";return b};Object.defineProperty(f.prototype,"materialParameters",{get:function(){var b=this.symbolContainer,c=b.callout,d=a.toUnitRGBA(c.color);d[3]*=this._getLayerOpacity();var e=g.pt2px(c.size||0),h=null;if(b.verticalOffset)var h=b.verticalOffset,l=h.minWorldLength,
m=h.maxWorldLength,h={screenLength:g.pt2px(h.screenLength),minWorldLength:l||0,maxWorldLength:null!=m?m:Infinity};c=c.border&&c.border.color?a.toUnitRGBA(c.border.color):null;l="object"===b.symbolLayers.getItemAt(0).type;return{color:d,size:e,verticalOffset:h,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:c,occlusionTest:!l,shaderPolygonOffset:l?0:void 0,depthHUDAlignStart:"label-3d"===
b.type,slicePlaneEnabled:this._context.slicePlaneEnabled}},enumerable:!0,configurable:!0});f.prototype._createMaterialsAndAddToStage=function(a,b){this._material=new u(this.materialParameters,b+"_lineCallout_common");a.add(h.ModelContentType.MATERIAL,this._material)};f.prototype._defaultElevationInfoNoZ=function(){return B};f.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);
var c=this.getGraphicElevationContext(a,b.elevationOffset||0),d=b.symbol,e="on-the-ground"===this._elevationContext.mode&&!d.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type});if("label-3d"!==d.type&&e)return null;d=m.computeCentroid(a.geometry);return null==d?null:this._createAs3DShape(a,d,c,b,"graphic"+a.uid,a.uid)};f.prototype.layerOpacityChanged=function(){this._material.setParameterValues(this.materialParameters);return!0};f.prototype.layerElevationInfoChanged=function(a,
b,c){var d=this,e=this._elevationContext.mode;if(c!==e&&("on-the-ground"===c||"on-the-ground"===e))return!1;a.forEach(function(a){var c=b(a);c&&d.updateGraphicElevationContext(a.graphic,c)});return!0};f.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};f.prototype.getGraphicElevationContext=function(a,b){void 0===b&&(b=0);a=d.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(b);return a};
f.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=c.needsElevationUpdates2D(a.mode)};f.prototype.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,memory:l.emptySymbolComplexity.memory}};f.prototype.createVertexData=function(a){var b,c=a.translation;a=a.centerOffset;if(!c&&!a)return z;c=c?{size:3,data:[c[0],c[1],c[2]]}:z[x.POSITION];a=a?{size:4,
data:[a[0],a[1],a[2],a[3]]}:z[x.AUXPOS1];return b={},b[x.POSITION]=c,b[x.NORMAL]=z[x.NORMAL],b[x.AUXPOS1]=a,b};f.prototype.getOrCreateMaterial=function(a,b){var c=this.perInstanceMaterialParameters(a),d=u.uniqueMaterialIdentifier(c);if(d===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var e=a.materialCollection.getMaterial(d);e||(e=new u(c,b+"_lineCallout_shared"),a.materialCollection.addMaterial(d,e));return{material:e,isUnique:!1}}e=
new u(c,b+"_lineCallout_unique");return{material:e,isUnique:!0}};f.prototype._createAs3DShape=function(a,d,h,g,l,m){a=new q(this.createVertexData(g),w,q.DefaultOffsets,"point");a=[new n(a,l)];var k=this.getOrCreateMaterial(g,l);l=c.createStageObjectForPoint(this._context,d,a,[k.material],null,null,h,l,this._context.layer.uid,m,!0);if(null===l)return null;m=new e(this,l.object,a,k.isUnique?[k.material]:null,null,b.perObjectElevationAligner,h);m.metadata={elevationOffset:g.elevationOffset||0};m.alignedTerrainElevation=
l.terrainElevation;m.needsElevationUpdates=c.needsElevationUpdates2D(h.mode);c.extendPointGraphicElevationContext(m,d,this._context.elevationProvider);return m};return f}(d);var z=(r={},r[x.POSITION]={size:3,data:[0,0,0]},r[x.NORMAL]={size:3,data:[0,0,1]},r[x.AUXPOS1]={size:4,data:[0,0,0,1]},r);r=new Uint32Array([0]);var w=(y={},y[x.POSITION]=r,y[x.NORMAL]=r,y[x.AUXPOS1]=r,y),B={mode:"relative-to-ground",offset:0};return p})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Point ./Graphics3DSymbolCommonCode ./graphicUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,"__esModule",{value:!0});var m=d.VertexAttrConstants,l=new a,h=k.vec3f64.create(),n=k.vec3f64.create(),q=k.vec3f64.create(),t=k.mat4f64.create(),u=k.vec3f64.create(),r={verticalDistanceToGround:0,terrainElevation:0};f.perVertexElevationAligner=function(a,b,c,d){a=a.stageObject;l.spatialReference=c.spatialReference;for(var k=a.getGeometryRecords(),u=k.length,w="absolute-height"!==b.mode,t=0,z=0;z<u;z++){var y=k[z].geometry,x=k[z].getShaderTransformation();
n[0]=x[12];n[1]=x[13];n[2]=x[14];y.invalidateBoundingInfo();for(var x=y.data.getVertexAttr(),p=x[m.POSITION],y=p.data,x=x.mapPos.data,p=p.size,S=y.length/p,M=0,P=0,O=!1,W=0,Q=0;Q<S;Q++){l.x=x[P++];l.y=x[P++];l.z=x[P++];q[0]=y[M];q[1]=y[M+1];q[2]=y[M+2];var J=g.computeElevation(c,l,b,d,w?r:null);w&&(W+=r.terrainElevation);h[0]=y[M]+n[0];h[1]=y[M+1]+n[1];h[2]=y[M+2]+n[2];d.setAltitude(J,h);y[M]=h[0]-n[0];y[M+1]=h[1]-n[1];y[M+2]=h[2]-n[2];if(e.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)O=!0;else if(J=
f.updateThresholdInMeters/d.unitInMeters,Math.abs(q[0]-y[M])>=J||Math.abs(q[1]-y[M+1])>=J||Math.abs(q[2]-y[M+2])>=J)O=!0;M+=p}t+=W/S;O&&a.geometryVertexAttrsUpdated(z)}return t/u};f.perObjectElevationAligner=function(a,d,l,m,n){a=a.stageObject;var q=d.centerPointInElevationSR,w=0;n=0;if(a.metadata.usesVerticalDistanceToGround)w=g.computeElevation(l,q,d,m,r),b.updateVertexAttributeAuxpos1w(a,r.verticalDistanceToGround),n=r.terrainElevation;else{var t="absolute-height"!==d.mode,w=g.computeElevation(l,
q,d,m,t?r:null);t&&(n=r.terrainElevation)}d=a.getObjectTransformation();l=k.vec3.set(u,d[12],d[13],d[14]);e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(h[0]=q.x,h[1]=q.y,h[2]=w,c.computeLinearTransformation(q.spatialReference,h,d,m.spatialReference)&&a.setObjectTransformation(d)):m.setAltitudeOfTransformation(w,d);m=f.updateThresholdInMeters/m.unitInMeters;(Math.abs(d[12]-l[0])>=m||Math.abs(d[13]-l[1])>=m||Math.abs(d[14]-l[2])>=m)&&a.setObjectTransformation(d);return n};f.perLodInstanceElevationAligner=
function(a,b,d,l,m){var n=b.centerPointInElevationSR,q=0;m=0;var w="absolute-height"!==b.mode,q=g.computeElevation(d,n,b,l,w?r:null);w&&(m=r.terrainElevation);b=a.graphics3DSymbolLayer.lodRenderer.instanceData;a=a.instanceIndex;b.getGlobalTransform(a,t);d=k.vec3.set(u,t[12],t[13],t[14]);e.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(h[0]=n.x,h[1]=n.y,h[2]=q,c.computeLinearTransformation(n.spatialReference,h,t,l.spatialReference)&&b.setGlobalTransform(a,t)):l.setAltitudeOfTransformation(q,t);l=f.updateThresholdInMeters/
l.unitInMeters;(Math.abs(t[12]-d[0])>=l||Math.abs(t[13]-d[1])>=l||Math.abs(t[14]-d[2])>=l)&&b.setGlobalTransform(a,t);return m};f.updateThresholdInMeters=.01;f.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/coordsUtils ../../../../geometry/support/triangulationUtils ../../../../layers/graphics/dehydratedFeatures ../../../../symbols/callouts/calloutUtils ./graphicUtils ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){function h(a,b,c,d,e){var h=b.z||0,g=c.featureExpressionInfoContext;switch(c.mode){case "on-the-ground":return c=a.getElevation(b,"ground")||0,e&&(e.verticalDistanceToGround=0,e.terrainElevation=c),c;case "relative-to-ground":return a=a.getElevation(b,"ground")||0,c=c.calculateOffsetRenderUnits(d),null==g&&(c+=h),e&&(e.verticalDistanceToGround=c,e.terrainElevation=a),c+a;case "relative-to-scene":return a=a.getElevation(b,"scene")||0,c=c.calculateOffsetRenderUnits(d),
e&&(e.verticalDistanceToGround=c,e.terrainElevation=a),c+a;case "absolute-height":return c=c.calculateOffsetRenderUnits(d),null==g&&(c+=h),e&&(a=a.getElevation(b,"ground")||0,e.verticalDistanceToGround=c-a,e.terrainElevation=a),c;default:k.neverReached(c.mode)}return 0}function n(a,c){a=b.pathsToTriangulationInfo(a,c);return{vertexData:a.position,polygons:a.polygons,outlines:a.outlines}}function q(a,b,c,d,e){b*=3;d*=3;for(var h=0;h<e;++h)c[d++]=a[b++],c[d++]=a[b++],c[d++]=a[b++]}function t(a,b,c,
d,e,h,g){return m.bufferToBuffer(a,c,b,d,h,e,g)}function u(a,b,c){m.pointToVector(a,b,c)}function r(a,b){return!(a[0]>b[3]||a[0]<b[0]||a[1]>b[4]||a[1]<b[1])}function y(a,b){return!(b[0]>a[3]||b[3]<a[0]||b[1]>a[4]||b[4]<a[1])}Object.defineProperty(f,"__esModule",{value:!0});var x=a.vec3f64.create(),z=a.mat4f64.create(),w=e.makeDehydratedPoint(0,0,0,null);f.createStageObjectForPoint=function(a,b,c,e,g,n,k,f,q,w,t,y){var C=c?c.length:0,D=a.clippingExtent;u(b,x,a.elevationProvider.spatialReference);if(D&&
!r(x,D))return null;u(b,x,a.renderSpatialReference);D=a.localOriginFactory.getOrigin(x);f=new l({castShadow:!1,metadata:{layerUid:q,graphicUid:w,usesVerticalDistanceToGround:!!t},idHint:f});for(q=0;q<C;q++)f.addGeometry(c[q],e[q],g?g[q]:z,n,D,y);c=a.renderSpatialReference;e=a.elevationProvider;g=a.renderCoordsHelper;a=0;var F;f.metadata.usesVerticalDistanceToGround?(a=h(e,b,k,g,B),d.updateVertexAttributeAuxpos1w(f,B.verticalDistanceToGround),F=B.terrainElevation):(n="absolute-height"!==k.mode,a=h(e,
b,k,g,n?B:null),n&&(F=B.terrainElevation));k=f.getObjectTransformation();x[0]=b.x;x[1]=b.y;x[2]=a;m.computeLinearTransformation(b.spatialReference,x,k,c)?f.setObjectTransformation(k):console.warn("Could not locate symbol object properly, it might be misplaced");return{object:f,terrainElevation:F}};f.extendPointGraphicElevationContext=function(a,b,c){a=a.elevationContext;c=c.spatialReference;u(b,x,c);a.centerPointInElevationSR=e.makeDehydratedPoint(x[0],x[1],b.hasZ?x[2]:0,c)};f.placePointOnGeometry=
function(a){switch(a.type){case "point":return a;case "polygon":case "extent":return d.computeCentroid(a);case "polyline":var b=a.paths[0];if(!b||0===b.length)break;b=g.getPointOnPath(b,g.getPathLength(b)/2);return e.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference);case "mesh":return a.extent.center}return null};f.computeElevation=h;f.getSingleSizeDriver=function(a,b){void 0===b&&(b=0);return isFinite(a[b])?a[b]:null};f.copyPathData=n;f.copyVertices=q;f.chooseOrigin=function(a,b,c,d){b=Math.floor(b+
(c-1)/2);d[0]=a[3*b+0];d[1]=a[3*b+1];d[2]=a[3*b+2]};f.subtractCoordinates=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b++]-=d[0],a[b++]-=d[1],a[b++]-=d[2]};f.setZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]=d,b+=3};f.offsetZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]+=d,b+=3};f.scaleZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]*=d,b+=3};f.flatArrayToArrayOfArrays=function(a,b,c){var d=[];b*=3;for(var e=0;e<c;++e)d.push([a[b++],a[b++],a[b++]]);return d};f.reproject=t;f.reprojectPoint=
u;f.getGeometryVertexData3D=function(a,b,c,d,e,h,g){var l=e.spatialReference;a=n(a,b);b=a.vertexData;var m=b.length/3,k=new Float64Array(b.length),f=!0;c.equals(l)?q(b,0,k,0,b.length):f=t(b,0,c,k,0,l,m);var r=c=0,u=g.mode,z=0,B=0,y=0;h=g.calculateOffsetRenderUnits(h);g=g.featureExpressionInfoContext;w.spatialReference=e.spatialReference;c*=3;for(var r=3*r,x=0;x<m;++x){w.x=k[c+0];w.y=k[c+1];w.z=k[c+2];switch(u){case "on-the-ground":B=z=e.getElevation(w)||0;y+=z;break;case "relative-to-ground":z=e.getElevation(w)||
0;B=z+h;null==g&&(B+=w.z);y+=z;break;case "relative-to-scene":z=e.getElevation(w,"scene")||0;B=z+h;y+=z;break;case "absolute-height":B=h,null==g&&(B+=w.z)}b[r+0]=k[c+0];b[r+1]=k[c+1];b[r+2]=B;c+=3;r+=3}e=y/m;l.equals(d)||t(b,0,l,b,0,d,m);return{geometryData:a,vertexData:b,eleVertexData:k,terrainElevation:e,projectionSuccess:f}};f.getGeometryVertexDataDraped=function(a,b,c){a=n(a,!1);var d=a.vertexData,e=d.length/3,h=!0;b.equals(c)||(h=m.bufferToBuffer(d,b,0,d,c,0,e));return{geometryData:a,vertexData:d,
projectionSuccess:h}};f.computeBoundingBox=function(a,b,c,d){d[0]=Number.MAX_VALUE;d[1]=Number.MAX_VALUE;d[2]=Number.MAX_VALUE;d[3]=-Number.MAX_VALUE;d[4]=-Number.MAX_VALUE;d[5]=-Number.MAX_VALUE;b*=3;for(var e=0;e<c;++e){var h=a[b++],g=a[b++],l=a[b++];h<d[0]&&(d[0]=h);g<d[1]&&(d[1]=g);l<d[2]&&(d[2]=l);h>d[3]&&(d[3]=h);g>d[4]&&(d[4]=g);l>d[5]&&(d[5]=l)}return d};f.pointInBox2D=r;f.boxesIntersect2D=y;f.boundingBoxClipped=function(a,b){return b?!y(a,b):!1};f.needsElevationUpdates2D=function(a){return"relative-to-ground"===
a||"relative-to-scene"===a};f.needsElevationUpdates3D=function(a){return"absolute-height"!==a};f.needsOffsetAdjustment=function(a,b,d,e){if(!1===b.needsOffsetAdjustment||!1===b.supportsOffsetAdjustment||"on-the-ground"===a.mode)return!1;if(0===a.meterUnitOffset){if(!0===b.needsOffsetAdjustment)return!0;if(c.isCalloutSupport(e)&&e.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===a.mode&&(!d.hasZ||a.featureExpressionInfoContext)||"relative-to-scene"===a.mode)return!0}return!1};var B={verticalDistanceToGround:0,
terrainElevation:0}})},"esri/layers/graphics/dehydratedFeatures":function(){define("require exports ../../geometry ../../Graphic ../../core/compilerUtils ../../core/lang ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../support/Field ../../views/3d/support/buffer/typedArrayUtil ./dehydratedFeatureComparison".split(" "),function(p,f,k,a,g,b,e,c,d,m,l,h,n){function q(a,b,c){if(!a)return null;switch(b){case "point":return a=
{x:a.x,y:a.y,z:a.z,m:a.m,hasZ:null!=a.z,hasM:null!=a.m,type:b,spatialReference:c};case "polyline":return a={paths:a.paths,hasZ:!!a.hasZ,hasM:!!a.hasM,type:b,spatialReference:c};case "polygon":return a={rings:a.rings,hasZ:!!a.hasZ,hasM:!!a.hasM,type:b,spatialReference:c};case "multipoint":return a={points:a.points,hasZ:!!a.hasZ,hasM:!!a.hasM,type:b,spatialReference:c}}}function t(a,b,c,d){return{x:a,y:b,z:c,hasZ:null!=c,hasM:!1,spatialReference:d,type:"point"}}function u(a){return"declaredClass"in
a}function r(a){return"declaredClass"in a}function y(a){if(!a)return 0;switch(a.type){case "point":return 1;case "polyline":var b=0,c=0;for(a=a.paths;c<a.length;c++)b+=a[c].length;return b;case "polygon":c=b=0;for(a=a.rings;c<a.length;c++)b+=a[c].length;return b;case "multipoint":return a.points.length;case "extent":return 2;case "mesh":return(b=a.vertexAttributes&&a.vertexAttributes.position)?b.length/3:0;default:g.neverReached(a)}}function x(a){var b=a.spatialReference.toJSON();switch(a.type){case "point":return{x:a.x,
y:a.y,z:a.z,m:a.m,spatialReference:b};case "polygon":var c=a.hasZ,d=a.hasM;return{rings:z(a.rings),hasZ:c,hasM:d,spatialReference:b};case "polyline":var e=a.paths,c=a.hasZ,d=a.hasM;return{paths:z(e),hasZ:c,hasM:d,spatialReference:b};case "extent":var e=a.xmin,h=a.xmax,l=a.ymin,m=a.ymax,n=a.zmin,k=a.zmax,f=a.mmin,q=a.mmax,c=a.hasZ,d=a.hasM;return{xmin:e,xmax:h,ymin:l,ymax:m,zmin:n,zmax:k,mmin:f,mmax:q,hasZ:c,hasM:d,spatialReference:b};case "multipoint":return e=a.points,c=a.hasZ,d=a.hasM,{points:C(e)?
w(e):e,hasZ:c,hasM:d,spatialReference:b};default:g.neverReached(a)}}function z(a){if(B(a))return a.map(function(a){return w(a)})}function w(a){return a.map(function(a){return h.toArray(a)})}function B(a){for(var b=0;b<a.length;b++){var c=a[b];if(0!==c.length)return C(c)}return!1}function C(a){return a.length&&(h.isFloat32Array(a[0])||h.isFloat64Array(a[0]))}function D(a,b){c.empty(b);"mesh"===a.type&&(a=a.extent);switch(a.type){case "point":b[0]=b[3]=a.x;b[1]=b[4]=a.y;a.hasZ&&(b[2]=b[5]=a.z);break;
case "polyline":for(var d=0;d<a.paths.length;d++)c.expandWithNestedArray(b,a.paths[d],a.hasZ);break;case "polygon":for(d=0;d<a.rings.length;d++)c.expandWithNestedArray(b,a.rings[d],a.hasZ);break;case "multipoint":c.expandWithNestedArray(b,a.points,a.hasZ);break;case "extent":b[0]=a.xmin;b[1]=a.ymin;b[3]=a.xmax;b[4]=a.ymax;null!=a.zmin&&(b[2]=a.zmin);null!=a.zmax&&(b[5]=a.zmax);break;default:g.neverReached(a)}}function E(a,b){d.empty(b);"mesh"===a.type&&(a=a.extent);switch(a.type){case "point":b[0]=
b[2]=a.x;b[1]=b[3]=a.y;break;case "polyline":for(var c=0;c<a.paths.length;c++)d.expandWithNestedArray(b,a.paths[c]);break;case "polygon":for(c=0;c<a.rings.length;c++)d.expandWithNestedArray(b,a.rings[c]);break;case "multipoint":d.expandWithNestedArray(b,a.points);break;case "extent":b[0]=a.xmin;b[1]=a.ymin;b[2]=a.xmax;b[3]=a.ymax;break;default:g.neverReached(a)}}Object.defineProperty(f,"__esModule",{value:!0});f.equals=n.equals;f.isPoint=function(a){return"point"===a.type};f.fromFeatureSetJSON=function(b){var c=
k.featureGeometryTypeKebabDictionary.fromJSON(b.geometryType),d=e.fromJSON(b.spatialReference),h=b.transform,n=b.features.map(function(e){var l=b.objectIdFieldName;e={uid:a.generateUID(),objectId:l&&e.attributes?e.attributes[l]:null,attributes:e.attributes,geometry:q(e.geometry,c,d),visible:!0};if((l=e.geometry)&&h)switch(l.type){case "point":e.geometry=m.hydratePoint(h,l,l,l.hasZ,l.hasM);break;case "multipoint":e.geometry=m.hydrateMultipoint(h,l,l,l.hasZ,l.hasM);break;case "polygon":e.geometry=m.hydratePolygon(h,
l,l,l.hasZ,l.hasM);break;case "polyline":e.geometry=m.hydratePolyline(h,l,l,l.hasZ,l.hasM);break;default:g.neverReached(l)}return e});return{geometryType:c,features:n,spatialReference:d,fields:b.fields?b.fields.map(function(a){return l.fromJSON(a)}):null,objectIdFieldName:b.objectIdFieldName,globalIdFieldName:b.globalIdFieldName,geohashFieldName:b.geohashFieldName,geometryProperties:b.geometryProperties,hasZ:b.hasZ,hasM:b.hasM,exceededTransferLimit:b.exceededTransferLimit,transform:null}};f.fromJSONGeometry=
q;f.makeDehydratedPoint=t;f.isHydratedGeometry=u;f.isHydratedGraphic=r;f.hydrateGraphic=function(c,d){if(!c||r(c))return c;d=new a({layer:d,sourceLayer:d});d.visible=c.visible;d.symbol=b.clone(c.symbol);d.attributes=b.clone(c.attributes);c.geometry&&("mesh"===c.geometry.type?d.geometry=c.geometry:d.read({geometry:x(c.geometry)}));return d};f.clonePoint=function(a){if(!a)return null;if(u(a))return a.clone();var b=t(a.x,a.y,a.z,a.spatialReference);a.hasM&&(b.m=a.m,b.hasM=!0);return b};f.estimateSize=
function(a){for(var b=32,c=0,d=Object.keys(a.attributes);c<d.length;c++){var e=d[c],b=b+e.length,e=a.attributes[e];switch(typeof e){case "string":b+=e.length;break;default:case "number":b+=8}}a=a.geometry?"mesh"===a.geometry.type?0:y(a.geometry):0;return b+12*a};f.numVertices=y;f.hasVertices=function(a){if(!a)return!1;switch(a.type){case "extent":case "point":return!0;case "polyline":var b=0;for(a=a.paths;b<a.length;b++)if(0<a[b].length)return!0;return!1;case "polygon":b=0;for(a=a.rings;b<a.length;b++)if(0<
a[b].length)return!0;return!1;case "multipoint":return 0<a.points.length;case "mesh":return a.vertexAttributes&&a.vertexAttributes.position&&0<a.vertexAttributes.position.length;default:g.neverReached(a)}};f.computeAABB=D;f.expandAABB=function(a,b){D(a,G);c.expand(b,G)};f.computeAABR=E;f.expandAABR=function(a,b){E(a,H);d.expand(b,H)};var G=c.create(),H=d.create()})},"esri/geometry/support/quantizationUtils":function(){define(["require","exports","./jsonUtils"],function(p,f,k){function a(a,b){return Math.round((b-
a.translate[0])/a.scale[0])}function g(a,b){return Math.round((a.translate[1]-b)/a.scale[1])}function b(b,c,d){for(var e=[],h,l,m,n,k=0;k<d.length;k++){var f=d[k];if(0<k){if(m=a(b,f[0]),n=g(b,f[1]),m!==h||n!==l)e.push(c(f,m-h,n-l)),h=m,l=n}else h=a(b,f[0]),l=g(b,f[1]),e.push(c(f,h,l))}return 0<e.length?e:null}function e(a,c,d,e){return b(a,d?e?G:E:e?E:D,c)}function c(a,c,d,e){var h=[];d=d?e?G:E:e?E:D;for(e=0;e<c.length;e++){var g=b(a,d,c[e]);g&&3<=g.length&&h.push(g)}return h.length?h:null}function d(a,
c,d,e){var h=[];d=d?e?G:E:e?E:D;for(e=0;e<c.length;e++){var g=b(a,d,c[e]);g&&2<=g.length&&h.push(g)}return h.length?h:null}function m(a,b){return b*a.scale[0]+a.translate[0]}function l(a,b){return a.translate[1]-b*a.scale[1]}function h(a,b,c){var d=Array(c.length);if(!c.length)return d;var e=a.scale,h=e[0],e=e[1],g=m(a,c[0][0]);a=l(a,c[0][1]);d[0]=b(c[0],g,a);for(var n=1;n<c.length;n++){var k=c[n],g=g+k[0]*h;a-=k[1]*e;d[n]=b(k,g,a)}return d}function n(a,b,c){for(var d=Array(c.length),e=0;e<c.length;e++)d[e]=
h(a,b,c[e]);return d}function q(a,b,c,d){return h(a,c?d?G:E:d?E:D,b)}function t(a,b,c,d){return n(a,c?d?G:E:d?E:D,b)}function u(a,b,c,d){return n(a,c?d?G:E:d?E:D,b)}function r(a,b,c){var d=c[0],e=d[0],d=d[1],h=Math.min(e,b[0]),g=Math.min(d,b[1]),l=Math.max(e,b[2]);b=Math.max(d,b[3]);for(var m=1;m<c.length;m++){var n=c[m],k=n[0],n=n[1],e=e+k,d=d+n;0>k&&(h=Math.min(h,e));0<k&&(l=Math.max(l,e));0>n?g=Math.min(g,d):0<n&&(b=Math.max(b,d))}a[0]=h;a[1]=g;a[2]=l;a[3]=b;return a}function y(a,b){if(!b.length)return null;
a[0]=a[1]=Number.POSITIVE_INFINITY;a[2]=a[3]=Number.NEGATIVE_INFINITY;for(var c=0;c<b.length;c++)r(a,a,b[c]);return a}function x(b,c,d,e,h){c.xmin=a(b,d.xmin);c.ymin=g(b,d.ymin);c.xmax=a(b,d.xmax);c.ymax=g(b,d.ymax);c!==d&&(e&&(c.zmin=d.zmin,c.zmax=d.zmax),h&&(c.mmin=d.mmin,c.mmax=d.mmax));return c}function z(a,b,c,d,h){b.points=e(a,c.points,d,h);return b}function w(b,c,d,e,h){c.x=a(b,d.x);c.y=g(b,d.y);c!==d&&(e&&(c.z=d.z),h&&(c.m=d.m));return c}function B(a,b,d,e,h){a=c(a,d.rings,e,h);if(!a)return null;
b.rings=a;return b}function C(a,b,c,e,h){a=d(a,c.paths,e,h);if(!a)return null;b.paths=a;return b}Object.defineProperty(f,"__esModule",{value:!0});var D=function(a,b,c){return[b,c]},E=function(a,b,c){return[b,c,a[2]]},G=function(a,b,c){return[b,c,a[2],a[3]]};f.toTransform=function(a){return a?{originPosition:"upperLeft",scale:[a.tolerance,a.tolerance],translate:[a.extent.xmin,a.extent.ymax]}:null};f.equals=function(a,b){if(a===b||null==a&&null==b)return!0;if(null==a||null==b)return!1;var c,d,e,h;a&&
"upperLeft"===a.originPosition?(c=a.translate[0],d=a.translate[1],a=a.scale[0]):(c=a.extent.xmin,d=a.extent.ymax,a=a.tolerance);b&&"upperLeft"===b.originPosition?(e=b.translate[0],h=b.translate[1],b=b.scale[0]):(e=b.extent.xmin,h=b.extent.ymax,b=b.tolerance);return c===e&&d===h&&a===b};f.quantizeX=a;f.quantizeY=g;f.quantizeBounds=function(b,c,d){c[0]=a(b,d[0]);c[3]=g(b,d[1]);c[2]=a(b,d[2]);c[1]=g(b,d[3]);return c};f.quantizePoints=e;f.quantizeRings=c;f.quantizePaths=d;f.hydrateX=m;f.hydrateY=l;f.hydrateCoordsArray=
h;f.hydrateCoordsArrayArray=n;f.hydrateBounds=function(a,b,c){return c?(b[0]=m(a,c[0]),b[1]=l(a,c[3]),b[2]=m(a,c[2]),b[3]=l(a,c[1]),b):[m(a,b[0]),l(a,b[3]),m(a,b[2]),l(a,b[1])]};f.hydratePoints=q;f.hydratePaths=t;f.hydrateRings=u;f.getQuantizedBoundsCoordsArray=r;f.getQuantizedBoundsCoordsArrayArray=y;f.getQuantizedBoundsPoints=function(a){var b=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return r(b,b,a)};f.getQuantizedBoundsPaths=function(a){return y([0,
0,0,0],a)};f.getQuantizedBoundsRings=function(a){return y([0,0,0,0],a)};f.quantizeExtent=x;f.quantizeMultipoint=z;f.quantizePoint=w;f.quantizePolygon=B;f.quantizePolyline=C;f.quantizeGeometry=function(a,b){return a&&b?k.isPoint(b)?w(a,{},b,!1,!1):k.isPolyline(b)?C(a,{},b,!1,!1):k.isPolygon(b)?B(a,{},b,!1,!1):k.isMultipoint(b)?z(a,{},b,!1,!1):k.isExtent(b)?x(a,{},b,!1,!1):null:null};f.hydrateExtent=function(a,b,c,d,e){b.xmin=m(a,c.xmin);b.ymin=l(a,c.ymin);b.xmax=m(a,c.xmax);b.ymax=l(a,c.ymax);b!==
c&&(d&&(b.zmin=c.zmin,b.zmax=c.zmax),e&&(b.mmin=c.mmin,b.mmax=c.mmax));return b};f.hydrateMultipoint=function(a,b,c,d,e){b.points=q(a,c.points,d,e);return b};f.hydratePoint=function(a,b,c,d,e){b.x=m(a,c.x);b.y=l(a,c.y);b!==c&&(d&&(b.z=c.z),e&&(b.m=c.m));return b};f.hydratePolygon=function(a,b,c,d,e){b.rings=u(a,c.rings,d,e);return b};f.hydratePolyline=function(a,b,c,d,e){b.paths=t(a,c.paths,d,e);return b}})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["require","exports",
"../../core/compilerUtils"],function(p,f,k){function a(a,b){if(a===b)return!0;if(null==a||null==b||a.length!==b.length)return!1;for(var c=0;c<a.length;c++){var d=a[c],e=b[c];if(d.length!==e.length)return!1;for(var g=0;g<d.length;g++)if(d[g]!==e[g])return!1}return!0}function g(b,c){if(b===c)return!0;if(null==b||null==c||b.length!==c.length)return!1;for(var d=0;d<b.length;d++)if(!a(b[d],c[d]))return!1;return!0}function b(a,b){return a===b||a&&b&&a.equals(b)}function e(c,e){if(c===e)return!0;if(!c||
!e||c.type!==e.type)return!1;switch(c.type){case "point":return c=b(c.spatialReference,e.spatialReference)?c.x===e.x&&c.y===e.y&&c.z===e.z&&c.m===e.m:!1,c;case "extent":return c=c.hasZ!==e.hasZ||c.hasM!==e.hasM?!1:b(c.spatialReference,e.spatialReference)?c.xmin===e.xmin&&c.ymin===e.ymin&&c.zmin===e.zmin&&c.xmax===e.xmax&&c.ymax===e.ymax&&c.zmax===e.zmax:!1,c;case "polyline":return c=c.hasZ!==e.hasZ||c.hasM!==e.hasM?!1:b(c.spatialReference,e.spatialReference)?g(c.paths,e.paths):!1,c;case "polygon":return c=
c.hasZ!==e.hasZ||c.hasM!==e.hasM?!1:b(c.spatialReference,e.spatialReference)?g(c.rings,e.rings):!1,c;case "multipoint":return c=c.hasZ!==e.hasZ||c.hasM!==e.hasM?!1:b(c.spatialReference,e.spatialReference)?a(c.points,e.points):!1,c;case "mesh":return!1;default:k.neverReached(c)}}function c(a,b){if(a===b)return!0;if(!a||!b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var e=c[d];if(a[e]!==b[e])return!1}return!0}Object.defineProperty(f,"__esModule",
{value:!0});f.equals=function(a,b){return a===b?!0:null!=a&&null!=b&&a.objectId===b.objectId&&e(a.geometry,b.geometry)&&c(a.attributes,b.attributes)?!0:!1}})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../geometry ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../geometry/support/webMercatorUtils ../../../../layers/graphics/dehydratedFeatures ./Graphics3DSymbol ./Graphics3DWebStyleSymbol ../../support/mathUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n){function q(a){var b=a.paths[0];if(!b||0===b.length)return null;b=c.getPointOnPath(b,c.getPathLength(b)/2);return m.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference)}function t(a,b,c){if(!b||!a)return a;var e=a.spatialReference;e.isWebMercator&&b.isWGS84?(d.xyToLngLat(a.x,a.y,y),c||(a=m.clonePoint(a)),a.x=y[0],a.y=y[1],a.spatialReference=k.SpatialReference.WGS84):b.isWebMercator&&e.isWGS84&&(d.lngLatToXY(a.x,a.y,y),c||(a=m.clonePoint(a)),a.x=y[0],a.y=y[1],a.spatialReference=
k.SpatialReference.WebMercator);return a}function u(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)if(!u(a[b]))return!1;return!0}return null==a||0<=a}Object.defineProperty(f,"__esModule",{value:!0});var r=a.vec3f64.fromValues(1,1,1);f.computeCentroid=function(a,b){if("point"===a.type)return t(a,b,!1);if(m.isHydratedGeometry(a))switch(a.type){case "extent":return t(a.center,b,!1);case "polygon":return t(a.centroid,b,!1);case "polyline":return t(q(a),b,!0);case "mesh":return t(a.extent.center,b,
!1)}else switch(a.type){case "extent":var c=n.isFinite(a.zmin);a=m.makeDehydratedPoint(.5*(a.xmax+a.xmin),.5*(a.ymax+a.ymin),c?.5*(a.zmax+a.zmin):void 0,a.spatialReference);return t(a,b,!0);case "polygon":return(c=a.rings[0])&&0!==c.length?(c=e.ringsCentroid(a.rings,a.hasZ),a=m.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference)):a=null,t(a,b,!0);case "polyline":return t(q(a),b,!0)}};f.convertPointSR=t;f.enlargeExtent=function(c,d,e){if(c){d||(d=b.create());var h=.5*c.width*(e-1);e=.5*c.height*
(e-1);c.width<1E-7*c.height?h+=e/20:c.height<1E-7*c.width&&(e+=h/20);a.vec4.set(d,c.xmin-h,c.ymin-e,c.xmax+h,c.ymax+e);return d}return null};f.updateVertexAttributeAuxpos1w=function(a,b){for(var c=0;c<a.geometries.length;++c){var d=a.geometries[c].data.vertexAttributes.auxpos1;d&&d.data[3]!==b&&(d.data[3]=b,a.geometryVertexAttrsUpdated(c))}};f.mixinColorAndOpacity=function(a,b){var c=[1,1,1,1];null!=a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2]);null!==b&&void 0!==b?c[3]=b:null!=a&&3<a.length&&(c[3]=a[3]);return c};
f.overrideColor=function(a,b,c,d,e,h){void 0===h&&(h=[0,0,0,0]);for(var g=0;3>g;++g)h[g]=a&&null!=a[g]?a[g]:c&&null!=c[g]?c[g]:e[g];h[3]=null!=b?b:null!=d?d:e[3];return h};f.computeObjectScale=function(b,c,d,e){void 0===b&&(b=r);void 0===e&&(e=1);var h=Array(3);if(null==c||null==d)h[0]=1,h[1]=1,h[2]=1;else{for(var g=void 0,l=0,m=2;0<=m;m--){var n=b[m],k=void 0,f=null!=n,q=0===m&&!g&&!f,u=d[m];"symbolValue"===n||q?k=0!==u?c[m]/u:1:f&&"proportional"!==n&&isFinite(n)&&(k=0!==u?n/u:1);null!=k&&(g=h[m]=
k,l=Math.max(l,Math.abs(k)))}for(m=2;0<=m;m--)null==h[m]?h[m]=g:0===h[m]&&(h[m]=.001*l)}for(m=2;0<=m;m--)h[m]/=e;return a.vec3f64.fromArray(h)};f.computeSizeWithResourceSize=function(b,c){var d=c.width,e=c.depth,h=c.height;c=c.isPrimitive?10:1;if(null==d&&null==h&&null==e)return[c*b[0],c*b[1],c*b[2]];for(var d=a.vec3f64.fromValues(d,e,h),g,e=0;3>e;e++)if(h=d[e],null!=h){g=h/b[e];break}for(e=0;3>e;e++)null==d[e]&&(d[e]=b[e]*g);return d};f.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=
[a.width,a.depth,a.height]);return u(a)?null:"Symbol sizes may not be negative values"};f.computeObjectRotation=function(b,c,d,e){void 0===e&&(e=a.mat4f64.create());b=b||0;c=c||0;d=d||0;0!==b&&a.mat4.rotateZ(e,e,-b/180*Math.PI);0!==c&&a.mat4.rotateX(e,e,c/180*Math.PI);0!==d&&a.mat4.rotateY(e,e,d/180*Math.PI);return e};f.demResolutionForBoundingBox=function(a,b){return null!=b.minDemResolution?b.minDemResolution:g.isPoint(a)?b.minDemResolutionForPoints:.01*g.maximumDimension(a)};f.getGraphics3DSymbol=
function(a){return a instanceof h?a.graphics3DSymbol:a instanceof l?a:null};var y=[0,0]})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./symbolComplexity ../../support/PromiseLightweight".split(" "),function(p,f,k,a,g,b,e,c){return function(c){function d(a,d,e){var h=c.call(this)||this;h.symbol=a;h.referenced=0;a=a.symbolLayers;e&&(a=
e.concat(a));e=a.length;h.childGraphics3DSymbols=Array(a.length);h.childGraphics3DSymbolPromises=Array(a.length);for(var g=d.layerOrder,l=0,m=0,n=function(a,b){b&&(h.childGraphics3DSymbols[a]=b,m++);l--;!h.isRejected()&&1>l&&(0<m?h.resolve():h.reject())},k=0;k<e;k++){var f=a.getItemAt(k);!1!==f.enabled&&(d.layerOrder=g+(1-(1+k)/e),d.layerOrderDelta=1/e,f=b.make(h.symbol,f,d,f._ignoreDrivers))&&(l++,h.childGraphics3DSymbolPromises[k]=f)}d.layerOrder=g;if(0===l)h.resolve();else{d=function(a){var b=
w.childGraphics3DSymbolPromises[a];b&&b.then(function(){return n(a,b)},function(){return n(a,null)})};for(var w=this,k=0;k<e;k++)d(k)}return h}k(d,c);d.prototype.createGraphics3DGraphic=function(b,c){for(var d=b.graphic,e=Array(this.childGraphics3DSymbols.length),h=0;h<this.childGraphics3DSymbols.length;h++){var g=this.childGraphics3DSymbols[h];g&&(e[h]=g.createGraphics3DGraphic(b))}return new a(d,c||this,e,b.layer)};Object.defineProperty(d.prototype,"complexity",{get:function(){return e.totalSymbolComplexities(this.childGraphics3DSymbols.map(function(a){return a&&
a.complexity}))},enumerable:!0,configurable:!0});d.prototype.layerPropertyChanged=function(a,b){for(var c=this.childGraphics3DSymbols.length,d=function(c){var d=e.childGraphics3DSymbols[c],h=function(a){a=a._graphics[c];return a instanceof g?a:null};if(d&&!d.layerPropertyChanged(a,b,h))return{value:!1}},e=this,h=0;h<c;h++){var l=d(h);if("object"===typeof l)return l.value}return!0};d.prototype.applyRendererDiff=function(a,b){return this.isResolved()?this.childGraphics3DSymbols.reduce(function(c,d,
e){return c&&(!d||d.applyRendererDiff(a,b))},!0):!1};d.prototype.getFastUpdateStatus=function(){var a=0,b=0,c=0;this.childGraphics3DSymbolPromises.forEach(function(d){d&&!d.isFulfilled()?a++:d&&d.isFastUpdatesEnabled()?c++:d&&b++});return{loading:a,slow:b,fast:c}};d.prototype.setDrawOrder=function(a,b){for(var c=this.childGraphics3DSymbols.length,d=1/c,e=0;e<c;e++){var h=this.childGraphics3DSymbols[e];h&&h.setDrawOrder(a+(1-(1+e)/c),d,b)}};d.prototype.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");
else{this.isFulfilled()||this.reject();for(var a=0;a<this.childGraphics3DSymbolPromises.length;a++)this.childGraphics3DSymbolPromises[a]&&this.childGraphics3DSymbolPromises[a].destroy();this.childGraphics3DSymbols=this.childGraphics3DSymbolPromises=null}};Object.defineProperty(d.prototype,"destroyed",{get:function(){return null==this.childGraphics3DSymbols},enumerable:!0,configurable:!0});return d}(c.Promise)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h){var n=new b(Array,function(a){return c.set(a,c.ZERO)},null,10,5),q=d.create();return function(){function b(a,b,c,d){this.addedToSpatialIndex=!1;this._labelGraphics=[];this._auxiliaryGraphics=[];for(var e=Array(2),h=0;h<e.length;h++)e[h]=Array(3);this._visibilityFlags=e;this.extent=this._featureExpressionFeature=null;++b.referenced;this.graphics3DSymbol=b;this.graphic=a;this._graphics=c;this._featureExpressionFeature=l.createFeature(a,d)}b.prototype.initialize=function(a,
b){var c=this;this._layer=a;this._stage=b;this.forEachSymbolLayerGraphic(function(d){d.initialize(a,b);d.setVisibility(c.isVisible())})};b.prototype.destroy=function(){this.forEachSymbolLayerGraphic(function(a){return a.destroy()});this._auxiliaryGraphics=this._graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null};Object.defineProperty(b.prototype,"destroyed",{get:function(){return null==this._graphics},enumerable:!0,configurable:!0});b.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});
this._labelGraphics.length=0};b.prototype.addLabelGraphic=function(a,b,c){this._labelGraphics.push(a);a.initialize(b,c);a.setVisibility(this.isVisible(1))};b.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._layer,this._stage),a.setVisibility(this.isVisible()))};b.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(b){"draped"===b.type&&(a=!0)});return a};b.prototype.areVisibilityFlagsSet=function(a,b,c){void 0===
c&&(c=0);c=this._visibilityFlags[c];if(null!=a)return c[a];a=!0;for(var d=0;d<c.length;d++)if(d!==b){var e=c[d];a=a&&(null==e||!0===e)}return a};b.prototype.isVisible=function(a){void 0===a&&(a=0);for(var b=0;b<=a;b++)for(var c=this._visibilityFlags[b],d=0;d<c.length;d++){var e=c[d];if(null!==e&&!1===e)return!1}return!0};b.prototype.setVisibilityFlag=function(a,b,c){void 0===c&&(c=0);var d=this.isVisible(c);this._visibilityFlags[c][a]=b;var e=this.isVisible(c);if(d===e)return!1;if(1===c)this.forEachLabelGraphic(function(a){return a.setVisibility(e)});
else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(e)});var h=this.isVisible(1);this.forEachLabelGraphic(function(a){return a.setVisibility(h)})}return!0};b.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});return a};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=e.vec3f64.create());return this._graphics[0].getCenterObjectSpace(a)};b.prototype.computeExtent=function(a){if(!this.extent){this.extent=d.create();
var b=this.graphic.geometry,c=b.spatialReference;m.computeAABR(b,this.extent);if(!c.equals(a)&&!h.boundingRectToBoundingRect(this.extent,c,this.extent,a))return this.extent=null,!1}return!0};Object.defineProperty(b.prototype,"usedMemory",{get:function(){var a=this,b=0;this.forEachSymbolLayerGraphic(function(c){var d=c.graphics3DSymbolLayer.complexity;c="draped"===c.type?d.memory.draped:d.memory;b+=c.bytesPerFeature;c.bytesPerCoordinate&&(b+=m.numVertices(a.graphic.geometry)*c.bytesPerCoordinate)});
return b},enumerable:!0,configurable:!0});b.prototype.getProjectedBoundingBox=function(b,e,h,l){return a(this,void 0,void 0,function(){var m=this;return k(this,function(f){switch(f.label){case 0:return l||(l={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),l.boundingBox?c.empty(l.boundingBox):l.boundingBox=c.empty(),l.requiresDrapedElevation=!1,[4,g.forEach(this._graphics,function(d){return a(m,void 0,void 0,function(){var a,g,m;return k(this,function(k){switch(k.label){case 0:if(!d)return[2];
a="draped"===d.type?e:b;g=n.acquire();return[4,d.getProjectedBoundingBox(a,h,l.screenSpaceObjects,g)];case 1:return m=k.sent(),isFinite(m[2])&&isFinite(m[5])||(l.requiresDrapedElevation=!0),m&&c.expand(l.boundingBox,g),n.release(g),[2]}})})})];case 1:return f.sent(),c.allFinite(l.boundingBox)||d.allFinite(c.toRect(l.boundingBox,q))?[2,l]:[2,null]}})})};b.prototype.needsElevationUpdates=function(){for(var a=0,b=this._graphics;a<b.length;a++){var c=b[a];if(c&&("object3d"===c.type||"lod-instance"===
c.type)&&c.needsElevationUpdates)return!0}a=0;for(b=this._labelGraphics;a<b.length;a++)if((c=b[a])&&c.needsElevationUpdates)return!0;return!1};b.prototype.alignWithElevation=function(a,b){var c=this;this.forEachRenderedGraphic(function(d){"object3d"!==d.type&&"lod-instance"!==d.type||d.alignWithElevation(a,b,c._featureExpressionFeature)})};b.prototype.addHighlight=function(a,b){this.forEachSymbolLayerGraphic(function(c){return c.addHighlight(a,b)})};b.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeHighlight(a)})};
b.prototype.forEachGraphicList=function(a,b){a.forEach(function(a,c){return a&&b(a,c)})};b.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};b.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)};b.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return b}()})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require",
"exports","../../../../support/arcadeUtils"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.createContext=function(a,g,b){var e=null;a=a&&a.expression;"string"===typeof a&&(e="0"===a?0:null,null!=e?e={cachedResult:e}:(e=k.createSyntaxTree(a),k.dependsOnView(e)?(null!=b&&b.error("Expressions containing '$view' are not supported on ElevationInfo"),e={cachedResult:0}):e={arcade:{func:k.createFunction(e),context:k.createExecContext(null,{sr:g})}}));return e};f.createFeature=function(a,
g){return k.createFeature(a.attributes,a.geometry,g)};f.setContextFeature=function(a,g){null!=a&&null==a.cachedResult&&k.updateExecContext(a.arcade.context,g)};f.execute=function(a){if(null!=a){if(null!=a.cachedResult)return a.cachedResult;var g=a.arcade,g=k.executeFunction(g.func,g.context);"number"!==typeof g&&(g=a.cachedResult=0);return g}return 0};f.extractExpressionInfo=function(a,g){void 0===g&&(g=!1);var b=(a=a&&a.featureExpressionInfo)&&a.expression;g||"0"===b||(a=null);return a};f.zeroContext=
{cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../webgl-engine/Stage".split(" "),function(p,f,k,a,g,b,e,c,d,m,l){p=function(){function k(a,
b,c,e,h,g,l,m){this.type="object3d";this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.uniqueMaterials=e;this.uniqueGeometries=c;this.uniqueTextures=h;this.stageObject=b;this.elevationAligner=g;this.elevationContext=new d(l);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=null!=m?m:k.VisibilityModes.HIDE_FACERANGE}k.prototype.initialize=function(a,b){this.stageLayer=a;this.stage=b;if(this.uniqueMaterials)for(a=
0;a<this.uniqueMaterials.length;a++)b.add(l.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)b.add(l.ModelContentType.GEOMETRY,this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.add(l.ModelContentType.TEXTURE,this.uniqueTextures[a]);b.add(l.ModelContentType.OBJECT,this.stageObject)};k.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this._addedToStage?
this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===k.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),a=this.stage.view.getEdgeView(),a.hasObject(this.stageObject)&&a.updateObjectVisibility(this.stageObject,this._visible),!0):!1};Object.defineProperty(k.prototype,"visible",{get:function(){return this._visible},enumerable:!0,configurable:!0});
k.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var b=0;b<this.uniqueMaterials.length;b++)a.remove(l.ModelContentType.MATERIAL,this.uniqueMaterials[b].id);if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.remove(l.ModelContentType.GEOMETRY,this.uniqueGeometries[b].id);if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(l.ModelContentType.TEXTURE,this.uniqueTextures[b].id)}a.remove(l.ModelContentType.OBJECT,this.stageObject.id);
this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);a=this.stage.view.getEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this._visible=!1;this.stage=this.stageLayer=null};k.prototype.alignWithElevation=function(a,b,d){this.elevationAligner&&(c.setContextFeature(this.elevationContext.featureExpressionInfoContext,d),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a))};k.prototype.getBSRadius=
function(){return this.stageObject.getBSRadius()};k.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=b.vec3f64.create());return b.vec3.copy(a,this.stageObject.getCenter(!0))};k.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=e.create());var b=this.stageObject;a||(a=e.create());e.setMin(a,b.getBBMin(!0));e.setMax(a,b.getBBMax(!0));return a};k.prototype.getProjectedBoundingBox=function(c,d,l,k){return g(this,void 0,void 0,function(){var g,f,r,u,z,y,x,p,N,S;return a(this,function(a){switch(a.label){case 0:g=
this.getBoundingBoxObjectSpace(k);f=t;r=e.isPoint(g)?1:f.length;for(u=0;u<r;u++)z=f[u],n[0]=g[z[0]],n[1]=g[z[1]],n[2]=g[z[2]],b.vec3.transformMat4(n,n,this.stageObject.objectTransformation),h[3*u+0]=n[0],h[3*u+1]=n[1],h[3*u+2]=n[2];if(!c(h,0,r))return[2,null];e.empty(g);y=null;this.calculateRelativeScreenBounds&&(y=this.calculateRelativeScreenBounds());for(u=0;u<3*r;u+=3){for(x=0;3>x;x++)g[x]=Math.min(g[x],h[u+x]),g[x+3]=Math.max(g[x+3],h[u+x]);y&&l.push({location:h.slice(u,u+3),screenSpaceBoundingRect:y})}if(!d||
!d.service||"absolute-height"===this.elevationContext.mode)return[3,5];e.center(g,q);p="relative-to-scene"===this.elevationContext.mode?"scene":"ground";N=void 0;if(!d.useViewElevation)return[3,1];N=d.service.getElevation(q[0],q[1],p);return[3,4];case 1:return a.trys.push([1,3,,4]),S=m.demResolutionForBoundingBox(g,d),[4,d.service.queryElevation(q[0],q[1],S,p)];case 2:return N=a.sent(),[3,4];case 3:return a.sent(),N=null,[3,4];case 4:e.offset(g,0,0,-this.alignedTerrainElevation+N),a.label=5;case 5:return[2,
g]}})})};k.prototype.addHighlight=function(a,b){b=this.stageObject.highlightAllComponents(b);a.addObject(this.stageObject,b)};k.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};return k}();(function(a){a=a.VisibilityModes||(a.VisibilityModes={});a[a.REMOVE_OBJECT=0]="REMOVE_OBJECT";a[a.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(p||(p={}));var h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=b.vec3f64.create(),q=b.vec3f64.create(),t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,
1,5],[0,4,5],[3,4,5]];return p})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(p,f,k,a){return function(a){function b(b){b=a.call(this,b)||this;b.centerPointInElevationSR=null;return b}k(b,a);return b}(a)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],
function(p,f,k,a){return function(){function g(a){a?this.set(a):this.setDefaults()}Object.defineProperty(g.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0});g.prototype.setUnit=function(a){this._unit=a;this._metersPerElevationInfoUnit=k.getMetersPerUnit(a)};g.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=
0;this.featureExpressionInfoContext=null;this.hasOffsetAdjustment=!1;this.setUnit("meters")};g.prototype.set=function(a){this.mode=a.mode;this._meterUnitOffset=a._meterUnitOffset||0;this._renderUnitOffset=a._renderUnitOffset||0;this.featureExpressionInfoContext=a.featureExpressionInfoContext;this.hasOffsetAdjustment=a.hasOffsetAdjustment;this.setUnit(a.unit)};g.prototype.setOffsetMeters=function(a){this._meterUnitOffset=a;this._renderUnitOffset=0};g.prototype.setOffsetElevationInfoUnits=function(a){this._meterUnitOffset=
a*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};g.prototype.setOffsetRenderUnits=function(a){this._meterUnitOffset=0;this._renderUnitOffset=a};g.prototype.addOffsetRenderUnits=function(a){this._renderUnitOffset+=a};g.prototype.mixinApi=function(a){null!=a.mode&&(this.mode=a.mode);null!=a.unit&&this.setUnit(a.unit);null!=a.offset&&this.setOffsetElevationInfoUnits(a.offset)};g.prototype.calculateOffsetRenderUnits=function(b){var e=this._meterUnitOffset,c=this.featureExpressionInfoContext;
null!=c&&(e+=a.execute(c)*this._metersPerElevationInfoUnit);return e/b.unitInMeters+this._renderUnitOffset};return g}()})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ./lib/ModelContentType ./lighting/Lightsources ./parts/Model ./parts/View".split(" "),function(p,f,k,a,g,b,e){return function(){function c(a,c,l,h){this.sceneIntersectionHelper=h;this._viewContent=[];this.container=c;this.viewingMode=a;this.model=new b;this.view=new e(c,
this,this.model.getDirtySet(),l);this.view.setLighting({lights:[new g.MainLight(k.vec3f64.fromValues(.7,.7,.7)),new g.AmbientLight(k.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}c.prototype.setNeedsRender=function(){this.view.setNeedsRender()};c.prototype.dispose=function(){this.view.dispose();this.model=this.view=null};c.prototype.add=function(a,b){this.model.add(a,b);"function"===typeof b.addParentStage&&b.addParentStage(this)};c.prototype.remove=function(a,b){a=this.model.remove(a,
b);"function"===typeof a.removeParentStage&&a.removeParentStage(this);return a};c.prototype.notifyDirty=function(a,b,c,e){this.model.notifyDirty(a,b,c,e)};c.prototype.processDirty=function(){var a=this.model.getDirtySet(),b=a.getDirtyMaterials();if(a.hasDirtyGeometryRecords()||b){c.DebugSettings.endFrameContentValidation&&this.model.validateContent();c.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var e=a.commitLayers(this._viewContent);(0<e[0].length+
e[1].length+e[2].length||b)&&this.view.modify(e[0],e[1],e[2],b);c.DebugSettings.logDirtySet&&(console.log("RGs add: "+e[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+e[1].map(function(a){return a.uniqueName})));a.commit();a.clearDirtyMaterials();this.view.setNeedsRender()}};c.prototype.processDirtyLayer=function(a){var b=this.model.getDirtySet(),c=b.getDirtyMaterials();a=b.commitLayers([a]);(0<a[0].length+a[1].length+a[2].length||c)&&this.view.modify(a[0],a[1],a[2],c);b.clearDirtyMaterials();
this.view.setNeedsRender()};c.prototype.get=function(a,b){return this.model.get(a,b)};c.prototype.getAll=function(a){return this.model.getAll(a)};c.prototype.getCamera=function(){return this.view.getCamera()};c.prototype.setCamera=function(a){this.view.setCamera(a)};c.prototype.getViewParams=function(a){return this.view.getViewParams(a)};c.prototype.setViewParams=function(a){this.view.setViewParams(a)};c.prototype.getLayers=function(){return this.model.getAll(a.LAYER)};c.prototype.setLighting=function(a){this.view.setLighting(a)};
c.prototype.getCanvas=function(){return this.view.getCanvas()};c.prototype.setRenderParams=function(a){this.view.setRenderParams(a)};c.prototype.getRenderParams=function(){return this.view.getRenderParams()};c.prototype.getIdleSuspend=function(){return this.view.getIdleSuspend()};c.prototype.has=function(a){return this.view.has(a)};c.prototype.getViewContent=function(){return this._viewContent.slice(0)};c.prototype.addToViewContent=function(a){for(var b=[],c=0;c<a.length;c++)-1===this._viewContent.indexOf(a[c])&&
b.push(a[c]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.view.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,b))};c.prototype.removeFromViewContent=function(a){this.processDirty();for(var b=this.model.getDirtySet(),c=this._viewContent,d=[],e=0;e<a.length;e++){var g=c.indexOf(a[e]);-1<g&&(c[g]=c[c.length-1],c.pop(),d.push(a[e]))}a=b.getResidentRenderGeometriesFilteredByLayers(d);this.view.modify([],a,[])};c.prototype.getFrameTask=
function(){return this.view.getFrameTask()};c.prototype.takeScreenshot=function(a){return this.view.takeScreenshot(a)};c.prototype.addRenderPlugin=function(a,b){"intersect"in b&&this.sceneIntersectionHelper.addIntersectionHandler(b);return this.view.renderPlugins.add(a,b)};c.prototype.removeRenderPlugin=function(a){"intersect"in a&&this.sceneIntersectionHelper.removeIntersectionHandler(a);return this.view.renderPlugins.remove(a)};c.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)};
c.prototype.getRenderStats=function(){return this.view.getCombinedStats()};c.prototype.getRenderStatString=function(a){var b=this.getRenderStats(),c="";if(a){var c=c+"\x3ctable\x3e",d;for(d in b)c+="\x3ctr\x3e\x3ctd\x3e"+d+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Math.round(b[d])+"\x3c/td\x3e\x3c/tr\x3e";c+="\x3c/table\x3e"}else for(d in b)c+=d+": "+b[d]+"\n";return c};c.prototype.getFramebufferTexture=function(a){void 0===a&&(a="color");return this.view.getFramebufferTexture(a)};c.prototype.getDrapedTextureRenderer=
function(){return this.view.getDrapedTextureRenderer()};c.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};c.ModelContentType=a;return c}()})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../../support/mathUtils ../lib/localOrigin ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(p,f,k,a,g,b,e,c,d){var m=d.assert,l=d.logWithBase;return function(){function d(){this.dirtySet=new e(this);this._uniqueIdx=
0;this._id2origin={};this.content={};for(var a in b)this.content[b[a]]={}}d.prototype.getAll=function(a){a=this.content[a];m(void 0!==a);return a};d.prototype.get=function(a,b){return this.getAll(a)[b]};d.prototype.add=function(a,c){var d=this.content[a];m(void 0!==d);var e=c.id;m(null==d[e],"Model/Stage already contains object to be added");d[e]=c;a===b.LAYER&&this.notifyDirty(a,c,"layerAdded")};d.prototype.remove=function(a,c){var d=this.content[a];m(void 0!==d);var e=d[c];m(void 0!==e,"Model/Stage doesn't contain object to be removed");
delete d[c];a===b.TEXTURE&&e.unload();a===b.LAYER&&this.notifyDirty(a,e,"layerRemoved");return e};d.prototype.getDirtySet=function(){return this.dirtySet};d.prototype.notifyDirty=function(a,b,c,d){this.dirtySet.handleUpdate(b,c,d)};d.prototype.getOrigin=function(a,b,c){void 0===c&&(c=10);var d=0;b=b*c/1E4;1<b&&(d=Math.ceil(l(b,2)));b=1E4*Math.pow(2,d);c=Math.round(a[0]/b);var e=Math.round(a[1]/b);a=Math.round(a[2]/b);var d=d+"_"+c+"_"+e+"_"+a,h=this._id2origin[d];null==h&&(h=g.fromValues(c*b,e*b,
a*b,d),this._id2origin[d]=h);return h};d.prototype.getGeometryRenderGeometries=function(b,d,e){var h=b.id,g=d.geometry,l=b.getCombinedStaticTransformation(d),m=a.maxScale(l),k=d.origin,n=d.id,f=this._uniqueIdx++;b=new c(g.data,g.boundingInfo,d.material,l,d.shaderTransformation,m,b.getCastShadow(),!!g.singleUse,h,n,f);b.origin=k||this.getOrigin(b.center,b.bsRadius);b.instanceParameters=d.instanceParameters;e.push(b)};d.prototype.updateRenderGeometryTransformation=function(a,b,c){a.getCombinedStaticTransformation(b,
c.transformation);c.updateTransformation(c.transformation)};d.prototype.formatDebugInfo=function(a){var c=[];if(a){c[0]="\x3ctable\x3e";for(var d in b)a=b[d],c[0]+="\x3ctr\x3e\x3ctd\x3e"+a+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Object.keys(this.getAll(a)).length+"\x3c/td\x3e\x3c/tr\x3e";c[0]+="\x3c/table\x3e";c[1]=this.dirtySet.formatDebugInfo(!0)}else{c[0]="";for(d in b)a=b[d],c[0]+=k.pad(String(Object.keys(this.getAll(a)).length),6," ")+" "+a+", ";c[1]=this.dirtySet.formatDebugInfo(!1)}return c};
d.prototype.validateContent=function(){var a=this.getAll(b.OBJECT),c;for(c in a)this.validateObject(a[c]);var a=this.getAll(b.LAYER),d;for(d in a)this.validateLayer(a[d]);d=this.getAll(b.MATERIAL);for(var e in d)this.validateMaterial(d[e])};d.prototype.validateObject=function(a){a=a.geometryRecords;for(var c=0;c<a.length;++c){var d=a[c];m(null!=this.get(b.GEOMETRY,d.geometry.id));m(null!=this.get(b.MATERIAL,d.material.id))}};d.prototype.validateLayer=function(a){a=a.getObjects();for(var c=0;c<a.length;++c){var d=
this.get(b.OBJECT,a[c].id);m(null!=d)}};d.prototype.validateMaterial=function(a){a=a.getAllTextureIds();for(var c=0;c<a.length;++c){var d=this.get(b.TEXTURE,a[c]);m(null!=d)}};d.ContentType=b;return d}()})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.fromVector=function(a,g){return{vec3:k.vec3f64.clone(a),id:g}};f.fromValues=function(a,g,b,e){return{vec3:k.vec3f64.fromValues(a,
g,b),id:e}}})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("require exports ../../../../core/arrayUtils ../../../../core/iteratorUtils ./ModelContentType ./Util".split(" "),function(p,f,k,a,g,b){return function(){function e(a){this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this._dirtyMaterials=new Set;this._model=a}Object.defineProperty(e.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"residentObjectCount",{get:function(){var a=0;this._residentGeomRecords.forEach(function(b){a+=b.size});return a},enumerable:!0,configurable:!0});e.prototype.getDirtyMaterials=function(){return 0<this._dirtyMaterials.size?this._dirtyMaterials:null};e.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()};e.prototype.hasDirtyGeometryRecords=function(){var b=!1;a.everyMap(this._dirtyGeomRecords,function(c){if(b)return!1;a.everyMap(c,function(a){if(!b&&a&&0<a.size)return b=!0,!1})});
return b};e.prototype.handleUpdate=function(a,d,e){b.assert(this[d],"ModelDirtySet doesn't know how to process "+d);return this[d](a,e)};e.prototype.shaderTransformationChanged=function(a){var b=this;(a=this._residentGeomRecords.get(a.id))&&a.forEach(function(a,c){(c=b._model.content[g.OBJECT][c])&&c.hasVolativeTransformation()&&a.forEach(function(a){var b=0;for(a=a[1];b<a.length;b++)a[b].shaderTransformationChanged()})})};e.prototype.commit=function(){return this.commitLayers(k.keysOfMap(this._dirtyGeomRecords))};
e.prototype.commitLayers=function(a){for(var c=this,e=[],l=[],h=[],k=function(d){var m=a[d];d=f._dirtyGeomRecords.get(m);if(!d)return"continue";d.forEach(function(a,d){var k=c._ensureGeomRecord(m,d);a.forEach(function(a,m){var n=a[0],f=a[1];a=a[2];var q=f&2&&a&1;if(f&4||q){var r=k.get(m);r?l.push.apply(l,r[1]):4===f&&b.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");r&&k.delete(m)}if(f&1||q){var u=[n,[]],r=c._model.get(g.OBJECT,d);c._model.getGeometryRenderGeometries(r,
n,u[1]);e.push.apply(e,u[1]);k.set(m,u)}if(f&2&&!q)if(r=k.get(m)){m=r[1];f=m.length;if(a&16)for(r=c._model.get(g.OBJECT,d),q=0;q<f;q++)u=m[q],c._model.updateRenderGeometryTransformation(r,n,u);for(q=0;q<f;q++)u=m[q],h.push({renderGeometry:u,updateType:a})}else b.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")});0===k.size&&c._residentGeomRecords.get(m).delete(d)});0===f._residentGeomRecords.get(m).size&&f._residentGeomRecords.delete(m);f._dirtyGeomRecords.delete(m)},f=
this,t=0;t<a.length;t++)k(t);return[e,l,h]};e.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(k.keysOfMap(this._residentGeomRecords))};e.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var b=[],c=0;c<a.length;c++){var e=this._residentGeomRecords.get(a[c]);e&&e.forEach(function(a){a.forEach(function(a){b.push.apply(b,a[1])})})}return b};e.prototype.visibilityChanged=function(a,b,e){if(null!=b)this._componentPropertyChanged(a,
b,e,2);else{b=0;for(var c=a.getGeometryRecords();b<c.length;b++)this._componentPropertyChanged(a,c[b],e,2)}};e.prototype.componentHighlightChanged=function(a,b,e){if(null!=b)this._componentPropertyChanged(a,b,e,32);else{b=0;for(var c=a.getGeometryRecords();b<c.length;b++)this._componentPropertyChanged(a,c[b],e,32)}};e.prototype.vertexAttrsUpdated=function(a,b,e){this._updateOrCreateDirtyRecord(a,b,e,2,0,0,2,5,4)};e.prototype.matChanged=function(a){this._dirtyMaterials.add(a.id);if(this.onMaterialChanged)this.onMaterialChanged(a)};
e.prototype.layerAdded=function(a){for(var b=a.getObjects(),c=0;c<b.length;c++)this.layObjectAdded(a,b[c])};e.prototype.layerRemoved=function(a){for(var b=a.getObjects(),c=0;c<b.length;c++)this.layObjectRemoved(a,b[c])};e.prototype.layObjectAdded=function(a,b){a=a.id;for(var c=b.getGeometryRecords(),d=0;d<c.length;d++)this.objGeometryAdded(b,c[d],a)};e.prototype.layObjectRemoved=function(a,b){a=a.id;for(var c=b.getGeometryRecords(),d=0;d<c.length;d++)this.objGeometryRemoved(b,c[d],a)};e.prototype.layObjectReplaced=
function(a,b){this.layObjectRemoved(a,b[0]);this.layObjectAdded(a,b[1])};e.prototype.objDirty=function(a,b){var c=this;b=b||this._getParentLayerId(a);this._ensureGeomRecord(b,a.id).forEach(function(d){c._updateOrCreateDirtyRecord(a,d[0],b,2,0,2,0,5,1)})};e.prototype.objTransformation=function(a,b){var c=this;b=b||this._getParentLayerId(a);this._ensureGeomRecord(b,a.id).forEach(function(d){c._updateOrCreateDirtyRecord(a,d[0],b,2,0,0,2,5,16)})};e.prototype.objGeometryAdded=function(a,b,e){this._updateOrCreateDirtyRecord(a,
b,e,1,4,0,0,0)};e.prototype.objGeometryRemoved=function(a,b,e){this._updateOrCreateDirtyRecord(a,b,e,4,1,2,0,0)};e.prototype.objGeometryReplaced=function(a,b){this.objGeometryRemoved(a,b[0]);this.objGeometryAdded(a,b[1])};e.prototype.objGeometryTransformation=function(a,b){this.objGeometryReplaced(a,b)};e.prototype._componentPropertyChanged=function(a,b,e,g){this._updateOrCreateDirtyRecord(a,b,e,2,0,0,2,5,g)};e.prototype._updateOrCreateDirtyRecord=function(a,d,e,g,h,k,f,t,u){e=e||this._getParentLayerId(a);
var c=d.id;a=this._ensureDirtyRecord(e,a.id);(e=a.get(c))?(d=e[1],d&h?a.delete(c):d&k?(e[1]=g,e[2]=u):d&f?e[2]|=u:d&t||b.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):a.set(c,[d,g,u])};e.prototype._ensureGeomRecord=function(a,b){var c=this._residentGeomRecords.get(a);c||(c=new Map,this._residentGeomRecords.set(a,c));a=c.get(b);a||(a=new Map,c.set(b,a));return a};e.prototype._ensureDirtyRecord=function(a,b){var c=this._dirtyGeomRecords.get(a);c||(c=new Map,this._dirtyGeomRecords.set(a,
c));a=c.get(b);a||(a=new Map,c.set(b,a));return a};e.prototype._getParentLayerId=function(a){return a.parentLayer.id};e.prototype.formatDebugInfo=function(a){if(a)return"";var b=["ADD","UPD",void 0,"REM"],c="";this._dirtyGeomRecords.forEach(function(a,d){a.forEach(function(a,e){0<c.length&&(c+="\n");c+=d+"."+e;var h=[];a.forEach(function(a){var b=a[1];h[b]||(h[b]=[]);h[b].push(a[0].geometry.id)});for(a=0;a<h.length;a++)if(h[a])for(c+=" "+b[a-1]+": ",e=0;e<h[a].length;e++)c+=h[a][e]+", "})});return c};
return e}()})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../../support/mathUtils"],function(p,f,k,a){return function(){function g(a,e,c,d,g,l,h,n,f,t,u){this.shaderTransformationDirty=!0;this.data=a.toRenderData();this.componentOffsets=a.componentOffsets;this.boundingInfo=e;this.material=c;this.origin=null;this.center=k.vec3f64.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=
g;d&&this.updateTransformation(d,l);this.castShadow=h;this.singleUse=n;this.name=f;this.uniqueName=t;this.idx=u;this.canBeMerged=!0;this.instanceParameters={}}g.prototype.updateTransformation=function(a,e){this.transformation=a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,e,this.center)};g.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};g.prototype.getBoundingSphere=function(b,e,c){e=e||a.maxScale(b);k.vec3.transformMat4(c,this.boundingInfo.getCenter(),
b);return this.boundingInfo.getBSRadius()*e};Object.defineProperty(g.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});g.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=k.mat4f64.create()),k.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(this.transformation)),this.shaderTransformationDirty=
!1),this.shaderTransformation):this.transformation};return g}()})},"esri/views/3d/webgl-engine/parts/View":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../lib/DrapedRenderer ../lib/GLMaterialRep ../lib/GLTextureRep ../lib/ProgramRepository ../lib/tracer ../lighting/Lightsources ./Model ./Viewport ../../../support/screenshotUtils ../../../webgl/context-util ../../../webgl/FramebufferObject ../../../webgl/RenderingContext".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x){var z=g.getLogger("esri.views.3d.webgl-engine.parts.View");p=function(){function g(a,b,h,g){var k=this;this.options=g;this._backgroundColor=e.vec4f64.fromValues(1,1,1,1);this._lightDirection=e.vec3f64.fromValues(0,1,0);this._didRender=!1;this._idleSuspend=this._needsRender=!0;this._shouldRender=!1;this._supersampleScreenshots=!0;this._screenshotQueue=[];this._container=a;this._stage=b;this._initializeContext(g);this._programRepository=new l(this._rctx);
this._programRepository.globalOptions.viewingMode=g.viewingMode;this._textureRep=new m(b.getAll(q.ContentType.TEXTURE),this._programRepository,function(){return k._viewport.getCamera().viewport},this._rctx);this._materialRep=new d(this._textureRep,this._programRepository);this._viewport=new t(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx);this._initializeViewportCamera();this._drapedRenderer=new c(this._rctx,this._canvas,this._programRepository,this._materialRep,
this._textureRep,h);this._initializeFrameTask()}Object.defineProperty(g.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0});g.prototype._initializeFrameTask=function(){var a=this;this._frameTask={preRender:function(){h.begin();a._stage.processDirty();a.needsRender()?(a._shouldRender=!0,a._viewport.getCamera().setGLViewport(a._rctx),a._rctx.setClearColor.apply(a._rctx,a._backgroundColor),a._rctx.clear(16640)):a._shouldRender=!1},
render:function(){a._shouldRender&&(a._didRender=!0,w.lightDirection=a._lightDirection,w.disableSlice=!1,a._viewport.render(w))},postRender:function(){h.end()},update:function(){a.resetNeedsRender();a._performScreenshots()}}};g.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),b=this._viewport.getCamera();b.viewport[2]=a.width;b.viewport[3]=a.height;this._viewport.setCamera(b)};g.prototype._initializeContext=function(b){this._canvas=b.canvas;this._canvas||
(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var c=r.createContextOrErrorHTML(this._canvas,{alpha:b.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==b.stencil?!0:b.stencil},b.renderContext);this._gl=h.instrumentContext(c);this._rctx=new x(this._gl,{disabledExtensions:b.deactivatedWebGLExtensions||{}});!b.alpha&&this._rctx.contextAttributes.alpha&&z.error("WebGL context has alpha channel even though no alpha channel was requested");
!this._rctx.contextAttributes.alpha&&11<=a("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas);null!=b.supersampleScreenshots&&(this._supersampleScreenshots=b.supersampleScreenshots)};g.prototype.dispose=function(){this._viewport.dispose();this._viewport=null;this._drapedRenderer.dispose();this._drapedRenderer=null;this._programRepository.dispose();this._programRepository=null;this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);
this._frameTask=this._gl=this._canvas=this._container=null};g.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()};g.prototype.setNeedsRender=function(){this._didRender=!1;this._needsRender=!0};g.prototype.resetNeedsRender=function(){this._didRender&&(this._didRender=this._needsRender=!1);this._viewport.resetNeedsRender();this._textureRep.resetNeedsRender()};g.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()};
g.prototype.getFrameTask=function(){return this._frameTask};g.prototype.setLighting=function(a){e.vec3.set(this._lightDirection,0,0,0);for(var b=0,c=a.lights;b<c.length;b++){var d=c[b];if(d instanceof n.MainLight){e.vec3.negate(this._lightDirection,d.direction);break}}this._viewport.setLighting(a);this._needsRender=!0};g.prototype.getEdgeView=function(){return this._viewport.getEdgeView()};g.prototype.getMainLightDirection=function(){return this._lightDirection};g.prototype.getViewParams=function(a){var b=
{};if(!a||a.backgroundColor)b.backgroundColor=this._backgroundColor;return b};g.prototype.setViewParams=function(a){this._needsRender=!0;a.backgroundColor&&(this._backgroundColor=a.backgroundColor)};g.prototype.setRenderParams=function(a){this._needsRender=!0;void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._viewport.setRenderParams(a)};g.prototype.getRenderParams=function(){var a=this._viewport.getRenderParams();a.anisotropicFiltering=this._textureRep.getMaxAnisotropy();a.idleSuspend=
this._idleSuspend;return a};g.prototype.getIdleSuspend=function(){return this._idleSuspend};Object.defineProperty(g.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});g.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:!1};g.prototype.modify=function(a,b,c,d){this._viewport.modify(a,b,c,d)};g.prototype.setCamera=function(a){this._viewport.setCamera(a)};
g.prototype.getCamera=function(){return this._viewport.getCamera()};g.prototype.getCanvas=function(){return this._canvas};g.prototype.getDrapedTextureRenderer=function(){return this._drapedRenderer};g.prototype.takeScreenshot=function(a){var c=this,d=b.createResolver(function(){c._screenshotQueue=c._screenshotQueue.filter(function(a){return a.resolver!==d})});this._screenshotQueue.push({settings:a,resolver:d});this._needsRender=!0;return d.promise};g.prototype.getFramebufferTexture=function(a){return this._viewport.getFramebufferTexture(a)};
Object.defineProperty(g.prototype,"renderPlugins",{get:function(){return this._viewport.renderPlugins},enumerable:!0,configurable:!0});g.prototype._renderScreenshotOverlay=function(a,b,c){if(this.options.renderScreenshotOverlay){a.width=b.width;a.height=b.height;var d=a.getContext("2d");d.save();d.translate(0,b.height);d.scale(1,-1);c.region&&d.translate(-c.region.x,-c.region.y);d.scale(c.pixelRatio,c.pixelRatio);this.options.renderScreenshotOverlay(a,b);d.restore()}};g.prototype._readbackScreenshot=
function(a){var b=a.framebufferWidth,c=a.framebufferHeight,d=a.region,e=a.resample,h=this._ensureScreenshotEncodeCanvas();if(e){var g=u.createEmptyImageData(b,c,h);this._gl.readPixels(0,0,b,c,6408,5121,new Uint8Array(g.data.buffer));this._renderScreenshotOverlay(h,g,k({},a,{region:null}));a=u.createEmptyImageData(d.width,d.height,h);return u.resampleHermite(g,a,!0,e.region.x,c-(e.region.y+e.region.height),e.region.width,e.region.height)}g=u.createEmptyImageData(d.width,d.height,h);this._gl.readPixels(d.x,
c-(d.y+d.height),d.width,d.height,6408,5121,new Uint8Array(g.data.buffer));this._renderScreenshotOverlay(h,g,a);return g};g.prototype._renderScreenshot=function(a){var b=null,c=this._viewport.getCamera(),d=u.screenshotSuperSampleSettings(a,this._supersampleScreenshots),e=d.framebufferWidth,h=d.framebufferHeight,g=!1;if(e!==c.fullWidth||h!==c.fullHeight||a.disableSlice){var l=c.copy();l.fullWidth=e;l.fullHeight=h;b=c.fovX-l.fovX;g=c.fovY-l.fovY;0>b&&b<g?l.fovX=c.fovX:0>g&&g<b&&(l.fovY=c.fovY);this._drapedRenderer.forceUpdate&&
this._drapedRenderer.forceUpdate(l);g=!0;b=new y(this._rctx,{width:l.fullWidth,height:l.fullHeight,colorTarget:0,depthStencilTarget:3});this._rctx.bindFramebuffer(b);l.setGLViewport(this._rctx);this._rctx.setClearColor.apply(this._rctx,this._backgroundColor);this._rctx.clear(16640);this._viewport.render({lightDirection:this._lightDirection,fbo:b,camera:l,pixelRatio:d.pixelRatio,disableSlice:a.disableSlice})}a=this._readbackScreenshot(d);b&&b.dispose();this._rctx.bindFramebuffer(null);g&&this._drapedRenderer.forceUpdate&&
this._drapedRenderer.forceUpdate(c);return a};g.prototype._performScreenshots=function(){if(0!==this._screenshotQueue.length){for(var a=0,b=this._screenshotQueue;a<b.length;a++){var c=b[a],d=c.settings;if(this._gl){var e=this._ensureScreenshotEncodeCanvas(),h=this._renderScreenshot(d),d=u.encodeResult(h,d,e,{flipY:!0,premultipliedAlpha:!0});c.resolver(d)}else c.resolver.reject()}this._screenshotQueue=[]}};g.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=
document.createElement("canvas"));return this._screenshotEncodeCanvas};return g}();var w={lightDirection:e.vec3f64.create(),camera:null,fbo:null,pixelRatio:1,disableSlice:!1};return p})},"esri/views/3d/webgl-engine/lib/DrapedRenderer":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/debugFlags ./Camera ./ComponentUtils ./DefaultVertexBufferLayouts ./glUtil3D ./GridLocalOriginFactory ./HighlightUtils ./Renderer ./SliceHelper ../lighting/Lightsources ../materials/internal/TexOnlyGLMaterial ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r){p=function(){function g(a,b,c,e,g,m){var f=this;this._renderTargets={};this._clearColor=k.vec4f64.fromValues(0,0,0,0);this._uniqueIdx=0;this._localOrigins=new d;this._rctx=a;this._canvas=b;this._programRep=c;this._modelDirtySet=m;this._modelDirtySet.onMaterialChanged=function(a){return f.materialChanged(a)};this._renderer=new l(c,e,g,this._rctx,!0);this._sliceHelper=new h;this._renderer.onHasHighlightsChanged=function(a){if(f.onHasHighlightsChanged)f.onHasHighlightsChanged(a)};
this._renderer.setLighting({lights:[new n.AmbientLight(k.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0})}g.prototype.dispose=function(){for(var a in this._renderTargets)this._renderTargets[a].dispose();this._renderTargets=null;this._renderer.dispose();this._renderer=null};g.prototype.createRenderTarget=function(a){return this.createRenderTargetInternal(a,!0)};g.prototype.createHighlightRenderTarget=function(a){return this.createRenderTargetInternal(a,!1)};g.prototype.disposeRenderTarget=
function(a){var b=this._renderTargets[a];b&&b.dispose();delete this._renderTargets[a]};g.prototype.getRenderTargetTexture=function(a){return(a=this._renderTargets[a])?a.colorTexture:null};g.prototype.addRenderGeometries=function(a){var b=this;a.forEach(function(a){null==a.origin&&(a.origin=b._localOrigins.getOrigin(a.center));a.idx=b._uniqueIdx++});this._renderer.modify(a,[]);if(this.onContentChanged)this.onContentChanged()};g.prototype.removeRenderGeometries=function(a){this._renderer.modify([],
a);if(this.onContentChanged)this.onContentChanged()};g.prototype.updateRenderGeometries=function(a,b){a=a.map(function(a){return{renderGeometry:a,updateType:b}});this._renderer.modify([],[],a);if(this.onContentChanged)this.onContentChanged()};g.prototype.updateRenderOrder=function(a){if(0<a.size&&(this._renderer.modifyRenderOrder(a),this.onContentChanged))this.onContentChanged()};g.prototype.setBackgroundColor=function(a){this._clearColor=a;if(this.onContentChanged)this.onContentChanged()};g.prototype.addRenderGeometryHighlight=
function(a,c){var d=a.instanceParameters,e=m.generateHighlightId();d.componentHighlights=b.addHighlight(d.componentHighlights,null,c,e);this.updateRenderGeometries([a],32);return e};g.prototype.removeRenderGeometryHighlight=function(a,c){var d=a.instanceParameters;d.componentHighlights=b.removeHighlight(d.componentHighlights,c);this.updateRenderGeometries([a],32)};g.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!a.OVERLAY_DRAW_TEST_TEXTURE};g.prototype.processDirtyMaterials=function(){var a=
this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify([],[],[],a);this._modelDirtySet.clearDirtyMaterials()};Object.defineProperty(g.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});g.prototype.draw=function(a,b){return this.drawPass(0,a,b)};g.prototype.drawHighlights=function(a,b){return this.drawPass(4,a,b)};g.prototype.drawPass=function(b,c,d){if(this.isEmpty()||4===b&&!this.hasHighlights)return!1;this.processDirtyMaterials();
if(!d.views.some(function(a){return a.extent[0]!==a.extent[2]&&a.extent[1]!==a.extent[3]}))return!1;c=this._renderTargets[c];if(!c)return!1;var e=this._rctx,h=e.gl,g=d.width,l=d.height;if(c.width!==g||c.height!==l)c.resize(g,l),c.colorTexture.setSamplingMode(9729);var m=x.camera;x.fbo=c;x.pixelRatio=d.pixelRatio||1;m.near=1;m.far=1E4;e.bindFramebuffer(c);e.setDepthTestEnabled(!1);e.setBlendFunctionSeparate(770,771,1,771);e.setClearColor.apply(e,this._clearColor);e.clear(h.COLOR_BUFFER_BIT);for(h=
0;h<d.views.length;h++){var n=d.views[h];m.viewport=n.viewport;k.mat4.ortho(m.projectionMatrix,0,n.extent[2]-n.extent[0],0,n.extent[3]-n.extent[1],m.near,m.far);k.mat4.identity(m.viewMatrix);k.mat4.translate(m.viewMatrix,m.viewMatrix,[-n.extent[0],-n.extent[1],0]);m.setGLViewport(this._rctx);a.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(g,l,y[d.index%y.length]);this._renderer.renderGeometryPass(b,x,null,null,this._sliceHelper)}e.setDepthTestEnabled(!0);e.setBlendFunctionSeparate(770,771,1,771);
e.bindFramebuffer(null);e.setViewport(0,0,this._canvas.width,this._canvas.height);c.colorTexture.descriptor.hasMipmap&&c.colorTexture.generateMipmap();return!0};g.prototype._drawTestTexture=function(a,b,d){var h=this._rctx,g=h.gl;if(!this._testPatternMat){for(var l=new Uint8Array(a*b*4),m=0,n=0;n<b;n++)for(var f=0;f<a;f++){var t=Math.floor(f/10),w=Math.floor(n/10);2>t||2>w||10*t>a-20||10*w>b-20?(l[m++]=255,l[m++]=255,l[m++]=255,l[m++]=255):(l[m++]=255,l[m++]=255,l[m++]=255,t&1&&w&1?l[m++]=f&1^n&1?
0:255:l[m++]=t&1^w&1?0:128)}a=new u(h,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:b},l);this._testPatternMat=new q(this._programRep,a,[1,1,1,1],!0,g.ALWAYS);this._testPatternBindParams={proj:k.mat4f64.create(),view:k.mat4f64.create(),nearFar:[-1,1],origin:[0,0,0],viewInvTransp:null,viewport:null,lightingData:null,fovY:0};this._quadVAO=c.createQuadVAO(h,e.Pos3Tex)}this._testPatternMat.setColor([d[0],d[1],d[2],1]);this._testPatternMat.bind(h,this._testPatternBindParams);
this._testPatternMat.bindView(h,this._testPatternBindParams);h.bindVAO(this._quadVAO);h.drawArrays(5,0,r.vertexCount(this._quadVAO,"geometry"));this._testPatternMat.release(h)};g.prototype.materialChanged=function(a){if(this.onContentChanged)this.onContentChanged()};g.prototype.createRenderTargetInternal=function(a,b){for(var c=a,d=0;this._renderTargets[c];)c=a+"_"+ ++d;this._renderTargets[c]=t.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,
hasMipmap:b,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0});return c};return g}();var y=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],x={fbo:null,camera:new g,pixelRatio:1};return p})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/SpatialReference ../../support/projectionUtils ./Geometry ./GeometryData ./Layer ./localOrigin ./Object3D ./Util ../materials/RibbonLineMaterial ../parts/Model".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q){var t=0;p=function(){function f(){this.ROOT_ORIGIN_ID="rg_root_"+t++;this._origins=new Map;this._gridSize=42E5;if(k.isSome(f.testOrigin)){var a=f.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,m.fromValues(a[0],a[1],a[2],this.ROOT_ORIGIN_ID))}}f.prototype.getOrigin=function(b){var c=this._origins.get(this.ROOT_ORIGIN_ID);if(null==c){var d=m.fromValues(b[0]+Math.random()-.5,b[1]+Math.random()-.5,b[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);this._origins.set(this.ROOT_ORIGIN_ID,
d);return d}a.vec3.subtract(r,b,c.vec3);r[0]=Math.abs(r[0]);r[1]=Math.abs(r[1]);r[2]=Math.abs(r[2]);d=this._gridSize;if(r[0]<d&&r[1]<d&&r[2]<d)return c;var c=Math.round(b[0]/d),e=Math.round(b[1]/d);b=Math.round(b[2]/d);var h="rg_"+c+"/"+e+"/"+b,g=this._origins.get(h);g||(g=m.fromValues(c*d,e*d,b*d,h),this._origins.set(h,g));return g};f.prototype._drawOriginBox=function(a){var m=window.view,k=m._stage;if(null==this._object){this._material=new n({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial");
k.add(q.ContentType.MATERIAL,this._material);var f=new d("GridLocalOrigin",{isPickable:!1},"GridLocalOrigin");k.add(q.ContentType.LAYER,f);this._object=new l({name:"GridLocalOrigin",idHint:"GridLocalOrigin",castShadow:!1});k.add(q.ContentType.OBJECT,this._object);f.addObject(this._object);k.addToViewContent([f.id])}for(var r=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],t=r.length,y=new Float32Array(3*t),f=new Uint32Array(2*(t-1)),x=.5*this._gridSize,p=0;p<t;p++)y[3*p+0]=a[0]+(r[p]&1?x:-x),y[3*p+1]=a[1]+
(r[p]&2?x:-x),y[3*p+2]=a[2]+(r[p]&4?x:-x),0<p&&(f[2*p+0]=p-1,f[2*p+1]=p);b.bufferToBuffer(y,g.WebMercator,0,y,m.spatialReference,0,t);m={};m[h.VertexAttrConstants.POSITION]={size:3,data:y};y={};y[h.VertexAttrConstants.POSITION]=f;f=new c(m,y,void 0,"line");f=new e(f,"GridLocalOriginBox");k.add(q.ContentType.GEOMETRY,f);this._object.addGeometry(f,this._material,u);console.log(this._origins.size,a)};return f}();var u=a.mat4f64.create(),r=a.vec3f64.create();(p||(p={})).testOrigin=null;return p})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./ComponentUtils ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),
function(p,f,k,a,g,b,e,c){return function(){function d(a,b,c){this.singleUse=!1;this._componentAABB=this._boundingInfo=null;this.id=d.__idGen.gen(b);this._data=a;this._boundingInfo=c}Object.defineProperty(d.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"componentCount",{get:function(){return a.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexCount",{get:function(){return this.data.indexCount},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"boundingInfo",{get:function(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo},enumerable:!0,configurable:!0});d.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null};d.prototype.getComponentAABB=function(a,b){null==this._componentAABB&&(this._componentAABB=
this._computeComponentAABB());for(var c=0;6>c;c++)b[c]=this._componentAABB[6*a+c];return b};d.prototype._computeComponentAABB=function(){for(var a=this.componentCount,b=new Float32Array(6*a),c=0;c<a;c++)this._calculateAABB(c,b,6*c);return b};d.prototype._calculateAABB=function(a,b,d){void 0===d&&(d=0);var e=this.data.getIndices(c.VertexAttrConstants.POSITION),h=this.data.getAttribute(c.VertexAttrConstants.POSITION),g=this.data.componentOffsets,l=g.length?g[a+1]:e.length,m=Infinity,k=Infinity,f=Infinity,
z=-Infinity,w=-Infinity,B=-Infinity,C=h.offsetIdx,D=h.strideIdx;for(a=g.length?g[a]:0;a<l;a++)var E=C+D*e[a],g=h.data[E],p=h.data[E+1],E=h.data[E+2],m=Math.min(m,g),k=Math.min(k,p),f=Math.min(f,E),z=Math.max(z,g),w=Math.max(w,p),B=Math.max(B,E);b?(b[d]=m,b[d+1]=k,b[d+2]=f,b[d+3]=z,b[d+4]=w,b[d+5]=B):b=[m,k,f,z,w,B];return b};d.prototype._calculateBoundingInfo=function(){var a=this.data.getIndices(c.VertexAttrConstants.POSITION),b=this.data.getAttribute(c.VertexAttrConstants.POSITION),d="triangle"===
this.data.primitiveType?3:1;if(0===a.length)for(var a=new Uint32Array(d),n=0;n<d;++n)a[n]=n;n=a.length;e.assert(0===n%d);n=g.generateDefaultIndexArray(n/d);return new k(n,d,a,b)};d.__idGen=new b;return d}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["require","exports","../../../../core/PooledArray","../../../../core/libs/gl-matrix-2/gl-matrix","./Util"],function(p,f,k,a,g){p=function(){function e(c,d,e,l){g.assert(1<=c.length);g.assert(0===e.length%d);g.assert(e.length>=
c.length*d);g.assert(3===l.size||4===l.size);this.primitiveIndices=c;this.indices=e;this._position=l;this._numIndexPerPrimitive=d;var h=l.data,m=l.offsetIdx,k=l.strideIdx;l=0;var f=c.length,u=m+k*e[d*c[l]];b.clear();b.push(u);this.bbMin=a.vec3f64.fromValues(h[u],h[u+1],h[u+2]);for(this.bbMax=a.vec3f64.clone(this.bbMin);l<f;++l)for(var r=d*c[l],y=0;y<d;++y){u=m+k*e[r+y];b.push(u);var x=h[u];this.bbMin[0]=Math.min(x,this.bbMin[0]);this.bbMax[0]=Math.max(x,this.bbMax[0]);x=h[u+1];this.bbMin[1]=Math.min(x,
this.bbMin[1]);this.bbMax[1]=Math.max(x,this.bbMax[1]);x=h[u+2];this.bbMin[2]=Math.min(x,this.bbMin[2]);this.bbMax[2]=Math.max(x,this.bbMax[2])}this.center=a.vec3f64.create();a.vec3.lerp(this.center,this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);c=this.bsRadius*this.bsRadius;for(l=0;l<b.length;++l)u=b.data[l],d=h[u]-this.center[0],e=h[u+1]-this.center[1],u=h[u+2]-this.center[2],m=d*d+e*e+u*u,m<=c||
(m=Math.sqrt(m),k=.5*(m-this.bsRadius),this.bsRadius+=k,c=this.bsRadius*this.bsRadius,m=k/m,this.center[0]+=d*m,this.center[1]+=e*m,this.center[2]+=u*m);b.clear()}e.prototype.getCenter=function(){return this.center};e.prototype.getBSRadius=function(){return this.bsRadius};e.prototype.getBBMin=function(){return this.bbMin};e.prototype.getBBMax=function(){return this.bbMax};e.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};e.prototype.getIndices=function(){return this.indices};
e.prototype.getPosition=function(){return this._position};e.prototype.getChildren=function(){if(this.children)return this.children;if(1<a.vec3.squaredDistance(this.bbMin,this.bbMax)){for(var b=a.vec3.lerp(a.vec3f64.create(),this.bbMin,this.bbMax,.5),d=this.primitiveIndices.length,g=new Uint8Array(d),l=Array(8),h=0;8>h;++h)l[h]=0;for(var h=this._position,k=h.data,f=h.offsetIdx,t=h.strideIdx,h=0;h<d;++h){for(var u=0,r=this._numIndexPerPrimitive*this.primitiveIndices[h],y=f+t*this.indices[r],x=k[y],
z=k[y+1],w=k[y+2],B=1;B<this._numIndexPerPrimitive;++B){var y=f+t*this.indices[r+B],C=k[y],D=k[y+1],y=k[y+2];C<x&&(x=C);D<z&&(z=D);y<w&&(w=y)}x<b[0]&&(u|=1);z<b[1]&&(u|=2);w<b[2]&&(u|=4);g[h]=u;++l[u]}for(h=b=0;8>h;++h)0<l[h]&&++b;if(2>b)return;b=Array(8);for(h=0;8>h;++h)b[h]=0<l[h]?new Uint32Array(l[h]):void 0;for(h=0;8>h;++h)l[h]=0;for(h=0;h<d;++h)u=g[h],b[u][l[u]++]=this.primitiveIndices[h];this.children=Array(8);for(h=0;8>h;++h)void 0!==b[h]&&(this.children[h]=new e(b[h],this._numIndexPerPrimitive,
this.indices,this._position))}return this.children};return e}();var b=new k({deallocator:null});return p})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports ../../../../core/arrayUtils ../../../../core/libs/gl-matrix-2/gl-matrix ./IdGen ./ModelContentType ./Octree".split(" "),function(p,f,k,a,g,b,e){return function(){function c(b,e,g){this._parentStages=[];this._children=new Set;this.id=c._idGen.gen(g);this.name=b;e=e||{};this.group=e.group||"";this.isVisible=null!=e.isVisible?
e.isVisible:!0;this.isPickable=null!=e.isPickable?e.isPickable:!0;this.isSliceable=!1;this.translation=e.translation?a.vec3f64.clone(e.translation):a.vec3f64.create();this._extent=[a.vec3f64.fromValues(0,0,0),a.vec3f64.fromValues(1E3,1E3,1E3)];this._extentDirty=!0}c.prototype.getParentStages=function(){return this._parentStages};c.prototype.addParentStage=function(a){-1===this._parentStages.indexOf(a)&&this._parentStages.push(a)};c.prototype.removeParentStage=function(a){a=this._parentStages.indexOf(a);
-1<a&&this._parentStages.splice(a,1)};c.prototype.getName=function(){return this.name};c.prototype.getGroup=function(){return this.group};c.prototype.getTranslation=function(){return this.translation};c.prototype.getObjectIds=function(){return k.keysOfSet(this._children,function(a){return a.id})};c.prototype.getObjects=function(){return k.keysOfSet(this._children)};c.prototype.getExtent=function(){this._updateExtent();return this._extent};c.prototype.addObject=function(a){this._children.add(a);a.parentLayer=
this;this.notifyDirty("layObjectAdded",a);this._invalidateExtent();this._octree&&this._octree.add(a)};c.prototype.hasObject=function(a){return this._children.has(a)};c.prototype.removeObject=function(a){return this._children.delete(a)?(a.parentLayer=null,this.notifyDirty("layObjectRemoved",a),this._invalidateExtent(),this._octree&&this._octree.remove(a),!0):!1};c.prototype.notifyObjectBBChanged=function(a,b){this._octree&&this._octree.update(a,b)};c.prototype.getCenter=function(){this._updateExtent();
var b=a.vec3f64.create();return a.vec3.lerp(b,this._extent[0],this._extent[1],.5)};c.prototype.getBSRadius=function(){this._updateExtent();return.5*a.vec3.distance(this._extent[0],this._extent[1])};c.prototype.getSpatialQueryAccelerator=function(){!this._octree&&50<this._children.size&&this._createOctree();return this._octree};c.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)};c.prototype.invalidateSpatialQueryAccelerator=function(){this._octree=
null};c.prototype.notifyDirty=function(a,c,e,h){e=e||b.LAYER;h=h||this;for(var d=0;d<this._parentStages.length;d++)this._parentStages[d].notifyDirty(e,h,a,c)};c.prototype._createOctree=function(){for(var b=this.getExtent(),c=0,g=0;3>g;g++)c=Math.max(c,b[1][g]-b[0][g]);g=a.vec3f64.create();a.vec3.lerp(g,b[0],b[1],.5);this._octree=new e(g,1.2*c,{getRadius:function(a){return a.getBSRadius()},getCenter:function(a){return a.getCenter()}});this._octree.add(k.keysOfSet(this._children))};c.prototype._invalidateExtent=
function(){this._extentDirty=!0};c.prototype._updateExtent=function(){var b=this;if(this._extentDirty)if(this._extentDirty=!1,0===this._children.size)this._extent=[[0,0,0],[0,0,0]];else{var c=null;this._children.forEach(function(d){var e=d.getBBMin();d=d.getBBMax();if(c)for(var g=0;3>g;++g)b._extent[0][g]=Math.min(b._extent[0][g],e[g]),b._extent[1][g]=Math.max(b._extent[1][g],d[g]);else c=[a.vec3f64.clone(e),a.vec3f64.clone(d)]});this._extent=c}};c._idGen=new g;return c}()})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/geometryUtils ./Util".split(" "),
function(p,f,k,a,g,b){function e(a,b,c){c=c||a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c}function c(a,b,c){return!g.frustum.intersectsSphere(c,g.sphere.wrap(b,a))}function d(a,b,c){if(!I.length)for(var d=0;8>d;++d)I[d]={index:0,distance:0};for(d=0;8>d;++d){var e=q[d];I[d].index=d;I[d].distance=l(a,b,e)}I.sort(function(a,b){return a.distance-b.distance});for(d=0;8>d;++d)c[d]=I[d].index;return c}function m(a,b){for(var c=Infinity,d=null,e=0;8>e;++e){var h=l(a,b,t[e]);h<c&&(c=h,d=t[e])}return d}function l(a,
b,c){return b*(a[0]*c[0]+a[1]*c[1]+a[2]*c[2])}p=function(){function f(b,c,d,e){this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._objectCount=0;this._objectToBoundingSphere=d;e&&(void 0!==e.maximumObjectsPerNode&&(this._maximumObjectsPerNode=e.maximumObjectsPerNode),void 0!==e.maximumDepth&&(this._maximumDepth=e.maximumDepth));isNaN(b[0])||isNaN(b[1])||isNaN(b[2])||isNaN(c)?this._root=new h(null,a.vec3f64.fromValues(0,0,0),.5):this._root=new h(null,b,c/2)}Object.defineProperty(f.prototype,
"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maximumDepth",
{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0});f.prototype.add=function(a,b){a=this._objectOrObjectsArray(a);b=null==b?a.length:b;this._objectCount+=b;this._grow(a);for(var c=h.acquire(),d=0;d<b;d++){var e=a[d];c.init(this._root);this._isDegenerate(e)?this._degenerateObjects.add(e):this._add(e,c)}h.release(c)};f.prototype.remove=function(a,b){a=this._objectOrObjectsArray(a);
this._objectCount-=a.length;for(var c=h.acquire(),d=0;d<a.length;d++){var e=a[d],g=b||this._boundingSphereFromObject(e,C);this._isValidRadius(g.radius)?(c.init(this._root),this._remove(e,g,c)):this._degenerateObjects.delete(e)}h.release(c);this._shrink()};f.prototype.update=function(a,b){if(this._isValidRadius(b.radius)||!this._isDegenerate(a))this.remove(a,b),this.add(a)};f.prototype.forEachAlongRay=function(a,b,c){var d=this;this._forEachNode(this._root,function(e){if(!d._intersectsNode(a,b,e))return!1;
e=e.node;e.terminals.forEach(function(e){d._intersectsObject(a,b,e)&&c(e)});null!==e.residents&&e.residents.forEach(function(e){d._intersectsObject(a,b,e)&&c(e)});return!0})};f.prototype.forEach=function(a){this._forEachNode(this._root,function(b){b=b.node;b.terminals.forEach(a);null!==b.residents&&b.residents.forEach(a);return!0});this._degenerateObjects.forEach(a)};f.prototype.forEachDegenerateObject=function(a){this._degenerateObjects.forEach(a)};f.prototype.findClosest=function(a,b,c,d,e){return this._findClosest(a,
"front-to-back"===b?n.FRONT_TO_BACK:n.BACK_TO_FRONT,c,d,e)};f.prototype.forEachInDepthRange=function(a,b,c,d,e,h,g,l){this._forEachInDepthRange(a,b,"front-to-back"===c?n.FRONT_TO_BACK:n.BACK_TO_FRONT,d,e,h,g,l)};f.prototype.forEachNode=function(a){this._forEachNode(this._root,function(b){return a(b.node,b.center,2*b.halfSize)})};f.prototype._intersectsNode=function(a,c,d){e(d.center,2*-d.halfSize,z);e(d.center,2*d.halfSize,w);return b.rayBoxTest(a,c,z,w)};f.prototype._intersectsObject=function(a,
b,c){var d=this._objectToBoundingSphere.getRadius(c);return 0<d?g.sphere.intersectsRay(g.sphere.wrap(d,this._objectToBoundingSphere.getCenter(c)),g.ray.wrap(a,b)):!0};f.prototype._forEachNode=function(a,b){a=h.acquire().init(a);for(var c=[a];0!==c.length;){a=c.pop();if(b(a)&&!a.isLeaf())for(var d=0;d<a.node.children.length;d++)a.node.children[d]&&c.push(h.acquire().init(a).advance(d));h.release(a)}};f.prototype._forEachNodeDepthOrdered=function(a,b,c,e){void 0===e&&(e=n.FRONT_TO_BACK);a=h.acquire().init(a);
var g=[a];for(c=d(c,e,N);0!==g.length;){a=g.pop();if(b(a)&&!a.isLeaf())for(e=7;0<=e;--e){var l=c[e];l>=a.node.children.length||a.node.children[l]&&g.push(h.acquire().init(a).advance(l))}h.release(a)}};f.prototype._findClosest=function(b,d,e,h,g){var k=this,n=Infinity,f=Infinity,q=null,r=m(b,d),t=0,w=function(a){++t;if(!h||h(a)){var g=k._objectToBoundingSphere.getCenter(a),m=k._objectToBoundingSphere.getRadius(a);if(!e||!c(g,m,e)){var g=l(b,d,g),r=g-m;r<n&&(n=r,f=g+m,q=a)}}};this._forEachNodeDepthOrdered(this._root,
function(h){if(null!=g&&t>=g||e&&c(h.center,h.halfSize*u,e))return!1;a.vec3.scale(x,r,h.halfSize);a.vec3.add(x,x,h.center);if(l(b,d,x)>f)return!1;h=h.node;h.terminals.forEach(function(a){w(a)});null!==h.residents&&h.residents.forEach(function(a){w(a)});return!0},b,d);return q};f.prototype._forEachInDepthRange=function(b,d,e,h,g,k,f,q){var r=this,t=-Infinity,w=Infinity,z={setRange:function(a){e===n.FRONT_TO_BACK?(t=Math.max(t,a.near),w=Math.min(w,a.far)):(t=Math.max(t,-a.far),w=Math.min(w,-a.near))}};
z.setRange(h);var y=l(d,e,b),B=m(d,e),F=m(d,-1*e),K=0,C=function(a){++K;if(!f||f(a)){var b=r._objectToBoundingSphere.getCenter(a),h=r._objectToBoundingSphere.getRadius(a),m=l(d,e,b)-y;m-h>w||m+h<t||k&&c(b,h,k)||g(a,z)}};this._forEachNodeDepthOrdered(this._root,function(b){if(null!=q&&K>=q||k&&c(b.center,b.halfSize*u,k))return!1;a.vec3.scale(x,B,b.halfSize);a.vec3.add(x,x,b.center);if(l(d,e,x)-y>w)return!1;a.vec3.scale(x,F,b.halfSize);a.vec3.add(x,x,b.center);if(l(d,e,x)-y<t)return!1;b=b.node;b.terminals.forEach(function(a){C(a)});
null!==b.residents&&b.residents.forEach(function(a){C(a)});return!0},d,e)};f.prototype._objectOrObjectsArray=function(a){if(Array.isArray(a))return a;r[0]=a;return r};f.prototype._remove=function(a,b,c){B.length=0;b=c.advanceTo(b,function(a,b){B.push(a.node,b)})?c.node.terminals:c.node.residents;b.removeUnordered(a);if(0===b.length)for(a=B.length-2;0<=a&&this._purge(B[a],B[a+1]);a-=2);};f.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;
for(var b=0;b<a.children.length;b++)if(a.children[b])return!1;return!0};f.prototype._purge=function(a,b){0<=b&&(a.children[b]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=new k({shrink:!0})),!0):!1};f.prototype._add=function(a,b){b.advanceTo(this._boundingSphereFromObject(a,C))?b.node.terminals.push(a):(b.node.residents.push(a),b.node.residents.length>this._maximumObjectsPerNode&&b.depth<this._maximumDepth&&this._split(b))};f.prototype._split=function(a){var b=a.node.residents;
a.node.residents=null;for(var c=0;c<b.length;c++){var d=h.acquire().init(a);this._add(b.data[c],d);h.release(d)}};f.prototype._grow=function(b){var c=this;if(0!==b.length&&(b=this._boundingSphereFromObjects(b,function(a,b){return c._boundingSphereFromObject(a,b)},D),this._isValidRadius(b.radius)&&!this._fitsInsideTree(b)))if(this._nodeIsEmpty(this._root.node))a.vec3.copy(this._root.center,b.center),this._root.halfSize=1.25*b.radius;else{var d=h.acquire();this._rootBoundsForRootAsSubNode(b,d);this._placingRootViolatesMaxDepth(d)?
this._rebuildTree(b,d):this._growRootAsSubNode(d);h.release(d)}};f.prototype._rebuildTree=function(b,c){var d=this;a.vec3.copy(E.center,c.center);E.radius=c.halfSize;b=this._boundingSphereFromObjects([b,E],function(a){return a},G);c=h.acquire().init(this._root);this._root.initFrom(null,b.center,1.25*b.radius);this._forEachNode(c,function(a){d.add(a.node.terminals.data,a.node.terminals.length);null!==a.node.residents&&d.add(a.node.residents.data,a.node.residents.length);return!0});h.release(c)};f.prototype._placingRootViolatesMaxDepth=
function(a){var b=0;this._forEachNode(this._root,function(a){b=Math.max(b,a.depth);return!0});return b+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};f.prototype._rootBoundsForRootAsSubNode=function(a,b){var c=a.radius,d=a.center;a=-Infinity;for(var e=this._root.center,h=this._root.halfSize,g=0;3>g;g++){var l=Math.max(0,Math.ceil((e[g]-h-(d[g]-c))/(2*h))),m=Math.max(0,Math.ceil((d[g]+c-(e[g]+h))/(2*h)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(l+m)*Math.LOG2E)));H[g].min=
l;H[g].max=m}for(g=0;3>g;g++)l=H[g].min,m=H[g].max,c=(a-(l+m))/2,l+=Math.ceil(c),m+=Math.floor(c),y[g]=e[g]-h-l*h*2+(m+l)*h;return b.initFrom(null,y,a*h,0)};f.prototype._growRootAsSubNode=function(b){var c=this._root.node;a.vec3.copy(D.center,this._root.center);D.radius=this._root.halfSize;this._root.init(b);b.advanceTo(D,null,!0);b.node.children=c.children;b.node.residents=c.residents;b.node.terminals=c.terminals};f.prototype._shrink=function(){for(;;){var a=this._findShrinkIndex();if(-1===a)break;
this._root.advance(a);this._root.depth=0}};f.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,b=this._root.node.children,c=0,d=0;d<b.length&&null==a;)c=d++,a=b[c];for(;d<b.length;)if(b[d++])return-1;return c};f.prototype._isDegenerate=function(a){a=this._objectToBoundingSphere.getRadius(a);return!this._isValidRadius(a)};f.prototype._isValidRadius=function(a){return!isNaN(a)&&-Infinity!==a&&Infinity!==a&&0<a};f.prototype._fitsInsideTree=
function(a){var b=this._root.center,c=this._root.halfSize,d=a.center;return a.radius<=c&&d[0]>=b[0]-c&&d[0]<=b[0]+c&&d[1]>=b[1]-c&&d[1]<=b[1]+c&&d[2]>=b[2]-c&&d[2]<=b[2]+c};f.prototype._boundingSphereFromObject=function(b,c){a.vec3.copy(c.center,this._objectToBoundingSphere.getCenter(b));c.radius=this._objectToBoundingSphere.getRadius(b);return c};f.prototype._boundingSphereFromObjects=function(b,c,d){if(1===b.length){var e=c(b[0],D);a.vec3.copy(d.center,e.center);d.radius=e.radius}else{z[0]=Infinity;
z[1]=Infinity;z[2]=Infinity;w[0]=-Infinity;w[1]=-Infinity;w[2]=-Infinity;for(var h=0;h<b.length;h++)if(e=c(b[h],D),this._isValidRadius(e.radius)){var g=z,l=e.center,m=e.radius;g[0]=Math.min(g[0],l[0]-m);g[1]=Math.min(g[1],l[1]-m);g[2]=Math.min(g[2],l[2]-m);g=w;l=e.center;e=e.radius;g[0]=Math.max(g[0],l[0]+e);g[1]=Math.max(g[1],l[1]+e);g[2]=Math.max(g[2],l[2]+e)}a.vec3.lerp(d.center,z,w,.5);d.radius=Math.max(w[0]-z[0],w[1]-z[1],w[2]-z[2])/2}return d};return f}();var h=function(){function b(b,c,d,e){void 0===
d&&(d=0);void 0===e&&(e=0);this.center=a.vec3f64.create();this.initFrom(b,c,d,0)}b.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};b.prototype.initFrom=function(c,d,e,h){void 0===c&&(c=null);void 0===e&&(e=this.halfSize);void 0===h&&(h=this.depth);this.node=c||b.createEmptyNode();d&&a.vec3.copy(this.center,d);this.halfSize=e;this.depth=h;return this};b.prototype.advance=function(a){var c=this.node.children[a];c||(c=b.createEmptyNode(),this.node.children[a]=c);
this.node=c;this.halfSize/=2;this.depth++;a=q[a];this.center[0]+=a[0]*this.halfSize;this.center[1]+=a[1]*this.halfSize;this.center[2]+=a[2]*this.halfSize;return this};b.prototype.advanceTo=function(a,b,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(a))return b&&b(this,-1),!0;if(this.isLeaf()&&!c)return b&&b(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var d=this._childIndex(a);b&&b(this,d);this.advance(d)}};b.prototype.isLeaf=function(){return null!=this.node.residents};b.prototype.isTerminalFor=
function(a){return a.radius>this.halfSize/2};b.prototype._childIndex=function(a){a=a.center;for(var b=this.center,c=0,d=0;3>d;d++)b[d]<a[d]&&(c|=1<<d);return c};b.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new k({shrink:!0}),residents:new k({shrink:!0})}};b.acquire=function(){if(0===this._pool.length)return new b;var a=this._pool[this._pool.length-1];this._pool.length--;return a};b.release=function(a){this._pool.push(a)};b._pool=[];return b}(),n;
(function(a){a[a.FRONT_TO_BACK=1]="FRONT_TO_BACK";a[a.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(n||(n={}));var q=[a.vec3f64.fromValues(-1,-1,-1),a.vec3f64.fromValues(1,-1,-1),a.vec3f64.fromValues(-1,1,-1),a.vec3f64.fromValues(1,1,-1),a.vec3f64.fromValues(-1,-1,1),a.vec3f64.fromValues(1,-1,1),a.vec3f64.fromValues(-1,1,1),a.vec3f64.fromValues(1,1,1)],t=[a.vec3f64.fromValues(-1,-1,-1),a.vec3f64.fromValues(-1,-1,1),a.vec3f64.fromValues(-1,1,-1),a.vec3f64.fromValues(-1,1,1),a.vec3f64.fromValues(1,-1,-1),a.vec3f64.fromValues(1,
-1,1),a.vec3f64.fromValues(1,1,-1),a.vec3f64.fromValues(1,1,1)],u=Math.sqrt(3),r=[null],y=a.vec3f64.create(),x=a.vec3f64.create(),z=a.vec3f64.create(),w=a.vec3f64.create(),B=[],C={center:a.vec3f64.create(),radius:0},D={center:a.vec3f64.create(),radius:0},E={center:a.vec3f64.create(),radius:0},G={center:a.vec3f64.create(),radius:0},H=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],I=[],N=[];return p})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/MaterialUtil ../shaders/RibbonLinePrograms".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n){var q=a.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");p=function(a){function d(b,c){c=a.call(this,c)||this;c.params=h.copyParameters(b,r);"miter"!==c.params.join&&(c.params.miterLimit=0);c.numVertsAtJoin="wall"===c.params.type?2:4;c.numVertsAtCap=2;c.canBeMerged="screen"===c.params.type&&null==c.params.stippleLength;c.bufferWriter="wall"===c.params.type?new w:new x(c.canBeMerged);return c}k(d,a);d.prototype.getColor=function(){return this.params.color};
d.prototype.dispose=function(){};d.prototype.getParams=function(){return this.params};d.prototype.getParameterValues=function(){var a=h.copyParameters(this.params);a.miterLimit="miter"===a.join?a.miterLimit:0;return a};d.prototype.setParameterValues=function(a){for(var b in a)l.assert("type"!==b,"RibbonLineMaterial: type cannot be changed after creation"),l.assert("stippleLength"!==b||null!=a[b]===(null!=this.params[b]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),
this.params[b]=a[b];"miter"!==this.params.join&&(this.params.miterLimit=0);this.notifyDirty("matChanged")};d.prototype.intersect=function(a,d,e,h,m,k,n,f){if(h.isSelection&&!c.isAllHidden(d.componentVisibilities,a.data.componentOffsets))if(l.isTranslationMatrix(e)){d=a.data;a=d.getVertexAttr()[l.VertexAttrConstants.POSITION].data;d=d.getVertexAttr()[l.VertexAttrConstants.SIZE];k=h.camera;f=h.point;d=((d&&d.data[0])+this.params.width)/2+4;g.vec3.set(W[0],f[0]-d,f[1]+d,0);g.vec3.set(W[1],f[0]+d,f[1]+
d,0);g.vec3.set(W[2],f[0]+d,f[1]-d,0);g.vec3.set(W[3],f[0]-d,f[1]-d,0);for(var r=0;4>r;r++)k.unprojectPoint(W[r],Q[r]);b.plane.fromPoints(k.eye,Q[0],Q[1],J);b.plane.fromPoints(k.eye,Q[1],Q[2],F);b.plane.fromPoints(k.eye,Q[2],Q[3],K);b.plane.fromPoints(k.eye,Q[3],Q[0],L);m=Number.MAX_VALUE;for(r=0;r<a.length-5;r+=3)if(D[0]=a[r]+e[12],D[1]=a[r+1]+e[13],D[2]=a[r+2]+e[14],E[0]=a[r+3]+e[12],E[1]=a[r+4]+e[13],E[2]=a[r+5]+e[14],!(0>b.plane.signedDistance(J,D)&&0>b.plane.signedDistance(J,E)||0>b.plane.signedDistance(F,
D)&&0>b.plane.signedDistance(F,E)||0>b.plane.signedDistance(K,D)&&0>b.plane.signedDistance(K,E)||0>b.plane.signedDistance(L,D)&&0>b.plane.signedDistance(L,E))){k.projectPoint(D,I);k.projectPoint(E,N);if(0>I[2]&&0<N[2]){g.vec3.subtract(G,D,E);var u=k.frustum,t=-b.plane.signedDistance(u.planes[4],D),u=t/g.vec3.dot(G,u.planes[4]);g.vec3.scale(G,G,u);g.vec3.add(D,D,G);k.projectPoint(D,I)}else if(0<I[2]&&0>N[2])g.vec3.subtract(G,E,D),u=k.frustum,t=-b.plane.signedDistance(u.planes[4],E),u=t/g.vec3.dot(G,
u.planes[4]),g.vec3.scale(G,G,u),g.vec3.add(E,E,G),k.projectPoint(E,N);else if(0>I[2]&&0>N[2])continue;u=l.pointLineSegmentDistanceSquared2D(I,N,f);u<m&&(m=u,g.vec3.copy(S,D),g.vec3.copy(M,E))}e=h.p0;h=h.p1;m<d*d&&(a=Number.MAX_VALUE,b.lineSegment.closestLineSegmentPoint(b.lineSegment.fromPoints(S,M,P),b.lineSegment.fromPoints(e,h,O),H)&&(g.vec3.subtract(H,H,e),a=g.vec3.length(H),g.vec3.scale(H,H,1/a),a/=g.vec3.distance(e,h)),n(a,H))}else q.error("intersection assumes a translation-only matrix")};
d.prototype.getGLMaterials=function(){return{color:t,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:u}};d.prototype.getAllTextureIds=function(){return[]};return d}(m);var t=function(a){function b(b,c){b=a.call(this,b,c)||this;b.updateParameters();return b}k(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.beginSlot=function(a){return a===(this.params.writeDepth?6:9)};b.prototype.getProgram=function(){return this.program};
b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(n.colorPass,{screenScale:"screen"===this.params.type,wall:"wall"===this.params.type,stipple:null!=this.params.stippleLength,slice:this.params.slicePlaneEnabled})};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform4fv("eColor",d.color);c.setUniform1f("miterLimit",d.miterLimit);c.setUniform1f("nearPlane",b.nearFar[0]);"screen"===d.type?(c.setUniform2fv("screenSize",[b.viewport[2],
b.viewport[3]]),c.setUniform1f("extLineWidth",d.width*b.pixelRatio)):c.setUniform1f("extLineWidth",d.width);null!=d.stippleLength&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(770,771,1,771);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3]&&d.writeDepth)};b.prototype.release=function(a){this.params.polygonOffset&&
a.setPolygonOffsetFillEnabled(!1);a.setBlendingEnabled(!1);a.setDepthWriteEnabled(!0)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;h.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&h.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 5};return b}(d),u=function(a){function b(b,c){b=a.call(this,b,c)||this;b.updateParameters();return b}k(b,a);b.prototype.updateParameters=
function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.beginSlot=function(a){return 4===a};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(n.highlightPass,{screenScale:"screen"===this.params.type,wall:"wall"===this.params.type,stipple:null!=this.params.stippleLength,slice:this.params.slicePlaneEnabled})};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);
c.setUniform4fv("eColor",d.color);c.setUniform1f("miterLimit",d.miterLimit);c.setUniform1f("nearPlane",b.nearFar[0]);"screen"===d.type?(c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),c.setUniform1f("extLineWidth",d.width*b.pixelRatio)):c.setUniform1f("extLineWidth",d.width);null!=d.stippleLength&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setDepthTestEnabled(!0);
a.setDepthWriteEnabled(1<=d.color[3])};b.prototype.release=function(a){this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);a.setDepthWriteEnabled(!0)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;h.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&h.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 5};return b}(d),r={color:[1,1,1,1],width:0,
type:"screen",join:"miter",miterLimit:5,writeDepth:!0,polygonOffset:!1,stippleLength:null,slicePlaneEnabled:!1},y=e.newLayout().vec3f(l.VertexAttrConstants.POSITION).vec2f(l.VertexAttrConstants.UV0).vec3f(l.VertexAttrConstants.AUXPOS1).vec3f(l.VertexAttrConstants.AUXPOS2).vec4f(l.VertexAttrConstants.COLOR).f32(l.VertexAttrConstants.SIZE),x=function(){function a(a){this.canBeMerged=a;this.vertexBufferLayout=y;this.numVertsAtJoin=4;this.numVertsAtCap=2}a.prototype.allocate=function(a){return y.createBuffer(a)};
a.prototype.elementCount=function(a){a=(a.indices[l.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;this.canBeMerged&&(a+=2);return a};a.prototype.write=function(a,b,c,d,e){c=b.vertexAttr[l.VertexAttrConstants.POSITION].data;var h=b.indices&&b.indices[l.VertexAttrConstants.POSITION];h&&h.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");h=b.vertexAttr[l.VertexAttrConstants.COLOR]?b.vertexAttr[l.VertexAttrConstants.COLOR].data:
B;b=b.vertexAttr[l.VertexAttrConstants.SIZE]?b.vertexAttr[l.VertexAttrConstants.SIZE].data:C;var g=c.length/3;a=a.transformation;d=d.position.typedBuffer;var m=0,k=this.vertexBufferLayout.stride/4,n=e*=k;this.canBeMerged&&(e+=k);var f=c[0],q=c[1],r=c[2];if(a)var u=f,t=q,w=r,f=a[0]*u+a[4]*t+a[8]*w+a[12],q=a[1]*u+a[5]*t+a[9]*w+a[13],r=a[2]*u+a[6]*t+a[10]*w+a[14];var z=c[3],y=c[4],w=c[5];a&&(u=z,t=y,z=a[0]*u+a[4]*t+a[8]*w+a[12],y=a[1]*u+a[5]*t+a[9]*w+a[13],w=a[2]*u+a[6]*t+a[10]*w+a[14]);for(var x=f,
F=q,K=r,L=0;L<g;L++)u=3*L,L<g-1&&(z=c[u+3],y=c[u+4],w=c[u+5],a&&(u=z,t=y,z=a[0]*u+a[4]*t+a[8]*w+a[12],y=a[1]*u+a[5]*t+a[9]*w+a[13],w=a[2]*u+a[6]*t+a[10]*w+a[14])),m+=Math.sqrt((x-f)*(x-f)+(F-q)*(F-q)+(K-r)*(K-r)),d[e++]=x,d[e++]=F,d[e++]=K,d[e++]=m,d[e++]=0===L?-1.2:-1,d[e++]=f,d[e++]=q,d[e++]=r,d[e++]=z,d[e++]=y,d[e++]=w,d[e++]=h[0],d[e++]=h[1],d[e++]=h[2],d[e++]=h[3],d[e++]=b[0],d[e++]=x,d[e++]=F,d[e++]=K,d[e++]=m,d[e++]=0===L?1.2:1,d[e++]=f,d[e++]=q,d[e++]=r,d[e++]=z,d[e++]=y,d[e++]=w,d[e++]=h[0],
d[e++]=h[1],d[e++]=h[2],d[e++]=h[3],d[e++]=b[0],0<L&&L<g-1&&(d[e++]=x,d[e++]=F,d[e++]=K,d[e++]=m,d[e++]=-1.2,d[e++]=f,d[e++]=q,d[e++]=r,d[e++]=z,d[e++]=y,d[e++]=w,d[e++]=h[0],d[e++]=h[1],d[e++]=h[2],d[e++]=h[3],d[e++]=b[0],d[e++]=x,d[e++]=F,d[e++]=K,d[e++]=m,d[e++]=1.2,d[e++]=f,d[e++]=q,d[e++]=r,d[e++]=z,d[e++]=y,d[e++]=w,d[e++]=h[0],d[e++]=h[1],d[e++]=h[2],d[e++]=h[3],d[e++]=b[0]),f=x,q=F,r=K,x=z,F=y,K=w;if(this.canBeMerged){for(L=n;L<n+k;L++)d[L]=d[L+k];c=e-k;for(L=0;L<k;L++)d[e++]=d[c++]}};return a}(),
z=e.newLayout().vec3f(l.VertexAttrConstants.POSITION).vec2f(l.VertexAttrConstants.UV0),w=function(){function a(){this.vertexBufferLayout=z;this.numVertsAtCap=this.numVertsAtJoin=2;this.tmpCurrent=g.vec3f64.create();this.tmpLast=g.vec3f64.create()}a.prototype.allocate=function(a){return y.createBuffer(a)};a.prototype.elementCount=function(a){return(a.indices[l.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap};a.prototype.write=function(a,b,c,d,e){c=b.vertexAttr[l.VertexAttrConstants.POSITION].data;
(b=b.indices&&b.indices[l.VertexAttrConstants.POSITION])&&b.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");b=c.length/3;a=a.transformation;var h=0,m=this.tmpCurrent,k=this.tmpLast;g.vec3.set(m,c[0],c[1],c[2]);for(var n=0;n<b;n++){var f=3*n;g.vec3.copy(k,m);g.vec3.set(m,c[f],c[f+1],c[f+2]);a&&g.vec3.transformMat4(m,m,a);h+=g.vec3.squaredDistance(k,m);d.position.setVec(e,m);d.uv0.set(e,0,h);d.uv0.set(e,1,-1);++e;d.position.setVec(e,m);d.uv0.set(e,0,h);d.uv0.set(e,
1,1);++e}};return a}(),B=[255,255,255,255],C=[0,0,0,0],D=g.vec3f64.create(),E=g.vec3f64.create(),G=g.vec3f64.create(),H=g.vec3f64.create(),I=g.vec3f64.create(),N=g.vec3f64.create(),S=g.vec3f64.create(),M=g.vec3f64.create(),P=b.lineSegment.create(),O=b.lineSegment.create(),W=[g.vec3f64.create(),g.vec3f64.create(),g.vec3f64.create(),g.vec3f64.create()],Q=[g.vec3f64.create(),g.vec3f64.create(),g.vec3f64.create(),g.vec3f64.create()],J=b.plane.create(),F=b.plane.create(),K=b.plane.create(),L=b.plane.create();
return p})},"esri/views/3d/webgl-engine/shaders/RibbonLinePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});var b=function(a){return g.glslifyDefineMap({WALL:a.wall,SCREENSCALE:a.screenScale,STIPPLE:a.stipple,SLICE:a.slice})};f.colorPass={name:"ribbon-line-color",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),
fragmentShader:b(e)+a.resolveIncludes("materials/ribbonLine/colorPass.frag")}},attributes:k.Default3D};f.highlightPass={name:"ribbon-line-highlight",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:b(e)+a.resolveIncludes("materials/ribbonLine/highlightPass.frag")}},attributes:k.Default3D}})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../core/iteratorUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/buffer/glUtil ./ComponentUtils ./DefaultVertexAttributeLocations ./Float32ArrayList ./FxaaRenderPass ./HighlightTextureHelper ./InstanceBufferData ./IntervalUtilities ./LinearDepthTextureHelper ./NormalTextureHelper ./RenderContext ./RenderPluginManager ./SmaaRenderPass ./StencilRenderingHelper ./Util ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../../../webgl/BufferObject ../../../webgl/Profiling ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H){function I(a){return a.instanceParameters.hidden?[]:b.generateVisibleIndexRanges(a.instanceParameters.componentVisibilities,a.componentOffsets)}function N(b,c,d){var e=b.origin.vec3;x.setMatrixTranslation3(K,-e[0],-e[1],-e[2]);a.mat4.multiply(c,K,b.transformation);a.mat4.invert(d,c);a.mat4.transpose(d,d)}function S(a,b,c){for(var d in a){var e=a[d];b(d,e);e.origin2data.forEach(function(a,b){c(b,a)})}}function M(a){return!1===a.preinterleaved?
x.getFirstObjectValue(a.indices).length:a.indexCount}var P=a.mat4f64.create();p=function(){function f(a,b,c,e,h){this._lighting=new w.SceneLighting;this._mat2DataMerged={};this._mat2DataInstanced={};this._mat2DataPreinterleaved={};this._renderOrder=[];this._renderContext=new t;this._isRendering=!1;this._highlights=[];this._threshold=1535;this._needsRender=!0;this._fallbackDepthStencilTexture=null;this._stats=new O;this._edgeView=null;this.ssaoEnabled=!1;this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1};
this._programRep=a;this._materialRep=b;this._orderedRendering=h;this._rctx=e;this._fxaaPass=new d(e);this._smaaPass=new r(e);this._renderContext.rctx=e;this._renderContext.lightingData=this._lighting.getOld();e.setDepthTestEnabled(!0);e.setFaceCullingEnabled(!0);e.setBlendingEnabled(!1);e.setBlendFunctionSeparate(770,771,1,771);this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,framebufferTex:null,shadowMappingEnabled:!1,ssaoEnabled:!1,
origin:null,pixelRatio:null,slicePlane:null};this._linearDepthTextureHelper=new n(e);this._normalTextureHelper=new q(e);this._highlightTextureHelper=new m(e);this._stencilRenderingHelper=new y(e);this._renderPlugins=new u.RenderPluginManager({rctx:e,gl:e.gl,programRep:a,textureRep:c,materialRep:b});this._initializeFramebufferTexture()}f.prototype._initializeFramebufferTexture=function(){var a=this._rctx.gl,a=this._rctx.contextAttributes.alpha?a.RGBA:a.RGB,b=new E(this._rctx,{target:3553,pixelFormat:a,
dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:a,texture:b}};f.prototype.dispose=function(){var a=this,b=function(b){a._releaseMaterials(b)},c=function(a,b){b.type===Q.Preinterleaved?b.instances.forEach(function(a){return a.vao.dispose(!0)}):b.vao.dispose(!0)};S(this._mat2DataMerged,b,c);S(this._mat2DataInstanced,b,c);S(this._mat2DataPreinterleaved,b,c);this._mat2DataPreinterleaved=this._mat2DataInstanced=this._mat2DataMerged=null;this._framebuffer.texture.dispose();
this._framebuffer.texture=null;this._linearDepthTextureHelper.enabled=!1;this._normalTextureHelper.enabled=!1;this._stencilRenderingHelper.enabled=!1;this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null);this._highlightTextureHelper&&(this._highlightTextureHelper.dispose(),this._highlightTextureHelper=null)};Object.defineProperty(f.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"edgeView",{get:function(){var a=this;null==this._edgeView&&(this._edgeView=new z.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){a._needsRender=!0}}),this._edgeView.initialize());return this._edgeView},enumerable:!0,configurable:!0});f.prototype.setLighting=function(a){this._lighting.set(a)};Object.defineProperty(f.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0});
f.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderPlugins.resetNeedsRender()};f.prototype.needsRender=function(){return this._needsRender||this._renderPlugins.needsRender()};f.prototype.getCombinedStats=function(){var a=this;this._stats.VBOallocatedSize=0;this._stats.VBOoptimalSize=0;this._stats.VBOusedSize=0;var b=function(){},c=function(b,c){c.type===Q.Preinterleaved?c.instances.forEach(function(b){b=b.vao.size;a._stats.VBOallocatedSize+=b/4;a._stats.VBOusedSize+=b/4;a._stats.VBOoptimalSize+=
b/4}):(a._stats.VBOallocatedSize+=c.buffer.getArray().length,a._stats.VBOusedSize+=c.buffer.getSize(),a._stats.VBOoptimalSize+=c.optimalCount)};S(this._mat2DataMerged,b,c);S(this._mat2DataInstanced,b,c);S(this._mat2DataPreinterleaved,b,c);this._stats.VBOallocatedSize*=.00390625;this._stats.VBOusedSize*=.00390625;this._stats.VBOoptimalSize*=.00390625;return this._stats};f.prototype.getFramebufferTexture=function(a){switch(a){case "linearDepth":return this._linearDepthTextureHelper.framebuffer.colorTexture;
case "normals":return this._normalTextureHelper.framebuffer.colorTexture}return null};f.prototype._addHighlight=function(a){var b=this._getInstance(a);if(null===b)console.error("No instance found for RenderGeometry {name: '"+a.name+"', uniqueName: '"+a.uniqueName+"'}");else if(this._highlights.push(b),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=!0,this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights)};f.prototype._removeHighlight=function(a){var b=
this._highlights.length;this._highlights=this._highlights.filter(function(b){return b.uniqueName!==a.uniqueName});if(b!==this._highlights.length){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights);this._needsRender=!0}};Object.defineProperty(f.prototype,"hasHighlights",{get:function(){return 0<this._highlights.length},enumerable:!0,configurable:!0});f.prototype._renderHUDVisibility=function(a){var b=this,c=B.shouldRenderVisibilityDuringRenderPass(a.pass),d=a.offscreenRenderingHelper&&
a.offscreenRenderingHelper.enabled,e=!1;c&&d&&a.offscreenRenderingHelper.renderHUDVisibility(function(){e=b._renderInternalSlot(14,a)});return e};f.prototype.renderGeometrySlotsPt1=function(a){this._renderPlugins.render(1,a);this._renderInternalSlot(2,a);this._renderPlugins.render(3,a);this._renderInternalSlot(4,a);this._renderPlugins.render(5,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._renderPlugins.render(16,this._renderContext);this._renderInternalSlot(6,a);this.renderOptions.earlyOcclusionPixelDraw&&
(this._renderHUDVisibility(a),this._renderInternalSlot(21,this._renderContext));this._renderPlugins.render(7,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep)};f.prototype.renderTransparentTerrain=function(a){return this._renderPlugins.render(8,a)};f.prototype.renderGeometrySlots=function(a){this.renderGeometrySlotsPt1(a);this.renderTransparentTerrain(a)};f.prototype.renderHUD=function(a){this._bindParameters.renderTransparentlyOccludedHUD=a;this._renderInternalSlot(22,this._renderContext);
this._renderInternalSlot(19,this._renderContext);this._renderInternalSlot(20,this._renderContext)};f.prototype._renderHighlights=function(a,b){if(b&&b.enabled&&(this.hasHighlights||this._renderPlugins.needsHighlight())){var c=null;b.profilingCallback&&(c=D.startMeasurement(this._renderContext.rctx));var d=a.fbo;this._highlightTextureHelper.prepareHighlightPass(a.camera);this.renderGeometryPass(4,a,null,null,this._renderContext.sliceHelper);this._rctx.clear(this._rctx.gl.DEPTH_BUFFER_BIT);this.renderHUD("both");
this._highlightTextureHelper.finish(d);b.render(a,this._highlightTextureHelper.framebuffer);null!==c&&b.profilingCallback&&c.stop(function(a){b.profilingCallback&&b.profilingCallback(a)})}};f.prototype._needsRenderOccluded=function(a){for(var b in this._mat2DataInstanced){var c=this._mat2DataInstanced[b][0];if(c&&c.renderOccluded&&c.beginSlot(a)&&c.isVisible())return!0}return!1};f.prototype._renderOccluded=function(a,b,c){if(b&&c&&c.enabled){var d=this._needsRenderOccluded(4)||this._needsRenderOccluded(6)||
this._needsRenderOccluded(9);if(b.enabled=d)d=this._renderContext,b.setupFBOs(a),b.prepareColorPass(),d.pass=0,d.renderOccludedOnly=!0,this._renderInternalSlot(4,d),this._renderInternalSlot(6,d),this._renderInternalSlot(9,d),d.renderOccludedOnly=!1,b.finish(c.framebuffer),b.apply()}};f.prototype._renderUnordered=function(a,b,c){var d=this,e=this._rctx;this._isRendering=!0;this._stats.reset();var h=a.camera,g=a.fbo,l=a.pixelRatio;this._updateGlobalUniforms(h.projectionMatrix);this._renderContext.pass=
0;this._renderContext.camera=h;this._renderContext.pixelRatio=l;this._renderContext.shadowMap=b;this._renderContext.sliceHelper=c.slice;this._renderContext.ssaoHelper=c.ssao;this._renderContext.offscreenRenderingHelper=c.offscreenRendering;this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper;this._renderContext.depth=this._linearDepthTextureHelper.framebuffer;this._renderContext.normals=this._normalTextureHelper.framebuffer;this._renderContext.highlight=this._highlightTextureHelper.framebuffer;
this._renderContext.options=this.renderOptions;c.offscreenRendering.enabled=!0;c.offscreenRendering.initializeFrame(h,g);this._renderPlugins.render(0,this._renderContext);this.renderGeometrySlotsPt1(this._renderContext);this._edgeView&&this.edgeView.shouldRender()&&c.offscreenRendering.renderSeparateAndComposite(function(){d._edgeView.render(d._bindParameters)},void 0,"alpha");l=b=!1;this.renderOptions.earlyOcclusionPixelDraw||(b=this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(21,
this._renderContext));(l=this.renderTransparentTerrain(this._renderContext))&&b&&(c.offscreenRendering.compositeTransparentTerrainOntoHUDVisibility(),c.offscreenRendering.renderToTargets(function(){return d.renderHUD("occluded")},c.offscreenRendering.mainColor,c.offscreenRendering.tmpDepth,void 0,!0));l&&c.offscreenRendering.compositeTransparentTerrainOntoMain();c.offscreenRendering.renderToTargets(function(){d._renderInternalSlot(9,d._renderContext);d._renderPlugins.render(17,d._renderContext);d._renderPlugins.render(18,
d._renderContext);d._renderOccluded(h,c.renderOccluded,c.offscreenRendering);c.slice&&c.slice.isEnabled&&(d._renderInternalSlot(10,d._renderContext),d._renderInternalSlot(11,d._renderContext),d._renderInternalSlot(12,d._renderContext),d._renderInternalSlot(13,d._renderContext))},c.offscreenRendering.mainColor,c.offscreenRendering.mainDepth);b=this.renderOptions.antialiasing;"smaa"===b&&this._smaaPass.loadResources(function(){d._needsRender=!0});"smaa"===b&&this._smaaPass.enable()?(this._fxaaPass.disable(),
this._smaaPass.render({colorTexture:c.offscreenRendering.colorTexture},g)):"fxaa"===b&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:c.offscreenRendering.colorTexture},g)):(c.offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable());e.bindFramebuffer(g);this._renderContext.framebufferTex=c.offscreenRendering.colorTexture;this.renderHUD("notOccluded");this._renderHighlights(a,c.highlight);this._isRendering=!1};f.prototype._renderGeometryPassOrderedHighlight=
function(a){this._renderInternalHighlights()};f.prototype._renderGeometryPassOrderedMaterial=function(a){for(var b=null,c=0;c<this._renderOrder.length;c++){var d=this._renderOrder[c][1];if(d.instanced){var e=d.instanced||d.merged,h=e[a.pass];h&&h.isVisible()&&(this._renderInternalInstanced(e,h,this._bindParameters,Infinity),b=null)}d.merged&&(e=d.merged,(h=e[a.pass])&&h.isVisible()&&(d=h.getProgram(),d!==b&&(d.setUniformMatrix4fv("model",P),d.hasUniform("modelNormal")&&d.setUniformMatrix4fv("modelNormal",
P)),b=d,this._renderInternalMerged(e,h,this._bindParameters,Infinity)))}};f.prototype._renderGeometryPassOrdered=function(a){var b=a.camera;this._bindParameters.view=b.viewMatrix;this._bindParameters.proj=b.projectionMatrix;this._bindParameters.viewInvTransp=b.viewInverseTransposeMatrix;F[0]=b.near;F[1]=b.far;this._bindParameters.nearFar=F;this._bindParameters.lightingData=a.lightingData;this._bindParameters.viewport=b.fullViewport;this._bindParameters.framebufferTex=this._framebuffer.texture;this._bindParameters.pixelRatio=
a.pixelRatio;this._bindParameters.slicePlane=a.sliceHelper&&a.sliceHelper.plane;a.isHighlightPass?this._renderGeometryPassOrderedHighlight(a):this._renderGeometryPassOrderedMaterial(a)};f.prototype._renderOrdered=function(a,b){this._stats.reset();this.renderGeometryPass(a,b)};f.prototype.prepareRender=function(a){this._renderPlugins.prepareRender(a);this._renderContext.rctx.setDepthFunction(513)};f.prototype.render=function(a,b){this._orderedRendering?this._renderOrdered(0,a):this._renderUnordered(a,
b.shadowMap,b)};f.prototype.renderAuxiliaryBuffers=function(a,b){var c=b.ssao,d=b.slice;b=b.shadowMap;var e=this.ssaoEnabled||this._renderPlugins.needsLinearDepth(),h=a.camera,g=a.fbo;if(this._linearDepthTextureHelper.enabled=e)this._linearDepthTextureHelper.setupFBOs(h),this._linearDepthTextureHelper.prepareDepthPass(),this.renderGeometryPass(1,a,b,c,d),this._linearDepthTextureHelper.finish(g);if(this._normalTextureHelper.enabled=this.ssaoEnabled)this._normalTextureHelper.setupFBOs(h),this._normalTextureHelper.prepareNormalPass(),
this.renderGeometryPass(2,a,b,c,d),this._normalTextureHelper.finish(g),c.computeSSAO(h,g,this._linearDepthTextureHelper.framebuffer,this._normalTextureHelper.framebuffer);c.bindAll(this._programRep)};f.prototype.renderGeometryPass=function(a,b,c,d,e){this._isRendering=!0;var h=b.camera;b=b.pixelRatio;this._updateGlobalUniforms(h.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=h;this._renderContext.pixelRatio=b;this._renderContext.shadowMap=c;this._renderContext.ssaoHelper=
d;this._renderContext.depth=this._linearDepthTextureHelper.framebuffer;this._renderContext.normals=this._normalTextureHelper.framebuffer;this._renderContext.sliceHelper=e;this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext);this._isRendering=!1};f.prototype._renderGeometryPassUnordered=function(a){this.renderGeometrySlots(a)};f.prototype._renderInternalHighlights=function(a){void 0===a&&(a=null);for(var b=!1,c=0;c<this._highlights.length;++c){var d=
this._highlights[c],e=d.matData[4];e&&(null===a||e.beginSlot(a))&&e.isVisible()&&(b=this._renderInternalHighlight(d,this._bindParameters,4)||b)}return b};f.prototype._renderInternalSlotOccluded=function(a,b){var c=!1,d;for(d in this._mat2DataInstanced){var e=this._mat2DataInstanced[d],h=e[b.pass];h&&h.renderOccluded&&h.beginSlot(a)&&h.isVisible()&&(c=this._renderInternalInstanced(e,h,this._bindParameters,a)||c)}return c};f.prototype._renderInternalSlotMaterial=function(a,b){var c=!1,d;for(d in this._mat2DataInstanced){var e=
this._mat2DataInstanced[d],h=e[b.pass];h&&h.beginSlot(a)&&h.isVisible()&&(c=this._renderInternalInstanced(e,h,this._bindParameters,a)||c)}for(var e=this._programRep.getProgramsUsingUniform("model"),h=this._programRep.getProgramsUsingUniform("modelNormal"),g=0;g<e.length;g++){var l=e[g];l.setUniformMatrix4fv("model",P);-1<h.indexOf(l)&&l.setUniformMatrix4fv("modelNormal",P)}for(d in this._mat2DataMerged)e=this._mat2DataMerged[d],(h=e[b.pass])&&h.beginSlot(a)&&h.isVisible()&&(c=this._renderInternalMerged(e,
h,this._bindParameters,a)||c);for(d in this._mat2DataPreinterleaved)e=this._mat2DataPreinterleaved[d],(h=e[b.pass])&&h.beginSlot(a)&&h.isVisible()&&(c=this._renderInternalPreinterleaved(e,h,this._bindParameters,a)||c);2===a&&this._stencilRenderingHelper.finish();return c};f.prototype._renderInternalSlotHighlights=function(a,b){return this._renderInternalHighlights(a)};f.prototype._renderInternalSlot=function(a,b){this._bindParameters.view=b.camera.viewMatrix;this._bindParameters.proj=b.camera.projectionMatrix;
this._bindParameters.viewInvTransp=b.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=b.camera.aboveGround;this._bindParameters.fovY=b.camera.fovY;F[0]=b.camera.near;F[1]=b.camera.far;var c=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=F;this._bindParameters.lightingData=b.lightingData;this._bindParameters.viewport=b.camera.fullViewport;this._bindParameters.framebufferTex=c?c.colorTexture:null;this._bindParameters.shadowMap=b.shadowMap;this._bindParameters.shadowMappingEnabled=
!!b.shadowMap&&b.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!b.ssaoHelper&&b.ssaoHelper.enabled;this._bindParameters.pixelRatio=b.pixelRatio;this._bindParameters.slicePlane=b.sliceHelper&&b.sliceHelper.plane;this._bindParameters.hudVisibilityTexture=c?c.hudVisibilityTexture:null;return b.isHighlightPass?this._renderInternalSlotHighlights(a,b):b.renderOccludedOnly?this._renderInternalSlotOccluded(a,b):this._renderInternalSlotMaterial(a,b)};f.prototype._renderInternalInstanced=function(a,b,
c,d){var e=this,h=this._rctx,g=h.gl,l=!1,m=b.getDrawMode(),k=h.capabilities.instancing,n=!1;a.origin2data.forEach(function(a){c.origin=a.origin;2===d&&(e._stencilRenderingHelper.enabled=!0,e._stencilRenderingHelper.prepareStencilWritePass());var f=!1;if(b.instanced)for(var q in a.perGeometryDataInfo){var r=a.perGeometryDataInfo[q];l||(b.bind(h,c),l=!0);h.bindVAO(r.vao);var u=b.getProgram();G.assertCompatibleVertexAttributeLocations(r.vao,u);f||(b.bindView(h,c),f=!0);var u=r.to-r.from,t=r.refCount;
m===g.TRIANGLES&&(e._stats.trianglesRendered+=t*u/3);k.drawArraysInstanced(m,r.from,u,t);n=!0;e._stats.drawCallsAngleInstanced++;e._stats.instancesDrawnAngle+=t}else a.instances.forEach(function(d){var k=d.displayedIndexRange;k&&0===k.length||(l||(b.bind(h,c),l=!0),f||(h.bindVAO(a.vao),b.bindView(h,c),f=!0),b.bindInstance(h,d),e._stats.drawCallsInstanced++,m===g.TRIANGLES&&(e._stats.trianglesRendered+=(d.to-d.from)/3),k?e._drawArraysFaceRange(k,d.from,m):h.drawArrays(m,d.from,d.to-d.from),n=!0)})});
h.bindVAO(null);l&&b.release(h,c);return n};f.prototype._renderInternalHighlight=function(a,b,c){var d=this._rctx,e=d.gl;c=a.matData[c];var h=c.getDrawMode(),g=a.instance,l=g.highlightedIndexRange,m=this._renderContext.offscreenRenderingHelper,m=(m?m.depthTexture:null)||this._getFallbackDepthTexture(),k=c.getProgram(),n=d.capabilities.instancing;b.origin=a.originData.origin;var f=!1;if(c.instanced&&a.type===Q.Instanced)for(a=a.instancedVAO,c.bind(d,b),d.bindVAO(a),G.assertCompatibleVertexAttributeLocations(a,
k),c.bindView(d,b),a=0;a<l.length;a++){var q=l[a],f=q.range?q.range[0]+g.from:g.from,q=q.range?q.range[1]-q.range[0]+1:g.to-g.from;d.bindTexture(m,5);k.setUniform1i("depthTex",5);k.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);n.drawArraysInstanced(h,f,q,1);h===e.TRIANGLES&&(this._stats.trianglesRendered+=1*q/3);this._stats.drawCallsHighlight++;f=!0}else if(a.type===Q.Instanced&&c.instanced)console.error("_renderInternalHighlight: incompatible instance type");
else{c.bind(d,b);c.bindView(d,b);n=null;switch(a.type){case Q.Merged:q=a.originData;d.bindVAO(q.vao);k.setUniformMatrix4fv("model",P);break;case Q.Instanced:q=a.originData;d.bindVAO(q.vao);c.bindInstance(d,g);break;case Q.Preinterleaved:q=a.originData,a=q.instances.get(a.uniqueName).vao,d.bindVAO(a),c.bindInstance(d,g),n=a.indexBuffer&&a.indexBuffer.indexType}for(a=0;a<l.length;a++){q=l[a];f=q.range?q.range[0]+g.from:g.from;q=q.range?q.range[1]-q.range[0]+1:g.to-g.from;d.bindTexture(m,5);c.getProgram().setUniform1i("depthTex",
5);k.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);if(n){var r=G.getBytesPerElement(n);d.drawElements(h,q,n,f*r)}else d.drawArrays(h,f,q);h===e.TRIANGLES&&(this._stats.trianglesRendered+=q/3);this._stats.drawCallsHighlight++;f=!0}}d.bindVAO(null);c.release(d,b);return f};f.prototype._drawArraysFaceRange=function(a,b,c){for(var d=this._rctx,e=0;e<a.length;e++){var h=a[e];d.drawArrays(c,h[0]+b,h[1]-h[0]+1)}this._stats.drawCallsFragmented+=
a.length-1};f.prototype._drawElementsFaceRange=function(a,b,c,d){for(var e=this._rctx,h=G.getBytesPerElement(d),g=0;g<a.length;g++){var l=a[g];e.drawElements(c,l[1]-l[0]+1,d,(l[0]+b)*h)}this._stats.drawCallsFragmented+=a.length-1};f.prototype._renderInternalMerged=function(a,b,c,d){var e=this,h=this._rctx,g=h.gl,l=!1,m=!1;a.origin2data.forEach(function(a){c.origin=a.origin;2===d&&(e._stencilRenderingHelper.enabled=!0,e._stencilRenderingHelper.prepareStencilWritePass());if(!a.displayedIndexRange||
0!==a.displayedIndexRange.length){m||(b.bind(h,c),m=!0);var k=b.getProgram();h.bindVAO(a.vao);G.assertCompatibleVertexAttributeLocations(a.vao,k);b.bindView(h,c);e._stats.drawCallsMerged++;k=b.getDrawMode();k===g.TRIANGLES&&(e._stats.trianglesRendered+=a.vao.vertexBuffers.geometry.size/3);a.displayedIndexRange?e._drawArraysFaceRange(a.displayedIndexRange,0,k):h.drawArrays(k,0,G.vertexCount(a.vao,"geometry"));l=!0}});m&&b.release(h,c);return l};f.prototype._renderInternalPreinterleaved=function(a,
b,c,d){var e=this,h=this._rctx,g=h.gl,l=!1,m=!1,k=b.getDrawMode();a.origin2data.forEach(function(a){c.origin=a.origin;var n=!1;2===d&&(e._stencilRenderingHelper.enabled=!0,e._stencilRenderingHelper.prepareStencilWritePass());a.instances.forEach(function(a){var d=a.instance,f=a.vao;a=d.displayedIndexRange;if(!a||0!==a.length){m||(b.bind(h,c),m=!0);var q=b.getProgram();G.assertCompatibleVertexAttributeLocations(f,q);h.bindVAO(f);n||(b.bindView(h,c),n=!0);b.bindInstance(h,d);e._stats.drawCallsPreinterleaved++;
k===g.TRIANGLES&&(e._stats.trianglesRendered+=(d.to-d.from)/3);f=f.indexBuffer&&f.indexBuffer.indexType;a?f?e._drawElementsFaceRange(a,d.from,k,f):e._drawArraysFaceRange(a,d.from,k):f?(a=G.getBytesPerElement(f),h.drawElements(k,d.to-d.from,f,d.from*a)):h.drawArrays(k,d.from,d.to-d.from);l=!0}})});h.bindVAO(null);m&&b.release(h,c);return l};f.prototype._updateGlobalUniforms=function(a){for(var b=this._programRep.getProgramsUsingUniform("proj"),c=0;c<b.length;c++)b[c].setUniformMatrix4fv("proj",a);
if(this._lighting){b=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c]);b=this._programRep.getProgramsUsingUniform("lightDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c])}};f.prototype.print=function(){var a=Object.keys(this._mat2DataMerged).length,b=Object.keys(this._mat2DataInstanced).length,c=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+
a+"/"+b+"/"+c);var d=0;S(this._mat2DataMerged,function(){},function(a,b){d+=b.instances.size});var e=0;S(this._mat2DataInstanced,function(){},function(a,b){e+=b.instances.size});var h=0;S(this._mat2DataPreinterleaved,function(){},function(a,b){h+=b.instances.size});console.log("number of instances (merged/instanced/preinterleaved): "+d+"/"+e+"/"+h)};f.prototype.isEmpty=function(){for(var a in this._mat2DataInstanced){var b=this._mat2DataInstanced[a];if(!k.everyMap(b.origin2data,function(a){return 0===
a.instances.size}))return!1}for(a in this._mat2DataMerged)if(b=this._mat2DataMerged[a],!k.everyMap(b.origin2data,function(a){return 0===a.instances.size}))return!1;for(a in this._mat2DataPreinterleaved)if(b=this._mat2DataPreinterleaved[a],!k.everyMap(b.origin2data,function(a){return 0===a.instances.size}))return!1;return!0};f.prototype.modify=function(a,b,c,d){this._isRendering&&console.warn("Renderer.modify called while rendering");var e=[],h=[],g=[];this._classifyRenderGeometry(a,e,h,g);a=[];var l=
[],m=[];this._classifyRenderGeometry(b,a,l,m);var k={};c&&this._performUpdates(c,k);c=[];this._modifyMerged(e,a,c,k);this._modifyInstanced(h,l,c);this._modifyPreinterleaved(g,m,c);this._updateMergedFaceranges(k);this._releaseMaterials(c);e=this._highlights.length;if(b&&0<b.length&&0<e&&(this._highlights=this._highlights.filter(function(a){return!b.some(function(b){return b.uniqueName===a.uniqueName})}),e!==this._highlights.length&&this.onHasHighlightsChanged))this.onHasHighlightsChanged(this.hasHighlights);
this._updateHighlightVAOs();d&&this._modifyMaterials(d);this._needsRender=!0};f.prototype._classifyRenderGeometry=function(a,b,c,d){for(var e=0;e<a.length;e++){var h=a[e];if(1<=M(h.data))switch(this._getType(h)){case Q.Merged:b.push(h);break;case Q.Instanced:c.push(h);break;case Q.Preinterleaved:d.push(h)}}};f.prototype._performUpdates=function(a,b){for(var c=0;c<a.length;c++){var d=a[c],e=d.updateType,d=d.renderGeometry,h=this._getType(d)===Q.Merged;if(1<=M(d.data)){e&2&&this._updateFaceranges(d,
b);if(e&32){var g=this._getInstance(d);g&&this._updateHighlightFaceranges(d,g.instance)}e&4||h&&e&16?this._updateVertexAttributes(d,!h):!h&&e&16&&this._updateInstanceTransformation(d)}}};f.prototype._updateFaceranges=function(a,b){var c=a.material.id,d=a.origin.id,e=this._getType(a),h;if(e===Q.Preinterleaved){var g=this._getOriginData(e,c,d);h=g.instances.get(a.uniqueName).instance}else g=this._getOriginData(e,c,d),(h=g.instances.get(a.uniqueName))&&e===Q.Merged&&(b[this._modifiedMergedFacerangesKey(c,
d)]=g);h&&(h.displayedIndexRange=I(a),this._updateHighlightFaceranges(a,h))};f.prototype._updateHighlightFaceranges=function(a,c){if(c){var d=c.highlightedIndexRange,e;e=a.instanceParameters.hidden?null:b.generateHighlightedIndexRanges(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets);(c.highlightedIndexRange=e)&&!d?this._addHighlight(a):!e&&d&&this._removeHighlight(a)}};f.prototype._updateMergedFaceranges=function(a){var b=function(b){var c=a[b];
c.displayedIndexRange=[];var d=!0;c.instances.forEach(function(a){a.displayedIndexRange?(c.displayedIndexRange.push.apply(c.displayedIndexRange,h.offsetIntervals(a.displayedIndexRange,a.from)),d=!1):c.displayedIndexRange.push([a.from,a.to-1])});c.displayedIndexRange=d?null:h.mergeIntervals(c.displayedIndexRange)},c;for(c in a)b(c)};f.prototype._updateVertexAttributes=function(a,b){var c=a.material,d=c.bufferWriter,e=c.id,h=a.origin.id,c=d.vertexBufferLayout.stride/4,g=this._getType(a);if(g===Q.Preinterleaved)console.error("Updating Preinterleaved geometry not supported");
else{var g=this._getOriginData(g,e,h),e=g.instances.get(a.uniqueName),h=g.buffer.getArray(),g=g.vao,l,m;b||(N(a,L,T),l=L,m=T);d.write({transformation:l,invTranspTransformation:m},a.data,a.instanceParameters,d.vertexBufferLayout.createView(h.buffer),e.from);x.assert(e.from+d.elementCount(a.data)===e.to,"material VBO layout has changed");g.vertexBuffers.geometry.setSubData(h,e.from*c*4,e.from*c*4,e.to*c*4)}};f.prototype._updateInstanceTransformation=function(a){var b=this._getType(a),c=a.material.id,
d=a.origin.id;b===Q.Preinterleaved?(b=this._getOriginData(b,c,d),d=b.instances.get(a.uniqueName).instance,N(a,d.transformation,d.transformationNormal)):(b=this._getOriginData(b,c,d),d=b.instances.get(a.uniqueName),b=b.perGeometryDataInfo[a.data.id],c=b.instanceBufferData,N(a,d.transformation,d.transformationNormal),c&&(a=c.getSlot(a.idx),c.fill(a,0,d.transformation),c.fill(a,16,d.transformationNormal),a=4*c.getOffset(a),d=G.getStride(b.vao.layout.instance),b.vao.vertexBuffers.instance.setSubData(c.getArray(),
a,a,a+d)))};f.prototype._modifyMerged=function(a,b,c,d){a=this._compMatToDelta(a,b,Q.Merged);b=this._mat2DataMerged;for(var e in a){var h=a[e],g;for(g in h){var l=h[g],m=l.optimalCount,k=l.sparseCount,n=l.material,f=n.bufferWriter.vertexBufferLayout,q=f.stride/4,r=b[e];null==r&&(x.assert(0<m),r=this._initializeMatData(n),b[e]=r,this._orderedRendering&&this._insertIntoRenderOrder(r,n.renderPriority,"merged"));var u=r.origin2data.get(g);null==u&&(x.assert(0<m),u=this._createMergedData(f,m,l.origin),
r.origin2data.set(g,u));if(0===m)u.vao.dispose(!0),u.vao=null,r.origin2data.delete(g),0===r.origin2data.size&&(c.push(e),delete b[e],this._orderedRendering&&this._removeFromRenderOrder(r,"merged"));else{var t=(f=m<l.sparseCount/2)?m:k,m=J,k=u.buffer.getSize(),r=u.buffer.getArray(),t=u.buffer.resize(t);f||t?this._rebuildMerged(u,l.toRemove,q,r,m):0<l.toRemove.length?(this._removeMergedByErasing(u,l.toRemove,q,m),0<l.toAdd.length&&(m.end=k)):(m.begin=k,m.end=k);f=K;x.setMatrixTranslation3(f,-l.origin[0],
-l.origin[1],-l.origin[2]);this._appendMerged(u,n,l.toAdd,q,f,m);l=u.vao.vertexBuffers.geometry;l.byteSize!==u.buffer.getArray().buffer.byteLength?l.setData(u.buffer.getArray()):(f=m.begin,n=m.end,f<n&&(q=u.buffer.getArray(),f*=4,l.setSubData(q,f,f,4*n)));if(m.updatedDisplayedIndexRange||u.displayedIndexRange)d[this._modifiedMergedFacerangesKey(e,g)]=u}}}};f.prototype._createMergedData=function(a,b,d){return{type:Q.Merged,instances:new Map,vao:new H(this._rctx,e.Default3D,{geometry:g.glLayout(a)},
{geometry:C.createVertex(this._rctx,35044)}),buffer:new c(b),optimalCount:0,origin:d}};f.prototype._rebuildMerged=function(a,b,c,d,e){for(var h=0;h<b.length;++h){var g=a.instances.get(b[h].uniqueName);a.optimalCount-=(g.to-g.from)*c;a.instances.delete(b[h].uniqueName)}var l=0,m=a.buffer.getArray();e.begin=0;e.end=0;var k=-1,n=-1,f=0;a.instances.forEach(function(a){var b=a.from*c,e=a.to*c,h=e-b;k!==n&&n!==b?(m.set(d.subarray(k,n),f),f+=n-k,k=b):-1===k&&(k=b);n=e;a.from=l/c;l+=h;a.to=l/c});k!==n&&m.set(d.subarray(k,
n),f);e.end=l};f.prototype._removeMergedByErasing=function(a,b,c,d){if(0!==b.length){d.begin=Infinity;d.end=-Infinity;for(var e=-1,h=-1,g=0;g<b.length;g++){var l=b[g].uniqueName,m=a.instances.get(l),k=m.from*c,m=m.to*c;e!==h&&h!==k?(a.buffer.erase(e,h),e=k):-1===e&&(e=k);h=m;a.instances.delete(l);a.optimalCount-=m-k;k<d.begin&&(d.begin=k);m>d.end&&(d.end=m)}e!==h&&a.buffer.erase(e,h)}};f.prototype._appendMerged=function(b,c,d,e,h,g){g.updatedDisplayedIndexRange=!1;c=c.bufferWriter;for(var l=0;l<d.length;l++){var m=
d[l],k=m.data;a.mat4.multiply(L,h,m.transformation);a.mat4.invert(T,L);a.mat4.transpose(T,T);var n=g.end;c.write({transformation:L,invTranspTransformation:T},k,m.instanceParameters,c.vertexBufferLayout.createView(b.buffer.getArray().buffer),g.end/e);var k=c.elementCount(k)*e,f=n+k;x.assert(null==b.instances.get(m.uniqueName));var q=I(m),n=new W(m.name,n/e,f/e,q,void 0,void 0,m.idx);b.instances.set(m.uniqueName,n);this._updateHighlightFaceranges(m,n);q&&(g.updatedDisplayedIndexRange=!0);b.optimalCount+=
k;g.end+=k}};f.prototype._modifyInstanced=function(b,d,h){var m=this._rctx,k=Q.Instanced;b=this._compMatToDelta(b,d,k);var n=this._mat2DataInstanced,f;for(f in b){var q=b[f];d=function(b){var d=q[b];if(0===d.optimalCount)return d=n[f],d.origin2data.get(b).vao.dispose(!0),d.origin2data.delete(b),0===d.origin2data.size&&(h.push(f),delete n[f],r._orderedRendering&&r._removeFromRenderOrder(d,"instanced")),"continue";var u=d.material,t=u.bufferWriter,w=n[f];if(null==w){var z=u.renderPriority,w=r._initializeMatData(u);
n[f]=w;r._orderedRendering&&r._insertIntoRenderOrder(w,z,"instanced")}var u=t.vertexBufferLayout,y=(z=w[0].instanced?t.instanceBufferLayout:void 0)&&z.fields.get("instanceColor"),B=z&&z.fields.get("instanceFeatureAttribute"),F=u.stride/4,L=w.origin2data.get(b);null==L&&(L={type:k,instances:new Map,vao:new H(m,e.Default3D,{geometry:g.glLayout(u)},{geometry:C.createVertex(m,35044)}),buffer:new c(d.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:d.origin},w.origin2data.set(b,L));b=L.buffer.getSize();
var D=L.buffer.getArray(),E=d.optimalCount<d.sparseCount/2,T=L.buffer.resize(E?d.optimalCount:d.sparseCount),p;for(p in d.perGeometryDelta)if((w=L.perGeometryDataInfo[p])&&w.instanceBufferData){var J=d.perGeometryDelta[p].removeCount;0<J&&w.instanceBufferData.prepareFree(J)}J=d.toRemove;if(E||T){for(E=0;E<J.length;++E){T=J[E];L.instances.delete(T.uniqueName);p=T.data.id;var G=w=L.perGeometryDataInfo[p];0===--G.refCount&&null==d.dataId2refCount[p]?(L.optimalCount-=(G.to-G.from)*F,delete L.perGeometryDataInfo[p]):
w.instanceBufferData&&w.instanceBufferData.free(T.idx)}b=0;var E=L.buffer.getArray(),T={},R;for(R in L.perGeometryDataInfo)G=L.perGeometryDataInfo[R],x.assert(null==T[G.from]),T[G.from]=G;for(var X in T)G=T[X],R=G.from*F,w=G.to*F,E.set(D.subarray(R,w),b),G.from=b/F,b+=w-R,G.to=b/F;L.instances.forEach(function(a){a.from=L.perGeometryDataInfo[a.dataId].from;a.to=L.perGeometryDataInfo[a.dataId].to})}else for(E=0;E<J.length;++E)T=J[E],L.instances.delete(T.uniqueName),p=T.data.id,w=L.perGeometryDataInfo[p],
0===--w.refCount&&null==d.dataId2refCount[p]?(R=w.from*F,w=w.to*F,L.buffer.erase(R,w),L.optimalCount-=w-R,delete L.perGeometryDataInfo[p]):w.instanceBufferData&&w.instanceBufferData.free(T.idx);x.setMatrixTranslation3(K,-d.origin[0],-d.origin[1],-d.origin[2]);for(p in d.perGeometryDelta)(w=L.perGeometryDataInfo[p])&&w.instanceBufferData&&(E=d.perGeometryDelta[p].addCount,0<E&&w.instanceBufferData.prepareAllocate(E));X=d.toAdd;for(E=0;E<X.length;++E)if(T=X[E],R=T.data,p=R.id,w=L.perGeometryDataInfo[p],
null==w?(t.write({},R,void 0,t.vertexBufferLayout.createView(L.buffer.getArray().buffer),b/F),D=t.elementCount(R)*F,R=b/F,b+=D,w=b/F,L.optimalCount+=D,w={refCount:1,from:R,to:w,vao:null,instanceBufferData:null},z&&(R=z.stride/4,w.vao=new H(m,e.Default3D,{geometry:g.glLayout(u),instance:g.glLayout(z,{divisor:1})},{geometry:L.vao.vertexBuffers.geometry,instance:C.createVertex(m,35044)}),w.instanceBufferData=new l(R,d.perGeometryDelta[p].addCount)),L.perGeometryDataInfo[p]=w):++w.refCount,x.assert(w.from*
F<=L.buffer.getSize()&&w.to*F<=L.buffer.getSize()),R=a.mat4f64.create(),a.mat4.multiply(R,K,T.transformation),D=I(T),R=new W(T.name,w.from,w.to,D,R,T.instanceParameters,T.idx,p),L.instances.set(T.uniqueName,R),r._updateHighlightFaceranges(T,R),w=w.instanceBufferData)D=w.allocate(T.idx),w.fill(D,0,R.transformation),w.fill(D,16,R.transformationNormal),y&&w.fill(D,y.offset/4,T.instanceParameters.color),B&&w.fill(D,B.offset/4,T.instanceParameters.featureAttribute);x.assert(L.optimalCount===d.optimalCount);
t=new Float32Array(L.buffer.getArray().buffer,0,L.buffer.getSize());L.vao.vertexBuffers.geometry.setData(t);for(p in L.perGeometryDataInfo)if(u=L.perGeometryDataInfo[p],u.vao&&(t=u.vao.vertexBuffers.instance))z=d.perGeometryDelta[p],0<z.addCount+z.removeCount&&(u=u.instanceBufferData.compact(),t.setData(u))};var r=this,u;for(u in q)d(u)}};f.prototype._modifyPreinterleaved=function(b,c,d){for(var h=this._rctx,l=Q.Preinterleaved,m=this._mat2DataPreinterleaved,k=0;k<b.length;k++){var n=b[k],f=n.material,
q=f.bufferWriter,r=f.id,u=n.origin.id,t=n.origin.vec3,w=m[r];null==w&&(w=this._initializeMatData(f),m[r]=w);r=w.origin2data.get(u);null==r&&(r={type:l,origin:t,count:0,instances:new Map},w.origin2data.set(u,r));x.setMatrixTranslation3(K,-t[0],-t[1],-t[2]);w=a.mat4f64.create();a.mat4.multiply(w,K,n.transformation);f=I(n);u=n.data;u.preinterleaved?null==u.vertexData?x.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available."):(w=new W(n.name,0,u.indexCount,f,w,n.instanceParameters,
n.idx,u.id),f=u.indexData?C.createIndex(h,35044,u.indexData):null,q=new H(h,e.Default3D,{geometry:g.glLayout(q.vertexBufferLayout)},{geometry:C.createVertex(h,35044)},f),q.vertexBuffers.geometry.setData(u.vertexData),u.indexData=null,u.vertexData=null,r.count+=1,r.instances.set(n.uniqueName,{instance:w,vao:q}),this._updateHighlightFaceranges(n,w)):x.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(b=0;b<c.length;b++)n=c[b],h=n.origin,f=n.material,r=f.id,u=h.id,n=n.uniqueName,
w=m[r],h=w.origin2data.get(u),h.instances.get(n).vao.dispose(),h.instances.delete(n),--h.count,0===h.count&&w.origin2data.delete(u),0===w.origin2data.size&&(d.push(r),delete m[r])};f.prototype._compMatToDelta=function(a,b,c){var d={};this._updateMatToDelta(a,!0,c,d);this._updateMatToDelta(b,!1,c,d);return d};f.prototype._updateMatToDelta=function(a,b,c,d){c=c===Q.Instanced;for(var e=0;e<a.length;e++){var h=a[e],g=h.origin,l=h.material,m=l.bufferWriter,k=l.id,n=c?this._mat2DataInstanced[k]:this._mat2DataMerged[k],
n=n&&n.origin2data.get(g.id),f=d[k];null==f&&(f={},d[k]=f);k=f[g.id];if(null==k){k={optimalCount:null==n?0:n.optimalCount,sparseCount:null==n?0:n.buffer.getSize(),material:l,toAdd:[],toRemove:[],perGeometryDelta:null,origin:g.vec3};if(c){l={};if(void 0!==n)for(var q in n.perGeometryDataInfo)l[q]=n.perGeometryDataInfo[q].refCount;k.dataId2refCount=l;k.perGeometryDelta={}}f[g.id]=k}g=m.vertexBufferLayout.stride/4;m=m.elementCount(h.data)*g;c?(g=h.data.id,l=k.perGeometryDelta[g],l||(l={addCount:0,removeCount:0},
k.perGeometryDelta[g]=l),b?(l.addCount++,null==k.dataId2refCount[g]&&(k.dataId2refCount[g]=0),1===++k.dataId2refCount[g]&&(k.optimalCount+=m,k.sparseCount+=m),k.toAdd.push(h)):(l.removeCount++,0===--k.dataId2refCount[g]&&(delete k.dataId2refCount[g],k.optimalCount-=m),k.toRemove.push(h))):b?(k.optimalCount+=m,k.sparseCount+=m,k.toAdd.push(h)):(k.optimalCount-=m,k.toRemove.push(h))}};f.prototype._getType=function(a){if(a.data.preinterleaved)return Q.Preinterleaved;var b=!1,c=M(a.data),b=(b=(b=b||!1===
a.material.canBeMerged)||a.material.instanced)||!0===a.material.renderOccluded;a.singleUse||(b=b||c>this._threshold);return b?Q.Instanced:Q.Merged};f.prototype._getTargetMat2Data=function(a){switch(a){case Q.Merged:return this._mat2DataMerged;case Q.Instanced:return this._mat2DataInstanced;case Q.Preinterleaved:return this._mat2DataPreinterleaved}};f.prototype._getOriginData=function(a,b,c){return this._getTargetMat2Data(a)[b].origin2data.get(c)};f.prototype._modifiedMergedFacerangesKey=function(a,
b){return a+"_"+b};f.prototype._insertIntoRenderOrder=function(a,b,c){for(var d=a[0].materialId,e=this._renderOrder.length,h=0;h<e&&this._renderOrder[h][0]>=b;){var g=this._renderOrder[h][1];if(g.id===d){x.assert(!g[c],"matData for type already exists");g[c]=a;return}h++}d={id:d,instanced:null,merged:null};d[c]=a;this._renderOrder.splice(h,0,[b,d])};f.prototype._removeFromRenderOrder=function(a,b){var c=a[0].materialId;for(a=0;this._renderOrder[a][1].id!==c;)a++;c=this._renderOrder[a][1];c[b]=null;
c.instanced||c.merged||this._renderOrder.splice(a,1)};f.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(a,b){a=a.matData[0].renderPriority;b=b.matData[0].renderPriority;return a>b?-1:b>a?1:0})};f.prototype._updateRenderOrder=function(a,b){for(var c=b.length,d=0;d<c&&b[d][1].id!==a;)d++;if(d<c){a=b[d][1];a=(a.merged||a.instanced)[0].renderPriority;var e=b[d][0];if(a!==b[d][0])for(b[d][0]=a,e=a>e?-1:1,d+=e;-1<d&&d<c&&e*b[d][0]>e*a;){var h=b[d];b[d]=b[d-e];b[d-e]=h;d+=
e}}};f.prototype._modifyMaterials=function(a){var b=this;a.forEach(function(a){b._materialRep.updateMaterialParameters(a)})};f.prototype.modifyRenderOrder=function(a){var b=this;this._orderedRendering&&(a.forEach(function(a){b._updateRenderOrder(a,b._renderOrder)}),this._sortHighlightsByRenderOrder(),this._needsRender=!0)};f.prototype._initializeMatData=function(a){var b={origin2data:new Map};b[0]=this._materialRep.aquire(a);b[3]=this._materialRep.aquireDepthShadowMap(a);b[2]=this._materialRep.aquireNormal(a);
b[1]=this._materialRep.aquireDepth(a);b[4]=this._materialRep.aquireHighlight(a);return b};f.prototype._releaseMaterials=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._materialRep.release(a[b]),this._materialRep.releaseDepthShadowMap(a[b]),this._materialRep.releaseNormal(a[b]),this._materialRep.releaseDepth(a[b]),this._materialRep.releaseHighlight(a[b]);else this._materialRep.release(a),this._materialRep.releaseDepthShadowMap(a),this._materialRep.releaseNormal(a),this._materialRep.releaseDepth(a),
this._materialRep.releaseHighlight(a)};f.prototype._getInstance=function(a){var b=a.uniqueName,c=a.material.id,d=this._getType(a),c=this._getTargetMat2Data(d)[c];if(!c)return null;a=c.origin2data.get(a.origin.id);if(!a)return null;var e;return(e=a.type===Q.Preinterleaved?a.instances.get(b).instance:a.instances.get(b))?{type:d,uniqueName:b,instance:e,matData:c,originData:a,instancedVAO:null,instancedVAOBaseInstance:null}:null};f.prototype._createBaseInstanceVAO=function(a){var b=this._rctx,c=a.instance,
d=a.originData;if(a.type===Q.Instanced&&d.perGeometryDataInfo){var d=d.perGeometryDataInfo[c.dataId],e=d.instanceBufferData;e&&(d=d.vao,c=e.getSlot(c.idx),a.instancedVAOBaseInstance!==c&&(e=G.setBaseInstanceOffset(d.layout,c),a.instancedVAO=new H(b,d.locations,e,d.vertexBuffers,d.indexBuffer),a.instancedVAOBaseInstance=c))}};f.prototype._updateHighlightVAOs=function(){for(var a=0;a<this._highlights.length;++a)this._createBaseInstanceVAO(this._highlights[a])};f.prototype._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||
(this._fallbackDepthStencilTexture=new E(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255])));return this._fallbackDepthStencilTexture};return f}();(function(a){var b=function(){function a(){this.reset()}a.prototype.reset=function(){this.VBOusedSize=this.VBOoptimalSize=this.VBOallocatedSize=this.instancesDrawnAngle=this.drawCallsHighlight=this.drawCallsFragmented=this.drawCallsPreinterleaved=this.drawCallsMerged=this.drawCallsAngleInstanced=
this.drawCallsInstanced=this.trianglesRendered=0};return a}();a.RenderStats=b})(p||(p={}));var O=p.RenderStats,W=function(){return function(b,c,d,e,h,g,l,m){this.name=b;this.from=c;this.to=d;this.displayedIndexRange=e;this.transformation=h;this.instanceParameters=g;this.idx=l;this.dataId=m;null!=h&&(this.transformationNormal=a.mat4f64.create(),a.mat4.copy(this.transformationNormal,h),a.mat4.invert(this.transformationNormal,this.transformationNormal),a.mat4.transpose(this.transformationNormal,this.transformationNormal))}}(),
Q;(function(a){a[a.Merged=0]="Merged";a[a.Instanced=1]="Instanced";a[a.Preinterleaved=2]="Preinterleaved"})(Q||(Q={}));var J={updatedDisplayedIndexRange:!1,begin:0,end:0},F=a.vec2f64.create(),K=a.mat4f64.create(),L=a.mat4f64.create(),T=a.mat4f64.create();return p})},"esri/views/3d/webgl-engine/lib/Float32ArrayList":function(){define(["require","exports","../../support/mathUtils"],function(p,f,k){return function(){function a(a){null==a?a=16:65536>a&&(a=k.nextHighestPowerOfTwo(a));this.array=new Float32Array(a);
this.size=0}a.prototype.resize=function(a,b){void 0===b&&(b=!1);this.size=a;var e;if(this.size>this.array.length){for(a=this.array.length||1;a<this.size;)a*=2;e=new Float32Array(a);b&&e.set(this.array);this.array=e;return!0}if(this.size<=this.array.length/2){a=this.array.length;for(e=2*this.size;a>=e;)a=Math.floor(a/2);e=new Float32Array(a);b&&e.set(this.array.subarray(0,a));this.array=e;return!0}return!1};a.prototype.append=function(a){var b=this.size;this.resize(this.size+a.length,!0);this.array.set(a,
b)};a.prototype.erase=function(a,b){for(;a<b;++a)this.array[a]=0};a.prototype.getArray=function(){return this.array};a.prototype.getSize=function(){return this.size};return a}()})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define(["require","exports","../../../webgl/BufferObject","../../../webgl/Program","../../../webgl/VertexArrayObject"],function(p,f,k,a,g){return function(){function b(a){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.vertexBufferLayout=[{name:"position",
count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}b.prototype.enable=function(){if(this.isEnabled)return!0;var b=this.rctx;this.program=new a(b,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);var c=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new g(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new k(b,34962,35044,c)});return this.isEnabled=!0};b.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};b.prototype.render=function(a,b){this.enable();var c=this.rctx;c.bindVAO(this.vao);c.bindFramebuffer(b);var e=0,g=0;null!=b?(e=b.descriptor.width,
g=b.descriptor.height):(e=c.gl.canvas.width,g=c.gl.canvas.height);c.bindProgram(this.program);c.bindTexture(a.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/e,1/g);c.setFaceCullingEnabled(!1);c.drawArrays(4,0,3)};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightTextureHelper":function(){define(["require","exports","../../../webgl/FramebufferObject"],function(p,f,k){return function(){function a(a){this._rctx=a;this.viewportToRestore=
this.fbo=null}a.prototype.dispose=function(){this.fbo&&(this.fbo.dispose(),this.fbo=null)};Object.defineProperty(a.prototype,"framebuffer",{get:function(){return this.fbo},enumerable:!0,configurable:!0});a.prototype.prepareHighlightPass=function(a){var b=this._rctx,e=b.gl;a=a.fullViewport;var c=a[2],d=a[3];this.updateFBO(c,d);this.viewportToRestore=a;this._rctx.setViewport(0,0,c,d);b.bindFramebuffer(this.fbo);b.setClearColor(0,0,0,0);b.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)};a.prototype.finish=
function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};a.prototype.updateFBO=function(a,b){this.fbo?this.fbo.resize(a,b):this.fbo=k.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:a,height:b},{colorTarget:0,depthStencilTarget:1})};return a}()})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports",
"../../core/has","./Renderbuffer","./Texture"],function(p,f,k,a,g){return function(){function b(e,c,d,m){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=e;this._desc={colorTarget:c.colorTarget,depthStencilTarget:c.depthStencilTarget,width:c.width,height:c.height,multisampled:c.multisampled};this._id=b._nextId++;d&&(e=void 0,d instanceof g?(this._colorAttachment=d,e=d.descriptor):(e=d,this._colorAttachment=new g(this._context,
e)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),b._validateTextureDimensions(e,this._desc));m instanceof a?(2===c.depthStencilTarget?this._stencilAttachment=m:1===c.depthStencilTarget||3===c.depthStencilTarget?this._depthAttachment=m:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),
b._validateBufferDimensions(m.descriptor,this._desc)):m&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),c=void 0,m instanceof g?(this._depthStencilTexture=m,c=this._depthStencilTexture.descriptor):(c=m,this._depthStencilTexture=new g(this._context,c)),b._validateTextureDimensions(c,this._desc))}b.create=function(a,c){return new b(a,c)};b.createWithAttachments=function(a,
c,d,g){return new b(a,d,c,g)};Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof g?this._colorAttachment:null},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this._context&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),
this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context=null)};b.prototype.attachColorTexture=function(a){if(a){b._validateTextureDimensions(a.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,a.glName,0)}this._colorAttachment=a}};b.prototype.detachColorTexture=function(){var a=void 0;if(this._colorAttachment instanceof
g){a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}this._colorAttachment=null}return a};b.prototype.attachDepthStencilTexture=function(a){if(a){var c=a.descriptor;34041!==c.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==c.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");
this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");b._validateTextureDimensions(c,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,c.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,a.glName,0));this._depthStencilTexture=
a}};b.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};b.prototype.attachDepthStencilBuffer=function(a){if(a){var c=a.descriptor;34041!==c.internalFormat&&33189!==c.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");
b._validateBufferDimensions(c,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===c.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,c.framebufferRenderbuffer(c.FRAMEBUFFER,1===this._desc.depthStencilTarget?c.DEPTH_ATTACHMENT:c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,a.glName));this._depthAttachment=a}};b.prototype.detachDepthStencilBuffer=function(){var a=this._context.gl,b=this._depthAttachment;b&&this._initialized&&
(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null));this._depthAttachment=null;return b};b.prototype.copyToTexture=function(a,b,d,g,l,h,k){(0>a||0>b||0>l||0>h)&&console.error("Offsets cannot be negative!");(0>=d||0>=g)&&console.error("Copy width and height must be greater than zero!");var c=this._desc,e=k.descriptor;3553!==k.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");
(a+d>c.width||b+g>c.height||l+d>e.width||h+g>e.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");c=this._context;c.bindTexture(k);c.bindFramebuffer(this);c.gl.copyTexSubImage2D(3553,0,l,h,a,b,d,g)};b.prototype.readPixels=function(a,b,d,g,l,h,k){(0>=d||0>=g)&&console.error("Copy width and height must be greater than zero!");k||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,
b,d,g,l,h,k)};b.prototype.resize=function(a,c){var d=this._desc;if(d.width!==a||d.height!==c)if(this._initialized)d.width=a,d.height=c,this._colorAttachment instanceof g?(e=this._colorAttachment,d=e.descriptor,d.width=a,d.height=c,this._colorAttachment.dispose(),this._colorAttachment=new g(this._context,d),b._validateTextureDimensions(e.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(d=this._depthStencilTexture.descriptor,d.width=a,d.height=
c,this._depthStencilTexture.dispose(),this._depthStencilTexture=new g(this._context,d)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1;else{d.width=a;d.height=c;if(this._colorAttachment instanceof g){var e=this._colorAttachment;e.resize(a,c)}this._depthStencilTexture&&this._depthStencilTexture.resize(a,c)}};b.prototype.initialize=function(){if(this._initialized)return!1;
var b=this._context.gl;this._glName&&b.deleteFramebuffer(this._glName);var c=b.createFramebuffer(),d=this._desc;b.bindFramebuffer(b.FRAMEBUFFER,c);if(!this._colorAttachment)if(0===d.colorTarget)this._colorAttachment=new g(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:d.width,height:d.height});else{var m=new a(this._context,{internalFormat:32854,width:d.width,height:d.height});b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,
m.glName);this._colorAttachment=m}this._colorAttachment instanceof g&&b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this._colorAttachment.glName,0);switch(d.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new a(this._context,{internalFormat:1===d.depthStencilTarget?33189:34041,width:d.width,height:d.height}));b.framebufferRenderbuffer(b.FRAMEBUFFER,1===d.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,this._depthAttachment.glName);
break;case 2:this._stencilAttachment||(this._stencilAttachment=new a(this._context,{internalFormat:36168,width:d.width,height:d.height}));b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new g(this._context,
{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:d.width,height:d.height})),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,this._depthStencilTexture.glName,0)}b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=c;return this._initialized=!0};b.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof g){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);
var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(a=this._colorAttachment,b=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=null};b.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;this._depthAttachment&&
(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&
(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};b._validateBufferDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};
b._validateTextureDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Color attachment texture must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};b._nextId=0;return b}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","../../core/has"],function(p,f,k){return function(){function a(g,
b){this._context=g;this._desc=b;this._glName=null;this._id=-1;g=this._context.gl;this._id=++a._nextId;this._glName=g.createRenderbuffer();this._context.bindRenderbuffer(this);g.renderbufferStorage(g.RENDERBUFFER,b.internalFormat,b.width,b.height)}Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",
{get:function(){return this._glName},enumerable:!0,configurable:!0});a.prototype.resize=function(a,b){var e=this._context.gl,c=this._desc;if(c.width!==a||c.height!==b)c.width=a,c.height=b,this._context.bindRenderbuffer(this),e.renderbufferStorage(e.RENDERBUFFER,c.internalFormat,c.width,c.height)};a.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);this._context=null};a._nextId=0;return a}()})},"esri/views/3d/webgl-engine/lib/InstanceBufferData":function(){define(["require",
"exports","../../support/mathUtils"],function(p,f,k){return function(){function a(a,b){null==b&&(b=4);var e=k.nextHighestPowerOfTwo(b*a);this.array=new Float32Array(e);this.zeroItem=new Float32Array(a);this.endSlot=0;this.perInstanceDataSize=a;this.emptySlots=[];this.emptySlotsIdx=0;this.id2slot={};this.slot2id=Array(b)}a.prototype.prepareFree=function(a){this.emptySlots.length+=a};a.prototype.free=function(a){a=this.id2slot[a];null!=a&&(this.emptySlots[this.emptySlotsIdx++]=a,this.slot2id[a]=void 0)};
a.prototype.prepareAllocate=function(a){a-=this.emptySlotsIdx;0<a&&this._resizeArray((this.endSlot+a)*this.perInstanceDataSize)};a.prototype.allocate=function(a){var b;b=0<this.emptySlotsIdx?this.emptySlots[--this.emptySlotsIdx]:this.endSlot++;this.id2slot[a]=b;this.slot2id[b]=a;return b};a.prototype.getSlot=function(a){return this.id2slot[a]};a.prototype.getOffset=function(a){return a*this.perInstanceDataSize};a.prototype.getArray=function(){return this.array};a.prototype.fill=function(a,b,e){this.array.set(e,
a*this.perInstanceDataSize+b)};a.prototype.compact=function(){if(0<this.emptySlotsIdx){this.emptySlots.length=this.emptySlotsIdx;for(this.emptySlots.sort(function(a,b){return a-b});0<this.emptySlotsIdx&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;0<this.emptySlotsIdx;){this.emptySlotsIdx--;var a=this.endSlot-1,b=this.emptySlots[this.emptySlotsIdx],e=a*this.perInstanceDataSize,c=b*this.perInstanceDataSize;this.array.set(this.array.subarray(e,e+this.perInstanceDataSize),
c);this.array.set(this.zeroItem,e);e=this.slot2id[a];this.slot2id[a]=void 0;this.slot2id[b]=e;this.id2slot[e]=b;this.endSlot--}}this._resizeArray(this.endSlot*this.perInstanceDataSize);this.emptySlots.length=0;return this.array};a.prototype._resizeArray=function(a){var b;if(a>this.array.length){for(b=this.array.length||1;b<a;)b*=2;a=new Float32Array(b);a.set(this.array);this.array=a}else if(a<=this.array.length/2){b=this.array.length;for(a*=2;b>=a;)b/=2;a=new Float32Array(b);a.set(this.array.subarray(0,
b));this.array=a}};return a}()})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(p,f){return function(){function k(){}k.copyIntervals=function(a){for(var g=[],b=0;b<a.length;b++){var e=a[b];g.push([e[0],e[1]])}return g};k.convertFaceToIndexRange=function(a,g){for(var b=0;b<a.length;b++){var e=a[b];e[0]*=g;e[1]=e[1]*g+(g-1)}};k.sortIntervals=function(a){return a.sort(function(a,b){return a[0]===b[0]?a[1]>b[1]?1:a[1]<b[1]?-1:0:a[0]>b[0]?1:a[0]<b[0]?
-1:0})};k.intersectIntervals=function(a,g){if(0>=a.length)return[];for(var b=[],e=0;e<a.length;e++){var c=a[e];c[1]<g[0]||c[0]>g[1]||(c=[c[0],c[1]],c[0]<g[0]&&(c[0]=g[0]),c[1]>g[1]&&(c[1]=g[1]),b.push(c))}return b};k.mergeIntervals=function(a){if(0>=a.length)return[];var g=[];a=this.sortIntervals(a);g.push(a[0]);for(var b=1;b<a.length;b++){var e=g[g.length-1];e[1]+1<a[b][0]?g.push(a[b]):e[1]<a[b][1]&&(e[1]=a[b][1],g.pop(),g.push(e))}return g};k.invertIntervals=function(a,g){for(var b=[],e=0,c=0;c<
a.length;c++){var d=a[c];d[0]>e&&b.push([e,d[0]-1]);e=d[1]+1}e<=g&&b.push([e,g]);return b};k.offsetIntervals=function(a,g){for(var b=[],e=0;e<a.length;e++){var c=a[e];b.push([c[0]+g,c[1]+g])}return b};return k}()})},"esri/views/3d/webgl-engine/lib/LinearDepthTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],function(p,f,k,a){return function(){function g(a){this._rctx=a;this._depthFBO=void 0;this.height=this.width=this.viewportToRestore=null}Object.defineProperty(g.prototype,
"enabled",{get:function(){return void 0!==this._depthFBO},set:function(a){a!==this.enabled&&(a?this.enable():this.disable())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"framebuffer",{get:function(){return this._depthFBO},enumerable:!0,configurable:!0});g.prototype.setupFBOs=function(a){k.assert(this.enabled);this.viewportToRestore=a=a.fullViewport;this.width=a[2];this.height=a[3];this._rctx.setViewport(0,0,this.width,this.height)};g.prototype.prepareDepthPass=function(){k.assert(this.enabled);
var a=this._rctx,e=a.gl;this._depthFBO.resize(this.width,this.height);a.bindFramebuffer(this._depthFBO);a.setClearStencil(0);a.setClearColor(0,0,0,0);a.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);a.setBlendingEnabled(!1)};g.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};g.prototype.enable=function(){k.assert(!this.enabled);this._depthFBO=
a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})};g.prototype.disable=function(){k.assert(this.enabled);this._depthFBO.dispose();this._depthFBO=void 0};return g}()})},"esri/views/3d/webgl-engine/lib/NormalTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],function(p,f,k,a){return function(){function g(a){this.rctx=a;this.normalFBO=void 0;
this.height=this.width=this.viewportToRestore=null}Object.defineProperty(g.prototype,"enabled",{get:function(){return void 0!==this.normalFBO},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"framebuffer",{get:function(){return this.normalFBO},enumerable:!0,configurable:!0});g.prototype.setupFBOs=function(a){k.assert(this.enabled);this.viewportToRestore=a=a.fullViewport;this.width=a[2];this.height=a[3];this.rctx.setViewport(0,0,this.width,
this.height)};g.prototype.prepareNormalPass=function(){k.assert(this.enabled);var a=this.rctx,e=a.gl;this.normalFBO.resize(this.width,this.height);a.bindFramebuffer(this.normalFBO);a.setClearColor(0,0,0,0);a.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)};g.prototype.finish=function(a){var b=this.rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};g.prototype.enable=function(){this.enabled||(this.normalFBO=
a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))};g.prototype.disable=function(){this.enabled&&(this.normalFBO.dispose(),this.normalFBO=void 0)};return g}()})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports"],function(p,f){return function(){function k(){this.camera=null;this.pixelRatio=1;this.normals=this.lightingData=this.highlight=this.depth=
null;this.pass=0;this.shadowMap=null;this.slot=0;this.options=this.rctx=this.framebufferTex=this.stencilRenderingHelper=this.sliceHelper=this.offscreenRenderingHelper=this.ssaoHelper=null;this.renderOccludedOnly=!1}Object.defineProperty(k.prototype,"isHighlightPass",{get:function(){return 4===this.pass},enumerable:!0,configurable:!0});return k}()})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["require","exports","./depthRange"],function(p,f,k){Object.defineProperty(f,"__esModule",
{value:!0});p=function(){function g(a){this.pluginContext=a;this.pluginsChanged=!1;this.renderPlugins=[];this.slots=[];for(a=0;23>a;++a)this.slots[a]=[]}g.prototype.add=function(a,e){this.renderPlugins.push(e);for(var b=0;b<a.length;++b)this.slots[a[b]].push(e);e.initializeRenderContext(this.pluginContext);this.pluginsChanged=!0};g.prototype.remove=function(a){this.renderPlugins=this.renderPlugins.filter(function(b){return b!==a});for(var b=0;b<this.slots.length;++b)this.slots[b]=this.slots[b].filter(function(b){return b!==
a});a.uninitializeRenderContext(this.pluginContext);this.pluginsChanged=!0};g.prototype.prepareRender=function(a){for(var b=0,c=this.renderPlugins;b<c.length;b++){var d=c[b];d.prepareRender&&d.prepareRender(a)}};g.prototype.render=function(a,e){e.slot=a;var b=!1,d=0;for(a=this.slots[a];d<a.length;d++){var g=a[d];g.render(e)&&(b=g.didRender=!0)}return b};g.prototype.queryDepthRange=function(b){var e=a;e.near=Infinity;e.far=-Infinity;for(var c=0,d=this.renderPlugins;c<d.length;c++){var g=d[c];g.queryDepthRange&&
(g=g.queryDepthRange(b))&&k.union(e,g,e)}return e};g.prototype.needsRender=function(){if(this.pluginsChanged)return!0;for(var a=0,e=this.renderPlugins;a<e.length;a++)if(e[a].needsRender)return!0;return!1};g.prototype.needsHighlight=function(){for(var a=0,e=this.renderPlugins;a<e.length;a++)if(e[a].needsHighlight)return!0;return!1};g.prototype.needsLinearDepth=function(){for(var a=0,e=this.renderPlugins;a<e.length;a++)if(e[a].needsLinearDepth)return!0;return!1};g.prototype.resetNeedsRender=function(){this.pluginsChanged=
!1;for(var a=0,e=this.renderPlugins;a<e.length;a++){var c=e[a];c.resetNeedsRender?c.resetNeedsRender():c.didRender&&(c.needsRender=!1,c.didRender=!1)}};return g}();f.RenderPluginManager=p;var a={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["require","exports"],function(p,f){function k(a,b){return{near:a,far:b}}function a(a,b,e){a.near=b;a.far=e;return a}Object.defineProperty(f,"__esModule",{value:!0});f.create=k;f.empty=function(g){return g?a(g,Infinity,-Infinity):
k(Infinity,-Infinity)};f.set=a;f.union=function(a,b,e){void 0===e&&(e=a);e.near=Math.min(a.near,b.near);e.far=Math.max(a.far,b.far);return e}})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(p,f,k,a,g,b,e,c){return function(){function d(a){this.isEnabled=this._isLoadingResources=
!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}d.prototype.loadResources=function(a){var b=this;return this.data?!0:(this._isLoadingResources=!0,p(["./SmaaRenderPassData"],function(c){b.data=c;b._isLoadingResources=!1;a&&a()}),!1)};Object.defineProperty(d.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0});d.prototype.enable=function(){if(this.isEnabled)return!0;
if(!this.loadResources())return!1;var d=this.rctx;this.programEdgeDetect=new b(d,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new b(d,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new b(d,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);var e=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new c(d,this.vertexAttributeLocations,
{geometry:this.vertexBufferLayout},{geometry:new a(d,34962,35044,e)});this.tmpFramebufferEdges=g.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.tmpFramebufferBlend=g.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,
9729,6407);this.textureSearch=this.loadTextureFromBase64(this.data.searchTexure,9728,6409);return this.isEnabled=!0};d.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),
this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};d.prototype.render=function(a,b){this.enable();var c=this.rctx,d=0,e=0;null!=b?(d=b.descriptor.width,e=b.descriptor.height):(d=c.gl.canvas.width,e=c.gl.canvas.height);c.bindVAO(this.vao);c.setFaceCullingEnabled(!0);c.setCullFace(1029);c.setFrontFace(2305);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!1);c.setViewport(0,0,d,e);this.tmpFramebufferEdges.resize(d,e);c.bindFramebuffer(this.tmpFramebufferEdges);
c.setClearColor(0,0,0,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programEdgeDetect);c.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/d,1/e,d,e);c.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(d,e);c.bindFramebuffer(this.tmpFramebufferBlend);c.setClearColor(0,0,1,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/d,1/e,d,e);c.bindTexture(this.textureSearch,
1);this.programBlendWeights.setUniform1i("tSearch",1);c.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);c.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);c.drawArrays(4,0,3);c.bindFramebuffer(b);c.setClearColor(0,1,0,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/d,1/e,d,e);c.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);
c.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);c.drawArrays(4,0,3);c.setDepthTestEnabled(!0)};d.prototype.loadTextureFromBase64=function(a,b,c){var d=new e(this.rctx,{pixelFormat:c,dataType:5121,wrapMode:33071,samplingMode:b},null);k.requestImage(a).then(function(a){d.resize(a.width,a.height);d.setData(a)});return d};return d}()})},"esri/views/3d/webgl-engine/lib/StencilRenderingHelper":function(){define(["require","exports","./Util"],function(p,
f,k){return function(){function a(a){this._enabled=!1;this._rctx=a}Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});a.prototype.prepareStencilWritePass=function(){k.assert(this.enabled);var a=this._rctx;a.setStencilFunction(519,1,255);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255)};a.prototype.finish=function(){if(this.enabled){var a=this._rctx;a.setStencilFunction(519,0,0);
a.setStencilOp(7680,7680,7680)}};a.prototype.enableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(517,1,255)};a.prototype.disableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(519,0,0)};a.prototype.enable=function(){this._enabled=!0;this._rctx.setStencilTestEnabled(!0)};a.prototype.disable=function(){this._enabled=!1;this._rctx.setStencilTestEnabled(!1)};return a}()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../core/requireUtils ../../../../../core/workers ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/typedArrayUtil ../../../support/buffer/utils ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../PreinterleavedGeometryData ../TextureBackedBuffer/BufferManager ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject module".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H,I){Object.defineProperty(f,"__esModule",{value:!0});var N=function(){function f(a,b,c){this.rctx=a;this.programRepository=b;this.callbacks=c;this.profilingCallback=null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new r.LocalOriginManager(new t);this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new B;this.workerThread=null;this.destroyed=!1;this.tmpModelPosition=m.vec3f64.create();this.tmpCameraPosition=
m.vec3f64.create();this.componentColorManager=new x.BufferManager(this.rctx,2)}f.prototype.initialize=function(){var a=this;d.open(c.getAbsMid("./EdgeProcessingWorker",p,I)).then(function(b){a.destroyed?b.close():a.workerThread=b});for(var b=z.VertexLayout.createBuffer(4),e=0;4>e;e++)b.sideness.set(e,0,0===e||3===e?0:1),b.sideness.set(e,1,0===e||1===e?0:1);this.verticesBufferObject=G.createVertex(this.rctx,35044,b.buffer)};f.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),
this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)};f.prototype.getGpuMemoryUsage=function(){return this.gpuMemoryUsage};Object.defineProperty(f.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0});f.prototype.shouldRender=function(){return 0<this.renderers.size};f.prototype.addObject=function(b,c,d,h){return a(this,void 0,void 0,function(){var a,
l,m,k,f,n,q;return g(this,function(g){switch(g.label){case 0:if(this.hasObject(b))return[2];a=[];m={loaded:e.create(function(a){return l=a}),renderables:[]};this.perObjectData.set(b,m);if(h&&h.mergeGeometries&&1<b.geometries.length&&this.canMergeGeometries(b))a.push(this.addObjectMergedGeometries(b,m,c,d));else for(k=0;k<b.geometries.length;k++)f=b.geometries[k],n=b.geometryRecords[k],q=n.material,q.supportsEdges&&(f.data instanceof y?a.push(this.addGeometryPreinterleaved(b,m,f,f.data,n,c,d)):a.push(this.addGeometryNonPreinterleaved(b,
m,f,f.data,n,c[0],d)));return[4,e.all(a)];case 1:return g.sent(),this.callbacks.setNeedsRender(),l(),[2]}})})};f.prototype.hasObject=function(a){return this.perObjectData.has(a)};f.prototype.updateAllComponentOpacities=function(b,c){return a(this,void 0,void 0,function(){var a,d;return g(this,function(e){switch(e.label){case 0:return[4,this.getObjectEntry(b)];case 1:return a=e.sent(),d=c instanceof Array?function(a){return c[a]}:function(a){return c},a.renderables.forEach(function(a){for(var b=a.components.meta.length,
c=0;c<b;c++){var e=d(c),h=a.components.meta[c],g=h.index;h.material.opacity=e;a.components.buffer.textureBuffer.setDataElement(g,1,3,255*e)}a.allTransparent=E.determineAllTransparent(a.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})};f.prototype.updateAllComponentMaterials=function(b,c,d,e){void 0===e&&(e=!0);return a(this,void 0,void 0,function(){var a,h,l=this;return g(this,function(g){switch(g.label){case 0:return[4,this.getObjectEntry(b)];case 1:return a=g.sent(),h=d.slicePlaneEnabled||
!1,a.renderables.forEach(function(a){var b=c[0],d=E.determineRequiresUberRenderer(c),g=C.EdgeRenderer.getKey(d,b.type,h);if(g!==a.rendererKey){var m=l.renderers.get(a.rendererKey),b=l.acquireRenderer(d,b,h);m.removeRenderable(a);m.refCount.decrement();a.rendererKey=g;b.addRenderable(a)}for(g=0;g<c.length;g++)a.components.meta[g].material=c[g];e&&l.updateComponentBuffer(a.components);a.allTransparent=E.determineAllTransparent(a.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})};f.prototype.updateObjectVisibility=
function(b,c){return a(this,void 0,void 0,function(){var a;return g(this,function(d){switch(d.label){case 0:return[4,this.getObjectEntry(b)];case 1:return a=d.sent(),a.renderables.forEach(function(a){a.visible=c}),this.callbacks.setNeedsRender(),[2]}})})};f.prototype.removeObject=function(a){var b=this,c=this.perObjectData.get(a);c&&(this.perObjectData.delete(a),c.loaded.then(function(){c.renderables.forEach(function(a){b.removeRenderable(a)});b.callbacks.setNeedsRender()}))};f.prototype.getObjectEntry=
function(b){return a(this,void 0,void 0,function(){var a;return g(this,function(c){switch(c.label){case 0:a=this.perObjectData.get(b);if(!a)throw"no object";return[4,a.loaded];case 1:return c.sent(),[2,a]}})})};f.prototype.removeAll=function(){var a=this;this.perObjectData.forEach(function(b,c){a.removeObject(c)})};f.prototype.createSolidEdgeMaterial=function(a){return k({},S,a,{type:"solid"})};f.prototype.createSketchEdgeMaterial=function(a){return k({},M,a,{type:"sketch"})};f.prototype.render=function(a){var b=
this;this.localOrigins.updateViewMatrices(a.view);this.renderers.forEach(function(a){0===a.refCount.value&&(b.renderers.delete(a.key),a.dispose())});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();var c=a.view,d=0,e=0;this.renderers.forEach(function(a){a.forEachRenderable(function(a){d+=a.statistics.averageEdgeLength;e++})});var h={distanceFalloffFactor:d/e*40,minimumEdgeLength:E.estimateLengthAtDistance(a.viewport[3],a.fovY,1,3.5)},g=this.rctx.capabilities.blendMinMax;
g?(this.rctx.setDepthWriteEnabled(!1),this.rctx.setBlendingEnabled(!0),this.rctx.setBlendEquationSeparate(32774,g.MAX),this.rctx.setBlendFunctionSeparate(1,0,1,1)):(this.rctx.setDepthWriteEnabled(!0),this.rctx.setBlendingEnabled(!1));this.rctx.setDepthTestEnabled(!0);this.rctx.setDepthFunction(515);this.updateObjectCameraDistances(a);this.numberOfRenderedEdges=0;this.renderers.forEach(function(c){b.renderRegularEdges(c,a,h);b.renderSilhouetteEdges(c,a,h)});this.rctx.setDepthWriteEnabled(!0);this.rctx.setDepthFunction(513);
this.rctx.setBlendEquationSeparate(32774,32774);this.rctx.setBlendFunctionSeparate(1,0,1,1);a.view=c};f.prototype.computeModelTransformWithLocalOrigin=function(a,b,c){a.getCombinedStaticTransformation(b,c);b.origin?this.localOrigins.register(b.origin):(a=m.vec3.set(this.tmpModelPosition,c[12],c[13],c[14]),b.origin=this.localOrigins.aquire(a));u.applyToModelMatrix(b.origin.vec3,c);return c};f.prototype.updateComponentBuffer=function(a){var b=a.meta;a=a.buffer;for(var c=0;c<b.length;c++){var d=b[c].material,
e=b[c].index,h=l.clamp(Math.round(d.size*C.LINE_WIDTH_FRACTION_FACTOR),0,255),g=l.clamp(d.extensionLength,-C.EXTENSION_LENGTH_OFFSET,255-C.EXTENSION_LENGTH_OFFSET)+C.EXTENSION_LENGTH_OFFSET,m="solid"===d.type?0:1,k=255*d.opacity,d=d.color;a.textureBuffer.setData(e,0,255*d[0],255*d[1],255*d[2],255*d[3]);a.textureBuffer.setData(e,1,h,g,m,k)}};f.prototype.createComponentBuffers=function(a){for(var b=[],c=this.componentColorManager.getBuffer(a.length),d=0;d<a.length;d++){var e=a[d],h=c.aquireIndex();
b.push({index:h,material:e})}a={meta:b,buffer:c};this.updateComponentBuffer(a);return a};f.prototype.extractEdges=function(a,b,c,d){return this.worker.process({data:b,originalIndices:d,writerSettings:a,skipDeduplicate:c},this.workerThread)};f.prototype.createEdgeResources=function(a){var b={};if(0<a.regular.lodInfo.lengths.length){var c=new H(this.rctx,z.EdgeShaderAttributeLocations,{vertices:z.glVertexLayout,instances:w.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:G.createVertex(this.rctx,
35044,a.regular.instancesData.buffer)});b.regular={vao:c,lod:a.regular.lodInfo}}0<a.silhouette.lodInfo.lengths.length&&(c=new H(this.rctx,z.EdgeShaderAttributeLocations,{vertices:z.glVertexLayout,instances:w.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:G.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),b.silhouette={vao:c,lod:a.silhouette.lodInfo});return b};f.prototype.disposeEdgeResources=function(a){a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),
a.regular.vao.dispose(!1),a.regular.vao=null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),a.silhouette.vao.dispose(!1),a.silhouette.vao=null)};f.prototype.addGeometryNonPreinterleaved=function(b,c,d,e,h,l,k){return a(this,void 0,void 0,function(){var a,d,f,n;return g(this,function(g){switch(g.label){case 0:return a=e.getAttribute("position"),d=this.computeModelTransformWithLocalOrigin(b,h,m.mat4f64.create()),f=h.origin,n={position:a,indices:e.getIndices("position"),modelTransform:d,
origin:f},[4,this.addNonPreinterleaved(b,c,n,l,k)];case 1:return g.sent(),[2]}})})};f.prototype.addNonPreinterleaved=function(b,c,d,e,h){return a(this,void 0,void 0,function(){var a,b,l,m,k,f,n,q,r,u,t,w,y,B,x;return g(this,function(g){switch(g.label){case 0:a=this.acquireRenderer(!1,e,h.slicePlaneEnabled||!1);b=d.modelTransform;l=d.origin;m=d.indices;k=d.position;f=k.data.length/k.strideIdx;n=z.EdgeInputBufferLayout.createBuffer(f);for(q=0;q<f;q++)n.position.set(q,0,k.data[k.offsetIdx+q*k.strideIdx+
0]),n.position.set(q,1,k.data[k.offsetIdx+q*k.strideIdx+1]),n.position.set(q,2,k.data[k.offsetIdx+q*k.strideIdx+2]);r=this.createComponentBuffers([e]);E.fillComponenBufferIndices(r.meta,[0,n.componentIndex.count],n.componentIndex);return[4,this.extractEdges(a.writerSettings,n,!1,m)];case 1:return u=g.sent(),t=this.createEdgeResources(u),w=t.regular,y=t.silhouette,B=(w?w.vao.size:0)+(y?y.vao.size:0),x={regular:w,silhouette:y,transform:{modelMatrix:b,origin:l},statistics:{gpuMemoryUsage:B,averageEdgeLength:u.averageEdgeLength},
components:r,visible:!0,allTransparent:E.determineAllTransparent(r.meta),distanceToCamera:0,rendererKey:a.key},c.renderables.push(x),a.addRenderable(x),this.gpuMemoryUsage+=B,[2]}})})};f.prototype.addGeometryPreinterleaved=function(b,c,d,e,l,k,f){return a(this,void 0,void 0,function(){var a,d,r,u,t,w,y,B,x,F,L,C,K,D,p,G,J;return g(this,function(g){switch(g.label){case 0:a=e.getAttribute("position");if(!a||!n.isFloat32Array(a.data))return console.warn("Geometry has no float32 `position` attribute, skipping it."),
[2];d=k[0];r=E.determineRequiresUberRenderer(k);u=this.acquireRenderer(r,d,f.slicePlaneEnabled||!1);t=this.computeModelTransformWithLocalOrigin(b,l,m.mat4f64.create());w=l.origin;y=e.getIndices("position");B=new h.BufferViewVec3f(a.data.buffer,4*a.offsetIdx,4*a.strideIdx);x=z.EdgeInputBufferLayout.createBuffer(B.count);q.vec3.copy(x.position,B);F=this.createComponentBuffers(k);E.fillComponenBufferIndices(F.meta,e.componentOffsets,x.componentIndex,y);L=e.hasPositionData;return[4,this.extractEdges(u.writerSettings,
x,L,y)];case 1:return C=g.sent(),K=this.createEdgeResources(C),D=K.regular,p=K.silhouette,G=(D?D.vao.size:0)+(p?p.vao.size:0),J={regular:D,silhouette:p,transform:{modelMatrix:t,origin:w},statistics:{gpuMemoryUsage:G,averageEdgeLength:C.averageEdgeLength},components:F,visible:!b.isHidden(l),allTransparent:E.determineAllTransparent(F.meta),distanceToCamera:0,rendererKey:u.key},c.renderables.push(J),u.addRenderable(J),this.gpuMemoryUsage+=G,[2]}})})};f.prototype.canMergeGeometries=function(a){for(var c=
null,d=null,e=0;e<a.geometries.length;e++){var h=a.geometryRecords[e];if(h.material.supportsEdges){if(a.geometries[e].data instanceof y)return!1;if(!c)c=h.transformation;else if(!b.equals(c,h.transformation))return!1;if(!d&&h.origin)d=h;else if(d&&h.origin&&d.origin.id!==h.origin.id)return!1}}return!0};f.prototype.addObjectMergedGeometries=function(b,c,d,e){return a(this,void 0,void 0,function(){var a,h,l,k,f,q,r,u,t,w,z,y,B,x,C,D,E,p,G,J,H;return g(this,function(g){switch(g.label){case 0:a=new Map;
h=0;k=l=null;for(f=0;f<b.geometries.length;f++)if(q=b.geometries[f],r=b.geometryRecords[f],u=r.material,u.supportsEdges&&(!k&&r.origin&&(k=r),t=q.data.getIndices("position"),h+=t?t.length:0,t&&null==l||l===Uint16Array))l=n.isUint16Array(t)?Uint16Array:Uint32Array;w=h?new l(h):null;z=[];for(f=y=0;f<b.geometries.length;f++)if(q=b.geometries[f],B=b.geometryRecords[f],u=B.material,u.supportsEdges){x=q.data.getAttribute("position");t=q.data.getIndices("position");C=a.get(x.data);if(null==C){C=z.length/
3;for(D=x.offsetIdx;D<x.data.length;D+=x.strideIdx)z.push(x.data[D+0]),z.push(x.data[D+1]),z.push(x.data[D+2]);a.set(x.data,C)}if(t)for(E=0;E<t.length;E++)w[y++]=C+t[E]}p=k||b.geometryRecords[0];G=this.computeModelTransformWithLocalOrigin(b,p,m.mat4f64.create());J=p.origin;for(f=0;f<b.geometryRecords.length;f++)b.geometryRecords[f].origin=J;H={position:{data:z,offsetIdx:0,strideIdx:3},indices:w,modelTransform:G,origin:J};return[4,this.addNonPreinterleaved(b,c,H,d[0],e)];case 1:return g.sent(),[2]}})})};
f.prototype.acquireRenderer=function(a,b,c){var d=C.EdgeRenderer.getKey(a,b.type,c),e=this.renderers.get(d);this.strokesTexture||(this.strokesTexture=D.generateStrokesTexture(this.rctx));e||(e=new C.EdgeRenderer(this.rctx,this.programRepository,{type:b.type,slicePlaneEnabled:c,strokesTexture:this.strokesTexture,uber:a}),this.renderers.set(d,e));e.refCount.increment();return e};f.prototype.removeRenderable=function(a){var b=this.renderers.get(a.rendererKey);b.removeRenderable(a);b.refCount.decrement();
this.disposeEdgeResources(a);this.localOrigins.release(a.transform.origin);this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;for(var b=0,c=a.components.meta;b<c.length;b++)a.components.buffer.releaseIndex(c[b].index)};f.prototype.updateObjectCameraDistances=function(a){var b=this;a=a.viewInvTransp;m.vec3.set(this.tmpCameraPosition,a[3],a[7],a[11]);this.perObjectData.forEach(function(a,c){var d=m.vec3.distance(c.getCenter(),b.tmpCameraPosition);a.renderables.forEach(function(a){return a.distanceToCamera=
d})})};f.prototype.renderRegularEdges=function(a,b,c){var d=this;a.bindRegularEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.regular&&!e.allTransparent){var h=E.computeEdgeCount(e.regular.lod.lengths,e.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(e.transform.origin);a.renderRegularEdges(e,b,h);d.numberOfRenderedEdges+=h}})};f.prototype.renderSilhouetteEdges=function(a,b,c){var d=this;a.bindSilhouetteEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.silhouette&&!e.allTransparent){var h=
E.computeEdgeCount(e.silhouette.lod.lengths,e.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(e.transform.origin);a.renderSilhouetteEdges(e,b,h);d.numberOfRenderedEdges+=h}})};return f}();f.EdgeView=N;var S={color:m.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1},M={color:m.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1}})},"esri/views/3d/support/buffer/utils":function(){define("require exports ./types ./utils/mat3 ./utils/mat4 ./utils/scalar ./utils/vec2 ./utils/vec3 ./utils/vec4".split(" "),
function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,"__esModule",{value:!0});f.mat3=a;f.mat4=g;f.scalar=b;f.vec2=e;f.vec3=c;f.vec4=d;f.createBuffer=function(a,b){return new a(new ArrayBuffer(b*a.ElementCount*k.elementTypeSize(a.ElementType)))}})},"esri/views/3d/support/buffer/utils/mat3":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.copy=function(k,a,g){var b=k.typedBuffer;k=k.typedBufferStride;var e=a.typedBuffer,c=a.typedBufferStride;a=
g?g.count:a.count;var d=(g&&g.dstIndex?g.dstIndex:0)*k;g=(g&&g.srcIndex?g.srcIndex:0)*c;for(var m=0;m<a;++m){for(var l=0;9>l;++l)b[d+l]=e[g+l];d+=k;g+=c}}})},"esri/views/3d/support/buffer/utils/mat4":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.copy=function(k,a,g){var b=k.typedBuffer;k=k.typedBufferStride;var e=a.typedBuffer,c=a.typedBufferStride;a=g?g.count:a.count;var d=(g&&g.dstIndex?g.dstIndex:0)*k;g=(g&&g.srcIndex?g.srcIndex:0)*c;for(var m=
0;m<a;++m){for(var l=0;16>l;++l)b[d+l]=e[g+l];d+=k;g+=c}}})},"esri/views/3d/support/buffer/utils/scalar":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.copy=function(k,a,g){var b=k.typedBuffer;k=k.typedBufferStride;var e=a.typedBuffer,c=a.typedBufferStride;a=g?g.count:a.count;var d=(g&&g.dstIndex?g.dstIndex:0)*k;g=(g&&g.srcIndex?g.srcIndex:0)*c;for(var m=0;m<a;++m)b[d]=e[g],d+=k,g+=c};f.makeDense=function(k,a){var g=k.count;a||(a=new k.TypedArrayConstructor(g));
for(var b=0;b<g;b++)a[b]=k.get(b);return a}})},"esri/views/3d/support/buffer/utils/vec2":function(){define(["require","exports","../types"],function(p,f,k){function a(a,b,e){var c=a.typedBuffer;a=a.typedBufferStride;var d=b.typedBuffer,g=b.typedBufferStride;b=e?e.count:b.count;var l=(e&&e.dstIndex?e.dstIndex:0)*a;e=(e&&e.srcIndex?e.srcIndex:0)*g;for(var h=0;h<b;++h)c[l]=d[e],c[l+1]=d[e+1],l+=a,e+=g}Object.defineProperty(f,"__esModule",{value:!0});f.copy=a;f.normalizeIntegerBuffer=function(g,b,e){var c=
g.typedBuffer,d=g.typedBufferStride,m=b.typedBuffer,l=b.typedBufferStride,h=e?e.count:b.count,f=(e&&e.dstIndex?e.dstIndex:0)*d,q=(e&&e.srcIndex?e.srcIndex:0)*l;if(k.isInteger(b.elementType))if(e=k.maximumValue(b.elementType),k.isSigned(b.elementType))for(b=0;b<h;++b)c[f]=Math.max(m[q]/e,-1),c[f+1]=Math.max(m[q+1]/e,-1),f+=d,q+=l;else for(b=0;b<h;++b)c[f]=m[q]/e,c[f+1]=m[q+1]/e,f+=d,q+=l;else a(g,b,e);return g}})},"esri/views/3d/support/buffer/utils/vec3":function(){define(["require","exports"],function(p,
f){Object.defineProperty(f,"__esModule",{value:!0});f.copy=function(k,a,g){var b=k.typedBuffer;k=k.typedBufferStride;var e=a.typedBuffer,c=a.typedBufferStride;a=g?g.count:a.count;var d=(g&&g.dstIndex?g.dstIndex:0)*k;g=(g&&g.srcIndex?g.srcIndex:0)*c;for(var m=0;m<a;++m)b[d]=e[g],b[d+1]=e[g+1],b[d+2]=e[g+2],d+=k,g+=c}})},"esri/views/3d/support/buffer/utils/vec4":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.copy=function(k,a,g){var b=k.typedBuffer;
k=k.typedBufferStride;var e=a.typedBuffer,c=a.typedBufferStride;a=g?g.count:a.count;var d=(g&&g.dstIndex?g.dstIndex:0)*k;g=(g&&g.srcIndex?g.srcIndex:0)*c;for(var m=0;m<a;++m)b[d]=e[g],b[d+1]=e[g+1],b[d+2]=e[g+2],b[d+3]=e[g+3],d+=k,g+=c}})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.applyToModelMatrix=function(k,a){var g=-k[0],b=-k[1];k=-k[2];var e=a[3],c=a[7],d=a[11],m=a[15];a[0]+=e*g;
a[1]+=e*b;a[2]+=e*k;a[4]+=c*g;a[5]+=c*b;a[6]+=c*k;a[8]+=d*g;a[9]+=d*b;a[10]+=d*k;a[12]+=m*g;a[13]+=m*b;a[14]+=m*k};f.applyToViewMatrix=function(k,a){var g=k[0],b=k[1];k=k[2];a[12]+=g*a[0]+b*a[4]+k*a[8];a[13]+=g*a[1]+b*a[5]+k*a[9];a[14]+=g*a[2]+b*a[6]+k*a[10];a[14]+=g*a[3]+b*a[7]+k*a[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","./localOriginHelper"],function(p,f,k,a){Object.defineProperty(f,"__esModule",
{value:!0});p=function(){function g(a){this.factory=a;this.originData=new Map}g.prototype.aquire=function(a){return this.register(this.factory.getOrigin(a))};g.prototype.register=function(a){var b=this.originData.get(a.id);if(b)return b.refCount++,b.origin;this.originData.set(a.id,{refCount:1,viewMatrix:k.mat4f64.create(),origin:a});return a};g.prototype.release=function(a){var b=this.originData.get(a.id);b&&(b.refCount--,0===b.refCount&&this.originData.delete(a.id))};g.prototype.updateViewMatrices=
function(b){this.originData.forEach(function(e){k.mat4.copy(e.viewMatrix,b);a.applyToViewMatrix(e.origin.vec3,e.viewMatrix)})};g.prototype.getViewMatrix=function(a){return this.originData.get(a.id).viewMatrix};return g}();f.LocalOriginManager=p})},"esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","../../../webgl/Util"],function(p,f,k,a,g){function b(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;
case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}return function(){function e(c,d,m,l,h,f){void 0===m&&(m=null);void 0===l&&(l=e.DefaultOffsets);void 0===h&&(h=e.DefaultIndices);void 0===f&&(f=!1);this._freeDataAfterUse=f;this.preinterleaved=!0;this.primitiveType="triangle";this._positionData=null;f=g.getStride(d)/4;f=c.length/f;(this._hasDefaultIndices=h===e.DefaultIndices)&&
(h=a.generateDefaultIndexArray(f));f={};for(var n=0;n<d.length;n++){var t=d[n],u=new (b(t.type))(c.buffer),r=g.getBytesPerElement(t.type);f[t.name]={data:u,size:t.count,offsetIdx:t.offset/r,strideIdx:t.stride/r}}m&&(this._positionData=m,f.position={data:m.data,size:3,offsetIdx:0,strideIdx:3});this._id=a.getNewId();this._vertexData=c;this._vertexAttributes=f;this._layout=d;this._indexData=h;this._componentOffsets=k.createOffsets(l);this._gpuMemoryUsage=c.byteLength+(this._hasDefaultIndices?0:h.byteLength);
this._indexCount=h.length}Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"indexCount",{get:function(){return this._indexCount},enumerable:!0,configurable:!0});e.prototype.toRenderData=
function(){var a={id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,indexCount:this._indexCount,vertexData:this._vertexData,layout:this._layout};this._freeDataAfterUse&&(this._indexData=this._vertexData=null,this._vertexAttributes={position:this._vertexAttributes.position});return a};e.prototype.getIndices=function(a){return"position"===a&&this._positionData?this._positionData.indices:this._indexData};e.prototype.getAttribute=function(a){return this._vertexAttributes[a]};
e.prototype.estimateGpuMemoryUsage=function(){return this._gpuMemoryUsage};Object.defineProperty(e.prototype,"hasPositionData",{get:function(){return!!this._positionData},enumerable:!0,configurable:!0});e.DefaultOffsets=new Uint32Array(0);e.DefaultIndices=new Uint32Array(0);return e}()})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports","./ManagedTextureBackedBuffer"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function a(a,
b){void 0===b&&(b=1);this.rctx=a;this.fieldCount=b;this.buffers=[]}a.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(a){return 0===a.activeCount?(a.dispose(),!1):!0})};a.prototype.getBuffer=function(a){for(var b=0,e=this.buffers;b<e.length;b++){var c=e[b];if(c.availableCount>=a)return c}if(a>k.MAX_INDEX_COUNT)return null;a=new k.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(a);return a};a.prototype.updateTextures=function(){for(var a=0,b=this.buffers;a<
b.length;a++)b[a].textureBuffer.updateTexture()};return a}();f.BufferManager=p})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require","exports","./SimpleIndexManager","./TextureBackedBuffer"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.MAX_INDEX_COUNT=65536;p=function(){function g(b,e){void 0===e&&(e=1);this.textureBuffer=new a.TextureBackedBuffer(b,e);this.indexManager=new k.SimpleIndexManager(f.MAX_INDEX_COUNT)}g.prototype.dispose=
function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(g.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});g.prototype.aquireIndex=function(){var a=this.indexManager.aquire();this.textureBuffer.resizeToFit(a);return a};g.prototype.releaseIndex=function(a){this.indexManager.release(a)};
return g}();f.ManagedTextureBackedBuffer=p})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function k(a){this.maxCount=a;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(k.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"availableCount",
{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});k.prototype.aquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};k.prototype.release=function(a){this.recycledIndices.push(a)};return k}();f.SimpleIndexManager=p})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require","exports","../../../support/buffer/BufferView",
"../../../../webgl/Texture"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function g(b,e){void 0===e&&(e=1);this.rctx=b;this.fieldCount=e;this.textureWidth=4096;this.dirty=!0;this.texture=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new k.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}g.prototype.dispose=function(){this.texture.dispose();this.data=this.texture=
void 0};g.prototype.setData=function(a,e,c,d,g,l){a=a*this.fieldCount+e;this.dirty=!0;this.data.set(a,0,c);this.data.set(a,1,d);this.data.set(a,2,g);this.data.set(a,3,l)};g.prototype.setDataElement=function(a,e,c,d){a=a*this.fieldCount+e;this.dirty=!0;this.data.set(a,c,d)};g.prototype.resizeToFit=function(a){a*=this.fieldCount;a>=this.data.count&&(a=new k.BufferViewVec4u8(new ArrayBuffer(Math.ceil((a+1)/this.textureWidth)*this.textureWidth*4)),a.typedBuffer.set(this.data.typedBuffer),this.data=a)};
g.prototype.updateTexture=function(){if(this.dirty){var a=this.texture.descriptor.width;this.data.count>a*this.texture.descriptor.height&&this.texture.resize(a,this.data.count/a);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};g.prototype.bind=function(a,e){this.rctx.bindTexture(this.texture,e.unit);a.setUniform1i(e.texName,e.unit);a.setUniform2f(e.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return g}();f.TextureBackedBuffer=p})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require",
"exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.EdgeInputBufferLayout=a.newLayout().vec3f("position").u16("componentIndex").u16("_padding");f.VertexLayout=a.newLayout().vec2u8("sideness");f.glVertexLayout=k.glLayout(f.VertexLayout,{prefixA:!0});f.CommonInstancesLayout=a.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",
{glNormalized:!0}).u8("_padding",{glPadding:!0});f.RegularEdgeInstancesLayout=f.CommonInstancesLayout.clone().vec3f("normal");f.SilhouetteEdgeInstancesLayout=f.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");f.EdgeShaderAttributeLocations={aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/RandomLCG ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});var d=function(){function a(){}a.prototype.updateSettings=function(a){this.settings=a};a.prototype.write=function(a,b,c){var d=m;d[0]=c.position0[0];d[1]=c.position0[1];d[2]=c.position0[2];d[3]=c.position1[0];d[4]=c.position1[1];d[5]=c.position1[2];h[0]=5381;for(d=0;d<l.length;d++)h[0]=31*h[0]+l[d];n.seed=h[0];var d=n.getIntRange(0,255),e=n.getIntRange(0,this.settings.variants-1),g=n.getFloat(),g=-(1-Math.min(g/.7,1))+Math.max(0,
g-.7)/(1-.7),g=255*(Math.pow(Math.abs(g),1.2)*(0>g?-1:1)*.5+.5);a.position0.setVec(b,c.position0);a.position1.setVec(b,c.position1);a.componentIndex.set(b,c.componentIndex);a.variantOffset.set(b,d);a.variantStroke.set(b,e);a.variantExtension.set(b,g)};a.prototype.trim=function(a,b){return a.slice(0,b)};return a}();f.CommonBufferWriter=d;var m=new Float32Array(6),l=new Uint32Array(m.buffer),h=new Uint32Array(1),n=new g;p=function(){function a(){this.commonWriter=new d}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};
a.prototype.allocate=function(a){return c.RegularEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,c,d){this.commonWriter.write(a,c,d);b.vec3.add(q,d.faceNormal0,d.faceNormal1);b.vec3.normalize(q,q);a.normal.setVec(c,q)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=c.RegularEdgeInstancesLayout;a.glLayout=e.glLayout(c.RegularEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();f.RegularEdgeBufferWriter=p;p=function(){function a(){this.commonWriter=
new d}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return c.SilhouetteEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);a.normalA.setVec(b,c.faceNormal0);a.normalB.setVec(b,c.faceNormal1)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=c.SilhouetteEdgeInstancesLayout;a.glLayout=e.glLayout(c.SilhouetteEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();
f.SilhouetteEdgeBufferWriter=p;var q=b.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../support/meshProcessing ../../../support/buffer/typedArrayUtil ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(p,f,k,a,g,b,e,c,d,m){return function(){function l(){this.regularWriter=
new d.RegularEdgeBufferWriter;this.silhouetteWriter=new d.SilhouetteEdgeBufferWriter}l.prototype.process=function(b,c){return k(this,void 0,void 0,function(){var d,e,h;return a(this,function(a){switch(a.label){case 0:if(!c)return[3,2];d=[];e=this.packInput(b,d);this.wrappedWork;return[4,c.invoke("wrappedWork",e,{transferList:d})];case 1:return h=a.sent(),[2,this.unpackOutput(h)];case 2:return[2,this.work(b)]}})})};l.prototype.wrappedWork=function(b){return k(this,void 0,void 0,function(){var c,d,
e,h;return a(this,function(a){c=this.unpackInput(b);d=this.work(c);e=[];this.packInputTransferables(c,e);h=this.packOutput(d,e);return[2,{result:h,transferList:e}]})})};l.prototype.work=function(a){var b=this.extractEdgeInformation(a.data,a.skipDeduplicate,a.originalIndices);this.regularWriter.updateSettings(a.writerSettings);this.silhouetteWriter.updateSettings(a.writerSettings);return m.extractEdges(b,this.regularWriter,this.silhouetteWriter)};l.prototype.packInputTransferables=function(a,b){b.push(a.data.buffer)};
l.prototype.packInput=function(a,c){this.packInputTransferables(a,c);c={dataBuffer:a.data.buffer,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate};a.originalIndices&&(c.originalIndicesBuffer=a.originalIndices.buffer,c.originalIndicesType=b.isUint32Array(a.originalIndices)?"Uint32Array":"Uint16Array");return c};l.prototype.unpackInput=function(a){return{data:c.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===a.originalIndicesType?new Uint32Array(a.originalIndicesBuffer):
"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):void 0,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate}};l.prototype.packOutput=function(a,b){b.push(a.regular.lodInfo.lengths.buffer);b.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:e.packInterleavedBuffer(a.regular.instancesData,b),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:e.packInterleavedBuffer(a.silhouette.instancesData,b),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},
averageEdgeLength:a.averageEdgeLength}};l.prototype.unpackOutput=function(a){return{regular:{instancesData:e.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:e.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};l.prototype.extractEdgeInformation=function(a,b,d){if(b&&d)return b=g.computeNeighbors(d,a.count),
{faces:d,neighbors:b,vertices:a};a=g.deduplicate(a.buffer,a.stride/4);d=this.selectIndexData(a.indices,d);b=g.computeNeighbors(d,a.uniqueCount);return{faces:d,neighbors:b,vertices:c.EdgeInputBufferLayout.createView(a.buffer)}};l.prototype.selectIndexData=function(a,c){if(c){c=b.slice(c);for(var d=0;d<c.length;d++)c[d]=a[c[d]];return c}return a};return l}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports","./mathUtils"],function(p,f,k){Object.defineProperty(f,"__esModule",
{value:!0});f.computeNeighbors=function(a,b){for(var e=a.length/3,c=new Uint32Array(b+1),d=new Uint32Array(b+1),g=function(a,b){a<b?c[a+1]++:d[b+1]++},l=0;l<e;l++){var h=a[3*l],k=a[3*l+1],f=a[3*l+2];g(h,k);g(k,f);g(f,h)}for(l=k=h=0;l<b;l++)f=c[l+1],g=d[l+1],c[l+1]=h,d[l+1]=k,h+=f,k+=g;for(var t=new Uint32Array(6*e),u=c[b],g=function(a,b,e){if(a<b){var h=c[a+1]++;t[2*h]=b;t[2*h+1]=e}else h=d[b+1]++,t[2*u+2*h]=a,t[2*u+2*h+1]=e},l=0;l<e;l++)h=a[3*l],k=a[3*l+1],f=a[3*l+2],g(h,k,l),g(k,f,l),g(f,h,l);h=
function(a,b){var c=2*a;a=b-a;for(b=1;b<a;b++){var d=t[c+2*b],e=t[c+2*b+1],h=b-1;for(h;0<=h&&t[c+2*h]>d;h--)t[c+2*h+2]=t[c+2*h],t[c+2*h+3]=t[c+2*h+1];t[c+2*h+2]=d;t[c+2*h+3]=e}};for(l=0;l<b;l++)h(c[l],c[l+1]),h(u+d[l],u+d[l+1]);for(var r=new Int32Array(3*e),y=function(b,c){return b===a[3*c]?0:b===a[3*c+1]?1:b===a[3*c+2]?2:-1},e=function(a,b){a=y(a,b);r[3*b+a]=-1},h=function(a,b,c,d){a=y(a,b);r[3*b+a]=d;c=y(c,d);r[3*d+c]=b},l=0;l<b;l++){for(var k=c[l],f=c[l+1],g=d[l],x=d[l+1];k<f&&g<x;){var z=t[2*
k],w=t[2*u+2*g];z===w?(h(l,t[2*k+1],w,t[2*u+2*g+1]),k++,g++):z<w?(e(l,t[2*k+1]),k++):(e(w,t[2*u+2*g+1]),g++)}for(;k<f;)e(l,t[2*k+1]),k++;for(;g<x;)w=t[2*u+2*g],e(w,t[2*u+2*g+1]),g++}return r};var a=null;f.deduplicate=function(g,b,e,c,d){void 0===e&&(e=0);void 0===c&&(c=0);void 0===d&&(d=g.byteLength/(4*b));g=new Uint32Array(g,c,d*b);c=new Uint32Array(d);var m=Math.floor(1.1*d)+1;if(null==a||a.length<2*m)a=new Uint32Array(k.nextHighestPowerOfTwo(2*m));for(var l=0;l<2*m;l++)a[l]=0;for(var h=0,f=0!==
e?Math.ceil(7.84*1.96/(e*e)*e*(1-e)):d,l=0;l<d;l++){if(l===f){var q=1-h/l;if(q+1.96*Math.sqrt(q*(1-q)/l)<e)return null;f*=2}for(var q=l*b,t,u=t=0;u<b;u++)t=g[q+u]+t|0,t=t+(t<<11)+(t>>>2)|0;t>>>=0;for(var u=t%m,r=h;0!==a[2*u+1];){if(a[2*u]===t){var y=a[2*u+1]-1,x=y*b;a:{for(var z=0;z<b;z++)if(g[q+z]!==g[x+z]){x=!1;break a}x=!0}if(x){r=c[y];break}}u++;u>=m&&(u-=m)}r===h&&(a[2*u]=t,a[2*u+1]=l+1,h++);c[l]=r}if(0!==e&&1-h/d<e)return null;e=new Uint32Array(b*h);for(l=h=0;l<d;l++)if(c[l]===h){m=g;f=l*b;
q=e;t=h*b;u=b;for(r=0;r<u;r++)q[t+r]=m[f+r];h++}return{buffer:e.buffer,indices:c,uniqueCount:h}}})},"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","./BufferView","./InterleavedLayout"],function(p,f,k,a,g){function b(a){var b=[];a.fields.forEach(function(a,c){var d=a.constructor;a=k({},a,{constructor:d.ElementType+"_"+d.ElementCount});b.push([c,a])});return{stride:a.stride,fields:b,fieldNames:a.fieldNames}}function e(a){var b=
g.newLayout();b.stride=a.stride;b.fieldNames=a.fieldNames;a.fields.forEach(function(a){return b.fields.set(a[0],k({},a[1],{constructor:c.get(a[1].constructor)}))});return b}Object.defineProperty(f,"__esModule",{value:!0});f.packInterleavedBuffer=function(a,c){c.push(a.buffer);return{buffer:a.buffer,layout:b(a.layout)}};f.unpackInterleavedBuffer=function(a){return e(a.layout).createView(a.buffer)};f.packLayout=b;f.unpackLayout=e;p=[a.BufferViewFloat,a.BufferViewVec2f,a.BufferViewVec3f,a.BufferViewVec4f,
a.BufferViewMat3f,a.BufferViewMat4f,a.BufferViewFloat64,a.BufferViewVec2f64,a.BufferViewVec3f64,a.BufferViewVec4f64,a.BufferViewMat3f64,a.BufferViewMat4f64,a.BufferViewUint8,a.BufferViewVec2u8,a.BufferViewVec3u8,a.BufferViewVec4u8,a.BufferViewUint16,a.BufferViewVec2u16,a.BufferViewVec3u16,a.BufferViewVec4u16,a.BufferViewUint32,a.BufferViewVec2u32,a.BufferViewVec3u32,a.BufferViewVec4u32,a.BufferViewInt8,a.BufferViewVec2i8,a.BufferViewVec3i8,a.BufferViewVec4i8,a.BufferViewInt16,a.BufferViewVec2i16,
a.BufferViewVec3i16,a.BufferViewVec4i16,a.BufferViewInt32,a.BufferViewVec2i32,a.BufferViewVec3i32,a.BufferViewVec4i32];var c=new Map;p.forEach(function(a){return c.set(a.ElementType+"_"+a.ElementCount,a)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../support/mathUtils ../../../support/buffer/typedArrayUtil".split(" "),function(p,f,k,a,g,b){function e(b,c){var d=
g.acos(b.cosAngle),e=m.fwd,h=m.ortho;g.directionFromTo(e,b.position1,b.position0);b=0<a.vec3.dot(a.vec3.cross(h,b.faceNormal0,b.faceNormal1),e)?-1:1;return d*b>c}function c(a){var b=a.faces.length/3,c=a.faces;a=a.neighbors;for(var d=0,e=0;e<b;e++)var h=a[3*e+0],g=a[3*e+1],l=a[3*e+2],m=c[3*e+0],k=c[3*e+1],f=c[3*e+2],d=d+(-1===h||m<k?1:0),d=d+(-1===g||k<f?1:0),d=d+(-1===l||f<m?1:0);for(var d=new Int32Array(4*d),n=0,e=0;e<b;e++){h=a[3*e+0];g=a[3*e+1];l=a[3*e+2];m=c[3*e+0];k=c[3*e+1];f=c[3*e+2];if(-1===
h||m<k)d[n++]=m,d[n++]=k,d[n++]=e,d[n++]=h;if(-1===g||k<f)d[n++]=k,d[n++]=f,d[n++]=e,d[n++]=g;if(-1===l||f<m)d[n++]=f,d[n++]=m,d[n++]=e,d[n++]=l}return d}function d(b){var c=b.faces.length/3,d=b.vertices.position;b=b.faces;for(var e=l.v0,h=l.v1,g=l.v2,m=new Float32Array(3*c),k=0;k<c;k++){var f=b[3*k+1],n=b[3*k+2];d.getVec(b[3*k+0],e);d.getVec(f,h);d.getVec(n,g);a.vec3.subtract(h,h,e);a.vec3.subtract(g,g,e);a.vec3.cross(e,h,g);a.vec3.normalize(e,e);m[3*k+0]=e[0];m[3*k+1]=e[1];m[3*k+2]=e[2]}return m}
Object.defineProperty(f,"__esModule",{value:!0});f.extractEdges=function(l,f,t,u){void 0===u&&(u=h);var n=l.vertices.position,q=l.vertices.componentIndex,x=g.deg2rad(u.anglePlanar);u=g.deg2rad(u.angleSignificantEdge);var z=Math.cos(u),w=Math.cos(x),B=m.edge,C=B.position0,D=B.position1,E=B.faceNormal0,p=B.faceNormal1,H=d(l),I=c(l),N=I.length/4;l=f.allocate(N);u=0;var S=t.allocate(N),M=0,P=0,O=0,W=k.range(0,N),Q=new Float32Array(N);b.forEach(Q,function(b,c,d){n.getVec(I[4*c+0],C);n.getVec(I[4*c+1],
D);d[c]=a.vec3.distance(C,D)});W.sort(function(a,b){return Q[b]-Q[a]});for(var J=[],F=[],K=0;K<N;K++){var L=W[K],T=Q[L],R=I[4*L+0],X=I[4*L+1],ba=I[4*L+2],L=I[4*L+3],ca=-1===L;n.getVec(R,C);n.getVec(X,D);if(ca)a.vec3.set(E,H[3*ba+0],H[3*ba+1],H[3*ba+2]),a.vec3.copy(p,E),B.componentIndex=q.get(R),B.cosAngle=a.vec3.dot(E,p);else if(a.vec3.set(E,H[3*ba+0],H[3*ba+1],H[3*ba+2]),a.vec3.set(p,H[3*L+0],H[3*L+1],H[3*L+2]),B.componentIndex=q.get(R),B.cosAngle=a.vec3.dot(E,p),B.cosAngle>w)continue;P+=T;O++;ca||
B.cosAngle<z?(f.write(l,u++,B),J.push(T)):e(B,x)&&(t.write(S,M++,B),F.push(T))}q=new Float32Array(J.reverse());x=new Float32Array(F.reverse());return{regular:{instancesData:f.trim(l,u),lodInfo:{lengths:q}},silhouette:{instancesData:t.trim(S,M),lodInfo:{lengths:x}},averageEdgeLength:P/O}};var m={edge:{position0:a.vec3f64.create(),position1:a.vec3f64.create(),faceNormal0:a.vec3f64.create(),faceNormal1:a.vec3f64.create(),componentIndex:0,cosAngle:0},ortho:a.vec3f64.create(),fwd:a.vec3f64.create()},l=
{v0:a.vec3f64.create(),v1:a.vec3f64.create(),v2:a.vec3f64.create()},h={anglePlanar:4,angleSignificantEdge:35}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../support/mathUtils ../../materials/internal/MaterialUtil ../../shaders/EdgeRendererPrograms".split(" "),function(p,f,k,a,g,b,e,c){Object.defineProperty(f,
"__esModule",{value:!0});f.LINE_WIDTH_FRACTION_FACTOR=8;f.EXTENSION_LENGTH_OFFSET=128;var d={type:"solid",slicePlaneEnabled:!1,uber:!0,strokesTexture:null},m=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}();p=function(){function a(b,c,e){this.rctx=b;this.programRepository=c;this.refCount=new m;
this.renderables=new Set;this.depthBiasZ=-4E-4;this.depthBiasXY=.5;this.tmpViewToWorldNormalMatrix=g.mat3f64.create();this.settings=k({},d,e);this.key=a.getKey(this.settings.uber,this.settings.type,this.settings.slicePlaneEnabled);this.writerSettings={variants:this.settings.strokesTexture.variants};this.createPrograms()}a.prototype.dispose=function(){for(var a in this.programs){var b=this.programs[a];b&&(this.programRepository.decreaseRefCount(b),this.programs[a]=null)}};a.prototype.addRenderable=
function(a){this.renderables.add(a)};a.prototype.removeRenderable=function(a){this.renderables.delete(a)};a.prototype.forEachRenderable=function(a){this.renderables.forEach(a)};a.prototype.bindRegularEdges=function(a,b){this.bind(this.programs.regular,a,b)};a.prototype.bindSilhouetteEdges=function(a,b){this.bind(this.programs.silhouette,a,b)};a.prototype.bind=function(a,b,c){this.rctx.bindProgram(a);a.setUniformMatrix4fv("uProj",b.proj);a.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ);
a.setUniform2f("uPixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform2f("uNDCToPixel",b.viewport[2]/2,b.viewport[3]/2);a.setUniform1f("uDistanceFalloffFactor",c.distanceFalloffFactor);a.setUniform2f("uViewportDimInv",1/b.viewport[2],1/b.viewport[3]);a.setUniform1f("uPixelRatio",b.pixelRatio||1)};a.prototype.renderRegularEdges=function(a,b,c){this.render(this.programs.regular,a,a.regular.vao,b,c)};a.prototype.renderSilhouetteEdges=function(a,b,c){this.render(this.programs.silhouette,a,a.silhouette.vao,
b,c)};a.prototype.render=function(a,b,c,d,e){this.setUniforms(a,b,d);a=this.rctx;a.bindVAO(c);a.capabilities.instancing.drawArraysInstanced(6,0,4,e)};a.prototype.setUniforms=function(a,b,c){b.components.buffer.textureBuffer.bind(a,f.componentDataBindParameters);a.setUniformMatrix4fv("uView",c.view);a.setUniformMatrix4fv("uModel",b.transform.modelMatrix);var d=c.viewInvTransp,h=g.mat3.fromMat4(this.tmpViewToWorldNormalMatrix,d);a.setUniform3f("uCameraPosition",d[3],d[7],d[11]);a.setUniformMatrix3fv("uViewToWorldNormalMatrix",
h);(this.settings.uber||"sketch"===this.settings.type)&&this.setSketchUniforms(a);a.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(c.fovY/2)/(c.viewport[3]/2));a.setUniform3fv("uLocalOrigin",b.transform.origin.vec3);this.settings.slicePlaneEnabled&&e.bindSlicePlane(b.transform.origin.vec3,c.slicePlane,a)};a.prototype.setSketchUniforms=function(a){var c=this.settings.strokesTexture,d=c.texture;this.rctx.bindTexture(d,0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",
1/d.descriptor.width,1/d.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",b.log2(c.resolution));a.setUniform1f("uStrokesNormalizationScale",c.normalizationScale);a.setUniform1f("uStrokesAmplitude",c.amplitude);a.setUniform1f("uStrokeVariants",c.variants)};a.prototype.getOptions=function(a){return k({},a,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.uber?"uber":this.settings.type,slice:this.settings.slicePlaneEnabled})};a.prototype.createPrograms=function(){var a=
this.programRepository.getProgram(c.program,this.getOptions({silhouette:!1})),b=this.programRepository.getProgram(c.program,this.getOptions({silhouette:!0}));this.programRepository.increaseRefCount(a);this.programRepository.increaseRefCount(b);this.programs={regular:a,silhouette:b}};a.getKey=function(a,b,c){return a?"edges-uber:"+c:"edges-t:"+b+":"+c};return a}();f.EdgeRenderer=p;f.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}})},"esri/views/3d/webgl-engine/shaders/EdgeRendererPrograms":function(){define(["require",
"exports","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});var g=function(b){return a.glslifyDefineMap({MODE:{value:b.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:b.silhouette,ANTIALIASING:b.antialiasing,SLICE:b.slice})};f.program={name:"edges",shaders:function(a){return{vertexShader:g(a)+k.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:g(a)+k.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},
attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../support/mathUtils ../Util ../../../../webgl/Texture".split(" "),function(p,f,k,a,g,b){function e(a,b){if(!a)return null;var e=a.length/2,g=c*e,e=Array(e),l=0;b=1===b;for(var m=0;m<
a.length;m+=2){var k=(a[m]+a[m+1])/2;b?e[l++]=Math.min(g,1-(1-k)*d):e[l++]=Math.min(g,k*d)}return e}Object.defineProperty(f,"__esModule",{value:!0});f.generateStrokesTexture=function(c){for(var d=f.strokesDefinition.resolution,h=d/2,m=new Uint8Array(4*d*d),k=4*d*h,h=f.strokesDefinition.amplitude,t=2*h,u=4*d,r=a.log2(d)+1,y=f.strokesDefinition.strokes.length,x=(r-1)*y*u,z=0,w=f.strokesDefinition.strokes;z<w.length;z++){for(var B=w[z],C=B.distance,B=B.pressure,D=x,E=0;E<r;E++){0!==E&&(C=e(C,0),B=e(B,
1));for(var p=0;p<f.strokesDefinition.resolution;p++){var H=B?B[p%B.length]:1;g.packFloatRGBA((C?C[p%C.length]/t:0)+.5,m,D);g.packFloatRGBA(H,m,D+k);D+=4}D-=u*(y+1)}x+=u}c=new b(c,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:d,height:d,wrapMode:10497},m);return{resolution:d,texture:c,normalizationScale:t,amplitude:h,variants:y}};var c=.1,d=.5;f.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,
-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,
.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,
.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,
-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,
.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,
.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,
.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,
-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,
-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,
1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,
.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,
-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,
.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,
.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,
.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,
.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,
4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,
3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,
.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,
.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,
.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,
.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,
.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,
1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,
-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,
.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,
2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,
.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,
.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,
.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,
-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,
1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,
.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,
-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,
.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,
.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,
.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,
.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,
4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,
.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,
-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],
pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,
.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,
.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,
.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils","../../../../../core/compilerUtils","../../../support/buffer/typedArrayUtil"],function(p,f,k,a,g){function b(a,
b){var c=k.binaryIndexOf(a,b,!0);return-1===c?b<a[0]?0:a.length:c}Object.defineProperty(f,"__esModule",{value:!0});f.determineRequiresUberRenderer=function(b){if(0===b.length)return!1;for(var c=null,d=0;d<b.length;d++){var e=b[d],g=e.type;if(0<e.size*e.color[3]*e.opacity)if(a.isNone(c))c=g;else if(c!==g)return!0}return!1};f.determineAllTransparent=function(a){if(0===a.length)return!0;for(var b=0;b<a.length;b++){var d=a[b].material;if(0<d.size*d.color[3]*d.opacity)return!1}return!0};f.cloneIndices=
function(a){if(Uint16Array.from)return g.isUint16Array(a)?Uint16Array.from(a):Uint32Array.from(a);for(var b=g.isUint16Array(a)?new Uint16Array(a.length):new Uint32Array(a.length),d=0;d<a.length;d++)b[d]=a[d];return b};f.estimateLengthAtDistance=function(a,b,d,g){return g/a*d*2*Math.tan(.5*b)};f.findLowerBoundIndex=b;f.computeEdgeCount=function(a,c,d){return a.length-b(a,c*d.minimumEdgeLength)};f.fillComponenBufferIndices=function(a,b,d,g){for(var c=0;c<a.length;c++){var e=a[c].index,m=b[c],k=b[c+
1];if(g)for(;m<k;m++)d.set(g[m],e);else for(;m<k;m++)d.set(m,e)}}})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","./SphericalHarmonics"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});var g=k.vec3f64.create();p=function(){function b(){this._renderLighting={main:{intensity:k.vec3f64.create(),direction:k.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};
this._shOrder=2;this._oldDirection=k.vec3f64.create();this._oldSpecular=k.vec4f64.create();this._oldDiffuse=k.vec4f64.create();this._oldAmbient=k.vec4f64.create()}b.prototype.setUniforms=function(a,b){void 0===b&&(b=!1);b||a.getDefine("GROUND_NORMAL_SHADING")?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",this._info.globalFactor);a.setUniform3fv("lightingMainDirection",
this._renderLighting.main.direction);a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",.4);b=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",b.r[0],b.r[1],b.r[2],b.r[3]),a.setUniform4f("lightingAmbientSH_G",b.g[0],b.g[1],b.g[2],b.g[3]),a.setUniform4f("lightingAmbientSH_B",b.b[0],b.b[1],b.b[2],b.b[3])):2===this._shOrder&&
(a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]),a.setUniform4f("lightingAmbientSH_R1",b.r[1],b.r[2],b.r[3],b.r[4]),a.setUniform4f("lightingAmbientSH_G1",b.g[1],b.g[2],b.g[3],b.g[4]),a.setUniform4f("lightingAmbientSH_B1",b.b[1],b.b[2],b.b[3],b.b[4]),a.setUniform4f("lightingAmbientSH_R2",b.r[5],b.r[6],b.r[7],b.r[8]),a.setUniform4f("lightingAmbientSH_G2",b.g[5],b.g[6],b.g[7],b.g[8]),a.setUniform4f("lightingAmbientSH_B2",b.b[5],b.b[6],b.b[7],b.b[8]));a.setUniform3fv("lightDirection",this._oldDirection)};
b.prototype.set=function(b){this._info=b;a.combineLights(b.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics);k.vec3.negate(this._oldDirection,this._renderLighting.main.direction);b=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*b;this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*b;this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*b;this._oldAmbient[3]=1;this._oldDiffuse[0]=
this._renderLighting.main.intensity[0]*b;this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*b;this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*b;this._oldDiffuse[3]=1;b=k.vec3.copy(g,this._oldDiffuse);k.vec3.scale(b,b,.4*this._info.globalFactor);k.vec3.add(this._oldAmbient,this._oldAmbient,b)};Object.defineProperty(b.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});b.prototype.getOld=function(){return{ambient:this._oldAmbient,
diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}};return b}();f.SceneLighting=p})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/mathUtils ../lib/LongVectorMath ./Lightsources".split(" "),function(p,f,k,a,g,b){function e(a){return(a+1)*(a+1)}function c(b){return a.clamp(Math.floor(Math.sqrt(b)-1),0,2)}function d(a,b,c){var d=a[0],h=a[1];a=a[2];c=c||[];
c.length=e(b);0<=b&&(c[0]=.28209479177);1<=b&&(c[1]=.4886025119*d,c[2]=.4886025119*a,c[3]=.4886025119*h);2<=b&&(c[4]=1.09254843059*d*h,c[5]=1.09254843059*h*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*d*a,c[8]=.54627421529*(d*d-h*h));return c}function m(a,b){a=e(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=0;c<a;c++)b.r[c]=b.g[c]=b.b[c]=0;return b}function l(a,b){for(var e=c(b.r.length),h=0;h<a.length;h++){var l=a[h];k.vec3.negate(y,l.direction);d(y,e,u);g.elementwiseProduct(u,
x);g.scalarProduct(u,l.intensity[0],r);g.add(b.r,r);g.scalarProduct(u,l.intensity[1],r);g.add(b.g,r);g.scalarProduct(u,l.intensity[2],r);g.add(b.b,r)}return b}function h(a,b){d(y,0,u);for(var c=0;c<a.length;c++){var e=a[c];b.r[0]+=u[0]*x[0]*e.intensity[0]*4*Math.PI;b.g[0]+=u[0]*x[0]*e.intensity[1]*4*Math.PI;b.b[0]+=u[0]*x[0]*e.intensity[2]*4*Math.PI}return b}Object.defineProperty(f,"__esModule",{value:!0});f.numberOfCoefficients=e;f.numberOfCoefficientsInBand=function(a){return 2*a+1};f.orderFromNumberOfCoefficients=
c;f.computeCoefficients=d;f.initSHCoefficients=m;f.projectFillLights=l;f.projectAmbientLights=h;f.combineLights=function(a,c,d,e){m(c,e.sh);k.vec3.set(d.intensity,0,0,0);var f=!1,r=n,u=q;c=t;r.length=0;u.length=0;for(var w=c.length=0;w<a.length;w++){var z=a[w];z instanceof b.MainLight&&!f?(k.vec3.copy(d.direction,z.direction),d.intensity[0]=z.intensity[0],d.intensity[1]=z.intensity[1],d.intensity[2]=z.intensity[2],d.castShadows=z.castShadows,f=!0):z instanceof b.MainLight||z instanceof b.FillLight?
r.push(z):z instanceof b.AmbientLight?u.push(z):z instanceof b.SphericalHarmonicsLight&&c.push(z)}l(r,e.sh);h(u,e.sh);for(a=0;a<c.length;a++)z=c[a],g.add(e.sh.r,z.sh.r),g.add(e.sh.g,z.sh.g),g.add(e.sh.b,z.sh.b)};var n=[],q=[],t=[],u=[0],r=[0],y=k.vec3f64.create(),x=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.dotProduct=
function(k,a){for(var g=0,b=0;b<k.length;b++)g+=k[b]*a[b];return g};f.elementwiseProduct=function(k,a,g){g=g||k;g.length=k.length;for(var b=0;b<k.length;b++)g[b]=k[b]*a[b];return g};f.scalarProduct=function(k,a,g){g=g||k;g.length=k.length;for(var b=0;b<k.length;b++)g[b]=k[b]*a;return g};f.add=function(k,a,g){g=g||k;g.length=k.length;for(var b=0;b<k.length;b++)g[b]=k[b]+a[b];return g}})},"esri/views/webgl/Profiling":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",
{value:!0});f.startMeasurement=function(a){return(a=a.capabilities.disjointTimerQuery)?new k(a):null};f.getTimestamp=function(a,g,b){void 0===b&&(b=50);var e=a.capabilities.disjointTimerQuery;if(!e||0>=e.timestampBits())return null;var c=e.createQuery();e.createTimestamp(c);var d=function(){var a=e.resultAvailable(c),l=e.disjoint();a&&!l?(a=e.getResult(c),g(a/1E6)):l?g():setTimeout(d,b)};d()};f.supportsTimestamps=function(a){a=a.capabilities.disjointTimerQuery;if(!a)return!1;a=a.timestampBits();console.log({bits:a});
return 0<a};var k=function(){function a(a){this.timer=a;this.query=a.createQuery();this.timer.beginTimeElapsed(this.query)}a.prototype.stop=function(a,b){void 0===b&&(b=50);this.cb=a;this.checkInterval=b;this.timer.endTimeElapsed();this.checkQueryResult()};a.prototype.checkQueryResult=function(){var a=this.timer.resultAvailable(this.query),b=this.timer.disjoint();a&&!b?(a=this.timer.getResult(this.query),this.cb(a/1E6)):b?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval)};
return a}()})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["require","exports","../../support/geometryUtils"],function(p,f,k){var a=k.boundedPlane.create();return function(){function g(){this._worldPlane=a}Object.defineProperty(g.prototype,"isEnabled",{get:function(){return this.plane!==a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"plane",{get:function(){return this._worldPlane},set:function(b){this._worldPlane=b?b:a},enumerable:!0,configurable:!0});return g}()})},
"esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/gl-matrix","./MaterialUtil","../../shaders/MiscPrograms"],function(p,f,k,a,g){var b=k.vec4f64.fromValues(1,1,1,1);return function(){function e(a,b,e,l,h){this.program=a.getProgram(g.texOnly);this.color=e;this.depthFunc=h;this.blend=l;this.texGLName=b}e.prototype.beginSlot=function(a){return 1===a};e.prototype.getProgram=function(){return this.program};e.prototype.setColor=
function(a){this.color=a};e.prototype.bind=function(c,d){c.bindProgram(this.program);this.program.setUniformMatrix4fv("model",a.IDENTITY);this.program.setUniformMatrix4fv("proj",d.proj);this.program.setUniform4fv("color",void 0!==this.color?this.color:b);this.program.setUniform1i("tex",0);c.bindTexture(this.texGLName,0);this.blend&&(c.setBlendingEnabled(!0),c.setBlendFunctionSeparate(c.gl.SRC_ALPHA,c.gl.ONE_MINUS_SRC_ALPHA,c.gl.ONE,c.gl.ONE_MINUS_SRC_ALPHA));c.setDepthTestEnabled(!0);void 0!==this.depthFunc&&
c.setDepthFunction(this.depthFunc)};e.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);this.blend&&a.setBlendingEnabled(!1)};e.prototype.bindView=function(b,d){a.bindView(d.origin,d.view,this.program)};e.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};e.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return e}()})},"esri/views/3d/webgl-engine/shaders/MiscPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations",
"./sources/resolver"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.blendLayers={name:"blend-layers",shaders:{vertexShader:a.resolveIncludes("misc/blendLayers.vert"),fragmentShader:a.resolveIncludes("misc/blendLayers.frag")},attributes:k.Default3D};f.simple={name:"simple",shaders:{vertexShader:a.resolveIncludes("misc/simple.vert"),fragmentShader:a.resolveIncludes("misc/simple.frag")},attributes:k.Default3D};f.texOnly={name:"tex-only",shaders:{vertexShader:a.resolveIncludes("misc/texOnly.vert"),
fragmentShader:a.resolveIncludes("misc/texOnly.frag")},attributes:k.Default3D};f.showDepth={name:"show-depth",shaders:{vertexShader:a.resolveIncludes("misc/showDepth.vert"),fragmentShader:a.resolveIncludes("misc/showDepth.frag")},attributes:k.Default3D}})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","./Util"],function(p,f,k){var a=function(){function a(a){this.refCnt=0;this.glMaterial=a}a.prototype.incRefCnt=function(){++this.refCnt};a.prototype.decRefCnt=
function(){--this.refCnt;k.assert(0<=this.refCnt)};a.prototype.getRefCnt=function(){return this.refCnt};a.prototype.getGLMaterial=function(){return this.glMaterial};return a}();return function(){function g(a,e){this.textureRep=a;this.programRep=e;this.id2glMaterialRef={}}g.prototype.aquire=function(a){return this.aquireExt(a,"color")};g.prototype.aquireDepthShadowMap=function(a){return this.aquireExt(a,"depthShadowMap")};g.prototype.aquireDepth=function(a){return this.aquireExt(a,"depth")};g.prototype.aquireNormal=
function(a){return this.aquireExt(a,"normal")};g.prototype.aquireHighlight=function(a){return this.aquireExt(a,"highlight")};g.prototype.aquireExt=function(b,e){var c=b.id+"_"+e,d=this.id2glMaterialRef[c];null==d?(b=(d=b.getGLMaterials()[e])?new d(b,this.programRep,this.textureRep):void 0,d=new a(b),this.id2glMaterialRef[c]=d):b=d.getGLMaterial();d.incRefCnt();b&&this.increaseProgramReferences(b);return b};g.prototype.release=function(a){this.releaseExt(a,"color")};g.prototype.releaseDepth=function(a){this.releaseExt(a,
"depth")};g.prototype.releaseNormal=function(a){this.releaseExt(a,"normal")};g.prototype.releaseDepthShadowMap=function(a){this.releaseExt(a,"depthShadowMap")};g.prototype.releaseHighlight=function(a){this.releaseExt(a,"highlight")};g.prototype.releaseExt=function(a,e){a=a+"_"+e;e=this.id2glMaterialRef[a];e.decRefCnt();if(0===e.getRefCnt()){if(e=e.getGLMaterial())this.decreaseProgramReferences(e),e.dispose();delete this.id2glMaterialRef[a]}};g.prototype.updateMaterialParameters=function(a){var b=
this.id2glMaterialRef[a+"_color"];b&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depth"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depthShadowMap"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_normal"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(a=this.id2glMaterialRef[a+"_highlight"])&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())};
g.prototype.updateParamsForMat=function(a){a.updateParameters&&(this.decreaseProgramReferences(a),a.updateParameters(),this.increaseProgramReferences(a))};g.prototype.increaseProgramReferences=function(a){a=a.getPrograms();for(var b=this.programRep,c=0;c<a.length;c++)b.increaseRefCount(a[c])};g.prototype.decreaseProgramReferences=function(a){a=a.getPrograms();for(var b=this.programRep,c=0;c<a.length;c++)b.decreaseRefCount(a[c])};return g}()})},"esri/views/3d/webgl-engine/lib/GLTextureRep":function(){define(["require",
"exports","../../../../core/Logger","./Util","../../../webgl/Texture"],function(p,f,k,a,g){var b=k.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep");p=function(){function e(a,b,e,g){this.NUM_PARALLEL=8;this._fallbackTextureTransparent=this._fallbackTexture=null;this.textures=a;this._programRepository=b;this.getViewportToRestore=e;this._rctx=g;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=(this.afExt=g.capabilities.textureFilterAnisotropic)?
g.parameters.maxMaxAnisotropy:1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);this._needsRender=!0;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);for(a=0;a<this._fallbackTextureData.length;++a)this._fallbackTextureData[a]=255,this._fallbackTextureTransparentData[a]=0!==(a+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}e.prototype.resetNeedsRender=function(){this._needsRender=
!1};e.prototype.needsRender=function(){return this._needsRender};e.prototype.aquire=function(c,d,g){var l=this,h=this.id2textureRef[c];if(null==h){var m=this.textures[c];a.assert(void 0!==m);m.setUnloadFunc(this._unload.bind(this));d=!0===d;var k=this._createGLTextureDescription(m),h=new e.TextureRef(null);a.assert(null==this.id2textureRef[c]);this.id2textureRef[c]=h;if(m.initializeThroughRender)c=m.initializeThroughRender(this._rctx,k),h.setGLTexture(c),g&&g(h);else if(m.deferredLoading())this.getLoadingCount()<
this.NUM_PARALLEL?this._loadImage(c,k,g):this._queue.push([c,k,g]);else try{m.initializeThroughUpload(this._rctx,k,this._programRepository,this.getViewportToRestore(),function(a){h.setGLTexture(a);l._needsRender=!0;g&&g(h)})}catch(t){b.error("#aquire","Error loading texture: "+t.toString())}null==h.getGLTexture()&&h.setGLTexture(d?this.fallbackTextureTransparent:this.fallbackTexture);this._needsRender=!0}h.incRefCnt();return h};e.prototype.release=function(b){b=this.id2textureRef[b];void 0!==b&&(b.decRefCnt(),
a.assert(0<=b.getRefCnt()))};e.prototype.getLoadingCount=function(){return Object.keys(this.loading).length};e.prototype.getTexture=function(a){return this.textures[a]};e.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy};e.prototype._unload=function(a){var b=this.id2textureRef[a];void 0!==b&&((b=b.getGLTexture())&&b.dispose(),delete this.id2textureRef[a]);this.next(a)};e.prototype._createGLTextureDescription=function(a){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&
a.params&&a.params.mipmap&&!a.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:a.params&&a.params.wrap}};e.prototype.next=function(a){if(a in this.loading){delete this.loading[a];var b=Object.keys(this.id2textureRef),c=Object.keys(this.loading);this.listeners.forEach(function(d){d(a,b,c)});this.processQueue()}};e.prototype._loadImage=function(b,d,e){var c=this;a.assert(null==this.loading[b]);this.loading[b]=!0;var h=this.textures[b];a.assert(void 0!==h);setTimeout(function(){var a=c.id2textureRef[b];
a&&a.getRefCnt()&&h.initializeThroughUpload(c._rctx,d,c._programRepository,c.getViewportToRestore(),function(d){c.next(b);c._needsRender=!0;a&&a.getRefCnt()&&(a.setGLTexture(d),e&&e(a))})},0)};e.prototype.processQueue=function(){for(var a=[],b=0;b<this._queue.length;++b){var e=this._queue[b][0],g=this.id2textureRef[e];void 0!==g&&(0===g.getRefCnt()?(g.getGLTexture().dispose(),delete this.id2textureRef[e]):a.push(this._queue[b]))}this._queue=a;a=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,
this._queue.length);for(b=0;b<a;++b)this._loadImage(this._queue[b][0],this._queue[b][1],this._queue[b][2]);this._queue.splice(0,a)};Object.defineProperty(e.prototype,"fallbackTexture",{get:function(){this._fallbackTexture||(this._fallbackTexture=new g(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData));return this._fallbackTexture},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"fallbackTextureTransparent",{get:function(){this._fallbackTextureTransparent||(this._fallbackTextureTransparent=
new g(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData));return this._fallbackTextureTransparent},enumerable:!0,configurable:!0});return e}();(function(b){var c=function(){function b(a){this._glTexture=null;this._refCount=0;this._glTexture=a}b.prototype.incRefCnt=function(){++this._refCount};b.prototype.decRefCnt=function(){--this._refCount;a.assert(0<=this._refCount)};b.prototype.getRefCnt=function(){return this._refCount};b.prototype.setGLTexture=function(a){this._glTexture=
a};b.prototype.getGLTexture=function(){return this._glTexture};return b}();b.TextureRef=c})(p||(p={}));return p})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require","exports","./Util","../../../webgl/programUtils"],function(p,f,k,a){return function(){function g(a){this._programCacheByTemplate=new Map;this._globalOptions={viewingMode:"global"};this._rctx=a;this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],
viewportPixelSz:[],lightingMainDirection:[]}}Object.defineProperty(g.prototype,"globalOptions",{get:function(){return this._globalOptions},enumerable:!0,configurable:!0});g.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});this._programRefCount=this._programCacheByTemplate=null};g.prototype.getProgram=function(b,e){var c=this;this._programCacheByTemplate.has(b)||this.addProgramTemplate(b,function(d){return a.createProgram(c._rctx,
b,d)});return this.getProgramTemplateInstance(b,e)};g.prototype.addProgramTemplate=function(a,e){this._programCacheByTemplate.set(a,{constructor:e,programs:new Map})};g.prototype.getProgramTemplateInstance=function(a,e){if(a=this._programCacheByTemplate.get(a)){var b=e?JSON.stringify(e):"default";a.programs.has(b)||(e=a.constructor(e),a.programs.set(b,e));return a.programs.get(b)}return null};g.prototype.getProgramsUsingUniform=function(a){return this._commonUniforms[a]||[]};g.prototype.increaseRefCount=
function(a){var b=a.id;this._programRefCount[b]?this._programRefCount[b]++:(this._programRefCount[b]=1,this._findCommonUniforms(a))};g.prototype.decreaseRefCount=function(a){var b=a.id;1<this._programRefCount[b]?this._programRefCount[b]--:(this._forgetCommonUniforms(a),this._programRefCount[b]=0)};g.prototype._findCommonUniforms=function(a){for(var b in this._commonUniforms)a.hasUniform(b)&&(k.assert(-1===this._commonUniforms[b].indexOf(a),"common uniforms of program have already been determined"),
this._commonUniforms[b].push(a))};g.prototype._forgetCommonUniforms=function(a){for(var b in this._commonUniforms){var c=this._commonUniforms[b],d=c.indexOf(a);-1<d&&(c[d]=c[c.length-1],c.pop())}};return g}()})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});var g=null,b=[];f.enabled=!1;f.begin=function(){f.enabled&&(g=[])};f.trace=function(a){f.enabled&&
null!=g&&g.push(a)};f.end=function(){if(f.enabled){var a=g;g=null;a&&(b.forEach(function(b){return b(a)}),b.length=0);return a}};f.instrumentContext=function(b){return f.enabled?a.default(b)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),b):k.makeDebugContext(b,void 0,function(a,b){f.enabled&&g&&g.push("gl."+a+"("+k.glFunctionArgsToString(a,b)+")")}):b};f.request=function(a){b.push(a)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function p(a){if(null==
d){d={};m={};for(var b in a)"number"==typeof a[b]&&(d[a[b]]=b,m[b]=a[b])}}function f(){if(null==d)throw"WebGLDebugUtils.init(ctx) not called";}function k(a){f();var b=d[a];return void 0!==b?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function a(a,b,d,e){a=c[a];if(void 0!==a&&(a=a[b],void 0!==a&&a[d])){if("object"===typeof a[d]&&void 0!==a[d].enumBitwiseOr){b=a[d].enumBitwiseOr;d=0;a=[];for(var h=0;h<b.length;++h){var g=m[b[h]];0!==(e&g)&&(d|=g,a.push(k(g)))}return d===e?a.join(" | "):k(e)}return k(e)}return null===
e?"null":void 0===e?"undefined":e.toString()}function g(a,b,c){a.__defineGetter__(c,function(){return b[c]});a.__defineSetter__(c,function(a){b[c]=a})}function b(c,d,e,m){function h(a,b){return function(){e&&e(b,arguments);var c=a[b].apply(a,arguments),h=m.getError();0!=h&&(l[h]=!0,d(h,b,arguments));return c}}m=m||c;p(c);d=d||function(b,c,d){for(var e="",h=d.length,g=0;g<h;++g)e+=(0==g?"":", ")+a(c,h,g,d[g]);b="WebGL error "+k(b)+" in "+c+"("+e+")";window.console&&window.console.error?window.console.error(b):
window.console&&window.console.log&&window.console.log(b)};var l={},f={},n;for(n in c)if("function"==typeof c[n])if("getExtension"!=n)f[n]=h(c,n);else{var q=h(c,n);f[n]=function(){var a=q.apply(c,arguments);return b(a,d,e,m)}}else g(f,c,n);f.getError=function(){for(var a in l)if(l.hasOwnProperty(a)&&l[a])return l[a]=!1,a;return c.NO_ERROR};return f}function e(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);for(var d=0;d<b;++d)a.disableVertexAttribArray(d),
a.vertexAttribPointer(d,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(d,0);a.deleteBuffer(c);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(d=0;d<b;++d)a.activeTexture(a.TEXTURE0+d),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);
a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var c={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},
drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,
2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,
1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},
frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},d=null,m=null;return{init:p,mightBeEnum:function(a){f();return void 0!==d[a]},glEnumToString:k,glFunctionArgToString:a,glFunctionArgsToString:function(b,c){for(var d="",e=c.length,h=0;h<e;++h)d+=(0==h?"":", ")+a(b,e,h,c[h]);return d},makeDebugContext:b,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function c(){for(var a=
Object.keys(N),b=0;b<a.length;++b)delete N[a]}function d(){++p;C||E==p&&a.loseContext()}function l(a,b){var c=a[b];return function(){d();if(!C)return c.apply(a,arguments)}}function m(a){return{statusMessage:a,preventDefault:function(){H=!0}}}function k(a){for(var b in a)"function"==typeof a[b]?x[b]=l(a,b):g(x,a,b);x.getError=function(){d();if(!C)for(var a;a=f.getError();)N[a]=!0;for(a in N)if(N[a])return delete N[a],a;return x.NO_ERROR};var c="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");
for(b=0;b<c.length;++b){var e=c[b];x[e]=function(b){return function(){d();if(C)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=B;D.push(c);return c}}(a[e])}c="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(b=0;b<c.length;++b)e=c[b],x[e]=function(b){return function(){d();return C?null:b.apply(a,arguments)}}(x[e]);c="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(b=0;b<c.length;++b)e=c[b],x[e]=function(b){return function(){d();return C?!1:b.apply(a,arguments)}}(x[e]);x.checkFramebufferStatus=function(b){return function(){d();return C?x.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(x.checkFramebufferStatus);x.getAttribLocation=function(b){return function(){d();
return C?-1:b.apply(a,arguments)}}(x.getAttribLocation);x.getVertexAttribOffset=function(b){return function(){d();return C?0:b.apply(a,arguments)}}(x.getVertexAttribOffset);x.isContextLost=function(){return C};return x}var f,x,z=[],w=[];x={};var B=1,C=!1,D=[],E=0,p=0,H=!1,I=0,N={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=f){if(f)throw"got different context";f=c;x=k(f)}return x}return c}}(a.getContext);(function(a){var c=a.addEventListener;
a.addEventListener=function(d,e,h){switch(d){case "webglcontextlost":z.push(b(e));break;case "webglcontextrestored":w.push(b(e));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!C){C=!0;E=0;for(++B;f.getError(););c();N[f.CONTEXT_LOST_WEBGL]=!0;var b=m("context lost"),d=z.slice();setTimeout(function(){for(var c=0;c<d.length;++c)d[c](b);0<=I&&setTimeout(function(){a.restoreContext()},I)},0)}};a.restoreContext=function(){C&&w.length&&setTimeout(function(){if(!H)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<D.length;++a){var b=D[a];b instanceof WebGLBuffer?f.deleteBuffer(b):b instanceof WebGLFramebuffer?f.deleteFramebuffer(b):b instanceof WebGLProgram?f.deleteProgram(b):b instanceof WebGLRenderbuffer?f.deleteRenderbuffer(b):b instanceof WebGLShader?f.deleteShader(b):b instanceof WebGLTexture&&f.deleteTexture(b)}e(f);C=!1;p=0;H=!1;for(var a=w.slice(),b=m("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(C)throw"You can not ask a lost contet to be lost";
E=p+a};a.getNumCalls=function(){return p};a.setRestoreTimeout=function(a){I=a};return a},resetToInitialState:e}})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.default=function(k){return window.WebGL2RenderingContext&&k instanceof window.WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/parts/Viewport":function(){define("require exports ../../../../core/has ../../../../core/libs/gl-matrix-2/gl-matrix ../lib/Camera ../lib/PerformanceTimer ./Visualizer".split(" "),
function(p,f,k,a,g,b,e){var c={fbo:null,lightDirection:null,camera:null,pixelRatio:1,disableSlice:!1};return function(){function b(b,c,d,k,f){this._content=new Map;this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null};this._needsRender=!0;this._rctx=f;this._gl=f.gl;this._visualizer=new e(b,c,d,k,this._rctx);this._camera=new g(a.vec3f64.fromValues(0,100,-100))}Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},
enumerable:!0,configurable:!0});b.prototype.getCombinedStats=function(){var a={},b=this._visualizer.getCombinedStats(),c;for(c in b)a[c]=b[c];a.renderGeometriesTotal=this._stats.renderGeometriesTotal;a.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==this._gl.getUsedTextureMemory&&(a.textureMemory=this._gl.getUsedTextureMemory());void 0!==this._gl.getUsedRenderbufferMemory&&(a.renderbufferMemory=this._gl.getUsedRenderbufferMemory());void 0!==this._gl.getUsedVBOMemory&&(a.VBOMemory=
this._gl.getUsedVBOMemory());if(void 0!==this._gl.getUsedTextureMemoryStats){var b=this._gl.getUsedTextureMemoryStats(),d;for(d in b)a["texMem type: "+d]=b[d]}return a};b.prototype.dispose=function(){this._visualizer.dispose();this._visualizer=null};b.prototype.setLighting=function(a){this._visualizer.setLighting(a)};b.prototype.setRenderParams=function(a){this._visualizer.setRenderParams(a)};b.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()};b.prototype.getEdgeView=
function(){return this._visualizer.getEdgeView()};b.prototype.modify=function(a,b,c,d){this._visualizer.modify(a,b,c,d);this._content=this._visualizer.getContent()};b.prototype.getContent=function(){return this._content};b.prototype.setCamera=function(a){this._camera.copyFrom(a);this._needsRender=!0};b.prototype.getCamera=function(){return this._camera};Object.defineProperty(b.prototype,"renderPlugins",{get:function(){return this._visualizer.renderPlugins},enumerable:!0,configurable:!0});b.prototype.getFramebufferTexture=
function(a){return this._visualizer.getFramebufferTexture(a)};b.prototype.render=function(a){c.camera=a.camera||this._camera;c.fbo=a.fbo;c.lightDirection=a.lightDirection;c.pixelRatio=a.pixelRatio||1;c.disableSlice=a.disableSlice||!1;this._visualizer.render(c)};b.prototype.resetNeedsRender=function(){this._needsRender=!1;this._visualizer.resetNeedsRender()};b.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()};return b}()})},"esri/views/3d/webgl-engine/parts/Visualizer":function(){define("require exports ../../../../core/TimeProfiler ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/debugFlags ../lib/depthRange ../lib/depthRangeUtils ../lib/HighlightHelper ../lib/OffscreenRenderingHelper ../lib/Renderer ../lib/RenderOccludedHelper ../lib/ShadowMap ../lib/SliceHelper ../lib/SSAOHelper ../lib/Util".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t){var u=t.assert;return function(){function f(a,b,e,g,k){this._drawSSAOMapDebugQuad=this._drawShadowMapDebugQuad=!1;this._needsRender=!0;this._content=new Map;this._stage=a;this._rctx=k;this._renderer=new m(b,e,g,this._rctx,!1);this._programRep=b;this._helpers={shadowMap:new h(b,this._rctx),ssao:new q(b,this._rctx,this.setNeedsRender.bind(this)),highlight:new c(b,this._rctx),renderOccluded:new l(b,this._rctx),slice:new n,offscreenRendering:new d(b,this._rctx)}}
Object.defineProperty(f.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0});f.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()};f.prototype.dispose=function(){this._renderer.dispose();this._helpers.shadowMap.enabled=!1;this._helpers.shadowMap.dispose();this._helpers.ssao.enabled=!1;this._helpers.ssao.dispose();this._helpers.highlight.enabled=!1;this._helpers.renderOccluded.enabled=!1;this._helpers.offscreenRendering.enabled=
!1};f.prototype.setLighting=function(a){this._renderer.setLighting(a)};f.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._helpers.shadowMap.enabled&&(this._helpers.shadowMap.textureResolution=a.shadowMapResolution);void 0!==a.shadowMap&&(this._helpers.shadowMap.enabled=a.shadowMap);void 0!==a.shadowMapMaxCascades&&(this._helpers.shadowMap.maxCascades=a.shadowMapMaxCascades);this._helpers.highlight.enabled=!0;void 0!==a.ssao&&(this._helpers.ssao.enabled=a.ssao);void 0!==
a.ssaoAttenuation&&(this._helpers.ssao.attenuation=a.ssaoAttenuation);void 0!==a.ssaoRadius&&(this._helpers.ssao.radius=a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&(this._helpers.ssao.samples=a.ssaoSamples);void 0!==a.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=a.drawShadowMapDebugQuad);void 0!==a.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=a.drawSSAODebugQuad);this._renderer.ssaoEnabled=
this._helpers.ssao.enabled;void 0!==a.offscreenRendering&&(this._helpers.offscreenRendering.enabled=a.offscreenRendering);a.background&&(this._helpers.offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=a.antialiasingEnabled?"smaa":"none");void 0!==a.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=a.earlyOcclusionPixelDraw);void 0!==a.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(a.defaultHighlightOptions);
void 0!==a.slicePlane&&(this._helpers.slice.plane=a.slicePlane);this._needsRender=!0};f.prototype.getRenderParams=function(){var a={};a.shadowMap=this._helpers.shadowMap.enabled;a.shadowMapResolution=this._helpers.shadowMap.textureResolution;a.shadowMapMaxCascades=this._helpers.shadowMap.maxCascades;this._helpers.ssao.isSupported&&(a.ssao=this._helpers.ssao.enabled,a.ssaoAttenuation=this._helpers.ssao.attenuation,a.ssaoRadius=this._helpers.ssao.radius,a.ssaoFilterRadius=this._helpers.ssao.filterRadius,
a.ssaoSamples=this._helpers.ssao.samples);return a};f.prototype.getFramebufferTexture=function(a){switch(a){case "color":return this._helpers.offscreenRendering.colorTexture;case "hudVisibility":return this._helpers.offscreenRendering.hudVisibilityTexture;case "shadowMap":return this._helpers.shadowMap.getDepthTexture()}return this._renderer.getFramebufferTexture(a)};f.prototype.modify=function(a,b,c,d){this._renderer.modify(a,b,c,d);for(d=0;d<b.length;++d)this._content.delete(b[d].uniqueName);for(d=
0;d<a.length;++d)this._content.set(a[d].uniqueName,a[d]);for(d=0;d<c.length;++d)u(this._content.get(c[d].renderGeometry.uniqueName)===c[d].renderGeometry)};f.prototype.getContent=function(){return this._content};f.prototype.getProjectionMatrix=function(b,c,d,e,h){c=t.fovx2fovy(c,b[2],b[3]);a.mat4.perspective(h,180*c/Math.PI,b[2]/b[3],d,e)};Object.defineProperty(f.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0});f.prototype.resetNeedsRender=
function(){this._needsRender=!1;this._renderer.resetNeedsRender()};f.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()};f.prototype.setNeedsRender=function(){this._needsRender=!0};f.prototype.render=function(b){var c=b.camera,d=b.fbo,e=b.lightDirection,h=c.viewport,l=this._helpers.slice.plane;b.disableSlice&&(this._helpers.slice.plane=null);this._renderer.prepareRender(c);if(this._helpers.shadowMap.enabled){g.ENABLE_PROFILE_DEPTH_RANGE&&k.begin("depthRange");
var m=this.computeDepthRange(c);g.ENABLE_PROFILE_DEPTH_RANGE&&k.end("depthRange");this._helpers.shadowMap.prepare(c,e,this._content,m);e=this._helpers.shadowMap.getCascades();for(m=0;m<e.length;++m){var f=e[m];f.camera.setGLViewport(this._rctx);b.camera=f.camera;this._renderer.renderGeometryPass(3,b,null,null,this._helpers.slice)}b.camera=c;this._helpers.shadowMap.finish(d);c.setGLViewport(this._rctx)}this._helpers.shadowMap.bindAll(this._programRep);this._renderer.renderAuxiliaryBuffers(b,this._helpers);
this._renderer.render(b,this._helpers);this._drawShadowMapDebugQuad&&this._helpers.shadowMap.enabled&&(b=a.mat4.ortho(a.mat4f64.create(),h[0],h[2],h[1],h[3],-1,1),this._helpers.shadowMap.drawDebugQuad(b));this._drawSSAOMapDebugQuad&&this._helpers.ssao.enabled&&(b=a.mat4.ortho(a.mat4f64.create(),h[0],h[2],h[1],h[3],-1,1),this._helpers.ssao.drawQuad(b));this._helpers.slice.plane=l};f.prototype.getEdgeView=function(){return this._renderer.edgeView};f.prototype.computeDepthRange=function(a){var c=e.depthRangeFromScene(a,
this._content,this._stage.getLayers());b.union(c,this.renderPlugins.queryDepthRange(a));c.near=Math.max(a.near,c.near);c.far=Math.min(a.far,c.far);return c};return f}()})},"esri/core/TimeProfiler":function(){define(["require","exports"],function(p,f){p=function(){function k(a,g){void 0===g&&(g=.9);this._alpha=.9;this._name=a;this._alpha=g;this.reset()}k.prototype.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};Object.defineProperty(k.prototype,"name",{get:function(){return this._name},
enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"average",{get:function(){return 0<this._count?this._sum/this._count:0},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,
"max",{get:function(){return this._max},enumerable:!0,configurable:!0});k.prototype.begin=function(){this._startTime=performance.now()};k.prototype.end=function(){var a=performance.now()-this._startTime;this._count+=1;this._sum+=a;this._smooth=this._alpha*a+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,a);this._max=Math.max(this._max,a)};k.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};return k}();
(function(k){function a(a){a in b||(b[a]=new k(a));return b[a]}function g(b){console.log(a(b).toJSON())}var b={},e={};k.get=a;k.begin=function(b){a(b).begin()};k.end=function(b,d){void 0===d&&(d=!0);a(b).end();var c=performance.now();!d||b in e&&!(c>=e[b]+1E3)||(g(b),e[b]=c)};k.log=g;k.logAll=function(){for(var a in b)g(a)}})(p||(p={}));return p})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/geometryUtils ../../support/mathUtils ./ComponentUtils ./depthRange ./Util".split(" "),
function(p,f,k,a,g,b,e,c,d){function m(a,b){if(b.isVisible){var d=c.empty(),e=b.getObjects();b.getSpatialQueryAccelerator()?l(d,a,b.getSpatialQueryAccelerator()):h(d,a,e);return d}}function l(a,b,d){var e=b.eye,h=b.viewForward,g=b.frustum,l=function(a){return!a.areAllComponentsHidden()},m=d.objectCount;500>m?(c.set(z,b.near,Math.min(a.near,b.far)),d.forEachInDepthRange(e,h,"front-to-back",z,function(c,d){n(a,b,c);z.far=a.near;d.setRange(z)},g,l),c.set(z,Math.max(a.far,b.near),b.far),d.forEachInDepthRange(e,
h,"back-to-front",z,function(c,d){n(a,b,c);z.near=a.far;d.setRange(z)},g,l)):(m=Math.max(Math.min(m,500),Math.ceil(.1*m)),e=d.findClosest(h,"front-to-back",g,l,m),d=d.findClosest(h,"back-to-front",g,l,m),e&&d&&(t(a,b,e.getCenter(),e.getBSRadius()),t(a,b,d.getCenter(),d.getBSRadius())))}function h(a,b,d){w.clear();d.forEach(function(a){a.areAllComponentsHidden()||w.add(a)});w.empty||(w.sort(b),c.set(z,b.near,Math.min(a.near,b.far)),w.forEachInDepthRange(z,"front-to-back",function(c,d,e){d<a.near&&
n(a,b,c)}),c.set(z,Math.max(a.far,b.near),b.far),w.forEachInDepthRange(z,"back-to-front",function(b,c,d){a.far=Math.max(a.far,d)}))}function n(c,d,e){if(!e.areAllComponentsHidden()&&g.frustum.intersectsSphere(d.frustum,g.sphere.wrap(e.getBSRadius(),e.getCenter()))){var h=e.objectTransformation,l=x;e.geometryRecords.forEach(function(e){a.mat4.multiply(l,h,e.getShaderTransformation());var g=b.maxScale(l);q(c,d,e.geometry.boundingInfo,l,g)})}}function q(b,c,d,e,h){var l=c.eye,m=c.viewForward;a.vec3.transformMat4(y,
d.center,e);l=m[0]*(y[0]-l[0])+m[1]*(y[1]-l[1])+m[2]*(y[2]-l[2]);m=d.bsRadius*h;if(!(l-m>b.near&&l+m<b.far)&&g.frustum.intersectsSphere(c.frustum,g.sphere.wrap(m,y)))if(100<d.bsRadius&&d.getChildren())for(d=d.getChildren(),l=0;8>l;++l)d[l]&&q(b,c,d[l],e,h);else C.unionDepthRangeWithAABB(b,c.viewProjectionMatrix,e,d.bbMin,d.bbMax)}function t(a,b,c,d){var e=b.eye;b=b.viewForward;c=(c[0]-e[0])*b[0]+(c[1]-e[1])*b[1]+(c[2]-e[2])*b[2];a.near=Math.min(a.near,c-d);a.far=Math.max(a.far,c+d)}Object.defineProperty(f,
"__esModule",{value:!0});f.depthRangeFromScene=function(a,b,d){if(1E4>b.size)return B.compute(a,b);b=c.empty();for(var e in d){var h=d[e];h.isVisible&&c.union(b,m(a,h))}return b};f.depthRangeFromLayer=m;p=function(){function a(){this._items=new k({allocator:function(a){return a||{obj:null,distance:0,near:0,far:0}},deallocator:function(a){a.obj=null;a.distance=0;a.near=0;a.far=0;return a}})}Object.defineProperty(a.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this._items.clear()};a.prototype.add=function(a){this._items.pushNew().obj=a};a.prototype.sort=function(a){var b=a.eye,c=a.viewForward;this._items.forEach(function(a){var d=a.obj,e=d.getCenter(),d=d.getBSRadius(),e=(e[0]-b[0])*c[0]+(e[1]-b[1])*c[1]+(e[2]-b[2])*c[2];a.distance=e;a.near=e-d;a.far=e+d});this._items.sort(function(a,b){return a.distance-
b.distance})};a.prototype.forEachInDepthRange=function(a,b,c){if("front-to-back"===b)for(b=0;b<this._items.length;++b){var d=this._items.data[b];d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)}else for(b=this._items.length-1;0<=b;--b)d=this._items.data[b],d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)};return a}();var u=function(){function c(){this.view=a.mat4f64.create();this.viewProj=a.mat4f64.create();this.frustum=g.frustum.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=
[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}c.prototype.compute=function(b,c){var d=this;this.reset();a.mat4.copy(this.view,b.viewMatrix);a.mat4.multiply(this.viewProj,b.projectionMatrix,this.view);g.frustum.copy(b.frustum,this.frustum);b=this.view;var h=b[2],l=b[6],m=b[10],k=b[14];b=this.range;var f=0;c.forEach(function(a){if(!e.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)&&a.castShadow){var b,c;a.hasShaderTransformation?(b=a.getBoundingSphere(a.getShaderTransformation(),
1,y),c=y):(b=a.bsRadius,c=a.center);c=h*c[0]+l*c[1]+m*c[2]+k;d.geometries[f]=a;d.near[f]=-(c+b);d.far[f]=-(c-b);++f}});if(0===this.geometries.length)return b;for(c=0;c<this.geometries.length;++c)this.near[c]>b.far&&(b.far=this.near[c]),2<this.near[c]&&this.far[c]<b.near&&(b.near=this.far[c]);var n=this.looseRange;n.near=Math.max(.5*b.near,2);n.far=2*b.far;var q=0,r=0;for(c=0;c<this.geometries.length;++c)this.near[c]<b.near&&(this.near[c]>=n.near?b.near=this.near[c]:this.nearCandidates[q++]=c),this.far[c]>
b.far&&(this.far[c]<=n.far?b.far=this.far[c]:this.farCandidates[r++]=c);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return b;this.nearCandidates.sort(function(a,b){return d.near[a]<d.near[b]?-1:d.near[a]>d.near[b]?1:0});this.farCandidates.sort(function(a,b){return d.far[a]<d.far[b]?1:d.far[a]>d.far[b]?-1:0});for(c=0;c<this.nearCandidates.length;++c)n=this.nearCandidates[c],this.near[n]<b.near&&(n=this.geometries[n],q=n.boundingInfo,this.includeNearBoundingInfoRec(q,n.getShaderTransformation()));
for(c=0;c<this.farCandidates.length;++c)n=this.farCandidates[c],this.far[n]>b.far&&(n=this.geometries[n],q=n.boundingInfo,this.includeFarBoundingInfoRec(q,n.getShaderTransformation()));return b};c.prototype.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};c.prototype.includeNearBoundingInfoRec=function(c,d){var e=c.getBSRadius(),h=c.getCenter();
a.vec3.transformMat4(y,h,d);var g=b.maxScale(d),h=y[0],l=y[1],m=y[2],e=e*g,g=this.frustum.planes;if(!(g[0][0]*h+g[0][1]*l+g[0][2]*m+g[0][3]>e||g[1][0]*h+g[1][1]*l+g[1][2]*m+g[1][3]>e||g[2][0]*h+g[2][1]*l+g[2][2]*m+g[2][3]>e||g[3][0]*h+g[3][1]*l+g[3][2]*m+g[3][3]>e||(h=this.view[2]*h+this.view[6]*l+this.view[10]*m+this.view[14],l=h+e,2>-(h-e)||-l>=this.range.near)))if(-l>this.looseRange.near)this.range.near=-l;else{if(100<e&&(e=c.getChildren(),void 0!==e)){for(c=0;8>c;++c)void 0!==e[c]&&this.includeNearBoundingInfoRec(e[c],
d);return}C.unionDepthRangeWithAABB(this.range,this.viewProj,d,c.getBBMin(),c.getBBMax())}};c.prototype.includeFarBoundingInfoRec=function(c,d){var e=c.getBSRadius(),h=c.getCenter();a.vec3.transformMat4(y,h,d);var g=b.maxScale(d),h=y[0],l=y[1],m=y[2],e=e*g,g=this.frustum.planes;if(!(g[0][0]*h+g[0][1]*l+g[0][2]*m+g[0][3]>e||g[1][0]*h+g[1][1]*l+g[1][2]*m+g[1][3]>e||g[2][0]*h+g[2][1]*l+g[2][2]*m+g[2][3]>e||g[3][0]*h+g[3][1]*l+g[3][2]*m+g[3][3]>e||(h=this.view[2]*h+this.view[6]*l+this.view[10]*m+this.view[14]-
e,-h<=this.range.far)))if(-h<this.looseRange.far)this.range.far=-h;else{if(100<e&&(e=c.getChildren(),void 0!==e)){for(c=0;8>c;++c)void 0!==e[c]&&this.includeFarBoundingInfoRec(e[c],d);return}C.unionDepthRangeWithAABB(this.range,this.viewProj,d,c.getBBMin(),c.getBBMax())}};return c}();f.DepthRangeFromRenderGeometries=u;f=function(){function b(){this.modelViewProj=a.mat4f64.create();this.clipPosition=[a.vec4f64.create(),a.vec4f64.create(),a.vec4f64.create(),a.vec4f64.create(),a.vec4f64.create(),a.vec4f64.create(),
a.vec4f64.create(),a.vec4f64.create()]}b.prototype.unionDepthRangeWithAABB=function(b,c,d,e,h){var g=this.modelViewProj;a.mat4.multiply(g,c,d);c=!1;for(d=0;8>d;++d){var l=this.clipPosition[d],m=0===d||3===d||4===d||7===d?e[0]:h[0],k=0===d||1===d||4===d||5===d?e[1]:h[1],f=4>d?e[2]:h[2];l[0]=g[0]*m+g[4]*k+g[8]*f+g[12];l[1]=g[1]*m+g[5]*k+g[9]*f+g[13];l[2]=g[2]*m+g[6]*k+g[10]*f+g[14];l[3]=g[3]*m+g[7]*k+g[11]*f+g[15]}for(d=0;12>d;++d){e=this.clipTriangle(this.clipPosition[r[d][0]],this.clipPosition[r[d][1]],
this.clipPosition[r[d][2]]);h=!0;for(g=0;g<e.length;++g)if(l=e[g][3],2<=l){h=!1;break}if(!h)for(c=!0,g=0;g<e.length;++g)l=e[g][3],l<b.near&&(b.near=l),l>b.far&&(b.far=l)}return c};b.prototype.inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];d.assert(!1)};b.prototype.intersect=function(b,c,d){var e=0;0===d?e=(-b[3]-b[0])/(c[0]-b[0]+c[3]-b[3]):1===d?e=(-b[3]-b[1])/(c[1]-b[1]+c[3]-b[3]):2===d?e=(b[3]-b[0])/(c[0]-b[0]-c[3]+
b[3]):3===d&&(e=(b[3]-b[1])/(c[1]-b[1]-c[3]+b[3]));return a.vec4.lerp(a.vec4f64.create(),b,c,e)};b.prototype.clipTriangle=function(a,b,c){a=[a,b,c];for(b=0;4>b;++b){c=a;a=[];for(var d=0;d<c.length;++d){var e=c[d],h=c[(d+1)%c.length];this.inside(h,b)?(this.inside(e,b)||a.push(this.intersect(e,h,b)),a.push(h)):this.inside(e,b)&&a.push(this.intersect(e,h,b))}}return a};return b}();var r=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],y=a.vec3f64.create(),
x=a.mat4f64.create(),z=c.empty(),w=new p,B=new u,C=new f})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/HighlightPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),function(p,f,k,a,g,b,e,c,d,m,l,h,n){return function(){function f(a,
b){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=b;this.viewportToRestore=k.vec4f64.create();this.defaultOptions={color:k.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};this.blurProgram=a.getProgram(d.blurPass,{gaussianSamples:5});this.blurGridProgram=a.getProgram(d.blurPass,{gaussianSamples:5,
gridOptimization:!0});this.applyProgram=a.getProgram(d.applyPass);this.applyGridProgram=a.getProgram(d.applyPass,{gridOptimization:!0});this.applyGridDebugProgram=a.getProgram(d.applyPass,{gridOptimization:!0,gridDebug:!0});this.downsampleProgram=a.getProgram(d.downsamplePass)}Object.defineProperty(f.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"profilingCallback",
{get:function(){return a.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});f.prototype.setDefaultOptions=function(a){this.defaultOptions=a};f.prototype.render=function(b,d){var e=!a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,g=a.HIGHLIGHTS_VISUALIZE_BLOCKS,l=b.camera,m=b.fbo,f=this._rctx;c.assert(this.enabled);k.vec4.copy(this.viewportToRestore,l.fullViewport);var n=Math.ceil(d.width/1),q=Math.ceil(d.height/1);this.blur0Fbo.resize(n,q);this.blur1Fbo.resize(n,
q);f.bindVAO(this.quadVAO);f.setDepthWriteEnabled(!1);f.setDepthTestEnabled(!1);f.setBlendingEnabled(!1);var u=null,t=l=u=null;if(e){var p=this._grid;this._gridUpdateResources(d,32);this._gridComputeMipmap();l=p.vao;t=4;u=this.blurGridProgram;f.bindProgram(u);f.bindTexture(p.coverageMipmap[p.mipmapLevels].colorTexture,1);u.setUniform1i("coverageTex",1)}else l=this.quadVAO,t=5,u=this.blurProgram,f.bindProgram(u);f.bindVAO(l);f.bindFramebuffer(this.blur0Fbo);f.setViewport(0,0,n,q);f.setClearColor(0,
0,0,0);f.clear(f.gl.COLOR_BUFFER_BIT);u.setUniform1i("tex",0);f.bindTexture(d.colorTexture,0);u.setUniform2f("blurSize",1/n,0);f.drawArrays(t,0,h.vertexCount(l,"geometry"));f.bindFramebuffer(this.blur1Fbo);f.clear(f.gl.COLOR_BUFFER_BIT);f.bindTexture(this.blur0Fbo.colorTexture,0);u.setUniform2f("blurSize",0,1/q);f.drawArrays(t,0,h.vertexCount(l,"geometry"));f.bindFramebuffer(m);f.setBlendingEnabled(!0);f.setBlendFunctionSeparate(770,771,1,771);f.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],
this.viewportToRestore[2],this.viewportToRestore[3]);e?(u=g?this.applyGridDebugProgram:this.applyGridProgram,f.bindProgram(u),u.setUniform1i("coverageTex",2),f.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(u=this.applyProgram,f.bindProgram(u));u.setUniform1i("tex",0);f.bindTexture(this.blur1Fbo.colorTexture,0);u.setUniform1i("origin",1);f.bindTexture(d.colorTexture,1);b=b.pixelRatio||1;u.setUniform4fv("color",this.defaultOptions.color);u.setUniform1f("outlineSize",
8.6*b);u.setUniform1f("blurSize",.4*b);u.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);f.drawArrays(t,0,h.vertexCount(l,"geometry"));f.bindVAO(null);f.setDepthWriteEnabled(!0);f.setDepthTestEnabled(!0);f.setBlendingEnabled(!1)};f.prototype.enable=function(){if(!this.enabled){this.quadVAO=e.createQuadVAO(this._rctx);var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},
b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=l.createWithAttachments(this._rctx,b,a);this.blur1Fbo=l.createWithAttachments(this._rctx,b,a)}};f.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};f.prototype._gridUpdateResources=function(a,c){var d=this._rctx,e=this._grid,h=!1;null===e.coverageMipmap&&(e.coverageMipmap=[a],
h=!0);if(e.viewportWidth!==a.width||e.viewportHeight!==a.height)h=!0,e.viewportWidth=a.width,e.viewportHeight=a.height;e.coverageMipmap[0]=a;e.cellPixelSize!==c&&(e.cellPixelSize=c,h=!0);if(h){for(c=1;c<e.coverageMipmap.length;c++)e.coverageMipmap[c].dispose();e.mipmapLevels=Math.ceil(Math.log(e.cellPixelSize)*Math.LOG2E);e.coverageMipmap.length=e.mipmapLevels+1;for(c=0;c<e.mipmapLevels;c++)h=e.coverageMipmap[c],h=l.createWithAttachments(d,{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,
wrapMode:33071,width:Math.ceil(h.width/2),height:Math.ceil(h.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(h.width/2),height:Math.ceil(h.height/2)}),e.coverageMipmap[c+1]=h}var h=Math.ceil(a.height/e.cellPixelSize),k=Math.ceil(a.width/e.cellPixelSize);if(!e.vao||e.verticalCellCount!==h||e.horizontalCellCount!==k){e.verticalCellCount=h;e.horizontalCellCount=k;a=h+1;c=k+1;for(var h=1/h,k=1/k,f=new Float32Array(24*a*c),q=0,u=0;u<a;u++)for(var t=0;t<c;t++)f[q+0]=(t-.5)*k*2-1,f[q+1]=(u-
.5)*h*2-1,f[q+2]=t*k,f[q+3]=u*h,f[q+4]=(t+.5)*k*2-1,f[q+5]=(u-.5)*h*2-1,f[q+6]=t*k,f[q+7]=u*h,f[q+8]=(t-.5)*k*2-1,f[q+9]=(u+.5)*h*2-1,f[q+10]=t*k,f[q+11]=u*h,f[q+12]=(t-.5)*k*2-1,f[q+13]=(u+.5)*h*2-1,f[q+14]=t*k,f[q+15]=u*h,f[q+16]=(t+.5)*k*2-1,f[q+17]=(u-.5)*h*2-1,f[q+18]=t*k,f[q+19]=u*h,f[q+20]=(t+.5)*k*2-1,f[q+21]=(u+.5)*h*2-1,f[q+22]=t*k,f[q+23]=u*h,q+=24;e.vao&&e.vao.dispose(!0);e.vao=new n(d,g.Default3D,{geometry:b.Pos2Tex},{geometry:m.createVertex(d,35044,f)})}};f.prototype._gridComputeMipmap=
function(){var a=this._rctx,b=this._grid,c=this.downsampleProgram;a.bindVAO(this.quadVAO);for(var d=0;d<b.mipmapLevels;d++){a.bindFramebuffer(b.coverageMipmap[d+1]);a.bindTexture(b.coverageMipmap[d].colorTexture,0);var e=b.coverageMipmap[d+1].width,g=b.coverageMipmap[d+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/e,1/g);a.setViewport(0,0,e,g);a.drawArrays(5,0,h.vertexCount(this.quadVAO,"geometry"))}};return f}()})},"esri/views/3d/webgl-engine/shaders/HighlightPrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});var b=function(a){return g.glslifyDefineMap({GRID_OPTIMIZATION:a.gridOptimization,GAUSSIAN_SAMPLES:a.gaussianSamples})},e=function(a){return g.glslifyDefineMap({GRID_OPTIMIZATION:a.gridOptimization,GRID_DEBUG:a.gridDebug})};f.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:a.resolveIncludes("renderer/highlight/downsample.vert"),
fragmentShader:a.resolveIncludes("renderer/highlight/downsample.frag")},attributes:k.Default3D};f.blurPass={name:"highlight-blur",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:b(c)+a.resolveIncludes("renderer/highlight/blur.frag")}},attributes:k.Default3D};f.applyPass={name:"highlight-apply",shaders:function(b){return{vertexShader:e(b)+a.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:e(b)+a.resolveIncludes("renderer/highlight/apply.frag")}},
attributes:k.Default3D}})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports ../../../../core/compilerUtils ./glUtil3D ./RenderTargetHelper ./Util ../shaders/OffscreenPrograms ../../../webgl/Util".split(" "),function(p,f,k,a,g,b,e,c){var d=[0,0,0,0],m=[0,1,0,1];return function(){function l(a,b){this.dimensions={width:4,height:4};this._enabled=!1;this._background={type:"color",color:[0,0,0,1]};this._rctx=b;b=this.renderTargetHelper=new g.RenderTargetHelper(b);
this.mainColor=b.registerColorTarget({name:"mainColor"});this.mainDepth=b.registerDepthTarget({name:"mainDepth"});this.hudVisibility=b.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=b.registerColorTarget({name:"tmpColor"});this.tmpDepth=b.registerDepthTarget({name:"tmpDepth"});this._compositeProgram=a.getProgram(e.compositePass);this._compositeTransparentToHUDVisibilityProgram=a.getProgram(e.compositeTransparentToHUDVisibilityPass)}Object.defineProperty(l.prototype,"width",
{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"background",{get:function(){return this._background},set:function(a){this._background=a},enumerable:!0,configurable:!0});
Object.defineProperty(l.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"depthTexture",{get:function(){return this.renderTargetHelper.getDepthTexture(this.mainDepth,this.dimensions)},enumerable:!0,configurable:!0});
Object.defineProperty(l.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0});l.prototype.initializeFrame=function(a,c){b.assert(this.enabled);var d=this._rctx,e=d.gl;a=a.fullViewport;this.dimensions.width=a[2];this.dimensions.height=a[3];this.mainFbo=c;this.bindTarget(this.mainColor,this.mainDepth);d.setClearStencil(0);c=this._background.color;d.setClearColor(c[0]*c[3],c[1]*c[3],c[2]*c[3],c[3]);d.clear(e.COLOR_BUFFER_BIT|
e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT)};l.prototype.renderSeparateAndComposite=function(a,b,c){void 0===b&&(b=d);void 0===c&&(c="none");this.renderToTargets(a,this.tmpColor,this.mainDepth,b);this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,c)};l.prototype.renderHUDVisibility=function(a){this.renderToTargets(a,this.hudVisibility,this.mainDepth,m)};l.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var a=this,b=this._rctx;this.renderToTargets(function(){var d=a._compositeTransparentToHUDVisibilityProgram;
b.bindProgram(d);d.setUniform1i("tex",1);b.bindTexture(a.getColorTexture(a.tmpColor),1);b.setDepthTestEnabled(!1);b.setBlendingEnabled(!1);b.setColorMask(!1,!0,!1,!1);b.bindVAO(a.quadVAO);b.drawArrays(5,0,c.vertexCount(a.quadVAO,"geometry"));b.setColorMask(!0,!0,!0,!0);b.setDepthTestEnabled(!0)},this.hudVisibility,this.mainDepth)};l.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")};l.prototype.bindFramebuffer=
function(){this._rctx.bindFramebuffer(this.framebuffer)};l.prototype.renderDepthDetached=function(a){this.bindTarget(this.mainColor);a();this.bindTarget(this.mainColor,this.mainDepth)};l.prototype.composite=function(a,b,d){void 0===a&&(a=this.framebuffer.colorTexture);void 0===b&&(b=this.mainFbo);void 0===d&&(d="none");var e=this._rctx,h=this._compositeProgram;e.bindFramebuffer(b);e.setDepthTestEnabled(!1);e.bindProgram(h);h.setUniform1i("tex",1);e.bindTexture(a,1);switch(d){case "none":e.setBlendingEnabled(!1);
break;case "alpha":e.setBlendFunctionSeparate(770,771,1,771);e.setBlendingEnabled(!0);break;case "premultiplied-alpha":e.setBlendFunction(1,771);e.setBlendingEnabled(!0);break;default:k.neverReached(d)}e.bindVAO(this.quadVAO);e.drawArrays(5,0,c.vertexCount(this.quadVAO,"geometry"));e.setDepthTestEnabled(!0);e.setBlendingEnabled(!1)};l.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=a.createQuadVAO(this._rctx))};l.prototype.disable=function(){this.enabled&&(this._enabled=!1,
this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=null)};l.prototype.renderToTargets=function(a,b,c,d,e){var h=this._rctx,g=h.gl;this.bindTarget(b,c);b=0;d&&(h.setClearColor(d[0],d[1],d[2],Math.max(1E-13,d[3])),b|=g.COLOR_BUFFER_BIT);e&&(b|=g.DEPTH_BUFFER_BIT);h.clear(b);a();g.flush();this.bindTarget(this.mainColor,this.mainDepth)};l.prototype.bindTarget=function(a,b){a=this.renderTargetHelper.getFramebuffer(this.dimensions,a,b);this._rctx.bindFramebuffer(a)};l.prototype.getColorTexture=
function(a){return this.renderTargetHelper.getColorTexture(a,this.dimensions)};return l}()})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});var e={dataType:5121},c={};p=function(){function d(a){this.rctx=a;this.framebuffers=new Map;this.depthTextures=new Map;
this.depthBuffers=new Map;this.colorTextures=new Map;this.nextId=1;this.depthTextureSupported=a.capabilities.depthTexture}d.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(a){return a.dispose()});this.depthBuffers.clear();this.depthTextures.forEach(function(a){return a.dispose()});this.depthTextures.clear();this.colorTextures.forEach(function(a){return a.dispose()});this.colorTextures.clear()};d.prototype.getDepthTexture=function(a,c){if(this.depthTextureSupported){var d=
this.depthTextures.get(a.id);!d||d.descriptor.width===c.width&&d.descriptor.height===c.height||(d.dispose(),d=void 0);d||(d=new b(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:c.width,height:c.height}),this.depthTextures.set(a.id,d));return d}};d.prototype.getDepthBuffer=function(a,b){if(!this.depthTextureSupported){var c=this.depthBuffers.get(a.id);c?c.descriptor.width===b.width&&c.descriptor.height===b.height||c.resize(b.width,b.height):(c=new g(this.rctx,
k({internalFormat:34041},b)),this.depthBuffers.set(a.id,c));return c}};d.prototype.getColorTexture=function(a,c){var d=this.colorTextures.get(a.id);!d||d.descriptor.width===c.width&&d.descriptor.height===c.height||(d.dispose(),d=void 0);d||(d=new b(this.rctx,{target:3553,pixelFormat:6408,dataType:a.dataType,samplingMode:9729,wrapMode:33071,width:c.width,height:c.height}),this.colorTextures.set(a.id,d));return d};d.prototype.registerDepthTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return k({id:b},
c,a)};d.prototype.registerColorTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return k({id:b},e,a)};d.prototype.getFramebuffer=function(b,c,d){var e=this.getKey(c,d),h=this.framebuffers.get(e);c=this.getColorTexture(c,b);if(this.depthTextureSupported){var g=d?this.getDepthTexture(d,b):void 0;if(!h)return h=d?a.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:4},g):a.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(e,h),h;if(d=
h.width!==b.width||h.height!==b.height||h.colorTexture!==c||h.depthStencilTexture!==g)h.detachColorTexture(),h.detachDepthStencilTexture(),h.resize(b.width,b.height),h.attachColorTexture(c),h.attachDepthStencilTexture(g)}else{g=d?this.getDepthBuffer(d,b):void 0;if(!h)return h=a.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:d?3:0},g),this.framebuffers.set(e,h),h;if(d=h.width!==b.width||h.height!==b.height||h.colorTexture!==c)h.detachColorTexture(),h.detachDepthStencilBuffer(),
h.resize(b.width,b.height),h.attachColorTexture(c),h.attachDepthStencilBuffer(g)}return h};d.prototype.getKey=function(a,b){return a.id+"_"+(b?b.id:"X")+"_"+a.name+(b?"_"+b.name:"")};return d}();f.RenderTargetHelper=p})},"esri/views/3d/webgl-engine/shaders/OffscreenPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.compositePass={name:"offscreen-composite",shaders:{vertexShader:a.resolveIncludes("renderer/offscreen/offscreen.vert"),
fragmentShader:a.resolveIncludes("renderer/offscreen/offscreen.frag")},attributes:k.Default3D};f.compositeTransparentToHUDVisibilityPass={name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:a.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:a.resolveIncludes("renderer/offscreen/transparentToHUDVisibility.frag")},attributes:k.Default3D}})},"esri/views/3d/webgl-engine/lib/RenderOccludedHelper":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ./glUtil3D ./Util ../shaders/OccludedPrograms ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(p,f,k,a,g,b,e,c){return function(){function d(a,c){this._quadVAO=null;this._rctx=c;this._colorFBO=void 0;this._viewportToRestore=k.vec4f64.create();this._combineProgram=a.getProgram(b.combinePass)}Object.defineProperty(d.prototype,"enabled",{get:function(){return void 0!==this._colorFBO},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});d.prototype.setupFBOs=function(a){g.assert(this.enabled);this._viewportToRestore=a=a.fullViewport;this._width=a[2];this._height=
a[3];this._rctx.setViewport(0,0,this._width,this._height)};d.prototype.prepareColorPass=function(){g.assert(this.enabled);var a=this._rctx,b=a.gl;this._colorFBO.resize(this._width,this._height);a.bindFramebuffer(this._colorFBO);a.setClearColor(0,0,0,0);a.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)};d.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])};d.prototype.apply=
function(){var a=this._rctx,b=this._combineProgram;a.bindProgram(b);a.bindVAO(this._quadVAO);a.bindTexture(this._colorFBO.colorTexture,0);b.setUniform1i("occludedColorMap",0);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunction(770,771);a.drawArrays(5,0,c.vertexCount(this._quadVAO,"geometry"));a.bindVAO(null);a.setDepthWriteEnabled(!0);a.setDepthTestEnabled(!0);a.setBlendingEnabled(!1)};d.prototype.enable=function(){this.enabled||(this._quadVAO=a.createQuadVAO(this._rctx),
this._colorFBO=e.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))};d.prototype.disable=function(){this.enabled&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=void 0)};return d}()})},"esri/views/3d/webgl-engine/shaders/OccludedPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(p,
f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.combinePass={name:"occluded-combine",shaders:{vertexShader:a.resolveIncludes("util/quad.vert"),fragmentShader:a.resolveIncludes("renderer/occluded/combine.frag")},attributes:k.Default3D}})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/mathUtils ./Camera ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/MiscPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t){function u(a,b){k.vec2.set(Z,a[b],a[b+3]);return Z}var r=function(){return function(){this.camera=new g;this.lightMat=k.mat4f64.create()}}();p=function(){function g(a,b){this.doShadowMapMipmapsWork=!1;this.textureRes=4096;this.numCascades=1;this.maxNumCascades=2;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.programRep=a;this.rctx=b;this.emptyTexture=c.createEmptyTexture(b);for(a=0;4>a;++a)this.cascades.push(new r)}g.prototype.dispose=function(){this.emptyTexture.dispose();
this.emptyTexture=null};Object.defineProperty(g.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(a){this.textureRes=a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(b){this.maxNumCascades=a.clamp(Math.floor(b),1,4)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(a){a?this.enable():this.disable()},
enumerable:!0,configurable:!0});g.prototype.getDepthTexture=function(){return this.depthTexture};g.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)P[a]=this.cascades[a];P.length=this.numCascades;return P};g.prototype.prepare=function(b,c,e,h){d.assert(this.enabled);k.mat4.multiply(x,b.projectionMatrix,b.viewMatrix);var g=h.near,l=h.far;2>g&&(g=2);2>l&&(l=2);g>=l&&(g=2,l=4);this.numCascades=Math.min(1+Math.floor(d.logWithBase(l/g,4)),this.maxNumCascades);e=Math.pow(l/g,1/this.numCascades);
for(h=0;h<this.numCascades+1;++h)this.cascadeDistances[h]=g*Math.pow(e,h);k.mat4.invert(z,x);k.mat4.lookAt(S,[0,0,0],[-c[0],-c[1],-c[2]],[0,1,0]);e=b.viewMatrix;b=b.projectionMatrix;for(h=0;h<this.numCascades;++h){var m=this.cascades[h],l=-this.cascadeDistances[h],g=-this.cascadeDistances[h+1],l=(b[10]*l+b[14])/Math.abs(b[11]*l+b[15]),g=(b[10]*g+b[14])/Math.abs(b[11]*g+b[15]);d.assert(l<g);for(var f=0;8>f;++f){k.vec4.set(w,0===f%4||3===f%4?-1:1,0===f%4||1===f%4?-1:1,4>f?l:g,1);k.vec4.transformMat4(B[f],
w,z);for(var n=0;3>n;++n)B[f][n]/=B[f][3]}k.vec3.negate(M,B[0]);k.mat4.translate(y,S,M);m.camera.viewMatrix=y;for(f=0;8>f;++f)k.vec3.transformMat4(B[f],B[f],m.camera.viewMatrix);k.vec3.copy(C,B[0]);k.vec3.copy(D,B[0]);for(f=1;8>f;++f)for(n=0;3>n;++n)C[n]=Math.min(C[n],B[f][n]),D[n]=Math.max(D[n],B[f][n]);C[2]-=200;D[2]+=200;m.camera.near=-D[2];m.camera.far=-C[2];g=1/B[0][3];l=1/B[4][3];d.assert(g<l);var n=g+Math.sqrt(g*l),f=Math.sin(a.acos(e[2]*c[0]+e[6]*c[1]+e[10]*c[2])),n=n/f,g=B,q=n,r=f,f=E,t=
G,p=H,O=I,n=N;k.vec2.set(Q,0,0);for(var Z=0;4>Z;++Z)k.vec2.add(Q,Q,g[Z]);k.vec2.scale(Q,Q,.25);k.vec2.set(J,0,0);for(Z=4;8>Z;++Z)k.vec2.add(J,J,g[Z]);k.vec2.scale(J,J,.25);k.vec2.lerp(F[0],g[4],g[5],.5);k.vec2.lerp(F[1],g[5],g[6],.5);k.vec2.lerp(F[2],g[6],g[7],.5);k.vec2.lerp(F[3],g[7],g[4],.5);for(var P=0,W=k.vec2.squaredDistance(F[0],Q),Z=1;4>Z;++Z){var ea=k.vec2.squaredDistance(F[Z],Q);ea<W&&(W=ea,P=Z)}k.vec2.subtract(K,F[P],g[P+4]);Z=K[0];K[0]=-K[1];K[1]=Z;k.vec2.subtract(L,J,Q);k.vec2.lerp(K,
K,L,r);k.vec2.normalize(K,K);P=r=void 0;r=P=k.vec2.dot(k.vec2.subtract(T,g[0],Q),K);for(Z=1;8>Z;++Z)W=k.vec2.dot(k.vec2.subtract(T,g[Z],Q),K),W<r?r=W:W>P&&(P=W);k.vec2.copy(f,Q);k.vec2.scale(T,K,r-q);k.vec2.add(f,f,T);for(var ea=-1,aa=1,Z=q=W=0;8>Z;++Z){k.vec2.subtract(R,g[Z],f);k.vec2.normalize(R,R);var fa=K[0]*R[1]-K[1]*R[0];0<fa?fa>ea&&(ea=fa,W=Z):fa<aa&&(aa=fa,q=Z)}d.verify(0<ea,"leftArea");d.verify(0>aa,"rightArea");k.vec2.scale(X,K,r);k.vec2.add(X,X,Q);k.vec2.scale(ba,K,P);k.vec2.add(ba,ba,
Q);ca[0]=-K[1];ca[1]=K[0];t=d.rayRay2D(f,g[q],ba,k.vec2.add(T,ba,ca),1,t);p=d.rayRay2D(f,g[W],ba,T,1,p);O=d.rayRay2D(f,g[W],X,k.vec2.add(T,X,ca),1,O);g=d.rayRay2D(f,g[q],X,T,1,n);d.verify(t,"rayRay");d.verify(p,"rayRay");d.verify(O,"rayRay");d.verify(g,"rayRay");p=E;g=G;f=I;O=N;n=m.camera.projectionMatrix;k.vec2.subtract(da,f,O);k.vec2.scale(da,da,.5);U[0]=da[0];U[1]=da[1];U[2]=0;U[3]=da[1];U[4]=-da[0];U[5]=0;U[6]=da[0]*da[0]+da[1]*da[1];U[7]=da[0]*da[1]-da[1]*da[0];U[8]=1;U[6]=-k.vec2.dot(u(U,0),
p);U[7]=-k.vec2.dot(u(U,1),p);p=k.vec2.dot(u(U,0),f)+U[6];t=k.vec2.dot(u(U,1),f)+U[7];Z=k.vec2.dot(u(U,0),O)+U[6];O=k.vec2.dot(u(U,1),O)+U[7];p=-(p+Z)/(t+O);U[0]+=U[1]*p;U[3]+=U[4]*p;U[6]+=U[7]*p;p=1/(k.vec2.dot(u(U,0),f)+U[6]);t=1/(k.vec2.dot(u(U,1),f)+U[7]);U[0]*=p;U[3]*=p;U[6]*=p;U[1]*=t;U[4]*=t;U[7]*=t;U[2]=U[1];U[5]=U[4];U[8]=U[7];U[7]+=1;p=k.vec2.dot(u(U,1),g)+U[7];t=k.vec2.dot(u(U,2),g)+U[8];Z=k.vec2.dot(u(U,1),f)+U[7];O=k.vec2.dot(u(U,2),f)+U[8];p=-.5*(p/t+Z/O);U[1]+=U[2]*p;U[4]+=U[5]*p;U[7]+=
U[8]*p;p=k.vec2.dot(u(U,1),g)+U[7];t=k.vec2.dot(u(U,2),g)+U[8];Z=-t/p;U[1]*=Z;U[4]*=Z;U[7]*=Z;n[0]=U[0];n[1]=U[1];n[2]=0;n[3]=U[2];n[4]=U[3];n[5]=U[4];n[6]=0;n[7]=U[5];n[8]=0;n[9]=0;n[10]=1;n[11]=0;n[12]=U[6];n[13]=U[7];n[14]=0;n[15]=U[8];m.camera.projectionMatrix[10]=2/(C[2]-D[2]);m.camera.projectionMatrix[14]=-(C[2]+D[2])/(C[2]-D[2]);k.mat4.multiply(m.lightMat,m.camera.projectionMatrix,m.camera.viewMatrix);g=this.textureRes/2;m.camera.viewport[0]=0===h%2?0:g;m.camera.viewport[1]=0===Math.floor(h/
2)?0:g;m.camera.viewport[2]=g;m.camera.viewport[3]=g}this.lastOrigin=null;this.cascadeDistances[this.numCascades]=100*l;c=this.rctx;h=c.gl;c.bindFramebuffer(this.fbo);c.bindTexture(null,7);c.setClearColor(1,1,1,1);c.clear(h.COLOR_BUFFER_BIT|h.DEPTH_BUFFER_BIT);c.setBlendingEnabled(!1)};g.prototype.finish=function(a){d.assert(this.enabled);this.rctx.bindFramebuffer(a);this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()};g.prototype.bind=function(a){var b=this.rctx,c=this.enabled;b.bindTexture(c?
this.depthTexture:this.emptyTexture,7);b.bindProgram(a);a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",c?.5/this.textureRes:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])};g.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var b=0;b<a.length;b++)this.bind(a[b])};g.prototype.bindView=function(a,b){if(this.enabled){var c=
this.lastOrigin;if(!c||c[0]!==b[0]||c[1]!==b[1]||c[2]!==b[2])for(this.lastOrigin=this.lastOrigin||k.vec3f64.create(),k.vec3.copy(this.lastOrigin,b),c=0;c<this.numCascades;++c){k.mat4.translate(O,this.cascades[c].lightMat,b);for(var d=0;16>d;++d)W[16*c+d]=O[d]}a.setUniformMatrix4fv("shadowMapMatrix",W)}};g.prototype.drawDebugQuad=function(a){d.assert(this.enabled);var c=this.rctx,h=c.gl;if(!this.debugQuadVAO){var g=new Float32Array([0,0,0,0,256,0,1,0,0,256,0,1,256,256,1,1]);this.debugQuadVAO=new t(c,
b.Default3D,{geometry:e.Pos2Tex},{geometry:l.createVertex(c,h.STATIC_DRAW,g)})}var g=this.programRep.getProgram(m.showDepth),k=this.debugQuadVAO;c.setDepthTestEnabled(!1);c.bindProgram(g);g.setUniformMatrix4fv("proj",a);g.setUniform1i("depthTex",0);c.bindTexture(this.depthTexture,0);c.bindVAO(k);q.assertCompatibleVertexAttributeLocations(k,g);c.drawArrays(h.TRIANGLE_STRIP,0,q.vertexCount(k,"geometry"));c.setDepthTestEnabled(!0)};g.prototype.enable=function(){if(!this.enabled){var a=this.rctx.gl;this.depthTexture=
new n(this.rctx,{target:a.TEXTURE_2D,pixelFormat:a.RGBA,dataType:a.UNSIGNED_BYTE,wrapMode:a.CLAMP_TO_EDGE,samplingMode:a.NEAREST,flipped:!0,width:this.textureRes,height:this.textureRes});this.fbo=h.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}};g.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.depthTexture=this.fbo=null)};return g}();var y=k.mat4f64.create(),x=k.mat4f64.create(),z=
k.mat4f64.create(),w=k.vec4f64.create(),B=[];for(f=0;8>f;++f)B.push(k.vec4f64.create());var C=k.vec3f64.create(),D=k.vec3f64.create(),E=k.vec2f64.create(),G=k.vec2f64.create(),H=k.vec2f64.create(),I=k.vec2f64.create(),N=k.vec2f64.create(),S=k.mat4f64.create(),M=k.vec3f64.create(),P=[],O=k.mat4f64.create(),W=new Float32Array(64),Q=k.vec2f64.create(),J=k.vec2f64.create(),F=[k.vec2f64.create(),k.vec2f64.create(),k.vec2f64.create(),k.vec2f64.create()],K=k.vec2f64.create(),L=k.vec2f64.create(),T=k.vec2f64.create(),
R=k.vec2f64.create(),X=k.vec2f64.create(),ba=k.vec2f64.create(),ca=k.vec2f64.create(),Z=k.vec2f64.create(),da=k.vec2f64.create(),U=k.mat3f64.create();return p})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../core/Logger ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/imageUtils ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/MiscPrograms ../shaders/SSAOPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u){var r=k.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");f=function(){function k(b,d,e){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=a.vec4f64.create();this._rctx=d;this._programRep=b;this._requestRender=e;this._emptyTexture=c.createEmptyTexture(d)}k.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=null};Object.defineProperty(k.prototype,"isSupported",{get:function(){var a=
this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),a=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return!(b||a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"attenuation",{get:function(){return this._attenuation},set:function(a){this._attenuation=a},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,
"radius",{get:function(){return this._radius},set:function(a){this._radius=a},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples=a;this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0});k.prototype.computeSSAO=function(b,e,h,g){if(this._noiseTexture){d.assert(this.enabled);var l=this._rctx,
m=h.width,k=h.height,f=m/this._BLUR_F,n=k/this._BLUR_F;this._ssaoFBO.resize(m,k);this._blur0FBO.resize(f,n);this._blur1FBO.resize(f,n);f=1*m;n=1*k;l.bindFramebuffer(this._ssaoFBO);a.vec4.copy(this._viewportToRestore,b.fullViewport);l.setViewport(0,0,m,k);var q=this._ssaoProgram,r=this._blurProgram;q.setUniform2f("rnmScale",m/this._noiseTexture.descriptor.width,k/this._noiseTexture.descriptor.height);q.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:
32>=this._samples?this._data.random32:this._data.random64);l.bindProgram(q);m=this._data.minDiscrepancy;q.setUniform1f("numSpiralTurns",this._samples<m.length?m[this._samples]:5779);m=x;k=y;d.inverseProjectionInfo(b.projectionMatrix,b.fullWidth,b.fullHeight,m,k);q.setUniform4fv("projInfo",m);q.setUniform2fv("zScale",k);q.setUniform2f("nearFar",b.near,b.far);m=1/b.computePixelSizeAtDist(1);q.setUniform1f("projScale",1*m);q.setUniform2f("screenDimensions",f,n);var u=2*this._radius,k=a.vec3.distance(b.eye,
b.center),u=20*b.computePixelSizeAtDist(k),u=Math.max(.1,u);q.setUniform1f("radius",u);q.setUniform1f("intensity",4*this._attenuation/Math.pow(u,6));q.setUniform1i("rnm",0);q.setUniform1i("normalMap",1);q.setUniform1i("depthMap",2);l.bindTexture(this._noiseTexture,0);l.bindTexture(g.colorTexture,1);l.bindTexture(h.colorTexture,2);h=c.createQuadVAO(this._rctx);l.bindVAO(h);l.drawArrays(5,0,t.vertexCount(h,"geometry"));l.bindTexture(this._ssaoFBO.colorTexture,0);l.setViewport(0,0,f/this._BLUR_F,n/this._BLUR_F);
l.bindFramebuffer(this._blur0FBO);r.setUniform2f("screenDimensions",f,n);r.setUniform1i("tex",0);r.setUniform1i("normalMap",1);r.setUniform1i("depthMap",2);r.setUniform2f("blurSize",0,1*this._BLUR_F/n);r.setUniform1i("radius",4);r.setUniform1f("g_BlurFalloff",.08);r.setUniform2f("nearFar",b.near,b.far);5E4<k&&(m=Math.max(0,m-(k-5E4)));r.setUniform1f("projScale",m);r.setUniform2f("zScale",1,0);l.drawArrays(5,0,t.vertexCount(h,"geometry"));r.setUniform2f("blurSize",1*this._BLUR_F/f,0);l.bindFramebuffer(this._blur1FBO);
l.bindTexture(this._blur0FBO.colorTexture,0);l.drawArrays(5,0,t.vertexCount(h,"geometry"));l.bindFramebuffer(e);l.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};k.prototype.setUniforms=function(a){var b=this.enabled&&this._noiseTexture,c=this._rctx;c.bindTexture(b?this._blur1FBO.colorTexture:this._emptyTexture,6);c.setActiveTexture(0);a.setUniform1i("ssaoTex",6);b?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],
this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};k.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b])};k.prototype.drawQuad=function(a){d.assert(this.enabled);var c=this._showDepthProgram;this._debugQuadVAO||(this._debugQuadVAO=new u(this._rctx,b.Default3D,{geometry:e.Pos2Tex},{geometry:h.createVertex(this._rctx,35044,z)}));var g=this._rctx;g.setDepthTestEnabled(!1);
c.setUniformMatrix4fv("proj",new Float32Array(a));c.setUniform1i("depthTex",0);g.bindTexture(this._ssaoFBO.colorTexture,0);g.bindVAO(this._debugQuadVAO);g.drawArrays(5,0,t.vertexCount(this._debugQuadVAO,"geometry"));g.setDepthTestEnabled(!0)};k.prototype.selectPrograms=function(){this._ssaoProgram=this._programRep.getProgram(l.ssaoPass,{samples:8>=this._samples?8:16>=this._samples?16:32>=this._samples?32:64});this._blurProgram=this._programRep.getProgram(l.blurPass,{radius:4});this._showDepthProgram=
this._programRep.getProgram(m.showDepth)};k.prototype.enable=function(){var a=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(function(){a._enabled&&a.initialize()})):r.warn("SSAO is not supported for this browser or hardware"))};k.prototype.loadResources=function(a){var b=this;this._data?a():p(["./SSAOHelperData"],function(c){b._data=c;a()})};k.prototype.initialize=function(){var a=this,b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,
height:0},c={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=n.createWithAttachments(this._rctx,b,c);this._blur0FBO=n.createWithAttachments(this._rctx,b,c);this._blur1FBO=n.createWithAttachments(this._rctx,b,c);g.requestImage(this._data.noiseTexture).then(function(b){a._enabled&&(a._noiseTexture=new q(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:b.width,height:b.height},b),a._requestRender())});this.selectPrograms()};k.prototype.disable=function(){this.enabled&&(this._enabled=
!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};return k}();var y=a.vec2f64.create(),x=a.vec4f64.create(),z=new Float32Array([0,0,0,0,512,0,1,0,0,512,0,1,512,512,1,1]);return f})},"esri/views/3d/webgl-engine/shaders/SSAOPrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.ssaoPass={name:"ssao",shaders:function(g){return{vertexShader:a.resolveIncludes("util/quad.vert"),fragmentShader:"#define SAMPLES "+g.samples+"\n"+a.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:k.Default3D};f.blurPass={name:"ssao-blur",shaders:function(g){return{vertexShader:a.resolveIncludes("util/quad.vert"),fragmentShader:"#define RADIUS "+g.radius+
"\n"+a.resolveIncludes("renderer/ssao/blur.frag")}},attributes:k.Default3D}})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ./enums ./InstanceCounter ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(p,f,k,a,g,b,e){return function(){function c(a,c){this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};
this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=
1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._lineWidth=1;this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=b.default(a)?"webgl2":"webgl";this.gl=a;a instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=
e.loadCapabilities(a,c);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],width:a[2],height:a[3]};a=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)};
this.enforceState()}Object.defineProperty(c.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});c.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};c.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):
this.gl.disable(this.gl.BLEND),this._blendEnabled=a)};c.prototype.setBlendColor=function(a,b,c,e){if(a!==this._blendColorState.r||b!==this._blendColorState.g||c!==this._blendColorState.b||e!==this._blendColorState.a)this.gl.blendColor(a,b,c,e),this._blendColorState.r=a,this._blendColorState.g=b,this._blendColorState.b=c,this._blendColorState.a=e};c.prototype.setBlendFunction=function(a,b){if(a!==this._blendFunctionState.srcRGB||b!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,b),this._blendFunctionState.srcRGB=
a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=b};c.prototype.setBlendFunctionSeparate=function(a,b,c,e){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==c||this._blendFunctionState.dstRGB!==b||this._blendFunctionState.dstAlpha!==e)this.gl.blendFuncSeparate(a,b,c,e),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=c,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=e};c.prototype.setBlendEquation=
function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a)};c.prototype.setBlendEquationSeparate=function(a,b){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==b)this.gl.blendEquationSeparate(a,b),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=b};c.prototype.setColorMask=function(a,b,c,e){if(this._colorMaskState.r!==a||this._colorMaskState.g!==b||this._colorMaskState.b!==
c||this._colorMaskState.a!==e)this.gl.colorMask(a,b,c,e),this._colorMaskState.r=a,this._colorMaskState.g=b,this._colorMaskState.b=c,this._colorMaskState.a=e};c.prototype.setClearColor=function(a,b,c,e){if(this._clearColor.r!==a||this._clearColor.g!==b||this._clearColor.b!==c||this._clearColor.a!==e)this.gl.clearColor(a,b,c,e),this._clearColor.r=a,this._clearColor.g=b,this._clearColor.b=c,this._clearColor.a=e};c.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):
this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a)};c.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=a)};c.prototype.setPolygonOffset=function(a,b){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==b)this._polygonOffset[0]=a,this._polygonOffset[1]=b,this.gl.polygonOffset(a,b)};c.prototype.setCullFace=function(a){this._cullFace!==
a&&(this.gl.cullFace(a),this._cullFace=a)};c.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a)};c.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};c.prototype.setScissorRect=function(a,b,c,e){if(this._scissorRect.x!==a||this._scissorRect.y!==b||this._scissorRect.width!==c||this._scissorRect.height!==e)this.gl.scissor(a,
b,c,e),this._scissorRect.x=a,this._scissorRect.y=b,this._scissorRect.width=c,this._scissorRect.height=e};c.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=a)};c.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};c.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a)};c.prototype.setDepthWriteEnabled=
function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a)};c.prototype.setDepthRange=function(a,b){if(this._depthRange.zNear!==a||this._depthRange.zFar!==b)this.gl.depthRange(a,b),this._depthRange.zNear=a,this._depthRange.zFar=b};c.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a)};c.prototype.setClearStencil=function(a){a!==this._clearStencil&&
(this.gl.clearStencil(a),this._clearStencil=a)};c.prototype.setStencilFunction=function(a,b,c){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==b||this._stencilFunction.mask!==c)this.gl.stencilFunc(a,b,c),this._stencilFunction.face=1032,this._stencilFunction.func=a,this._stencilFunction.ref=b,this._stencilFunction.mask=c};c.prototype.setStencilFunctionSeparate=function(a,b,c,e){if(this._stencilFunction.face!==a||this._stencilFunction.func!==b||this._stencilFunction.ref!==c||this._stencilFunction.mask!==
e)this.gl.stencilFuncSeparate(a,b,c,e),this._stencilFunction.face=a,this._stencilFunction.func=b,this._stencilFunction.ref=c,this._stencilFunction.mask=e};c.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=a)};c.prototype.setStencilOp=function(a,b,c){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==c)this.gl.stencilOp(a,b,c),this._stencilOperation.face=1032,this._stencilOperation.fail=
a,this._stencilOperation.zFail=b,this._stencilOperation.zPass=c};c.prototype.setStencilOpSeparate=function(a,b,c,e){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==b||this._stencilOperation.zFail!==c||this._stencilOperation.zPass!==e)this.gl.stencilOpSeparate(a,b,c,e),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=b,this._stencilOperation.zFail=c,this._stencilOperation.zPass=e};c.prototype.setLineWidth=function(a){var b=this._lineWidth;this._lineWidth!==
a&&(this.gl.lineWidth(a),this._lineWidth=a);return b};c.prototype.setActiveTexture=function(b){var c=this._activeTextureUnit;0<=b&&b!==this._activeTextureUnit&&(this.gl.activeTexture(a.BASE_TEXTURE_UNIT+b),this._activeTextureUnit=b);return c};c.prototype.clear=function(a){a&&this.gl.clear(a)};c.prototype.drawArrays=function(a,b,c){this.gl.drawArrays(a,b,c)};c.prototype.drawElements=function(a,b,c,e){5123===c?this.gl.drawElements(a,b,c,e):5125===c&&this.gl.drawElements(a,b,c,e)};c.prototype.logIno=
function(){};Object.defineProperty(c.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});c.prototype.setViewport=function(a,b,c,e){var d=this._viewport;if(d.x!==a||d.y!==b||d.width!==c||d.height!==e)d.x=a,d.y=b,d.width=c,d.height=e,this.gl.viewport(a,b,c,e)};c.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};c.prototype.bindProgram=function(a){a?this._activeShaderProgram!==
a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};c.prototype.bindTexture=function(a,b){void 0===b&&(b=0);-1===c._MAX_TEXTURE_IMAGE_UNITS&&(c._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(b>=c._MAX_TEXTURE_IMAGE_UNITS||0>b)&&console.error("Input texture unit is out of range of available units!");var d=this._textureUnitMap[b];this.setActiveTexture(b);null==a||null==a.glName?(null!=
d&&(this.gl.bindTexture(d.descriptor.target,null),d.setBoundToUnit(b,!1)),this._textureUnitMap[b]=null):d&&d.id===a.id?a.applyChanges():(this.gl.bindTexture(a.descriptor.target,a.glName),a.setBoundToUnit(b,!0),a.applyChanges(),this._textureUnitMap[b]=a)};c.prototype.bindFramebuffer=function(a){a?this._activeFramebuffer!==a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};
c.prototype.bindBuffer=function(a){a&&(34962===a.bufferType?this._activeVertexBuffer=c._bindBuffer(this.gl,a,a.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=c._bindBuffer(this.gl,a,a.bufferType,this._activeIndexBuffer))};c.prototype.bindRenderbuffer=function(a){var b=this.gl;a||(b.bindRenderbuffer(b.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(b.bindRenderbuffer(b.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};c.prototype.unbindBuffer=function(a){34962===
a?this._activeVertexBuffer=c._bindBuffer(this.gl,null,a,this._activeVertexBuffer):this._activeIndexBuffer=c._bindBuffer(this.gl,null,a,this._activeIndexBuffer)};c.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};c.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};c.prototype.getBoundFramebufferObject=
function(){return this._activeFramebuffer};c.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};c.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);
this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);
this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};c.prototype.enforceState=function(){var b=this.gl,c=this._capabilities.vao;c&&c.bindVertexArray(null);for(var e=0;e<this.parameters.maxVertexAttributes;e++)b.disableVertexAttribArray(e);this._activeVertexBuffer?b.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):b.bindBuffer(34962,null);this._activeIndexBuffer?b.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):
b.bindBuffer(34963,null);if(c&&this._activeVertexArrayObject){if(c=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(c)}b.bindFramebuffer(b.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);b.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);b.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);b.bindRenderbuffer(b.RENDERBUFFER,
this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?b.enable(this.gl.BLEND):b.disable(this.gl.BLEND);b.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);b.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);b.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);b.clearDepth(this._clearDepth);b.clearStencil(this._clearStencil);
b.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);b.cullFace(this._cullFace);b.depthFunc(this._depthFunction);b.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST);b.depthMask(this._depthWriteEnabled);b.frontFace(this._frontFace);b.lineWidth(this._lineWidth);!0===this._polygonCullingEnabled?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE);b.polygonOffset(this._polygonOffset[0],
this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?b.enable(b.POLYGON_OFFSET_FILL):b.disable(b.POLYGON_OFFSET_FILL);b.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?b.enable(b.SCISSOR_TEST):b.disable(b.SCISSOR_TEST);b.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);b.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,
this._stencilOperation.zPass);!0===this._stencilTestEnabled?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST);b.stencilMask(this._stencilWriteMask);for(c=0;c<this.parameters.maxTextureImageUnits;c++)b.activeTexture(a.BASE_TEXTURE_UNIT+c),b.bindTexture(3553,null),(e=this._textureUnitMap[c])&&b.bindTexture(e.descriptor.target,e.glName);b.activeTexture(a.BASE_TEXTURE_UNIT+this._activeTextureUnit);b.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};c._bindBuffer=
function(a,b,c,e){if(!b)return a.bindBuffer(c,null),null;if(e===b)return e;a.bindBuffer(c,b.glName);return b};c._MAX_TEXTURE_IMAGE_UNITS=-1;return c}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(p,f){return function(){function k(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,
framebufferCount:0,renderBufferCount:0}}k.prototype.incrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}};k.prototype.decrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;
break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}};k.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._instanceCount.textureCount);console.log("Buffers: "+this._instanceCount.bufferCount);console.log("VAOs: "+this._instanceCount.vaoCount);console.log("Programs: "+this._instanceCount.programCount);console.log("Framebuffers: "+
this._instanceCount.framebufferCount);console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)};return k}()})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./VertexArrayObjects".split(" "),function(p,f,k,a,g,b){function e(a,b,e,l,h){if(l&&g.default(a))return!0;if(b[e])return!1;for(b=0;b<h.length;b++)if(a.getExtension(h[b]))return!0;return!1}Object.defineProperty(f,"__esModule",{value:!0});f.loadCapabilities=
function(c,d){d=d&&d.disabledExtensions||{};e(c,d,"standardDerivatives",!0,["OES_standard_derivatives"]);var m=a.load(c),l=b.load(c,d),h;h=d.compressedTextureS3TC?null:(h=c.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:h.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:h.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:h.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:h.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null;var f;f=d.textureFilterAnisotropic?null:(f=c.getExtension("EXT_texture_filter_anisotropic")||
c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:f.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:f.TEXTURE_MAX_ANISOTROPY_EXT}:null;var q=k.load(c,d),t;if(g.default(c))t=d.colorBufferFloat||!c.getExtension("EXT_color_buffer_float")?null:{R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F};else if(c instanceof WebGLRenderingContext){t=
!d.colorBufferFloat&&c.getExtension("EXT_color_buffer_half_float");var u=!d.colorBufferFloat&&c.getExtension("WEBGL_color_buffer_float");t=t||u?{RGBA16F:t?t.RGBA16F_EXT:void 0,RGBA32F:u?u.RGBA32F_EXT:void 0}:null}else t=void 0;u=g.default(c)?{MIN:c.MIN,MAX:c.MAX}:d.blendMinMax?null:(u=c.getExtension("EXT_blend_minmax"))?{MIN:u.MIN_EXT,MAX:u.MAX_EXT}:null;return{instancing:m,vao:l,compressedTextureS3TC:h,textureFilterAnisotropic:f,disjointTimerQuery:q,colorBufferFloat:t,blendMinMax:u,depthTexture:e(c,
d,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:e(c,d,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),textureFloatLinear:e(c,d,"textureFloatLinear",!1,["OES_texture_float_linear"]),fragDepth:e(c,d,"fragDepth",!0,["EXT_frag_depth"])}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});
f.load=function(a,g){if(g.disjointTimerQuery)return null;var b=a.getExtension("EXT_disjoint_timer_query")||a.getExtension("EXT_disjoint_timer_query_webgl2");return b?k.default(a)?{createQuery:function(){return a.createQuery()},resultAvailable:function(b){return a.getQueryParameter(b,a.QUERY_RESULT_AVAILABLE)},getResult:function(b){return a.getQueryParameter(b,a.QUERY_RESULT)},disjoint:function(){return a.getParameter(b.GPU_DISJOINT_EXT)},beginTimeElapsed:function(e){return a.beginQuery(b.TIME_ELAPSED_EXT,
e)},endTimeElapsed:function(){return a.endQuery(b.TIME_ELAPSED_EXT)},createTimestamp:function(a){return b.queryCounterEXT(a,b.TIMESTAMP_EXT)},timestampBits:function(){return a.getQuery(b.TIMESTAMP_EXT,b.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return b.createQueryEXT()},resultAvailable:function(a){return b.getQueryObjectEXT(a,b.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(a){return b.getQueryObjectEXT(a,b.QUERY_RESULT_EXT)},disjoint:function(){return a.getParameter(b.GPU_DISJOINT_EXT)},
beginTimeElapsed:function(a){return b.beginQueryEXT(b.TIME_ELAPSED_EXT,a)},endTimeElapsed:function(){return b.endQueryEXT(b.TIME_ELAPSED_EXT)},createTimestamp:function(a){return b.queryCounterEXT(a,b.TIMESTAMP_EXT)},timestampBits:function(){return b.getQueryEXT(b.TIMESTAMP_EXT,b.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.load=function(a){return k.default(a)?
{drawArraysInstanced:a.drawArraysInstanced.bind(a),drawElementsInstanced:a.drawElementsInstanced.bind(a),vertexAttribDivisor:a.vertexAttribDivisor.bind(a)}:(a=a.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:a.drawArraysInstancedANGLE.bind(a),drawElementsInstanced:a.drawElementsInstancedANGLE.bind(a),vertexAttribDivisor:a.vertexAttribDivisorANGLE.bind(a)}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require","exports","./isWebGL2Context"],function(p,
f,k){Object.defineProperty(f,"__esModule",{value:!0});f.load=function(a,g){return k.default(a)?{createVertexArray:a.createVertexArray.bind(a),deleteVertexArray:a.deleteVertexArray.bind(a),bindVertexArray:a.bindVertexArray.bind(a)}:g.vao?null:(a=a.getExtension("OES_vertex_array_object")||a.getExtension("MOZ_OES_vertex_array_object")||a.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:a.createVertexArrayOES.bind(a),deleteVertexArray:a.deleteVertexArrayOES.bind(a),bindVertexArray:a.bindVertexArrayOES.bind(a)}:
null}})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/has ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPathSymbolLayer2 ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer".split(" "),function(p,f,k,a,g,b,e,c,d,m,l,h,n){Object.defineProperty(f,"__esModule",
{value:!0});var q=a.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");f.make=function(a,b,c,d){var e=u[a.type]&&u[a.type][b.type]||t[b.type];return e?new e(a,b,c,d):(q.error("GraphicsLayerFactory#make","unknown symbol type "+b.type),null)};var t={icon:b,object:d,line:e,path:k("enable-feature:dkoerner/new-path-geometry")?l:m,fill:h,extrude:g,text:n},u={"mesh-3d":{fill:c}}})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/compilerUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Polygon ../../../../layers/graphics/dehydratedFeatures ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/edgeUtils ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z){function w(a,c,d,e,h,g,l,k,m,f,n,q,r,u){var t=d.length/3,w=0;n+=2*e.count;var z=e.index,y=e.count,x=m,B=n;b.vec3.copy(E,r);var F=0<q?1:-1,z=3*z,L=x;r=3*L;for(var K=x+y,x=3*K,p=0;p<y;++p)u&&(E[0]=a[z+0],E[1]=a[z+1],E[2]=a[z+2],b.vec3.normalize(E,E)),h[r+0]=a[z+0],h[r+1]=a[z+1],h[r+2]=a[z+2],g[r+0]=c[z+0],g[r+1]=c[z+1],g[r+2]=c[z+2],l[r+0]=-F*E[0],l[r+1]=-F*E[1],l[r+2]=-F*E[2],k[L]=0,h[x+0]=a[z+0]+q*E[0],h[x+1]=a[z+1]+q*E[1],h[x+2]=a[z+2]+q*E[2],g[x+
0]=c[z+0],g[x+1]=c[z+1],g[x+2]=c[z+2],l[x+0]=F*E[0],l[x+1]=F*E[1],l[x+2]=F*E[2],k[K]=q,r+=3,x+=3,z+=3,L+=1,K+=1;z=0;r=3*B;x=3*(B+t);r=3*(B+t);x=3*B;a=G;c=H;0>q&&(a=H,c=G);for(p=0;p<t;++p)f[r+0]=d[z+a[0]],f[r+1]=d[z+a[1]],f[r+2]=d[z+a[2]],f[x+0]=d[z+c[0]]+y,f[x+1]=d[z+c[1]]+y,f[x+2]=d[z+c[2]]+y,r+=3,x+=3,z+=3;m+=2*e.count;n=n+2*t-(2*e.count+2*t);C(h,g,k,l,w,e.pathLengths[0],e.count,m,f,n,q);m+=4*e.pathLengths[0];n+=2*e.pathLengths[0];w+=e.pathLengths[0];for(d=1;d<e.pathLengths.length;++d)C(h,g,k,l,
w,e.pathLengths[d],e.count,m,f,n,q),m+=4*e.pathLengths[d],n+=2*e.pathLengths[d],w+=e.pathLengths[d]}function B(a,b,c,d,e,h,g){d[h]=d[g];g*=3;h*=3;a[h+0]=a[g+0];a[h+1]=a[g+1];a[h+2]=a[g+2];b[h+0]=b[g+0];b[h+1]=b[g+1];b[h+2]=b[g+2];c[h+0]=e[0];c[h+1]=e[1];c[h+2]=e[2]}function C(a,c,d,e,h,g,l,k,m,f,n){var q=h,r=h+1,u=h+l,t=h+l+1,w=k,z=k+1,y=k+2*g;k=k+2*g+1;0>n&&(q=h+l+1,t=h);f*=3;for(var x=0;x<g;++x){x===g-1&&(0<n?(r=h,t=h+l):(r=h,q=h+l));var F=a,L=q,K=r,C=u,p=S,L=3*L,K=3*K,C=3*C;b.vec3.set(M,F[L++],
F[L++],F[L++]);b.vec3.set(P,F[K++],F[K++],F[K++]);b.vec3.set(O,F[C++],F[C++],F[C++]);b.vec3.subtract(W,P,M);b.vec3.subtract(Q,O,M);b.vec3.cross(p,Q,W);b.vec3.normalize(p,p);B(a,c,e,d,S,w,q);B(a,c,e,d,S,z,r);B(a,c,e,d,S,y,u);B(a,c,e,d,S,k,t);m[f++]=w;m[f++]=y;m[f++]=k;m[f++]=w;m[f++]=k;m[f++]=z;q++;r++;u++;t++;w+=2;z+=2;y+=2;k+=2}}var D=b.vec3f64.create(),E=b.vec3f64.create(),G=[0,2,1],H=[0,1,2],I=c.makeDehydratedPoint(0,0,0,null),N={verticalDistanceToGround:0,terrainElevation:0};p=function(c){function l(){var a=
null!==c&&c.apply(this,arguments)||this;a._edgeStageObjects=new Set;return a}k(l,c);l.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=h.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),c=this._getMaterialOpacityAndColor(),d=b.vec3f64.fromArray(c),c=c[3],d={diffuse:d,ambient:d,opacity:c,transparent:1>c||this._isPropertyDriven("opacity"),vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled};
this._material=new z(d,a+"_3dlinemat");this._context.stage.add(t.ModelContentType.MATERIAL,this._material);this.resolve()};l.prototype.destroy=function(){c.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&this._context.stage.remove(t.ModelContentType.MATERIAL,this._material.id)};l.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;var c=a.geometry;if("polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for extrude symbol: "+
c.type),null;if(!this._validateGeometry(c))return null;var c="polygon"===c.type||"extent"===c.type?"rings":"paths",d="graphic"+a.uid,e=this._getVertexOpacityAndColor(b,Float32Array,255),h=this.getGraphicElevationContext(a);return this._createAs3DShape(a,c,b,e,h,d,a.uid)};l.prototype.layerOpacityChanged=function(){var a=this._getMaterialOpacity(),b=1>a||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:a,transparent:b});if(0<this._edgeStageObjects.size){var c=this._context.stage.view.getEdgeView(),
d=this._getLayerOpacity();this._edgeStageObjects.forEach(function(a){c.updateAllComponentOpacities(a,[d])})}return!0};l.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,m.needsElevationUpdates3D)};l.prototype.slicePlaneEnabledChanged=function(b,c){var d=this;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});if(0<this._edgeStageObjects.size){var e=this._context.stage.view.getEdgeView();b=this._createEdgeMaterial(e);
if(a.isSome(b)){var h=[b];this._edgeStageObjects.forEach(function(a){e.updateAllComponentMaterials(a,h,{slicePlaneEnabled:d._context.slicePlaneEnabled},!1)})}}return!0};l.prototype._getExtrusionSize=function(a){a=a.size&&this._isPropertyDriven("size")?m.getSingleSizeDriver(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};l.prototype._getSymbolSize=function(){return this.symbol.size||1};l.prototype._createAs3DShape=function(c,h,l,k,f,n,r){var t=this,z=c.geometry;
"extent"===z.type&&(z=e.fromExtent(z));c=z[h];var B=[],L=[],K=[],C=b.vec3f64.create(),p=Array(6),T=this._context.renderSpatialReference===q.SphericalECEFSpatialReference,R=this._getExtrusionSize(l),E=b.vec3f64.create();T||this._context.renderCoordsHelper.worldUpAtPosition(null,E);l=m.getGeometryVertexData3D(c,z.hasZ,z.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,f);this._logGeometryCreationWarnings(l,c,h,"ExtrudeSymbol3DLayer");
if(0<c.length){var G=l.geometryData.polygons,v=l.eleVertexData,H=l.vertexData;h=H.length/3;var X=new Float64Array(18*h),ba=new Float64Array(18*h),O=new Float64Array(18*h),ca=new Float64Array(6*h),Z=0;h=function(a){var c=G[a],d=c.count,e=c.index;if(Q._context.clippingExtent&&(m.computeBoundingBox(v,e,d,p),m.boundingBoxClipped(p,Q._context.clippingExtent)))return"continue";var h=new Float64Array(v.buffer,3*e*X.BYTES_PER_ELEMENT,3*d),l=c.holeIndices.map(function(a){return a-e}),h=g(h,l,3);if(0<h.length){m.chooseOrigin(H,
e,d,C);var l=new Uint32Array(6*d+2*h.length),f=6*d,q=new Float64Array(X.buffer,3*Z*X.BYTES_PER_ELEMENT,3*f),r=new Float64Array(ba.buffer,3*Z*ba.BYTES_PER_ELEMENT,3*f),t=new Float64Array(O.buffer,3*Z*O.BYTES_PER_ELEMENT,3*f),z=new Float64Array(ca.buffer,1*Z*ca.BYTES_PER_ELEMENT,1*f);w(H,v,h,c,q,t,r,z,0,l,0,R,E,T);m.subtractCoordinates(q,0,f,C);Z+=6*d;c=Q._createExtrudeGeometry(l,{positions:q,elevation:t,normals:r,heights:z},k);a=new u(c,n+"path"+a);a.singleUse=!0;B.push(a);L.push(Q._material);a=b.mat4f64.create();
b.mat4.translate(a,a,C);K.push(a)}};var Q=this;for(c=0;c<G.length;++c)h(c);if(0<B.length){var da=new y({geometries:B,materials:L,transformations:K,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:r},idHint:n}),S=function(b){var c=t._context.stage.view.getEdgeView();if(c){c.removeObject(b);t._edgeStageObjects.delete(b);var d=t._createEdgeMaterial(c);a.isSome(d)&&(t._edgeStageObjects.add(b),c.addObject(b,[d],{slicePlaneEnabled:t._context.slicePlaneEnabled}))}};S(da);r=new d(this,
da,B,null,null,function(a,b,c,d){a=a.stageObject;I.spatialReference=c.spatialReference;for(var e=a.getGeometryRecords(),h=e.length,g="absolute-height"!==b.mode,l=0,k=0;k<h;k++){var f=e[k].geometry,n=e[k].transformation;F[0]=n[12];F[1]=n[13];F[2]=n[14];f.invalidateBoundingInfo();for(var q=f.data.getVertexAttr(),f=q[x.VertexAttrConstants.POSITION].data,n=q[x.VertexAttrConstants.SIZE].data,q=q.mapPos.data,r=f.length/3,u=0,t=0,w=!1,z=0,y=0;y<r;y++){I.x=q[t];I.y=q[t+1];I.z=q[t+2];J[0]=f[u];J[1]=f[u+1];
J[2]=f[u+2];var B=m.computeElevation(c,I,b,d,g?N:null);g&&(z+=N.terrainElevation);D[0]=f[u]+F[0];D[1]=f[u+1]+F[1];D[2]=f[u+2]+F[2];d.setAltitude(B+n[u/3],D);f[u]=D[0]-F[0];f[u+1]=D[1]-F[1];f[u+2]=D[2]-F[2];B=.01/d.unitInMeters;if(Math.abs(J[0]-f[u])>B||Math.abs(J[1]-f[u+1])>B||Math.abs(J[2]-f[u+2])>B)w=!0;t+=3;u+=3}w&&a.geometryVertexAttrsUpdated(k);l+=z/r}b=l/h;S(da);return b},f);r.alignedTerrainElevation=l.terrainElevation;r.needsElevationUpdates=m.needsElevationUpdates3D(f.mode);return r}}return null};
l.prototype._createExtrudeGeometry=function(a,b,c){for(var d=a.length,e=new Uint32Array(d),h=0;h<d;h++)e[h]=0;d={};h={};d[x.VertexAttrConstants.POSITION]=a;d[x.VertexAttrConstants.NORMAL]=a;d[x.VertexAttrConstants.COLOR]=e;h[x.VertexAttrConstants.POSITION]={size:3,data:b.positions};h[x.VertexAttrConstants.NORMAL]={size:3,data:b.normals};h[x.VertexAttrConstants.COLOR]={size:4,data:c};h[x.VertexAttrConstants.SIZE]={size:1,data:b.heights};b.elevation&&(h.mapPos={size:3,data:b.elevation},d.mapPos=a);
return new r(h,d)};l.prototype._createEdgeMaterial=function(a){var b={opacity:this._getLayerOpacity()};return n.createMaterial(a,this.symbol,b)};return l}(l);var S=b.vec3f64.create(),M=b.vec3f64.create(),P=b.vec3f64.create(),O=b.vec3f64.create(),W=b.vec3f64.create(),Q=b.vec3f64.create(),J=b.vec3f64.create(),F=b.vec3f64.create();return p})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/Logger ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/gl-matrix ./constants ./ElevationContext ./featureExpressionInfoUtils ./Graphics3DSymbolCommonCode ./graphicUtils ./symbolComplexity ../../support/mathUtils ../../support/PromiseLightweight".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t){function u(a,b){a=null!=a?b.attributes[a]:0;return null!=a&&isFinite(a)?a:0}var r=new d,y=g.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),x={mode:"on-the-ground",offset:0,unit:"meters"},z={mode:"absolute-height",offset:0,unit:"meters"};return function(g){function f(a,b,c,e){var h=g.call(this)||this;h.complexity=null;h._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};h.symbolContainer=a;h.symbol=b;h._context=c;h._symbolLayerOrder=
c.layerOrder;h._symbolLayerOrderDelta=c.layerOrderDelta;h._elevationContext=new d;h._material=null;h.complexity=h.computeComplexity();h._geometryCreationWarningHandle=null;h._updateDrivenProperties(e);h._updateElevationContext();h._prepareResources();return h}k(f,g);f.prototype._logWarning=function(a){y.warn(a)};f.prototype._logGeometryCreationWarnings=function(a,c,d,e){var h=this;if(null==this._geometryCreationWarningHandle){var g=a.geometryData&&a.geometryData.polygons;e+=" geometry failed to be created";
var l=null;a.projectionSuccess?!c.length||1===c.length&&!c[0].length?l=e+" (no "+d+" were defined)":Array.isArray(c)&&Array.isArray(c[0])?c.some(function(a){return 1===a.length})?l=e+" ("+d+" should contain at least 2 vertices)":g&&0===g.length&&"rings"===d&&(l=e+" (filled "+d+" should use clockwise winding - try reversing the order of vertices)"):l=e+" ("+d+" should be defined as a 2D array)":l=e+" (failed to project geometry to view spatial reference)";l&&(this._geometryCreationWarningHandle=b.schedule(function(){return h._onNextTick()}),
this._logWarning(l))}};f.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null};f.prototype._validateGeometry=function(a){return"point"!==a.type||q.isFinite(a.x)&&q.isFinite(a.y)?!0:(this._logWarning("point coordinate is not a valid number, graphic skipped"),!1)};f.prototype._defaultElevationInfoNoZ=function(){return x};f.prototype._defaultElevationInfoZ=function(){return z};f.prototype._updateElevationContext=function(){this._elevationContext.setDefaults();var a=this._context.layer.elevationInfo;
a&&this._elevationContext.mixinApi(a);(a=this.symbol&&this.symbol.elevationInfo)&&this._elevationContext.mixinApi(a);this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext};f.prototype.getGraphicElevationContext=function(a){var b=a.geometry.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ();r.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:b.unit);r.mode=this._elevationContext.mode||b.mode;r.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?
this._elevationContext.meterUnitOffset:b.offset);r.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;r.hasOffsetAdjustment=!1;this._elevationOptions.supportsOnTheGround||"on-the-ground"!==r.mode||(r.mode="relative-to-ground",r.setOffsetMeters(0),r.featureExpressionInfoContext=m.zeroContext);b=m.createFeature(a,this._context.layer);m.setContextFeature(r.featureExpressionInfoContext,b);l.needsOffsetAdjustment(r,this._elevationOptions,a.geometry,this.symbolContainer)&&
(r.setOffsetRenderUnits(c.defaultIconElevationOffset),r.hasOffsetAdjustment=!0);return r};f.prototype._getDrapedZ=function(){return-2};f.prototype._updateDrivenProperties=function(a){var b={color:!1,opacity:!1,size:!1};a||(a=this._context.renderer)&&"visualVariables"in a&&a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":b.color=!0;if(a.stops)for(var c=0;c<a.stops.length;c++){var d=a.stops[c].color;d&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==
d.a)&&(b.opacity=!0)}break;case "opacity":b.opacity=!0;break;case "size":b.size=!0}});this._drivenProperties=b};f.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]};f.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?1:a};f.prototype._getMaterialOpacity=function(){var a;a=1*this._getLayerOpacity();var b=this.symbol&&this.symbol.material;
b&&!this._isPropertyDriven("opacity")&&b.color&&(a*=b.color.a);return a};f.prototype._getMaterialOpacityAndColor=function(){var b=this.symbol&&this.symbol.material,c=this._getMaterialOpacity(),b=!this._isPropertyDriven("color")&&b&&b.color?a.toUnitRGB(b.color):null;return h.mixinColorAndOpacity(b,c)};f.prototype._getVertexOpacityAndColor=function(a,b,c){var d=this._isPropertyDriven("color")?a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;d=h.mixinColorAndOpacity(d,a);c&&(d[0]*=c,d[1]*=
c,d[2]*=c,d[3]*=c);return b?new b(d):d};f.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"};f.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};f.prototype.updateSymbolLayerOrder=function(a,b){this._symbolLayerOrder=a;this._symbolLayerOrderDelta=b};f.prototype.computeComplexity=function(){return n.defaultSymbolLayerComplexity(this.symbolContainer,this.symbol)};f.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,
b);this._material&&(this._material.renderPriority=a,c.add(this._material.id))};f.prototype.destroy=function(){this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)};f.prototype.layerPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged();case "elevationInfo":return a=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(b,c,a);case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(b,
c)}return!1};f.prototype.updateGraphics3DGraphicElevationInfo=function(a,b,c){var d=this,e=!0;a.forEach(function(a){var h=b(a);h?(a=d.getGraphicElevationContext(a.graphic),h.needsElevationUpdates=c(a.mode),h.elevationContext.set(a)):e=!1});return e};f.prototype.applyRendererDiff=function(a,b){return!1};f.prototype.getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;var b=this._fastUpdates.visualVariables,c=b.size?u(b.size.field,a):0;a=b.color?u(b.color.field,a):0;return e.vec4f64.fromValues(c,
a,0,0)};return f}(t.Promise)})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.defaultIconElevationOffset=1;f.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/has ./primitiveObjectSymbolUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(p,f,k,a,g,b,e,c){function d(a){for(var b=0,c=0,d={bytesPerFeature:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerCoordinate:0}},e=0;e<a.length;e++){var h=a[e];h&&(b+=h.primitivesPerFeature,c+=h.primitivesPerCoordinate,d.bytesPerFeature+=h.memory.bytesPerFeature,d.bytesPerCoordinate+=h.memory.bytesPerCoordinate,d.draped.bytesPerFeature+=h.memory.bytesPerFeature,d.draped.bytesPerCoordinate+=h.memory.bytesPerCoordinate)}return{primitivesPerFeature:b,primitivesPerCoordinate:c,memory:d}}
function m(b,c){var d=l(b,c);switch(c.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,memory:d};case "fill":return"mesh-3d"===b.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,memory:d}:c.outline&&0<c.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,memory:d}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,memory:d};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,memory:d};case "object":return c.resource&&c.resource.href?
{primitivesPerFeature:16,primitivesPerCoordinate:0,memory:d}:k({},h(c.resource&&c.resource.primitive||"sphere"),{memory:d});case "path":return{primitivesPerFeature:-4,primitivesPerCoordinate:20,memory:d};case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,memory:d};default:a.neverReached(c)}}function l(b,c){b="point-3d"===b.type;switch(c.type){case "extrude":return c.edges&&0<c.edges.size?f.memoryEstimators.EXTRUDE_EDGES:f.memoryEstimators.EXTRUDE;case "fill":return c.outline&&
0<c.outline.size?f.memoryEstimators.FILL_OUTLINE:f.memoryEstimators.FILL;case "line":return f.memoryEstimators.LINE;case "path":return f.memoryEstimators.PATH;case "object":return g("enable-feature:skallweit/lod-rendering")?b?f.memoryEstimators.OBJECT_POINT_LOD:f.memoryEstimators.OBJECT_POLYGON_LOD:b?f.memoryEstimators.OBJECT_POINT:f.memoryEstimators.OBJECT_POLYGON;case "icon":case "text":return b?f.memoryEstimators.ICON_POINT:f.memoryEstimators.ICON_POLYGON;default:a.neverReached(c)}}function h(a){var d=
n[a];if(d)return d;g("enable-feature:skallweit/lod-rendering")?(d=b.primitiveLodResources(a,null,null),d=c.geometriesFromLodLevelResources(d.levels[0]).reduce(function(a,b){return a+b.data.getIndices(e.VertexAttrConstants.POSITION).length/3},0)):d=b.primitiveGeometryData(a).getIndices(e.VertexAttrConstants.POSITION).length/3;d={primitivesPerFeature:d,primitivesPerCoordinate:0};return n[a]=d}Object.defineProperty(f,"__esModule",{value:!0});f.emptySymbolComplexity={primitivesPerFeature:0,primitivesPerCoordinate:0,
memory:{bytesPerFeature:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerCoordinate:0}}};f.defaultSymbolComplexity=function(a){if("web-style"===a.type)return f.emptySymbolComplexity;var b=a.symbolLayers.toArray().map(function(b){return m(a,b)});return d(b)};f.totalSymbolComplexities=d;var n={};f.defaultSymbolLayerComplexity=m;f.defaultSymbolLayerMemoryComplexity=l;f.memoryEstimators={ICON_POINT:{bytesPerFeature:7478.781325779039,bytesPerCoordinate:0,draped:{bytesPerFeature:5712.082651558076,
bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9679.372971750396,bytesPerCoordinate:56.86422538239579,draped:{bytesPerFeature:7883.966873022898,bytesPerCoordinate:56.89697037586389}},OBJECT_POINT:{bytesPerFeature:5177.80657223796,bytesPerCoordinate:0,draped:{bytesPerFeature:5177.80657223796,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:7372.024890546556,bytesPerCoordinate:56.80425878144206,draped:{bytesPerFeature:7372.024890546556,bytesPerCoordinate:56.80425878144206}},OBJECT_POINT_LOD:{bytesPerFeature:1770.211558073654,
bytesPerCoordinate:0,draped:{bytesPerFeature:1770.211558073654,bytesPerCoordinate:0}},OBJECT_POLYGON_LOD:{bytesPerFeature:3958.8422890890743,bytesPerCoordinate:56.88697205558441,draped:{bytesPerFeature:3958.8422890890743,bytesPerCoordinate:56.88697205558441}},LINE:{bytesPerFeature:7586.045782417972,bytesPerCoordinate:112.02132538683836,draped:{bytesPerFeature:4775.97368572266,bytesPerCoordinate:111.85995483757563}},PATH:{bytesPerFeature:7563.020535856769,bytesPerCoordinate:119.1242257528872,draped:{bytesPerFeature:7563.020535856769,
bytesPerCoordinate:119.1242257528872}},FILL:{bytesPerFeature:8702.040510627665,bytesPerCoordinate:56.610361738134486,draped:{bytesPerFeature:5921.70744530372,bytesPerCoordinate:56.58839624148057}},FILL_OUTLINE:{bytesPerFeature:12168.362923563885,bytesPerCoordinate:56.265773613009564,draped:{bytesPerFeature:7929.090679733446,bytesPerCoordinate:56.17528027868163}},EXTRUDE:{bytesPerFeature:11409.738625531325,bytesPerCoordinate:56.99136098105536,draped:{bytesPerFeature:11409.738625531325,bytesPerCoordinate:56.99136098105536}},
EXTRUDE_EDGES:{bytesPerFeature:19399.52461450617,bytesPerCoordinate:52.052414603432105,draped:{bytesPerFeature:19399.52461450617,bytesPerCoordinate:52.052414603432105}}}})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});var e=a.fromValues(-.5,
-.5,-.5,.5,.5,.5),c=a.fromValues(-.5,-.5,0,.5,.5,1),d=a.fromValues(-.5,-.5,0,.5,.5,.5);f.isValidPrimitive=function(a){switch(a){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};f.primitiveBoundingBox=function(a){switch(a){case "sphere":case "cube":case "diamond":return e;case "cylinder":case "cone":case "inverted-cone":return c;case "tetrahedron":return d;default:k.neverReached(a)}};f.primitiveGeometryData=function(a){switch(a){case "sphere":return b.createPolySphereGeometry(.5,
2,!0);case "cube":return b.createBoxGeometry(1);case "cylinder":return b.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return b.cgToGIS(b.createConeGeometry(1,.5,15,!1));case "inverted-cone":return b.cgToGIS(b.createConeGeometry(1,.5,15,!0));case "tetrahedron":return b.cgToGIS(b.createTetrahedronGeometry(1));case "diamond":return b.cgToGIS(b.createDiamondGeometry(1));default:k.neverReached(a)}};f.primitiveLodResources=function(a,c,d){var e=function(a,e,h){void 0===h&&(h=!1);return{levels:a.map(function(a,
l){var k=e(a.tesselation);h&&b.cgToGIS(k);return{components:[{geometry:new g(k,d+("_lod"+l)),material:c}],faceCount:k.indexCount/3,minScreenSpaceRadius:a.minScreenSpaceRadius}})}};switch(a){case "sphere":return e([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],function(a){return b.createPolySphereGeometry(.5,a,!0)});case "cube":return e([{tesselation:0,
minScreenSpaceRadius:0}],function(a){return b.createBoxGeometry(1)});case "cone":return e(m,function(a){return b.createConeGeometry(1,.5,a,!1)},!0);case "inverted-cone":return e(m,function(a){return b.createConeGeometry(1,.5,a,!0)},!0);case "cylinder":return e(m,function(a){return b.createCylinderGeometry(1,.5,a,[0,0,1],[0,0,.5])});case "tetrahedron":return e([{tesselation:0,minScreenSpaceRadius:0}],function(a){return b.createTetrahedronGeometry(1)},!0);case "diamond":return e([{tesselation:0,minScreenSpaceRadius:0}],
function(a){return b.createDiamondGeometry(1)},!0);default:k.neverReached(a)}};var m=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["require","exports","../../../../../core/arrayUtils"],function(p,f,k){function a(a){var b=[];a.components.forEach(function(a){b.push(a.geometry)});return k.unique(b)}Object.defineProperty(f,"__esModule",{value:!0});
f.materialsFromLodResources=function(a){var b=[];a.levels.forEach(function(a){a.components.forEach(function(a){b.push(a.material)})});return k.unique(b)};f.texturesFromLodResources=function(a){var b=[];a.levels.forEach(function(a){a.components.forEach(function(a){a.textures&&b.push.apply(b,a.textures)})});return k.unique(b)};f.geometriesFromLodLevelResources=a;f.geometriesFromLodResources=function(a){var b=[];a.levels.forEach(function(a){a.components.forEach(function(a){b.push(a.geometry)})});return k.unique(b)};
f.computeFaceCount=function(g){var b=0;a(g).forEach(function(a){b+=a.data.indexCount/3});return b}})},"esri/views/3d/support/PromiseLightweight":function(){(function(p){function f(a){this._callbacks=[];this._errbacks=[];this._cancelCallback=a;this._iserr=this._isdone=this._iscancelled=!1}function k(a,b){var e=new f;0===a.length?e.done.apply(e,b):a[0].apply(null,b).then(function(){a.splice(0,1);k(a,arguments).then(function(){e.done.apply(e,arguments)})});return e}f.prototype.cancel=function(a){this._callbacks=
[];this._errbacks=[];this._iscancelled=!0;this._cancelCallback&&this._cancelCallback(a)};f.prototype.then=function(a,b,e){var c;if(!this._iscancelled)return this._isdone?c=a.apply(e,this.result):this._iserr&&b?c=b.apply(e,this.result):(this._callbacks.push(function(){return a.apply(e,arguments)}),b&&this._errbacks.push(function(){return b.apply(e,arguments)})),c};f.prototype.done=function(){this.result=arguments;this._isdone=!0;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,
arguments);this._callbacks=[];this._errbacks=[]};f.prototype.resolve=f.prototype.done;f.prototype.reject=function(){if(!this._iscancelled){this.result=arguments;this._iserr=!0;for(var a=0;a<this._errbacks.length;a++)this._errbacks[a].apply(null,arguments);this._callbacks=[];this._errbacks=[]}};f.prototype.isRejected=function(){return this._iserr};f.prototype.isFulfilled=function(){return this._isdone||this._iserr};f.prototype.isResolved=function(){return this._isdone};f.prototype.isCancelled=function(){return this._iscancelled};
var a={Promise:f,join:function(a){function b(a,b){return function(){b&&(l=!0);d+=1;g[a]=Array.prototype.slice.call(arguments);d===c&&(l?e.reject():e.done(g))}}for(var e=new f,c=a.length,d=0,g=[],l=!1,h=0;h<c;h++)a[h].then(b(h,!1),b(h,!0));0===a.length&&e.done();return e},chain:k};"function"===typeof define&&define.amd?define(function(){return a}):p.promise=a})(this)},"esri/views/3d/layers/support/edgeUtils":function(){define("require exports ../../../../Color ../../../../core/compilerUtils ../../../../core/compilerUtils ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/gl-matrix".split(" "),
function(p,f,k,a,g,b,e){function c(c,f,l){if(a.isNone(f))return null;var d=e.vec4f64.fromArray(k.toUnitRGBA(f.color));l=l.opacity;switch(f.type){case "solid":return c.createSolidEdgeMaterial({color:d,size:b.pt2px(f.size),extensionLength:b.pt2px(f.extensionLength),opacity:l});case "sketch":return c.createSketchEdgeMaterial({color:d,size:b.pt2px(f.size),extensionLength:b.pt2px(f.extensionLength),opacity:l});default:g.neverReached(f)}}Object.defineProperty(f,"__esModule",{value:!0});f.createMaterial=
function(a,b,e){return c(a,b&&b.enabled&&b.edges||null,e)};f.createMaterialFromEdges=c})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/buffer/InterleavedLayout ../lib/GLMaterialTexture ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./internal/MaterialUtil ../shaders/DefaultPrograms".split(" "),function(p,
f,k,a,g,b,e,c,d,m,l,h,n){function q(a,b,c){c=b.slicePlaneEnabled?!1:b.cullFace?"none"!==b.cullFace:!b.transparent&&!b.doubleSided;c?(a.setFaceCullingEnabled(!0),"front"===b.cullFace?a.setCullFace(1028):a.setCullFace(1029)):a.setFaceCullingEnabled(!1)}function t(a,b){var c=b.vvSizeEnabled;b.vvSizeEnabled?(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor)):c&&
a.setUniform3fv("vvSizeValue",b.vvSizeValue);if(c){a.setUniform3fv("vvSymbolAnchor",b.vvSymbolAnchor);var c=b.vvSymbolRotation[2]||0,d=b.vvSymbolRotation[0]||0,e=b.vvSymbolRotation[1]||0;g.mat4.identity(H);0!==c&&g.mat4.rotateZ(H,H,-c/180*Math.PI);0!==d&&g.mat4.rotateX(H,H,d/180*Math.PI);0!==e&&g.mat4.rotateY(H,H,e/180*Math.PI);a.setUniformMatrix3fv("vvSymbolRotation",g.mat3.fromMat4(G,H))}b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors))}
var u=d.assert;p=function(a){function c(b,d){d=a.call(this,d)||this;d.supportsEdges=!0;d.params=h.copyParameters(b,B);d.instanced=!!b.instanced;d.vertexBufferLayout=c.getVertexBufferLayout(d.params);d.instanceBufferLayout=d.instanced?c.getInstanceBufferLayout(d.params):null;d.bufferWriter=new C(d.vertexBufferLayout,d.instanceBufferLayout);return d}k(c,a);c.prototype.isVisible=function(){var b=this.params;if(!a.prototype.isVisible.call(this)||0===b.layerOpacity)return!1;var c=b.instanced,d=b.vertexColors,
e=b.symbolColors,c=!!c&&-1<c.indexOf("color"),h=b.vvColorEnabled,g="replace"===b.colorMixMode,l=0<b.opacity,b=b.externalColor&&0<b.externalColor[3];return d&&(c||h||e)?g?!0:l:d?g?b:l:c||h||e?g?!0:l:g?b:l};c.prototype.getParams=function(){return this.params};c.prototype.getParameterValues=function(){return h.copyParameters(this.params)};c.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)"textureId"===c&&u(b.textureId,"Can only change texture of material that already has a texture"),
"castShadows"===c&&u(a.castShadows===b.castShadows,"Can not change shadow casting behavior."),b[c]=a[c];this.notifyDirty("matChanged")};c.prototype.intersect=function(a,b,c,d,e,l,k,f){if(null!==this.params.verticalOffset){f=d.camera;g.vec3.set(O,c[12],c[13],c[14]);var m=g.vec3.subtract(W,O,f.eye),n=g.vec3.length(m),q=g.vec3.scale(m,m,1/n),r=null,m=null;switch(d.viewingMode){case "global":m=g.vec3.normalize(M,O);break;case "local":m=g.vec3.copy(M,S)}this.params.screenSizePerspective&&(r=g.vec3.dot(m,
q));f=h.verticalOffsetAtDistance(f,n,this.params.verticalOffset,r,this.params.screenSizePerspective);g.vec3.scale(m,m,f);g.vec3.transformMat3(P,m,d.transformInverseRotation);e=g.vec3.subtract(I,e,P);l=g.vec3.subtract(N,l,P)}h.intersectTriangleGeometry(a,b,c,d,e,l,k)};c.prototype.getGLMaterials=function(){return{color:r,depthShadowMap:this.params.castShadows?x:null,normal:z,depth:y,highlight:w}};c.prototype.getAllTextureIds=function(){return this.params.textureId?[this.params.textureId]:[]};c.getVertexBufferLayout=
function(a){var c=b.newLayout().vec3f("position");a.groundNormalShading||(c=a.compressedNormals?c.vec2i16("normalCompressed",{glNormalized:!0}):c.vec3f("normal"));a.textureId&&(c=c.vec2f("uv0"),a.atlasRegions&&(c=c.vec4u16("region",{glNormalized:!0})));a.vertexColors&&(c=c.vec4u8("color"));a.symbolColors&&(c=c.vec4u8("symbolColor"));a.componentIndices&&(c=c.u16("componentIndex").u16("_padding",{glPadding:!0}));return c};c.getInstanceBufferLayout=function(a){var c=b.newLayout(),c=a.instancedDoublePrecision?
c.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):c.mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&(c=c.vec4f("instanceColor"));a.instanced&&-1<a.instanced.indexOf("featureAttribute")&&(c=c.vec4f("instanceFeatureAttribute"));return c};return c}(c);var r=function(a){function b(b,c,d){var e=this,g=b.getParams(),e=a.call(this,b,c,d,g.textureId,g.textureInitTransparent)||this;e.params=h.copyParameters(g);b=e.params;e.slot=b.transparent?
b.writeDepth?6:9:b.writeStencil?2:4;e.texturing=b.textureId?b.atlasRegions?"AtlasTextured":"Textured":"none";b=b.instanced;e.instanced=!!b;e.instancedColor=!!b&&-1<b.indexOf("color");e._createPrograms();return e}k(b,a);b.prototype._createPrograms=function(){var a=this;this.programs=l.BindParametersMap.create(this.params,function(b){return a._createProgram(b)})};b.prototype._createProgram=function(a){var b=this.params;return this.programRep.getProgram(n.colorPass,{treeRendering:!!b.treeRendering,viewingMode:this.programRep.globalOptions.viewingMode,
textureMode:this.texturing,vertexColors:b.vertexColors,symbolColors:b.symbolColors,flipV:b.flipV,doubleSided:b.doubleSided&&"normal"===b.doubleSidedType,windowOrderDoubleSided:b.doubleSided&&"winding-order"===b.doubleSidedType,instanced:!!this.instanced,instancedDoublePrecision:b.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:a.receiveShadows,receiveSSAO:a.receiveSSAO,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,verticalOffset:null!==b.verticalOffset,screenSizePerspective:null!==
b.screenSizePerspective,slice:b.slicePlaneEnabled,groundNormalShading:b.groundNormalShading,compressedNormals:b.compressedNormals,componentColor:null!=b.componentColorBuffer,textureAlphaTest:b.textureAlphaTest,alphaCoverageCorrection:E,iosSafariFix:D})};b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};b.prototype.getPrograms=function(){return l.BindParametersMap.programs(this.programs)};b.prototype.updateParameters=
function(){this.params=this.material.getParameterValues();this.slot=this.params.transparent?this.params.writeDepth?6:9:this.params.writeStencil?2:4;this.updateTexture(this.params.textureId);this._createPrograms()};b.prototype.bind=function(a,b){var c=this.params,d=this.program=l.BindParametersMap.lookup(this.programs,b);a.bindProgram(d);d.setUniform3fv("ambient",c.ambient);d.setUniform3fv("diffuse",c.diffuse);d.setUniform3fv("specular",c.specular);d.setUniform4fv("externalColor",c.externalColor);
d.setUniform1i("colorMixMode",h.colorMixModes[c.colorMixMode]);d.setUniform1f("opacity",c.opacity);d.setUniform1f("layerOpacity",c.layerOpacity);h.bindVerticalOffset(c.verticalOffset,b,d);h.bindScreenSizePerspective(c.screenSizePerspective,b,d);t(d,c);this.bindTexture(a,d);"none"!==this.texturing&&this.bindTextureSize(a,d);a.setBlendFunctionSeparate(770,771,1,771);c.inverseWindingOrder&&a.setFrontFace(2304);c.transparent?(a.setBlendingEnabled(!0),c.blendModeOneOne?(a.setBlendFunction(1,1),a.setDepthWriteEnabled(!1)):
a.setBlendFunctionSeparate(770,771,1,771)):a.setBlendingEnabled(!1);a.setDepthWriteEnabled(c.writeDepth);c.textureAlphaTest&&d.setUniform1f("textureAlphaCutoff",c.textureAlphaCutoff);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(2,2));q(a,c,b);a.setDepthTestEnabled(!0);c.componentIndices&&c.componentColorBuffer&&(c.componentColorBuffer.updateTexture(),c.componentColorBuffer.bind(d,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:1}))};b.prototype.release=
function(a,b){a.setPolygonOffsetFillEnabled(!1);a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!1);a.setBlendFunctionSeparate(770,771,1,771);a.setDepthWriteEnabled(!0);a.setFrontFace(2305)};b.prototype.bindView=function(a,b){a=this.program=l.BindParametersMap.lookup(this.programs,b);var c=this.params,d=c.instancedDoublePrecision?g.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;h.bindView(d,b.view,a);h.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&
h.bindViewOriginDouble(d,a);c.slicePlaneEnabled&&h.bindSlicePlane(d,b.slicePlane,a);b.shadowMappingEnabled&&b.shadowMap.bindView(a,d)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return 4};return b}(e),y=function(a){function b(b,c,d,e){void 0===e&&(e=!1);c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=h.copyParameters(b.getParams());
c.instanced=!!c.params.instanced;c.texturing=b.bufferWriter.vertexBufferLayout.hasField("uv0")?c.params.atlasRegions?"AtlasTextured":"Textured":"none";c.biased=e;c.selectProgram();c.selectSlot();return c}k(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(n.depthPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,
instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,shadowMap:this.biased,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,textureAlphaTest:this.params.textureAlphaTest,alphaCoverageCorrection:E,iosSafariFix:D})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?6:9:this.params.writeStencil?2:
4};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform2fv("nearFar",b.nearFar);d.inverseWindingOrder&&a.setFrontFace(2304);h.bindVerticalOffset(d.verticalOffset,b,c);h.bindScreenSizePerspective(d.screenSizePerspective,b,c);t(c,d);d.textureAlphaTest&&c.setUniform1f("textureAlphaCutoff",d.textureAlphaCutoff);
this.bindTexture(a,c);q(a,d,b);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=this.params;a.setFaceCullingEnabled(!1);b.inverseWindingOrder&&a.setFrontFace(2305)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?g.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;h.bindView(d,b.view,a);c.slicePlaneEnabled&&h.bindSlicePlane(d,b.slicePlane,a);c.screenSizePerspective&&h.bindCamPos(d,b.viewInvTransp,
a);c.instancedDoublePrecision&&h.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 4};return b}(e),x=function(a){function b(b,c,d){return a.call(this,b,c,d,!0)||this}k(b,a);return b}(y),z=function(a){function b(b,c,d,e){void 0===e&&(e=!1);c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=h.copyParameters(b.getParams());c.instanced=!!c.params.instanced;c.texturing=b.bufferWriter.vertexBufferLayout.hasField("uv0")?
c.params.atlasRegions?"AtlasTextured":"Textured":"none";c.selectProgram();c.selectSlot();return c}k(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(n.normalPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,
verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,compressedNormals:this.params.compressedNormals,textureAlphaTest:this.params.textureAlphaTest,alphaCoverageCorrection:E,iosSafariFix:D})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?6:9:this.params.writeStencil?2:4};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram();
this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);this.bindTexture(a,c);h.bindVerticalOffset(d.verticalOffset,b,c);h.bindScreenSizePerspective(d.screenSizePerspective,b,c);t(c,d);d.textureAlphaTest&&c.setUniform1f("textureAlphaCutoff",d.textureAlphaCutoff);q(a,d,b);d.inverseWindingOrder&&a.setFrontFace(2304);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=this.params;a.setFaceCullingEnabled(!1);
b.inverseWindingOrder&&a.setFrontFace(2305)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?g.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;h.bindView(d,b.view,a);a.setUniformMatrix4fv("viewNormal",b.viewInvTransp);c.slicePlaneEnabled&&h.bindSlicePlane(d,b.slicePlane,a);c.screenSizePerspective&&h.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&h.bindViewOriginDouble(d,a)};b.prototype.bindInstance=
function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(){return 4};return b}(e),w=function(a){function b(b,c,d,e){void 0===e&&(e=!1);c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=h.copyParameters(b.getParams());c.instanced=!!c.params.instanced;c.texturing=b.bufferWriter.vertexBufferLayout.hasField("uv0")?c.params.atlasRegions?"AtlasTextured":"Textured":"none";c.selectProgram();
c.selectSlot();return c}k(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(n.highlightPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,
screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,textureAlphaTest:this.params.textureAlphaTest,alphaCoverageCorrection:E,iosSafariFix:D})};b.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?6:9:this.params.writeStencil?2:4};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,
b){var c=this.program,d=this.params;a.bindProgram(c);this.bindTexture(a,c);h.bindVerticalOffset(d.verticalOffset,b,c);h.bindScreenSizePerspective(d.screenSizePerspective,b,c);t(c,d);d.textureAlphaTest&&c.setUniform1f("textureAlphaCutoff",d.textureAlphaCutoff);q(a,d,b);d.inverseWindingOrder&&a.setFrontFace(2304);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=this.params;a.setFaceCullingEnabled(!1);b.inverseWindingOrder&&a.setFrontFace(2304)};b.prototype.bindView=function(a,b){a=this.program;
var c=this.params,d=c.instancedDoublePrecision?g.vec3f64.fromValues(b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]):b.origin;h.bindView(d,b.view,a);c.slicePlaneEnabled&&h.bindSlicePlane(d,b.slicePlane,a);c.screenSizePerspective&&h.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&h.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=
function(){return 4};return b}(e),B={textureId:void 0,textureInitTransparent:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,
castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,0],transparent:!1,writeDepth:!0,textureAlphaTest:!0,textureAlphaCutoff:.1,polygonOffset:!1,atlasRegions:!1},C=function(){function a(a,
b){this.vertexBufferLayout=a;this.instanceBufferLayout=b}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices.position.length};a.prototype.write=function(a,b,c,d,e){m.writeDefaultAttributes(b,c,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,d,e)};return a}(),D=!!a("ios")&&!!a("safari"),E=!1,G=g.mat3f64.create(),H=g.mat4f64.create(),I=g.vec3f64.create(),N=g.vec3f64.create(),S=g.vec3f64.fromValues(0,
0,1),M=g.vec3f64.create(),P=g.vec3f64.create(),O=g.vec3f64.create(),W=g.vec3f64.create();return p})},"esri/views/3d/webgl-engine/shaders/DefaultPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});var b=function(a){return g.glslifyDefineMap({VIEWING_MODE_GLOBAL:"global"===a.viewingMode,VIEWING_MODE_LOCAL:"local"===a.viewingMode,TEXTURING:"none"!==
a.textureMode,TEXTURE_ATLAS:"AtlasTextured"===a.textureMode,VERTEXCOLORS:a.vertexColors,SYMBOLVERTEXCOLORS:a.symbolColors,FLIPV:a.flipV,DOUBLESIDED:a.doubleSided,WINDINGORDERDOUBLESIDED:a.windowOrderDoubleSided,INSTANCED:a.instanced,INSTANCED_DOUBLE_PRECISION:a.instancedDoublePrecision,INSTANCEDCOLOR:a.instancedColor,RECEIVE_SHADOWS:a.receiveShadows,RECEIVE_SSAO:a.receiveSSAO,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,SLICE:a.slice,
GROUND_NORMAL_SHADING:a.groundNormalShading,COMPRESSED_NORMALS:a.compressedNormals,COMPONENTCOLORS:a.componentColor,TEXTURE_ALPHA_TEST:a.textureAlphaTest,ALPHA_COVERAGE_CORRECTION:a.alphaCoverageCorrection,BIAS_SHADOWMAP:a.shadowMap,TREE_RENDERING:a.treeRendering,IOS_SAFARI_FIX:a.iosSafariFix})};f.colorPass={name:"default-color",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/defaultMaterial/colorPass.vert"),fragmentShader:b(e)+a.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},
attributes:k.Default3D};f.depthPass={name:"default-depth",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/defaultMaterial/depthPass.vert"),fragmentShader:b(e)+a.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},attributes:k.Default3D};f.normalPass={name:"default-normal",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/defaultMaterial/normalPass.vert"),fragmentShader:b(e)+a.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},
attributes:k.Default3D};f.highlightPass={name:"default-highlight",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),fragmentShader:b(e)+a.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},attributes:k.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper dojo/errors/CancelError ../../../../Color ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../symbols/support/utils ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./SignedDistanceFunctions ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H,I,N){function S(a){return"cross"===a||"x"===a}function M(a){var b;"primitive:"===a.substring(0,10)&&(a=a.substring(10));switch(a){case L.PRIM_CIRCLE:b=w.computeSignedDistancefieldCicle(128,64);break;case L.PRIM_SQUARE:b=w.computeSignedDistancefieldSquare(128,64,!1);break;case L.PRIM_KITE:b=w.computeSignedDistancefieldSquare(128,64,!0);break;case L.PRIM_CROSS:b=w.computeSignedDistancefieldCrossAndX(128,64,!1);break;case L.PRIM_X:b=w.computeSignedDistancefieldCrossAndX(128,
64,!0)}return new I(b,"sdf_"+a,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4})}var P=n.mat4f64.create(),O=n.vec3f64.fromValues(0,0,1),W=[0,0,0,0],Q=n.vec3f64.fromValues(0,0,0),J=n.vec3f64.fromValues(1,1,1),F="center bottom top left right bottom-left bottom-right top-left top-right".split(" "),K=[.25,.25,.75,.75],L={PRIM_CIRCLE:"circle",PRIM_SQUARE:"square",PRIM_CROSS:"cross",PRIM_X:"x",PRIM_KITE:"kite"},T=[64,64];p=function(f){function w(){var a=null!==f&&f.apply(this,arguments)||
this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return a}a(w,f);w.prototype._prepareResources=function(){var a=this.symbol,b=Math.round(null!=a.size?l.pt2px(a.size):16);this._size=null;this._symbolTextureRatio=1;this._primitive=null;var c=this._getStageIdHint();if(!this._isPropertyDriven("size")){var d=z.validateSymbolLayerSize(b);if(d){this._logWarning(d);this.reject();return}}this._isPropertyDriven("size")&&64>b&&(b=64);var e=a.resource||{primitive:"circle",href:void 0},
d={anchorPos:this._getAnchorPos(a)},h=this.symbolContainer;if(this._hasVisibleVerticalOffset(h)){var h=h.verticalOffset,g=h.minWorldLength,k=h.maxWorldLength;d.verticalOffset={screenLength:l.pt2px(h.screenLength),minWorldLength:g||0,maxWorldLength:null!=k?k:Infinity}}this._context.screenSizePerspectiveEnabled&&(d.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);e.href?(this._outlineSize=this._getOutlineSize(a,null),d.color=this._getFillColor(a,null),d.outlineColor=
this._getOutlineColor(a),d.outlineSize=this._outlineSize,d.textureIsSignedDistanceField=!1,this._prepareImageResources(b,d,c)):(e=e.primitive||"circle",h="primitive:"+e,this._primitive=e,this._outlineSize=this._getOutlineSize(a,e),d.color=this._getFillColor(a,e),d.outlineColor=this._getOutlineColor(a),d.outlineSize=this._outlineSize,S(e)&&0===d.outlineSize?this.reject():(this.texture=this._context.sharedResources.textures.acquire(h,M),this._textureURI=h,d.textureIsSignedDistanceField=!0,d.distanceFieldBoundingBox=
K,d.textureId=this.texture.id,this._size=[b,b],this._symbolTextureRatio=2,this._createMaterialsAndAddToStage(d,this._context.stage,c),this.resolve()))};w.prototype._getOutlineSize=function(a,b){var c=0,c=a.outline&&null!=a.outline.size?l.pt2px(a.outline.size):S(b)?1.5:0;return Math.max(c,0)};w.prototype._getOutlineColor=function(a){var c=this._getLayerOpacity();if(a.outline&&null!=a.outline.color){var d=b.toUnitRGB(a.outline.color);return[d[0],d[1],d[2],a.outline.color.a*c]}return[0,0,0,c]};w.prototype._getFillColor=
function(a,b){return S(b)?W:this._getMaterialOpacityAndColor()};w.prototype._getAnchorPos=function(a){return-1<F.indexOf(a.anchor)?a.anchor:"center"};w.prototype._prepareImageResources=function(a,b,d){var l=this,k=q.getIconHref(this.symbolContainer,this.symbol);!c("esri-canvas-svg-support")&&h.isSVG(k)?(this._logWarning("IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"),this.reject(new e("SVG Not Supported","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"))):
(m.when(this._context.sharedResources.textures.acquire(k,a)).then(function(c){if(!l.isRejected()){var e=c.params,h=e.width/e.height;l._size=a?1<h?[a,Math.round(a/h)]:[Math.round(a*h),a]:[e.width,e.height];b.textureId=c.id;l._createMaterialsAndAddToStage(b,l._context.stage,d);l.resolve()}},function(a){a instanceof g?l.reject():(a="IconSymbol3DLayer failed to load (Request for icon resource failed: "+k+")",l._logWarning(a),l.reject(new e("Request Failed",a)))}),this._textureURI=k)};w.prototype._createMaterialsAndAddToStage=
function(a,b,c){this._fastUpdates=B.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&d.mixin(a,this._fastUpdates.materialParameters);var e=k({},a);e.verticalOffset=null;e.screenSizePerspective=null;e.occlusionTest=!1;e.slicePlaneEnabled=!1;e.shaderPolygonOffset=0;this._drapedMaterial=new N(e,c+"_iconDraped");b.add(D.ModelContentType.MATERIAL,this._drapedMaterial);a.occlusionTest=!0;a.slicePlaneEnabled=this._context.slicePlaneEnabled;
this._material=new N(a,c+"_icon");b.add(D.ModelContentType.MATERIAL,this._material)};w.prototype.destroy=function(){f.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(D.ModelContentType.MATERIAL,this._material.id),this._material=null);this._drapedMaterial&&(this._context.stage.remove(D.ModelContentType.MATERIAL,this._drapedMaterial.id),this._drapedMaterial=null);this._textureURI&&(this._context.sharedResources.textures.release(this._textureURI),
this._textureURI=null)};w.prototype._getScaleFactor=function(a){if(this._isPropertyDriven("size")&&a.size){for(var b=0;3>b;b++){var c=a.size[b];c&&"symbolValue"!==c&&"proportional"!==c&&(a.size[b]=l.pt2px(c))}b=this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"!==a.size[0]){if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}}return 1};w.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;if(!this._validateGeometry(a.geometry))return null;
var c=y.placePointOnGeometry(a.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+a.geometry.type),null;var d="graphic"+a.uid,e=this._getVertexOpacityAndColor(b),h=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(h=this._getScaleFactor(b));h*=this._symbolTextureRatio;b=[this._size[0]*h,this._size[1]*h];h=this.getGraphicElevationContext(a);return"on-the-ground"===h.mode?this._createAsOverlay(a,c,e,b,h,d,a.uid):this._createAs3DShape(a,c,e,b,h,
d,a.uid)};w.prototype.layerOpacityChanged=function(){var a=this._getFillColor(this.symbol,this._primitive);this._drapedMaterial.setParameterValues({color:a});this._material.setParameterValues({color:a});a=this._getOutlineColor(this.symbol);this._drapedMaterial.setParameterValues({outlineColor:a});this._material.setParameterValues({outlineColor:a});return!0};w.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;if("on-the-ground"===c&&"on-the-ground"===d)return!0;
if(c!==d&&("on-the-ground"===c||"on-the-ground"===d))return!1;var e=y.needsElevationUpdates2D(d)||"absolute-height"===d;return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};w.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};w.prototype.applyRendererDiff=function(a,b){for(var c in a.diff)switch(c){case "visualVariables":if(B.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._material.setParameterValues(this._fastUpdates.materialParameters),
this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};w.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._drapedMaterial&&(this._drapedMaterial.renderPriority=a,c.add(this._drapedMaterial.id))};w.prototype._defaultElevationInfoNoZ=function(){return R};w.prototype._createAs3DShape=function(a,b,c,d,e,h,g){var l=this,k=this.getFastUpdateAttrValues(a);a=k?function(a){return B.evaluateModelTransform(l._fastUpdates.materialParameters,
k,a)}:null;c=G.createPointGeometry(O,null,c,d,X,null,k);c=[new E(c,h)];h=y.createStageObjectForPoint(this._context,b,c,[this._material],null,null,e,h,this._context.layer.uid,g,!0,a);if(null===h)return null;var f=new r(this,h.object,c,null,null,t.perObjectElevationAligner,e);f.alignedTerrainElevation=h.terrainElevation;f.needsElevationUpdates=y.needsElevationUpdates2D(e.mode)||"absolute-height"===e.mode;f.getScreenSize=this._createScreenSizeGetter(d,a);f.calculateRelativeScreenBounds=function(a){return l._material.calculateRelativeScreenBounds(f.getScreenSize(),
1,a)};y.extendPointGraphicElevationContext(f,b,this._context.elevationProvider);return f};w.prototype._createAsOverlay=function(a,b,c,d,e,h,g){var l=this;this._drapedMaterial.renderPriority=this._symbolLayerOrder;e=n.vec3f64.create();C.pointToVector(b,e,this._context.overlaySR);e[2]=this._getDrapedZ();if((b=this._context.clippingExtent)&&!y.pointInBox2D(e,b))return null;var k=this.getFastUpdateAttrValues(a);a=k?function(a){return B.evaluateModelTransform(l._fastUpdates.materialParameters,k,a)}:null;
c=G.createPointGeometry(O,e,c,d,null,null,k);b=new H(c);b.material=this._drapedMaterial;b.center=e;b.bsRadius=0;b.transformation=P;b.name=h;b.uniqueName=h+"#"+c.id;var f=new u(this,[b],null);f.getScreenSize=this._createScreenSizeGetter(d,a);f.calculateRelativeScreenBounds=function(a){return l._drapedMaterial.calculateRelativeScreenBounds(f.getScreenSize(),1,a)};return f};w.prototype._createScreenSizeGetter=function(a,b){var c=this._outlineSize+2;if(this._fastUpdates.enabled){var d=a[0]/this._symbolTextureRatio,
e=a[1]/this._symbolTextureRatio;return function(a){void 0===a&&(a=n.vec2f64.create());var h=b(P);a[0]=h[0]*d+c;a[1]=h[5]*e+c;return a}}var h=a[0]/this._symbolTextureRatio+c,g=a[1]/this._symbolTextureRatio+c;return function(a){void 0===a&&(a=n.vec2f64.create());a[0]=h;a[1]=g;return a}};w.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],b=n.vec3f64.fromValues(a,a,a),c=l.px2pt(1),a=a*c,a=n.vec3f64.fromValues(a,a,a);return{modelSize:b,
symbolSize:a,unitInMeters:c,transformation:{anchor:Q,scale:J,rotation:Q}}};w.prototype._hasVisibleVerticalOffset=function(a){return this.symbolContainer&&"point-3d"===this.symbolContainer.type&&this.symbolContainer.hasVisibleVerticalOffset()};w.PRIMITIVE_SIZE=T;w.VALID_ANCHOR_STRINGS=F;return w}(x);var R={mode:"relative-to-ground",offset:0},X=n.vec4f64.fromValues(0,0,0,1);return p})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils".split(" "),
function(p,f,k,a,g,b,e,c,d){p=function(){function c(a,b,c){this.type="draped";this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=c;this.stage=null;this._visible=!1}c.prototype.initialize=function(a,b){this.stage=b};c.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this.stage.getDrapedTextureRenderer().addRenderGeometries(this.renderGeometries):this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries),
!0):!1};c.prototype.destroy=function(){this.stage&&this._visible&&this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries);this._visible=!1;this.stage=null};c.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};c.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=b.vec3f64.create());return b.vec3.set(a,0,0,0)};c.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=e.create());return e.empty(a)};
c.prototype.addHighlight=function(a,b){var c=this.stage.getDrapedTextureRenderer();this.renderGeometries.forEach(function(d){var e=c.addRenderGeometryHighlight(d,b);a.addRenderGeometry(d,c,e)})};c.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};c.prototype.getProjectedBoundingBox=function(b,c,l,k){return g(this,void 0,void 0,function(){var g,f,n,r;return a(this,function(a){switch(a.label){case 0:e.empty(k);for(g=0;g<this.renderGeometries.length;g++)f=
this.renderGeometries[g],this._getRenderGeometryProjectedBoundingRect(f,b,m,l),e.expand(k,m);if(!c)return[3,5];e.center(k,h);n=void 0;r=d.demResolutionForBoundingBox(k,c);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,c.service.queryElevation(h[0],h[1],r)];case 2:return n=a.sent(),[3,4];case 3:return a.sent(),n=null,[3,4];case 4:null!=n&&(k[2]=Math.min(k[2],n),k[5]=Math.max(k[5],n)),a.label=5;case 5:return[2,k]}})})};c.prototype._getRenderGeometryProjectedBoundingRect=function(a,b,c,d){if(this.boundingBox)e.set(l,
this.boundingBox);else{var h=a.center;a=a.bsRadius;l[0]=h[0]-a;l[1]=h[1]-a;l[2]=h[2]-a;l[3]=h[0]+a;l[4]=h[1]+a;l[5]=h[2]+a}b(l,0,2);this.calculateRelativeScreenBounds&&d.push({location:e.center(l),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return e.toRect(l,c)};return c}();var m=c.create(),l=e.create(),h=[0,0,0];return p})},"esri/views/3d/layers/graphics/SignedDistanceFunctions":function(){define(["require","exports","../../webgl-engine/lib/Util"],function(p,f,k){Object.defineProperty(f,
"__esModule",{value:!0});f.computeSignedDistancefieldCicle=function(a,g){var b=new Uint8Array(4*a*a),e=a/2-.5;g/=2;for(var c=0;c<a;c++)for(var d=0;d<a;d++){var f=d+a*c,l=d-e,h=c-e,l=Math.sqrt(l*l+h*h)-g,l=l/a+.5;k.packFloatRGBA(l,b,4*f)}return b};f.computeSignedDistancefieldSquare=function(a,g,b){b&&(g/=Math.SQRT2);for(var e=new Uint8Array(4*a*a),c=0;c<a;c++)for(var d=0;d<a;d++){var f=d-.5*(a-.5),l=c-.5*(a-.5),h=c*a+d;if(b)var n=(f+l)/Math.SQRT2,l=(l-f)/Math.SQRT2,f=n;f=Math.max(Math.abs(f),Math.abs(l))-
.5*g;f=f/a+.5;k.packFloatRGBA(f,e,4*h)}return e};f.computeSignedDistancefieldCrossAndX=function(a,g,b){b&&(g*=Math.SQRT2);g*=.5;for(var e=new Uint8Array(4*a*a),c=0;c<a;c++)for(var d=0;d<a;d++){var f=d-.5*a,l=c-.5*a,h=c*a+d;if(b)var n=(f+l)/Math.SQRT2,l=(l-f)/Math.SQRT2,f=n;n=void 0;f=Math.abs(f);l=Math.abs(l);n=f>l?f>g?Math.sqrt((f-g)*(f-g)+l*l):l:l>g?Math.sqrt(f*f+(l-g)*(l-g)):f;n=n/a+.5;k.packFloatRGBA(n,e,4*h)}return e}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/gl-matrix","../../../../renderers/support/utils"],function(p,f,k,a){function g(a){return null!==a&&void 0!==a}function b(a){return"number"===typeof a}function e(a,b){a&&a.push(b)}function c(c,h,l,f,k){var m=c.minSize,n=c.maxSize;if(c.expression)return e(k,"Could not convert size info: expression not supported"),!1;if(c.useSymbolValue)return c=f.symbolSize[l],h.minSize[l]=c,h.maxSize[l]=c,h.offset[l]=h.minSize[l],h.factor[l]=0,h.type[l]=1,!0;if(g(c.field)){if(g(c.stops)){if(2===
c.stops.length&&b(c.stops[0].size)&&b(c.stops[1].size))return d(c.stops[0].size,c.stops[1].size,c.stops[0].value,c.stops[1].value,h,l),h.type[l]=1,!0;e(k,"Could not convert size info: stops only supported with 2 elements");return!1}if(b(m)&&b(n)&&g(c.minDataValue)&&g(c.maxDataValue))return d(m,n,c.minDataValue,c.maxDataValue,h,l),h.type[l]=1,!0;if(null!=a.meterIn[c.valueUnit])return h.minSize[l]=-Infinity,h.maxSize[l]=Infinity,h.offset[l]=0,h.factor[l]=1/a.meterIn[c.valueUnit],h.type[l]=1,!0;"unknown"===
c.valueUnit?e(k,"Could not convert size info: proportional size not supported"):e(k,"Could not convert size info: scale-dependent size not supported");return!1}if(!g(c.field)){if(c.stops&&c.stops[0]&&b(c.stops[0].size))return h.minSize[l]=c.stops[0].size,h.maxSize[l]=c.stops[0].size,h.offset[l]=h.minSize[l],h.factor[l]=0,h.type[l]=1,!0;if(b(m))return h.minSize[l]=m,h.maxSize[l]=m,h.offset[l]=m,h.factor[l]=0,h.type[l]=1,!0}e(k,"Could not convert size info: unsupported variant of sizeInfo");return!1}
function d(a,b,c,d,e,h){d=0<Math.abs(d-c)?(b-a)/(d-c):0;e.minSize[h]=0<d?a:b;e.maxSize[h]=0<d?b:a;e.offset[h]=a-c*d;e.factor[h]=d}function m(a,b,d,h){if(a.normalizationField||a.valueRepresentation)return e(h,"Could not convert size info: unsupported property"),null;var g=a.field;if(null!=g&&"string"!==typeof g)return e(h,"Could not convert size info: field is not a string"),null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=
a.field;else if(a.field!==b.size.field)return e(h,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(g=c(a,b.size,0,d,h))?b:null;case "height":return(g=c(a,b.size,2,d,h))?b:null;case "depth":return(g=c(a,b.size,1,d,h))?b:null;case "width-and-depth":return(g=c(a,b.size,0,d,h))&&c(a,b.size,1,d,h),g?b:null;case null:case void 0:case "all":return(g=(g=(g=c(a,b.size,0,d,h))&&c(a,b.size,1,d,h))&&c(a,b.size,2,d,h))?b:null;default:return e(h,'Could not convert size info: unknown axis "'+
a.axis+'""'),null}}function l(a,b,c){for(var d=0;3>d;++d){var h=b.unitInMeters;1===a.type[d]&&(h*=b.modelSize[d],a.type[d]=2);a.minSize[d]/=h;a.maxSize[d]/=h;a.offset[d]/=h;a.factor[d]/=h}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return e(c,"No size axis contains a valid size or scale"),!1;for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[b],a.maxSize[d]=a.maxSize[b],a.offset[d]=a.offset[b],a.factor[d]=a.factor[b],a.type[d]=a.type[b]);return!0}function h(a,
b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function n(a,b,c){if(a.normalizationField)return e(c,"Could not convert color info: unsupported property"),null;if("string"===typeof a.field)if(a.stops){if(8<a.stops.length)return e(c,"Could not convert color info: too many color stops"),null;b.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c=a.stops;for(a=0;8>a;++a){var d=c[Math.min(a,c.length-1)];b.color.values[a]=
d.value;h(b.color.colors,a,d.color)}}else return e(c,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length)for(c=a.stops&&0<=a.stops.length&&a.stops[0].color,b.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a=0;8>a;a++)b.color.values[a]=Infinity,h(b.color.colors,a,c);else return e(c,"Could not convert color info: no field and no colors/stops"),null;return b}function q(a,b,c,d){a=2===c&&
"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;b.type[c]=1}function t(a,b,c){if("string"!==typeof a.field)return e(c,"Could not convert rotation info: field is not a string"),null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return e(c,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return q(a,b.rotation,
0,c),b;case "roll":return q(a,b.rotation,1,c),b;case null:case void 0:case "heading":return q(a,b.rotation,2,c),b;default:return e(c,'Could not convert rotation info: unknown axis "'+a.axis+'""'),null}}function u(a,b,c){if(!a)return null;var d=!b.supportedTypes||!!b.supportedTypes.size,h=!b.supportedTypes||!!b.supportedTypes.color,g=!b.supportedTypes||!!b.supportedTypes.rotation;return(a=a.reduce(function(a,l){if(!a)return a;if(l.valueExpression)return e(c,"Could not convert visual variables: arcade expressions not supported"),
null;switch(l.type){case "size":return d?m(l,a,b,c):a;case "color":return h?n(l,a,c):a;case "rotation":return g?t(l,a,c):a;default:return e(c,"Could not convert visual variables: unsupported type "+l.type),null}},{size:null,color:null,rotation:null}))&&a.size&&!l(a.size,b,c)?null:a}function r(a,b,c){if(!!a!==!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function y(a,b){var c=
{vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},d=a&&null!=a.size;a&&a.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=a.size.minSize,c.vvSizeMaxSize=a.size.maxSize,c.vvSizeOffset=a.size.offset,c.vvSizeFactor=a.size.factor):a&&d&&(c.vvSizeValue=b.transformation.scale);a&&d&&(c.vvSymbolAnchor=b.transformation.anchor,c.vvSymbolRotation=b.transformation.rotation);
a&&a.color&&(c.vvColorEnabled=!0,c.vvColorValues=a.color.values,c.vvColorColors=a.color.colors);return c}Object.defineProperty(f,"__esModule",{value:!0});f.convertVisualVariables=u;f.initFastSymbolUpdatesState=function(a,b){return!a||a.disableFastUpdates?{enabled:!1}:(a=u(a.visualVariables,b))?{enabled:!0,visualVariables:a,materialParameters:y(a,b),requiresShaderTransformation:a&&null!=a.size}:{enabled:!1}};f.updateFastSymbolUpdatesState=function(a,b,c){if(!b||!a.enabled)return!1;var d=a.visualVariables;
b=u(b.visualVariables,c);if(!(b&&r(d.size,b.size,"size")&&r(d.color,b.color,"color")&&r(d.rotation,b.rotation,"rotation")))return!1;a.visualVariables=b;a.materialParameters=y(b,c);a.requiresShaderTransformation=b&&null!=b.size;return!0};f.getMaterialParams=y;var x;(function(a){function b(a,b,c){return a<b?b:a>c?c:a}var c=k.mat4f64.create(),d=k.vec3f64.create();a.evaluateModelTransform=function(a,e,h){if(!a.vvSizeEnabled)return h;k.mat4.copy(c,h);var g=a.vvSymbolRotation[2],l=a.vvSymbolRotation[0],
f=a.vvSymbolRotation[1];h=c;void 0===h&&(h=k.mat4f64.create());g=g||0;l=l||0;f=f||0;0!==g&&k.mat4.rotateZ(h,h,-g/180*Math.PI);0!==l&&k.mat4.rotateX(h,h,l/180*Math.PI);0!==f&&k.mat4.rotateY(h,h,f/180*Math.PI);for(h=0;3>h;++h)d[h]=b(a.vvSizeOffset[h]+e[0]*a.vvSizeFactor[h],a.vvSizeMinSize[h],a.vvSizeMaxSize[h]);k.mat4.scale(c,c,d);k.mat4.translate(c,c,a.vvSymbolAnchor);return c};a.evaluateModelTransformScaleFactor=function(a,c){if(!a.vvSizeEnabled)return 1;for(var d=-Infinity,e=0;3>e;++e)d=Math.max(d,
b(a.vvSizeOffset[e]+c[0]*a.vvSizeFactor[e],a.vvSizeMinSize[e],a.vvSizeMaxSize[e]));return d}})(x||(x={}));f.evaluateModelTransform=x.evaluateModelTransform;f.evaluateModelTransformScaleFactor=x.evaluateModelTransformScaleFactor})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ../../../../core/Logger ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/imageUtils ../../support/mathUtils ../../support/buffer/typedArrayUtil ./DDSUtil ./DefaultVertexBufferLayouts ./glUtil3D ./IdGen ./Util ../shaders/MiscPrograms ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u){function r(a,c,d,e,l,f,k){k=!1!==k;g.requestImage(c).then(function(c){h.assert(1<=c.width&&1<=c.height);d.samplingMode=k?9987:9729;d.hasMipmap=k;!k&&33071===d.wrapMode||b.isPowerOfTwo(c.width)&&b.isPowerOfTwo(c.height)?(d.width=c.width,d.height=c.height,c=new t(a,d,c)):c=y(a,c,d,e,l);a.bindTexture(c);f(c)}).catch(function(a){var b=200<c.length?c.slice(0,100)+"..."+c.slice(c.length-100):c;x.error("Failed to load image from uri",b,a);f(null)})}function y(c,
e,g,l,f){var k=b.nextHighestPowerOfTwo(e.width),r=b.nextHighestPowerOfTwo(e.height);h.assert(k!==e.width||r!==e.height);g.width=k;g.height=r;var w=new t(c,g),z=q.createWithAttachments(c,w,{colorTarget:0,depthStencilTarget:0});e=new t(c,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!g.flipped,maxAnisotropy:8,preMultiplyAlpha:g.preMultiplyAlpha},e);c.bindFramebuffer(z);void 0===f&&(f=c.getViewport(),f=[f.x,f.y,f.width,f.height]);c.setViewport(0,0,k,r);l=l.getProgram(n.texOnly);
k=a.mat4f64.create();c.bindProgram(l);l.setUniformMatrix4fv("model",k);l.setUniformMatrix4fv("view",k);l.setUniformMatrix4fv("proj",k);l.setUniform4f("color",1,1,1,1);l.setUniform1i("tex",0);l=m.createQuadVAO(c,d.Pos3Tex);c.bindTexture(e,0);c.bindVAO(l);c.setDepthTestEnabled(!1);c.setBlendingEnabled(!1);c.drawArrays(5,0,u.vertexCount(l,"geometry"));c.setDepthTestEnabled(!0);c.bindFramebuffer(null);c.setViewport(f[0],f[1],f[2],f[3]);l.dispose(!0);e.dispose();c.bindFramebuffer(null);z.detachColorTexture();
z.dispose();g.hasMipmap&&w.generateMipmap();return w}var x=k.getLogger("esri.views.3d.webgl-engine.lib.Texture");return function(){function a(b,c,d){this.data=b;this.id=a.idGen.gen(c);this.unloadFunc=void 0;this.params=d||{};this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.params.wrap=this.params.wrap||{s:10497,t:10497};this.estimatedTexMemRequired=a.estimateTexMemRequired(this.data,
this.params)}a.estimateTexMemRequired=function(a,b){return null==a?0:e.isArrayBuffer(a)||e.isUint8Array(a)?a.byteLength:a instanceof Image||a instanceof ImageData||a instanceof HTMLCanvasElement?(b.mipmap?4/3:1)*a.width*a.height*4:(b.mipmap?4/3:1)*b.width*b.height*4||0};a.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired};a.prototype.dispose=function(){this.data=void 0};a.prototype.deferredLoading=function(){return"string"===typeof this.data};a.prototype.getWidth=
function(){return this.params.width};a.prototype.getHeight=function(){return this.params.height};a.prototype.initializeThroughUpload=function(d,g,l,f,k){var m=this.data;g.flipped=!this.params.noUnpackFlip;g.samplingMode=this.params.mipmap?9987:9729;g.hasMipmap=this.params.mipmap;g.wrapMode=this.params.wrap;g.preMultiplyAlpha=this.params.preMultiplyAlpha;if("string"===typeof m)r(d,m,g,l,f,k,this.params.mipmap);else{if(m instanceof Image||m instanceof ImageData||m instanceof HTMLCanvasElement){this.params.width=
m.width;this.params.height=m.height;var n=33071===this.params.wrap.s&&33071===this.params.wrap.t;!this.params.mipmap&&n||b.isPowerOfTwo(m.width)&&b.isPowerOfTwo(m.height)?(g.width=m.width,g.height=m.height,g=new t(d,g,m)):g=y(d,m,g,l,f)}else if(e.isArrayBuffer(m)&&this.params.encoding===a.DDS_ENCODING)g=c.createDDSTexture(d,g,m,this.params.mipmap);else if(e.isUint8Array(m)&&this.params.encoding===a.DDS_ENCODING)g=c.createDDSTexture(d,g,m.buffer,this.params.mipmap);else if(e.isUint8Array(m))h.assert(0<
this.params.width&&0<this.params.height),g.pixelFormat=1===this.params.components?6409:6408,g.width=this.params.width,g.height=this.params.height,g=new t(d,g,m);else{if(null!==m)throw console.warn("Unsupported image data"),Error("Unsupported image data");g=new t(d,g,null)}d.bindTexture(g);k(g)}this.data=void 0};a.prototype.setUnloadFunc=function(a){this.unloadFunc=a};a.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};a.createEmpty=function(b){void 0===
b&&(b="emptyTexture");return new a(new Uint8Array([0,0,0,0]),b,{width:1,height:1,wrap:{s:33071,t:33071}})};a.idGen=new l;a.DDS_ENCODING="image/vnd-ms.dds";return a}()})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../webgl/Texture"],function(p,f,k){function a(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}Object.defineProperty(f,"__esModule",{value:!0});var g=a("DXT1"),b=a("DXT3"),e=a("DXT5");f.createDDSTexture=
function(a,d,f,l){var c=new Int32Array(f,0,31);if(542327876!==c[0])return console.error("Invalid magic number in DDS header"),null;if(!(c[20]&4))return console.error("Unsupported format, must contain a FourCC code"),null;var m=c[21],q;switch(m){case g:m=8;q=33776;break;case b:m=16;q=33778;break;case e:m=16;q=33779;break;default:return console.error("Unsupported FourCC code:",String.fromCharCode(m&255,m>>8&255,m>>16&255,m>>24&255)),null}var t=1;c[2]&131072&&!1!==l&&(t=Math.max(1,c[7]));l=c[4];for(var u=
c[3],r=c[1]+4,y,x,z=[],w=0;w<t;++w)x=Math.floor((l+3)/4)*Math.floor((u+3)/4)*m,y=new Uint8Array(f,r,x),z.push(y),r+=x,l=Math.max(1,l>>1),u=Math.max(1,u>>1);d.samplingMode=1<t?9987:9729;d.hasMipmap=1<t;d.width=c[4];d.height=c[3];d.internalFormat=q;d=new k(a,d,{type:"compressed",levels:z});a.bindTexture(d);return d}})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y){return function(h){function f(){return null!==h&&h.apply(this,arguments)||this}k(f,h);f.prototype._prepareResources=function(){var b=this.symbol,c=this._isPropertyDriven("size")||this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),d=this._getStageIdHint();b=null!=b.size?a.pt2px(b.size):1;d={idHint:d,width:b,color:this._getMaterialOpacityAndColor(),slicePlaneEnabled:this._context.slicePlaneEnabled};if(!this._isPropertyDriven("size")&&(b=
n.validateSymbolLayerSize(d.width))){this._logWarning(b);this.reject();return}if(c||1.5<=d.width)this._isPropertyDriven("size")&&(d.width=0),this._material=q.createRibbonMaterial(d);else if(0<d.width)this._material=q.createNativeMaterial(d);else{this.reject();return}this._context.stage.add(t.ModelContentType.MATERIAL,this._material);this.resolve()};f.prototype.destroy=function(){h.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(t.ModelContentType.MATERIAL,
this._material.id),this._material=null)};f.prototype.createGraphics3DGraphic=function(b){var c=b.renderingInfo;b=b.graphic;var d=b.geometry;if("polyline"!==d.type&&"polygon"!==d.type&&"extent"!==d.type)return this._logWarning("unsupported geometry type for line symbol: "+d.type),null;if(!this._validateGeometry(d))return null;var d="polygon"===d.type||"extent"===d.type?"rings":"paths",e="graphic"+b.uid,h=this._getVertexOpacityAndColor(c,Float32Array,255),g=0;c.size&&this._isPropertyDriven("size")&&
(g=l.getSingleSizeDriver(c.size),g=a.pt2px(g));c=this.getGraphicElevationContext(b);return"on-the-ground"===c.mode?this._createAsOverlay(b,d,h,g,c,e):this._createAs3DShape(b,d,h,g,c,e,b.uid)};f.prototype.layerOpacityChanged=function(){var a=this._material.getColor(),a={color:[a[0],a[1],a[2],this._getMaterialOpacity()]};this._material.setParameterValues(a);return!0};f.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;if(null==c||null==d)return!1;if("on-the-ground"===
c&&"on-the-ground"===d)return!0;if(c!==d&&("on-the-ground"===c||"on-the-ground"===d))return!1;var e=l.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};f.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};f.prototype._getOutlineGeometry=function(a,b){return b};f.prototype._getGeometry=function(a){a=a.geometry;"extent"===a.type&&(a=b.fromExtent(a));return a};
f.prototype._createAs3DShape=function(a,b,d,e,h,f,k){var n=this._getGeometry(a),t=n[b],w=this._getOutlineGeometry(n,t);a=[];var y=[],z=[],x=g.vec3f64.create(),B=Array(6),n=l.getGeometryVertexData3D(w,n.hasZ,n.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,h);this._logGeometryCreationWarnings(n,t,b,"LineSymbol3DLayer");if(0<w.length){for(var t=n.geometryData.outlines,w=n.eleVertexData,p=n.vertexData,C=0;C<t.length;++C){var F=t[C];
if(!(1>=F.count)){var K=F.index,L=F.count;if(this._context.clippingExtent&&(l.computeBoundingBox(w,K,L,B),l.boundingBoxClipped(B,this._context.clippingExtent)))continue;l.chooseOrigin(p,K,L,x);l.subtractCoordinates(p,K,L,x);F=new Float64Array(w.buffer,3*K*w.BYTES_PER_ELEMENT,3*L);K=new Float64Array(p.buffer,3*K*p.BYTES_PER_ELEMENT,3*L);K=q.createPolylineGeometry(K,F,"rings"===b,d,e);K=new u(K,f+"path"+C);K.singleUse=!0;a.push(K);y.push(this._material);K=g.mat4f64.create();g.mat4.translate(K,K,x);
z.push(K)}}if(0<a.length)return b=new r({geometries:a,materials:y,transformations:z,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:k},idHint:f}),b=new m(this,b,a,null,null,c.perVertexElevationAligner,h),b.alignedTerrainElevation=n.terrainElevation,b.needsElevationUpdates=l.needsElevationUpdates2D(h.mode),b}return null};f.prototype._createAsOverlay=function(a,b,c,h,f,k){var m=this._getGeometry(a);this._material.renderPriority=this._symbolLayerOrder;var n=m[b],r=this._getOutlineGeometry(m,
n);a=[];f=Array(6);var u=e.empty(),t=g.vec3f64.create(),m=l.getGeometryVertexDataDraped(r,m.spatialReference,this._context.overlaySR);this._logGeometryCreationWarnings(m,n,b,"LineSymbol3DLayer");if(0<r.length){n=m.vertexData;r=m.geometryData.outlines;for(m=0;m<r.length;++m){var w=r[m],z=w.index,w=w.count;l.computeBoundingBox(n,z,w,f);if(!l.boundingBoxClipped(f,this._context.clippingExtent)){e.expand(u,f);l.chooseOrigin(n,z,w,t);l.subtractCoordinates(n,z,w,t);l.setZ(n,z,w,this._getDrapedZ());w=new Float64Array(n.buffer,
3*z*n.BYTES_PER_ELEMENT,3*w);z=g.mat4f64.create();g.mat4.translate(z,z,t);var w=q.createPolylineGeometry(w,null,"rings"===b,c,h),x=new y(w);x.material=this._material;x.center=[.5*(f[0]+f[3]),.5*(f[1]+f[4]),0];x.bsRadius=.5*Math.sqrt((f[3]-f[0])*(f[3]-f[0])+(f[4]-f[1])*(f[4]-f[1]));x.transformation=z;x.name=k;x.uniqueName=k+"#"+w.id;a.push(x)}}return new d(this,a,u)}return null};return f}(h)})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(p,f,k,a,g,b){function e(a){var b=a.length;return a[0]===a[b-3]&&a[1]===a[b-2]&&a[2]===a[b-1]}Object.defineProperty(f,"__esModule",{value:!0});var c=a.VertexAttrConstants;f.createRibbonMaterial=function(a){var c={width:a.width,color:a.color,miterLimit:a.miterLimit,polygonOffset:!0,join:"miter",slicePlaneEnabled:a.slicePlaneEnabled};"miter"===a.join||"bevel"===a.join?c.join=a.join:a.join&&console.warn("unsupported join type for line symbol: "+a.join);return new b(c,a.idHint+"_ribbonlinemat")};
f.createNativeMaterial=function(a){return new g({color:a.color,slicePlaneEnabled:a.slicePlaneEnabled},a.idHint+"_nativelinemat")};f.isClosed=e;f.createPolylineGeometry=function(a,b,g,h,f){var d,l,m;if(g=g&&!e(a)){g=new Float32Array(a.length+3);for(l=0;l<a.length;l++)g[l]=a[l];l=g.length;g[l-3]=a[0];g[l-2]=a[1];g[l-1]=a[2];d=a.length/3+1;l=new Uint32Array(2*(d-1));m=new Uint32Array(2*(d-1))}else d=a.length/3,l=new Uint32Array(2*(d-1)),m=new Uint32Array(2*(d-1)),g=a;a=new Float32Array(1);a[0]=f;for(var n=
f=0,y=0;y<d-1;y++)l[f++]=y,l[f++]=y+1,m[n++]=0,m[n++]=0;f={};d={};f[c.POSITION]=l;f[c.COLOR]=m;f[c.SIZE]=m;d[c.POSITION]={size:3,data:g,offsetIdx:0,strideIdx:3};d[c.COLOR]={size:4,data:h,offsetIdx:0,strideIdx:4};d[c.SIZE]={size:1,data:a,offsetIdx:0,strideIdx:1};b&&(f.mapPos=l,d.mapPos={size:3,data:b,offsetIdx:0,strideIdx:3});return new k(d,f,k.DefaultOffsets,"line")}})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/NativeLinePrograms".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q){var t=a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");p=function(a){function d(b,c){c=a.call(this,c)||this;c.bufferWriter=new w;c.canBeMerged=!0;c.params=n.copyParameters(b,y);return c}k(d,a);d.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)b[c]=a[c];this.notifyDirty("matChanged")};d.prototype.getColor=function(){return this.params.color};d.prototype.getParameterValues=function(){return n.copyParameters(this.params)};
d.prototype.intersect=function(a,d,e,h,f,k,m,n){if(h.isSelection&&!c.isAllHidden(d.componentVisibilities,a.data.componentOffsets))if(l.isTranslationMatrix(e)){d=a.data.getVertexAttr().position.data;f=h.camera;k=h.point;g.vec3.set(P[0],k[0]-2,k[1]+2,0);g.vec3.set(P[1],k[0]+2,k[1]+2,0);g.vec3.set(P[2],k[0]+2,k[1]-2,0);g.vec3.set(P[3],k[0]-2,k[1]-2,0);for(n=0;4>n;n++)f.unprojectPoint(P[n],O[n]);b.plane.fromPoints(f.eye,O[0],O[1],W);b.plane.fromPoints(f.eye,O[1],O[2],Q);b.plane.fromPoints(f.eye,O[2],
O[3],J);b.plane.fromPoints(f.eye,O[3],O[0],F);a=Number.MAX_VALUE;for(n=0;n<d.length-5;n+=3)if(B[0]=d[n]+e[12],B[1]=d[n+1]+e[13],B[2]=d[n+2]+e[14],C[0]=d[n+3]+e[12],C[1]=d[n+4]+e[13],C[2]=d[n+5]+e[14],!(0>b.plane.signedDistance(W,B)&&0>b.plane.signedDistance(W,C)||0>b.plane.signedDistance(Q,B)&&0>b.plane.signedDistance(Q,C)||0>b.plane.signedDistance(J,B)&&0>b.plane.signedDistance(J,C)||0>b.plane.signedDistance(F,B)&&0>b.plane.signedDistance(F,C))){f.projectPoint(B,G);f.projectPoint(C,H);if(0>G[2]&&
0<H[2]){g.vec3.subtract(D,B,C);var r=f.frustum,q=-b.plane.signedDistance(r.planes[4],B),r=q/g.vec3.dot(D,r.planes[4]);g.vec3.scale(D,D,r);g.vec3.add(B,B,D);f.projectPoint(B,G)}else if(0<G[2]&&0>H[2])g.vec3.subtract(D,C,B),r=f.frustum,q=-b.plane.signedDistance(r.planes[4],C),r=q/g.vec3.dot(D,r.planes[4]),g.vec3.scale(D,D,r),g.vec3.add(C,C,D),f.projectPoint(C,H);else if(0>G[2]&&0>H[2])continue;r=l.pointLineSegmentDistanceSquared2D(G,H,k);r<a&&(a=r,g.vec3.copy(I,B),g.vec3.copy(N,C))}e=h.p0;h=h.p1;4>
a&&(a=Number.MAX_VALUE,b.lineSegment.closestLineSegmentPoint(b.lineSegment.fromPoints(I,N,S),b.lineSegment.fromPoints(e,h,M),E)&&(g.vec3.subtract(E,E,e),a=g.vec3.length(E),g.vec3.scale(E,E,1/a),a/=g.vec3.distance(e,h)),m(a,E))}else t.error("intersection assumes a translation-only matrix")};d.prototype.getGLMaterials=function(){return{color:u,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:r}};d.prototype.getAllTextureIds=function(){return[]};return d}(m);var u=function(a){function b(b,
c,d){b=a.call(this,b,c)||this;b.updateParameters();return b}k(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(q.colorPass,{slice:this.params.slicePlaneEnabled})};b.prototype.beginSlot=function(a){return 4===a};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("color",
c.color);a.setBlendingEnabled(1>c.color[3]);a.setBlendFunctionSeparate(770,771,1,771);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){1>this.params.color[3]&&a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;n.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&n.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 1};
return b}(d),r=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();return b}k(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.beginSlot=function(a){return 4===a};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(q.highlightPass,{slice:this.params.slicePlaneEnabled})};b.prototype.bind=function(a,b){a.bindProgram(this.program);
a.setDepthTestEnabled(!0)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;n.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&n.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 1};return b}(d),y={color:[1,1,1,1],slicePlaneEnabled:!1},x=e.newLayout().vec3f(l.VertexAttrConstants.POSITION),z,w=function(){function a(){this.vertexBufferLayout=
x}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[l.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d,e){var g=c=b.vertexAttr[l.VertexAttrConstants.POSITION].data;if(a=a.transformation){if(!z||z.length<c.length)z=new Float32Array(c.length);for(var g=z,f=0;f<c.length;f+=3){var k=c[f],m=c[f+1],n=c[f+2];g[f]=a[0]*k+a[4]*m+a[8]*n+a[12];g[f+1]=a[1]*k+a[5]*m+a[9]*n+a[13];g[f+2]=a[2]*k+a[6]*m+a[10]*
n+a[14]}}h.writeBufferVec3(b.indices[l.VertexAttrConstants.POSITION],g,d.position,e)};return a}(),B=g.vec3f64.create(),C=g.vec3f64.create(),D=g.vec3f64.create(),E=g.vec3f64.create(),G=g.vec3f64.create(),H=g.vec3f64.create(),I=g.vec3f64.create(),N=g.vec3f64.create(),S=b.lineSegment.create(),M=b.lineSegment.create(),P=[g.vec3f64.create(),g.vec3f64.create(),g.vec3f64.create(),g.vec3f64.create()],O=[g.vec3f64.create(),g.vec3f64.create(),g.vec3f64.create(),g.vec3f64.create()],W=b.plane.create(),Q=b.plane.create(),
J=b.plane.create(),F=b.plane.create();return p})},"esri/views/3d/webgl-engine/shaders/NativeLinePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});f.colorPass={name:"native-line-color",shaders:function(b){return{vertexShader:a.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:g.glslifyDefineMap({SLICE:b.slice})+a.resolveIncludes("materials/nativeLine/colorPass.frag")}},
attributes:k.Default3D};f.highlightPass={name:"native-line-highlight",shaders:function(b){return{vertexShader:a.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:g.glslifyDefineMap({SLICE:b.slice})+a.resolveIncludes("materials/nativeLine/highlightPass.frag")}},attributes:k.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/compilerUtils ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H){var I=E.VertexAttrConstants;p=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a._edgeStageObjects=new Set;a._materials={};a._textures={};return a}k(d,c);d.prototype._prepareResources=function(){y.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new H({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=new H({color:[0,1,1,1]},"debugFAceNormal"));this.resolve()};d.prototype.destroy=function(){c.prototype.destroy.call(this);
this.isFulfilled()||this.reject();for(var a in this._materials)this._context.stage.remove(z.ModelContentType.MATERIAL,this._materials[a].material.id);for(a in this._textures)this._context.stage.remove(z.ModelContentType.TEXTURE,this._textures[a].id);this._materials={};this._textures={}};d.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("mesh"!==b.geometry.type)return this._logWarning("unsupported geometry type for fill on mesh-3d symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;
var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};d.prototype.layerOpacityChanged=function(){var a=this._getLayerOpacity(),b;for(b in this._materials){var c=this._materials[b];c.material.setParameterValues({layerOpacity:a});var d=c.material.getParameterValues();this._setMaterialTransparentParameter(d,c.isComponentTransparent);c.material.setParameterValues({transparent:d.transparent})}if(0<this._edgeStageObjects.size){var e=this._context.stage.view.getEdgeView(),
h=this._getLayerOpacity();this._edgeStageObjects.forEach(function(a){e.updateAllComponentOpacities(a,[h])})}return!0};d.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,q.needsElevationUpdates3D)};d.prototype.slicePlaneEnabledChanged=function(a,b){var c=this,d;for(d in this._materials)this._materials[d].material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});if(0<this._edgeStageObjects.size){var e=this._context.stage.view.getEdgeView();
a=this._createEdgeMaterial(e);if(g.isSome(a)){var h=[a];this._edgeStageObjects.forEach(function(a){e.updateAllComponentMaterials(a,h,{slicePlaneEnabled:c._context.slicePlaneEnabled},!1)})}}return!0};d.prototype._requiresSymbolVertexColors=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};d.prototype._colorUid=function(a){a=a.material&&a.material.color;if(!a)return"-";if(a)switch(a.type){case "value":return a.value.toHex();case "image":return a.uid;default:b.neverReached(a)}};
d.prototype._materialProperties=function(a,b,c){var d=this._requiresSymbolVertexColors(),e=b.material&&b.material.color;b=this._colorUid(b);a=!!a.vertexAttributes.color;return{hasSymbolVertexColors:d,hasVertexColors:a,color:e,uid:"vc:"+a+",vct"+c+",svc:"+d+",cmuid:"+b}};d.prototype._setInternalColorValueParameters=function(b,c){c.diffuse=a.toUnitRGB(b.value);c.opacity=b.value.a};d.prototype._getLoadableTextureResource=function(a){return a.data?a.data instanceof HTMLImageElement?a.data.complete?a.data:
a.data.src:a.data:a.url};d.prototype._setInternalColorImageParameters=function(a,b,c){var d=this._getLoadableTextureResource(a);if(d){var e=this._textures[a.uid];e||(e=new D(d,b+"_"+a.uid+"_tex",{mipmap:!0,wrap:{s:10497,t:10497},noUnpackFlip:!0}),this._textures[a.uid]=e,this._context.stage.add(z.ModelContentType.TEXTURE,e));c.textureId=e.id}};d.prototype._setInternalMaterialParameters=function(a,b,c){if(a=a.material&&a.material.color)switch(a.type){case "value":this._setInternalColorValueParameters(a,
c);break;case "image":this._setInternalColorImageParameters(a,b,c)}};d.prototype._setExternalMaterialParameters=function(b){if(this._isPropertyDriven("color"))b.externalColor=S;else{var c=this.symbol.material?a.toUnitRGBA(this.symbol.material.color):S;b.externalColor=c}if(c=this.symbol.material&&this.symbol.material.colorMixMode)b.colorMixMode=c};d.prototype._hasTransparentVertexColors=function(a){a=a.vertexAttributes.color;if(!a)return!1;for(var b=3;b<a.length;b+=4)if(255!==a[b])return!0;return!1};
d.prototype._getOrCreateMaterial=function(a,b){var c=this._hasTransparentVertexColors(a)||!!b.get("material.color.transparent");a=this._materialProperties(a,b,c);var d=this._materials[a.uid];if(d)return d.material;var d=this._getStageIdHint(),e={specular:M,vertexColors:a.hasVertexColors,symbolColors:a.hasSymbolVertexColors,ambient:M,diffuse:N,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,
textureInitTransparent:!0};this._setInternalMaterialParameters(b,d,e);this._setExternalMaterialParameters(e);this._setMaterialTransparentParameter(e,c);b=new G(e,d+"_"+a.uid+"_mat");this._materials[a.uid]={material:b,isComponentTransparent:c};this._context.stage.add(z.ModelContentType.MATERIAL,b);return b};d.prototype._setMaterialTransparentParameter=function(a,b){var c=this._isPropertyDriven("opacity");a.transparent=c||b||1>a.layerOpacity||1>a.opacity||a.externalColor&&1>a.externalColor[3]};d.prototype._addDebugNormals=
function(a,b,c,d){var h,g,l,f,k=b.length,m=a.spatialReference.isWGS84?20015077/180:1,n=.1*Math.max(a.extent.width*m,a.extent.height*m,a.extent.zmax-a.extent.zmin),r=[],q=[];a=[];for(var m=[],u=0;u<k;u++)for(var t=b[u],y=t.data.getAttribute(I.POSITION),z=t.data.getAttribute(I.NORMAL),x=t.data.getIndices(I.POSITION),t=t.data.getIndices(I.NORMAL),y=y.data,z=z.data,F=0;F<x.length;F++){for(var p=3*x[F],L=3*t[F],C=0;3>C;C++)r.push(y[p+C]);for(C=0;3>C;C++)r.push(y[p+C]+z[L+C]*n);q.push(q.length);q.push(q.length);
if(0===F%3){this._calculateFaceNormal(y,x,F,J);this._getFaceVertices(y,x,F,O,W,Q);e.vec3.add(O,O,W);e.vec3.add(O,O,Q);e.vec3.scale(O,O,1/3);for(C=0;3>C;C++)a.push(O[C]);for(C=0;3>C;C++)a.push(O[C]+J[C]*n);m.push(m.length);m.push(m.length)}}k=(h={},h[I.POSITION]={data:new Float64Array(r),size:3},h);h=(g={},g[I.POSITION]=new Uint32Array(q),g);g=new B(k,h,void 0,"line");g=new w(g,"debugVertexNormal");g.singleUse=!0;b.push(g);c.push(this._debugVertexNormalMaterial);d.push(e.mat4f64.clone(d[0]));k=(l=
{},l[I.POSITION]={data:new Float64Array(a),size:3},l);h=(f={},f[I.POSITION]=new Uint32Array(m),f);g=new B(k,h,void 0,"line");g=new w(g,"debugFaceNormal");g.singleUse=!0;b.push(g);c.push(this._debugFaceNormalMaterial);d.push(e.mat4f64.clone(d[0]))};d.prototype._createAs3DShape=function(a,b,c,d,e){var l=this;a=a.geometry;if("mesh"!==a.type)return null;var f=this._createGeometryInfo(a,b,d);if(!f)return null;b=f.geometries;var k=f.materials,m=f.transformations,f=f.objectTransformation;y.DRAW_MESH_GEOMETRY_NORMALS&&
this._addDebugNormals(a,b,k,m);var r=new C({geometries:b,materials:k,transformations:m,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:e},idHint:d});r.setObjectTransformation(f);var u=function(a){var b=l._context.stage.view.getEdgeView();if(b){b.removeObject(a);l._edgeStageObjects.delete(a);var c=l._createEdgeMaterial(b);g.isSome(c)&&(l._edgeStageObjects.add(a),b.addObject(a,[c],{slicePlaneEnabled:l._context.slicePlaneEnabled},{mergeGeometries:!0}))}};u(r);d=function(a,b,c,d,e){a=
h.perObjectElevationAligner(a,b,c,d,e);u(r);return a};e=new n(this,r,b,null,null,d,c);e.needsElevationUpdates=q.needsElevationUpdates3D(c.mode);c=a.extent.center.clone();c.z=0;e.elevationContext.centerPointInElevationSR=c;e.alignedTerrainElevation=d(e,e.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext);return e};d.prototype._createComponentNormals=function(a,c,d,e){var h=d.shading||"flat";switch(h){case "source":return this._createComponentNormalsSource(a,
c,d,e);case "flat":return this._createComponentNormalsFlat(a,d,e);case "smooth":return this._createComponentNormalsSmooth(a,d,e);default:b.neverReached(h)}};d.prototype._createComponentNormalsSource=function(a,b,c,d){if(!b)return this._createComponentNormalsFlat(a,c,d);c=!1;for(var h=0;h<d.length;h+=3){this._calculateFaceNormal(a,d,h,J);for(var g=0;3>g;g++){var l=3*d[h+g];O[0]=b[l+0];O[1]=b[l+1];O[2]=b[l+2];0>e.vec3.dot(J,O)&&(b[l+0]=-b[l+0],b[l+1]=-b[l+1],b[l+2]=-b[l+2],c=!0)}}return{normals:b,indices:d,
didFlipNormals:c}};d.prototype._createComponentNormalsFlat=function(a,b,c){b=new Float32Array(c.length);for(var d=new Uint32Array(3*c.length),e=0;e<c.length;e+=3)for(var h=this._calculateFaceNormal(a,c,e,J),g=0;3>g;g++)b[e+g]=h[g],d[e+g]=e/3;return{normals:b,indices:d,didFlipNormals:!1}};d.prototype._createComponentNormalsSmooth=function(a,b,c){b={};for(var d=0;d<c.length;d+=3)for(var h=this._calculateFaceNormal(a,c,d,J),g=0;3>g;g++){var l=c[d+g],f=b[l];f||(f={normal:e.vec3f64.create(),count:0},b[l]=
f);e.vec3.add(f.normal,f.normal,h);f.count++}a=new Float32Array(3*c.length);h=new Uint32Array(3*c.length);for(d=0;d<c.length;d++){l=c[d];f=b[l];1!==f.count&&(e.vec3.normalize(f.normal,f.normal),f.count=1);for(g=0;3>g;g++)a[3*d+g]=f.normal[g];h[d]=d}return{normals:a,indices:h,didFlipNormals:!1}};d.prototype._getFaceVertices=function(a,b,c,d,e,h){var g=3*b[c+0],l=3*b[c+1];b=3*b[c+2];d[0]=a[g+0];d[1]=a[g+1];d[2]=a[g+2];e[0]=a[l+0];e[1]=a[l+1];e[2]=a[l+2];h[0]=a[b+0];h[1]=a[b+1];h[2]=a[b+2]};d.prototype._calculateFaceNormal=
function(a,b,c,d){this._getFaceVertices(a,b,c,O,W,Q);e.vec3.subtract(W,W,O);e.vec3.subtract(Q,Q,O);e.vec3.cross(O,W,Q);e.vec3.normalize(d,O);return d};d.prototype._getOrCreateComponents=function(a){return a.components?a.components:T};d.prototype._createPositionBuffer=function(a){var b=a.vertexAttributes.position,c=new Float64Array(b.length);q.reproject(a.vertexAttributes.position,0,a.spatialReference,c,0,this._context.renderSpatialReference,b.length/3);return c};d.prototype._createNormalBuffer=function(a,
b){var c=a.vertexAttributes.normal;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var d=a.vertexAttributes.position,e=new Float32Array(c.length);return l.projectNormalToECEF(c,d,b,a.spatialReference,e)};d.prototype._createColorBuffer=function(a){return a.vertexAttributes.color};d.prototype._createSymbolColorBuffer=function(a){if(this._requiresSymbolVertexColors()){a=this._getVertexOpacityAndColor(a);var b=this.symbol.material&&this.symbol.material.colorMixMode||null,
c=new Uint8Array(4);r.encodeSymbolColor(a,b,c);return c}return null};d.prototype._createColorIndices=function(a,b){a=new Uint32Array(b.length);for(b=0;b<a.length;b++)a[b]=0;return a};d.prototype._createBuffers=function(a,b){var c=a.vertexAttributes&&a.vertexAttributes.position;if(!c)return this._logWarning("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal,e=a.vertexAttributes.uv;if(d&&d.length!==c.length)return this._logWarning("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),
null;if(e&&e.length/2!==c.length/3)return this._logWarning("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;c=this._createPositionBuffer(a);d=this._createColorBuffer(a);b=this._createSymbolColorBuffer(b);var h=this._createNormalBuffer(a,c);a=this._transformCenterLocal(a,c,h);return{positionBuffer:c,normalBuffer:h,uvBuffer:e,colorBuffer:d,symbolColorBuffer:b,objectTransformation:a}};d.prototype._transformCenterLocal=function(a,b,c){var d=a.extent.center,
h=this._context.renderSpatialReference;P[0]=d.x;P[1]=d.y;P[2]=0;d=e.mat4f64.create();x.computeLinearTransformation(a.spatialReference,P,d,h);e.mat4.invert(F,d);for(a=0;a<b.length;a+=3)O[0]=b[a+0],O[1]=b[a+1],O[2]=b[a+2],e.vec3.transformMat4(O,O,F),b[a+0]=O[0],b[a+1]=O[1],b[a+2]=O[2];if(c)for(e.mat3.fromMat4(K,d),e.mat3.transpose(K,K),a=0;a<c.length;a+=3)O[0]=c[a+0],O[1]=c[a+1],O[2]=c[a+2],e.vec3.transformMat3(O,O,K),c[a+0]=O[0],c[a+1]=O[1],c[a+2]=O[2];return d};d.prototype._validateFaces=function(a,
b){a=a.vertexAttributes.position.length/3;if(b=b.faces){for(var c=-1,d=0;d<b.length;d++){var e=b[d];e>c&&(c=e)}if(a<=c)return this._logWarning("Vertex index "+c+" is out of bounds of the mesh position buffer"),!1}else if(0!==a%3)return this._logWarning("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};d.prototype._getOrCreateFaces=function(a,b){if(b.faces)return b.faces;a=new Uint32Array(a.vertexAttributes.position.length/
3);for(b=0;b<a.length;b++)a[b]=b;return a};d.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var b=a.vertexAttributes&&a.vertexAttributes.position;if(!b)return!1;var c=this._context.elevationProvider.spatialReference,d=b.length/3;a.spatialReference.equals(c)||(b=new Float64Array(b.length),q.reproject(a.vertexAttributes.position,0,a.spatialReference,b,0,c,d));q.computeBoundingBox(b,0,d,L);return q.boundingBoxClipped(L,this._context.clippingExtent)};d.prototype._createGeometryInfo=
function(a,b,c){var d,h;if(!m.canProject(a,this._context.layerView.view.spatialReference))return this._logWarning("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(a))return null;var g=this._createBuffers(a,b);if(!g)return null;b=g.positionBuffer;for(var l=g.uvBuffer,f=g.colorBuffer,k=g.symbolColorBuffer,n=g.normalBuffer,g=g.objectTransformation,r=[],q=[],u=[],t=!1,y=0,z=this._getOrCreateComponents(a);y<z.length;y++){var x=z[y];if(!this._validateFaces(a,
x))return null;var F=this._getOrCreateFaces(a,x);if(0!==F.length){var p=this._createComponentNormals(b,n,x,F);p.didFlipNormals&&(t=!0);var L=(d={},d[I.POSITION]={size:3,data:b},d[I.NORMAL]={size:3,data:p.normals},d),p=(h={},h[I.POSITION]=F,h[I.NORMAL]=p.indices,h);f&&(L[I.COLOR]={size:4,data:f},p[I.COLOR]=F);k&&(L[I.SYMBOLCOLOR]={size:4,data:k},p[I.SYMBOLCOLOR]=this._createColorIndices(x,F));a.vertexAttributes.uv&&(L[I.UV0]={size:2,data:l},p[I.UV0]=F);F=new B(L,p);F=new w(F,c+"_mesh");F.singleUse=
!0;r.push(F);q.push(e.mat4f64.create());u.push(this._getOrCreateMaterial(a,x))}}t&&this._logWarning("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:r,transformations:q,materials:u,objectTransformation:g}};d.prototype._createEdgeMaterial=function(a){var b={opacity:this._getLayerOpacity()};return u.createMaterial(a,this.symbol,b)};return d}(t);var N=[1,
1,1],S=[1,1,1,1],M=[0,0,0],P=e.vec3f64.create(),O=e.vec3f64.create(),W=e.vec3f64.create(),Q=e.vec3f64.create(),J=e.vec3f64.create(),F=e.mat4f64.create(),K=e.mat3f64.create(),L=c.create(),T=[new d];return p})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.encodeSymbolColor=function(b,c,d,f){void 0===f&&(f=0);null==b||"ignore"===c?(d[f+0]=255,d[f+1]=255,d[f+2]=255,d[f+3]=255):(d[f+0]=Math.floor(255*
b[0]),d[f+1]=Math.floor(255*b[1]),d[f+2]=Math.floor(255*b[2]),b=Math.floor(b[3]*k),d[f+3]=0===b?0:"tint"===c?b:"replace"===c?b+a:b+g)};f.isOpaqueSymbolColor=function(e,c){void 0===c&&(c=0);e=e[c+3];return e===a||e===g||e===b};var k=85,a=k,g=2*k,b=3*k})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/errors/CancelError ../../../../Color ../../../../core/asyncUtils ../../../../core/lang ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ../../../../symbols/ObjectSymbol3DLayer ./ElevationAligners ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./objectResourceUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H){p=function(f){function t(){var a=null!==f&&f.apply(this,arguments)||this;a._instanceIndexToGraphicUid=new Map;return a}k(t,f);Object.defineProperty(t.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0});t.prototype._prepareResources=function(){var a=this.symbol,b=this._getStageIdHint();this._optionalFields=[];if(!this._isPropertyDriven("size")){var c=u.validateSymbolLayerSize(this.symbol);
if(c){this._logWarning(c);this.reject();return}}a.resource&&a.resource.href?this._prepareModelResources(a.resource.href,b):this._preparePrimitiveResources(a.resource?a.resource.primitive:"sphere",b)};t.prototype._preparePrimitiveResources=function(a,b){if(x.isValidPrimitive(a)){var h=this.symbol;this._resourceBoundingBox=m.create(x.primitiveBoundingBox(a));this._resourceSize=d.vec3f64.fromArray(m.size(this._resourceBoundingBox));this._symbolSize=d.vec3f64.fromArray(u.computeSizeWithResourceSize(this._resourceSize,
h));var l=this._getMaterialOpacity(),l={specular:[0,0,0],opacity:l,transparent:1>l||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:I,diffuse:I,slicePlaneEnabled:this._context.slicePlaneEnabled},f=this.symbolContainer;if("point-3d"===f.type&&f.verticalOffset){var f=f.verticalOffset,k=f.minWorldLength,n=f.maxWorldLength;l.verticalOffset={screenLength:c.pt2px(f.screenLength),minWorldLength:k||0,maxWorldLength:null!=n?n:Infinity};l.castShadows=!1}this._context.screenSizePerspectiveEnabled&&
(l.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._isPropertyDriven("color")?l.externalColor=N:(h=h.material?g.toUnitRGBA(h.material.color):N,l.externalColor=h);this._fastUpdates=w.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(e.mixin(l,this._fastUpdates.materialParameters),l.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&
(l.instanced.push("color"),this._optionalFields.push("color"));h=new H(l,b+"_objectmat");this._lodResources=x.primitiveLodResources(a,h,b);this._originalOpacities=G.materialsFromLodResources(this._lodResources).map(function(){return 1});this._lodResources?(this.finalizeSymbolResources(),this.initializeLodRenderer(),this.complexity=this.computeComplexity(),this.resolve()):(this._logWarning("Unknown object symbol primitive: "+a),this.reject())}else this._logWarning("Unknown object symbol primitive: "+
a),this.reject()};t.prototype._prepareModelResources=function(h,g){var l=this,f=["transformation"];g={materialParamsMixin:{instanced:f,slicePlaneEnabled:this._context.slicePlaneEnabled},idHint:g,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=w.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(e.mixin(g.materialParamsMixin,this._fastUpdates.materialParameters),f.push("featureAttribute"),this._optionalFields.push("featureAttribute")):
this._hasPerInstanceColor()&&(f.push("color"),this._optionalFields.push("color"));f=this.symbolContainer;if("point-3d"===f.type&&f.verticalOffset){var f=f.verticalOffset,k=f.minWorldLength,n=f.maxWorldLength;g.materialParamsMixin.verticalOffset={screenLength:c.pt2px(f.screenLength),minWorldLength:k||0,maxWorldLength:null!=n?n:Infinity};g.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=b.safeCast(y.fetch(h,g));this._symbolLoaderPromise.then(function(a){l._symbolLoaderPromise=null;if(!l.isRejected()){var b=
r.makeLodResources(a.lods);r.fillEstimatedMinScreenSpaceRadius(b);b.levels.sort(function(a,b){return a.minScreenSpaceRadius-b.minScreenSpaceRadius});b.levels[0].minScreenSpaceRadius=Math.min(2,b.levels[0].minScreenSpaceRadius);l._lodResources=b;var c=l._context,e=l._getExternalColorParameters(l.symbol.material),h=l._getMaterialOpacity(),g=l._isPropertyDriven("opacity"),b=G.materialsFromLodResources(l._lodResources);l._originalOpacities=b.map(function(a){return a.getParameterValues().opacity||1});
b.forEach(function(a){var b=a.getParameterValues();a.setParameterValues(e);var d=b.opacity*h;a.setParameterValues({opacity:d,transparent:1>d||g||b.transparent});c.screenSizePerspectiveEnabled&&a.setParameterValues({screenSizePerspective:c.sharedResources.screenSizePerspectiveSettings})});l._resourceBoundingBox=a.referenceBoundingBox;l._resourceSize=d.vec3f64.fromArray(m.size(l._resourceBoundingBox));l._pivotOffset=d.vec3f64.fromArray(l._lodResources.levels[0].pivotOffset);l._symbolSize=d.vec3f64.fromArray(u.computeSizeWithResourceSize(l._resourceSize,
l.symbol));w.updateFastSymbolUpdatesState(l._fastUpdates,l._context.renderer,l._fastVisualVariableConvertOptions())&&b.forEach(function(a){return a.setParameterValues(l._fastUpdates.materialParameters)});l.finalizeSymbolResources();l.initializeLodRenderer();l.complexity=l.computeComplexity();l.resolve()}},function(b){l._symbolLoaderPromise=null;if(!l.isFulfilled()){if(!(b instanceof a)){var c="ObjectSymbol3DLayer failed to load";b&&b.message&&(c+=" ("+b.message+")");l._logWarning(c)}l.reject()}})};
t.prototype.finalizeSymbolResources=function(){var a=this._context.stage;this._materials=G.materialsFromLodResources(this._lodResources);this._materials.forEach(function(b){a.add(C.ModelContentType.MATERIAL,b)});this._textures=G.texturesFromLodResources(this._lodResources);this._textures.forEach(function(b){a.add(C.ModelContentType.TEXTURE,b)});this._geometries=G.geometriesFromLodResources(this._lodResources);this._geometries.forEach(function(b){a.add(C.ModelContentType.GEOMETRY,b)})};t.prototype.initializeLodRenderer=
function(){var a=this,b=this._context.stage;this._lodRenderer=new E.LodRenderer(this._lodResources,this._optionalFields,function(b){return{layerUid:a._context.layer.uid,graphicUid:a._instanceIndexToGraphicUid.get(b)}},this._fastUpdates.enabled?{applyTransform:function(b,c,e){b.getFeatureAttribute(c,W);d.mat4.copy(e,w.evaluateModelTransform(a._fastUpdates.materialParameters,W,e))},scaleFactor:function(b,c){b.getFeatureAttribute(c,W);return w.evaluateModelTransformScaleFactor(a._fastUpdates.materialParameters,
W)}}:null);this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;b.addRenderPlugin(this._lodRenderer.slots,this._lodRenderer)};t.prototype._getExternalColorParameters=function(a){var b={};this._isPropertyDriven("color")?b.externalColor=N:a&&a.color?b.externalColor=g.toUnitRGBA(a.color):(b.externalColor=N,b.colorMixMode="ignore");return b};t.prototype.destroy=function(){f.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();
var a=this._context.stage;this._lodRenderer&&(a.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy());this._materials&&this._materials.forEach(function(b){return a.remove(C.ModelContentType.MATERIAL,b.id)});this._textures&&this._textures.forEach(function(b){return a.remove(C.ModelContentType.TEXTURE,b.id)});this._geometries&&this._geometries.forEach(function(b){return a.remove(C.ModelContentType.GEOMETRY,b.id)})};t.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;
var c=q.placePointOnGeometry(b.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+b.geometry.type),null;var d="graphic"+b.uid,e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,c,a.renderingInfo,e,d,b.uid)};t.prototype.notifyDestroyGraphicLayer=function(a){this._instanceIndexToGraphicUid.delete(a.instanceIndex)};t.prototype.graphicLayerToGraphicId=function(a){return 0};t.prototype.layerOpacityChanged=function(){var a=this,b=this._isPropertyDriven("opacity");
this._materials.forEach(function(c,d){d=a._getMaterialOpacity()*a._originalOpacities[d];c.setParameterValues({opacity:d,transparent:1>d||b})});return!0};t.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,q.needsElevationUpdates3D)};t.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;this._materials.forEach(function(a){a.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});
return!0};t.prototype.applyRendererDiff=function(a,b){var c=this,d;for(d in a.diff)switch(d){case "visualVariables":if(w.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._materials.forEach(function(a){return a.setParameterValues(c._fastUpdates.materialParameters)}),this._lodRenderer.notifyShaderTransformationChanged();else return!1;break;default:return!1}return!0};t.prototype.computeComplexity=function(){if(!this._lodResources)return f.prototype.computeComplexity.call(this);
var a=G.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(a,b){return a+b.data.getIndices(D.VertexAttrConstants.POSITION).length},0)/3,b=z.defaultSymbolLayerMemoryComplexity(this.symbolContainer,this.symbol);return{primitivesPerFeature:a,primitivesPerCoordinate:0,memory:b}};t.prototype._createAs3DShape=function(a,b,c,e,g,l){a=this.getFastUpdateAttrValues(a);g=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?u.mixinColorAndOpacity(c.color,c.opacity):null;var f=this._context.clippingExtent;
B.pointToVector(b,M,this._context.elevationProvider.spatialReference);if(f&&!q.pointInBox2D(M,f))return null;B.pointToVector(b,M,this._context.renderSpatialReference);var f="absolute-height"!==e.mode,k=q.computeElevation(this._context.elevationProvider,b,e,this._context.renderCoordsHelper,f?Q:null),m=d.mat4.identity(P);this._applyObjectRotation(c,m);this._applyObjectRotation(this.symbol,m);this._applyObjectScale(c,m);this._applyAnchor(m);M[0]=b.x;M[1]=b.y;M[2]=k;c=O;B.computeLinearTransformation(b.spatialReference,
M,c,this._context.renderSpatialReference)||console.warn("Could not locate symbol object properly, it might be misplaced");var k=this._lodRenderer.instanceData,r=k.addInstance();this._instanceIndexToGraphicUid.set(r,l);k.setLocalTransform(r,m,!1);k.setGlobalTransform(r,c);a&&k.setFeatureAttribute(r,a);g&&k.setColor(r,g);l=new n(this,r,h.perLodInstanceElevationAligner,e);f&&(l.alignedTerrainElevation=Q.terrainElevation);l.needsElevationUpdates=q.needsElevationUpdates3D(e.mode);q.extendPointGraphicElevationContext(l,
b,this._context.elevationProvider);return l};t.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(a=this._isPropertyDriven("size")&&a.size?a.size:this._symbolSize,a=u.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||d.mat4.scale(b,b,a))};t.prototype._applyObjectRotation=function(a,b){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&
a instanceof l))return u.computeObjectRotation(a.heading,a.tilt,a.roll,b)};t.prototype._computeAnchor=function(){var a=d.vec3f64.create();switch(this.symbol.anchor){case "center":d.vec3.copy(a,m.center(this._resourceBoundingBox));d.vec3.negate(a,a);break;case "top":var b=m.center(this._resourceBoundingBox);d.vec3.set(a,-b[0],-b[1],-this._resourceBoundingBox[5]);break;case "bottom":b=m.center(this._resourceBoundingBox);d.vec3.set(a,-b[0],-b[1],-this._resourceBoundingBox[2]);break;case "relative":var b=
m.center(this._resourceBoundingBox),c=m.size(this._resourceBoundingBox),e=this.symbol.anchorPosition,e=e?d.vec3f64.fromValues(e.x,e.y,e.z):S;d.vec3.multiply(a,c,e);d.vec3.add(a,a,b);d.vec3.negate(a,a);break;default:this._pivotOffset?d.vec3.negate(a,this._pivotOffset):d.vec3.copy(a,S)}return a};t.prototype._applyAnchor=function(a){if(!this._fastUpdates.enabled||!this._fastUpdates.requiresShaderTransformation){var b=this._computeAnchor();b&&d.mat4.translate(a,a,b)}};t.prototype._hasPerInstanceColor=
function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};t.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?d.vec3f64.fromArray(m.size(this._resourceBoundingBox)):I,b=this._resourceBoundingBox?this._computeAnchor():S,c=this._context.renderCoordsHelper.unitInMeters,e=u.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,c),h=d.vec3f64.fromValues(this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0);return{modelSize:a,
symbolSize:this._symbolSize||I,unitInMeters:c,transformation:{anchor:b,scale:e,rotation:h}}};return t}(t);var I=d.vec3f64.fromValues(1,1,1),N=d.vec4f64.fromValues(1,1,1,1),S=d.vec3f64.fromValues(0,0,0),M=d.vec3f64.create(),P=d.mat4f64.create(),O=d.mat4f64.create(),W=d.vec4f64.create(),Q={verticalDistanceToGround:0,terrainElevation:0};return p})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../webgl-engine/lib/HighlightUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){p=function(){function f(a,b,c,e){this.type="lod-instance";this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.instanceIndex=b;this.elevationAligner=c;this.elevationContext=new d(e)}f.prototype.initialize=function(a,b){};f.prototype.setVisibility=function(a){var b=this.lodRenderer.instanceData;return a!==b.getVisible(this.instanceIndex)?(b.setVisible(this.instanceIndex,a),!0):!1};f.prototype.destroy=function(){null!=this.instanceIndex&&
(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};f.prototype.alignWithElevation=function(a,b,d){this.elevationAligner&&(c.setContextFeature(this.elevationContext.featureExpressionInfoContext,d),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a))};f.prototype.getBSRadius=function(){var a=this.lodRenderer;return a.baseBoundingSphere.radius*a.instanceData.getCombinedScaleFactor(this.instanceIndex)};
f.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=b.vec3f64.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,u);return b.vec3.transformMat4(a,this.lodRenderer.baseBoundingSphere.center,u)};f.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=e.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,u);var c=this.lodRenderer.baseBoundingBox;e.empty(a);for(var d=0;8>d;++d)b.vec3.set(n,0===(d&1)?c[0]:c[3],0===(d&2)?
c[1]:c[4],0===(d&4)?c[2]:c[5]),b.vec3.transformMat4(n,n,u),e.expandPointInPlace(a,n);return a};f.prototype.getProjectedBoundingBox=function(c,d,l,f){return g(this,void 0,void 0,function(){var g,k,r,w,z,x,y,p,S;return a(this,function(a){switch(a.label){case 0:g=this.getBoundingBoxObjectSpace(f);k=t;r=e.isPoint(g)?1:k.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,u);for(w=0;w<r;w++)z=k[w],n[0]=g[z[0]],n[1]=g[z[1]],n[2]=g[z[2]],b.vec3.transformMat4(n,n,u),h[3*w+0]=n[0],h[3*
w+1]=n[1],h[3*w+2]=n[2];if(!c(h,0,r))return[2,null];e.empty(g);x=null;this.calculateRelativeScreenBounds&&(x=this.calculateRelativeScreenBounds());for(w=0;w<3*r;w+=3){for(y=0;3>y;y++)g[y]=Math.min(g[y],h[w+y]),g[y+3]=Math.max(g[y+3],h[w+y]);x&&l.push({location:h.slice(w,w+3),screenSpaceBoundingRect:x})}if(!d)return[3,5];e.center(g,q);if("absolute-height"===this.elevationContext.mode)return[3,5];p=void 0;S=m.demResolutionForBoundingBox(g,d);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,d.service.queryElevation(q[0],
q[1],S)];case 2:return p=a.sent(),[3,4];case 3:return a.sent(),p=null,[3,4];case 4:null!=p&&e.offset(g,0,0,-this.alignedTerrainElevation+p),a.label=5;case 5:return[2,g]}})})};f.prototype.addHighlight=function(a,b){var c=this;b=l.generateHighlightId();this.addHighlightId(b);a.addExternal(function(a){c.removeHighlightId(a)},b)};f.prototype.removeHighlight=function(a){this.highlights&&this.highlights.forEach(function(b){return a.remove(b)})};f.prototype.addHighlightId=function(a){this.highlights=this.highlights||
new Set;this.highlights.add(a);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};f.prototype.removeHighlightId=function(a){this.highlights&&(this.highlights.delete(a),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this.highlights.size),0===this.highlights.size&&(this.highlights=null))};Object.defineProperty(f.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0});return f}();var h=[0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=b.vec3f64.create(),q=b.vec3f64.create(),t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],u=b.mat4f64.create();return p})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["require","exports","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../webgl-engine/lib/lodRendering/LodResources"],function(p,f,k,a,g){function b(a){var b=[];a.stageResources.geometries.forEach(function(c,d){b.push({material:a.stageResources.materials[d],
geometry:c,textures:a.stageResources.textures})});return{components:b,minScreenSpaceRadius:a.lodThreshold,pivotOffset:a.pivotOffset}}function e(a,b){void 0===b&&(b=c);a=g.computeFaceCount(a);return Math.sqrt(a/(b*Math.PI))}Object.defineProperty(f,"__esModule",{value:!0});f.makeLodLevelResources=b;f.makeLodResources=function(a){return{levels:a.map(function(a){return b(a)})}};f.estimateMinScreenSpaceRadius=e;f.fillEstimatedMinScreenSpaceRadius=function(a){a.levels.forEach(function(a){a.minScreenSpaceRadius||
(a.minScreenSpaceRadius=e(a))})};var c=.05})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/arrayUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(p,f,k,a,g,b,e,c,d,m){function l(a){var b=a.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return{fileType:b?
"gltf":"wosr",url:b?b[1]:a,specifiedLodIndex:b&&null!=b[4]?Number(b[4]):null}}function h(a,b){void 0===b&&(b=0);var c,d=a.lods[b];a={stageResources:{textures:[],materials:[],geometries:[]},pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:d.boundingBox,lodThreshold:d.lodThreshold};b=0;for(d=d.components;b<d.length;b++){var h=d[b];a.stageResources.geometries.push(h.geometry);a.stageResources.materials.push(h.material);(c=a.stageResources.textures).push.apply(c,h.textures);a.numberOfVertices+=h.geometry.vertexCount}a.stageResources.geometries=
e.unique(a.stageResources.geometries);a.stageResources.materials=e.unique(a.stageResources.materials);a.stageResources.textures=e.unique(a.stageResources.textures);return a}Object.defineProperty(f,"__esModule",{value:!0});f.fetch=function(e,f){void 0===f&&(f={});return g(this,void 0,void 0,function(){var g,k,n,q,x,z;return a(this,function(a){switch(a.label){case 0:g=l(e);if("gltf"!==g.fileType)return[3,2];f.materialParamsMixin=b({textureAlphaCutoff:.1},f.materialParamsMixin);k=new c.DefaultLoadingContext(f.streamDataSupplier);
return[4,d.load(k,g.url,f)];case 1:return n=a.sent(),q=n.lods[0].boundingBox,null!=g.specifiedLodIndex?(x=Math.min(g.specifiedLodIndex,n.lods.length-1),[2,{lods:[h(n,x)],referenceBoundingBox:q}]):[2,{lods:n.lods.map(function(a,b){return h(n,b)}),referenceBoundingBox:q}];case 2:return[4,m.load(g.url,f)];case 3:return z=a.sent(),[2,{lods:[z],referenceBoundingBox:z.boundingBox}]}})})}})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper dojo/errors/CancelError ../../../request ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function h(a){this.streamDataSupplier=a}h.prototype.loadJson=function(b){return k(this,void 0,void 0,function(){return a(this,function(a){return[2,this.load("json",b)]})})};h.prototype.loadBinary=function(b){return k(this,void 0,void 0,function(){return a(this,function(a){return m.isDataProtocol(b)?[2,m.dataToArrayBuffer(b)]:[2,this.load("binary",b)]})})};h.prototype.loadImage=function(b){return k(this,void 0,
void 0,function(){return a(this,function(a){return[2,this.load("image",b)]})})};h.prototype.load=function(h,g){return k(this,void 0,void 0,function(){var f,k,m=this;return a(this,function(a){switch(a.label){case 0:if(!this.streamDataSupplier)return[3,1];f=this.streamDataSupplier.request(g,h);return[2,d.create(function(a,d){f.then(function(b,c){a(c)},function(a){d(a instanceof b?a:new c("","Request for resource failed: "+a))})},function(){m.streamDataSupplier.cancelRequest(f)})];case 1:return[4,e(g,
l[h])];case 2:return k=a.sent(),[2,k.data]}})})};return h}();f.DefaultLoadingContext=p;var l={image:{responseType:"image"},binary:{responseType:"array-buffer"},json:void 0}})},"esri/views/3d/glTF/loader":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../core/lang ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingBox ./DefaultErrorContext ./esriProvidedModelParameters ./internal/indexUtils ./internal/Resource ../support/mathUtils ../support/buffer/BufferView ../support/buffer/math ../support/buffer/utils ../webgl-engine/lib/Geometry ../webgl-engine/lib/GeometryData ../webgl-engine/lib/Texture ../webgl-engine/materials/DefaultMaterial".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w){function B(a,b){switch(b){case 4:return h.trianglesToTriangles(a);case 5:return h.triangleStripToTriangles(a);case 6:return h.triangleFanToTriangles(a)}}function C(b,c){return k(this,void 0,void 0,function(){function d(e,g){return k(this,void 0,void 0,function(){var l,f,k,m,n,r,q,u,t;return a(this,function(a){switch(a.label){case 0:l=h.nodes[e];f=b.getNodeTransform(e);H.warnUnsupportedIf(null!=l.weights,"Morph targets are not supported.");if(null==
l.mesh)return[3,4];k=h.meshes[l.mesh];m=0;n=k.primitives;a.label=1;case 1:if(!(m<n.length))return[3,4];r=n[m];return[4,c(r,f,g,k.name)];case 2:a.sent(),a.label=3;case 3:return m++,[3,1];case 4:q=0,u=l.children||[],a.label=5;case 5:if(!(q<u.length))return[3,8];t=u[q];return[4,d(t,g)];case 6:a.sent(),a.label=7;case 7:return q++,[3,5];case 8:return[2]}})})}var h,g,l,f,m,n,r,q,u,t;return a(this,function(a){switch(a.label){case 0:h=b.json,g=h.scenes[h.scene||0],l=g.nodes,f=1<l.length,m=0,n=l,a.label=1;
case 1:if(!(m<n.length))return[3,4];r=n[m];q=h.nodes[r];u=[d(r,0)];q.extensions&&q.extensions.MSFT_lod&&Array.isArray(q.extensions.MSFT_lod.ids)&&!f&&(t=q.extensions.MSFT_lod.ids,u.push.apply(u,t.map(function(a,b){return d(a,b+1)})));return[4,e.all(u)];case 2:a.sent(),a.label=3;case 3:return m++,[3,1];case 4:return[2]}})})}function D(a,b,c,d){void 0===a&&(a="");if(1===d)return null;if(a in l.lodThresholdLUT){c=l.lodThresholdLUT[a].vertexCounts;a=l.lodThresholdLUT[a].thresholds;d=c.length;if(1>=d)return null;
if(b<=c[0]){var e=(c[1]-c[0])/(a[1]-a[0]);b-=c[0];return Math.max(0,a[0]+b*e)}if(b>=c[d-1])return e=(c[d-1]-c[d-2])/(a[d-1]-a[d-2]),b-=c[d-1],a[d-1]+b*e;for(var h=1;h<c.length;++h){var g=c[h-1],f=c[h];d=a[h-1];e=a[h];if(b<f)return b=(b-g)/(f-g),d*(1-b)+e*b}}return null}function E(a,b,c){var d=a.materials.get(b);if(!d){d=a.textures.get(b.colorTexture);if(!d&&b.colorTexture){var e=b.colorTexture,d=new z(e.data,e.name,{wrap:{s:G(e.wrapS),t:G(e.wrapT)},mipmap:I.some(function(a){return a===e.minFilter}),
noUnpackFlip:!0});a.textures.set(b.colorTexture,d)}c=g({transparent:"BLEND"===b.alphaMode,textureAlphaTest:"MASK"===b.alphaMode,textureAlphaCutoff:b.alphaCutoff,diffuse:[b.color[0],b.color[1],b.color[2]],ambient:[b.color[0],b.color[1],b.color[2]],opacity:b.color[3],doubleSided:b.doubleSided,doubleSidedType:"winding-order",vertexColors:b.vertexColors,castShadows:!0,receiveSSAO:!0,textureId:d?d.id:void 0,colorMixMode:b.ESRI_externalColorMixMode},c);d=new w(c,b.name||"");a.materials.set(b,d)}c=[];b.colorTexture&&
c.push(a.textures.get(b.colorTexture));return{engineMaterial:d,engineTextures:c}}function G(a){if(33071===a||33648===a||10497===a)return a;H.error("Unexpected TextureSampler WrapMode: "+a)}Object.defineProperty(f,"__esModule",{value:!0});f.load=function(e,h,f){void 0===f&&(f={});return k(this,void 0,void 0,function(){var m,z,p,F,K,L,G,R,I=this;return a(this,function(J){switch(J.label){case 0:return[4,n.Resource.load(e,H,h)];case 1:return m=J.sent(),z={textures:new Map,materials:new Map},p=[],F=0,
K=m.json.asset.extras&&"symbolResource"===m.json.asset.extras.ESRI_type,L=null,[4,C(m,function(e,h,n,C){return k(I,void 0,void 0,function(){var k,D,J,R,G,T,I,X,O,Q,v,M,P,W,ca,da,ba,Z,U,va,wa,Aa,Ca;return a(this,function(a){switch(a.label){case 0:!L&&C&&(L=C.split("__")[0]);k="gltf_"+F++;D=e.mode||4;a:{switch(D){case 4:case 5:case 6:a=!0;break a}a=!1}if(!a)return H.warnUnsupported("Unsupported primitive mode ("+N[D]+"). Skipping primitive."),[2];if(!e.attributes.NORMAL)return H.warnUnsupported("Vertex normals are required. Skipping primitive."),
[2];if(K)a:{var V=C,ja=m.uri;void 0===V&&(V="");void 0===ja&&(ja="");a=b.endsWith(V,"Imposter");V=V.split("__")[0];if(-1!==ja.indexOf("/RealisticTrees/")&&(ja=l.treeParamsTable[V])){a={crownCenter:ja.center,crownDimensions:ja.radius,imposter:a};break a}a=void 0}else a=void 0;R=(J=a)?{treeRendering:!0,vertexColors:!0}:{};return[4,m.getMaterial(e)];case 1:return G=a.sent(),T=E(z,G,g({},R,f.materialParamsMixin)),I=T.engineMaterial,X=T.engineTextures,O=w.getVertexBufferLayout(I.getParams()),Q={},[4,m.getPositionData(e)];
case 2:return v=a.sent(),M=new Float32Array(3*v.count),Q.position={data:M,size:3},u.vec3.transformMat4(new t.BufferViewVec3f(M.buffer),v,h),W=B,[4,m.getIndexData(e)];case 3:return P=W.apply(void 0,[a.sent()||v.count,D]),O.hasField("normal")?[4,m.getNormalData(e)]:[3,5];case 4:ca=a.sent(),da=new Float32Array(3*ca.count),Q.normal={data:da,size:3},c.mat4.invert(S,h),c.mat4.transpose(S,S),u.vec3.transformMat4(new t.BufferViewVec3f(da.buffer),ca,S),a.label=5;case 5:return O.hasField("uv0")?[4,m.getTextureCoordinates(e)]:
[3,7];case 6:ba=a.sent(),da=new Float32Array(2*ba.count),Q.uv0={data:da,size:2},r.vec2.copy(new t.BufferViewVec2f(da.buffer),ba),a.label=7;case 7:return m.hasVertexColors(e)?[4,m.getVertexColors(e)]:[3,9];case 8:Z=a.sent(),da=new Uint8Array(4*Z.count),Q.color={data:da,size:4},Z instanceof t.BufferViewVec4f?u.vec4.scale(new t.BufferViewVec4u8(da.buffer),Z,255):r.vec4.copy(new t.BufferViewVec4u8(da.buffer),Z),a.label=9;case 9:if(J){var ma=Q;a=J;var ja=new t.BufferViewVec3f(ma.normal.data.buffer),V=
new t.BufferViewVec3f(ma.position.data.buffer),ea=ja.count,Na=r.createBuffer(t.BufferViewVec4u8,ea);ma.color={data:Na.typedBuffer,size:4};for(var ma=c.vec3f64.create(),aa=c.vec3f64.create(),ka=c.vec3f64.create(),fa=0;fa<ea;fa++){V.getVec(fa,aa);ja.getVec(fa,ma);c.vec3.subtract(ka,aa,a.crownCenter);c.vec3.divide(ka,ka,a.crownDimensions);var ga=q.clamp(c.vec3.length(ka),0,1),ga=.6+.4*ga*ga;c.vec3.lerp(ka,ka,ma,.2);ja.setVec(fa,ka);Na.set(fa,0,255*ga);Na.set(fa,1,255*ga);Na.set(fa,2,255*ga);Na.set(fa,
3,255)}}U={};for(va in Q)U[va]=P;wa=new x(Q,U);Aa=new y(wa,k);p[n]=p[n]||{components:[],boundingBox:d.empty(),meshName:C,lodThreshold:null,numVertices:0};p[n].components.push({geometry:Aa,material:I,textures:X});p[n].numVertices+=v.count;Ca=Aa.boundingInfo;d.expand(p[n].boundingBox,Ca.getBBMin());d.expand(p[n].boundingBox,Ca.getBBMax());return[2]}})})})];case 2:J.sent();if(K&&L)for(G=0;G<p.length;++G)R=p[G],R.lodThreshold=D(L,R.numVertices,G,p.length);return[2,{lods:p}]}})})};var H=new m.DefaultErrorContext,
I=[9987,9985],N="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" "),S=c.mat4f64.create()})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["require","exports","../../../core/Logger"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});var a=k.getLogger("esri.views.3d.glTF");p=function(){function g(){}g.prototype.error=function(a){throw Error("[glTF loader]"+a);};g.prototype.errorUnsupported=function(a){this.error("[Unsupported Feature] "+
a)};g.prototype.errorUnsupportedIf=function(a,e){a&&this.error("[Unsupported Feature] "+e)};g.prototype.assert=function(a,e){a||this.error(e)};g.prototype.warn=function(b){a.warn(b)};g.prototype.warnUnsupported=function(a){this.warn("[Unsupported Feature] "+a)};g.prototype.warnUnsupportedIf=function(a,e){a&&this.warnUnsupported(e)};return g}();f.DefaultErrorContext=p})},"esri/views/3d/glTF/esriProvidedModelParameters":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",
{value:!0});f.treeParamsTable={Alder_Buckthorn:{center:[0,0,2.5],radius:[2,2,3.5]},American_Chestnut:{center:[0,0,12],radius:[10,10,10]},American_Sycamore:{center:[0,0,16],radius:[6.3,6.3,11.5]},Apricot:{center:[0,0,5],radius:[4.5,4.5,4]},Australian_Pine:{center:[0,0,8],radius:[3,3,11.5]},Baldcypress:{center:[0,0,11.5],radius:[4.2,4.2,16.5]},Balsam_Fir:{center:[0,0,2.9],radius:[3,3,9.7]},Basswood:{center:[0,0,19],radius:[9,9,11]},Bay_Laurel:{center:[0,0,1.4],radius:[.6,.6,2.7]},Black_Locust:{center:[0,
0,15],radius:[9.5,9.5,9.5]},Blue_Gum_Eucalyptus:{center:[0,0,12],radius:[5,5,10]},Boxwood:{center:[0,0,.5],radius:[.3,.3,.5]},California_Bay:{center:[0,0,16],radius:[9,9,9.6]},California_Incense_Cedar:{center:[0,0,6.6],radius:[3.8,3.8,14]},California_Redwood:{center:[0,0,55],radius:[6.5,6.5,19]},California_Walnut:{center:[0,0,5.3],radius:[5,5,4.5]},Common_Hawthorn:{center:[0,0,2.8],radius:[1.9,1.9,2.8]},Common_Whitebeam:{center:[0,0,4.5],radius:[2.5,2.5,3.5]},Conker_Tree:{center:[0,0,10],radius:[6,
6,10]},Desert_Willow:{center:[0,0,3],radius:[2.4,2.4,2.8]},Douglas_Fir:{center:[0,0,40],radius:[4.5,4.5,22]},European_Beech:{center:[0,0,12],radius:[7.5,7.5,11.5]},European_Larch:{center:[0,0,9],radius:[3,3,9]},Ficus:{center:[0,0,10],radius:[12,12,18.5]},Field_Elm:{center:[0,0,12.5],radius:[10,10,9.5]},Flannelbush:{center:[0,0,0],radius:[1.3,1.3,1.7]},Flowering_Dogwood:{center:[0,0,2.5],radius:[2.4,2.4,3]},Generic_Unknown:{center:[0,0,11.5],radius:[5,5,6.5]},Giant_Sequoia:{center:[0,0,35.5],radius:[11,
11,26]},Japanese_Angelica_Tree:{center:[0,0,3.8],radius:[2.8,2.8,2]},Leyland_Cypress:{center:[0,0,2.8],radius:[1,1,4]},Lodgepole_Pine:{center:[0,0,23.25],radius:[4.7,4.7,19]},Mediterranean_Buckthorn:{center:[0,0,1.5],radius:[1.2,1.2,2.5]},Mountain_Mahogany:{center:[0,0,2],radius:[1.3,1.3,1.5]},Northern_Red_Oak:{center:[0,0,11.5],radius:[7.2,7.2,9]},Norway_Maple:{center:[0,0,12.2],radius:[6,6,8.2]},Norway_Spruce:{center:[0,0,5],radius:[6.5,6.5,20]},Oval_Leaved_Privet:{center:[0,0,0],radius:[.45,.45,
2.95]},Palo_Verde:{center:[0,0,4.25],radius:[4,4,2.75]},Paper_Birch:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Alder:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Hickory:{center:[0,0,9],radius:[4.5,4.5,7.5]},Rhododendron_Azaleas:{center:[0,0,.55],radius:[.4,.4,.35]},Rose:{center:[0,0,.55],radius:[.45,.45,.55]},Ruffle_Palm:{center:[0,0,6.4],radius:[3,3,3]},Sassafras:{center:[0,0,8],radius:[3,3,7]},Scots_Pine:{center:[0,0,18],radius:[3,3,9]},Shadbush:{center:[0,0,1.5],radius:[1.5,1.5,1.5]},Southern_Magnolia:{center:[0,
0,10.5],radius:[5.5,5.5,8]},Spanish_Broom:{center:[0,0,1.5],radius:[2.5,2.5,1.5]},Strawberry_Tree:{center:[0,0,4],radius:[2.8,2.8,3.3]},Sugar_Maple:{center:[0,0,8],radius:[4.5,4.5,7]},Sweetgum:{center:[0,0,8],radius:[4,4,6.5]},Umbrella_Acacia:{center:[0,0,10.8],radius:[15,15,6.8]},Western_Juniper:{center:[0,0,3.2],radius:[2.5,2.5,7]},White_Ash:{center:[0,0,14.5],radius:[9.5,9.5,11]},White_Oak:{center:[0,0,15],radius:[14,14,14]},White_Poplar:{center:[0,0,10],radius:[4.3,4.3,8.2]},White_Willow:{center:[0,
0,12],radius:[8.9,8.9,9]},Witch_Hazel:{center:[0,0,1.5],radius:[1.5,1.5,2]}};f.lodThresholdLUT={Alder_Buckthorn:{thresholds:[2,65.698,384.294],vertexCounts:[18,2034,8220]},Amazon_Sword_Plant:{thresholds:[2,22.848,88.819,200.491],vertexCounts:[18,246,888,3246]},American_Chestnut:{thresholds:[2,27.57,59.244,360.286],vertexCounts:[18,444,1782,10332]},American_Sycamore:{thresholds:[2,60.765,228.586],vertexCounts:[18,1740,8562]},Apricot:{thresholds:[2,33.695,132.332],vertexCounts:[18,1776,10626]},Australian_Pine:{thresholds:[2,
131.057],vertexCounts:[18,8094]},Baldcypress:{thresholds:[2,31.791,212.226],vertexCounts:[18,1638,10164]},Balsam_Fir:{thresholds:[2,64.674],vertexCounts:[18,10266]},Bamboo:{thresholds:[2,22.347,90.113,213.818],vertexCounts:[18,216,978,7740]},Banana_Tree:{thresholds:[2,28.096,88.837,345.976],vertexCounts:[18,372,1986,10743]},Basswood:{thresholds:[2,59.387,199.555],vertexCounts:[18,1662,7998]},Bay_Laurel:{thresholds:[2,28.653,204.352],vertexCounts:[18,1728,10938]},Black_Locust:{thresholds:[2,28.546,
88.164,229.447],vertexCounts:[18,384,1638,9768]},Blue_Gum_Eucalyptus:{thresholds:[2,56.98,201.358],vertexCounts:[18,1530,9762]},Boxwood:{thresholds:[2,28.768,62.215,191.034],vertexCounts:[18,390,1824,9876]},Cabbage_Palm_Fern:{thresholds:[2,26.932,215.221],vertexCounts:[18,150,1314]},California_Bay:{thresholds:[2,30.627,204.223],vertexCounts:[18,1878,9054]},California_Incense_Cedar:{thresholds:[2,30.533,197.262],vertexCounts:[18,1644,11214]},California_Palm:{thresholds:[2,30.538,210.616],vertexCounts:[18,
612,5760]},California_Redwood:{thresholds:[2,110.805],vertexCounts:[18,10260]},California_Walnut:{thresholds:[2,26.702,64.525,199.228],vertexCounts:[18,336,1962,10992]},Coconut_Palm:{thresholds:[2,21.77,63.23,199.556],vertexCounts:[18,402,1884,9240]},Common_Hawthorn:{thresholds:[2,45.588,205.35],vertexCounts:[18,300,9492]},Common_Whitebeam:{thresholds:[2,56.42,186.382],vertexCounts:[18,2142,10524]},Conker_Tree:{thresholds:[2,25.977,58.524,195.139],vertexCounts:[18,318,1614,8886]},Date_Palm:{thresholds:[2,
31.107,67.609,186.723],vertexCounts:[18,456,2154,9054]},Desert_Willow:{thresholds:[2,29.425,59.815,203.238],vertexCounts:[18,408,1686,9720]},Douglas_Fir:{thresholds:[2,69.576],vertexCounts:[18,8544]},European_Beech:{thresholds:[2,29.854,201.521],vertexCounts:[18,420,7572]},European_Larch:{thresholds:[2,65.346],vertexCounts:[18,10314]},Ficus:{thresholds:[2,28.768,58.849,210.62],vertexCounts:[18,390,1632,7728]},Field_Elm:{thresholds:[2,34.435,192.436],vertexCounts:[18,1746,10950]},Flannelbush:{thresholds:[2,
27.408,55.566,196.843],vertexCounts:[18,354,1455,8706]},Flowering_Dogwood:{thresholds:[2,28.768,194.687],vertexCounts:[18,390,8664]},Generic_Dead_Tree:{thresholds:[2,67.891],vertexCounts:[18,2172]},Generic_Stump:{thresholds:[2,19.544,57.757,171.552],vertexCounts:[18,180,1572,2634]},Generic_Unknown:{thresholds:[2,32.379,221.987],vertexCounts:[18,1572,9006]},Giant_Sequoia:{thresholds:[2,30.664,204.84],vertexCounts:[18,2160,8232]},Hedgehog_Agave:{thresholds:[2,28.546,96.141,228.435],vertexCounts:[18,
384,1980,11094]},Japanese_Angelica_Tree:{thresholds:[2,25.482,61.287,202.909],vertexCounts:[18,306,1770,7806]},Lacy_Tree_Philodendron:{thresholds:[2,28.768,62.974,231.634],vertexCounts:[18,390,1752,10227]},Leyland_Cypress:{thresholds:[2,66.246],vertexCounts:[18,10182]},Lily_Of_The_Valley:{thresholds:[2,28.322,55.738,198.232],vertexCounts:[18,378,1464,4152]},Scots_Pine:{thresholds:[2,60.554],vertexCounts:[18,7524]},Mediterranean_Buckthorn:{thresholds:[2,31.82,211.856],vertexCounts:[18,2196,9030]},
Mexican_Palmetto:{thresholds:[2,29.425,68.358,212.659],vertexCounts:[18,408,2202,10194]},Mountain_Mahogany:{thresholds:[2,31.199,198.614],vertexCounts:[18,1614,8094]},White_Oak:{thresholds:[2,15.204,33.801,129.392],vertexCounts:[18,372,1674,9222]},Sugar_Maple:{thresholds:[2,28.322,59.495,216.901],vertexCounts:[18,378,1668,9462]},Norway_Spruce:{thresholds:[2,63.101],vertexCounts:[18,9630]},Orchid:{thresholds:[2,30.383,63.93,198.664],vertexCounts:[18,435,1926,8346]},Other:{thresholds:[2,30.504,194.487],
vertexCounts:[18,1572,9006]},Oval_Leaved_Privet:{thresholds:[2,59.468],vertexCounts:[18,9162]},Palm_Lily:{thresholds:[2,57.977,200.406],vertexCounts:[18,1584,8112]},Palo_Verde:{thresholds:[2,65.31,198.124],vertexCounts:[18,2010,7668]},Paper_Birch:{thresholds:[2,117.074],vertexCounts:[18,10578]},Parlour_Palm:{thresholds:[2,30.695,60.974,194.832],vertexCounts:[18,444,1752,8388]},Prickly_Pear_Cactus:{thresholds:[2,28.657,66.946,214.478],vertexCounts:[18,387,2112,11028]},Red_Alder:{thresholds:[2,30.518,
192.513],vertexCounts:[18,1770,8274]},Red_Hickory:{thresholds:[2,31.604,192.085],vertexCounts:[18,1680,7908]},Rhododendron_Azaleas:{thresholds:[2,47.068,192.681],vertexCounts:[18,1044,8160]},Rose:{thresholds:[2,66.085,212.061],vertexCounts:[18,2058,10968]},Ruffle_Palm:{thresholds:[2,64.994],vertexCounts:[18,9534]},Saguaro_Cactus:{thresholds:[2,34.779,56.703,197.566],vertexCounts:[18,570,1050,1992]},Sassafras:{thresholds:[2,110.697],vertexCounts:[18,10944]},Sea_Islands_Yucca:{thresholds:[2,61.287,
219.899],vertexCounts:[18,1770,10176]},Shadbush:{thresholds:[2,26.702,64.03,201.856],vertexCounts:[18,336,1932,9030]},Snake_Plant:{thresholds:[2,23.803,68.265,193.203],vertexCounts:[18,267,2196,5280]},Southern_Magnolia:{thresholds:[2,63.431,212.165],vertexCounts:[18,1896,8472]},Spanish_Broom:{thresholds:[2,29.854,192.889],vertexCounts:[18,420,7896]},Strawberry_Tree:{thresholds:[2,16.772,32.081,186.987],vertexCounts:[18,300,1560,8148]},Sunflower:{thresholds:[2,28.768,66.373,194.987],vertexCounts:[18,
390,2076,7902]},Sweetgum:{thresholds:[2,31.436,201.223],vertexCounts:[18,1848,7674]},Umbrella_Acacia:{thresholds:[2,62.137],vertexCounts:[18,8880]},Western_Juniper:{thresholds:[2,62.683],vertexCounts:[18,9120]},White_Ash:{thresholds:[2,33.326,192.138],vertexCounts:[18,2070,10542]},White_Poplar:{thresholds:[2,30.615,196.71],vertexCounts:[18,1530,9888]},White_Willow:{thresholds:[2,62.983],vertexCounts:[18,10422]},Witch_Hazel:{thresholds:[2,26.463,66.277,200.916],vertexCounts:[18,330,2070,10386]},ATM:{thresholds:[2,
46.933],vertexCounts:[150,1038]},Bus_Stop_1:{thresholds:[2,42.67],vertexCounts:[150,858]},Bus_Stop_2:{thresholds:[2,46.112],vertexCounts:[138,1002]},Dumpster:{thresholds:[2,48.006],vertexCounts:[138,1086]},Newspaper_Vending_Machine:{thresholds:[2,57.203],vertexCounts:[144,1542]},Overhanging_Sidewalk_Light_Off:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Sidewalk_Light_On:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Street_And_Sidewalk_Light_Off:{thresholds:[2,46.524],vertexCounts:[147,
1020]},Overhanging_Street_And_Sidewalk_Light_On:{thresholds:[2,46.524],vertexCounts:[147,1020]},Overhanging_Street_Light_Off:{thresholds:[2,34.225],vertexCounts:[144,552]},Overhanging_Street_Light_On:{thresholds:[2,34.225],vertexCounts:[144,552]},Park_Bench_1:{thresholds:[2,23.669],vertexCounts:[96,264]},Park_Bench_2:{thresholds:[2,44.71],vertexCounts:[144,942]},Park_Bench_3:{thresholds:[2,41.917],vertexCounts:[120,828]},Park_Bench_4:{thresholds:[2,69.923],vertexCounts:[144,2304]},Payphone:{thresholds:[2,
58.524],vertexCounts:[156,1614]},Picnic_Table:{thresholds:[2,35.504],vertexCounts:[90,594]},Planter_Circular:{thresholds:[2,99.368],vertexCounts:[153,4653]},Planter_Square:{thresholds:[2,65.212],vertexCounts:[150,2004]},Planter_Tapered:{thresholds:[2,89.669],vertexCounts:[141,3789]},Rock_1:{thresholds:[2,28.768,50.463],vertexCounts:[132,390,1200]},Rock_2:{thresholds:[2,43.556,73.127],vertexCounts:[150,894,2520]},Rock_3:{thresholds:[2,37.931,70.286],vertexCounts:[144,678,2328]},Rock_4:{thresholds:[2,
41.613,70.738],vertexCounts:[150,816,2358]},Street_Light_Off:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Street_Light_On:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Traffic_Barrier_2:{thresholds:[2,42.819],vertexCounts:[132,864]},Trash_Bin_1:{thresholds:[2,50.019],vertexCounts:[132,1179]},Trash_Bin_2:{thresholds:[2,36.038,63.028],vertexCounts:[108,612,1872]},Trash_Bin_3:{thresholds:[2,42.371,64.03],vertexCounts:[102,846,1932]},Trash_Can_1:{thresholds:[2,58.524,98.628],
vertexCounts:[150,1614,4584]},Trash_Can_2:{thresholds:[2,53.166],vertexCounts:[84,1332]},US_Mailbox:{thresholds:[2,48.402],vertexCounts:[156,1104]},Ambulance:{thresholds:[2,67.121,343.733],vertexCounts:[294,3285,13758]},Audi_A6:{thresholds:[2,63.823,484.156],vertexCounts:[300,4311,14280]},Backhoe:{thresholds:[2,60.173,391.986],vertexCounts:[453,5895,14679]},BMW_3Series:{thresholds:[2,68.886,417.563],vertexCounts:[294,4188,14727]},Bobcat:{thresholds:[2,61.105,269.127],vertexCounts:[438,4476,14952]},
Bus:{thresholds:[2,63.803,402.682],vertexCounts:[300,4398,14988]},Crane:{thresholds:[2,65.969,386.67],vertexCounts:[438,4497,14487]},Dumptruck:{thresholds:[2,66.91,354.365],vertexCounts:[456,6294,14052]},Eurocopter_AS365:{thresholds:[2,227.817],vertexCounts:[432,14733]},Eurocopter_AS365_Flying:{thresholds:[2,96.244,380.211],vertexCounts:[306,4365,10575]},Eurocopter_H125:{thresholds:[2,96.567,378.995],vertexCounts:[438,4440,14763]},Eurocopter_H125_Flying:{thresholds:[2,94.002,366.378],vertexCounts:[294,
4164,13569]},Firetruck:{thresholds:[2,65.762,383.645],vertexCounts:[276,4482,14901]},Ford_Edge:{thresholds:[2,68.763,419.635],vertexCounts:[294,4368,14733]},Ford_Expedition:{thresholds:[2,62.994,388.251],vertexCounts:[276,4410,14868]},Ford_F150:{thresholds:[2,60.495,394.682],vertexCounts:[300,4950,14988]},Ford_Fiesta:{thresholds:[2,64.994,355.46],vertexCounts:[282,4185,14223]},Ford_Focus_Hatchback:{thresholds:[2,62.072,387.932],vertexCounts:[300,4470,14925]},Ford_Fusion:{thresholds:[2,64.485,370.289],
vertexCounts:[294,4500,14955]},Ford_Mustang:{thresholds:[2,64.812,351.721],vertexCounts:[288,4197,14574]},Ford_Taurus:{thresholds:[2,67.461,379.324],vertexCounts:[282,4404,15042]},Ford_Transit_Commercial_Van:{thresholds:[2,88.6,384.491],vertexCounts:[276,4443,14721]},Ford_Transit_Connect:{thresholds:[2,67.006,336.74],vertexCounts:[258,4344,14328]},Mercedes_SClass:{thresholds:[2,66.188,349.491],vertexCounts:[300,4377,14721]},Motorboat:{thresholds:[2,67.436,364.325],vertexCounts:[315,4491,14958]},Motorcycle:{thresholds:[2,
35.435,357.215],vertexCounts:[294,4806,14865]},Police_Car:{thresholds:[2,68.116,350.794],vertexCounts:[294,3987,14580]},Porsche_Boxter:{thresholds:[2,67.717,361.95],vertexCounts:[312,6225,14676]},Porsche_Carrera:{thresholds:[2,66.588,392.685],vertexCounts:[306,4473,14571]},Sailboat:{thresholds:[2,97.329,383.075],vertexCounts:[294,4464,14937]},Sailboat_Sails_Up:{thresholds:[2,97.46,360.432],vertexCounts:[300,4476,14967]},Taxi:{thresholds:[2,64.415,381.491],vertexCounts:[300,4305,14721]},Taxi_Van:{thresholds:[2,
64.614,364.475],vertexCounts:[288,4341,11949]},Tesla_P7:{thresholds:[2,58.155],vertexCounts:[300,16062]},Tower_Crane:{thresholds:[2,106.34,419.821],vertexCounts:[432,4488,14832]},Toyota_Prius:{thresholds:[2,66.448,357.251],vertexCounts:[288,4266,14370]},Tram:{thresholds:[2,65.43,369.937],vertexCounts:[420,5610,19605]},Volkswagen_Jetta_Wagon:{thresholds:[2,65.925,354.416],vertexCounts:[294,4443,14466]},Traffic_Light_1:{thresholds:[2,75.315],vertexCounts:[135,2673]},Traffic_Light_3:{thresholds:[2,49.12],
vertexCounts:[132,1137]},Traffic_Light_4:{thresholds:[2,70.962,115.735],vertexCounts:[96,2373,6312]}}})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["require","exports","../../support/buffer/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(p,f,k,a){function g(b){return a.generateDefaultIndexArray(b)}Object.defineProperty(f,"__esModule",{value:!0});f.linearIndexArray=g;f.trianglesToTriangles=function(a){return"number"===typeof a?g(a):k.isUint16Array(a)||k.isUint8Array(a)?
new Uint32Array(a):a};f.triangleStripToTriangles=function(a){var b="number"===typeof a?a:a.length;if(3>b)return new Uint32Array(0);var b=b-2,c=new Uint32Array(3*b);if("number"===typeof a)for(var d=0,g=0;g<b;++g)c[d++]=g,c[d++]=g+1,c[d++]=g+2;else for(var l=a[0],h=a[1],g=d=0;g<b;++g){var f=a[g+2];c[d++]=l;c[d++]=h;c[d++]=f;l=h;h=f}return c};f.triangleFanToTriangles=function(a){var b="number"===typeof a?a:a.length;if(3>b)return new Uint32Array(0);var b=b-2,c=new Uint32Array(3*b);if("number"===typeof a)for(var d=
0,g=0;g<b;++g)c[d++]=0,c[d++]=g+1,c[d++]=g+2;else for(var l=a[0],h=a[1],g=d=0;g<b;++g){var f=a[g+2];c[d++]=l;c[d++]=h;h=c[d++]=f}return c}})},"esri/views/3d/glTF/internal/Resource":function(){define("require exports ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/gl-matrix ./BinaryStreamReader ./fillDefaults ./pathUtils ../../support/buffer/BufferView ../../support/buffer/utils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u){function r(a){switch(a.componentType){case 5120:return new t.BufferViewVec2i8(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5121:return new t.BufferViewVec2u8(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5122:return new t.BufferViewVec2i16(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5123:return new t.BufferViewVec2u16(a.raw,a.byteOffset,a.byteStride,a.byteOffset+
a.byteStride*a.entryCount);case 5125:return new t.BufferViewVec2u32(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5126:return new t.BufferViewVec2f(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);default:b.neverReached(a.componentType)}}function y(b){return k(this,void 0,void 0,function(){return a(this,function(a){return[2,c.create(function(a,c){var d=new Blob([b]),e=new FileReader;e.onload=function(){a(JSON.parse(e.result))};e.onerror=function(a){c(a)};
e.readAsText(d)})]})})}function x(b,d){return k(this,void 0,void 0,function(){return a(this,function(a){return[2,c.create(function(a,c){var e=new Blob([b],{type:d}),h=URL.createObjectURL(e),g=new Image;g.addEventListener("load",function(){URL.revokeObjectURL(h);a(g)});g.addEventListener("error",function(a){URL.revokeObjectURL(h);c(a)});g.src=h})]})})}Object.defineProperty(f,"__esModule",{value:!0});var z;p=function(){function b(a,b,c,d,e){this.context=a;this.errorContext=b;this.uri=c;this.json=d;
this.glbBuffer=e;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=q.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();b.errorUnsupportedIf(null==d.scene,"A scene must be defined.");b.errorUnsupportedIf(null==d.scenes,"Scenes must be defined.");b.errorUnsupportedIf(null==d.meshes,"Meshes must be defined");b.errorUnsupportedIf(null==d.nodes,"Nodes must be defined.");
this.computeNodeParents()}b.load=function(c,d,h){return k(this,void 0,void 0,function(){var g,l,f;return a(this,function(a){switch(a.label){case 0:return e.endsWith(h,".gltf")?[4,c.loadJson(h)]:[3,2];case 1:return g=a.sent(),[2,new b(c,d,h,g)];case 2:return e.endsWith(h,".glb")?[4,c.loadBinary(h)]:[3,5];case 3:return l=a.sent(),[4,b.parseGLB(d,l)];case 4:return f=a.sent(),[2,new b(c,d,h,f.json,f.binaryData)];case 5:d.error('URI needs to end in ".gltf" or ".glb"'),a.label=6;case 6:return[2]}})})};
b.parseGLB=function(b,c){return k(this,void 0,void 0,function(){var d,e,g,l,f,k,m,n,r;return a(this,function(a){switch(a.label){case 0:d=new h.BinaryStreamReader(c),b.assert(12<=d.remainingBytes(),"GLB binary data is insufficiently large."),e=d.readUint32(),g=d.readUint32(),l=d.readUint32(),b.assert(1179937895===e,"Magic first 4 bytes do not fit to expected GLB value."),b.assert(c.byteLength>=l,"GLB binary data is smalller than header specifies."),b.errorUnsupportedIf(2!==g,"Only GLB container version 2 is supported."),
f=0,a.label=1;case 1:if(!(8<=d.remainingBytes()))return[3,5];n=d.readUint32();r=d.readUint32();if(0!==f)return[3,3];b.assert(1313821514===r,"First GLB chunck must be JSON.");b.assert(0<=n,"No JSON data found.");return[4,y(d.readUint8Array(n))];case 2:return k=a.sent(),[3,4];case 3:1===f?(b.errorUnsupportedIf(5130562!==r,"Second GLB chunck expected to be BIN."),m=d.readUint8Array(n)):b.warnUnsupported("More than 2 GLB chunks detected. Skipping."),a.label=4;case 4:return f+=1,[3,1];case 5:return k||
b.error("No GLB JSON chunk detected."),[2,{json:k,binaryData:m}]}})})};b.prototype.getBuffer=function(b){return k(this,void 0,void 0,function(){var c,d,e,h;return a(this,function(a){switch(a.label){case 0:return c=this.json.buffers[b],d=this.errorContext,null==c.uri?(d.assert(null!=this.glbBuffer,"GLB buffer not present"),[2,this.glbBuffer]):(e=this.bufferCache.get(b))?[3,2]:[4,this.context.loadBinary(this.resolveUri(c.uri))];case 1:h=a.sent(),e=new Uint8Array(h),this.bufferCache.set(b,e),d.assert(e.byteLength===
c.byteLength,"Buffer byte lengths should match."),a.label=2;case 2:return[2,e]}})})};b.prototype.getAccessor=function(b){return k(this,void 0,void 0,function(){var c,d,e,h,g,l,f,k;return a(this,function(a){switch(a.label){case 0:return c=this.json.accessors[b],d=this.errorContext,d.errorUnsupportedIf(null==c.bufferView,"An accessor bufferView is required."),d.errorUnsupportedIf(c.type in["MAT2","MAT3","MAT4"],"AttributeType "+c.type+" is not supported"),e=this.json.bufferViews[c.bufferView],[4,this.getBuffer(e.buffer)];
case 1:return h=a.sent(),g=D[c.type],l=E[c.componentType],f=g*l,k=e.byteStride||f,[2,{raw:h.buffer,byteStride:k,byteOffset:h.byteOffset+(e.byteOffset||0)+(c.byteOffset||0),entryCount:c.count,isDenselyPacked:k===f,componentCount:g,componentByteSize:l,componentType:c.componentType,min:c.min,max:c.max,normalized:!!c.normalized}]}})})};b.prototype.getIndexData=function(b){return k(this,void 0,void 0,function(){var c;return a(this,function(a){switch(a.label){case 0:return null==b.indices?[2,null]:[4,this.getAccessor(b.indices)];
case 1:c=a.sent();if(c.isDenselyPacked)switch(c.componentType){case 5121:return[2,new Uint8Array(c.raw,c.byteOffset,c.entryCount)];case 5123:return[2,new Uint16Array(c.raw,c.byteOffset,c.entryCount)];case 5125:return[2,new Uint32Array(c.raw,c.byteOffset,c.entryCount)]}else switch(c.componentType){case 5121:return[2,u.scalar.makeDense(this.wrapAccessor(t.BufferViewUint8,c))];case 5123:return[2,u.scalar.makeDense(this.wrapAccessor(t.BufferViewUint16,c))];case 5125:return[2,u.scalar.makeDense(this.wrapAccessor(t.BufferViewUint32,
c))]}return[2]}})})};b.prototype.getPositionData=function(b){return k(this,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==b.attributes.POSITION,"POSITION vertex data is required."),[4,this.getAccessor(b.attributes.POSITION)];case 1:return d=a.sent(),c.errorUnsupportedIf(5126!==d.componentType,"[POSITION attribute] Expected type FLOAT, found "+G[d.componentType]),c.errorUnsupportedIf(3!==d.componentCount,"POSITION attribute must have 3 components."),
[2,this.wrapAccessor(t.BufferViewVec3f,d)]}})})};b.prototype.getNormalData=function(b){return k(this,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==b.attributes.NORMAL,"NORMAL vertex data is required."),[4,this.getAccessor(b.attributes.NORMAL)];case 1:return d=a.sent(),c.errorUnsupportedIf(5126!==d.componentType,"[NORMAL attribute] Expected type FLOAT, found "+G[d.componentType]),c.errorUnsupportedIf(3!==d.componentCount,
"NORMAL attribute must have 3 components."),[2,this.wrapAccessor(t.BufferViewVec3f,d)]}})})};b.prototype.getTextureCoordinates=function(b){return k(this,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==b.attributes.TEXCOORD_0,"TEXCOORD_0 vertex data is required."),[4,this.getAccessor(b.attributes.TEXCOORD_0)];case 1:d=a.sent();c.errorUnsupportedIf(2!==d.componentCount,"TEXCOORD_0 attribute must have 2 components.");
if(5126===d.componentType)return[2,this.wrapAccessor(t.BufferViewVec2f,d)];c.errorUnsupportedIf(!d.normalized,"[TEXCOORD_0 attribute] Integer ComponentTypes are only supported for a normalized accessor.");return[2,u.vec2.normalizeIntegerBuffer(new t.BufferViewVec2f(new ArrayBuffer(8*d.entryCount)),r(d))]}})})};b.prototype.hasVertexColors=function(a){return!!a.attributes.COLOR_0};b.prototype.getVertexColors=function(b){return k(this,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:return c=
this.errorContext,c.errorUnsupportedIf(null==b.attributes.COLOR_0,"COLOR_0 vertex data is required."),[4,this.getAccessor(b.attributes.COLOR_0)];case 1:d=a.sent();c.errorUnsupportedIf(4!==d.componentCount,"COLOR_0 attribute must have 4 components.");if(5126===d.componentType)return[2,this.wrapAccessor(t.BufferViewVec4f,d)];if(5121===d.componentType)return[2,this.wrapAccessor(t.BufferViewVec4u8,d)];c.errorUnsupported("[COLOR_0 attribute] Unsupported component type: "+G[d.componentType]);return[2]}})})};
b.prototype.getMaterial=function(b){return k(this,void 0,void 0,function(){var c,d,e,h,g,l;return a(this,function(a){switch(a.label){case 0:c=this.errorContext;if(d=this.materialCache.get(b.material))return[3,3];e=n.material(this.json.materials[b.material]);h=e.pbrMetallicRoughness;g=this.hasVertexColors(b);l=void 0;if(!h.baseColorTexture)return[3,2];c.errorUnsupportedIf(0!==(h.baseColorTexture.texCoord||0),"Only TEXCOORD_0 is supported");return[4,this.getTexture(h.baseColorTexture.index)];case 1:l=
a.sent(),a.label=2;case 2:d={alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,color:h.baseColorFactor,doubleSided:!!e.doubleSided,colorTexture:l,name:e.name,vertexColors:g,ESRI_externalColorMixMode:e.extras.ESRI_externalColorMixMode},a.label=3;case 3:return[2,d]}})})};b.prototype.getTexture=function(b){return k(this,void 0,void 0,function(){var c,d,e,h,g,l,f,k;return a(this,function(a){switch(a.label){case 0:c=this.errorContext;d=this.json.textures[b];e=n.textureSampler(null!=d.sampler?this.json.samplers[d.sampler]:
{});c.errorUnsupportedIf(null==d.source,"source must be defined for a texture");h=this.json.images[d.source];if(g=this.textureCache.get(b))return[3,6];l=void 0;return h.uri?[4,this.context.loadImage(this.resolveUri(h.uri))]:[3,2];case 1:return l=a.sent(),[3,5];case 2:return c.errorUnsupportedIf(null==h.bufferView,"Image bufferView must be defined."),c.errorUnsupportedIf(null==h.mimeType,"Image mimeType must be defined."),f=this.json.bufferViews[h.bufferView],[4,this.getBuffer(f.buffer)];case 3:return k=
a.sent(),c.errorUnsupportedIf(null!=f.byteStride,"byteStride not supported for image buffer"),[4,x(new Uint8Array(k.buffer,k.byteOffset+(f.byteOffset||0),f.byteLength),h.mimeType)];case 4:l=a.sent(),a.label=5;case 5:g={data:l,wrapS:e.wrapS,wrapT:e.wrapT,minFilter:e.minFilter,name:h.name},this.textureCache.set(b,g),a.label=6;case 6:return[2,g]}})})};b.prototype.getNodeTransform=function(a){if(void 0===a)return B;var b=this.nodeTransformCache.get(a);if(!b){var b=this.getNodeTransform(this.getNodeParent(a)),
c=this.json.nodes[a];if(c.matrix)b=l.mat4.multiply(l.mat4f64.create(),b,c.matrix);else if(c.translation||c.rotation||c.scale)b=l.mat4f64.clone(b),c.translation&&l.mat4.translate(b,b,c.translation),c.rotation&&(C[3]=l.quat.getAxisAngle(C,c.rotation),l.mat4.rotate(b,b,C[3],C)),c.scale&&l.mat4.scale(b,b,c.scale);this.nodeTransformCache.set(a,b)}return b};b.prototype.wrapAccessor=function(a,b){return new a(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*(b.entryCount-1)+b.componentByteSize*
b.componentCount)};b.prototype.resolveUri=function(a){return d.isDataProtocol(a)?a:this.baseUri+a};b.prototype.getNodeParent=function(a){return this.nodeParentMap.get(a)};b.prototype.checkVersionSupported=function(){m.Version.parse(this.json.asset.version,"glTF").validate(w)};b.prototype.checkRequiredExtensionsSupported=function(){var a=this.json,b=this.errorContext;a.extensionsRequired&&0!==a.extensionsRequired.length&&b.errorUnsupportedIf(!0,"Extensions: "+a.extensionsRequired.join(", "))};b.prototype.computeNodeParents=
function(){var a=this;this.json.nodes.forEach(function(b,c){b.children&&b.children.forEach(function(b){a.nodeParentMap.set(b,c)})})};return b}();f.Resource=p;var w=new m.Version(2,0,"glTF"),B=l.mat4.fromXRotation(l.mat4f64.create(),Math.PI/2),C=l.quatf64.create(),D={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},E=(z={},z[5120]=1,z[5121]=1,z[5122]=2,z[5123]=2,z[5126]=4,z[5125]=4,z),G={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"}})},"esri/core/Version":function(){define(["require",
"exports","./Error"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function a(a,b,e){void 0===e&&(e="");this.major=a;this.minor=b;this._context=e}a.prototype.lessThan=function(a,b){return this.major<a||a===this.major&&this.minor<b};a.prototype.since=function(a,b){return!this.lessThan(a,b)};a.prototype.validate=function(a){if(this.major!==a.major)throw new k((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+
"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:a});};a.prototype.clone=function(){return new a(this.major,this.minor,this._context)};a.parse=function(g,b){void 0===b&&(b="");var e=g.split("."),c=e[0],e=e[1],d=/^\s*\d+\s*$/;if(!c||!c.match||!c.match(d))throw new k((b&&b+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:g});if(!e||!e.match||!e.match(d))throw new k((b&&b+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:g});g=parseInt(c,10);c=parseInt(e,10);return new a(g,c,b)};return a}();f.Version=p})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function f(a){this.data=a;this.offset4=0;this.dataUint32=new Uint32Array(this.data)}f.prototype.readUint32=function(){var a=this.offset4;this.offset4+=1;return this.dataUint32[a]};f.prototype.readUint8Array=function(a){var g=4*this.offset4;this.offset4+=
a/4;return new Uint8Array(this.data,g,a)};f.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4};return f}();f.BinaryStreamReader=p})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});var a={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},g={pbrMetallicRoughness:a,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,
doubleSided:!1},b={ESRI_externalColorMixMode:"tint"};f.material=function(c){void 0===c&&(c={});var d=k({},a,c.pbrMetallicRoughness),e=k({},b,c.extras);switch(e.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":break;default:e.ESRI_externalColorMixMode="tint"}return k({},g,c,{pbrMetallicRoughness:d,extras:e})};var e={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};f.textureSampler=function(a){return k({},e,a)}})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["require",
"exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.splitURI=function(f){var a,g;f.replace(/^(.*\/)?([^/]*)$/,function(b,e,c){a=e;g=c;return""});return{dirPart:a,filePart:g}}})},"esri/views/3d/support/buffer/math":function(){define(["require","exports","./math/vec3","./math/vec4"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.vec3=k;f.vec4=a})},"esri/views/3d/support/buffer/math/vec3":function(){define(["require","exports","./common"],function(p,f,k){Object.defineProperty(f,
"__esModule",{value:!0});f.transformMat4=function(a,g,b){if(a.count!==g.count)k.logger.error("source and destination buffers need to have the same number of elements");else{var e=a.count,c=b[0],d=b[1],f=b[2],l=b[4],h=b[5],n=b[6],q=b[8],t=b[9],u=b[10],r=b[12],y=b[13];b=b[14];var x=a.typedBuffer;a=a.typedBufferStride;var z=g.typedBuffer;g=g.typedBufferStride;for(var w=0;w<e;w++){var B=w*a,p=w*g,D=z[p],E=z[p+1],p=z[p+2];x[B]=c*D+l*E+q*p+r;x[B+1]=d*D+h*E+t*p+y;x[B+2]=f*D+n*E+u*p+b}}};f.transformMat3=
function(a,g,b){if(a.count!==g.count)k.logger.error("source and destination buffers need to have the same number of elements");else{var e=a.count,c=b[0],d=b[1],f=b[2],l=b[3],h=b[4],n=b[5],q=b[6],t=b[7];b=b[8];var u=a.typedBuffer;a=a.typedBufferStride;var r=g.typedBuffer;g=g.typedBufferStride;for(var y=0;y<e;y++){var x=y*a,z=y*g,w=r[z],B=r[z+1],z=r[z+2];u[x]=c*w+l*B+q*z;u[x+1]=d*w+h*B+t*z;u[x+2]=f*w+n*B+b*z}}}})},"esri/views/3d/support/buffer/math/common":function(){define(["require","exports","../../../../../core/Logger"],
function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.logger=k.getLogger("esri.views.3d.support.buffer.math")})},"esri/views/3d/support/buffer/math/vec4":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.scale=function(f,a,g){var b=Math.min(f.count,a.count),e=f.typedBuffer;f=f.typedBufferStride;var c=a.typedBuffer;a=a.typedBufferStride;for(var d=0;d<b;d++){var k=d*f,l=d*a;e[k]=g*c[l];e[k+1]=g*c[l+1];e[k+2]=g*c[l+2];e[k+3]=g*c[l+3]}}})},
"esri/views/3d/layers/graphics/wosrLoader":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/sniff dojo/errors/CancelError ../../../../request ../../../../core/Error ../../../../core/lang ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/Version ../../../../geometry/support/aaBoundingBox ../../support/imageUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x){function z(a,b){if(b){var d=b.request(a,"json");return h.create(function(a,b){d.then(function(b,c){a(c)},function(a){b(a instanceof e?a:w(a))})},function(){b.cancelRequest(d)})}var g=c(a);return h.create(function(a,b){g.then(function(b){a(b.data)},function(a){b(a instanceof e?a:w(a))})},function(){g.cancel()})}function w(a){return new d("","Request for object resource failed: "+a)}function B(c,d){return g(this,void 0,void 0,function(){var e,h,g,l,f,
k,q,t,w,z,y,B,p,I,H,ca,Z,da,U,ia,ea,aa,ga,fa,ja,V,ha,ma,ka,v,ta,za,Da;return a(this,function(a){switch(a.label){case 0:return g=[],l=[],f=[],k=[],q=n.Version.parse(c.version||"1.0","wosr"),G.validate(q),t="meshsymbol_"+c.model.name,w=c.textureDefinitions,[4,D(t,w,d)];case 1:z=a.sent();for(y in z)k.push(z[y].engineTexObj);B=c.model.geometries;p=c.materialDefinitions;for(H=I=0;H<B.length;H++){var F=ca=B[H],L=F.params,K=L.topology;a=!0;L.vertexAttributes||(E.warn("Geometry must specify vertex attributes"),
a=!1);switch(L.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:K=L.faces;if(!K)E.warn("Indexed geometries must specify faces"),a=!1;else if(L.vertexAttributes){var J=void 0;for(J in L.vertexAttributes)(L=K[J])&&L.values?(null!=L.valueType&&"UInt32"!==L.valueType&&(E.warn("Unsupported indexed geometry indices type '"+L.valueType+"', only UInt32 is currently supported"),a=!1),null!=L.valuesPerElement&&1!==L.valuesPerElement&&(E.warn("Unsupported indexed geometry values per element '"+
L.valuesPerElement+"', only 1 is currently supported"),a=!1)):(E.warn("Indexed geometry does not specify face indices for '"+J+"' attribute"),a=!1)}break;default:E.warn("Unsupported topology '"+K+"'"),a=!1}F.params.material||(E.warn("Geometry requires material"),a=!1);F=F.params.vertexAttributes;L=void 0;for(L in F)F[L].values||(E.warn("Geometries with externally defined attributes are not yet supported"),a=!1);if(a){a=ca.params;e=a.material;h=a.texture;Z=ca.params.vertexAttributes;da={};for(U in Z)ia=
Z[U],ea=ia.values,da[U]={data:ea,size:ia.valuesPerElement};aa={};if("PerAttributeArray"===ca.params.topology){a=ga=da.position.data.length/da.position.size;F=new Uint32Array(a);for(L=0;L<a;L++)F[L]=L;fa=F;for(ja in da)aa[ja]=fa}else for(ha in V=ca.params.faces,V)aa[ha]=new Uint32Array(V[ha].values);ma=h?z[h]:null;ka=f[e]?f[e][h]:null;ka||(v=e.substring(e.lastIndexOf("/")+1),ta=p[v].params,1===ta.transparency&&(ta.transparency=0),za={ambient:ta.diffuse,diffuse:ta.diffuse,specular:[0,0,0],opacity:1-
(ta.transparency||0),transparent:0<ta.transparency,textureAlphaCutoff:.33,textureId:ma?ma.engineTexObj.id:void 0,textureInitTransparent:!0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:ta.externalColorMixMode||"tint"},b("enable-feature:jkieboom/alpha-channel-usage")&&ma&&("transparency"===ma.alphaChannelUsage||"maskAndTransparency"===ma.alphaChannelUsage)&&(za.transparent=!0),d&&d.materialParamsMixin&&m.mixin(za,d.materialParamsMixin),ka=new x(za,t),f[e]||(f[e]={}),f[e][h]=ka);l.push(ka);Da=
new u(new r(da,aa),t);I+=aa.position?aa.position.length:0;g.push(Da)}}return[2,{stageResources:{textures:k,materials:l,geometries:g},pivotOffset:c.model.pivotOffset,boundingBox:C(g),numberOfVertices:I,lodThreshold:null}]}})})}function C(a){var b=q.empty();a.forEach(function(a){a=a.boundingInfo;q.expand(b,a.getBBMin());q.expand(b,a.getBBMax())});return b}function D(c,d,e){return g(this,void 0,void 0,function(){var g,l,f,k,m,n,r,q;return a(this,function(a){switch(a.label){case 0:g=[];l=function(a){var l=
d[a],f=l.images[0].data;if(!f)return E.warn("Externally referenced texture data is not yet supported"),"continue";var f=l.encoding+";base64,"+f,k="/textureDefinitions/"+a,m={noUnpackFlip:!0,wrap:{s:10497,t:10497}};b("enable-feature:jkieboom/alpha-channel-usage")&&(m.wrap={s:33071,t:33071});a=e&&e.disableTextures?h.resolve(null):t.requestImage(f);g.push(a.then(function(a){return{refId:k,engineTexObj:new y(a,c,m),alphaChannelUsage:"rgba"===l.channels?l.alphaChannelUsage||"transparency":"none"}}))};
for(f in d)l(f);return[4,h.all(g)];case 1:k=a.sent();m={};n=0;for(r=k;n<r.length;n++)q=r[n],m[q.refId]=q;return[2,m]}})})}Object.defineProperty(f,"__esModule",{value:!0});var E=l.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");f.load=function(b,c){return g(this,void 0,void 0,function(){var d;return a(this,function(a){switch(a.label){case 0:return[4,z(b,c.streamDataSupplier)];case 1:return d=a.sent(),[4,B(d,c)];case 2:return[2,a.sent()]}})})};f.createStageResources=B;var G=new n.Version(1,
2,"wosr")})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../../../geometry/support/aaBoundingBox ../../../support/debugFlags ../../../support/buffer/glUtil ../Camera ../DefaultVertexAttributeLocations ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData ./utils ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x){function z(a,b,c,d){q.encodeDoubleVec3(a.modelOrigin,b,c.modelOriginHi,c.modelOriginLo,d);c.model.copyFrom(d,a.model,b);c.modelNormal.copyFrom(d,a.modelNormal,b);a.color&&c.color&&c.color.copyFrom(d,a.color,b);a.featureAttribute&&c.featureAttribute&&c.featureAttribute.copyFrom(d,a.featureAttribute,b)}Object.defineProperty(f,"__esModule",{value:!0});var w=y.assert,B=function(a){var b=a.baseBoundingSphere.radius;a=a.levels.map(function(a){return a.minScreenSpaceRadius});
return new h.LevelSelector(b,a)};f.setLevelSelectorFactory=function(a){B=a};var C=function(){function a(a,b){this.glMaterials={};var c=a.rctx,h=b.geometry;b=b.material;var g=h.data.toRenderData();this.materialRep=a.materialRep;b.setParameterValues({instancedDoublePrecision:!0});a=b.bufferWriter;var l=a.vertexBufferLayout,f=a.elementCount(g),k=a.allocate(f);a.write({},g,void 0,k,0);this.geometry=h;this.material=b;this.glMaterials=q.acquireGLMaterials(b,this.materialRep);this.vertexBufferLayout=l;this.vbo=
r.createVertex(c,35044,k.buffer);this.vao=new x(c,d.Default3D,{geometry:e.glLayout(l)},{geometry:this.vbo});this.vertexCount=f}a.prototype.destroy=function(){q.releaseGLMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};Object.defineProperty(a.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0});
a.prototype.intersect=function(a,b,c,d,e,h){var g=this.geometry.id,l=e.toString();this.material.intersect(this.geometry,null,a.transform,a,c,d,function(c,d,f,k,m,n){if(0<=c&&(null==b||b(a.p0,a.p1,c))){m={type:"external",metadata:h(e)};if(null==a.minResult.priority||k>=a.minResult.priority)if(null==a.minResult.dist||c<a.minResult.dist)a.minResult.set(m,l,c,d,a.transform,k,null,g,f),a.minResult.setIntersector("LodRenderer");if(null==a.maxResult.priority||k>=a.maxResult.priority)if(null==a.maxResult.dist||
c>a.maxResult.dist)a.maxResult.set(m,l,c,d,a.transform,k,null,g,f),a.minResult.setIntersector("LodRenderer")}},null)};return a}();f.LodComponentData=C;var D=function(){function b(a,b){var c=this;this.components=[];this.minScreenSpaceRadius=b.minScreenSpaceRadius;b.components.forEach(function(b){c.components.push(new C(a,b))})}b.prototype.destroy=function(){this.components.forEach(function(a){a.destroy()})};b.prototype.intersect=function(a,b,c,d,e,h){this.components.forEach(function(g){g.intersect(a,
b,c,d,e,h)})};Object.defineProperty(b.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var a=g.empty();this.components.forEach(function(b){g.expand(a,b.boundingInfo.bbMin);g.expand(a,b.boundingInfo.bbMax)});this._boundingBox=a}return this._boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var b=this.boundingBox,c=a.vec3f64.create();g.center(b,c);this._boundingSphere={center:c,radius:.5*g.diameter(b)}}return this._boundingSphere},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"triangleCount",{get:function(){return this.components.reduce(function(a,b){return a+b.triangleCount},0)},enumerable:!0,configurable:!0});return b}();f.LodLevelData=D;p=function(){function h(a,b,d,h){var g=this;this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlaneEnabled=!1;this._enableLevelSelection=!0;this._lastCamera=new c;this._updateCyclesWithStaticCamera=-1;this.didRender=
this._needFullCycle=!1;this._symbol=a;this._optionalFields=b;this._instanceToMetadata=d;this._instanceBufferLayout=t.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:b});this._glInstanceBufferLayout=e.glLayout(this._instanceBufferLayout,{divisor:1});this._instanceData=new m.InstanceData(this._optionalFields,h);this._instanceData.on("instance-added",function(a){g.requestUpdateCycle()});this._instanceData.on("instance-removed",function(a){g.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",
function(a){g.requestUpdateCycle()});this._instanceData.on("instance-visibility-changed",function(a){g.requestUpdateCycle(!0)});this._instanceData.on("instance-highlight-changed",function(a){g.requestUpdateCycle(!0)});this._enableLevelSelection=1<this._symbol.levels.length;f.lodRenderers.push(this)}h.prototype.destroy=function(){f.lodRenderers.splice(f.lodRenderers.indexOf(this),1)};Object.defineProperty(h.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"baseBoundingBox",{get:function(){return this._levels[this._levels.length-1].boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"baseBoundingSphere",{get:function(){return this._levels[this._levels.length-1].boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"baseMaterial",{get:function(){return this._levels[this._levels.length-1].components[0].material},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"slicePlaneEnabled",
{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled=a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"memoryUsage",{get:function(){var a={cpu:0,gpu:0};this._renderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});this._highlightRenderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;
a.gpu+=b.gpu});return a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"renderStats",{get:function(){var a=this,b=this._instanceData.size,c=[];this._levels.forEach(function(b,d){d=a._renderInstanceData[d].size+a._highlightRenderInstanceData[d].size;b=b.triangleCount;c.push({renderedInstances:d,renderedTriangles:d*b,trianglesPerInstance:b})});return{totalInstances:b,renderedInstances:c.reduce(function(a,b){return a+b.renderedInstances},0),renderedTriangles:c.reduce(function(a,b){return a+
b.renderedTriangles},0),levels:c}},enumerable:!0,configurable:!0});h.prototype.initializeRenderContext=function(a){var b=this,c=a.rctx;this._symbol.levels.forEach(function(d){b._levels.push(new D(a,d));b._renderInstanceData.push(new n.RenderInstanceData(c,b._instanceBufferLayout));b._highlightRenderInstanceData.push(new n.RenderInstanceData(c,b._instanceBufferLayout))});this._levelSelector=B(this)};h.prototype.uninitializeRenderContext=function(a){this._levels.forEach(function(a){a.destroy()});this._renderInstanceData.forEach(function(a){a.destroy()});
this._highlightRenderInstanceData.forEach(function(a){a.destroy()})};Object.defineProperty(h.prototype,"slots",{get:function(){return[5,7]},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"needsHighlight",{get:function(){return 0<this._highlightRenderInstanceData.reduce(function(a,b){return a+b.size},0)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"needsRender",{get:function(){return this.needsUpdates()},enumerable:!0,configurable:!0});h.prototype.resetNeedsRender=
function(){this.didRender&&(this.didRender=!1)};h.prototype.prepareRender=function(a){this.runUpdates(a)};h.prototype.render=function(a){var b=a.rctx,c=5===a.slot?4:7===a.slot?6:null;if(c){if(!this.baseMaterial.isVisible())return!1;var d={view:a.camera.viewMatrix,proj:a.camera.projectionMatrix,origin:[0,0,0],viewInvTransp:a.camera.viewInverseTransposeMatrix,lightingData:a.lightingData,viewport:a.camera.viewport,fovY:a.camera.fovY,nearFar:[a.camera.near,a.camera.far],framebufferTex:a.offscreenRenderingHelper?
a.offscreenRenderingHelper.colorTexture:null,shadowMap:a.shadowMap,shadowMappingEnabled:!!a.shadowMap&&a.shadowMap.enabled,ssaoEnabled:!!a.ssaoHelper&&a.ssaoHelper.enabled,pixelRatio:a.pixelRatio,slicePlane:a.sliceHelper&&a.sliceHelper.plane,cameraAboveGround:a.camera.aboveGround,hudVisibilityTexture:a.offscreenRenderingHelper?a.offscreenRenderingHelper.hudVisibilityTexture:null};b.bindVAO();for(b=0;b<this._levels.length;++b)this.renderLevel(a,c,d,a.isHighlightPass?this._highlightRenderInstanceData[b]:
this._renderInstanceData[b],b);return!0}};h.prototype.intersect=function(b,c,d,e,h){var g=this;if(this.baseMaterial.isVisible()){h=a.vec3f64.create();a.vec3.subtract(h,e,d);var l=function(h){g._instanceData.getCombinedModelTransform(h,H);b.setTransform(H);a.vec3.transformMat4(I,d,b.transformInverse);a.vec3.transformMat4(N,e,b.transformInverse);var l=g._instanceData.getState(h),f=g._instanceData.getLodLevel(h);w(l&m.StateFlags.ACTIVE,"invalid instance state");w(0<=f&&f<g._levels.length,"invaid lod level");
g._levels[f].intersect(b,c,I,N,h,g._instanceToMetadata)};this.baseMaterial.getParameterValues().verticalOffset?this.octree.forEach(l):this.octree.forEachAlongRay(d,h,l)}};h.prototype.queryDepthRange=function(a){return this.queryDepthRangeOctree(a)};h.prototype.notifyShaderTransformationChanged=function(){this.invalidateOctree()};h.prototype.requestUpdateCycle=function(a){void 0===a&&(a=!1);this._updateCyclesWithStaticCamera=-1;a&&(this._needFullCycle=!0)};h.prototype.needsUpdates=function(){return 0<
this._instanceData.size&&1>this._updateCyclesWithStaticCamera};h.prototype.runUpdates=function(a){if(!b.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var c=a.equivalent(this._lastCamera);this._lastCamera.copyFrom(a);c||this.requestUpdateCycle()}c=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(a,c)}};Object.defineProperty(h.prototype,"octree",{get:function(){this._octree||(this._octree=this.buildOctree());return this._octree},enumerable:!0,
configurable:!0});h.prototype.invalidateOctree=function(){this._octree=null};h.prototype.buildOctree=function(){for(var a=new l.InstanceOctree(this._instanceData,this.baseBoundingSphere),b=this._instanceData,b=b.view?b.view.state:null,c=0;c<this._instanceData.capacity;++c)b.get(c)&m.StateFlags.ACTIVE&&a.addInstance(c);return a};h.prototype.queryDepthRangeOctree=function(b){var c=b.eye,d=b.viewForward,e=this.octree.findClosest(d,"front-to-back",b.frustum),h=this.octree.findClosest(d,"back-to-front",
b.frustum);return null!=e&&null!=h?(this._instanceData.view.boundingSphere.getVec(e,G),a.vec3.subtract(G,G,c),e=a.vec3.dot(G,d)-G[3],this._instanceData.view.boundingSphere.getVec(h,G),a.vec3.subtract(G,G,c),c=a.vec3.dot(G,d)+G[3],{near:Math.max(b.near,e),far:Math.min(b.far,c)}):{near:Infinity,far:-Infinity}};h.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._renderInstanceData.forEach(function(a){a.startUpdateCylce()});this._highlightRenderInstanceData.forEach(function(a){a.startUpdateCylce()})};
h.prototype.updateInstances=function(a,b){var c=this._enableLevelSelection,d=this._levelSelector;d.updateCamera(a);this._renderInstanceData.forEach(function(a){a.beginUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.beginUpdate()});a=this._instanceData;var e=this._instanceData.view,h=a.capacity,g=this._instanceIndex;b=Math.min(a.size,b);for(var l=0;l<b;++l){0===g&&this.startUpdateCycle();var f=e.state.get(g),k=0;if(f&m.StateFlags.ALLOCATED){var n=e.lodLevel.get(g);f&m.StateFlags.ACTIVE&&
this._renderInstanceData[n].freeTail();f&m.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[n].freeTail();if(f&m.StateFlags.REMOVE)a.freeInstance(g);else if(f&m.StateFlags.VISIBLE){n=0;c&&(e.modelOrigin.getVec(g,E),n=d.selectLevel(E,a.getCombinedScaleFactor(g)));k=f&~(m.StateFlags.ACTIVE|m.StateFlags.HIGHLIGHT_ACTIVE|m.StateFlags.TRANSFORM_CHANGED);if(0<=n){var r=this._renderInstanceData[n],q=r.allocateHead();z(e,g,r.view,q);k|=m.StateFlags.ACTIVE;f&m.StateFlags.HIGHLIGHT&&(r=this._highlightRenderInstanceData[n],
q=r.allocateHead(),z(e,g,r.view,q),k|=m.StateFlags.HIGHLIGHT_ACTIVE)}e.state.set(g,k);e.lodLevel.set(g,n)}else k=f&~(m.StateFlags.ACTIVE|m.StateFlags.HIGHLIGHT_ACTIVE|m.StateFlags.TRANSFORM_CHANGED),e.state.set(g,k);this._octree&&(n=!!(f&m.StateFlags.ACTIVE),k=!!(k&m.StateFlags.ACTIVE),!n&&k?this._octree.addInstance(g):n&&!k?this._octree.removeInstance(g):n&&k&&f&m.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(g),this._octree.addInstance(g)));g=(g+1)%h}else g=(g+1)%h,b++}this._instanceIndex=
g;this._renderInstanceData.forEach(function(a){a.endUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.endUpdate()})};h.prototype.renderLevel=function(a,b,c,d,e){var h=this;this._levels[e].components.forEach(function(g){h.renderComponent(a,b,c,d,g,e)})};h.prototype.renderComponent=function(a,c,e,h,g,l){var f=g.glMaterials[a.pass];if(f&&f.beginSlot(c)&&f.isVisible&&0!==h.size){var k=a.rctx,m=k.capabilities.instancing,n=f.getDrawMode();e.origin=[0,0,0];2===c&&(a.stencilRenderingHelper.enabled=
!0,a.stencilRenderingHelper.prepareStencilWritePass());f.bind(k,e);k.bindVAO(g.vao);c=f.getProgram();y.assertCompatibleVertexAttributeLocations(g.vao,c);a.isHighlightPass&&(k.bindTexture(a.offscreenRenderingHelper?a.offscreenRenderingHelper.depthTexture:null,5),c.setUniform1i("depthTex",5),c.setUniform4f("highlightViewportPixelSz",0,0,1/e.viewport[2],1/e.viewport[3]));f.bindView(k,e);b.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===a.pass&&(c.setUniform4fv("externalColor",S[Math.min(l,S.length-1)]),
c.setUniform1i("colorMixMode",u.colorMixModes.replace));a=h.capacity;l=h.headIndex;c=h.tailIndex;var r=h.firstIndex,q=this._glInstanceBufferLayout,t=function(a,b){y.bindVertexBufferLayout(k,d.Default3D,h.buffer,q,a);m.drawArraysInstanced(n,0,g.vertexCount,b-a);y.unbindVertexBufferLayout(k,d.Default3D,h.buffer,q)};g.material.getParams().transparent&&null!=r?l>c?(w(r>=c&&r<=l,"invalid firstIndex"),t(r,l),t(c,r)):l<c&&(r<=l?(w(0<=r&&r<=l,"invalid firstIndex"),t(r,l),t(c,a),t(0,r)):(w(r>=c&&r<=a,"invalid firstIndex"),
t(r,a),t(0,l),t(c,r))):l>c?t(c,l):l<c&&(t(0,l),t(c,a));k.bindVAO(null);f.release(k,e)}};return h}();f.LodRenderer=p;f.lodRenderers=[];var E=a.vec3f64.create(),G=a.vec4f64.create(),H=a.mat4f64.create(),I=a.vec3f64.create(),N=a.vec3f64.create(),S=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]]})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../support/Evented ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/InterleavedLayout ../../../../webgl/Util".split(" "),
function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,"__esModule",{value:!0});var m=d.assert,l;(function(a){a[a.ALLOCATED=1]="ALLOCATED";a[a.ACTIVE=2]="ACTIVE";a[a.VISIBLE=4]="VISIBLE";a[a.HIGHLIGHT=8]="HIGHLIGHT";a[a.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";a[a.REMOVE=32]="REMOVE";a[a.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(l=f.StateFlags||(f.StateFlags={}));var h=function(){return function(a){this.localTransform=a.getField("localTransform",e.BufferViewMat4f64);this.globalTransform=a.getField("globalTransform",
e.BufferViewMat4f64);this.modelOrigin=a.getField("modelOrigin",e.BufferViewVec3f64);this.model=a.getField("model",e.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",e.BufferViewMat3f);this.modelScaleFactor=a.getField("modelScaleFactor",e.BufferViewFloat);this.boundingSphere=a.getField("boundingSphere",e.BufferViewVec4f64);this.color=a.getField("color",e.BufferViewVec4f);this.featureAttribute=a.getField("featureAttribute",e.BufferViewVec4f);this.state=a.getField("state",e.BufferViewUint8);
this.lodLevel=a.getField("lodLevel",e.BufferViewUint8)}}();f.View=h;p=function(d){function e(a,b){var e=d.call(this)||this;e._capacity=0;e._size=0;e._next=0;var h=c.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").f32("modelScaleFactor");0<=a.indexOf("color")&&(h=h.vec4f("color"));0<=a.indexOf("featureAttribute")&&(h=h.vec4f("featureAttribute"));h=h.u8("state").u8("lodLevel").alignTo(4);e._layout=
h;e._shaderTransformation=b;return e}k(e,d);Object.defineProperty(e.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});e.prototype.addInstance=
function(){this._size+1>this._capacity&&this.grow();var a=this.findSlot();this._view.state.set(a,l.ALLOCATED);this._size++;this.emit("instance-added",{index:a});return a};e.prototype.removeInstance=function(a){var b=this._view.state;m(0<=a&&a<this._capacity&&b.get(a)&l.ALLOCATED,"invalid instance handle");this.getStateFlag(a,l.ACTIVE)?this.setStateFlags(a,l.REMOVE):this.freeInstance(a);this.emit("instance-removed",{index:a})};e.prototype.freeInstance=function(a){var b=this._view.state;m(0<=a&&a<this._capacity&&
b.get(a)&l.ALLOCATED,"invalid instance handle");b.set(a,0);this._size--};e.prototype.setLocalTransform=function(a,b,c){void 0===c&&(c=!0);this._view.localTransform.setMat(a,b);c&&this.updateModelTransform(a)};e.prototype.getLocalTransform=function(a,b){this._view.localTransform.getMat(a,b)};e.prototype.setGlobalTransform=function(a,b,c){void 0===c&&(c=!0);this._view.globalTransform.setMat(a,b);c&&this.updateModelTransform(a)};e.prototype.getGlobalTransform=function(a,b){this._view.globalTransform.getMat(a,
b)};e.prototype.updateModelTransform=function(c){var d=this._view,e=t,h=u;d.localTransform.getMat(c,r);d.globalTransform.getMat(c,y);var g=a.mat4.multiply(y,y,r);a.vec3.set(e,g[12],g[13],g[14]);d.modelOrigin.setVec(c,e);a.mat3.fromMat4(h,g);d.model.setMat(c,h);d.modelScaleFactor.set(c,b.maxScale(g));a.mat3.invert(h,h);a.mat3.transpose(h,h);d.modelNormal.setMat(c,h);this.setStateFlags(c,l.TRANSFORM_CHANGED);this.emit("instance-transform-changed",{index:c})};e.prototype.getModelTransform=function(a,
b){var c=this._view;c.model.getMat(a,u);c.modelOrigin.getVec(a,t);b[0]=u[0];b[1]=u[1];b[2]=u[2];b[3]=0;b[4]=u[3];b[5]=u[4];b[6]=u[5];b[7]=0;b[8]=u[6];b[9]=u[7];b[10]=u[8];b[11]=0;b[12]=t[0];b[13]=t[1];b[14]=t[2];b[15]=1};e.prototype.applyShaderTransformation=function(a,b){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b)};e.prototype.getCombinedModelTransform=function(a,b){this.getModelTransform(a,b);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,
a,b);return b};e.prototype.getCombinedLocalTransform=function(a,b){this._view.localTransform.getMat(a,b);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,b);return b};e.prototype.getCombinedScaleFactor=function(a){var b=this._view.modelScaleFactor.get(a);this._shaderTransformation&&(b*=this._shaderTransformation.scaleFactor(this,a));return b};e.prototype.getModel=function(a,b){this._view.model.getMat(a,b)};e.prototype.getScaleFactor=function(a){return this._view.modelScaleFactor.get(a)};
e.prototype.setFeatureAttribute=function(a,b){this._view.featureAttribute.setVec(a,b)};e.prototype.getFeatureAttribute=function(a,b){this._view.featureAttribute.getVec(a,b)};e.prototype.setColor=function(a,b){this._view.color.setVec(a,b)};e.prototype.getColor=function(a,b){this._view.color.getVec(a,b)};e.prototype.setVisible=function(a,b){b!==this.getVisible(a)&&(this.setStateFlag(a,l.VISIBLE,b),this.emit("instance-visibility-changed",{index:a}))};e.prototype.getVisible=function(a){return this.getStateFlag(a,
l.VISIBLE)};e.prototype.setHighlight=function(a,b){b!==this.getHighlight(a)&&(this.setStateFlag(a,l.HIGHLIGHT,b),this.emit("instance-highlight-changed",{index:a}))};e.prototype.getHighlight=function(a){return this.getStateFlag(a,l.HIGHLIGHT)};e.prototype.getState=function(a){return this._view.state.get(a)};e.prototype.getLodLevel=function(a){return this._view.lodLevel.get(a)};e.prototype.countFlags=function(a){for(var b=0,c=0;c<this._capacity;++c)this.getState(c)&a&&++b;return b};e.prototype.setStateFlags=
function(a,b){var c=this._view.state;b|=c.get(a);c.set(a,b)};e.prototype.clearStateFlags=function(a,b){var c=this._view.state;b=c.get(a)&~b;c.set(a,b)};e.prototype.setStateFlag=function(a,b,c){c?this.setStateFlags(a,b):this.clearStateFlags(a,b)};e.prototype.getStateFlag=function(a,b){return!!(this._view.state.get(a)&b)};e.prototype.grow=function(){var a=Math.max(n,Math.floor(this._capacity*q)),b=this._layout.createBuffer(a);if(this._buffer){var c=new Uint8Array(this._buffer.buffer);(new Uint8Array(b.buffer)).set(c)}this._capacity=
a;this._buffer=b;this._view=new h(this._buffer)};e.prototype.findSlot=function(){for(var a=this._view.state,b=this._next;a.get(b)&l.ALLOCATED;)b=(b+1)%this._capacity;this._next=(b+1)%this._capacity;return b};return e}(g.Evented);f.InstanceData=p;var n=1024,q=2,t=a.vec3f64.create(),u=a.mat3f64.create(),r=a.mat4f64.create(),y=a.mat4f64.create()})},"esri/views/3d/support/Evented":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function f(){this._listeners=
{}}f.prototype.hasEventListener=function(a){return null!=this._listeners[a]&&0<this._listeners[a].size};f.prototype.on=function(a,g){var b=this;null==this._listeners[a]&&(this._listeners[a]=new Map);var e={};this._listeners[a].set(e,g);return{remove:function(){return b._listeners[a].delete(e)}}};f.prototype.emit=function(a,g){null!=this._listeners[a]&&this._listeners[a].forEach(function(a){return a(g)})};return f}();f.Evented=p})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../support/mathUtils ../Octree".split(" "),
function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function c(c,e){var d=b.call(this,[0,0,0],1,{getCenter:function(a){var b=d._instanceData.view.boundingSphere,c=d._tmpCenter;c[0]=b.get(a,0);c[1]=b.get(a,1);c[2]=b.get(a,2);return c},getRadius:function(a){return d._instanceData.view.boundingSphere.get(a,3)}},{maximumDepth:25})||this;d._tmpCenter=a.vec3f64.create();d._tmpMat4=a.mat4f64.create();d._instanceData=c;d._boundingSphere=e;return d}k(c,b);c.prototype.addInstance=
function(b){var c=this._instanceData.view.boundingSphere,d=this._instanceData.getCombinedModelTransform(b,this._tmpMat4),e=a.vec3.transformMat4(this._tmpCenter,this._boundingSphere.center,d),d=this._boundingSphere.radius*g.maxScale(d);c.set(b,0,e[0]);c.set(b,1,e[1]);c.set(b,2,e[2]);c.set(b,3,d);this.add(b)};c.prototype.removeInstance=function(a){this.remove(a)};return c}(b);f.InstanceOctree=p})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["require","exports","../Camera"],
function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function a(a,b){this.thresholdScale=1;this._camera=new k;this._worldSpaceRadius=a;this._thresholds=b.map(function(a){return a})}a.prototype.updateCamera=function(a){this._camera.copyFrom(a)};a.prototype.selectLevel=function(a,b){a=this._camera.computePixelSizeAt(a);b=this._worldSpaceRadius*b/a;a=this._thresholds;for(var e=-1,c=0;c<a.length;++c)b>=a[c]*this.thresholdScale&&(e=c);return e};return a}();f.LevelSelector=p})},
"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["require","exports","../../../support/buffer/BufferView","./BackedBufferObject","../../../../webgl/Util"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});var b=g.assert,e=function(){return function(a){this.modelOriginHi=a.getField("modelOriginHi",k.BufferViewVec3f);this.modelOriginLo=a.getField("modelOriginLo",k.BufferViewVec3f);this.model=a.getField("model",k.BufferViewMat3f);this.modelNormal=
a.getField("modelNormal",k.BufferViewMat3f);this.color=a.getField("instanceColor",k.BufferViewVec4f);this.featureAttribute=a.getField("instanceFeatureAttribute",k.BufferViewVec4f)}}();f.View=e;p=function(){function g(a,b){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=a;this._instanceBufferLayout=b;this._elementSize=b.stride;this._capacity=1}g.prototype.destroy=function(){this._buffer&&this._buffer.destroy()};Object.defineProperty(g.prototype,
"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"size",{get:function(){var a=this._headIndex,b=this._tailIndex;return a>=b?a-b:a+this._capacity-b},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0});g.prototype.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};g.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0};g.prototype.beginUpdate=function(){b(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=
this._headIndex};g.prototype.endUpdate=function(){b(this._updating,"not updating");this.size<m*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};g.prototype.allocateHead=function(){b(this._updating,"not updating");this.isFull&&this.grow();var a=this.headIndex;this._captureFirstIndex&&(this._firstIndex=a,this._captureFirstIndex=!1);this.incrementHead();b(this._headIndex!==this._tailIndex,
"invalid pointers");return a};g.prototype.freeTail=function(){b(this._updating,"not updating");b(0<this.size,"invalid size");var a=this._tailIndex===this._firstIndex;this.incrementTail();a&&(this._firstIndex=this._tailIndex)};g.prototype.grow=function(){this.resize(Math.max(c,Math.floor(this._capacity*d)))};g.prototype.shrink=function(){h&&this.resize(Math.max(c,Math.floor(this._capacity*l)))};g.prototype.resize=function(c){b(this._updating,"not updating");if(c!==this._capacity){var d=new a(this._rctx,
34962,35044,this._elementSize,c);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var h=this.size,g=this.compactInstances(d);b(g===h,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=g;this._prevHeadIndex=0}this._resized=!0;this._capacity=c;this._buffer=d;this._view=new e(this._instanceBufferLayout.createView(this._buffer.array))}};g.prototype.compactInstances=function(a){var b=this._headIndex,c=this._tailIndex;
return c<b?(this._buffer.copyRange(c,b,a),b-c):c>b?(this._buffer.copyRange(c,this._capacity,a),0<b&&this._buffer.copyRange(0,b,a,this._capacity-c),b+(this._capacity-c)):0};g.prototype.incrementHead=function(a){void 0===a&&(a=1);this._headIndex=(this._headIndex+a)%this._capacity};g.prototype.incrementTail=function(a){void 0===a&&(a=1);this._tailIndex=(this._tailIndex+a)%this._capacity};g.prototype.transferRange=function(a,b){a<b?this._buffer.transferRange(a,b):a>b&&(0<b&&this._buffer.transferRange(0,
b),this._buffer.transferRange(a,this._capacity))};return g}();f.RenderInstanceData=p;var c=1024,d=2,m=.3,l=.5,h=!0})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["require","exports","../../../../webgl/BufferObject"],function(p,f,k){return function(){function a(a,b,e,c,d){this._elementSize=c;this._buffer=new k(a,b,e);this.resize(d)}a.prototype.destroy=function(){this._buffer.dispose()};Object.defineProperty(a.prototype,"elementSize",{get:function(){return this._elementSize},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},
enumerable:!0,configurable:!0});a.prototype.copyRange=function(a,b,e,c){void 0===c&&(c=0);a=new Uint8Array(this.array,a*this.elementSize,(b-a)*this.elementSize);(new Uint8Array(e.array,c*this.elementSize)).set(a)};a.prototype.transferAll=function(){this._buffer.setData(this._array)};a.prototype.transferRange=function(a,b){a*=this._elementSize;this._buffer.setSubData(this._array,a,a,b*this._elementSize)};a.prototype.resize=function(a){var b=a*this._elementSize,e=new ArrayBuffer(b);this._array&&(a>=
this._capacity?(new Uint8Array(e)).set(new Uint8Array(this._array)):(new Uint8Array(e)).set((new Uint8Array(this._array)).subarray(0,a*this._elementSize)));this._array=e;this._buffer.setData(b);this._capacity=a};return a}()})},"esri/views/3d/webgl-engine/lib/lodRendering/utils":function(){define(["require","exports","../doublePrecisionUtils"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.acquireGLMaterials=function(a,e){var b={};b[0]=e.aquire(a);b[3]=e.aquireDepthShadowMap(a);
b[2]=e.aquireNormal(a);b[1]=e.aquireDepth(a);b[4]=e.aquireHighlight(a);return b};f.releaseGLMaterials=function(a,e){e.release(a.id);e.releaseDepthShadowMap(a.id);e.releaseNormal(a.id);e.releaseDepth(a.id);e.releaseHighlight(a.id)};f.encodeDoubleVec3=function(b,e,c,d,f){a[0]=b.get(e,0);a[1]=b.get(e,1);a[2]=b.get(e,2);k.encodeDoubleArray(a,g,3);c.set(f,0,g[0]);d.set(f,0,g[1]);c.set(f,1,g[2]);d.set(f,1,g[3]);c.set(f,2,g[4]);d.set(f,2,g[5])};var a=new Float64Array(3),g=new Float32Array(6)})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Point ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u){function r(a,b,c,d){a=a.stageObject;for(var h=a.getGeometryRecords(),g=h.length,l="absolute-height"!==b.mode,f=0,k=0;k<g;k++){var m=h[k].geometry,n=[h[k].transformation[12],h[k].transformation[13],h[k].transformation[14]],r=m.data.getVertexAttr(),q=r[x.POSITION].data,u=r.zOffset.data,r=r.mapPos.data,t=r.length/3;y(q.length/3===t*C+2,"unexpected tube geometry");var p=0,D=0;w.spatialReference=c.spatialReference;for(var E=0,G=0;G<t;G++){w.x=r[3*G];w.y=r[3*G+
1];w.z=r[3*G+2];var H=e.computeElevation(c,w,b,d,l?B:null);l&&(E+=B.terrainElevation);var ca=C;0!==G&&G!==t-1||ca++;for(var Z=0;Z<ca;Z++)z[0]=q[p]+n[0],z[1]=q[p+1]+n[1],z[2]=q[p+2]+n[2],d.setAltitude(H+u[D],z),q[p]=z[0]-n[0],q[p+1]=z[1]-n[1],q[p+2]=z[2]-n[2],p+=3,D+=1;m.invalidateBoundingInfo()}a.geometryVertexAttrsUpdated(k);f+=E/t}return f/g}var y=t.assert;p=function(c){function g(){return null!==c&&c.apply(this,arguments)||this}k(g,c);g.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var b=
d.validateSymbolLayerSize(this._getSymbolSize());if(b){this._logWarning(b);this.reject();return}}var b=this._getStageIdHint(),c=this._getMaterialOpacityAndColor(),e=a.vec3f64.fromArray(c),c=c[3],e={diffuse:e,ambient:e,opacity:c,transparent:1>c||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new u(e,b+"_3dlinemat");this._context.stage.add(l.ModelContentType.MATERIAL,
this._material);this.resolve()};g.prototype.destroy=function(){c.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(l.ModelContentType.MATERIAL,this._material.id),this._material=null)};g.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("polyline"!==b.geometry.type)return this._logWarning("unsupported geometry type for path symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,
d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};g.prototype.layerOpacityChanged=function(){var a=this._getMaterialOpacity(),b=1>a||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:a,transparent:b});return!0};g.prototype.layerElevationInfoChanged=function(a,b){return this.updateGraphics3DGraphicElevationInfo(a,b,e.needsElevationUpdates3D)};g.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};g.prototype._getPathSize=function(a){a=a.size&&this._isPropertyDriven("size")?e.getSingleSizeDriver(a.size):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};g.prototype._getSymbolSize=function(){return this.symbol.size||1};g.prototype._createAs3DShape=function(c,d,g,l,f){var k=c.geometry,u=k.paths;c=[];var t=[],w=[],y=a.vec3f64.create(),z=this._context.renderSpatialReference===m.SphericalECEFSpatialReference,x=Array(6),p=this._getPathSize(d),k=e.getGeometryVertexData3D(u,
k.hasZ,k.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,g);this._logGeometryCreationWarnings(k,u,"paths","PathSymbol3DLayer");if(0<u.length){for(var u=k.geometryData.outlines,B=k.eleVertexData,D=k.vertexData,E=0;E<u.length;++E){var G=u[E];if(!(1>=G.count)){var I=G.index,H=G.count;if(this._context.clippingExtent&&(e.computeBoundingBox(B,I,H,x),e.boundingBoxClipped(x,this._context.clippingExtent)))continue;e.chooseOrigin(D,I,H,
y);e.subtractCoordinates(D,I,H,y);G=new Float64Array(B.buffer,3*I*B.BYTES_PER_ELEMENT,3*H);I=e.flatArrayToArrayOfArrays(D,I,H);I=n.createTubeGeometry(I,.5*p,C,z,y);I.getVertexAttr().mapPos={size:3,data:G,offsetIdx:0,strideIdx:3};this._material.getParams().vertexColors&&(G=this._getVertexOpacityAndColor(d),I=n.addVertexColors(I,G));G=new h(I,l+"path"+E);G.singleUse=!0;c.push(G);t.push(this._material);G=a.mat4f64.create();a.mat4.translate(G,G,y);w.push(G)}}if(0<c.length)return d=new q({geometries:c,
materials:t,transformations:w,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:f},idHint:l}),d=new b(this,d,c,null,null,r,g),d.alignedTerrainElevation=k.terrainElevation,d.needsElevationUpdates=e.needsElevationUpdates3D(g.mode),d}return null};return g}(c);var x=t.VertexAttrConstants,z=a.vec3f64.create(),w=new g,B={verticalDistanceToGround:0,terrainElevation:0},C=10;return p})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer2":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/lang ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Point ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./symbolComplexity ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/PathMaterial".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z){function w(a,b,d,e){a=a.stageObject;var h=a.getMetadata().pathGeometryBuilder;if(!h)throw Error("pathgeometry metadata expected");var g=a.getGeometryRecords(),l=g.length;D.spatialReference=d.spatialReference;for(var f="absolute-height"!==b.mode,k=0,m=0;m<l;m++){for(var n=g[m].geometry,r=h[n.id],q=r.path.offset,u=n.data.getVertexAttr()[B.POSITION].data,t=0,w=0;w<r.path.vertices.length;w++){var y=r.path.vertices[w];D.x=y.mapPos[0];D.y=y.mapPos[1];D.z=
y.mapPos[2];y.elevation=c.computeElevation(d,D,b,e,f?E:null);f&&(t+=E.terrainElevation)}for(w=0;w<r.numVerticesTotal;++w)y=r.path.vertices[r.pathVertexData[w]],C[0]=u[3*w+0]+q[0],C[1]=u[3*w+1]+q[1],C[2]=u[3*w+2]+q[2],e.setAltitude(y.elevation,C),u[3*w+0]=C[0]-q[0],u[3*w+1]=C[1]-q[1],u[3*w+2]=C[2]-q[2];n.invalidateBoundingInfo();a.geometryVertexAttrsUpdated(m);k+=t/r.path.vertices.length}return k/l}p=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}k(d,b);d.prototype._prepareResources=
function(){if(!this._isPropertyDriven("size")){var b=m.validateSymbolLayerSize(this._getSymbolSize());if(b){this._logWarning(b);this.reject();return}}var b=this._getStageIdHint(),c=this._getMaterialOpacityAndColor(),d=g.vec3f32.fromValues(c[0],c[1],c[2]),c=c[3],d={diffuse:d,ambient:d,opacity:c,transparent:1>c||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),slicePlaneEnabled:this._context.slicePlaneEnabled};this._vvConvertOptions={modelSize:[1,
1,1],symbolSize:[1,1,1],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,rotation:!1}};this._fastUpdates=h.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions);a.mixin(d,this._fastUpdates.materialParameters);this._pathMaterial=new z(d,b+"_pathmat");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?this._pathMaterial.setParameterValues({size:1}):this._pathMaterial.setParameterValues({size:this._getSymbolSize()/
this._context.renderCoordsHelper.unitInMeters});this._context.stage.add(q.ModelContentType.MATERIAL,this._pathMaterial);this._profile=y.Profile.tube(G);this._extruder=new y.SimpleExtruder;this.resolve()};d.prototype.destroy=function(){b.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._pathMaterial&&(this._context.stage.remove(q.ModelContentType.MATERIAL,this._pathMaterial.id),this._pathMaterial=null)};d.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("polyline"!==
b.geometry.type)return this._logWarning("unsupported geometry type for path symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};d.prototype.layerOpacityChanged=function(){var a=this._getMaterialOpacity(),b=1>a||this._isPropertyDriven("opacity");this._pathMaterial.setParameterValues({opacity:a,transparent:b});return!0};d.prototype.layerElevationInfoChanged=
function(a,b,d){var e=this;a.forEach(function(a){var d=b(a);d&&(a=e.getGraphicElevationContext(a.graphic),d.needsElevationUpdates=c.needsElevationUpdates3D(a.mode),d.elevationContext.set(a))});return!0};d.prototype.slicePlaneEnabledChanged=function(a,b){this._pathMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};d.prototype.applyRendererDiff=function(b,c){for(var d in b.diff)switch(d){case "visualVariables":if(h.updateFastSymbolUpdatesState(this._fastUpdates,
c,this._vvConvertOptions))b={},a.mixin(b,this._fastUpdates.materialParameters),this._pathMaterial.setParameterValues(b);else return!1;break;default:return!1}return!0};d.prototype.computeComplexity=function(){var a=this._profile.vertices.length/3,b=l.defaultSymbolLayerMemoryComplexity(this.symbolContainer,this.symbol);return{primitivesPerFeature:-4,primitivesPerCoordinate:2*a,memory:b}};d.prototype._getSymbolSize=function(){return this.symbol.size||1};d.prototype._createAs3DShape=function(a,b,d,h,
l){var f={},k=a.geometry,m=k.paths,q=[],z=[],x=[],p=g.vec3f32.create(),B=this._context.renderSpatialReference===n.SphericalECEFSpatialReference,C=Array(6),k=c.getGeometryVertexData3D(m,k.hasZ,k.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,d);this._logGeometryCreationWarnings(k,m,"paths","PathSymbol3DLayer");if(0<m.length){for(var m=k.geometryData.outlines,D=k.eleVertexData,E=k.vertexData,G=0;G<m.length;++G){var I=m[G],H=I.index,
N=I.count;if(!(2>N)){if(this._context.clippingExtent&&(c.computeBoundingBox(D,H,N,C),c.boundingBoxClipped(C,this._context.clippingExtent)))continue;c.chooseOrigin(E,H,N,p);c.subtractCoordinates(E,H,N,p);I=g.mat4f64.create();g.mat4.translate(I,I,p);H=new y.Path(E,D,H,N,B,p);H=new y.Builder(H,this._profile,this._extruder);this._fastUpdates.enabled&&H.setVisualVariableValue(this.getFastUpdateAttrValues(a));N=H.createGeometryData();if(this._pathMaterial.getParams().vertexColors)var O=this._getVertexOpacityAndColor(b),
N=u.addVertexColors(N,O);N=new t(N,h+"path"+G);f[N.id]=H;N.singleUse=!0;q.push(N);z.push(this._pathMaterial);x.push(I)}}a={layerUid:this._context.layer.uid,graphicUid:l,pathGeometryBuilder:f};if(0<q.length)return h=new r({geometries:q,materials:z,transformations:x,castShadow:!0,metadata:a,idHint:h}),q=new e(this,h,q,null,null,w,d),q.alignedTerrainElevation=k.terrainElevation,q.needsElevationUpdates=c.needsElevationUpdates3D(d.mode),q}return null};return d}(d);var B=x.VertexAttrConstants,C=g.vec3f64.create(),
D=new b,E={verticalDistanceToGround:0,terrainElevation:0},G=10;return p})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/geometryUtils ../../support/mathUtils ./GeometryData ./GeometryUtil ./Util".split(" "),function(p,f,k,a,g,b,e,c,d,m){var l;(function(l){var f=function(){function a(a){this.pos=a;this.mapPos=g.vec3f32.create();
this.vRight=g.vec3f32.create();this.vLeft=g.vec3f32.create();this.frame={forward:g.vec3f32.create(),up:g.vec3f32.create(),right:g.vec3f32.create()};this.rotationAxis=g.vec3f32.create();this.angle=0}a.prototype.profileSpaceToVertexSpace=function(a,b){a[0]=b[0]*this.frame.right[0]+b[1]*this.frame.up[0];a[1]=b[0]*this.frame.right[1]+b[1]*this.frame.up[1];a[2]=b[0]*this.frame.right[2]+b[1]*this.frame.up[2]};return a}();l.PathVertex=f;var w=function(){function a(){this.vertices=[];this.vertexIndices=[];
this.uvIndices=this.uvs=this.normalIndices=this.normals=null}a.prototype.addVertex=function(a){this.vertices.push(g.vec2f32.clone(a));return this.vertices.length-1};a.prototype.addNormal=function(a){this.normals||(this.normals=[],this.normalIndices=[]);this.normals.push(g.vec2f32.clone(a));return this.normals.length-1};a.prototype.addUV=function(a){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(a);return this.uvs.length-1};a.prototype.addSegment=function(a,b,c,d,e,h){void 0===c&&(c=null);
void 0===d&&(d=null);void 0===e&&(e=null);void 0===h&&(h=null);this.vertexIndices.push(a);this.vertexIndices.push(b);null!==c&&null!==d&&(this.normalIndices.push(c),this.normalIndices.push(d));null!==e&&null!==h&&(this.uvIndices.push(e),this.uvIndices.push(h))};Object.defineProperty(a.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0});a.prototype.hasNormals=function(){return null!=this.normals};a.prototype.hasUV=function(){return null!=this.uvs};
a.prototype.normalize=function(){for(var a=0,b=0,c=this.vertices;b<c.length;b++)var d=c[b],a=Math.max(a,g.vec2.length(d));a=1/a;b=0;for(c=this.vertices;b<c.length;b++)d=c[b],g.vec2.scale(d,d,a)};a.tube=function(b){void 0===b&&(b=20);for(var c=new a,d=0;d<b;++d){var e=2*d*Math.PI/b;c.addVertex(g.vec2f32.fromValues(1*Math.cos(e),1*Math.sin(e)));c.addUV(d/b)}c.addUV(1);for(d=0;d<b-1;++d)c.addSegment(d,d+1,null,null,d,d+1);c.addSegment(b-1,0,null,null,b-1,b);return c};a.line=function(b,c){var d=new a,
e=c[0]-b[0],h=c[1]-b[1];d.addVertex(b);d.addVertex(c);d.addNormal(g.vec2f32.fromValues(-h,e));d.addUV(0);d.addUV(1);d.addSegment(0,1,0,0,0,1);return d};a.point=function(b){var c=new a;c.addVertex(b);return c};a.wall=function(b,c){void 0===b&&(b=.2);void 0===c&&(c=1);var d=new a;d.addVertex(g.vec2f32.fromValues(.5*-b,0));d.addVertex(g.vec2f32.fromValues(.5*b,0));d.addVertex(g.vec2f32.fromValues(.5*b,c));d.addVertex(g.vec2f32.fromValues(.5*-b,c));d.addNormal(g.vec2f32.fromValues(0,-1));d.addNormal(g.vec2f32.fromValues(1,
0));d.addNormal(g.vec2f32.fromValues(0,1));d.addNormal(g.vec2f32.fromValues(-1,0));d.addUV(0);d.addUV(1);d.addSegment(0,1,0,0,0,1);d.addSegment(1,2,1,1,0,1);d.addSegment(2,3,2,2,0,1);d.addSegment(3,0,3,3,0,1);return d};a.strip=function(){return this.line(g.vec2f32.fromValues(-1,0),g.vec2f32.fromValues(1,0))};a.fence=function(){return this.line(g.vec2f32.fromValues(0,0),g.vec2f32.fromValues(0,1))};return a}();l.Profile=w;w=function(){return function(a,c,h,l,k,m){this.vertices=[];this.offset=g.vec3f32.create();
g.vec3.copy(this.offset,m);for(m=h;m<h+l;++m){var n=new f(g.vec3f32.fromValues(a[3*m+0],a[3*m+1],a[3*m+2]));g.vec3.set(n.mapPos,c[3*m+0],c[3*m+1],c[3*m+2]);this.vertices.push(n)}a=g.vec3f32.create();c=g.vec3f32.create();h=g.vec3f32.create();m=g.vec3f32.create();var n=g.vec3f32.create(),r=g.vec3f64.create(),q=g.vec3f32.create(),t=g.vec3f32.create(),w=g.vec3f32.create(),y=g.vec3f32.create(),z,x,p=b.plane.create(),B=this.vertices[0];g.vec3.set(q,0,1,0);g.vec3.subtract(c,this.vertices[1].pos,B.pos);z=
0;x=g.vec3.length(c);g.vec3.normalize(c,c);k?(g.vec3.add(r,B.pos,this.offset),g.vec3.normalize(h,r)):g.vec3.set(h,0,0,1);d.makeOrthoBasisDirUpFallback(c,h,q,q,n,h,.99619469809);g.vec3.copy(m,h);g.vec3.copy(y,n);g.vec3.copy(B.vRight,c);g.vec3.copy(B.vLeft,a);g.vec3.copy(B.frame.forward,c);g.vec3.copy(B.frame.up,h);g.vec3.copy(B.frame.right,n);B.vLeftLength=z;B.vRightLength=x;B.index=0;g.vec3.cross(B.rotationAxis,B.vLeft,B.vRight);g.vec3.normalize(B.rotationAxis,B.rotationAxis);B.angle=0;for(k=1;k<
l;++k)B=this.vertices[k],g.vec3.copy(a,c),z=x,k<l-1&&(g.vec3.subtract(c,this.vertices[k+1].pos,B.pos),x=g.vec3.length(c),g.vec3.normalize(c,c)),g.vec3.add(t,a,c),g.vec3.normalize(t,t),g.vec3.add(w,this.vertices[k-1].pos,m),b.plane.fromPositionAndNormal(this.vertices[k].pos,t,p),b.plane.intersectRay(p,b.ray.wrap(w,a),r)?(g.vec3.subtract(r,r,this.vertices[k].pos),g.vec3.normalize(h,r),g.vec3.cross(n,t,h),g.vec3.normalize(n,n)):d.makeOrthoBasisDirUpFallback(t,m,y,q,n,h,.99619469809),g.vec3.copy(m,h),
g.vec3.copy(y,n),g.vec3.copy(B.vRight,c),g.vec3.copy(B.vLeft,a),g.vec3.copy(B.frame.forward,t),g.vec3.copy(B.frame.up,h),g.vec3.copy(B.frame.right,n),B.vLeftLength=z,B.vRightLength=x,B.index=k,g.vec3.cross(B.rotationAxis,B.vLeft,B.vRight),g.vec3.normalize(B.rotationAxis,B.rotationAxis),g.vec3.negate(u,B.vLeft),B.angle=Math.PI-e.acos(g.vec3.dot(u,B.vRight))}}();l.Path=w;w=function(){return function(){}}();l.Extruder=w;w=function(){function a(){}a.prototype.numVertices=function(a){return a.vertices.length};
a.prototype.extrude=function(a,b,c){for(var d=0;d<b.vertices.length;++d){var e=b.vertices[d];e.profileSpaceToVertexSpace(q,a);c(e.pos,q,d)}};return a}();l.SimpleExtruder=w;w=function(){function a(a){void 0===a&&(a=1);this._segmentsPerRadian=a/Math.PI}a.prototype.getNumSegments=function(a){return Math.ceil(a*this._segmentsPerRadian)};a.prototype.numVertices=function(a){for(var b=2,c=1;c<a.vertices.length-1;++c)b+=this.getNumSegments(a.vertices[c].angle)+1;return b};a.prototype.extrude=function(a,b,
c){b.vertices[0].profileSpaceToVertexSpace(q,a);c(b.vertices[0].pos,q,0);g.vec3.copy(r,q);for(var d=1;d<b.vertices.length-1;++d){var e=b.vertices[d];e.profileSpaceToVertexSpace(q,a);var h=this.getNumSegments(e.angle);g.mat4.identity(z);g.mat4.rotate(z,z,.5*-e.angle,e.rotationAxis);g.vec3.transformMat4(y,q,z);if(0<=g.vec3.dot(y,e.vRight)){for(var l=0;l<h+1;++l)c(e.pos,q,d);g.vec3.copy(r,q)}else{g.mat4.identity(z);g.mat4.rotate(z,z,e.angle/h,e.rotationAxis);c(e.pos,y,d);g.vec3.copy(x,y);for(l=0;l<h;++l)g.vec3.transformMat4(x,
x,z),c(e.pos,x,d);g.vec3.copy(r,x)}}d=b.vertices.length-1;b.vertices[d].profileSpaceToVertexSpace(q,a);c(b.vertices[d].pos,q,d)};return a}();l.RoundExtruder=w;w=function(b){function c(){return b.call(this,1)||this}a(c,b);return c}(w);l.BevelExtruder=w;w=function(){function a(a,b,c){this.vvData=null;this._capNormalsOffset=this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this._numExtrusionVertices=this._extrusionNormalCount=this._extrusionVertexCount=0;this._profile=b;this._profile.normalize();
this.path=a;this._extruder=c;this._numExtrusionVertices=c.numVertices(a);this.numVerticesTotal=b.vertices.length*this._numExtrusionVertices;this._profile.hasNormals()?this.numNormalsTotal=this._profile.normals.length*this._numExtrusionVertices:this.numNormalsTotal=this.numVerticesTotal;this.numNormalsTotal+=2;this.originData=new Float32Array(3*this.numVerticesTotal);this.directionData=new Float32Array(4*this.numVerticesTotal);this.normalData=new Float32Array(3*this.numNormalsTotal);this.pathVertexData=
new Float32Array(1*this.numVerticesTotal);this._profile.hasUV()&&(this.numUVTotal=this._profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.buildGeometry();this.buildTopology()}a.prototype.setVisualVariableValue=function(a){this.vvData||(this.vvData=new Float32Array(4*this.path.vertices.length));for(var b=0;b<this.path.vertices.length;++b)this.vvData[4*b+0]=a[0],this.vvData[4*b+1]=a[1]};a.queryVertexPosition=function(a,b){g.vec3.copy(a,b.direction);if(b.vvSizeEnabled){g.vec3.copy(t,
b.vvSizeFactor);g.vec3.scale(t,t,b.auxpos2X);g.vec3.add(t,t,b.vvSizeOffset);var c=t,d=b.vvSizeMinSize,e=b.vvSizeMaxSize;c[0]=Math.min(Math.max(c[0],d[0]),e[0]);c[1]=Math.min(Math.max(c[1],d[1]),e[1]);c[2]=Math.min(Math.max(c[2],d[2]),e[2]);g.vec3.multiply(a,a,t)}else g.vec3.scale(a,a,b.size);g.vec3.add(a,a,b.origin)};a.prototype.emitVertex=function(a,b,c){this.originData[3*this._extrusionVertexCount+0]=a[0];this.originData[3*this._extrusionVertexCount+1]=a[1];this.originData[3*this._extrusionVertexCount+
2]=a[2];this.directionData[4*this._extrusionVertexCount+0]=b[0];this.directionData[4*this._extrusionVertexCount+1]=b[1];this.directionData[4*this._extrusionVertexCount+2]=b[2];this.directionData[4*this._extrusionVertexCount+3]=c/(this.path.vertices.length-1);this.pathVertexData[this._extrusionVertexCount]=c;++this._extrusionVertexCount};a.prototype.emitNormal=function(a,b,c){g.vec3.normalize(t,b);this.normalData[3*this._extrusionNormalCount+0]=t[0];this.normalData[3*this._extrusionNormalCount+1]=
t[1];this.normalData[3*this._extrusionNormalCount+2]=t[2];++this._extrusionNormalCount};a.prototype.buildGeometry=function(){for(var a=this.emitVertex.bind(this),b=this.emitNormal.bind(this),c=this._extrusionNormalCount=this._extrusionVertexCount=0;c<this._profile.vertices.length;++c)this._extruder.extrude(this._profile.vertices[c],this.path,a);if(this._profile.hasNormals())for(a=0;a<this._profile.normals.length;++a)this._extruder.extrude(this._profile.normals[a],this.path,b);else for(a=0;a<this._extrusionVertexCount;++a)g.vec3.set(t,
this.directionData[4*a+0],this.directionData[4*a+1],this.directionData[4*a+2]),g.vec3.normalize(t,t),this.normalData[3*this._extrusionNormalCount+0]=t[0],this.normalData[3*this._extrusionNormalCount+1]=t[1],this.normalData[3*this._extrusionNormalCount+2]=t[2],++this._extrusionNormalCount;this._capNormalsOffset=this._extrusionNormalCount;b=this.path.vertices[0];a=this.path.vertices[this.path.vertices.length-1];this.normalData[3*this._extrusionNormalCount+0]=-b.vRight[0];this.normalData[3*this._extrusionNormalCount+
1]=-b.vRight[1];this.normalData[3*this._extrusionNormalCount+2]=-b.vRight[2];++this._extrusionNormalCount;this.normalData[3*this._extrusionNormalCount+0]=a.vRight[0];this.normalData[3*this._extrusionNormalCount+1]=a.vRight[1];this.normalData[3*this._extrusionNormalCount+2]=a.vRight[2];++this._extrusionNormalCount;if(this._profile.hasUV())for(a=0;a<this._profile.uvs.length;++a)this.uvData[2*a+0]=this._profile.uvs[a],this.uvData[2*a+1]=0};a.prototype.buildTopology=function(){var a=this._profile.numSegments,
b=this._numExtrusionVertices-1,c=a*b*6;2<this._profile.vertices.length&&(c+=6*(this._profile.vertices.length-2));this._vertexIndices=new Uint32Array(c);this._normalIndices=new Uint32Array(c);this._pathVertexIndices=new Uint32Array(c);this._profile.hasUV()&&(this._uvIndices=new Uint32Array(c));for(var d=c=0;d<a;++d){var e=this._profile.vertexIndices[2*d],h=this._profile.vertexIndices[2*d+1],g=e,l=h,f=0,k=0;this._profile.hasNormals()&&(g=this._profile.normalIndices[2*d],l=this._profile.normalIndices[2*
d+1]);this._profile.hasUV()&&(f=this._profile.uvIndices[2*d],k=this._profile.uvIndices[2*d+1]);for(var m=0;m<b;++m){var n=e*this._numExtrusionVertices+m,r=e*this._numExtrusionVertices+m+1,q=h*this._numExtrusionVertices+m+1,u=h*this._numExtrusionVertices+m,t=g*this._numExtrusionVertices+m,w=g*this._numExtrusionVertices+m+1,y=l*this._numExtrusionVertices+m+1,z=l*this._numExtrusionVertices+m,x=f,p=f,B=k,C=k;this._vertexIndices[3*c+0]=n;this._vertexIndices[3*c+1]=r;this._vertexIndices[3*c+2]=q;this._pathVertexIndices[3*
c+0]=this.pathVertexData[n];this._pathVertexIndices[3*c+1]=this.pathVertexData[r];this._pathVertexIndices[3*c+2]=this.pathVertexData[q];this._normalIndices[3*c+0]=t;this._normalIndices[3*c+1]=w;this._normalIndices[3*c+2]=y;this._vertexIndices[3*c+3]=n;this._vertexIndices[3*c+4]=q;this._vertexIndices[3*c+5]=u;this._pathVertexIndices[3*c+3]=this.pathVertexData[n];this._pathVertexIndices[3*c+4]=this.pathVertexData[q];this._pathVertexIndices[3*c+5]=this.pathVertexData[u];this._normalIndices[3*c+3]=t;
this._normalIndices[3*c+4]=y;this._normalIndices[3*c+5]=z;this._profile.hasUV()&&(this._uvIndices[3*c+0]=x,this._uvIndices[3*c+1]=p,this._uvIndices[3*c+2]=B,this._uvIndices[3*c+3]=x,this._uvIndices[3*c+4]=B,this._uvIndices[3*c+5]=C);c+=2}}if(2<this._profile.vertices.length)for(a=this._profile.vertices.length-2,e=0,b=e*this._numExtrusionVertices+0,e=(e+1)*this._numExtrusionVertices-1,m=0;m<a;++m)h=m+1,d=h*this._numExtrusionVertices+0,h=(h+1)*this._numExtrusionVertices-1,l=m+2,g=l*this._numExtrusionVertices+
0,l=(l+1)*this._numExtrusionVertices-1,this._vertexIndices[3*c+0]=b,this._vertexIndices[3*c+1]=d,this._vertexIndices[3*c+2]=g,this._normalIndices[3*c+0]=this._capNormalsOffset+0,this._normalIndices[3*c+1]=this._capNormalsOffset+0,this._normalIndices[3*c+2]=this._capNormalsOffset+0,this._pathVertexIndices[3*c+0]=this.pathVertexData[b],this._pathVertexIndices[3*c+1]=this.pathVertexData[d],this._pathVertexIndices[3*c+2]=this.pathVertexData[g],++c,this._vertexIndices[3*c+0]=l,this._vertexIndices[3*c+
1]=h,this._vertexIndices[3*c+2]=e,this._normalIndices[3*c+0]=this._capNormalsOffset+1,this._normalIndices[3*c+1]=this._capNormalsOffset+1,this._normalIndices[3*c+2]=this._capNormalsOffset+1,this._pathVertexIndices[3*c+0]=this.pathVertexData[l],this._pathVertexIndices[3*c+1]=this.pathVertexData[h],this._pathVertexIndices[3*c+2]=this.pathVertexData[e],++c};a.prototype.createBakedGeometryData=function(b){for(var d=new Float32Array(3*this.numVerticesTotal),e=new Float32Array(4*this.numVerticesTotal),
l=k({},b,{origin:n,direction:q,auxpos2X:0}),f=0;f<this.numVerticesTotal;++f)g.vec3.set(l.origin,this.originData[3*f+0],this.originData[3*f+1],this.originData[3*f+2]),g.vec3.set(l.direction,this.directionData[4*f+0],this.directionData[4*f+1],this.directionData[4*f+2]),b.vvSizeEnabled&&(l.auxpos2X=this.vvData[4*this._pathVertexIndices[f]+0]),a.queryVertexPosition(h,l),d[3*f+0]=h[0],d[3*f+1]=h[1],d[3*f+2]=h[2];b={};b[m.VertexAttrConstants.POSITION]=this._vertexIndices;b[m.VertexAttrConstants.NORMAL]=
this._normalIndices;b[m.VertexAttrConstants.AUXPOS1]=this._vertexIndices;l={};l[m.VertexAttrConstants.POSITION]={size:3,data:d};l[m.VertexAttrConstants.NORMAL]={size:3,data:this.normalData};l[m.VertexAttrConstants.AUXPOS1]={size:4,data:e};return new c(l,b,c.DefaultOffsets,"triangle")};a.prototype.createGeometryData=function(){var a={};a[m.VertexAttrConstants.POSITION]=this._vertexIndices;a[m.VertexAttrConstants.AUXPOS1]=this._vertexIndices;a[m.VertexAttrConstants.NORMAL]=this._normalIndices;var b=
{};b[m.VertexAttrConstants.POSITION]={size:3,data:this.originData};b[m.VertexAttrConstants.AUXPOS1]={size:4,data:this.directionData};b[m.VertexAttrConstants.NORMAL]={size:3,data:this.normalData};this._profile.hasUV()&&(a[m.VertexAttrConstants.UV0]=this._uvIndices,b[m.VertexAttrConstants.UV0]={size:2,data:this.uvData});this.vvData&&(a[m.VertexAttrConstants.AUXPOS2]=this._pathVertexIndices,b[m.VertexAttrConstants.AUXPOS2]={size:4,data:this.vvData});return new c(b,a,c.DefaultOffsets,"triangle")};return a}();
l.Builder=w})(l||(l={}));var h=g.vec3f32.create(),n=g.vec3f32.create(),q=g.vec3f32.create(),t=g.vec3f32.create(),u=g.vec3f32.create(),r=g.vec3f32.create(),y=g.vec3f32.create(),x=g.vec3f32.create(),z=g.mat4f32.create();return l})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ../../support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/GLMaterialTexture ../lib/Material ../lib/pathGeometryUtils ../lib/Util ../lib/Util ./VisualVariableMaterialParameters ./internal/bufferWriters ./internal/MaterialUtil ./internal/MaterialUtil ../shaders/PathPrograms".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y){function x(a,b,c){c=b.slicePlaneEnabled?!1:b.cullFace?"none"!==b.cullFace:!b.transparent&&!b.doubleSided;c?(a.setFaceCullingEnabled(!0),"front"===b.cullFace?a.setCullFace(1028):a.setCullFace(1029)):a.setFaceCullingEnabled(!1)}function z(a,b){b.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor));b.vvColorEnabled&&
(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors))}var w=h.assert;p=function(d){function e(a,b){b=d.call(this,b)||this;b.supportsEdges=!0;b.params=r.copyParameters(a,H);b.vertexBufferLayout=e.getVertexBufferLayout(b.params);b.bufferWriter=new I(b.vertexBufferLayout);return b}a(e,d);e.prototype.isVisible=function(){var a=this.params;if(!d.prototype.isVisible.call(this)||0===a.layerOpacity)return!1;var b=a.vertexColors,c=a.symbolColors,e=a.vvColorEnabled,
h="replace"===a.colorMixMode,g=0<a.opacity,a=a.externalColor&&0<a.externalColor[3];return b&&(e||c)?h?!0:g:b?h?a:g:e||c?h?!0:g:h?a:g};e.prototype.getParams=function(){return this.params};e.prototype.getParameterValues=function(){return r.copyParameters(this.params)};e.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)"textureId"===c&&w(b.textureId,"Can only change texture of material that already has a texture"),"castShadows"===c&&w(a.castShadows===b.castShadows,"Can not change shadow casting behavior."),
"wireframe"===c&&w(b.wireframe,"wireframe flag affects drawmode (lines instead of triangles) and therefore can only be set during contruction"),!a[c]||"vvSizeMinSize"!==c&&"vvSizeMaxSize"!==c&&"vvSizeOffset"!==c&&"vvSizeFactor"!==c?b[c]=a[c]:g.vec3.set(b[c],a[c][0],a[c][1],a[c][2]);this.notifyDirty("matChanged")};e.prototype.intersectTriangles=function(a,b,c,d,e,h,f,m,n,q,u){var t=a[0],w=a[1];a=a[2];var y=b[0]-t,z=b[1]-w;b=b[2]-a;for(var x=k({},this.params,{origin:P,direction:O,auxpos2X:0});c<d;c++){var p=
q?q[c]:c,B=f.offsetIdx+f.strideIdx*e[3*p],F=f.offsetIdx+f.strideIdx*e[3*p+1],C=f.offsetIdx+f.strideIdx*e[3*p+2],L=m.offsetIdx+m.strideIdx*e[3*p],v=m.offsetIdx+m.strideIdx*e[3*p+1],K=m.offsetIdx+m.strideIdx*e[3*p+2],D=[0,0,0];if(x.vvSizeEnabled){var R=n.offsetIdx+n.strideIdx*h[3*p+1],J=n.offsetIdx+n.strideIdx*h[3*p+2];D[0]=n.data[n.offsetIdx+n.strideIdx*h[3*p]];D[1]=n.data[R];D[2]=n.data[J]}g.vec3.set(x.origin,f.data[B],f.data[B+1],f.data[B+2]);g.vec3.set(x.direction,m.data[L],m.data[L+1],m.data[L+
2]);x.auxpos2X=D[0];l.Builder.queryVertexPosition(M,x);J=M[0];L=M[1];B=M[2];g.vec3.set(x.origin,f.data[F],f.data[F+1],f.data[F+2]);g.vec3.set(x.direction,m.data[v],m.data[v+1],m.data[v+2]);x.auxpos2X=D[1];l.Builder.queryVertexPosition(M,x);R=M[0];v=M[1];F=M[2];g.vec3.set(x.origin,f.data[C],f.data[C+1],f.data[C+2]);g.vec3.set(x.direction,m.data[K],m.data[K+1],m.data[K+2]);x.auxpos2X=D[2];l.Builder.queryVertexPosition(M,x);var C=R-J,K=v-L,D=F-B,F=M[0]-J,v=M[1]-L,R=M[2]-B,T=z*R-v*b,E=b*F-R*y,G=y*v-F*
z,I=C*T+K*E+D*G,J=t-J,H=w-L,X=a-B,B=H*D-K*X,L=X*C-D*J,N=J*K-C*H;if(I>S){J=J*T+H*E+X*G;if(0>J||J>I)continue;T=y*B+z*L+b*N;if(0>T||J+T>I)continue}else if(I<-S){J=J*T+H*E+X*G;if(0<J||J<I)continue;T=y*B+z*L+b*N;if(0<T||J+T<I)continue}else continue;B=(F*B+v*L+R*N)/I;0<=B&&(C=r.computeNormal(C,K,D,F,v,R,W),u(B,C,p))}};e.prototype.intersect=function(a,c,d,e,h,g,l,f){"triangle"===a.data.primitiveType&&(c=0,c=this.params.vvSizeEnabled?Math.max(this.params.vvSizeMaxSize[0],Math.max(this.params.vvSizeMaxSize[1],
this.params.vvSizeMaxSize[2])):this.params.size,c=b.fromValues(a.boundingInfo.bbMin[0]-c,a.boundingInfo.bbMin[1]-c,a.boundingInfo.bbMin[2]-c,a.boundingInfo.bbMax[0]+c,a.boundingInfo.bbMax[1]+c,a.boundingInfo.bbMax[2]+c),d=[g[0]-h[0],g[1]-h[1],g[2]-h[2]],f=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]),r.intersectAabbInvDir(c,h,[f/d[0],f/d[1],f/d[2]],e.tolerance)&&this.intersectTriangles(h,g,0,a.data.indexCount/3,a.data.getIndices(n.VertexAttrConstants.POSITION),a.data.getIndices(n.VertexAttrConstants.AUXPOS2),
a.data.getAttribute(n.VertexAttrConstants.POSITION),a.data.getAttribute(n.VertexAttrConstants.AUXPOS1),a.data.getAttribute(n.VertexAttrConstants.AUXPOS2),null,l))};e.prototype.getGLMaterials=function(){return{color:B,depth:C,depthShadowMap:this.params.castShadows?D:null,normal:E,highlight:G}};e.prototype.getAllTextureIds=function(){return this.params.textureId?[this.params.textureId]:[]};e.getVertexBufferLayout=function(a){var b=c.newLayout().vec3f("position");b.vec4f(n.VertexAttrConstants.AUXPOS1);
a.groundNormalShading||(b=a.compressedNormals?b.vec2i16("normalCompressed",{glNormalized:!0}):b.vec3f("normal"));a.textureId&&(b=b.vec2f("uv0"),a.atlasRegions&&(b=b.vec4u16("region",{glNormalized:!0})));a.vertexColors&&(b=b.vec4u8("color"));a.symbolColors&&(b=b.vec4u8("symbolColor"));a.componentIndices&&(b=b.u16("componentIndex").u16("_padding",{glPadding:!0}));if(a.vvColorEnabled||a.vvSizeEnabled)b=b.vec4f(n.VertexAttrConstants.AUXPOS2);return b};return e}(m);var B=function(b){function c(a,c,d){var e=
this,h=a.getParams(),e=b.call(this,a,c,d,h.textureId,h.textureInitTransparent)||this;e.params=r.copyParameters(h);a=e.params;e.slot=a.transparent?6:a.writeStencil?2:4;e.texturing=a.textureId?a.atlasRegions?"AtlasTextured":"Textured":"none";e._createPrograms();return e}a(c,b);c.prototype._createPrograms=function(){var a=this;this.programs=u.BindParametersMap.create(this.params,function(b){return a._createProgram(b)})};c.prototype._createProgram=function(a){var b=this.params;return this.programRep.getProgram(y.colorPass,
{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,vertexColors:b.vertexColors,symbolColors:b.symbolColors,flipV:b.flipV,doubleSided:b.doubleSided&&"normal"===b.doubleSidedType,windowOrderDoubleSided:b.doubleSided&&"winding-order"===b.doubleSidedType,receiveShadows:a.receiveShadows,receiveSSAO:a.receiveSSAO,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,verticalOffset:null!==b.verticalOffset,screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,
groundNormalShading:b.groundNormalShading,compressedNormals:b.compressedNormals,componentColor:null!=b.componentColorBuffer,transparencyDiscard:b.transparent,alphaCoverageCorrection:N,wireframe:b.wireframe})};c.prototype.beginSlot=function(a){return a===this.slot};c.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};c.prototype.getPrograms=function(){return u.BindParametersMap.programs(this.programs)};c.prototype.updateParameters=function(){this.params=this.material.getParameterValues();
this.slot=this.params.transparent?6:this.params.writeStencil?2:4;this.updateTexture(this.params.textureId);this._createPrograms()};c.prototype.bind=function(a,b){var c=this.params,d=this.program=u.BindParametersMap.lookup(this.programs,b);a.bindProgram(d);d.setUniform1f("size",c.size);d.setUniform3fv("ambient",c.ambient);d.setUniform3fv("diffuse",c.diffuse);d.setUniform3fv("specular",c.specular);d.setUniform4fv("externalColor",c.externalColor);d.setUniform1i("colorMixMode",r.colorMixModes[c.colorMixMode]);
d.setUniform1f("opacity",c.opacity);d.setUniform1f("layerOpacity",c.layerOpacity);r.bindVerticalOffset(c.verticalOffset,b,d);r.bindScreenSizePerspective(c.screenSizePerspective,b,d);z(d,c);this.bindTexture(a,d);"none"!==this.texturing&&this.bindTextureSize(a,d);a.setBlendFunctionSeparate(770,771,1,771);c.inverseWindingOrder&&a.setFrontFace(2304);c.transparent?(a.setBlendingEnabled(!0),c.blendModeOneOne?(a.setBlendFunction(1,1),a.setDepthWriteEnabled(!1)):a.setBlendFunctionSeparate(770,771,1,771)):
a.setBlendingEnabled(!1);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(2,2));x(a,c,b);a.setDepthTestEnabled(!0);c.componentIndices&&c.componentColorBuffer&&(c.componentColorBuffer.updateTexture(),c.componentColorBuffer.bind(d,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:1}))};c.prototype.release=function(a,b){a.setPolygonOffsetFillEnabled(!1);a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!1);a.setBlendFunctionSeparate(770,771,1,771);a.setDepthWriteEnabled(!0);
a.setFrontFace(2305)};c.prototype.bindView=function(a,b){a=this.program=u.BindParametersMap.lookup(this.programs,b);var c=this.params,d=b.origin;r.bindView(d,b.view,a);r.bindCamPos(d,b.viewInvTransp,a);c.slicePlaneEnabled&&r.bindSlicePlane(d,b.slicePlane,a);b.shadowMappingEnabled&&b.shadowMap.bindView(a,d)};c.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};c.prototype.getDrawMode=function(){return this.params.wireframe?
1:4};return c}(d),C=function(b){function c(a,c,d,e){void 0===e&&(e=!1);c=b.call(this,a,c,d,a.getParams().textureId)||this;c.params=r.copyParameters(a.getParams());c.texturing=a.bufferWriter.vertexBufferLayout.hasField("uv0")?c.params.atlasRegions?"AtlasTextured":"Textured":"none";c.biased=e;c.selectProgram();c.selectSlot();return c}a(c,b);c.prototype.beginSlot=function(a){return a===this.slot};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){this.program=
this.programRep.getProgram(y.depthPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,shadowMap:this.biased,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:N})};c.prototype.selectSlot=function(){this.slot=this.params.transparent?6:this.params.writeStencil?
2:4};c.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};c.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform1f("size",d.size);c.setUniform2fv("nearFar",b.nearFar);d.inverseWindingOrder&&a.setFrontFace(2304);r.bindVerticalOffset(d.verticalOffset,b,c);r.bindScreenSizePerspective(d.screenSizePerspective,b,c);z(c,d);this.bindTexture(a,c);x(a,d,
b);a.setDepthTestEnabled(!0)};c.prototype.release=function(a){var b=this.params;a.setFaceCullingEnabled(!1);b.inverseWindingOrder&&a.setFrontFace(2305)};c.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=b.origin;r.bindView(d,b.view,a);c.slicePlaneEnabled&&r.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&r.bindCamPos(d,b.viewInvTransp,a)};c.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};c.prototype.getDrawMode=
function(){return this.params.wireframe?1:4};return c}(d),D=function(b){function c(a,c,d){return b.call(this,a,c,d,!0)||this}a(c,b);return c}(C),E=function(b){function c(a,c,d,e){void 0===e&&(e=!1);c=b.call(this,a,c,d,a.getParams().textureId)||this;c.params=r.copyParameters(a.getParams());c.texturing=a.bufferWriter.vertexBufferLayout.hasField("uv0")?c.params.atlasRegions?"AtlasTextured":"Textured":"none";c.selectProgram();c.selectSlot();return c}a(c,b);c.prototype.beginSlot=function(a){return a===
this.slot};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){this.program=this.programRep.getProgram(y.normalPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,compressedNormals:this.params.compressedNormals,transparencyDiscard:this.params.transparent,
alphaCoverageCorrection:N})};c.prototype.selectSlot=function(){this.slot=this.params.transparent?6:this.params.writeStencil?2:4};c.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};c.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform1f("size",d.size);this.bindTexture(a,c);r.bindVerticalOffset(d.verticalOffset,b,c);r.bindScreenSizePerspective(d.screenSizePerspective,
b,c);z(c,d);x(a,d,b);d.inverseWindingOrder&&a.setFrontFace(2304);a.setDepthTestEnabled(!0)};c.prototype.release=function(a){var b=this.params;a.setFaceCullingEnabled(!1);b.inverseWindingOrder&&a.setFrontFace(2305)};c.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=b.origin;r.bindView(d,b.view,a);a.setUniformMatrix4fv("viewNormal",b.viewInvTransp);c.slicePlaneEnabled&&r.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&r.bindCamPos(d,b.viewInvTransp,a)};c.prototype.bindInstance=
function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};c.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return c}(d),G=function(b){function c(a,c,d,e){void 0===e&&(e=!1);c=b.call(this,a,c,d,a.getParams().textureId)||this;c.params=r.copyParameters(a.getParams());c.texturing=a.bufferWriter.vertexBufferLayout.hasField("uv0")?c.params.atlasRegions?"AtlasTextured":"Textured":"none";c.selectProgram();
c.selectSlot();return c}a(c,b);c.prototype.beginSlot=function(a){return a===this.slot};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){this.program=this.programRep.getProgram(y.highlightPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,
transparencyDiscard:this.params.transparent,alphaCoverageCorrection:N})};c.prototype.selectSlot=function(){this.slot=this.params.transparent?6:this.params.writeStencil?2:4};c.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};c.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform1f("size",d.size);this.bindTexture(a,c);r.bindVerticalOffset(d.verticalOffset,
b,c);r.bindScreenSizePerspective(d.screenSizePerspective,b,c);z(c,d);x(a,d,b);d.inverseWindingOrder&&a.setFrontFace(2304);a.setDepthTestEnabled(!0)};c.prototype.release=function(a){var b=this.params;a.setFaceCullingEnabled(!1);b.inverseWindingOrder&&a.setFrontFace(2304)};c.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=b.origin;r.bindView(d,b.view,a);c.slicePlaneEnabled&&r.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&r.bindCamPos(d,b.viewInvTransp,a)};c.prototype.bindInstance=
function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};c.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return c}(d),H=k({size:1,wireframe:!1,textureId:void 0,textureInitTransparent:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,
componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,transparent:!1,polygonOffset:!1,atlasRegions:!1},q.Default),I=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices.position.length};
a.prototype.write=function(a,b,c,d,h){if(n.VertexAttrConstants.AUXPOS1 in b.vertexAttr){var g=b.vertexAttr[n.VertexAttrConstants.AUXPOS1],l=b.indices[n.VertexAttrConstants.AUXPOS1];w(4===g.size);var f=d.getField(n.VertexAttrConstants.AUXPOS1,e.BufferViewVec4f);if(f)t.writeBufferVec4(l,g.data,f,h);else throw Error("unable to aquire view for "+n.VertexAttrConstants.AUXPOS1);}if(n.VertexAttrConstants.AUXPOS2 in b.vertexAttr)if(g=b.vertexAttr[n.VertexAttrConstants.AUXPOS2],l=b.indices[n.VertexAttrConstants.AUXPOS2],
w(4===g.size),f=d.getField(n.VertexAttrConstants.AUXPOS2,e.BufferViewVec4f))t.writeBufferVec4(l,g.data,f,h);else throw Error("unable to aquire view for "+n.VertexAttrConstants.AUXPOS2);t.writeDefaultAttributes(b,c,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,d,h)};return a}(),N=!0,S=Math.pow(2,-52),M=g.vec3f64.create(),P=g.vec3f64.create(),O=g.vec3f64.create(),W=g.vec3f64.create();return p})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/gl-matrix"],function(p,f,k){var a;(a||(a={})).Default={vvSizeEnabled:!1,vvSizeMinSize:k.vec3f32.fromValues(1,1,1),vvSizeMaxSize:k.vec3f32.fromValues(100,100,100),vvSizeOffset:k.vec3f32.fromValues(0,0,0),vvSizeFactor:k.vec3f32.fromValues(1,1,1),vvSizeValue:k.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,
0,0]};return a})},"esri/views/3d/webgl-engine/shaders/PathPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});var b=function(a){return g.glslifyDefineMap({VIEWING_MODE_GLOBAL:"global"===a.viewingMode,VIEWING_MODE_LOCAL:"local"===a.viewingMode,TEXTURING:"none"!==a.textureMode,TEXTURE_ATLAS:"AtlasTextured"===a.textureMode,VERTEXCOLORS:a.vertexColors,
SYMBOLVERTEXCOLORS:a.symbolColors,FLIPV:a.flipV,DOUBLESIDED:a.doubleSided,WINDINGORDERDOUBLESIDED:a.windowOrderDoubleSided,RECEIVE_SHADOWS:a.receiveShadows,RECEIVE_SSAO:a.receiveSSAO,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,SLICE:a.slice,GROUND_NORMAL_SHADING:a.groundNormalShading,COMPRESSED_NORMALS:a.compressedNormals,COMPONENTCOLORS:a.componentColor,TRANSPARENCY_DISCARD:a.transparencyDiscard,ALPHA_COVERAGE_CORRECTION:a.alphaCoverageCorrection,BIAS_SHADOWMAP:a.shadowMap,
WIREFRAME:a.wireframe})};f.colorPass={name:"path-color",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/pathMaterial/colorPass.vert"),fragmentShader:b(e)+a.resolveIncludes("materials/pathMaterial/colorPass.frag")}},attributes:k.Default3D};f.depthPass={name:"path-depth",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/pathMaterial/depthPass.vert"),fragmentShader:b(e)+a.resolveIncludes("materials/pathMaterial/depthPass.frag")}},attributes:k.Default3D};
f.normalPass={name:"path-normal",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/pathMaterial/normalPass.vert"),fragmentShader:b(e)+a.resolveIncludes("materials/pathMaterial/normalPass.frag")}},attributes:k.Default3D};f.highlightPass={name:"path-highlight",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/pathMaterial/highlightPass.vert"),fragmentShader:b(e)+a.resolveIncludes("materials/pathMaterial/highlightPass.frag")}},attributes:k.Default3D}})},
"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/ColorMaterial".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C){p=function(f){function q(){var a=null!==f&&f.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};return a}k(q,f);q.prototype._prepareResources=function(){this._prepareFillResources();this._prepareOutlineResources();this.resolve()};q.prototype._prepareFillResources=function(){var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),b={color:b,transparent:1>b[3]||this._isPropertyDriven("opacity"),
polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new C(b,a+"_colormat");this._context.stage.add(r.ModelContentType.MATERIAL,this._material)};q.prototype._prepareOutlineResources=function(){var a=this.symbol.outline;if(this._hasOutline=!!(a&&a.size&&0<a.size&&a.color))a={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:g.pt2px(a.size),slicePlaneEnabled:this._context.slicePlaneEnabled},this._outlineMaterial=1.5<=a.width?u.createRibbonMaterial(a):
u.createNativeMaterial(a),this._context.stage.add(r.ModelContentType.MATERIAL,this._outlineMaterial)};q.prototype.destroy=function(){f.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(r.ModelContentType.MATERIAL,this._material.id),this._material=null);this._outlineMaterial&&(this._context.stage.remove(r.ModelContentType.MATERIAL,this._outlineMaterial.id),this._outlineMaterial=null)};q.prototype.createGraphics3DGraphic=function(a){var b=a.graphic,
c=b.geometry.type;if("polyline"!==c&&"polygon"!==c&&"extent"!==c)return this._logWarning("unsupported geometry type for fill symbol: "+c),null;if(!this._validateGeometry(b.geometry))return null;c="graphic"+b.uid;a=this._getVertexOpacityAndColor(a.renderingInfo,Uint8Array,255);var d=this.getGraphicElevationContext(b);return"on-the-ground"===d.mode?this._createAsOverlay(b,a,d,c):this._createAs3DShape(b,a,d,c,b.uid)};q.prototype.layerOpacityChanged=function(){var a=this._material.getColor(),b=this._getMaterialOpacity();
this._material.setColor([a[0],a[1],a[2],b]);this._material.setTransparent(1>b||this._isPropertyDriven("opacity"));this._outlineMaterial&&(a=this._outlineMaterial.getColor(),a={color:[a[0],a[1],a[2],this._getOutlineOpacity()]},this._outlineMaterial.setParameterValues(a));return!0};q.prototype.layerElevationInfoChanged=function(a,b,c){var d=this._elevationContext.mode;if(null==c||null==d)return!1;if("on-the-ground"===c&&"on-the-ground"===d)return!0;if(c!==d&&("on-the-ground"===c||"on-the-ground"===
d))return!1;var e=n.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,b,function(){return e})};q.prototype.slicePlaneEnabledChanged=function(a,b){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._outlineMaterial&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};q.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=
a+b/2,c.add(this._material.id));this._outlineMaterial&&(this._outlineMaterial.renderPriority=a,c.add(this._outlineMaterial.id))};q.prototype._createAs3DShape=function(a,b,c,d,e){var g=this._getPolyGeometry(a);a=g.rings;var l=this._getOutlineGeometry(g,a),g=n.getGeometryVertexData3D(l,g.hasZ,g.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,c);H.idHint=d;H.color=b;H.data=g;var f;this._hasOutline&&(f=new g.vertexData.constructor(g.vertexData));
H.outNum=0;H.outGeometries=[];H.outTransforms=[];H.outMaterials=[];this._createAs3DShapeFill(H);H.data.vertexData=f;this._createAs3DShapeOutline(H);this._logGeometryCreationWarnings(H.data,a,"rings","FillSymbol3DLayer");if(0===H.outNum)return null;b=new z({geometries:H.outGeometries,materials:H.outMaterials,transformations:H.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:e},idHint:d});b=new h(this,b,H.outGeometries,null,null,m.perVertexElevationAligner,c);b.alignedTerrainElevation=
g.terrainElevation;b.needsElevationUpdates=n.needsElevationUpdates2D(c.mode);return b};q.prototype._createAs3DShapeFill=function(a){for(var c=a.data.geometryData.polygons,d=a.data.eleVertexData,h=a.data.vertexData,g=function(g){var f=c[g];g=f.count;var k=f.index;if(l._context.clippingExtent&&(n.computeBoundingBox(d,k,g,D),n.boundingBoxClipped(D,l._context.clippingExtent)))return"continue";var m=new Float64Array(d.buffer,3*k*d.BYTES_PER_ELEMENT,3*g),r=new Float64Array(h.buffer,3*k*h.BYTES_PER_ELEMENT,
3*g),f=f.holeIndices.map(function(a){return a-k}),f=b(m,f,3);if(0===f.length)return"continue";n.chooseOrigin(h,k,g,E);n.subtractCoordinates(h,k,g,E);g=l._createFillGeometry(f,0,r,m,a.color);g=new y(g,a.idHint);g.singleUse=!0;m=e.mat4f64.create();e.mat4.translate(m,m,E);a.outGeometries.push(g);a.outMaterials.push(l._material);a.outTransforms.push(m);a.outNum++},l=this,f=0;f<c.length;++f)g(f)};q.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var b=a.data.geometryData.outlines,
c=a.data.eleVertexData,d=a.data.vertexData,h=0;h<b.length;++h){var g=b[h],l=g.index,f=g.count;if(this._context.clippingExtent&&(n.computeBoundingBox(c,l,f,D),n.boundingBoxClipped(D,this._context.clippingExtent)))continue;n.chooseOrigin(d,l,f,E);n.subtractCoordinates(d,l,f,E);g=new Float64Array(c.buffer,3*l*c.BYTES_PER_ELEMENT,3*f);l=new Float64Array(d.buffer,3*l*d.BYTES_PER_ELEMENT,3*f);l=u.createPolylineGeometry(l,g,!1,G,0);l=new y(l,a.idHint+"outline"+h);l.singleUse=!0;g=e.mat4f64.create();e.mat4.translate(g,
g,E);a.outGeometries.push(l);a.outMaterials.push(this._outlineMaterial);a.outTransforms.push(g);a.outNum++}};q.prototype._createAsOverlay=function(a,b,c,e){c=this._getPolyGeometry(a);a=c.rings;var h=this._getOutlineGeometry(c,a);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2;this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);c=n.getGeometryVertexDataDraped(h,c.spatialReference,this._context.overlaySR);H.idHint=e;H.color=b;H.data=c;var g;
this._hasOutline&&(g=new c.vertexData.constructor(c.vertexData));H.outNum=0;H.outGeometries=[];H.outBoundingBox=d.empty();this._createAsOverlayFill(H);H.data.vertexData=g;this._createAsOverlayOutline(H);this._logGeometryCreationWarnings(H.data,a,"rings","FillSymbol3DLayer");return 0<H.outNum?new l(this,H.outGeometries,H.outBoundingBox):null};q.prototype._createAsOverlayFill=function(a){for(var c=a.data.vertexData,h=a.data.geometryData.polygons,g=function(g){var f=h[g];g=f.count;var k=f.index,m=new Float64Array(c.buffer,
3*k*c.BYTES_PER_ELEMENT,3*g),f=f.holeIndices.map(function(a){return a-k}),m=b(m,f,3);if(0===m.length)return"continue";n.computeBoundingBox(c,k,g,D);if(n.boundingBoxClipped(D,l._context.clippingExtent))return"continue";d.expand(a.outBoundingBox,D);n.chooseOrigin(c,k,g,E);n.subtractCoordinates(c,k,g,E);n.setZ(c,k,g,l._getDrapedZ());g=e.mat4f64.create();e.mat4.translate(g,g,E);m=l._createFillGeometry(m,k,c,null,a.color);f=new w(m);f.material=l._material;var r=D;f.center=[.5*(r[0]+r[3]),.5*(r[1]+r[4]),
0];f.bsRadius=.5*Math.sqrt((r[3]-r[0])*(r[3]-r[0])+(r[4]-r[1])*(r[4]-r[1]));f.transformation=g;f.name=a.idHint;f.uniqueName=a.idHint+"#"+m.id;a.outGeometries.push(f);a.outNum++},l=this,f=0;f<h.length;++f)g(f)};q.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var b=a.data.vertexData,c=a.data.geometryData.outlines,h=0;h<c.length;++h){var g=c[h],l=g.index,g=g.count;n.computeBoundingBox(b,l,g,D);if(!n.boundingBoxClipped(D,this._context.clippingExtent)){d.expand(a.outBoundingBox,
D);n.chooseOrigin(b,l,g,E);n.subtractCoordinates(b,l,g,E);n.setZ(b,l,g,this._getDrapedZ());g=new Float64Array(b.buffer,3*l*b.BYTES_PER_ELEMENT,3*g);l=e.mat4f64.create();e.mat4.translate(l,l,E);var g=u.createPolylineGeometry(g,null,!0,G,0),f=new w(g);f.material=this._outlineMaterial;var k=D;f.center=[.5*(k[0]+k[3]),.5*(k[1]+k[4]),0];f.bsRadius=.5*Math.sqrt((k[3]-k[0])*(k[3]-k[0])+(k[4]-k[1])*(k[4]-k[1]));f.transformation=l;f.name=a.idHint+"outline";f.uniqueName=a.idHint+"outline#"+g.id;a.outGeometries.push(f);
a.outNum++}}};q.prototype._getOutlineGeometry=function(a,b){return b};q.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*this.symbol.outline.color.a};q.prototype._getOutlineColor=function(){var b=this.symbol.outline.color,c=this._getOutlineOpacity();return t.mixinColorAndOpacity(a.toUnitRGB(b),c)};q.prototype._getPolyGeometry=function(a){a=a.geometry;return"extent"===a.type?c.fromExtent(a):a};q.prototype._createFillGeometry=function(a,b,c,d,e){for(var h=a.length,g=new Uint32Array(h),
l=new Uint32Array(h),f=0;f<h;f++)g[f]=a[f]+b,l[f]=0;a={};b={};a[B.VertexAttrConstants.POSITION]=g;a[B.VertexAttrConstants.COLOR]=l;b[B.VertexAttrConstants.POSITION]={size:3,data:c};b[B.VertexAttrConstants.COLOR]={size:4,data:e};d&&(b.mapPos={size:3,data:d},a.mapPos=g);return new x(b,a)};return q}(q);var D=d.create(),E=e.vec3f64.create(),G=new Float32Array([255,255,255,255]),H={idHint:null,color:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};return p})},
"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/ColorPrograms".split(" "),function(p,f,k,a,g,b,e,c,d,m){function l(a,b){"none"!==b.cullFace?(a.setFaceCullingEnabled(!0),"front"===b.cullFace?a.setCullFace(1028):a.setCullFace(1029)):a.setFaceCullingEnabled(!1)}p=function(a){function b(b,
c){c=a.call(this,c)||this;c.supportsEdges=!0;c.bufferWriter=new u;c.params=d.copyParameters(b,q);return c}k(b,a);b.prototype.getParams=function(){return this.params};b.prototype.getParameterValues=function(){return d.copyParameters(this.params)};b.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)b[c]=a[c];this.notifyDirty("matChanged")};b.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};b.prototype.getColor=function(){return this.params.color};
b.prototype.setTransparent=function(a){this.params.transparent=a;this.notifyDirty("matChanged")};b.prototype.getTransparent=function(){return this.params.transparent};b.prototype.intersect=function(a,b,c,e,h,g,l,f){d.intersectTriangleGeometry(a,b,c,e,h,g,l)};b.prototype.getGLMaterials=function(){return{color:h,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:n}};b.prototype.getAllTextureIds=function(){return[]};return b}(b);var h=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();
return b}k(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(m.colorPass,{vertexColors:this.params.vertexColors,slice:this.params.slicePlaneEnabled})};b.prototype.beginSlot=function(a){var b=4;this.params.transparent&&(b=this.params.writeDepth?6:1===this.params.order?10:2===this.params.order?11:3===this.params.order?12:4===this.params.order?13:9);return a===
b};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("eColor",c.color);l(a,c);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1));c.transparent&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(770,771,1,771));a.setDepthWriteEnabled(c.writeDepth);a.setDepthTestEnabled(c.testDepth)};b.prototype.release=function(a){var b=this.params;a.setPolygonOffsetFillEnabled(!1);b.transparent&&
a.setBlendingEnabled(!1);a.setDepthWriteEnabled(!0);a.setDepthTestEnabled(!0);a.setFaceCullingEnabled(!1)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;d.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&d.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 4};return b}(g),n=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();
return b}k(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(m.colorPass,{vertexColors:this.params.vertexColors,slice:this.params.slicePlaneEnabled})};b.prototype.beginSlot=function(a){return 4===a};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("eColor",
c.color);l(a,c);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1))};b.prototype.release=function(a){a.setPolygonOffsetFillEnabled(!1);a.setFaceCullingEnabled(!1)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;d.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&d.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(){return 4};return b}(g),
q={color:[1,1,1,1],transparent:!1,writeDepth:!0,testDepth:!0,order:0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:"none"},t=a.newLayout().vec3f(e.VertexAttrConstants.POSITION).vec4u8(e.VertexAttrConstants.COLOR),u=function(){function a(){this.vertexBufferLayout=t}a.prototype.allocate=function(a){return t.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[e.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,d,e,h){c.writeDefaultAttributes(b,d,
t,a.transformation,a.invTranspTransformation,e,h)};return a}();return p})},"esri/views/3d/webgl-engine/shaders/ColorPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});var b=function(a){return g.glslifyDefineMap({VERTEX_COLORS:a.vertexColors,SLICE:a.slice})};f.colorPass={name:"color-color",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/color/color.vert"),
fragmentShader:b(e)+a.resolveIncludes("materials/color/color.frag")}},attributes:k.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u){function r(a,b,c){a&&a.forEach(function(a){var d=b(a);d&&c(d,a.graphic)})}var y=[1,1,1,1],x=[0,0,1],z={mode:"relative-to-ground",offset:0},w=[0,0,0,1];return function(l){function f(){var a=null!==l&&l.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}k(f,l);f.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=h.validateSymbolLayerSize(this._getTextSize());if(a){this._logWarning(a);
this.reject();return}}this._anchor="center";this.resolve()};f.prototype.destroy=function(){l.prototype.destroy.call(this);this.isFulfilled()||this.reject()};f.prototype.createGraphics3DGraphic=function(a,b,c,d){void 0===b&&(b={});a=a.graphic;var e=m.placePointOnGeometry(a.geometry);if(!e)return this._logWarning("unsupported geometry type for text symbol: "+a.geometry.type),null;var h=b.text||this.symbol.text;if(!h||1>h.length)return null;null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=
b.needsOffsetAdjustment);var g=this.getGraphicElevationContext(a,b.elevationOffset||0);return this._createAs3DShape(this.symbol,e,h,g,this._context.layer.id+"_label_"+a.uid,a.uid,b,c,d,"polyline"===a.geometry.type)};f.prototype.getGraphicElevationContext=function(a,b){void 0===b&&(b=0);a=l.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(b);return a};f.prototype.layerOpacityChanged=function(){this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");
return!1};f.prototype.layerElevationInfoChanged=function(a,b){var c=this;r(a,b,function(a,b){c.updateGraphicElevationContext(b,a)});return!0};f.prototype.slicePlaneEnabledChanged=function(a,b){var c=this;r(a,b,function(a){var b=0;for(a=a.stageObject.geometryRecords;b<a.length;b++)a[b].material.setParameterValues({slicePlaneEnabled:c._context.slicePlaneEnabled})});return!0};f.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);
b.needsElevationUpdates=m.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};f.prototype._defaultElevationInfoNoZ=function(){return z};f.prototype._createAs3DShape=function(h,l,f,k,r,z,p,B,C,O){var D=p.centerOffset||w,G=p.screenOffset||[0,0],E=p.debugDrawBorder||!1,F=p.translation||[0,0,0],K=p.anchor||this._anchor||"center";this._anchor=K;var L=h.material?a.toUnitRGBA(h.material.color):y,T=h.halo&&h.halo.color&&0<h.halo.size,R=T?a.toUnitRGBA(h.halo.color):y,T=T?g.pt2px(h.halo.size):0,I=
this._getTextSize(h),H=new t(f,{size:I,color:L,font:{family:h.font&&h.font.family?h.font.family:"sans-serif",weight:h.font&&h.font.weight?h.font.weight:"normal",style:h.font&&h.font.style?h.font.style:"normal"},halo:{size:T,color:R}},r),N;B?N=p:e.isCalloutSupport(this.symbolContainer)&&this.symbolContainer.hasVisibleVerticalOffset()&&(N=this.symbolContainer);h={textureId:C?C.textureId:H.id,texCoordScale:C?[1,1]:H.texcoordScale,occlusionTest:!0,screenOffset:G,anchorPos:K,polygonOffset:!0,color:[1,
1,1,1],centerOffsetUnits:p.centerOffsetUnits,debugDrawBorder:E,drawInSecondSlot:!0};N&&N.verticalOffset&&(N=N.verticalOffset,G=N.minWorldLength,E=N.maxWorldLength,h.verticalOffset={screenLength:g.pt2px(N.screenLength),minWorldLength:G||0,maxWorldLength:null!=E?E:Infinity});this._context.screenSizePerspectiveEnabled&&(N=this._context.sharedResources,G=N.screenSizePerspectiveSettings,h.screenSizePerspective=N.screenSizePerspectiveSettingsLabels.overridePadding(T),h.screenSizePerspectiveAlignment=G);
O&&(h.shaderPolygonOffset=1E-4);h.slicePlaneEnabled=this._context.slicePlaneEnabled;O=null;T=JSON.stringify(h);null!=B?(O=B.getMaterial(T),null==O&&(O=new u(h,r),B.addMaterial(T,O))):O=new u(h,r);O=[O];D=q.createPointGeometry(x,F,void 0,C?[0,0]:[H.textWidth,H.textHeight],D,C?[0,0]:null);D=[new n(D,r)];r=m.createStageObjectForPoint(this._context,l,D,O,null,null,k,r,this._context.layer.uid,z,!0);if(null===r)return null;B=new d(this,r.object,D,null==B?O:null,C?null:[H],c.perObjectElevationAligner,k);
B.alignedTerrainElevation=r.terrainElevation;B.needsElevationUpdates=m.needsElevationUpdates2D(k.mode)||"absolute-height"===k.mode;B.getScreenSize=function(a){void 0===a&&(a=b.vec2f64.create());a[0]=C?H.textWidth:H.width;a[1]=C?H.textHeight:H.height;return a};B.metadata={labelText:f,elevationOffset:p.elevationOffset||0};m.extendPointGraphicElevationContext(B,l,this._context.elevationProvider);return B};f.prototype._getTextSize=function(a){return g.pt2px((a||this.symbol).size)||12};return f}(l)})},
"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ../../support/mathUtils ./Texture ./Util ../../../webgl/Texture".split(" "),function(p,f,k,a,g,b){function e(){var a=document.createElement("canvas");a.width=512;a.height=512;return a}function c(a){return"rgb("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"}function d(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"}p=function(){function l(a,b,c,d){void 0===
d&&(d=!0);this._idHint=c;this._text=a;this._textLines=a.split(/\r?\n/);this._params=b;this._haloSize=Math.round(this._params.halo.size);this._autoScale=d}Object.defineProperty(l.prototype,"id",{get:function(){null==this._id&&(this._id=a.idGen.gen(this._idHint));return this._id},enumerable:!0,configurable:!0});l.prototype.getParams=function(){return this._params};l.prototype.getText=function(){return this._text};l.prototype.deferredLoading=function(){return!1};Object.defineProperty(l.prototype,"width",
{get:function(){this._width||(this._width=k.nextHighestPowerOfTwo(this.renderedWidth));return this._width},enumerable:!0,configurable:!0});l.prototype.getWidth=function(){return this.width};Object.defineProperty(l.prototype,"height",{get:function(){this._height||(this._height=k.nextHighestPowerOfTwo(this.renderedHeight));return this._height},enumerable:!0,configurable:!0});l.prototype.getHeight=function(){return this.height};Object.defineProperty(l.prototype,"lineHeight",{get:function(){this._lineHeight||
(this._lineHeight=this._computeLineHeight());return this._lineHeight},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"textWidth",{get:function(){this._textWidth||(this._textWidth=this._computeTextWidth());return this._textWidth},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"textHeight",{get:function(){this._textHeight||(this._textHeight=this._computeTextHeight());return this._textHeight},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"renderedWidth",
{get:function(){this._renderedWidth||(this._renderedWidth=Math.round(this.textWidth*this.scaleFactor));return this._renderedWidth},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"renderedHeight",{get:function(){this._renderedHeight||(this._renderedHeight=Math.round(this.textHeight*this.scaleFactor));return this._renderedHeight},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"scaleFactor",{get:function(){this._scaleFactor||(this._scaleFactor=this._autoScale?Math.min(1,
Math.min(2048/this.textWidth,2048/this.textHeight)):1,this._autoScale&&g.assert(2048>=this.renderedWidth&&2048>=this.renderedHeight));return this._scaleFactor},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"texcoordScale",{get:function(){return[this.renderedWidth/this.width,this.renderedHeight/this.height]},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"fillStyle",{get:function(){this._fillStyle||(this._fillStyle=d(this._params.color));return this._fillStyle},
enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"haloStyle",{get:function(){this._haloStyle||(this._haloStyle=c(this._params.halo.color));return this._haloStyle},enumerable:!0,configurable:!0});l.prototype.initializeThroughRender=function(a,c){var d=this._getTextCanvas();d.width=this._width;d.height=this._height;var e=d.getContext("2d");e.save();c.samplingMode=9987;c.wrapMode=33071;c.flipped=!0;c.preMultiplyAlpha=!0;c.hasMipmap=!0;this.renderText(this._renderedWidth,this._renderedHeight,
e,0,this._height-this._renderedHeight);a=new b(a,c,d);e.restore();return a};l.prototype.setUnloadFunc=function(a){this._unloadFunc=a};l.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)};l.prototype.renderText=function(a,b,c,d,e){void 0===d&&(d=0);void 0===e&&(e=0);b=this.lineHeight*this.scaleFactor;var h=this._haloSize,g=c.textAlign;a=("center"===g?.5*a:"right"===g?a:0)+h;c.save();var l=3>h;if(0<h){var g=h,f=this._getHaloCanvas();f.width=Math.max(512,
this.renderedWidth);f.height=Math.max(512,this.renderedHeight);var k=f.getContext("2d");k.clearRect(0,0,f.width,f.height);this._setFontProperties(k,this._params.size*this.scaleFactor);k.fillStyle=this.haloStyle;k.strokeStyle=this.haloStyle;k.lineJoin=l?"miter":"round";if(l)for(var n=0,q=this._textLines;n<q.length;n++){for(var l=q[n],u=0,t=m;u<t.length;u++){var p=t[u];k.fillText(l,a+h*p[0],h+h*p[1])}g+=b}else for(n=0,q=this._textLines;n<q.length;n++){l=q[n];u=2*h;for(t=0;5>t;t++)k.lineWidth=(.6+.1*
t)*u,k.strokeText(l,a,g);g+=b}c.globalAlpha=this._params.halo.color[3];c.drawImage(f,d,e);f.width=512;f.height=512;c.globalAlpha=1}this._setFontProperties(c,this._params.size*this._scaleFactor);g=e+h;e=0;for(h=this._textLines;e<h.length;e++)l=h[e],c.globalCompositeOperation="destination-out",c.fillStyle="rgb(0, 0, 0)",c.fillText(l,d+a,g),c.globalCompositeOperation="source-over",c.fillStyle=this.fillStyle,c.fillText(l,d+a,g),g+=b;c.restore()};l.preferredAtlasSize=function(){return 512};l.prototype._getTextCanvas=
function(){null==l._textCanvas2D&&(l._textCanvas2D=e());return l._textCanvas2D};l.prototype._getHaloCanvas=function(){null==l._haloCanvas2D&&(l._haloCanvas2D=e());return l._haloCanvas2D};l.prototype._setFontProperties=function(a,b){var c=this._params.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family+", sans-serif";a.textAlign="left";a.textBaseline="top"};l.prototype._computeTextWidth=function(){var a=this._getTextCanvas().getContext("2d");this._setFontProperties(a,this._params.size);for(var b=
0,c=0,d=this._textLines;c<d.length;c++){var e=a.measureText(d[c]).width;e>b&&(b=e)}c=this._params.font;if("italic"===c.style||"oblique"===c.style||"string"===typeof c.weight&&("bold"===c.weight||"bolder"===c.weight)||"number"===typeof c.weight&&600<c.weight)b+=.3*a.measureText("A").width;b+=2*this._haloSize;return b=Math.round(b)};l.prototype._computeLineHeight=function(){return Math.floor(1.275*this._params.size+2*this._haloSize)};l.prototype._computeTextHeight=function(){return this._computeLineHeight()*
this._textLines.length};return l}();var m=[];for(f=0;360>f;f+=22.5)m.push([Math.cos(Math.PI*f/180),Math.sin(Math.PI*f/180)]);return p})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./symbolComplexity","../../support/PromiseLightweight"],function(p,f,k,a,g){return function(b){function e(a,d){var c=b.call(this)||this;c.symbol=a;c.graphics3DSymbol=null;c.referenced=0;a.fetchSymbol().then(function(a){if(c.isRejected())throw Error();
a.id=c.symbol.id;c.graphics3DSymbol=d(a)}).then(function(){if(c.isRejected())throw Error();c.graphics3DSymbol.then(function(){c.isRejected()||c.resolve()},function(a){c.isRejected()||c.reject(a)})}).catch(function(a){c.isRejected()||c.reject(a)});return c}k(e,b);e.prototype.createGraphics3DGraphic=function(a){return this.graphics3DSymbol.createGraphics3DGraphic(a,this)};Object.defineProperty(e.prototype,"complexity",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.complexity:a.emptySymbolComplexity},
enumerable:!0,configurable:!0});e.prototype.layerPropertyChanged=function(a,b){return this.graphics3DSymbol.layerPropertyChanged(a,b)};e.prototype.applyRendererDiff=function(a,b){return this.graphics3DSymbol.applyRendererDiff(a,b)};e.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};e.prototype.setDrawOrder=function(a,b){this.graphics3DSymbol&&this.graphics3DSymbol.setDrawOrder(a,b)};e.prototype.destroy=function(){this.isFulfilled()||
this.reject();this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0};Object.defineProperty(e.prototype,"destroyed",{get:function(){return void 0===this.graphics3DSymbol},enumerable:!0,configurable:!0});return e}(g.Promise)})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/LineCalloutPrograms".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){function h(a,b,c){3===c.length?a.setUniform4f(b,c[0],c[1],c[2],1):a.setUniform4fv(b,c)}p=function(a){function b(c,d){d=a.call(this,d)||this;d.bufferWriter=new r;d.params=m.copyParameters(c,q);d._uniqueMaterialIdentifier=b.uniqueMaterialIdentifier(d.params);return d}k(b,a);Object.defineProperty(b.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});b.prototype.dispose=function(){};b.prototype.getGLMaterials=
function(){return{color:n,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};b.prototype.getAllTextureIds=function(){return[]};b.prototype.intersect=function(a,b,c,d,e,h,g,l){};b.prototype.getParameterValues=function(){return m.copyParameters(this.params)};b.prototype.setParameterValues=function(a){m.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=b.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};b.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||
[0,0],centerOffsetUnits:a.centerOffsetUnits||"world"})};return b}(e);var n=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.isRenderSlot=!0;b.updateParameters();return b}k(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){var a=this.params;this.renderProgram=this.programRep.getProgram(l.program,{occlTest:!!a.occlusionTest,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,
depthHud:!1,depthHudAlignStart:!!a.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});this.depthProgram=this.programRep.getProgram(l.program,{occlTest:!!a.occlusionTest,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,depthHud:!0,depthHudAlignStart:!!a.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled})};b.prototype.beginSlot=function(a){switch(a){case 21:return this.isRenderSlot=
!0;case 22:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(b.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},enumerable:!0,configurable:!0});b.prototype.getProgram=function(){return this.program};b.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]};b.prototype.getDrawMode=function(){return 4};b.prototype.bind=function(a,b){var c=b.cameraAboveGround?1:-1,d=this.program,e=this.params;a.bindProgram(d);d.setUniform1f("cameraGroundRelative",
c);d.setUniform1f("polygonOffset",e.shaderPolygonOffset);d.setUniform4fv("viewport",b.viewport);d.setUniformMatrix4fv("viewNormal",b.viewInvTransp);d.setUniform1i("hudVisibilityTexture",0);a.bindTexture(b.hudVisibilityTexture,0);h(d,"color",e.color);c=b.pixelRatio||1;d.setUniform1f("pixelRatio",c);d.setUniform2f("screenOffset",e.screenOffset[0]*c,e.screenOffset[1]*c);this.bindBorder(a,b);m.bindVerticalOffset(e.verticalOffset,b,d);this.bindSizing(a,b);m.bindScreenSizePerspective(e.screenSizePerspective,
b,d);this.isRenderSlot?this.bindRender(a,b):this.bindHUDDepth(a,b)};b.prototype.bindRender=function(a,b){a.setBlendFunctionSeparate(1,771,770,771);a.setBlendingEnabled(!0);a.setDepthWriteEnabled(!1)};b.prototype.bindHUDDepth=function(a,b){a.setColorMask(!1,!1,!1,!1);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;m.bindView(b.origin,b.view,a);m.bindCamPos(b.origin,b.viewInvTransp,a);c.slicePlaneEnabled&&
m.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.release=function(a,b){this.isRenderSlot?this.releaseRender(a,b):this.releaseHUDDepth(a,b)};b.prototype.releaseRender=function(a,b){a.setBlendingEnabled(!1);a.setBlendFunction(770,771);a.setDepthWriteEnabled(!0)};b.prototype.releaseHUDDepth=function(a,b){a.setColorMask(!0,!0,!0,!0)};
b.prototype.bindSizing=function(a,b){a=this.program;var c=this.params;a.setUniform2f("pixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform1f("lineSize",Math.ceil(c.size)*(b.pixelRatio||1))};b.prototype.bindBorder=function(a,b){a=this.program;var c=this.params;b=b.pixelRatio||1;null!==c.borderColor?(h(a,"borderColor",c.borderColor),a.setUniform1f("borderSize",b)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return b}(b),q={verticalOffset:null,screenSizePerspective:null,
screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},t=g.newLayout().vec3f(c.VertexAttrConstants.POSITION).vec3f(c.VertexAttrConstants.NORMAL).vec2f(c.VertexAttrConstants.UV0).vec4f(c.VertexAttrConstants.AUXPOS1),u=[a.vec2f32.fromValues(0,0),a.vec2f32.fromValues(1,0),a.vec2f32.fromValues(0,1),a.vec2f32.fromValues(1,0),a.vec2f32.fromValues(1,1),a.vec2f32.fromValues(0,1)],r=function(){function a(){this.vertexBufferLayout=
t}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[c.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,e,h,g){d.writePosition(b.indices[c.VertexAttrConstants.POSITION],b.vertexAttr[c.VertexAttrConstants.POSITION].data,a.transformation,h.position,g,6);d.writeNormal(b.indices[c.VertexAttrConstants.NORMAL],b.vertexAttr[c.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,h.normal,g,6);d.writeBufferVec4(b.indices[c.VertexAttrConstants.AUXPOS1],
b.vertexAttr[c.VertexAttrConstants.AUXPOS1].data,h.auxpos1,g,6);for(a=0;a<u.length;++a)h.uv0.setVec(g+a,u[a])};return a}();return p})},"esri/views/3d/webgl-engine/shaders/LineCalloutPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});var b=function(a){return g.glslifyDefineMap({OCCL_TEST:a.occlTest,VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,
DEPTH_HUD:a.depthHud,DEPTH_HUD_ALIGN_START:a.depthHudAlignStart,CENTER_OFFSET_UNITS_SCREEN:a.centerOffsetUnitsScreen,SLICE:a.slice})};f.program={name:"line-callout",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("materials/lineCallout/lineCallout.vert"),fragmentShader:b(e)+a.resolveIncludes("materials/lineCallout/lineCallout.frag")}},attributes:k.Default3D}})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ./graphicUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(p,f,k,a,g,b,e,c,d){function m(a){a=a.graphics3DGraphic.graphic.geometry.type;switch(a){case "polyline":case "polygon":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return r["above-center"];case "mesh":return r["above-center"];default:k.neverReached(a)}}function l(a,b){null==u&&(t.log(a,b),u=g.schedule(function(){u.remove();u=null}))}function h(a,c,d){d=d.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace(B);d=b.vec3f64.fromValues(d[3]-
d[0],d[4]-d[1],d[5]-d[2]);a.centerOffset[0]=1.1*Math.max(d[0],d[1])/2*c.normalizedOffset[0];var e=d[2]/2*c.normalizedOffset[1]+a.translation[2];a.translation[2]=e*(1.1-1);a.elevationOffset=e;d=b.vec3.length(d);a.centerOffset[2]=1.1*d/2*c.normalizedOffset[2]}function n(a){var b=a.labelClass.labelPlacement,d=a.labelSymbol,e=a.graphics3DGraphic,h=c.getGraphics3DSymbol(e.graphics3DSymbol).symbol;a=r[b]||m(a);if("point-3d"===h.type&&h.supportsCallout()&&h.hasVisibleVerticalOffset()&&!e.isDraped())return{placement:null,
hasLabelVerticalOffset:!1,verticalOffset:q(h.verticalOffset),anchor:null,normalizedOffset:null};if(d&&d.hasVisibleVerticalOffset()&&("point-3d"!==h.type||!h.supportsCallout()||!h.verticalOffset||e.isDraped())){a:switch(a.placement){case "above-center":e=!0;break a;default:e=!1}if(e)return{placement:"above-center",verticalOffset:q(d.verticalOffset),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0};l("error","Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+
b+" placement)");return null}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function q(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,maxWorldLength:a.maxWorldLength}}Object.defineProperty(f,"__esModule",{value:!0});var t=a.getLogger("esri.views.3d.layers.graphics.labelPlacement"),u=null;f.get=function(a){var e=n(a);if(!e)return null;var g;if(e.anchor)g=e;else{var f=a.labelClass.labelPlacement,k=r[f];g=k||m(a);f&&!k&&l("warn",
"the requested label placement '"+f+"' is not currently supported in SceneView");f=a.graphics3DGraphic.graphic.geometry.type;k=a.labelClass.labelPlacement;switch(f){case "polyline":case "polygon":case "extent":case "multipoint":k&&(l("warn","the requested label placement '"+g.placement+"' is currently unsupported for '"+f+"' geometries in SceneView"),g=r["center-center"])}}var f=a.graphics3DGraphic._graphics[0],k=f.graphics3DSymbolLayer.getGraphicElevationContext(a.graphics3DGraphic.graphic),q=!!e.hasLabelVerticalOffset,
e={anchor:g.anchor,needsOffsetAdjustment:"draped"===f.type?void 0:k.hasOffsetAdjustment,verticalOffset:e.verticalOffset,screenOffset:b.vec2f64.create(),centerOffset:b.vec4f64.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:b.vec3f64.create(),elevationOffset:0,hasLabelVerticalOffset:q};switch(a.graphics3DGraphic.graphic.geometry.type){case "point":f=a.graphics3DGraphic;k=c.getGraphics3DSymbol(f.graphics3DSymbol).symbol.symbolLayers.getItemAt(0);f.getCenterObjectSpace(e.translation);switch(k.type){case "icon":case "text":k=
a.graphics3DGraphic;f=k._graphics[0].getScreenSize();k.isDraped()?e.hasLabelVerticalOffset||"center"===e.anchor||(r[a.labelClass.labelPlacement]&&l("warn","the requested placement '"+g.placement+"' is currently unsupported for draped graphics"),e.anchor="center"):(k=void 0,void 0===k&&(k=w),a=a.graphics3DGraphic._graphics[0].stageObject.getGeometryRecords()[0].material,a instanceof d?(a=a.getParams().anchorPos,k[0]=2*(a[0]-.5),k[1]=2*(a[1]-.5)):(k[0]=0,k[1]=0),a=k,z[0]=f[0]/2*(g.normalizedOffset[0]-
a[0]),z[1]=f[1]/2*(g.normalizedOffset[1]-a[1]),e.screenOffset[0]=z[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=z[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=z[1]);break;case "object":h(e,g,a)}break;case "mesh":h(e,g,a)}return e};var r={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},
"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},y={"above-center":["default",
"esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};
p=function(a){var b=r[a];y[a].forEach(function(a){r[a]=b})};for(var x in y)p(x);Object.freeze&&(Object.freeze(r),Object.keys(r).forEach(function(a){Object.freeze(r[a]);Object.freeze(r[a].normalizedOffset)}));var z=[0,0],w=[0,0],B=e.create()})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require","exports","./ModelContentType"],function(p,f,k){return function(){function a(a){this.materials={};this.stage=a}a.prototype.getMaterial=function(a){return this.materials[a]};a.prototype.addMaterial=
function(a,b){this.materials[a]=b;this.stage.add(k.MATERIAL,b)};a.prototype.dispose=function(){for(var a in this.materials)this.stage.remove(k.MATERIAL,this.materials[a].id);this.materials={}};return a}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ../../../../core/arrayUtils ../../support/mathUtils ./ModelContentType ./Texture ../../../webgl/Texture".split(" "),function(p,f,k,a,g,b,e){var c={budget:null,repackingEnabled:!0};return function(){function d(a,
c){this.dirty=!1;this.elementsToAdd={};this.elementsToRemove={};this.elementsToRender={};this.elements={};this.stageObjects={};this.id=b.idGen.gen(a);this.stage=c._stage;this.controller=c.resourceController;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");this.stage.add(g.TEXTURE,this);a=this.computeAtlasResolution(c.width,c.height);this.createAtlasRegion(a);this.update2DCanvasSize()}d.prototype.setUnloadFunc=function(a){this.unloadFunc=a};d.prototype.unload=function(){null!=
this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=null)};d.prototype.deferredLoading=function(){return!1};d.prototype.getWidth=function(){return this.atlas.size.width};d.prototype.getHeight=function(){return this.atlas.size.height};d.prototype.initializeThroughRender=function(a,b){var c=this;b.wrapMode=33071;b.samplingMode=9987;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;this.glTexture=new e(a,b,this.canvas);this.frameWorker=this.controller.registerFrameWorker(function(a){return c.run(c.makeRunContext(a))},
function(){return c.dirty});return this.glTexture};d.prototype.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAdd=this.elements=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.glTexture&&(this.glTexture=null,this.stage.remove(g.TEXTURE,this.id))};d.prototype.create2DCanvas=function(){var a=document.createElement("canvas");a.setAttribute("id","canvas2d");a.setAttribute("style","display:none");a.setAttribute("width",(512).toString());a.setAttribute("height",
(512).toString());return a};d.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};d.prototype.generateTextId=function(a){return JSON.stringify(a.getParams())+"_"+a.getText()};d.prototype.createAtlasRegion=function(a){void 0===a&&(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};d.prototype.computeAtlasResolution=function(b,c){b=Math.max(b,c);b=a.nextHighestPowerOfTwo(b+
256);return b=Math.min(b,4096)};d.prototype.resizeAtlas=function(a,b){b=b||a;var c=this.atlas;c.size.width=a;c.size.height=b;this.glTexture&&this.glTexture.resize(a,b);this.update2DCanvasSize()};d.prototype.resetAtlasCursor=function(){var a=this.atlas;a.cursor.x=0;a.cursor.y=0;a.lineHeight=0};d.prototype.getAtlasUsage=function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};d.prototype.getExpectedAtlasUsage=function(){var a=Object.keys(this.elementsToRemove).length,
b=Object.keys(this.elementsToAdd).length,c=Object.keys(this.elements).length;return this.getAtlasUsage()/c*(c+b-a)};d.prototype.addAtlasElement=function(a,b,c,d,e){var h=this.atlas;a.placement.offset.x=h.cursor.x;a.placement.offset.y=h.cursor.y;a.placement.size.width=b;a.placement.size.height=c;a.placement.uvMinMax=[a.placement.offset.x/h.size.width,1-(a.placement.offset.y+c)/h.size.height,(a.placement.offset.x+b)/h.size.width,1-a.placement.offset.y/h.size.height];h.cursor.x+=d;h.lineHeight=Math.max(h.lineHeight,
e)};d.prototype.removeAtlasElement=function(a){if(a&&this.elements[a.textId]){var b=a.placement.offset,c=a.placement.size;this.ctx.clearRect(b.x,b.y,c.width,c.height);delete this.elements[a.textId]}};d.prototype.addStageObject=function(a,b){this.stageObjects[a]||(this.stageObjects[a]=[]);-1===this.stageObjects[a].indexOf(b)&&this.stageObjects[a].push(b)};d.prototype.removeStageObject=function(a,b){this.stageObjects[a]&&k.removeUnordered(this.stageObjects[a],b)&&(b.geometries[0].data.vertexAttributes.size.data=
new Float32Array([0,0]),b.geometryVertexAttrsUpdated(0))};d.prototype.processAdditionRequest=function(a,b){var c=this.atlas,d=a.textId,e=a.textTexture.renderedWidth,g=a.textTexture.renderedHeight,l=e+2,f=g+2+2;b=b.repackingEnabled;if(c.cursor.x+l<c.size.width&&c.cursor.y+f<c.size.height)this.addAtlasElement(a,e,g,l,f),this.elements[d]=a,this.elementsToRender[d]=a,delete this.elementsToAdd[d];else if(c.cursor.y+f+c.lineHeight<c.size.height)c.cursor.x=2,c.cursor.y+=c.lineHeight,c.lineHeight=0,this.addAtlasElement(a,
e,g,l,f),this.elements[d]=a,this.elementsToRender[d]=a,delete this.elementsToAdd[d];else{a=this.getExpectedAtlasUsage();(d=.85<a&&4096>c.size.width)&&this.resizeAtlas(2*c.size.width,2*c.size.height);for(var k in this.elementsToRemove)0===this.stageObjects[k].length&&this.removeAtlasElement(this.elementsToRemove[k]),delete this.elementsToRemove[k];if(!b||!d&&.95<a&&4096===c.size.width)return 0;for(var m in this.elements)c=this.elements[m],c.rendered=!1,this.elementsToAdd[m]=c,delete this.elements[m];
this.resetAtlasCursor();this.elementsToRender={};return 1}return 0};d.prototype.processRenderingRequest=function(a){var b=a.textId;this.ctx.clearRect(a.placement.offset.x,a.placement.offset.y,a.placement.size.width,a.placement.size.height);a.textTexture.renderText(a.placement.size.width,a.placement.size.height,this.ctx,a.placement.offset.x,a.placement.offset.y);for(var c=0,b=this.stageObjects[b];c<b.length;c++){var d=b[c];d.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(a.placement.uvMinMax);
d.geometries[0].data.vertexAttributes.size.data=new Float32Array([a.placement.size.width,a.placement.size.height]);d.geometryVertexAttrsUpdated(0)}a.rendered=!0};d.prototype.run=function(a){if(this.dirty&&this.glTexture){var b=a.budget,c;for(c in this.elementsToAdd)if(this.elements[c]&&this.elements[c].rendered){for(var d=0,e=this.stageObjects[c];d<e.length;d++){var g=e[d],f=g.geometries[0].data.vertexAttributes;f.uv0.data=new Float32Array(this.elements[c].placement.uvMinMax);f.size.data=new Float32Array([this.elements[c].placement.size.width,
this.elements[c].placement.size.height]);g.geometryVertexAttrsUpdated(0)}delete this.elementsToAdd[c]}else if(1===this.processAdditionRequest(this.elementsToAdd[c],a)){a.budget=null;a.repackingEnabled=!1;this.run(a);return}a=!1;for(c in this.elementsToRender){if(b&&!b.remaining()){a&&this.glTexture.setData(this.canvas);return}this.processRenderingRequest(this.elementsToRender[c]);delete this.elementsToRender[c];a=!0}a&&this.glTexture.setData(this.canvas);this.dirty=!1}};d.prototype.makeRunContext=
function(a){void 0===a&&(a=null);c.budget=a;c.repackingEnabled=!0;return c};d.prototype.addTextTexture=function(a,b){var c=this.generateTextId(a);this.elementsToAdd[c]||(this.elementsToAdd[c]={textId:c,placement:{offset:{x:0,y:0},size:{width:0,height:0},uvMinMax:[]},textTexture:a,rendered:!1});this.addStageObject(c,b);delete this.elementsToRemove[c];this.setDirty()};d.prototype.removeTextTexture=function(a,b){a=this.generateTextId(a);this.elementsToRemove[a]=this.elements[a];this.removeStageObject(a,
b)};Object.defineProperty(d.prototype,"textureId",{get:function(){return this.id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isDirty",{get:function(){return this.dirty},enumerable:!0,configurable:!0});d.prototype.setDirty=function(){this.dirty=!0};return d}()})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/projectionUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t){Object.defineProperty(f,"__esModule",{value:!0});var u=c.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");p=function(c){function g(a){a=c.call(this,a)||this;a.tiles=new b;a.tileSize=512;a.disableThrottling=!1;a.idToTile=new Map;a.handles=new e;a.clients=new Set;a.geometryEnginePromise=null;a._dirty=!1;return a}k(g,c);Object.defineProperty(g.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():null},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))u.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.setDirty())}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||
!this.tilingScheme)return null;var a=h.create();t.extentToBoundingRect(this.filterExtent,a,this.tilingScheme.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&(this._set("suspended",a),a||this.setDirty())},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return this.throttledUpdate.hasPendingUpdates()||null!=this.geometryEnginePromise||this._dirty},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"changeId",{get:function(){var a=this._get("changeId")||0;return!this.hasClients||this.suspended?a:a+1},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this.throttledUpdate=d.throttle(this.setDirty,function(){return a.notifyChange("updating")},
1E3,this);var b=this.disableThrottling?function(){return a.setDirty}:this.throttledUpdate;this.handles.add(this.watch(["tilingScheme","tileSize"],function(){return a.tileMeasurements=null},!0));this.handles.add(m.init(this,"changeId",b));this.resourceController&&(this._frameWorker=this.resourceController.registerFrameWorker(function(){return a.update()},function(){return a.needsUpdate()}))};g.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.handles&&
(this.handles.destroy(),this.handles=null)};g.prototype.addClient=function(){var a=this,b=r++;this.clients.add(b);1===this.clients.size&&this.setDirty();return{remove:function(){return a.removeClient(b)}}};g.prototype.removeClient=function(a){this.clients.delete(a);this.hasClients||this.setDirty()};Object.defineProperty(g.prototype,"hasClients",{get:function(){return 0<this.clients.size},enumerable:!0,configurable:!0});g.prototype.setDirty=function(){this.suspended?this.notifyChange("updating"):(this._dirty=
!0,this._frameWorker||this.update())};g.prototype.needsUpdate=function(){return this._dirty&&!this.suspended};g.prototype.update=function(){this._dirty=!1;if(this.tilingScheme&&this.hasClients){this.tileMeasurements||(this.tileMeasurements=new q.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:x}));var a=this.cameraOnSurface.location;this.tileMeasurements.begin(this.viewState.camera,this.focus?this.focus.locationOnSurface:
a,a.z);this.updateTiles(this.subdivideTilesForView(this.getRootTiles()));this.tileMeasurements.end()}else this.tiles.removeAll(),this.idToTile.clear();this.notifyChange("updating")};g.prototype.getRootTiles=function(){var a=this;return this.rootTileIds.map(function(b){return new n.FeatureTileDescriptor3D(b[0],b[1],b[2],a.tilingScheme)})};g.prototype.purgeHorizonTiles=function(a){a.sort(function(a,b){return b.measures.screen.rect[1]-a.measures.screen.rect[1]});h.empty(y);for(var b=0;b<a.length;b++)if(h.expand(y,
a[b].measures.screen.rect),h.height(y)>x)return a.slice(b);return[]};g.prototype.subdivideTilesForView=function(a){a=a.slice();for(var b=[];0<a.length;){var c=a.pop();if(!this.filterExtentRect||h.intersects(this.filterExtentRect,c.extent))this.tileMeasurements.updateTile(c),0!==c.measures.visibility&&(c.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(c.lij[0]+1),a.push.apply(a,c.getChildren())):b.push(c))}return this.purgeHorizonTiles(b)};g.prototype.updateTiles=function(a){for(var b=this,c=
0,d=this.tiles.items;c<d.length;c++)d[c].used=!1;a=a.filter(function(a){var c=b.idToTile.get(a.id);c?(c.copyMeasurementsFrom(a),c.used=!0):b.idToTile.set(a.id,a);return!c});c=this.tiles.items.filter(function(a){if(a.used)return!1;b.idToTile.delete(a.id);return!0});this.tiles.removeMany(c);this.tiles.addMany(a);this.sortTiles()};g.prototype.sortTiles=function(){this.tiles.sort(function(a,b){return a.measures.visibility!==b.measures.visibility?2===a.measures.visibility?-1:1:a.measures.distance-b.measures.distance});
this.tiles.forEach(function(a,b){return a.loadPriority=b})};a([l.property({constructOnly:!0})],g.prototype,"resourceController",void 0);a([l.property({constructOnly:!0})],g.prototype,"renderCoordsHelper",void 0);a([l.property({constructOnly:!0})],g.prototype,"tilingSchemeOwner",void 0);a([l.property({constructOnly:!0})],g.prototype,"cameraOnSurface",void 0);a([l.property({constructOnly:!0})],g.prototype,"focus",void 0);a([l.property({constructOnly:!0})],g.prototype,"viewState",void 0);a([l.property()],
g.prototype,"tiles",void 0);a([l.property()],g.prototype,"tileSize",void 0);a([l.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],g.prototype,"tilingScheme",null);a([l.property()],g.prototype,"filterExtent",null);a([l.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],g.prototype,"filterExtentRect",null);a([l.property({readOnly:!0,dependsOn:["filterExtentRect"]})],g.prototype,"rootTileIds",null);a([l.property({value:!1})],g.prototype,"suspended",null);a([l.property()],
g.prototype,"updating",null);a([l.property({readOnly:!0,dependsOn:["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"]})],g.prototype,"changeId",null);a([l.property({constructOnly:!0})],g.prototype,"disableThrottling",void 0);return g=a([l.subclass()],g)}(l.declared(g));f.FeatureTileTree3D=p;var r=0,y=h.create(),x=10;f.default=p})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require","exports","../../../../geometry/support/aaBoundingRect"],
function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function a(a,b,e,c){void 0===c&&(c=null);this.lij=[0,0,0];this.extent=k.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screen:{rect:k.create()},distance:0,shouldSplit:!1};this.used=!1;c&&this.acquire(a,b,e,c)}a.prototype.acquire=function(g,b,e,c){this.tilingScheme=c;this.id=a.id(g,b,e);this.lij[0]=g;this.lij[1]=b;this.lij[2]=e;c.getExtent(g,b,e,this.extent);this.resolution=c.resolutionAtLevel(g)};
a.prototype.release=function(){this.tilingScheme=null};a.prototype.getChildren=function(g){var b=this.lij[0]+1,e=2*this.lij[1],c=2*this.lij[2];return g?(g[0].acquire(b,e,c,this.tilingScheme),g[1].acquire(b,e+1,c,this.tilingScheme),g[2].acquire(b,e,c+1,this.tilingScheme),g[3].acquire(b,e+1,c+1,this.tilingScheme),g):[new a(b,e,c,this.tilingScheme),new a(b,e+1,c,this.tilingScheme),new a(b,e,c+1,this.tilingScheme),new a(b,e+1,c+1,this.tilingScheme)]};a.prototype.copyMeasurementsFrom=function(a){this.measures.visibility=
a.measures.visibility;this.measures.shouldSplit=a.measures.shouldSplit;this.measures.distance=a.measures.distance;k.set(a.measures.screen.rect,this.measures.screen.rect)};a.id=function(a,b,e){return a+"/"+b+"/"+e};return a}();f.FeatureTileDescriptor3D=p;f.default=p})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../support/geometryUtils".split(" "),
function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function f(b){this.pointOfInterestInMap=[0,0];this.screenRect=a.create();this.tileSize=b.tileSize;this.maxVerticalScreenSize=b.maxVerticalScreenSize;this.renderCoordsHelper=b.renderCoordsHelper;this.tilingScheme=b.tilingScheme;this.visibility=new g.FeatureTileVisibility3D({renderCoordsHelper:b.renderCoordsHelper})}f.prototype.begin=function(b,c,d){this.camera=b;this.z=d;this.pointOfInterestInMap[0]=c.x;this.pointOfInterestInMap[1]=
c.y;a.fromValues(0,0,b.fullWidth,b.fullHeight,this.screenRect);this.visibility.begin(b,d)};f.prototype.end=function(){this.visibility.end()};f.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a);this.updateDistanceMeasure(a)};f.prototype.updateDistanceMeasure=function(b){b.measures.distance=a.distance(b.extent,this.pointOfInterestInMap)};f.prototype.updateScreenMeasure=function(b){var c=d,e=1<<c,h=b.measures.screen.rect;
a.empty(h);for(var g=0,l=b.lij[0]+c,f=b.lij[1]<<c,c=b.lij[2]<<c,k=this.tileSizeWithBias(b),k=k*k,m=!1,n=0;n<e;n++){for(var r=0;r<e&&!(m=this.computeScreenArea(b,l,f+n,c+r,h),g+=m.area,m=g>k&&a.height(h)>this.maxVerticalScreenSize);r++);if(m)break}b.measures.shouldSplit=g>k};f.prototype.tileSizeWithBias=function(a){return 1===a.measures.visibility?this.tileSize*m:this.tileSize};f.prototype.computeScreenArea=function(d,h,g,f,k){var m=l.points;this.projectToScreen(h,g,f,1===d.measures.visibility,m);
a.empty(e);for(d=0;4>d;d++)a.expandPointInPlace(e,m[d]);a.expand(k,e);a.intersection(e,this.screenRect,c);l.screenOverlap=a.area(c)/a.area(e);l.area=b.triangle.areaPoints2d(m[0],m[1],m[2])+b.triangle.areaPoints2d(m[0],m[2],m[3]);return l};f.prototype.projectToScreen=function(a,b,c,d,e){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,b,c,h);this.toRenderCoords(h,0,3,q[0]);this.toRenderCoords(h,2,3,q[1]);this.toRenderCoords(h,2,1,q[2]);this.toRenderCoords(h,0,1,q[3]);d&&(this.projectToPlane(q,
this.camera.frustum.planes[4]),this.projectToPlane(q,this.camera.frustum.planes[3]),this.projectToPlane(q,this.camera.frustum.planes[2]));for(a=0;4>a;a++)this.camera.projectPoint(q[a],e[a])};f.prototype.projectToPlane=function(a,c){for(var d=0;4>d;d++)t[d]=b.plane.signedDistance(c,a[d]);d=Math.max(t[0],t[1],t[2],t[3]);if(0<d)for(c=k.vec3.scale(n,c,-d),d=0;4>d;d++)k.vec3.add(a[d],a[d],c)};f.prototype.toRenderCoords=function(a,b,c,d){n[0]=a[b];n[1]=a[c];n[2]=this.z;this.renderCoordsHelper.toRenderCoords(n,
this.tilingScheme.spatialReference,d);return d};return f}();f.FeatureTileMeasurements3D=p;var e=a.create(),c=a.create(),d=2,m=5,l={points:[k.vec3f64.create(),k.vec3f64.create(),k.vec3f64.create(),k.vec3f64.create()],area:0,screenOverlap:0},h=a.create(),n=k.vec3f64.create(),q=[k.vec3f64.create(),k.vec3f64.create(),k.vec3f64.create(),k.vec3f64.create()],t=[0,0,0,0];f.default=p})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/gl-matrix ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils ../../support/mathUtils".split(" "),
function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function g(a){this.surfaceElevation=0;this.cache=new Map;a=a.renderCoordsHelper;this.frustum=new b.Frustum({renderCoordsHelper:a});this.extendedFrustum=new b.Frustum({renderCoordsHelper:a});this.intersector=new e.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}g.prototype.begin=function(a,b){this.surfaceElevation=b;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>b;this.frustum.update(a);
this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,b)};g.prototype.end=function(){this.cache.clear()};g.prototype.calculate=function(a){if(this.allTilesInvisible)return 0;var b="global"===this.renderCoordsHelper.type&&a.lij[0]>=m&&a.lij[0]<l,c=this.getOrCalculateSingleTileVisibility(a,!b);return 0!==c&&b?this.calculateAggregatedChildrenVisibility(a):c};g.prototype.shortenFrustumFarPlane=function(c){for(var d=c.mutablePoints,e=0,h=b.Frustum.nearFarLineIndices;e<h.length;e++){var g=
h[e],l=g[1],g=d[g[0]];a.vec3.subtract(q,d[l],g);a.vec3.scale(q,q,n);a.vec3.add(d[l],g,q)}c.updatePoints(d)};g.prototype.calculateAggregatedChildrenVisibility=function(a){var b=0,c=this.cache.get(a.id);if(null!=c)return c;c=t.acquire();a.getChildren(c);for(var d=0;d<c.length;d++){var e=this.calculate(c[d]);if(0!==e&&(b=e,2===e))break}t.release(c);this.cache.set(a.id,b);return b};g.prototype.getOrCalculateSingleTileVisibility=function(a,b){var c=this.cache.get(a.id);if(null!=c)return c;c=this.calculateSingleTileVisibility(a);
b&&this.cache.set(a.id,c);return c};g.prototype.calculateSingleTileVisibility=function(a){if(!this.aboveGround&&"global"===this.renderCoordsHelper.type&&a.lij[0]<h){if(0===this.calculateSingleTileVisibilitySided(a,!1))return this.calculateSingleTileVisibilitySided(a,!0)}else return this.calculateSingleTileVisibilitySided(a,this.aboveGround)};g.prototype.calculateSingleTileVisibilitySided=function(a,b){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,b);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?
this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0};g.prototype.updateExtendedFrustum=function(b,e){var h=this.renderCoordsHelper;this.extendedFrustum.update(b);this.shortenFrustumFarPlane(this.extendedFrustum);var g=this.renderCoordsHelper.worldUpAtPosition(b.eye,q);this.aboveGround||a.vec3.negate(g,g);g=d.acos(-a.vec3.dot(g,b.viewForward));this.allTilesInvisible=g>(Math.PI+b.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=g>b.fovY/2)){b=this.extendedFrustumParameters(e);e=this.extendedFrustum.mutablePoints;
for(g=0;4>g;g++){var l=b.pointIndices[g],f=e[l],k=h.getAltitude(f);if(b.needsAltitudeAdjustment(k)){this.renderCoordsHelper.worldUpAtPosition(f,q);switch(l){case 4:case 7:case 0:case 3:c.plane.projectVector(this.extendedFrustum.planes[0],q,q);break;case 5:case 6:case 1:case 2:c.plane.projectVector(this.extendedFrustum.planes[1],q,q)}a.vec3.scale(q,q,b.direction);this.renderCoordsHelper.intersectInfiniteManifold(c.ray.wrap(f,q),b.zWithMargin,f)}}this.extendedFrustum.updatePoints(e);0>a.vec3.dot(this.extendedFrustum.planes[4],
this.frustum.planes[4])&&(h=this.extendedFrustum.mutablePoints,this.aboveGround?(b=[h[1],h[0]],h[0]=b[0],h[1]=b[1]):(b=[h[2],h[3]],h[3]=b[0],h[2]=b[1]),this.extendedFrustum.updatePoints(h))}};g.prototype.extendedFrustumParameters=function(a){return this.aboveGround?this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};g.prototype.extendedFrustumParametersAboveSurface=function(a,c){var d=a-c;return{zWithMargin:d,pointIndices:b.Frustum.planePointIndices.bottom,
direction:-1,needsAltitudeAdjustment:function(a){return a>d}}};g.prototype.extendedFrustumParametersBelowSurface=function(a,c){var d=a+c;return{zWithMargin:d,pointIndices:b.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<d}}};return g}();f.FeatureTileVisibility3D=p;var m=2,l=6,h=12,n=.95,q=a.vec3f64.create(),t=new k(Array,function(a){4!==a.length&&(a[0]=new g.FeatureTileDescriptor3D,a[1]=new g.FeatureTileDescriptor3D,a[2]=new g.FeatureTileDescriptor3D,a[3]=new g.FeatureTileDescriptor3D)},
function(a){a[0].release();a[1].release();a[2].release();a[3].release()});f.default=p})},"esri/views/3d/state/Frustum":function(){define(["require","exports","../../../core/libs/gl-matrix-2/gl-matrix","../support/mathUtils","../support/geometryUtils/frustum"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function b(a){this.frustum=g.create();this.lines=Array(12);this.origin=k.vec3f64.create();this.direction=k.vec3f64.create();this._altitude=null;this.renderCoordsHelper=
a?a.renderCoordsHelper:null;for(a=0;12>a;a++)this.lines[a]={origin:null,direction:k.vec3f64.create(),endpoint:null}}Object.defineProperty(b.prototype,"planes",{get:function(){return this.frustum.planes},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"points",{get:function(){return this.frustum.points},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mutablePoints",{get:function(){return this.frustum.points},enumerable:!0,configurable:!0});b.prototype.update=function(a){g.fromMatrix(a.viewMatrix,
a.projectionMatrix,this.frustum);k.vec3.copy(this.origin,a.eye);k.vec3.copy(this.direction,a.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);this.updateLines()};b.prototype.updatePoints=function(a){for(var b=0;b<this.frustum.points.length;b++)k.vec3.copy(this.frustum.points[b],a[b]);g.recomputePlanes(this.frustum);this.updateLines()};Object.defineProperty(b.prototype,"altitude",{get:function(){return this._altitude},enumerable:!0,configurable:!0});b.prototype.intersectsSphere=
function(a){return g.intersectsSphere(this.frustum,a)};b.prototype.intersectsRay=function(a){return g.intersectsRay(this.frustum,a)};b.prototype.intersectsLineSegment=function(a,b){return g.intersectsLineSegment(this.frustum,a,b)};b.prototype.intersectsPoint=function(a){return g.intersectsPoint(this.frustum,a)};b.prototype.updateLines=function(){for(var a=this.frustum.points,b=0;4>b;b++){var d=b,g=b+4;this.updateLine(this.lines[b],a[d],a[g]);this.updateLine(this.lines[b+4],a[d],3===b?a[0]:a[d+1]);
this.updateLine(this.lines[b+8],a[g],3===b?a[4]:a[g+1])}};b.prototype.updateLine=function(b,c,d){b.origin=c;b.endpoint=d;a.directionFromTo(b.direction,c,d)};b.planePointIndices=g.planePointIndices;b.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return b}();f.Frustum=p;f.default=p})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../core/compilerUtils ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){Object.defineProperty(f,"__esModule",{value:!0});p=.5*Math.PI;var h=p/Math.PI*180,n=p*e.earthRadius,q=.9*e.earthRadius;e=function(){function e(b){this.renderCoordsHelper=b.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:a.vec3f64.create(),direction:a.vec3f64.create()};for(b=0;4>b;b++)this.extent[b]={origin:a.vec3f64.create(),direction:a.vec3f64.create(),cap:{next:null,direction:a.vec3f64.create()}},this.planes[b]=c.plane.create();
this.planes[4]=c.plane.create();this.planes[5]=c.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}e.prototype.update=function(b,d,e,h){void 0===h&&(h=!0);var g=this.extent;this.toRenderBoundingExtent(b,d,e);a.vec3.add(this.center.origin,g[0].origin,g[2].origin);a.vec3.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);h||a.vec3.scale(this.center.direction,this.center.direction,-1);for(e=0;4>e;e++){var l=g[e];
this.renderCoordsHelper.worldUpAtPosition(l.origin,l.direction);var f=g[3===e?0:e+1];l.cap.next=f.origin;m.directionFromTo(l.cap.direction,l.origin,f.origin);c.plane.fromVectorsAndPoint(l.direction,l.cap.direction,l.origin,this.planes[e]);h||a.vec3.scale(l.direction,l.direction,-1)}c.plane.fromVectorsAndPoint(g[0].cap.direction,g[1].cap.direction,g[0].origin,this.planes[4]);h?c.plane.negate(this.planes[4],this.planes[5]):(c.plane.copy(this.planes[4],this.planes[5]),c.plane.negate(this.planes[4],this.planes[4]));
this.maxSpan=Math.max(Math.abs(b[0]-b[2]),Math.abs(b[1]-b[3]));this.maxSpanSpatialReference=d};e.prototype.isVisibleInFrustum=function(a,b){void 0===b&&(b=!1);if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isWGS84?h:n))return!0;if(a.altitude>=q)return this.isVisibleInFrustumGlobal(a)}for(var e=0;e<this.extent.length;e++){var g=this.extent[e];if(!b&&a.intersectsRay(c.ray.wrap(g.origin,g.direction))||a.intersectsLineSegment(c.lineSegment.fromPoints(g.origin,
g.cap.next,z),g.cap.direction))return!0}b=b?this.planes:this.planesWithoutFar;for(e=0;e<a.lines.length;e++)if(g=a.lines[e],d.frustumLineSegment(b,g.origin,g.endpoint,g.direction))return!0;return!1};e.prototype.toRenderBoundingExtentGlobal=function(c,d,e){b.center(c,u);u[2]=e;l.computeLinearTransformation(d,u,r,this.renderCoordsHelper.spatialReference);a.mat4.invert(y,r);g.empty(x);for(var h=0,f=t;h<f.length;h++)for(var k=f[h],n=k.x0,q=k.x1,w=k.y0,k=k.y1,z=0;5>z;z++){var p=z/4;u[0]=m.lerp(c[n],c[q],
p);u[1]=m.lerp(c[w],c[k],p);u[2]=e;l.vectorToVector(u,d,u,this.renderCoordsHelper.spatialReference);a.vec3.transformMat4(u,u,y);g.expandPointInPlace(x,u)}a.vec3.set(this.extent[0].origin,x[0],x[1],x[2]);a.vec3.set(this.extent[1].origin,x[3],x[1],x[2]);a.vec3.set(this.extent[2].origin,x[3],x[4],x[2]);a.vec3.set(this.extent[3].origin,x[0],x[4],x[2]);for(z=0;4>z;++z)a.vec3.transformMat4(this.extent[z].origin,this.extent[z].origin,r)};e.prototype.toRenderBoundingExtentLocal=function(b,c,d){a.vec3.set(this.extent[0].origin,
b[0],b[1],d);a.vec3.set(this.extent[1].origin,b[2],b[1],d);a.vec3.set(this.extent[2].origin,b[2],b[3],d);a.vec3.set(this.extent[3].origin,b[0],b[3],d)};e.prototype.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,b,c);break;case "local":this.toRenderBoundingExtentLocal(a,b,c);break;default:k.neverReached(this.renderCoordsHelper.type)}};e.prototype.isVisibleInFrustumGlobal=function(b){if(0>a.vec3.dot(this.center.direction,
b.direction))return!0;for(var c=0;4>c;c++)if(0>a.vec3.dot(this.extent[c].direction,b.direction))return!0;return!1};return e}();f.FrustumExtentIntersection=e;var t=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],u=a.vec3f64.create(),r=a.mat4f64.create(),y=a.mat4f64.create(),x=g.create(),z=c.lineSegment.create();f.default=e})},"esri/views/3d/layers/support/FeatureTileTree3DDebugger":function(){define("require exports ../../../../Graphic ../../../../core/Handles ../../../../core/watchUtils ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../support/mathUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m){Object.defineProperty(f,"__esModule",{value:!0});var l=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];p=function(){function h(d){var e=this;this.view=d;this.graphics=[];this.handles=new a;this._enabled=!0;this.symbols=l.map(function(a){return new c(new b({material:{color:[a[0],a[1],
a[2],.6]},outline:{color:"black",size:1}}))});this.handles.add([d.featureTiles.addClient(),g.on(d.featureTiles,"tiles","change",function(){return e.update()},function(){return e.update()})])}Object.defineProperty(h.prototype,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!0,configurable:!0});h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.view&&(this.clear(),this.view=null)};h.prototype.update=
function(){var a=this;this.clear();if(this._enabled){var b=this.view.featureTiles,c=b.tilingScheme,h=b.tiles.toArray().sort(function(a,b){return a.loadPriority-b.loadPriority});h.forEach(function(b,g){var l=b.lij,f=l[0],n=l[1],q=l[2],r=c.getExtentGeometry(f,n,q),l=new k({geometry:r,symbol:a.symbols[f%a.symbols.length]}),u=g/(h.length-1);g=m.lerp(0,200,u);var u=m.lerp(20,6,u),t=b.loadPriority>=h.length;b=new k({geometry:r.center,symbol:new e({verticalOffset:{screenLength:40/.75},callout:{type:"line",
color:"white",border:{color:"black"}},symbolLayers:[new d({text:f+"/"+n+"/"+q+" ("+b.loadPriority+")",halo:{color:"white",size:1/.75},material:{color:[g,t?0:g,t?0:g]},size:u/.75})]})});a.graphics.push(l,b);a.view.graphics.addMany([l,b])})}};h.prototype.clear=function(){this.view.graphics.removeMany(this.graphics);this.graphics=[]};return h}();f.FeatureTileTree3DDebugger=p;f.default=p})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/gl-matrix ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/Evented ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t){Object.defineProperty(f,"__esModule",{value:!0});p=function(g){function f(a){a=g.call(this,a)||this;a.propertiesPool=new q.default({camera:t},a);a.lastSeenCameraProjectionValues=new t;a.events=new n.Evented;a.updateQueue=new x;a.processingUpdates=!1;return a}k(f,g);f.prototype.destroy=function(){this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};f.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),
mode:a.viewingMode,spatialReference:a.spatialReference,constraints:new d.default({mode:a.viewingMode})}};Object.defineProperty(f.prototype,"animation",{get:function(){return this.cameraController instanceof m.AnimationController?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==u&&u.copyFrom(a);u.markViewDirty();u.computeUp(this.mode);r.camera=u;this.events.emit("before-camera-change",
r);a=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,u)&&(this.lastSeenCameraProjectionValues.copyFrom(u),y.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",y));a&&a.equivalent(u)||this._set("camera",this.propertiesPool.get("camera").copyFrom(u))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"interacting",{get:function(){return!!this.cameraController&&this.cameraController.isInteractive},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var b=this;this.stopActiveCameraController()?(a&&(a.watch("state",function(c){if(c===l.State.Finished||c===l.State.Stopped)b._set("cameraController",
null),b.updateCamera(function(b){a.onControllerEnd(b)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=l.State.Rejected)},enumerable:!0,configurable:!0});f.prototype.switchCameraController=function(a){this.cameraController=a;return a.state!==l.State.Rejected};f.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};f.prototype.cameraChanged=function(){this.updateCamera(function(){})};f.prototype.updateCamera=
function(a){this.updateQueue.enqueue(a);this.processUpdateQueue()};f.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.dequeue();u.copyFrom(this._get("camera"));a(u);this.camera=u;this.processingUpdates=!1;this.processUpdateQueue()}};f.prototype.createInitialCamera=function(a){return"global"===a?new t(e.vec3f64.fromValues(4*h.earthRadius,0,0),e.vec3f64.fromValues(h.earthRadius,0,0),e.vec3f64.fromValues(0,
0,1)):new t(e.vec3f64.fromValues(0,0,100),e.vec3f64.fromValues(0,0,0),e.vec3f64.fromValues(0,1,0))};f.prototype.cameraProjectionChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==b.padding[3]?!0:!1};a([b.property({readOnly:!0,type:c,dependsOn:["cameraController"]})],
f.prototype,"animation",null);a([b.property({type:t})],f.prototype,"camera",null);a([b.property({constructOnly:!0})],f.prototype,"constraints",void 0);a([b.property({readOnly:!0})],f.prototype,"events",void 0);a([b.property({readOnly:!0,dependsOn:["isLocal"]})],f.prototype,"isGlobal",null);a([b.property({readOnly:!0,dependsOn:["mode"]})],f.prototype,"isLocal",null);a([b.property({constructOnly:!0})],f.prototype,"mode",void 0);a([b.property({constructOnly:!0})],f.prototype,"spatialReference",void 0);
a([b.property({readOnly:!0,dependsOn:["cameraController"]})],f.prototype,"interacting",null);a([b.property()],f.prototype,"cameraController",null);return f=a([b.subclass()],f)}(b.declared(g));f.ViewState=p;var u=new t,r={camera:null},y={camera:null},x=function(){function a(){this.data=[];this.length=this.ptr=0}a.prototype.enqueue=function(a){this.data.push(a);this.length++};a.prototype.dequeue=function(){if(0===this.length)return null;var a=this.data[this.ptr++];this.length--;0===this.length&&(this.ptr=
this.data.length=0);return a};return a}();f.default=p})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ObjectPool","../../../core/accessorSupport/watch"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function g(b,e){var c=this;this.owner=e;this.properties={};this.afterDispatchHandle=null;for(var d in b)e=new k(b[d],null,null,2,2),this.properties[d]={pool:e,acquired:[]};this.afterDispatchHandle=a.afterDispatch(function(){return c.release()})}
g.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);this.owner=null};g.prototype.get=function(a){var b=this.owner._get(a);a=this.properties[a];var c=a.pool.acquire();for(a.acquired.push(c);c===b;)a.acquired.push(c),c=a.pool.acquire();return c};g.prototype.release=function(){for(var b in this.properties){for(var e=this.properties[b],c=0,d=0,g=e.acquired;d<g.length;d++){var l=g[d];a.isValueInUse(l)?e.acquired[c++]=l:e.pool.release(l)}e.acquired.length=
c}};return g}();f.PropertiesPool=p;f.default=p})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/Extent ../../../geometry/Point ../../../geometry/ScreenPoint ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H,I,N,S){Object.defineProperty(f,"__esModule",{value:!0});var M=l.getLogger("esri.views.3d.state.ViewStateManager");p=function(c){function l(a){a=c.call(this)||this;a.propertiesPool=new H.default({frustum:C.default},a);a.handles=new m;a.cameraSetByUser=!1;a.internalSetOrder=[];a.immediateGoToPromise=null;a.animatedGoToPromise=null;a.ready=!1;return a}a(l,c);Object.defineProperty(l.prototype,"camera",{get:function(){return this.ready?G.internalToExternal(this.view,
this.view.state.camera):this._get("camera")},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(G.externalToInternal(this.view,a),{applyConstraints:!1})||M.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",a)||(a?this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),
{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.forceUpdate():M.error("#center\x3d","Invalid center",a):M.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):M.error("#center\x3d","Center may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"extent",{get:function(){return this.ready?G.toExtent(this.view,null,
null,null,Q):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||M.error("#extent\x3d","Invalid extent",a):M.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):M.error("#extent\x3d","Extent may not be null or undefined"))},enumerable:!0,configurable:!0});
Object.defineProperty(l.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");var a=this.view.pointsOfInterest.centerOnContent;
return G.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||M.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var a=this.view.state.camera.padding,b=this._get("padding");return null!==b&&b.top===a[0]&&b.right===a[1]&&b.bottom===a[2]&&b.left===
a[3]?b:{top:a[0],right:a[1],bottom:a[2],left:a[3]}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(a?t.vec4.set(F,a.top||0,a.right||0,a.bottom||0,a.left||0):t.vec4.set(F,0,0,0,0),this.view.state.updateCamera(function(a){a.padding=F}))},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"screenCenter",{get:function(){var a=this.padding;return new y((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});
Object.defineProperty(l.prototype,"viewpoint",{get:function(){return this.ready?I.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),{applyConstraints:!a.camera})||M.error("#viewpoint\x3d","Invalid viewpoint",a);else{var b=a.camera?a.camera.position:a.targetGeometry,b=b&&b.spatialReference;M.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+
(b?b.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else M.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"zoom",{get:function(){return this.ready?G.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||M.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});l.prototype.initialize=
function(){var a=this;this.handles.add(this.view.watch("state.camera",function(b){return a.cameraChangedSync(b)},!0),n.on(this.view,"state.events","before-camera-change",function(b){return a.beforeCameraChangeHandle(b.camera)}));n.once(this.view,"state.camera",function(b){return a.updateCameraAboveGround(b)});this.handles.add(this.view.on("resize",function(b){return a.handleResize(b.width,b.height)}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(K);
a.cancelImmediateGoTo()}));this.handles.add(n.on(this.view,"state.events","camera-projection-changed",function(){return a.notifyChange("scale")}))};l.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};l.prototype.init=function(){var a=this;this.constraintsManager=new B.default({view:this.view});this.handleResize(this.view.width,this.view.height);var b=this.getInitialProperties();this.cameraSetByUser=
!1;this._set("ready",!0);for(var c=0;c<b.length;c++){var d=b[c];this.set(d.name,d.value)}this.cameraSetByUser||((b=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(b)?this.setInitialView(b):"local"===this.view.state.mode&&this.handles.add(n.whenOnce(this.view.basemapTerrain,"ready",function(){a.handles.remove(K);a.setInitialView(a.view.groundExtent)}),K))};l.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),
this.cancelAnimatedGoTo(),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(K),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};l.prototype.goTo=function(a,b){b=k({animate:!0},b);return b.animate?this.goToAnimated(a,b):this.goToImmediate(a,b)};l.prototype.debugSetCameraOnContent=function(){this.setStateCamera(w.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};
l.prototype.step=function(a){var b=this.view.state,c=b&&this.view.state.cameraController;c&&(b.updateCamera(function(b){c.stepController(a,b)}),c.steppingFinished&&c.finishController())};l.prototype.cancelImmediateGoTo=function(){var a=this.immediateGoToPromise;a&&(this.immediateGoToPromise=null,a.cancel())};l.prototype.cancelAnimatedGoTo=function(){var a=this.animatedGoToPromise;a&&(this.animatedGoToPromise=null,a.cancel())};l.prototype.getInitialProperties=function(){for(var a=this,b=new Set,c=
[],d=0,e=O;d<e.length;d++){var h=e[d],g=h.propertyName,h=h.overrides,l=b.has(g),f=this._isOverridden(g);!l&&f&&c.push({name:g,value:this._get(g)});this._clearOverride(g);(l||f)&&h.forEach(function(a){return b.add(a)})}return c.sort(function(b,c){b=a.internalSetOrder.indexOf(b.name);c=a.internalSetOrder.indexOf(c.name);return b<c?-1:b>c?1:0})};l.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser)if(a instanceof b)this.setStateCamera(G.externalToInternal(this.view,a),{applyConstraints:!1});
else if(a instanceof e)if(a.targetGeometry instanceof u){var c=G.fromExtent(this.view,a.targetGeometry,0,.5,G.OrientationMode.LOCKED);this.setStateCamera(G.externalToInternal(this.view,c),{applyConstraints:!0})}else c={applyConstraints:!a.camera},a=this.viewpointToCamera(a),this.setStateCamera(a,c);else c=G.fromExtent(this.view,a,0,.5,G.OrientationMode.LOCKED),this.setStateCamera(G.externalToInternal(this.view,c),{applyConstraints:!0})};l.prototype.updatePropertyBeforeReady=function(a,b){if(this.ready)return!1;
this._override(a,b);var c=this.internalSetOrder.indexOf(a);-1!==c&&(this.internalSetOrder=this.internalSetOrder.splice(c,1));b&&(this.internalSetOrder.push(a),-1!==P.indexOf(a)&&this._override("hasInitialView",!0));return!0};l.prototype.isCompatible=function(a){return a?a instanceof e?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof b?this.isCompatible(a.position):a.spatialReference&&x.canProject(a.spatialReference,this.view.spatialReference):!1};l.prototype.getPreservingHeadingTilt=
function(a){void 0===a&&(a=W);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};l.prototype.centerPointAtDistanceToCamera=function(a,b,c){void 0===c&&(c=J);var d=this.getPreservingHeadingTilt();return(a=G.getObserverForPointAtDistance(this.view,d.heading,d.tilt,a,b,G.OrientationMode.ADJUST))?(c.copyFrom(this.view.state.camera),c.eye=a.eye,c.center=a.center,c.up=a.up,c):null};l.prototype.centerToCamera=function(a){var b=this.view.pointsOfInterest.centerOnContent;
b.forceUpdate();return this.centerPointAtDistanceToCamera(a,b.distance)};l.prototype.extentToCamera=function(a){var b=this.getPreservingHeadingTilt();a=G.fromExtent(this.view,a,b.heading,b.tilt,G.OrientationMode.ADJUST,Q);return G.externalToInternal(this.view,a)};l.prototype.scaleToCamera=function(a){if(null==a)return null;var b=this.view.pointsOfInterest.centerOnContent;b.forceUpdate();var c=b.renderLocation;a=G.scaleToDistance(this.view,a,b.location.latitude);return this.centerPointAtDistanceToCamera(c,
a)};l.prototype.zoomToCamera=function(a){return this.scaleToCamera(G.zoomToScale(this.view,a))};l.prototype.viewpointToCamera=function(a){return(a=I.toCamera(this.view,a))?G.externalToInternal(this.view,a):null};l.prototype.setStateCamera=function(a,b){var c=this;if(!a||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(d){d.copyFrom(a);b.applyConstraints&&z.applyAll(c.view,d)});b.applyConstraints||(this.view.state.cameraController=
new E.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};l.prototype.handleResize=function(a,b){var c=this.view.canvas;!c||c.width===a&&c.height===b||(c.width=a,c.height=b);this.view.state&&(c=this.view.state.camera,c.fullWidth!==a||c.fullHeight!==b)&&(J.copyFrom(c),J.fullWidth=a,J.fullHeight=b,this.view.state.camera=J)};l.prototype.beforeCameraChangeHandle=function(a){this.updateCameraAboveGround(a)};l.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};
l.prototype.updateCameraAboveGround=function(a){var b=this.view.basemapTerrain,c=this.view.renderCoordsHelper.getAltitude(a.eye),b=b&&b.spatialReference?w.surfaceElevationBelowEye(this.view,a):0;a.relativeElevation=c-b};l.prototype.createGoToCamera=function(a){var c=this;return n.whenOnce(this,"ready",null,!0).then(function(){return I.create(c.view,a)}).then(function(h){var g=!!(a instanceof e&&a.camera||a instanceof b),l=h.camera;if(!c.isCompatible(l))throw h=(h=l.position)&&h.spatialReference,new d("goto:incompatible-spatialreference",
"Resulting camera has an incompatible spatial reference (camera: "+(h?h.wkid:"none")+", view: "+c.view.spatialReference.wkid+")",{camera:l});l=G.externalToInternal(c.view,l);if(!l)throw new d("goto:invalid-camera","Resulting camera is invalid");return{viewpoint:h,camera:l,isFullySpecified:g}})};l.prototype.cancellableGoTo=function(a){var b=this,c;return h.create(function(b,d){c={resolve:b,reject:d};a.asyncResult=c},function(){b.view.state.cameraController===a&&a.active&&a.asyncResult===c&&a.stopController()})};
l.prototype.goToImmediate=function(a,b){var c=this;this.cancelAnimatedGoTo();this.cancelImmediateGoTo();var e=this.createGoToCamera(a).then(function(a){c.immediateGoToPromise===e&&(c.immediateGoToPromise=null);c.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified})}).catch(function(a){c.immediateGoToPromise===e&&(c.immediateGoToPromise=null);a instanceof d&&a.message&&M.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));throw a;});return this.immediateGoToPromise=
e};l.prototype.goToAnimatedBeforeReady=function(a,b){var c=this;this.cancelAnimatedGoTo();var e=n.whenOnce(this.view,"ready").then(function(){if(e===c.animatedGoToPromise)return c.animatedGoToPromise=null,c.goToAnimated(a,b);throw new d("view:goto-cancelled","Cancelled");});return this.animatedGoToPromise=e};l.prototype.goToAnimated=function(a,b){var c=this;this.cancelAnimatedGoTo();if(!this.ready)return this.goToAnimatedBeforeReady(a,b);var e=this.view.state.cameraController,g;e instanceof D.PointToPointAnimationController&&
(e.updateStateFromViewAnimation(),e.active&&(g=e));null==g&&(g=new D.PointToPointAnimationController(this.view.state,this.view.sceneIntersectionHelper));var l=g.viewAnimation;a=this.createGoToCamera(a);var f=a.then(function(a){return a.viewpoint});l.update(f);if(g!==e&&!this.view.state.switchCameraController(g))return l.stop(),M.error("#goTo()","Cannot start an animation while interacting"),h.reject(new d("view:goto-cannot-interrupt","Cannot start an animation while interacting"));var k=l.target,
m=function(){return c.view.state.cameraController===g&&g.viewAnimation.target===k&&g.active};a.then(function(a){var d=a.viewpoint,e=a.camera;a=a.isFullySpecified;if(m()){g.viewAnimation.update(d);k=g.viewAnimation.target;var h;a?(h=new E.SurfaceCollisionCorrectionController({view:c.view,desiredCamera:e}),z.applySurfaceCollision(c.view,e,1)):z.applyAll(c.view,e);g.begin(e,c.internalAnimateOptions(b));return l.when().then(function(){var a=c.view.state.cameraController;h&&(a&&a.active?a instanceof D.PointToPointAnimationController&&
a.viewAnimation.target===k&&(c.view.state.cameraController=h):g.viewAnimation.target===k&&(c.view.state.cameraController=h))})}}).catch(function(a){a instanceof d&&a.message&&M.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));if(m())throw c.view.state.cameraController.stopController(),a;});return this.cancellableGoTo(g)};l.prototype.internalAnimateOptions=function(a){var b={};a&&(null!=a.speedFactor&&(b.speedFactor=a.speedFactor),null!=a.duration&&
(b.duration=a.duration/1E3),null!=a.maxDuration&&(b.maxDuration=a.maxDuration/1E3),null!=a.easing&&(b.easing="string"===typeof a.easing?S.named[a.easing]:a.easing));return b};g([q.property({type:b,dependsOn:["view.state.camera","ready"]})],l.prototype,"camera",null);g([q.property({type:r,dependsOn:["view.pointsOfInterest.centerOnContent.location","ready"]})],l.prototype,"center",null);g([q.property({type:u,dependsOn:["view.state.camera","ready"]})],l.prototype,"extent",null);g([q.property({readOnly:!0,
dependsOn:["view.state.camera","ready"]})],l.prototype,"frustum",null);g([q.property({readOnly:!0,dependsOn:["view.map.initialViewProperties?.viewpoint"]})],l.prototype,"hasInitialView",null);g([q.property({readOnly:!0,type:Boolean})],l.prototype,"ready",void 0);g([q.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],type:Number})],l.prototype,"scale",null);g([q.property({dependsOn:["view.state.camera","ready"]})],l.prototype,"padding",null);g([q.property({readOnly:!0,
dependsOn:["view.width","view.height","padding"]})],l.prototype,"screenCenter",null);g([q.property({constructOnly:!0})],l.prototype,"view",void 0);g([q.property({type:e,dependsOn:["camera","ready"]})],l.prototype,"viewpoint",null);g([q.property({type:Number,dependsOn:["scale"]})],l.prototype,"zoom",null);return l=g([q.subclass("esri.views.3d.state.ViewStateManager")],l)}(q.declared(c));f.ViewStateManager=p;var P="camera viewpoint extent scale center zoom".split(" "),O=[{propertyName:"camera",overrides:["viewpoint"]},
{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"center",overrides:[]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],W={heading:0,tilt:0},Q=new b,J=new N,F=t.vec4f64.create(),K="pending-initial-view";f.default=p})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint ../support/mathUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n){Object.defineProperty(f,"__esModule",{value:!0});p=function(g){function f(a){var c=g.call(this)||this;c.handles=new b;c.nearFarHeuristic=l.createNearFarHeuristic(a.view.state.mode,a.view.basemapTerrain,a.view.renderCoordsHelper.spatialReference);return c}k(f,g);f.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),this.view.watch("constraints.clipDistance.mode",
function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(b){return a.cameraUpdateNearFar(b.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)]);this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)]);this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},!0),this.view.watch("constraints.tilt.mode",
function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)]);this.handles.add(this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],function(){return a.updateCollision()},!0));this.view.state.isLocal&&this.handles.add(e.init(this.view,"dataExtent",function(b){return a.updateLocalSurfaceDistance(b)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();this.updateTilt();this.updateCollision();
this._set("surfaceCollisionConstraint",new h.default({view:this.view}))};f.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};f.prototype.handleClipDistanceNearFarChanged=function(){var a=this,b=this.view.constraints&&this.view.constraints.clipDistance;b&&"auto"!==b.mode&&this.view.state.updateCamera(function(c){a.cameraUpdateNearFarManual(c,
b);return!0})};f.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};f.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(b){a.cameraUpdateNearFar(b);return!0})};f.prototype.cameraUpdateNearFar=function(a){var b=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(b?b.mode:"auto")?this.cameraUpdateNearFarManual(a,b):this.cameraUpdateNearFarAuto(a,b)};f.prototype.cameraUpdateNearFarAuto=function(a,b){this.nearFarHeuristic.compute(a.eye,
a.center,this.view.dataExtent,m.surfaceElevationBelowEye(this.view,a),a);b&&b.autoUpdate(a.near,a.far)};f.prototype.cameraUpdateNearFarManual=function(a,b){b&&(a.near=b.near,a.far=b.far)};f.prototype.updateCollision=function(){var a=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,b=this.view.constraints&&this.view.constraints.collision.enabled,a=a?"stay-above"===a.type:b,b=this.view.state.constraints.collision;a!==b.enabled&&((b.enabled=a)&&this.reapplyConstraints(8),
(a=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==a.mode||this.updateTiltAuto(a))};f.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};f.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};f.prototype.handleTiltModeChanged=function(){this.updateTilt()};f.prototype.handleTiltMaxChanged=function(){var a=
this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())};f.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto(a);this.reapplyConstraints()};f.prototype.updateTiltManual=function(a){var b=this.view.state.constraints;b.tilt=b.createConstantMaxTilt(n.deg2rad(a.max))};f.prototype.updateTiltAuto=function(a){a=this.view.state.constraints;
a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()};f.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var b=this.view.state.constraints;b.tilt&&(b=b.tilt(this.view.state.camera.distance).max,a.autoUpdate(n.rad2deg(b)))}};f.prototype.updateLocalSurfaceDistance=function(a){var b=Math.max(a.width,a.height);0>=b||(a.hasZ&&(b=Math.max(b,a.zmax-a.zmin)),a=this.view.state,b=3*b/Math.atan(a.camera.fov/2),b!==a.constraints.distance&&
(a.constraints.distance=b))};f.prototype.reapplyConstraints=function(a){var b=this;void 0===a&&(a=15);this.view.state.updateCamera(function(c){return d.applyAll(b.view,c,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})})};a([c.property({constructOnly:!0})],f.prototype,"view",void 0);a([c.property({readOnly:!0})],f.prototype,"surfaceCollisionConstraint",void 0);return f=a([c.subclass("esri.views.3d.state.ConstraintsManager")],
f)}(c.declared(g));f.ConstraintsManager=p;f.default=p})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/scaleUtils ../support/earthUtils ../support/mathUtils".split(" "),function(p,f,k,a,g,b){function e(a,b,c,d){c=l/c;a/b>c?(d.far=a,d.near=d.far/b):(d.near=c,d.far=d.near*b);return d}Object.defineProperty(f,"__esModule",{value:!0});f.createNearFarHeuristic=function(a,b,e){return"global"===a?new d:new c(b,
e)};var c=function(){function c(b,c){this.elevationProvider=b;this.unitInMeters=a.getMetersPerUnitForSR(c)}c.prototype.compute=function(a,c,d,l,f){f||(f={near:0,far:0});var r=g.earthRadius,u=a[2]*this.unitInMeters,w=u;l=u-l;var y=this.elevationProvider?this.elevationProvider.getElevationBounds():null;y&&(u=0<=l?w-this.unitInMeters*y[0]:this.unitInMeters*y[1]-w);w=Math.max(d.xmax-d.xmin,d.ymax-d.ymin,4*Math.max(d.xmax-d.xmin,d.ymax-d.ymin));k.vec3.subtract(t,c,a);q[0]=0<t[0]?d.xmax:d.xmin;q[1]=0<t[1]?
d.ymax:d.ymin;q[2]=0<t[2]?w/2:-w/2;k.vec3.subtract(q,q,a);k.vec3.normalize(t,t);a=1.1*k.vec3.dot(q,t)*this.unitInMeters;r=Math.sqrt(u*(u+2*r));d=Math.max(d.xmax-d.xmin,d.ymax-d.ymin);c=d*n*this.unitInMeters;u=b.clamp((u-c)/(d*h*this.unitInMeters-c),0,1);u=b.lerp(r,a,u*u*u);u*=Math.max(Math.log(Math.abs(l)),1);u=Math.min(u,Math.max(34064E4,w));u/=this.unitInMeters;return e(u,m,this.unitInMeters,f)};return c}(),d=function(){function a(){}a.prototype.compute=function(a,c,d,h,l){l||(l={near:0,far:0});
c=g.earthRadius;a=k.vec3.length(a)-c;a=Math.max(Math.abs(a-h),Math.abs(a));h=Math.sqrt(a*(a+2*(c+Math.min(0,h))));a=b.clamp(2E4-(Math.log(a)-7.983)/9.011*19E3,1E3,2E4);return e(1.2*h,a,1,l)};return a}(),m=2E4,l=2,h=.001,n=1E-4,q=k.vec3f64.create(),t=k.vec3f64.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,"__esModule",{value:!0});p=function(g){function l(a){a=g.call(this)||this;a.handles=new b;return a}k(l,g);l.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}))};l.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};l.prototype.handleElevationChangeEvent=function(a){if(this.view.state.cameraController)return!1;
d.eyeWithinExtent(this.view,this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};l.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(b){c.applySurfaceCollision(a.view,b,1)})};a([e.property({constructOnly:!0})],l.prototype,"view",void 0);return l=a([e.subclass("esri.views.3d.state.ElevationCollisionConstraint")],l)}(e.declared(g));f.SurfaceCollisionConstraint=p;f.default=p})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),
function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(c){function d(b){var d=c.call(this)||this;d.handles=new a;d.view=b.view;d.desiredCamera=b.desiredCamera.copy();return d}k(d,c);Object.defineProperty(d.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!0,configurable:!0});d.prototype.onControllerStart=function(a){var b=
this;c.prototype.onControllerStart.call(this,a);this.handles.add(this.view.basemapTerrain.on("elevation-change",function(a){return b.handleElevationChangeEvent(a)}));this.applyCorrection()};d.prototype.onControllerEnd=function(a){this.handles.removeAll();c.prototype.onControllerEnd.call(this,a)};d.prototype.handleElevationChangeEvent=function(a){b.eyeWithinExtent(this.view,this.desiredCamera,a.extent,a.spatialReference)&&this.applyCorrection()};d.prototype.applyCorrection=function(){var a=this;this.view.state.updateCamera(function(b){b.copyViewFrom(a.desiredCamera);
g.applySurfaceCollision(a.view,b,1)||a.constraintEnabled||(a.state=e.State.Stopped)})};return d}(e.CameraController);f.SurfaceCollisionCorrectionController=p})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./geometryUtils ./mathUtils ./projectionUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y){function x(a){return 360-r.cyclicalDeg.normalize(a)}function z(a){return r.cyclicalDeg.normalize(360-a)}function w(a,b){a&&(null==b?a.reject():a.resolve(b));return b}function B(b,c,d,e){if(!c)return w(e);var h=b.spatialReference||a.SpatialReference.WGS84;if(c.camera){b=c.get("camera.position.spatialReference");if(!n.canProject(b,h))return w(e);c=c.camera.clone();b.equals(h)||(c.position=n.project(c.position,h));return w(e,c)}var g=c.get("targetGeometry.spatialReference");
if(g&&!n.canProject(g,h))return w(e);h=t.internalToExternal(b,b.state.camera);g=t.OrientationMode.ADJUST;null!=c.rotation&&(h.heading=x(c.rotation),g=t.OrientationMode.LOCKED);null!=d&&(h.tilt=d);if("point"===c.targetGeometry.type){d=c.targetGeometry;var l=void 0,f=c.targetGeometry.clone(),l=null!=c.scale?t.scaleToDistance(b,c.scale,d.latitude):b.state.camera.distance;return t.fromCenterDistance(b,f,l,h,g,e)}return t.fromExtent(b,c.targetGeometry.extent,h.heading,h.tilt,g,e)}function C(a,b){var c=
b.scale;null==c&&null!=b.zoom&&(c=t.zoomToScale(a,b.zoom));return c}function D(a,b){var c=!1;null!=b.heading?(a.heading=b.heading,c=!0):null!=b.rotation&&(a.heading=x(b.rotation),c=!0);null!=b.tilt&&(a.tilt=b.tilt,c=!0);null!=b.fov&&(a.fov=b.fov);return c}function E(b,c,d){var e=b.spatialReference||a.SpatialReference.WGS84;c=c||t.externalToInternal(b,d.camera);d.targetGeometry=y.vectorToPoint(c.center,b.renderSpatialReference,e);d.scale=t.computeScale(b,c);d.rotation=z(d.camera.heading);return d}
function G(a,b,d){if(b){if(!n.canProject(b.spatialReference,a.spatialReference))throw new c("viewpointutils:incompatible-spatialreference","Spatial reference ("+(b.spatialReference?b.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:b});var h=[];if(!b.hasZ&&a.basemapTerrain){var g=void 0;switch(b.type){case "point":g=b;break;case "multipoint":case "polyline":case "mesh":g=b.extent.center;break;case "extent":g=b.center;break;case "polygon":g=
b.centroid;break;default:e.neverReached(b)}g&&n.canProject(g,a.basemapTerrain.spatialReference)?K[2]=a.basemapTerrain.getElevation(g)||0:K[2]=0}(0,ia[b.type])(b,function(a){h.push(a[0],a[1],a[2])},K);var f=h.length/3;if(0!==f&&(g=Array(h.length),y.bufferToBuffer(h,b.spatialReference,0,g,a.spatialReference,0,f)))for(b.hasZ&&(d.hasZ=!0),a=0;a<g.length;a+=3)b.hasZ?(K[0]=g[a+0],K[1]=g[a+1],K[2]=g[a+2]):(K[0]=g[a+0],K[1]=g[a+1]),l.expand(d.boundingBox,K)}}function H(a,b,c,d){return a.whenViewForGraphic(b).then(function(a){if(a&&
a.whenGraphicBounds)return a.whenGraphicBounds(b,{minDemResolution:c})}).then(function(a){var b=a.boundingBox;l.expand(d.boundingBox,b);a.screenSpaceObjects&&a.screenSpaceObjects.forEach(function(a){d.screenSpaceObjects.push(a)});isFinite(b[2])&&(d.hasZ=!0)}).catch(function(){G(a,b.geometry,d)})}function I(b,c,e,h){if(Array.isArray(c)&&2===c.length){var l=c[0],f=c[1];if("number"===typeof l&&"number"===typeof f)return U.x=l,U.y=f,U.z=void 0,U.spatialReference=a.SpatialReference.WGS84,G(b,U,h),d.resolve()}if(c&&
"function"===typeof c.map)return d.eachAlways(c.map(function(a){return I(b,a,e,h)}));if(c instanceof a.BaseGeometry)try{G(b,c,h)}catch(ha){return d.reject(ha)}else if(c instanceof g)return H(b,c,e,h);return d.resolve()}function N(a,b,c,e){if(b.camera)return d.resolve(S(a,c,b.camera,e));e.scale=b.scale;e.rotation=b.rotation;e.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;e.camera=null;null!=c.heading?e.rotation=z(c.heading):null!=c.rotation&&(e.rotation=c.rotation);b=C(a,c);null!=b&&
(e.scale=b);b=d.createResolver();B(a,e,c.tilt,b);return b.promise.then(function(a){e.camera=a;return e})}function S(a,b,c,d){d.camera=c.clone();d.camera.fov=a.camera.fov;b=a.spatialReference;c=d.camera.position.spatialReference;if(!n.canProject(c,b))return null;c.equals(b)||(d.camera.position=n.project(d.camera.position,b));return E(a,null,d)}function M(b,c,d,e,h){var g=b.renderSpatialReference;y.pointToVector(d.position,ca,g);y.pointToVector(c,Z,g);h.targetGeometry=new a.Point(c);h.camera.position=
new a.Point(d.position);m.vec3.subtract(ba,Z,ca);t.directionToHeadingTilt(b,ca,ba,e.up,h.camera);h.scale=t.distanceToScale(b,m.vec3.distance(ca,Z),h.targetGeometry.latitude);h.rotation=z(h.camera.heading);return h}function P(a,b,c,e){if(!c)return d.reject();e.targetGeometry=c.clone();var h=q.cameraOnContentAlongViewDirection(a);if(b.position)return d.resolve(M(a,e.targetGeometry,b,h,e));if(b.zoomFactor){var g=h.distance/b.zoomFactor,l=m.vec3.scale(K,h.viewForward,-g);m.vec3.add(h.eye,h.center,l);
h.markViewDirty();e.scale=t.distanceToScale(a,g,c.latitude)}t.internalToExternal(a,h,e.camera);g=D(e.camera,b)?t.OrientationMode.LOCKED:t.OrientationMode.ADJUST;return b.zoomFactor?d.resolve(e):(e.scale=C(a,b),null==e.scale&&(y.pointToVector(c,K,a.renderSpatialReference),u.frustum.intersectsPoint(h.frustum,K)?e.scale=t.distanceToScale(a,m.vec3.distance(h.eye,K),c.latitude):e.scale=t.computeScale(a,h)),b=d.createResolver(),t.fromCenterScale(a,e.targetGeometry,e.scale,e.camera,g,b),b.promise.then(function(a){e.camera=
a;return e}))}function O(a,b,c,e){e.targetGeometry=c.clone();var h=q.cameraOnContentAlongViewDirection(a);t.internalToExternal(a,h,e.camera);b=D(e.camera,b)?t.OrientationMode.LOCKED:t.OrientationMode.ADJUST;h=d.createResolver();t.fromExtent(a,c,e.camera.heading,e.camera.tilt,b,h);return h.promise.then(function(a){e.camera=a;return e})}function W(a,b,c,d,e){var h=0;c.hasZ?h=c.z:a.basemapTerrain&&(h=a.basemapTerrain.getElevation(c));m.vec3.set(K,c.x,c.y,h);y.computeLinearTransformation(a.spatialReference,
K,L,a.renderSpatialReference);m.mat3.fromMat4(T,L);m.mat3.transpose(T,T);l.empty(R);c=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var g=0;g<c.length;g++){var f=c[g],k=d[f[2]];isFinite(k)||(k=h);m.vec3.set(K,d[f[0]],d[f[1]],k);y.vectorToVector(K,a.spatialReference,K,a.renderSpatialReference);l.expand(R,m.vec3.transformMat3(K,K,T))}a=l.width(R);d=l.height(R);h=l.depth(R);c=1/Math.tan(b.fovY/2);return Math.max(.5*Math.sqrt(a*a+h*h)*Math.max(c,1/Math.tan(b.fovX/2))+.5*d,.5*d*
c+.5*Math.max(a,h))/e}function Q(a,b,c,e,h,g){g.targetGeometry=c.clone();var l=q.cameraOnContentAlongViewDirection(a);c=W(a,l,c,e,h);t.internalToExternal(a,l,g.camera);b=D(g.camera,b)?t.OrientationMode.LOCKED:t.OrientationMode.ADJUST;g.scale=t.distanceToScale(a,c,g.targetGeometry.latitude);l=d.createResolver();t.fromCenterScale(a,g.targetGeometry,g.scale,g.camera,b,l);return l.promise.then(function(a){g.camera=a;return g})}function J(a,b){if(!b||!a.spatialReference)return null;a={target:null};if("declaredClass"in
b||Array.isArray(b))a.target=b;else{for(var c in b)a[c]=b[c];b.center&&!a.target&&(a.target=b.center)}return a}function F(a){a&&(a.rotation=z(a.camera.heading));return a}Object.defineProperty(f,"__esModule",{value:!0});f.DEFAULT_FRAME_COVERAGE=.66;f.rotationToHeading=x;f.headingToRotation=z;f.toCamera=B;f.fromInternalCamera=function(a,c,d){d||(d=new b({camera:new k}));t.internalToExternal(a,c,d.camera);return E(a,c,d)};f.fromCamera=function(a,c,d){d||(d=new b);d.camera=c.clone();return E(a,null,d)};
f.create=function(e,g){var n=J(e,g);if(!n)return d.reject(new c("viewpointutils-create:no-target","Missing target for creating viewpoint"));var r=new b({camera:new k({fov:e.camera.fov})}),u=null!=n.scale||null!=n.zoom;if(n.target instanceof b)return N(e,n.target,n,r).then(function(a){return F(a)});if(n.target instanceof k)return d.resolve(F(S(e,n,n.target,r)));if(n.target instanceof a.Extent)return g=n.target.xmin===n.target.xmax||n.target.ymin===n.target.ymax,u||g?P(e,n,n.target.center,r).then(function(a){return F(a)}):
O(e,n,n.target,r).then(function(a){return F(a)});var w={boundingBox:l.empty(),hasZ:!1,screenSpaceObjects:[]};g=u?t.scaleToResolution(e,C(e,n)):void 0;return I(e,n.target,g,w).then(function(){if(isFinite(w.boundingBox[0])){l.center(w.boundingBox,K);U.x=K[0];U.y=K[1];U.z=K[2];U.spatialReference=e.spatialReference;var b=void 0;isFinite(U.z)&&w.hasZ?b=l.isPoint(w.boundingBox):(U.z=void 0,b=h.isPoint(l.toRect(w.boundingBox,X)));if(u||b)return P(e,n,U,r);var b=w.screenSpaceObjects,c=f.DEFAULT_FRAME_COVERAGE;
if(b.length){for(var d=Number.NEGATIVE_INFINITY,g=0;g<b.length;g++)var k=b[g].screenSpaceBoundingRect,d=Math.max(d,Math.abs(k[0]),Math.abs(k[1]),Math.abs(k[2]),Math.abs(k[3]));b=c-d/Math.min(e.width,e.height)*2}else b=c;return Q(e,n,U,w.boundingBox,b,r)}if(n.position)return b=q.cameraOnContentAlongViewDirection(e),m.vec3.copy(ba,b.viewForward),t.directionToHeadingTilt(e,b.eye,ba,b.up,da),r.camera.position=new a.Point(n.position),r.camera.heading=null!=n.heading?n.heading:da.heading,r.camera.tilt=
null!=n.tilt?n.tilt:da.tilt,E(e,null,r);b=q.cameraOnContentAlongViewDirection(e);b=y.vectorToPoint(b.center,e.renderSpatialReference,U,e.spatialReference);return P(e,n,b,r)}).then(function(a){return F(a)})};var K=m.vec3f64.create(),L=m.mat4f64.create(),T=m.mat3f64.create(),R=l.create(),X=h.create(),ba=m.vec3f64.create(),ca=m.vec3f64.create(),Z=m.vec3f64.create(),da={heading:0,tilt:0},U=new a.Point,ia={point:function(a,b,c){c[0]=a.x;c[1]=a.y;a.hasZ&&(c[2]=a.z);b(c)},polygon:function(a,b,c){for(var d=
a.hasZ,e=0;e<a.rings.length;e++)for(var h=a.rings[e],g=0;g<h.length;g++)c[0]=h[g][0],c[1]=h[g][1],d&&(c[2]=h[g][2]),b(c)},polyline:function(a,b,c){for(var d=a.hasZ,e=0;e<a.paths.length;e++)for(var h=a.paths[e],g=0;g<h.length;g++)c[0]=h[g][0],c[1]=h[g][1],d&&(c[2]=h[g][2]),b(c)},multipoint:function(a,b,c){var d=a.points;a=a.hasZ;for(var e=0;e<d.length;e++)c[0]=d[e][0],c[1]=d[e][1],a&&(c[2]=d[e][2]),b(c)},extent:function(a,b,c){a.hasZ?(b(m.vec3.set(c,a.xmin,a.ymin,a.zmin)),b(m.vec3.set(c,a.xmax,a.ymin,
a.zmin)),b(m.vec3.set(c,a.xmin,a.ymax,a.zmin)),b(m.vec3.set(c,a.xmax,a.ymax,a.zmin)),b(m.vec3.set(c,a.xmin,a.ymin,a.zmax)),b(m.vec3.set(c,a.xmax,a.ymin,a.zmax)),b(m.vec3.set(c,a.xmin,a.ymax,a.zmax)),b(m.vec3.set(c,a.xmax,a.ymax,a.zmax))):(b(m.vec3.set(c,a.xmin,a.ymin,c[2])),b(m.vec3.set(c,a.xmax,a.ymin,c[2])),b(m.vec3.set(c,a.xmin,a.ymax,c[2])),b(m.vec3.set(c,a.xmax,a.ymax,c[2])))},mesh:function(a,b,c){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)b(m.vec3.set(c,
a[d+0],a[d+1],a[d+2]))}}})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/geometryUtils ../../support/stack ../../webgl-engine/lib/Selector ../../webgl-engine/lib/SelectorUtils".split(" "),function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function c(c,e,g){this.viewingMode=c;this.layerProvider=e;this.viewPropertyProvider=g;this.tmpSelector=new b(this.viewingMode);
this.tmpRay=a.ray.create();this.externalIntersectionHandlers=new Set;this.intersectionTolerance=b.DEFAULT_TOLERANCE;this.validateHUDSelector=new b(this.viewingMode);this.validateHUDSelector.enableHUDSelection=!1}c.prototype.intersectScreen=function(a,b,c){return this.intersectRay(this.getPickRay(a,this.tmpRay),b,c)};c.prototype.intersectScreenFreePointFallback=function(a,b,c){return this.intersectRayFreePointFallback(this.getPickRay(a,this.tmpRay),b,c)};c.prototype.intersectRay=function(a,b,c){c=
this.computeIntersection(a,null,null,!1,c||this.tmpSelector);b=c?(a=c.minResult)?a.getIntersectionPoint(b):!1:!1;return b};c.prototype.intersectRayFreePointFallback=function(a,b,c){return this.intersectRay(a,b,c)||this.intersectRayFreePointLocal(a,b)};c.prototype.intersectSelectorScreen=function(a,b,c,e){void 0===e&&(e=!1);return this.computeIntersection(this.getPickRay(a,this.tmpRay),a,c,e,b)};c.prototype.intersectToolSelectorScreen=function(a,b){var c=this.getPickRay(a,this.tmpRay),d=this.computeIntersection(c,
a,null,!0,b),e=d.minResult;this.viewPropertyProvider.hasOpaqueTerrain()||e.hasIntersectionPoint&&"TerrainRenderer"!==e.intersector||(d=this.computeIntersection(c,a,null,!1,b));return d};c.prototype.setTolerance=function(a){void 0===a&&(a=b.DEFAULT_TOLERANCE);this.intersectionTolerance=a};c.prototype.addIntersectionHandler=function(a){this.externalIntersectionHandlers.add(a)};c.prototype.removeIntersectionHandler=function(a){this.externalIntersectionHandlers.delete(a)};c.prototype.getPickRay=function(b,
c){void 0===c&&(c=a.ray.create());var d=this.viewPropertyProvider.camera();return a.ray.fromScreen(d,b,c)};c.prototype.intersectRayFreePointLocal=function(a,b){if("local"!==this.viewingMode)return!1;var c=this.viewPropertyProvider.extent(),d=Math.max(c.xmax-c.xmin,c.ymax-c.ymin,8*Math.max(c.xmax-c.xmin,c.ymax-c.ymin));if(0===d)return k.vec3.add(b,a.origin,k.vec3.normalize(g.sv3d.get(),a.direction)),!0;var e=this.viewPropertyProvider.camera(),f=Math.max(0,c.xmin-e.eye[0],e.eye[0]-c.xmax),c=Math.max(0,
c.ymin-e.eye[1],e.eye[1]-c.ymax),e=d/Math.max(1,Math.pow(Math.max(0,Math.log(d/(Math.abs(e.relativeElevation)+Number.MIN_VALUE))),2)),e=Math.max(e,Math.min(Math.sqrt(f*f+c*c),d)),d=k.vec3.scale(g.sv3d.get(),a.direction,e/k.vec3.length(a.direction));k.vec3.add(b,a.origin,d);return!0};c.prototype.computeIntersection=function(a,c,l,h,f){var d=this,m=this.viewPropertyProvider.camera(),n=g.sv3d.get();m.projectPoint(a.origin,n);c?k.vec2.copy(c,n):c=n;var r=[],y=[];this.layerProvider.forEachLayer(function(a){a.isPickable&&
(a.isSliceable?y:r).push(a)});l&&(r=r.filter(function(a){return l.has(a.id)}),y=y.filter(function(a){return l.has(a.id)}));f=f||new b(this.viewingMode);var x=a.origin,z=k.vec3.add(g.sv3d.get(),a.origin,a.direction);f.init(r,x,z,c,m,this.intersectionTolerance,h,null);var w=(a=this.viewPropertyProvider.slicePlane())?e.sliceFilterPredicate(a):null;f.run(y,x,z,c,m,this.intersectionTolerance,h,w);this.externalIntersectionHandlers.forEach(function(a){a.intersect(f,a.slicePlaneEnabled?w:null,x,z,c)});if(f.hudResults.length){a=
f.hudResults;a.sort(function(a,b){return b.dist-a.dist});a=a[a.length-1];var p=g.sv3d.get(),C=g.sv3d.get(),D=g.sv3d.get();this.unprojectHUDResultHit(a.center,p,C,D);n=k.vec3.distance(a.center,C)/k.vec3.distance(C,D)*.99;this.validateHUDSelector.init(r,C,D,p,m,this.intersectionTolerance,h,null);this.validateHUDSelector.run(y,C,D,p,m,this.intersectionTolerance,h,w);this.externalIntersectionHandlers.forEach(function(a){a.intersect(d.validateHUDSelector,a.slicePlaneEnabled?w:null,C,D,p)});h=this.validateHUDSelector.minResult;
(null==h.dist||n<=h.dist)&&f.minResult.copyFrom(a)}return f};c.prototype.unprojectHUDResultHit=function(a,b,c,e){var d=this.viewPropertyProvider.camera();d.projectPoint(a,b);b[0]=Math.round(b[0]);b[1]=Math.round(b[1]);a=g.sv3d.get();a[0]=b[0];a[1]=b[1];a[2]=0;d.unprojectPoint(a,c);a[2]=1;d.unprojectPoint(a,e)};return c}();f.SceneIntersectionHelper=p})},"esri/views/3d/webgl-engine/lib/SelectorUtils":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../../support/geometryUtils/boundedPlane"],
function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.sliceFilterPredicate=function(b){return function(e,c,d){k.vec3.lerp(g,e,c,d);return!a.extrusionContainsPoint(b,g)}};var g=k.vec3f64.create()})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../layers/graphics/ElevationQuery ./Evented".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h){return function(b){function e(a){var c=b.call(this)||this;c.providers={im:[],ground:[],scene:[]};c.handles=new Map;c.elevationChange=function(a){c.emit("elevation-change",a)};return c}k(e,b);e.prototype.getElevation=function(a,b){var c=-Infinity,d=!0;"scene"===b&&(c=this._updateElevation(c,this.providers.im,a,b),isFinite(c)&&(d=!1));d&&(c=this._updateElevation(c,this.providers.ground,a,b));"scene"===b&&(c=this._updateElevation(c,this.providers.scene,a,b));return isFinite(c)?
c:null};e.prototype._updateElevation=function(a,b,c,d){for(var e=0;e<b.length;e++){var g=b[e].getElevation(c,d);null!=g&&(a=Math.max(g,a))}return a};e.prototype.queryElevation=function(a,b,d){var e=this;void 0===b&&(b=0);this._elevationService||(this._elevationService=new l.ElevationQuery(this.view.spatialReference,function(){return e.view.map&&e.view.map.ground},{maximumAutoTileRequests:4}));var g=c.createResolver();(m.isPoint(a)?this._elevationService.queryElevation(a.x,a.y,b):this._elevationService.queryElevation(a[0],
a[0],b)).then(function(b){"scene"===d&&(b=e._updateElevation(b,e.providers.scene,a,d));g.resolve(isFinite(b)?b:null)}).catch(function(){return g.resolve(e.getElevation(a))});return g.promise};e.prototype.register=function(a,b){this.handles.set(b,b.on("elevation-change",this.elevationChange));this.providers[a].push(b)};e.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=Object.keys(this.providers);b<c.length;b++){var d=c[b],e=
this.providers[d].indexOf(a);-1<e&&this.providers[d].splice(e,1)}};a([d.property({constructOnly:!0})],e.prototype,"view",void 0);a([d.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],e.prototype,"spatialReference",void 0);return e=a([d.subclass("esri.views.3d.support.CombinedElevationProvider")],e)}(d.declared(e,h.Evented))})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../geometry ../../../../core/promiseUtils ../../../../core/scheduling".split(" "),
function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function c(a,c){this.spatialReference=a;this.view=c;this.point=new b.Point;this.point.spatialReference=a}c.prototype.getElevation=function(a,b,c){this.point.x=a;this.point.y=b;return this.view.elevationProvider.getElevation(this.point,c)};c.prototype.queryElevation=function(b,c,d,e){return a(this,void 0,void 0,function(){return k(this,function(a){this.point.x=b;this.point.y=c;return[2,this.view.elevationProvider.queryElevation(this.point,
d,e)]})})};return c}();f.ViewElevationProvider=p;p=function(){function d(a,b,c){this.spatialReference=a;this._getElevationQueryProvider=b;this._queries=[];this._isScheduled=!1;this._queryOptions=g({},c,{ignoreInvisibleLayers:!0})}d.prototype.queryElevation=function(b,c,d){void 0===d&&(d=0);return a(this,void 0,void 0,function(){var a=this;return k(this,function(g){return[2,e.create(function(e,g){a._queries.push({x:b,y:c,minDemResolution:d,result:{resolve:e,reject:g}});a._scheduleDoQuery()})]})})};
d.prototype._scheduleDoQuery=function(){var a=this;this._isScheduled||(c.schedule(function(){return a._doQuery()}),this._isScheduled=!0)};d.prototype._doQuery=function(){return a(this,void 0,void 0,function(){var a,c,d,e,f,t,u,r,y;return k(this,function(h){switch(h.label){case 0:this._isScheduled=!1;a=this._queries;this._queries=[];c=a.map(function(a){return[a.x,a.y]});d=a.reduce(function(a,b){return Math.min(a,b.minDemResolution)},Infinity);e=new b.Multipoint({points:c,spatialReference:this.spatialReference});
f=this._getElevationQueryProvider();if(!f)return a.forEach(function(a,b){return a.result.reject()}),[2];u=g({},this._queryOptions,{minDemResolution:d});h.label=1;case 1:return h.trys.push([1,3,,4]),[4,f.queryElevation(e,u)];case 2:return t=h.sent(),[3,4];case 3:return r=h.sent(),a.forEach(function(a){return a.result.reject(r)}),[2];case 4:return y=t.geometry.points,a.forEach(function(a,b){return a.result.resolve(y[b][2])}),[2]}})})};return d}();f.ElevationQuery=p})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require",
"exports","../../../core/has"],function(p,f,k){var a=!!k("esri-mobile"),g=!!k("esri-iPhone");p=function(){function a(){}a.isValidProfile=function(b){return b in a.profiles};a.getDefaultProfile=function(){return k("trident")||g?"low":"medium"};a.apply=function(b,c){b=a.profiles[b];c.graphics3D.maxTotalNumberOfFeatures=b.graphics3D.maxTotalNumberOfFeatures;c.graphics3D.maxTotalNumberOfPrimitives=b.graphics3D.maxTotalNumberOfPrimitives;c.sceneService["3dObject"].lodFactor=b.sceneService["3dObject"].lodFactor;
c.sceneService.point.lodFactor=b.sceneService.point.lodFactor;c.sceneService.integratedMesh.lodFactor=b.sceneService.integratedMesh.lodFactor;c.sceneService.pointCloud.lodFactor=b.sceneService.pointCloud.lodFactor;c.sceneService.uncompressedTextureDownsamplingEnabled=b.sceneService.uncompressedTextureDownsamplingEnabled;c.tiledSurface.lodBias=b.tiledSurface.lodBias;c.tiledSurface.angledSplitBias=b.tiledSurface.angledSplitBias;c.antialiasingEnabled=b.antialiasingEnabled;c.gpuMemoryLimit=b.gpuMemoryLimit;
c.additionalCacheMemory=b.additionalCacheMemory;c.frameRate=b.frameRate};return a}();(function(b){b.profiles={low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4},sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5},antialiasingEnabled:!1,gpuMemoryLimit:200,additionalCacheMemory:0,frameRate:0},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,
maxTotalNumberOfPrimitives:17E5},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:a},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:a?400:500,additionalCacheMemory:a?0:100,frameRate:0},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},
uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:a?600:1E3,additionalCacheMemory:0,frameRate:0}}})(p||(p={}));return p})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/gl-matrix".split(" "),function(p,f,
k,a,g,b,e,c){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.color=new g([0,255,255]);a.haloOpacity=1;a.fillOpacity=.25;return a}k(d,b);d.toEngineOptions=function(a){var b=g.toUnitRGBA(a.color);return{color:c.vec4f32.fromValues(b[0],b[1],b[2],b[3]),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};a([e.property({type:g})],d.prototype,"color",void 0);a([e.property()],d.prototype,"haloOpacity",
void 0);a([e.property()],d.prototype,"fillOpacity",void 0);return d=a([e.subclass()],d)}(e.declared(b))})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/scaleUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function d(a,c,d){void 0===d&&(d=
null);var g=this;this.spatialReference=c;this.unitInMeters=b.getMetersPerUnitForSR(this.spatialReference);(this.geometryService=d)||e.create(a&&a.get("portalItem")).then(function(a){g.geometryService=a}).catch(function(){})}d.prototype.toGeographic=function(b){var d=this,e=!0;if(!this.geometryService)return g.reject(new a("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config"));Array.isArray(b[0])&&"number"!==typeof b[0]||(b=[b],e=!1);b=b.map(function(a){return a instanceof
k.Point?a:new k.Point(a,d.spatialReference)});b=new c({geometries:b,outSpatialReference:k.SpatialReference.WGS84});return this.geometryService.project(b).then(function(a){a=a.map(function(a){if("point"===a.type)return[a.x,a.y]});return e?a:a[0]})};d.prototype.canProject=function(){return!!this.geometryService};return d}();f.MapCoordsHelper=p;f.default=p})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(p,f,k,a,g,b){var e=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.minTotalNumberOfFeatures=2E3;a.maxTotalNumberOfFeatures=5E4;a.maxTotalNumberOfPrimitives=17E5;return a}k(d,c);a([b.property()],d.prototype,"minTotalNumberOfFeatures",void 0);a([b.property()],d.prototype,"maxTotalNumberOfFeatures",void 0);a([b.property()],d.prototype,"maxTotalNumberOfPrimitives",void 0);return d=a([b.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],d)}(b.declared(g)),
c=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.lodFactor=1;return a}k(d,c);a([b.property()],d.prototype,"lodFactor",void 0);return d=a([b.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],d)}(b.declared(g)),d=function(d){function e(){return null!==d&&d.apply(this,arguments)||this}k(e,d);e.prototype.getDefaults=function(){return{"3dObject":new c,point:new c,integratedMesh:new c,pointCloud:new c,uncompressedTextureDownsamplingEnabled:!1}};a([b.property({type:c})],
e.prototype,"3dObject",void 0);a([b.property({type:c})],e.prototype,"point",void 0);a([b.property({type:c})],e.prototype,"integratedMesh",void 0);a([b.property({type:c})],e.prototype,"pointCloud",void 0);a([b.property()],e.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return e=a([b.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],e)}(b.declared(g)),m=function(c){function d(){var a=null!==c&&c.apply(this,arguments)||this;a.lodBias=0;a.angledSplitBias=1;return a}
k(d,c);a([b.property()],d.prototype,"lodBias",void 0);a([b.property()],d.prototype,"angledSplitBias",void 0);return d=a([b.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],d)}(b.declared(g));return function(c){function g(){return null!==c&&c.apply(this,arguments)||this}k(g,c);g.prototype.getDefaults=function(){return{graphics3D:new e,sceneService:new d,tiledSurface:new m,antialiasingEnabled:!0}};a([b.property({type:e})],g.prototype,"graphics3D",void 0);a([b.property({type:d})],
g.prototype,"sceneService",void 0);a([b.property({type:m})],g.prototype,"tiledSurface",void 0);a([b.property()],g.prototype,"antialiasingEnabled",void 0);a([b.property()],g.prototype,"gpuMemoryLimit",void 0);a([b.property()],g.prototype,"additionalCacheMemory",void 0);a([b.property()],g.prototype,"frameRate",void 0);return g=a([b.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],g)}(b.declared(g))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/compilerUtils ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../../layers/graphics/dehydratedFeatures ./earthUtils ./geometryUtils ./projectionUtils ./stack ./geometryUtils/coordinateSystem".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function f(a,b,c,d){this.type=a;this.spatialReference=b;this.unitInMeters=c;this.coordinateSystem=d;this.tmpCoordinateSystem=q.create(d)}Object.defineProperty(f.prototype,"extent",{set:function(a){a&&q.setExtent(this.coordinateSystem,a,this.coordinateSystem)},enumerable:!0,configurable:!0});f.prototype.getAltitude=function(a){return q.altitudeAt(this.coordinateSystem,a)};f.prototype.setAltitude=function(a,
b){q.setAltitudeAt(this.coordinateSystem,b,a,b)};f.prototype.setAltitudeOfTransformation=function(a,b){q.setAltitudeOfTransformation(this.coordinateSystem,b,a,b)};f.prototype.worldUpAtPosition=function(a,b){return q.normalAt(this.coordinateSystem,a,b)};f.prototype.worldBasisAtPosition=function(a,b,c){return q.axisAt(this.coordinateSystem,a,b,c)};f.prototype.intersectManifoldClosestSilhouette=function(a,b,c){q.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);q.intersectRayClosestSilhouette(this.tmpCoordinateSystem,
a,c);return c};f.prototype.intersectManifold=function(a,b,c){q.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);b=n.sv3d.get();return q.intersectRay(this.tmpCoordinateSystem,a,b)?(g.vec3.copy(c,b),!0):!1};f.prototype.intersectInfiniteManifold=function(a,b,c){if("global"===this.type)return this.intersectManifold(a,b,c);q.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);b=this.tmpCoordinateSystem.value;var d=n.sv3d.get();return l.plane.intersectRay(b.plane,a,d)?(g.vec3.copy(c,d),!0):
!1};f.prototype.toRenderCoords=function(a,b,c){return d.isPoint(a)?h.pointToVector(a,b,this.spatialReference):h.vectorToVector(a,b,c,this.spatialReference)};f.prototype.fromRenderCoords=function(a,c,d){return c instanceof b?h.vectorToPoint(a,this.spatialReference,c,d):c instanceof e?h.vectorToPoint(a,this.spatialReference,c):h.vectorToVector(a,this.spatialReference,c,d)};f.createGlobal=function(a){void 0===a&&(a=h.SphericalECEFSpatialReference);var b=q.fromValues(l.sphere,l.sphere.fromValues(m.earthRadius,
[0,0,0]));return new f("global",a,1,b)};f.createLocal=function(a){var b=q.fromValues(l.boundedPlane,l.boundedPlane.fromValues([0,0,0],[1<<60,0,0],[0,1<<60,0])),d=c.getMetersPerUnitForSR(a);return new f("local",a,d,b)};f.createMode=function(b,c){switch(b){case "local":return f.createLocal(c);case "global":return f.createGlobal();default:a.neverReached(b)}};return f}();f.RenderCoordsHelper=p})},"esri/views/3d/support/ResourceController":function(){define("require exports ../../../core/Handles ../../../core/now ../../../core/scheduling ./MemoryController ./StreamDataLoader ./StreamDataSupplier ../webgl-engine/lib/Util".split(" "),
function(p,f,k,a,g,b,e,c,d){function m(){var a={},b;for(b in l.ClientType)a[l.ClientType[b]]=0;a[l.ClientType.TERRAIN]=15;a[l.ClientType.SCENE]=20;a[l.ClientType.SYMBOLOGY]=5;return new e(a)}var l=function(){function e(c,d,h){void 0===d&&(d=g);void 0===h&&(h=a);var f=this;this._view=c;this._memoryController=this._budget=null;this._streamDataLoader=m();this._frameWorkers=[];this._nextFrameWorker=0;this._idleWorkers=[];this._nextIdleWorker=0;this._forceFrameWorker=this._idleUpdatesStartFired=!1;this._lastTargetChangeTime=
0;this._handles=new k;this._frameTask=null;this.idleTimeout=300;this.idleBudget=100;this._budget=new e.Budget(h);this._lastTargetChangeTime=h();this._memoryController=new b(this._view);this._debug={memoryController:this._memoryController,idleOff:!1};this._handles.add(this._view.watch("state.camera",function(){return f.cameraChangedHandler()},!0));this._frameTask=d.addFrameTask({update:function(a){return f.frameUpdate(a)}})}e.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),
this._frameTask=null);this._handles.remove();this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=null)};Object.defineProperty(e.prototype,"enableBudget",{set:function(a){this._budget.enabled=a},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"updating",{get:function(){return this._memoryController.updating},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"maxGpuMemory",{set:function(a){this._memoryController.setMaxGpuMemory(a)},enumerable:!0,
configurable:!0});Object.defineProperty(e.prototype,"additionalCacheMemory",{set:function(a){this._memoryController.setAdditionalCacheMemory(a)},enumerable:!0,configurable:!0});e.prototype.setMemoryDirty=function(){this._memoryController.setDirty()};Object.defineProperty(e.prototype,"memoryFactor",{get:function(){return this._memoryController.getMemoryFactor()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"usedMemory",{get:function(){return this._memoryController.getUsedMemory()},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"memoryEvents",{get:function(){return this._memoryController.events},enumerable:!0,configurable:!0});e.prototype.getMemCache=function(a,b){return this._memoryController.getMemCache(a,b)};e.prototype.getStreamDataSupplier=function(a,b){return new c(a,this._streamDataLoader,b)};e.prototype.registerIdleFrameWorker=function(a){var b=this;d.assert(!a.idleFrame||a.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");var c=
{callbacks:a};this.addIdleFrameWorker(c);return{remove:function(){b.removeIdleFrameWorker(c)}}};e.prototype.registerFrameWorker=function(a,b){var c=this,d={callback:a,needsUpdate:b||function(){return!0}};this.addFrameWorker(d);return{remove:function(){return c.removeFrameWorker(d)}}};e.prototype.addIdleFrameWorker=function(a){this._idleWorkers.push(a);this.isIdle()&&this._idleUpdatesStartFired&&a.callbacks.idleBegin&&a.callbacks.idleBegin()};e.prototype.removeIdleFrameWorker=function(a){var b=this._idleWorkers,
c=b.indexOf(a);d.assert(0<=c,"worker not registered");this._idleUpdatesStartFired&&a.callbacks.idleEnd&&a.callbacks.idleEnd();b.splice(c,1);this._nextIdleWorker>=b.length&&(this._nextIdleWorker=0)};e.prototype.addFrameWorker=function(a){this._frameWorkers.push(a)};e.prototype.removeFrameWorker=function(a){var b=this._frameWorkers;a=b.indexOf(a);d.assert(0<=a,"worker not registerted");b.splice(a,1);this._nextFrameWorker>=this._frameWorkers.length&&(this._nextFrameWorker=0)};e.prototype.cameraChangedHandler=
function(){this._lastTargetChangeTime=this._budget.now();this.setMemoryDirty();this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this.callIdleFrameWorkersEnd())};e.prototype.frameUpdate=function(a){var b=a.frameDuration>1.5*a.tickTime?a.tickTime:5,b=this.isIdle()?0:b,c=a.frameDuration-a.elapsedFrameTime-b,d=this.idleBudget-a.elapsedFrameTime;this._debug.idleOff&&(d=c);c=Math.max(this.isIdle()?d:c,5);this._budget.reset(c);this._view.stateManager&&this._view.stateManager.step(a.deltaTime/
1E3);if(c<b&&!this._forceFrameWorker)this._forceFrameWorker=!0;else{this._forceFrameWorker=!1;this._memoryController.update();a=!1;for(c=0;c<this._frameWorkers.length;++c){d=(this._nextFrameWorker+c)%this._frameWorkers.length;if(a&&this._budget.remaining()<b){this._nextFrameWorker=d%this._frameWorkers.length;return}d=this._frameWorkers[d];this._budget.resetProgress();d.needsUpdate(this._budget)&&(a=!0,d.callback(this._budget))}this.isIdle()&&!this._budget.done()&&(this._idleUpdatesStartFired||(this._idleUpdatesStartFired=
!0,this.callIdleFrameWorkersBegin()),this.callIdleFrameWorkers())}};e.prototype.isIdle=function(){return this._budget.now()-this._lastTargetChangeTime>this.idleTimeout};e.prototype.callIdleFrameWorkersBegin=function(){this._idleWorkers.forEach(function(a){a.callbacks.idleBegin&&a.callbacks.idleBegin()})};e.prototype.callIdleFrameWorkersEnd=function(){this._idleWorkers.forEach(function(a){a.callbacks.idleEnd&&a.callbacks.idleEnd()})};e.prototype.callIdleFrameWorkers=function(){for(var a=0;a<this._idleWorkers.length;++a){var b=
(this._nextIdleWorker+a)%this._idleWorkers.length;if(this._budget.done()){this._nextIdleWorker=b;break}b=this._idleWorkers[b];b.callbacks.needsUpdate&&b.callbacks.needsUpdate()&&(this._budget.resetProgress(),b.callbacks.idleFrame(this._budget))}};Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},enumerable:!0,configurable:!0});return e}();(function(a){(function(a){a.TERRAIN="terrain";a.SCENE="scene";a.SYMBOLOGY="symbology"})(a.ClientType||(a.ClientType={}));var b=function(){function a(a){this._nowFunc=
a;this.enabled=!0;this.budget=this.begin=0;this._didWork=!1}a.prototype.now=function(){return this._nowFunc()};a.prototype.reset=function(a){this.begin=this.now();this.budget=this.enabled?a:Number.MAX_VALUE;this._didWork=!1};a.prototype.done=function(){return this.enabled&&this.elapsed()>=this.budget};a.prototype.doneWithProgress=function(){return this.done()&&this._didWork};a.prototype.remaining=function(){return this.enabled?Math.max(this.budget-this.elapsed(),0):Number.POSITIVE_INFINITY};a.prototype.elapsed=
function(){return this.now()-this.begin};a.prototype.run=function(a){if(this.done())return!1;a();return!0};a.prototype.runWithProgress=function(a){if(this.doneWithProgress())return!1;!0===a()&&(this._didWork=!0);return!0};a.prototype.resetProgress=function(){this._didWork=!1};a.prototype.madeProgress=function(){this._didWork=!0};Object.defineProperty(a.prototype,"hasProgressed",{get:function(){return this._didWork},enumerable:!0,configurable:!0});return a}();a.Budget=b})(l||(l={}));return l})},"esri/views/3d/support/MemoryController":function(){define("require exports ../../../core/Logger ../../../core/MemCache ../layers/support/MemoryManagedLayerView ./Evented".split(" "),
function(p,f,k,a,g,b){var e=k.getLogger("esri.views.3d.support.MemoryController");return function(){function c(c){this._view=c;this._minQuality=.1;this._memoryHWM=this._maxQuality=1;this._memoryLWM=.75;this._divideRate=1.3;this._throttle=5;this.events=new b.Evented;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._memoryCommitted=this._memoryUsed=this._throttled=this._stableQuality=0;this._cacheStorage=new a.Storage;this.updating=!1}c.prototype.getMemCache=function(b,c){return new a(b,
this._cacheStorage,c)};c.prototype.setMaxGpuMemory=function(a){null!=a&&0<a&&(this._maxMemory=a,this.setDirty())};c.prototype.setAdditionalCacheMemory=function(a){null!=a&&0<=a&&(this._additionalCacheMemory=a)};c.prototype.disableMemCache=function(){this._additionalCacheMemory=-4096};c.prototype.getMemoryFactor=function(){return this._quality};c.prototype._updateQuality=function(a){a=Math.min(Math.max(a,this._minQuality),this._maxQuality);if(a===this._quality)return!1;this._quality=a;this.events.emit("quality-changed",
this._quality);return!0};c.prototype.getUsedMemory=function(){return this._memoryUsed};c.prototype.setDirty=function(){this._stableQuality=0;this._updateQuality(this._maxQuality)};c.prototype.update=function(){this._updateMemory();if(!(0>=this._memoryCommitted)){this._throttled=Math.max(0,this._throttled-1);var a=this._layersUpdating();if(a){if(this._quality<=this._minQuality)return;if(this._memoryCommitted>1.1*this._memoryHWM||this._memoryUsed>this._memoryHWM)if(0<this._stableQuality)this._updateQuality(this._stableQuality);
else if(0===this._throttled||1.05<this._memoryUsed)this._updateQuality(this._quality/this._divideRate),this._throttled=this._throttle}else this._memoryUsed>this._memoryHWM&&(this._stableQuality=0,a=this._updateQuality(this._quality/this._divideRate)),this._memoryCommitted<this._memoryLWM&&this._quality<this._maxQuality&&this._stableQuality!==this._quality&&(this._stableQuality=this._quality,a=this._updateQuality(this._quality+.1*(this._memoryLWM-this._memoryCommitted+.1)));this.updating!==a&&(this.updating=
a,this.events.emit("updating-changed",this.updating))}};c.prototype._layersUpdating=function(){var a=!1;this._view.allLayerViews.forEach(function(b){a=a||b.updating});return a};c.prototype._updateMemory=function(){var a=this,b=0,c=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(b+=this._view.basemapTerrain.getUsedMemory());var h=this._view._stage&&this._view._stage.view&&this._view._stage.view.getEdgeView();h&&(b+=h.getGpuMemoryUsage());this._view.allLayerViews&&this._view.allLayerViews.forEach(function(d){if(g.isMemoryManagedLayerView(d)){var e=
d.ignoresMemoryFactor()?a._quality:1;b+=d.getUsedMemory()*e;c+=d.getUnloadedMemory()*e}});var f=null==this._warnMemoryUsage||Math.round(10*b)!==Math.round(10*this._warnMemoryUsage),h=1048576*this._maxMemory;if(b>h&&f){this._warnMemoryUsage=b;var f=function(a){return(a/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},k=Math.round(100*this._quality);e.warn("GPU Memory Limit exceeded! Limit: "+f(h)+" Current: "+f(b)+" Projected: "+f(b+c)+" Quality: "+k+"%")}this._memoryUsed=b/h;this._memoryCommitted=
(b+c)/h;this._cacheStorage.maxSize=Math.max(0,h-b+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};Object.defineProperty(c.prototype,"debug",{get:function(){return{cacheStorage:this._cacheStorage}},enumerable:!0,configurable:!0});return c}()})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.isMemoryManagedLayerView=function(f){return"function"===typeof f.getUsedMemory}})},
"esri/views/3d/support/StreamDataLoader":function(){define("require exports ../../../request ../../../core/arrayUtils ../../../core/lang ./AsyncQuotaRoundRobinQueue ./PromiseLightweight ../webgl-engine/lib/Performance ../webgl-engine/lib/Util".split(" "),function(p,f,k,a,g,b,e,c,d){var m;(function(a){a[a.QUEUED=1]="QUEUED";a[a.DOWNLOADING=2]="DOWNLOADING";a[a.CANCELLED=4]="CANCELLED"})(m||(m={}));return function(){function f(a){this.tasks=new Map;this.clientPromiseToTask=new Map;this.loadQueue=new b(this.startLoading.bind(this),
this.doneLoadingCallback,this,a)}f.prototype.destroy=function(){var a=this;this.tasks.forEach(function(b){for(var c=0,d=b.clientPromises;c<d.length;c++){var e=d[c];e.isRejected()||e.reject(b.url,null);a.cancelTask(e)}});this.loadQueue.clear();this.clientPromiseToTask=this.tasks=this.loadQueue=null};f.prototype.request=function(a,b,c){var d=this,g=new e.Promise(function(){d.cancel(g)});this.createOrUpdateTask(a,b,c,g);return g};f.prototype.createTask=function(a,b,c,d,e){a={url:a,docType:b,clientType:c,
key:d,result:null,status:m.QUEUED,clientPromises:[],downloadObj:null,_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.updateTask(a,e);this.tasks.set(d,a);this.loadQueue.push(a)};f.prototype.cancel=function(a){this.cancelTask(a)};f.prototype.hasPendingDownloads=function(){return 0<this.tasks.size};Object.defineProperty(f.prototype,"tests",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0});f.prototype.taskKey=function(a,b,c){return a+":"+b+":"+c};f.prototype.updateTask=
function(a,b){this.clientPromiseToTask.set(b,a);a.clientPromises.push(b)};f.prototype.createOrUpdateTask=function(a,b,c,d){var e=this.taskKey(a,b,c),g=this.tasks.get(e);g?this.updateTask(g,d):this.createTask(a,b,c,e,d)};f.prototype.cancelTask=function(b){var c=this.clientPromiseToTask.get(b);c&&(a.removeUnordered(c.clientPromises,b),this.clientPromiseToTask.delete(b),0===c.clientPromises.length&&(c.status===m.DOWNLOADING&&(this.loadQueue.workerCancelled(c),c.status=m.CANCELLED,c.downloadObj.cancel(),
c.downloadObj=null),c.status=m.CANCELLED,this.tasks.delete(c.key)))};f.prototype.doneLoadingCallback=function(a,b){d.assert(a.status===m.DOWNLOADING);for(var c=a.result,e=0,h=a.clientPromises;e<h.length;e++){var f=h[e];this.clientPromiseToTask.delete(f);b?f.isRejected()||f.reject(a.url,b):(c||(c=g.clone(a.result)),f.done(a.url,c),c instanceof HTMLImageElement||(c=null))}this.tasks.delete(a.key)};f.prototype.startLoading=function(a,b){if(a.status===m.CANCELLED)return!1;a.status=m.DOWNLOADING;var d,
e;switch(a.docType){case "binary":e="array-buffer";d=0;break;case "image":e="image";break;default:e="json"}a.startTime=c.now();a.downloadObj=k(a.url,{responseType:e,timeout:d});a.downloadObj.then(function(d){a.duration=c.now()-a.startTime;a.size="binary"===a.docType?d.data.byteLength:0;a.result=d.data;b(a)},function(c){a.downloadObj.isCanceled()||b(a,c)});return!0};return f}()})},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["require","exports","../../../core/arrayUtils","../webgl-engine/lib/Util"],
function(p,f,k,a){return function(){function g(a,e,c,d){this.workerFunc=a;this.robin=0;this.type2id={};this.tasks=[];this.typeNumWorkers=[];this.typeWorkerQuota=[];this.typeStatistics=[];this.numTypes=this.maxTotalNumWorkers=this.totalNumWorkers=0;for(var b in d)this.tasks[this.robin]=[],this.typeNumWorkers[this.robin]=0,this.typeStatistics[this.robin]={requests:0,size:0,duration:0,speed:0},this.typeWorkerQuota[this.robin]=d[b],this.type2id[b]=this.robin++,this.maxTotalNumWorkers+=d[b];this.numTypes=
this.tasks.length;this.robin=0;var g=this;this.taskCallback=function(a){a._cancelledInQueue||(e.apply(c,arguments),g.taskFinished(a))}}g.prototype.setWorkerQuota=function(b){a.assert(k.equals(Object.keys(this.typeWorkerAllication),Object.keys(b)));this.typeWorkerAllication=b;this.maxTotalNumWorkers=0;for(var e in b)this.typeWorkerQuota[this.type2id[e]]=b[e],this.maxTotalNumWorkers+=b[e]};g.prototype.setWorkerFunc=function(a){this.workerFunc=a};g.prototype.push=function(a){var b=this.type2id[a.clientType];
this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[b]++,this.totalNumWorkers++,this.workerFunc(a,this.taskCallback)):this.tasks[b].push(a)};g.prototype._getStatsForType=function(a){a=this.type2id[a];return{quota:this.typeWorkerQuota[a],workers:this.typeNumWorkers[a],queueSize:this.tasks[a].length,requestStats:this.typeStatistics[a]}};g.prototype.removeTasks=function(a,e){for(var b=[],d=0,g=this.tasks[this.type2id[e]];d<g.length;d++){var f=g[d];-1===a.indexOf(f)&&b.push(f)}this.tasks[this.type2id[e]]=
b};g.prototype.workerCancelled=function(a){this.taskFinished(a);a._cancelledInQueue=!0};g.prototype.clear=function(){for(var a=0;a<this.tasks.length;a++)this.tasks[a]=[]};g.prototype.taskFinished=function(b){var e=this.type2id[b.clientType];this.typeNumWorkers[e]--;this.totalNumWorkers--;this.typeStatistics[e].requests++;this.typeStatistics[e].size+=b.size||0;this.typeStatistics[e].duration+=b.duration||0;this.typeStatistics[e].speed=0<this.typeStatistics[e].duration?this.typeStatistics[e].size/this.typeStatistics[e].duration:
0;a.assert(0<=this.typeNumWorkers[e]);this.next()};g.prototype.next=function(){var a=this.robin,e=!1;do this.typeNumWorkers[a]<this.typeWorkerQuota[a]&&this.processQueue(a)&&(e=!0),a=(a+1)%this.numTypes;while(!e&&a!==this.robin);if(!e){do this.processQueue(a)&&(e=!0),a=(a+1)%this.numTypes;while(!e&&a!==this.robin)}this.robin=a};g.prototype.processQueue=function(a){for(;0<this.tasks[a].length;)if(this.workerFunc(this.tasks[a].shift(),this.taskCallback))return this.typeNumWorkers[a]++,this.totalNumWorkers++,
!0;return!1};return g}()})},"esri/views/3d/support/StreamDataSupplier":function(){define(["require","exports"],function(p,f){return function(){function f(a,g,b){this._clientType=a;this._loader=g;this._activeRequests=null;b&&b.trackRequests&&(this._activeRequests=new Map)}f.prototype.request=function(a,g){var b=this;g=this._loader.request(a,g,this._clientType);if(this._activeRequests){this._activeRequests.set(a,g);var e=function(){b._activeRequests.delete(a)};g.then(e,e)}return g};f.prototype.cancelRequest=
function(a){this._loader.cancel(a)};f.prototype.cancelAll=function(){var a=this;this._activeRequests&&(this._activeRequests.forEach(function(g){a._loader.cancel(g)}),this._activeRequests.clear())};f.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()};return f}()})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./ResourceController ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),
function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function d(a){this.streamDataSupplier=this.textures=null;this.graphicsOwners=[];this.screenSizePerspectiveHandles=null;var c=g.ClientType.SYMBOLOGY;this.viewState=a.viewState;this.stage=a.stage;this.pointsOfInterest=a.pointsOfInterest;this.resourceController=a.resourceController;this.streamDataSupplier=this.resourceController.getStreamDataSupplier(c);this.textures=new b(this.streamDataSupplier,a.stage,{preMultiplyAlpha:!0,
wrap:{s:33071,t:33071}});this.screenSizePerspectiveSettings=e.getSettings(a.viewingMode);this.screenSizePerspectiveSettingsLabels=e.getLabelSettings(a.viewingMode)}d.prototype.destroy=function(){this.streamDataSupplier=this.textures=this.streamDataSupplier=null};d.prototype.addGraphicsOwner=function(a){var b=this;if(!a)return{remove:function(){}};this.graphicsOwners.push(a);var c="layer"in a?a.watch("layer.screenSizePerspectiveEnabled",function(){return b.updateScreenSizePerspectiveEnabled()}):null;
this.updateScreenSizePerspectiveEnabled();return{remove:function(){c&&(c.remove(),k.removeUnordered(b.graphicsOwners,a),b.updateScreenSizePerspectiveEnabled())}}};d.prototype.updateScreenSizePerspectiveEnabled=function(){var b=this,c=this.graphicsOwners.some(function(a){return!0===a.get("layer.screenSizePerspectiveEnabled")});c&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new a,c=function(){return b.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",
c,!0),this.viewState.events.on("camera-projection-changed",c)]),this.updateScreenSizePerspectiveSettings()):!c&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};d.prototype.updateScreenSizePerspectiveSettings=function(){c.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;c.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(c);this.screenSizePerspectiveSettingsLabels.update(c);this.stage.setNeedsRender()};
return d}();f.SharedSymbolResources=p;var c={distance:0,fovY:0};f.default=p})},"esri/views/3d/support/TextureCollection":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/promiseUtils ../../../core/urlUtils ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Util".split(" "),function(p,f,k,a,g,b,e,c){return function(){function d(a,b,c){this._textureRecords=new Map;this._streamDataSupplier=a;this._stage=b;this._textureOptions=c||{}}d.prototype.acquire=
function(b,c){var d=this,e=this._textureRecords.get(b);if(e)return e.referenceCount++,e.texture||e.loadTexture;if("number"===typeof c){var g=this._streamDataSupplier.request(b,"image"),e=a.create(function(a,e){g.then(function(e,g){e=d.createTexture(e,g,c);d.registerTexture(e);d._textureRecords.get(b).texture=e;a(e)},function(a){e()})},function(){g.cancel()});this._textureRecords.set(b,{referenceCount:1,texture:null,loadTexture:e});return e}e=c(b);this.registerTexture(e);this._textureRecords.set(b,
{texture:e,referenceCount:1});return e};d.prototype.release=function(a){var b=this._textureRecords.get(a);b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&(b.texture?this.unregisterTexture(b.texture):b.loadTexture.cancel(),this._textureRecords.delete(a))):console.warn("TextureCollection: texture doesn't exist: "+a)};d.prototype.createTexture=function(a,b,d){var h=this._textureRecords.get(a);c.assert(h&&!h.texture);g.isSVG(a)&&
(d||0===b.width&&0===b.height)&&(a=b.width?b.height/b.width:1,d=d||64,1<a?(b.width=Math.round(d/a),b.height=d):(b.width=d,b.height=Math.round(d*a)));d=k({},this._textureOptions,{width:b.width,height:b.height});return new e(b,"symbol",d)};d.prototype.registerTexture=function(a){this._stage.add(b.ModelContentType.TEXTURE,a)};d.prototype.unregisterTexture=function(a){this._stage.remove(b.ModelContentType.TEXTURE,a.id)};return d}()})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Point ../PropertiesPool ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Selector".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y){Object.defineProperty(f,"__esModule",{value:!0});var x=Array;p=function(g){function f(a){a=g.call(this,a)||this;a.handles=new b;a.surfaceAltitudeAtCenter=0;a.surfaceAltitudeAtCenterDirty=!0;a.surfaceAltitudeAtCenterWithContent=0;a.surfaceAltitudeAtCenterWithContentDirty=!0;a.propertiesPool=new m.default({pointOfView:d,renderPointOfView:x},a);a.updateSurfaceAltitudeFrequentInterval=w;a.updateSurfaceAltitudeInfrequentInterval=B;a.renderPointOfView=c.vec3f64.create();
return a}k(f,g);f.prototype.initialize=function(){var a=this,b=this.view,c=b.state,d=b.basemapTerrain,e=b.renderCoordsHelper,b=b.map,g=this.view.resourceController;this.surfaceSelector=new y(c.mode);this.surfaceSelector.enableBackfacesTerrain=c.isGlobal?!1:!0;this.surfaceSelector.enableInvisibleTerrain=!1;this.contentSelector=new y(c.mode);this.contentSelector.enableTerrain=!1;var f=this.estimateSurfaceAltitudeAtCenter.bind(this);this._set("centerOnSurfaceInfrequent",new h.default({state:c,resourceController:g,
surface:d,renderCoordsHelper:e,estimateSurfaceAltitudeAtCenter:f,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval}));this._set("centerOnSurfaceFrequent",new h.default({state:c,resourceController:g,surface:d,renderCoordsHelper:e,estimateSurfaceAltitudeAtCenter:f,altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("centerOnContent",new h.default({state:c,resourceController:g,surface:d,renderCoordsHelper:e,estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this),
altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("cameraOnSurface",new l.default({state:c,surface:d,renderCoordsHelper:e,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval,map:b}));this._set("surfaceGeometryUpdates",new r.default({state:c,surface:d,renderCoordsHelper:e,centerOnSurfaceInstances:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new n.default({contentLayerViews:this.view.allLayerViews,
renderCoordsHelper:e}));this._set("surfaceOrigin",new u.default({view:this.view}));this._set("focus",new t.default({state:c,surface:d,renderCoordsHelper:e,centerOnSurface:this.centerOnSurfaceFrequent}));this.handles.add(c.watch("camera",function(b){return a.cameraChanged(b)},!0));this.handles.add(this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(d.watch("extent",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(this.contentGeometryUpdates.events.on("request-update",
function(){return a.updateCenterOnContent()}));this.cameraChanged(this.view.state.camera);this.forceUpdate()};f.prototype.destroy=function(){q.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};Object.defineProperty(f.prototype,"pointOfView",{get:function(){var a=this.propertiesPool.get("pointOfView");this.view.renderCoordsHelper.fromRenderCoords(this.renderPointOfView,a,this.view.state.spatialReference);
return a},enumerable:!0,configurable:!0});f.prototype.forceUpdate=function(){this.surfaceGeometryUpdates.forceUpdate();this.centerOnSurfaceInfrequent.forceUpdate();this.centerOnSurfaceFrequent.forceUpdate();this.cameraOnSurface.forceUpdate();this.centerOnContent.forceUpdate();this.focus.forceUpdate()};f.prototype.hasPendingUpdates=function(){return this.surfaceGeometryUpdates.hasPendingUpdates()||this.centerOnContent.hasPendingUpdates()||this.centerOnSurfaceInfrequent.hasPendingUpdates()||this.cameraOnSurface.hasPendingUpdates()||
this.centerOnSurfaceFrequent.hasPendingUpdates()||this.focus.hasPendingUpdates()};f.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;this.view.sceneIntersectionHelper.intersectRay(this.view.state.camera.ray,z,this.contentSelector)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(z):this.surfaceAltitudeAtCenterWithContent=
this.estimateSurfaceAltitudeAtCenter();return this.surfaceAltitudeAtCenterWithContent};f.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var a=this.view.state.camera;this.surfaceSelector.init(null,a.eye,a.center,null,a,null,!1);this.view.basemapTerrain.intersect(this.surfaceSelector,null,a.eye,a.center);this.surfaceSelector.minResult.getIntersectionPoint(z)&&
(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(z));return this.surfaceAltitudeAtCenter};f.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest(a);a=a.eye;this.renderPointOfView[0]===a[0]&&this.renderPointOfView[1]===a[1]&&this.renderPointOfView[2]===a[2]||this._set("renderPointOfView",c.vec3.copy(this.propertiesPool.get("renderPointOfView"),a))};f.prototype.updateCenterPointsOfInterest=function(a){void 0===a&&(a=this.view.state.camera);this.surfaceAltitudeAtCenterWithContentDirty=
this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.update(a);this.centerOnSurfaceInfrequent.update(a);this.cameraOnSurface.update(a);this.centerOnContent.update(a);this.focus.update(a)};f.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0;this.centerOnContent.update(this.view.state.camera)};a([e.property({constructOnly:!0})],f.prototype,"updateSurfaceAltitudeFrequentInterval",void 0);a([e.property({constructOnly:!0})],f.prototype,"updateSurfaceAltitudeInfrequentInterval",
void 0);a([e.property({readOnly:!0})],f.prototype,"centerOnContent",void 0);a([e.property({readOnly:!0})],f.prototype,"centerOnSurfaceFrequent",void 0);a([e.property({readOnly:!0})],f.prototype,"centerOnSurfaceInfrequent",void 0);a([e.property({readOnly:!0})],f.prototype,"cameraOnSurface",void 0);a([e.property({readOnly:!0})],f.prototype,"focus",void 0);a([e.property({readOnly:!0})],f.prototype,"surfaceOrigin",void 0);a([e.property({readOnly:!0})],f.prototype,"contentGeometryUpdates",void 0);a([e.property({readOnly:!0,
dependsOn:["renderPointOfView"]})],f.prototype,"pointOfView",null);a([e.property({readOnly:!0})],f.prototype,"renderPointOfView",void 0);a([e.property({readOnly:!0})],f.prototype,"surfaceGeometryUpdates",void 0);a([e.property({constructOnly:!0})],f.prototype,"view",void 0);return f=a([e.subclass("esri.views.3d.support.PointsOfInterest")],f)}(e.declared(g));f.PointsOfInterest=p;var z=c.vec3f64.create(),w=200,B=3E3;f.default=p})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Point ../PropertiesPool ./PointOfInterest".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){Object.defineProperty(f,"__esModule",{value:!0});var h=Array;p=function(f){function l(a){a=f.call(this,a)||this;a.propertiesPool=new m.default({location:d,renderLocation:h},a);a.estimatedSurfaceAltitude=0;a.pendingElevationQuery=null;a.renderLocation=c.vec3f64.create();return a}k(l,f);l.prototype.initialize=function(){var a=this;this.measureSurfaceAltitudeThrottle=g.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);
this.measureSurfaceAltitude();var c=function(){return a.measureSurfaceAltitudeThrottle()};this.map&&this.handles.add([b.on(this.map,"ground.layers","change",c,c,c)])};l.prototype.destroy=function(){this.cancelPendingRequest()};Object.defineProperty(l.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});l.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();
this.updateCameraOnSurface()};l.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCameraOnSurface()};l.prototype.hasPendingUpdates=function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()||!!this.pendingElevationQuery};l.prototype.cancelPendingRequest=function(){var a=this.pendingElevationQuery;a&&(this.pendingElevationQuery=null,a.cancel())};l.prototype.measureSurfaceAltitude=function(){var a=this;this.cancelPendingRequest();if(this.map&&
this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,q,this.state.spatialReference);var b=this.map.ground.queryElevation(q).then(function(b){a.updateSurfaceAltitude(b.geometry.z)}).catch(function(b){b&&"cancel"===b.dojoType||a.updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a.pendingElevationQuery===b&&(a.pendingElevationQuery=null)});b.isFulfilled()||(this.pendingElevationQuery=b)}else this.updateSurfaceAltitude(0)};l.prototype.updateSurfaceAltitude=function(a){this.estimatedSurfaceAltitude!==
a&&(this.estimatedSurfaceAltitude=a,this.updateCameraOnSurface())};l.prototype.updateCameraOnSurface=function(){c.vec3.copy(n,this.state.camera.eye);this.renderCoordsHelper.setAltitude(this.estimatedSurfaceAltitude,n);var a=this._get("renderLocation");a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]||this._set("renderLocation",c.vec3.copy(this.propertiesPool.get("renderLocation"),n))};l.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;a([e.property({constructOnly:!0})],l.prototype,"altitudeEstimationInterval",void 0);
a([e.property({readOnly:!0,dependsOn:["renderLocation"]})],l.prototype,"location",null);a([e.property({constructOnly:!0})],l.prototype,"map",void 0);a([e.property({readOnly:!0})],l.prototype,"renderLocation",void 0);return l=a([e.subclass("esri.views.3d.support.CameraOnSurface")],l)}(e.declared(l.PointOfInterest));f.CameraOnSurface=p;var n=c.vec3f64.create(),q=new d;f.default=p})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),
function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});p=function(d){function g(a){a=d.call(this)||this;a.handles=new b;return a}k(g,d);g.prototype.destroy=function(){c.default(this,"handles")};a([e.property({constructOnly:!0})],g.prototype,"renderCoordsHelper",void 0);a([e.property({constructOnly:!0})],g.prototype,"surface",void 0);a([e.property({constructOnly:!0})],g.prototype,"state",void 0);return g=a([e.subclass("esri.views.3d.support.PointOfInterest")],g)}(e.declared(g));
f.PointOfInterest=p;f.default=p})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(p,f,k){function a(a){for(var b=[],e=1;e<arguments.length;e++)b[e-1]=arguments[e];if(a instanceof k&&a.destroyed)try{throw Error("instance is already destroyed");}catch(m){console.warn(m.stack)}else for(e=0;e<b.length;e++){var c=b[e];if(!(c in a))throw Error("Property '"+c+"' does not exist and cannot be disposed");var d=a[c];d&&("function"===
typeof d.destroy?d.destroy():"function"===typeof d.dispose?d.dispose():"function"===typeof d.remove&&d.remove());a instanceof k&&c in a.__accessor__.metadatas?a._set(c,null):a[c]=null}}Object.defineProperty(f,"__esModule",{value:!0});f.disposeMembers=a;f.default=a})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/now ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Point ../debugFlags ../earthUtils ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n){Object.defineProperty(f,"__esModule",{value:!0});var q=Array;p=function(f){function n(a){a=f.call(this,a)||this;a.propertiesPool=new h.default({location:c,renderLocation:q},a);a._dirtyTimeStamp=0;a.currentSurfaceAltitude=0;a.latestSurfaceAltitude=0;a.distance=0;a.renderLocation=e.vec3f64.create();return a}k(n,f);r=n;n.prototype.initialize=function(){var a=this;this._frameWorker=this.resourceController.registerFrameWorker(function(){return a.measureSurfaceAltitude()},
function(){return a.needsUpdate()});this.measureSurfaceAltitude()};n.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null)};Object.defineProperty(n.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});n.prototype.update=function(a){this._setDirty();this.updateCenterOnSurface()};n.prototype.forceUpdate=
function(){this.measureSurfaceAltitude();this.updateCenterOnSurface()};n.prototype.hasPendingUpdates=function(){return 0<this._dirtyTimeStamp};Object.defineProperty(n.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});n.prototype._setDirty=function(){this._dirtyTimeStamp=this._dirtyTimeStamp||g()};n.prototype.needsUpdate=function(){return 0<this._dirtyTimeStamp&&g()-this._dirtyTimeStamp>=this.altitudeEstimationInterval};n.prototype.measureSurfaceAltitude=
function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this.updateCenterOnSurface();this._dirtyTimeStamp=0};n.prototype.updateCenterOnSurface=function(){var a=t,b=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,a),c=this.currentSurfaceAltitude!==this.latestSurfaceAltitude;!b&&c&&(b=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);c=u;b&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,
c)&&(e.vec3.copy(a,c),this.currentSurfaceAltitude=this.latestSurfaceAltitude);b?(b=e.vec3.distance(this.state.camera.eye,a),b!==this._get("distance")&&this._set("distance",b)):(b=this.state.camera,e.vec3.scale(a,b.viewForward,this._get("distance")),e.vec3.add(a,a,b.eye));b=this._get("renderLocation");b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]||this._set("renderLocation",e.vec3.copy(this.propertiesPool.get("renderLocation"),a))};n.prototype.calculateSurfaceIntersection=function(a,b){var c=this.state.camera;
if(!this.renderCoordsHelper.intersectManifold(c.ray,a,b))return!1;if(this.state.isGlobal){a=m.earthRadius+a;var d=e.vec3.squaredLength(c.eye),g=d<a*a,h=e.vec3.distance(c.eye,b);g&&h>m.earthRadius/4&&(e.vec3.scale(b,c.viewForward,a-Math.sqrt(d)),e.vec3.add(b,b,c.eye))}else if(c=this.surface.ready&&this.surface.extent)b[0]=l.clamp(b[0],c[0],c[2]),b[1]=l.clamp(b[1],c[1],c[3]);return!0};n.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,b){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||
null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,b)){var c=this.state.camera.eye;a=e.vec3.distance(c,a);b=e.vec3.distance(c,b);if(d.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS||Math.abs(b-a)/a>r.RELATIVE_ALTITUDE_CHANGE_THRESHOLD)return!0}return!1};var r;n.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;a([b.property({constructOnly:!0})],n.prototype,"resourceController",void 0);a([b.property({constructOnly:!0})],n.prototype,"altitudeEstimationInterval",void 0);a([b.property({readOnly:!0})],
n.prototype,"distance",void 0);a([b.property({constructOnly:!0})],n.prototype,"estimateSurfaceAltitudeAtCenter",void 0);a([b.property({readOnly:!0,dependsOn:["renderLocation"]})],n.prototype,"location",null);a([b.property({readOnly:!0})],n.prototype,"renderLocation",void 0);return n=r=a([b.subclass("esri.views.3d.support.CenterOnSurface")],n)}(b.declared(n.PointOfInterest));f.CenterOnSurface=p;var t=e.vec3f64.create(),u=e.vec3f64.create();f.default=p})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require",
"exports","../../../../core/Handles","../Evented"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function b(b){this.handles=new k;this.events=new a.Evented;this.contentLayerViews=b.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",this.layerViewsChanged.bind(this)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),
this.handles=null)};b.prototype.layerViewsChanged=function(a){var b=this;a.added.forEach(function(a){"esri.views.3d.layers.SceneLayerView3D"===a.declaredClass&&b.handles.add(a.on("visible-geometry-changed",b.contentChanged.bind(b)),a.uid)});a.removed.forEach(function(a){return b.handles.remove(a.uid)})};b.prototype.contentChanged=function(){this.events.emit("request-update",g)};return b}();f.ContentGeometryUpdates=p;var g={};f.default=p})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Point ../geometryUtils ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){Object.defineProperty(f,"__esModule",{value:!0});var h=Array;p=function(f){function l(a){a=f.call(this,a)||this;a.propertiesPool=new m.default({locationOnSurface:e,renderLocationOnSurface:h},a);a.centerOnSurface=null;return a}k(l,f);Object.defineProperty(l.prototype,"locationOnSurface",{get:function(){var a=this.propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,a,this.state.spatialReference);return a},enumerable:!0,
configurable:!0});Object.defineProperty(l.prototype,"renderLocationOnSurface",{get:function(){var a=this.centerOnSurface.renderLocation,c=this.renderCoordsHelper,e=this.calculateScreenHorizontalEdgeOnSurface(u);b.vec3.subtract(n,a,this.state.camera.eye);b.vec3.normalize(n,n);c.worldUpAtPosition(a,q);var g=Math.abs(Math.acos(b.vec3.dot(q,n))-.5*Math.PI),c=this.propertiesPool.get("renderLocationOnSurface"),g=1-d.clamp(g/(.5*Math.PI),0,1);b.vec3.lerp(c,a,e,g*g*g);return c},enumerable:!0,configurable:!0});
l.prototype.update=function(a){};l.prototype.forceUpdate=function(){};l.prototype.hasPendingUpdates=function(){return this.centerOnSurface.hasPendingUpdates()};l.prototype.calculateScreenHorizontalEdgeOnSurface=function(a){var d=this.state.camera,e=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),g=this.renderCoordsHelper.getAltitude(d.eye)>=e?d.padding[2]:d.fullHeight-d.padding[0];d.unprojectPoint([d.padding[3]+d.width/2,g,.5],t);b.vec3.subtract(t,t,d.eye);g=b.vec3.normalize(t,
t);this.renderCoordsHelper.intersectManifold(c.ray.wrap(d.eye,g),e,a)||(b.vec3.copy(a,d.eye),this.renderCoordsHelper.setAltitude(e,a));return a};a([g.property({constructOnly:!0})],l.prototype,"centerOnSurface",void 0);a([g.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],l.prototype,"locationOnSurface",null);a([g.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],l.prototype,"renderLocationOnSurface",null);return l=a([g.subclass("esri.views.3d.support.CenterOnSurface")],
l)}(g.declared(l.PointOfInterest));f.Focus=p;var n=b.vec3f64.create(),q=b.vec3f64.create(),t=b.vec3f64.create(),u=b.vec3f64.create();f.default=p})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){Object.defineProperty(f,"__esModule",{value:!0});p=function(g){function h(a){a=g.call(this,a)||this;a.location=null;a._updatePromise=null;a._handles=new b;return a}k(h,g);Object.defineProperty(h.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=d.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference",
"surfaceView.extent"],function(){return a._update()}),e.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};h.prototype.destroy=function(){this._handles.destroy()};h.prototype._update=function(){var a=this;this._updatePromise&&(this._updatePromise.cancel("cancel"),this._updatePromise=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var b=l.center(this.surfaceView.extent),b=new m({x:b[0],y:b[1],z:0,spatialReference:this.surfaceView.spatialReference});
this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updatePromise=this.surface.queryElevation(b,{noDataValue:0}).then(function(b){a._updatePromise=null;a._set("location",b.geometry)}).catch(function(a){"cancel"===a||a&&("cancel"===a.dojoType||"elevation-query:invalid-layer"===a.name)||console.error("StableSurfaceCenter failed to update: ",a)})):this._set("location",b)}else this._set("location",null)};a([c.property({constructOnly:!0})],h.prototype,"view",void 0);a([c.property({readOnly:!0,
aliasOf:"view.map.ground"})],h.prototype,"surface",void 0);a([c.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],h.prototype,"surfaceView",void 0);a([c.property({readOnly:!0})],h.prototype,"location",void 0);a([c.property({readOnly:!0,dependsOn:["location"]})],h.prototype,"renderLocation",null);return h=a([c.subclass("esri.views.3d.terrain.StableSurfaceCenter")],h)}(c.declared(g));f.StableSurfaceCenter=p;f.default=p})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/Handles ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingRect ../debugFlags ../Evented".split(" "),
function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function g(a){var d=this;this.handles=new k;this.tileGeometryUpdateExtent=b.empty();this.tileGeometryUpdateSpatialReference=null;this.hasPendingTileGeometryChanges=!0;this.events=new c.Evented;this.centerOnSurfaceInstances=a.centerOnSurfaceInstances;this.renderCoordsHelper=a.renderCoordsHelper;this.state=a.state;this.handles.add(a.surface.on("elevation-change",function(a){return d.tileGeometryChangeHandler(a)}))}
g.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};g.prototype.forceUpdate=function(){this.handles.has("tile-geometry-update")&&this.updateCenterOnGeometryUpdate();this.hasPendingTileGeometryChanges&&(this.events.emit("request-update",d),this.hasPendingTileGeometryChanges=!1)};g.prototype.hasPendingUpdates=function(){return this.handles.has("tile-geometry-update")};g.prototype.tileGeometryChangeHandler=function(c){var d=this;this.tileGeometryUpdateSpatialReference=
c.spatialReference;b.expand(this.tileGeometryUpdateExtent,c.tile.extent);this.handles.has("tile-geometry-update")||this.handles.add(a.schedule(function(){return d.updateCenterOnGeometryUpdate()}),"tile-geometry-update")};g.prototype.updateCenterOnGeometryUpdate=function(){this.handles.remove("tile-geometry-update");this.centerIntersectsExtent(this.tileGeometryUpdateExtent,this.tileGeometryUpdateSpatialReference)&&(e.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES?this.hasPendingTileGeometryChanges=
!0:this.events.emit("request-update",d));b.empty(this.tileGeometryUpdateExtent)};g.prototype.furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaceInstances[0],b=1;b<this.centerOnSurfaceInstances.length;b++){var c=this.centerOnSurfaceInstances[b];c.distance>a.distance&&(a=c)}return a};g.prototype.centerIntersectsExtent=function(a,c){var d=this.state.camera.eye,e=h,g=this.furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(d,m,c);this.renderCoordsHelper.fromRenderCoords(g.renderLocation,
l,c);m[0]<l[0]?(e[0]=m[0],e[2]=l[0]):(e[0]=l[0],e[2]=m[0]);m[1]<l[1]?(e[1]=m[1],e[3]=l[1]):(e[1]=l[1],e[3]=m[1]);return b.intersects(e,a)};return g}();f.SurfaceGeometryUpdates=p;var d={},m=g.vec3f64.create(),l=g.vec3f64.create(),h=b.empty();f.default=p})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Handles ../../../core/Logger ../../../core/ObjectPool ../../../core/PooledArray ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingRect ../support/Evented ../support/geometryUtils ../support/mathUtils ../support/projectionUtils ../support/PromiseLightweight ../support/ResourceController ./OverlayManager ./PlanarTile ./SphericalTile ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./TileGeometryFactory ./TilemapOnlyTile ./tileUtils ./tileUtils ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H,I,N,S,M,P,O,W,Q,J){function F(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function K(a){return a&&("cancel"===a||"cancel"===a.dojoType)}function L(a,b){var c=!1;b=b||a;var d=0;for(a=a.children;d<a.length;d++){var e=a[d];if(e){for(var g in e.layerInfo)for(var h in e.layerInfo[g]){var f=e.layerInfo[g][h].upsampleFromTile;if(f&&f.tile===b)return!0}c=c||L(e,b)}}return c}var T=S.weakAssert,R=m.getLogger("esri.views.3d.terrain.TerrainSurface");
p=function(b){function f(a,c){a=b.call(this)||this;a.defaultTileBackground=I.DEFAULT_TILE_BACKGROUND;a.hideSkirtsDistanceFromExtentMargin=X;a.hideSkirtsMinimumCameraTilt=ba;a.hideSkirtsMaximumCameraTilt=ca;a._clippingExtent=null;a._dataExtent=null;a._elevationBounds=[0,0];a._rootExtent=u.create();a._iteratorPool=new l(W.IteratorPreorder);a._postorderIterator=new W.IteratorPostorder;a.visible=!1;a.suspended=!1;a._pendingUpdates=!1;a._lvPendingUpdates=!1;a._updateNextFrame=0;a._vectorTileLayerRequests=
0;a._memoryUsed=0;a._overlayOpacity=1;a._eyePosRenderSR=t.vec3f64.create();a._eyePosSurfaceSR=t.vec3f64.create();a._splitLimits=[0,0,0,0,0,0];a._frustum=y.frustum.create();a._viewProjectionMatrix=t.mat4f64.create();a.tilemapStats={tilemapRequestsSent:0,tilemapRequestsPending:0,tilemapRequestErrors:0,fullTilemaps:0,emptyTilemaps:0,tilesRequested:0,tileRequestsSent:0,tileRequestErrors:0,tilesNotPresent:0};a._layerViews=[[],[]];a._layerIndexByLayerViewId=[{},{}];a._basemapLayerViewHandles={};a._handles=
new d;a._lowPrioUpdates=new h;a._topLevelTilemapOnlyTiles=Array(I.TILEMAP_SIZE_EXP+1);a._getElevationData={spatialReference:null,rootTiles:null};a.loaded=!1;a.maxTextureScale=1.2;a.rootTiles=null;a.backgroundImage=I.DEFAULT_TILE_BACKGROUND;a.backgroundColor=null;for(c=0;c<a._topLevelTilemapOnlyTiles.length;c++)a._topLevelTilemapOnlyTiles[c]=new P([c-I.TILEMAP_SIZE_EXP,0,0]);return a}k(f,b);f.prototype.normalizeCtorArgs=function(a,b){this._view=a;this._stage=a._stage;this._set("manifold",b);return{}};
f.prototype.initialize=function(){var a=this;this.tilePool="planar"===this.manifold?D.Pool:E.Pool;this._renderer=new N(this.manifold,null);this._renderer.loaded=this._setLoaded.bind(this);this._renderer.install(this._view._stage);n.init(this,"_background",function(){a._renderer.updateTileBackground(a._background)});this._handles.add(this._view.watch("pointsOfInterest",function(b){a._renderer.pointsOfInterest=b}));this._set("overlayManager",new C({terrainSurface:this,view:this._view}));this._handles.add(this.watch("overlayManager.hasHighlights",
this._handleHasHighlights.bind(this)),"overlayManager");var b={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};this.extentHelper="spherical"===this.manifold?new G.SurfaceExtentHelperGlobal(b):new G.SurfaceExtentHelperLocal(b);this._handles.add(n.init(this.extentHelper,"stencilEnabledExtents",function(b){a._renderer.setStencilEnabledLayerExtents(b)}),"extentHelper");b=this._view.defaultsFromMap?new c({root:this._view.map,rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,
getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;b=new H({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this._view.spatialReference});this._set("tilingSchemeLogic",b);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",this._updateTilingSchemeAndExtent.bind(this),!0),this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._streamDataSupplier=
this._view.resourceController.getStreamDataSupplier(B.ClientType.TERRAIN);this._handles.add(this._view.resourceController.registerFrameWorker(function(b){return a._frame(b)},function(){return a.ready}));this._handles.add(this._view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a._needsIdleUpdate()},idleFrame:function(){return a._idleUpdate()}}));this._viewChangeUpdate=this._viewChangeUpdate.bind(this);this._view.resourceController.memoryEvents.on("quality-changed",function(){return a._viewChangeUpdate()});
this._handles.add([this._view.on("resize",this._viewChangeUpdate),this._view.watch("state.camera",this._viewChangeUpdate,!0),this._view.watch("qualitySettings.tiledSurface.lodBias",this._viewChangeUpdate),this._view.watch("clippingArea",this._clippingChanged.bind(this))],"view");this._handles.add(this._view.allLayerViews.on("change",this._handleLayerViewChanges.bind(this)),"allLayerViews");this._handleLayerViewChanges({added:this._view.allLayerViews.toArray(),removed:[],moved:[],target:this._view.allLayerViews});
this._updateClippingExtent();this.notifyChange("extent")};f.prototype.destroy=function(){this._handles.destroy();this._removeAllTiles();this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;for(var a in this._basemapLayerViewHandles)this._unregisterTiledLayerView(a);this._streamDataSupplier=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._renderer.destroy(this._stage);this._streamDataSupplier=
this._stage=this._view=this._renderer=null};Object.defineProperty(f.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"cullBackFaces",{set:function(a){this._renderer.cullBackFaces=a;this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"baseOpacity",
{set:function(a){this._renderer.opaque=1<=a;this._set("baseOpacity",a);this._updateTileTextures(!0)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=a;this._set("renderOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"skirtScale",{set:function(a){this._renderer.skirtScale=a;this._set("skirtScale",
a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"spatialReference",{get:function(){var a=this.tilingScheme&&this.tilingScheme.spatialReference||null;return this._getElevationData.spatialReference=a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"_background",{get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"slicePlaneEnabled",{set:function(a){this._renderer.slicePlaneEnabled=
a;this._set("slicePlaneEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOverground=a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);this._set("wireframe",a);this._view._stage.setRenderParams({earlyOcclusionPixelDraw:a})},enumerable:!0,configurable:!0});f.prototype.setVisibility=
function(a){a!==this.visible&&(this.visible=a,this._renderer.setVisibility(a),this.setUpdatesDisabled(!a),a&&this._viewChangeUpdate())};f.prototype.isVisible=function(){return this.visible&&this.ready};f.prototype.isOpaque=function(){return this._renderer.isOpaque()};f.prototype.setUpdatesDisabled=function(a){(this.suspended=a)||this._viewChangeUpdate()};f.prototype.intersect=function(a,b,c,d){this._renderer.intersect(a,b,c,d,null)};f.prototype.getElevation=function(a){var b=this._getElevationData.rootTiles;
if(!b||!b.length||0===b[0].layerInfo[I.LayerClass.ELEVATION].length)return null;var c=da;if(Array.isArray(a))c=a;else if("point"===a.type&&!z.pointToVector(a,c,this._getElevationData.spatialReference))return R.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(var d=0;d<b.length;d++)if(a=b[d],O.isPosWithinTile(a,c)){for(;a&&!a.renderData;)b=0,c[0]>.5*(a.extent[0]+a.extent[2])&&(b+=1),c[1]<.5*(a.extent[1]+a.extent[3])&&(b+=2),a=a.children[b];
if(b=(b=a.renderData)&&b.geometryState?b.geometryState.samplerData:null)return M.elevationSampler(c[0],c[1],b);break}return null};f.prototype.getElevationBounds=function(){return this._elevationBounds};f.prototype.getScale=function(a){if(this.tilingScheme){if(!z.pointToVector(a,da,this.spatialReference))return R.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;if(this.rootTiles)for(var b=0;b<this.rootTiles.length;b++)if(a=this.rootTiles[b],
O.isPosWithinTile(a,da)){for(;a.children[0];)b=0,da[0]>a.children[0].extent[2]&&(b+=1),da[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.lij[0])}}return 1E100};f.prototype.queryVisibleScaleRange=function(a,b,c,d){b=b?this.tilingScheme.levelAtScale(b):0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var e=this._getLodBias();this._renderer.queryVisibleLevelRange(a,b+e,c+e,d)};f.prototype._setLoaded=function(){this.loaded||this._set("loaded",!0)};f.prototype._updateTilingSchemeAndExtent=
function(){var a=this.tilingSchemeLogic.extent,b=a&&!u.equals(a,this._dataExtent);b&&(this._dataExtent?u.set(this._dataExtent,a):this._dataExtent=u.create(a));var a=this.tilingSchemeLogic.tilingScheme,c=a!==this.tilingScheme;c&&(T(!!a,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",a),this._updateClippingExtent(),a&&(this._updateTiledLayers(),this._renderer.setTileSize(a.pixelSize[0]),this.overlayManager.setSpatialReference(a.spatialReference,
"spherical"===this.manifold)));(b||c)&&this._updateRootTiles()};f.prototype._acquireTile=function(a,b,c,d){var e=this.tilePool.acquire();ia[0]=a;ia[1]=b;ia[2]=c;e.init(ia,d,this,this.tilingScheme);return e};f.prototype._releaseTile=function(a){a.dispose();a.parent=null;a.parentSurface=null;this.tilePool.release(a)};f.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,c=this.tilingScheme;if(b&&c){var d=U,g=c.rootTilesInExtent(b,d,Infinity);if(this.rootTiles){if(g.length>
I.MAX_ROOT_TILES){R.warn(I.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var b=this.rootTiles.map(function(a){return a.lij}),h=e.difference(b,g,F);if(0<h.removed.length||0<h.added.length){var f=this.rootTiles.filter(function(b){return-1<e.findIndex(h.removed,F.bind(null,b.lij))?(a._purgeChildTiles(b),a._purgeTile(b),!1):!0});h.added.forEach(function(b){b=a._acquireTile(0,b[1],b[2],null);f.push(b);a._loadTile(b)});this._setRootTiles(f)}}else g.length>I.MAX_ROOT_TILES&&(R.warn(I.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),
g=c.rootTilesInExtent(b,d,I.MAX_ROOT_TILES)),this._setRootTiles(g.map(function(b){b=a._acquireTile(0,b[1],b[2],null);a._loadTile(b);return b}));e.equals(d,this._rootExtent)||(this._rootExtent=u.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.setVisibility(!0);this._viewChangeUpdate();this.overlayManager.setOverlayDirty();this.notifyChange("ready")}};f.prototype._setRootTiles=function(a){this._set("rootTiles",a);this._getElevationData.rootTiles=a;this._renderer.setRootTiles(this.rootTiles)};
f.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this.visible&&(this._updateViewDependentParameters(),this._updateSkirts(),this._updateOverlayOpacity(this._eyePosSurfaceSR[2]),this._updateTiles())};f.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.pendingUpdates&I.TileUpdateTypes.UPDATE_GEOMETRY&&(this._updateTileGeometry(a),a.pendingUpdates&=~I.TileUpdateTypes.UPDATE_GEOMETRY)};f.prototype._updateTiles=function(a){void 0===
a&&(a=this.rootTiles);if(a){var b=this._iteratorPool.acquire();b.reset(a);var c=this._splitLimits,d=this._frustum,e;O.hasVisibleSiblings(a)?(a=this._elevationBounds[0],e=this._elevationBounds[1]):(a=Infinity,e=-Infinity);for(;!b.done;){var g=b.next();this._updateClippingStatus(g);if(g.updateVisibility(d)){g.updateScreenDepth(this._viewProjectionMatrix);g.renderData&&(a=Math.min(g.elevationBounds[0],a),e=Math.max(g.elevationBounds[1],e));var h=g.shouldSplit(c,this._eyePosRenderSR);if(h===I.TileUpdateTypes.SPLIT){g.pendingUpdates&=
~I.TileUpdateTypes.MERGE;g.renderData&&(g.pendingUpdates|=I.TileUpdateTypes.SPLIT,b.skipSubtree());this._pendingUpdates=this._pendingUpdates||0!==g.pendingUpdates;continue}g.pendingUpdates&=~I.TileUpdateTypes.SPLIT;h===I.TileUpdateTypes.VSPLITMERGE&&g.updateAgents(I.LayerClass.ELEVATION)}b.skipSubtree();if(!g.renderData){g.pendingUpdates|=I.TileUpdateTypes.MERGE;g.pendingUpdates&=~I.TileUpdateTypes.SPLIT;h=this._iteratorPool.acquire();for(h.resetOne(g);!h.done;){var f=h.next();this._updateClippingStatus(f);
f.updateVisibility(d);f.visible&&f.updateScreenDepth(this._viewProjectionMatrix)}this._iteratorPool.release(h)}this._pendingUpdates=this._pendingUpdates||0!==g.pendingUpdates}this._iteratorPool.release(b);isFinite(a)&&isFinite(e)&&(this._elevationBounds[0]!==a||this._elevationBounds[1]!==e)&&(this._elevationBounds[0]=a,this._elevationBounds[1]=e,this.emit("elevation-bounds-change",null))}};f.prototype._updateViewDependentParameters=function(){var a=this._view.state.camera,b=Math.tan(.5*a.fovX),c=
Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,e=Math.pow(2,-this._getLodBias());this._splitLimits[0]=b;this._splitLimits[1]=d[0]/a.width*this.maxTextureScale*e;this._splitLimits[2]=c;this._splitLimits[3]=d[1]/a.height*this.maxTextureScale*e;this._splitLimits[4]=this.tilingScheme.getMaxLod();this._splitLimits[5]=this._view.qualitySettings.tiledSurface.angledSplitBias;y.frustum.copy(a.frustum,this._frustum);t.mat4.multiply(this._viewProjectionMatrix,a.projectionMatrix,a.viewMatrix);t.vec3.copy(this._eyePosRenderSR,
a.eye);z.vectorToVector(this._eyePosRenderSR,this._view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};f.prototype._updateSkirts=function(){S.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this._view.state.camera.near)};f.prototype._setLayerViewsUpdating=function(){for(var a=0;a<I.LayerClass.COUNT;a++)for(var b=this._layerViews[a],c=0;c<b.length;c++)b[c].updatingChanged(this._pendingUpdates)};f.prototype._frameTraversal=function(a){if(this.suspended||!this._pendingUpdates)return!1;
this._lowPrioUpdates.clear();this._pendingUpdates=!1;var b=this._renderer.resourceCounter,c=b.numTileTexturesComposited,d=this._iteratorPool.acquire();d.reset(this.rootTiles);for(var e=!1,g=0;!(d.done||a.done()&&e)&&b.numTileTexturesComposited-c<Z;){var h=d.next(),g=g+h.memoryUsed;h.pendingUpdates&I.TileUpdateTypes.MERGE?(this._mergeTile(h),h.pendingUpdates&=~I.TileUpdateTypes.MERGE,e=!0,d.skipSubtree()):h.pendingUpdates&I.TileUpdateTypes.SPLIT?(this._splitTile(h),h.pendingUpdates&=~I.TileUpdateTypes.SPLIT,
e=!0,d.skipSubtree()):0<h.pendingUpdates&&this._lowPrioUpdates.push(h);this._pendingUpdates=this._pendingUpdates||0!==h.pendingUpdates}d.done?this._memoryUsed=g:this._pendingUpdates=!0;this._iteratorPool.release(d);return e};f.prototype._updateTileGeometry=function(a){this._renderer.updateTileGeometry(a);this._elevationUpdate(a)};f.prototype._elevationUpdate=function(a){ea.spatialReference=this.spatialReference;ea.tile=a;ea.extent=a.extent;this.emit("elevation-change",ea);u.containsPoint(a.extent,
this._eyePosSurfaceSR)&&this._updateSkirts()};f.prototype._frame=function(a){for(var b=this._frameTraversal(a);(!a.done()||!b)&&0<this._lowPrioUpdates.length;){var c=this._lowPrioUpdates.pop();c.pendingUpdates&I.TileUpdateTypes.DECODE_ELEVATION&&(this._decodeElevation(c,a)&&(c.pendingUpdates&=~I.TileUpdateTypes.DECODE_ELEVATION),b=!0);a.done()&&b||!(c.pendingUpdates&I.TileUpdateTypes.UPDATE_GEOMETRY)||(this._updateTileGeometry(c),c.pendingUpdates&=~I.TileUpdateTypes.UPDATE_GEOMETRY,b=!0);a.done()&&
b||!(c.pendingUpdates&I.TileUpdateTypes.UPDATE_TEXTURE)||(this._renderer.updateTileTexture(c),c.pendingUpdates&=~I.TileUpdateTypes.UPDATE_TEXTURE,b=!0);this._pendingUpdates=this._pendingUpdates||0!==c.pendingUpdates}if(0<this._lowPrioUpdates.length||this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)this._pendingUpdates=!0;this._pendingUpdates===this._lvPendingUpdates||!this._pendingUpdates&&20!==++this._updateNextFrame||(this._setLayerViewsUpdating(),this._lvPendingUpdates=
this._pendingUpdates,this._updateNextFrame=0);b&&(this._memoryUsed=0)};f.prototype._needsIdleUpdate=function(){return this.isVisible()&&this.overlayManager&&this.overlayManager.overlaysNeedUpdate()};f.prototype._idleUpdate=function(){this.overlayManager.updateOverlays();this._updateOverlayOpacity(this._eyePosSurfaceSR[2])};f.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=u.create(),b=null;z.extentToBoundingRect(this._view.clippingArea,a,this.spatialReference)&&
(b=a);if(e.equals(b,this._clippingExtent))return!1;this._clippingExtent=b;this._renderer.clippingExtent=b;this.notifyChange("extent");this._updateTileOverlayParams();this.overlayManager.setOverlayDirty();return!0};f.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};f.prototype._getLodBias=function(){return Math.round(this._view.qualitySettings.tiledSurface.lodBias+2*this._view.resourceController.memoryFactor-2)};f.prototype._getLodBiasCorrectedScale=function(a){var b=
this.tilingScheme.levels;a=x.clamp(a-this._getLodBias(),0,b.length-1);return b[a].scale};f.prototype._cancelTilemapRequests=function(a){for(var b=0;b<I.LayerClass.COUNT;b++){var c=a.layerInfo[b];if(c)for(var d=0;d<c.length;d++){var e=c[d];e.tilemapRequest&&(e.tilemapRequest.cancel(),e.tilemapRequest=null)}}};f.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){a._purgeChildTiles(b);a._purgeTile(b)}),this._setRootTiles(null),this.notifyChange("ready"));
for(var b=0;b<this._topLevelTilemapOnlyTiles.length;b++)this._cancelTilemapRequests(this._topLevelTilemapOnlyTiles[b]);this.setVisibility(!1)};f.prototype._purgeChildTiles=function(a){var b=this._postorderIterator;for(b.reset([a]);!b.done;){for(var c=b.next(),d=0;4>d;d++)c.children[d]=null;c!==a&&this._purgeTile(c)}};f.prototype._purgeTile=function(a){a.unload(this._renderer);this._cancelTilemapRequests(a);a.parent=null;this._releaseTile(a)};f.prototype._splitTile=function(a){var b=a.lij[0]+1,c=2*
a.lij[1],d=2*a.lij[2];a.children[0]=this._createTile(b,c,d,a);a.children[1]=this._createTile(b,c,d+1,a);a.children[2]=this._createTile(b,c+1,d,a);a.children[3]=this._createTile(b,c+1,d+1,a);a.unload(this._renderer);aa.spatialReference=this.spatialReference;aa.extent=a.extent;aa.scale=this._getLodBiasCorrectedScale(b);this.emit("scale-change",aa)};f.prototype._createTile=function(a,b,c,d){T(!!d,"_createTile sanity check");a=this._acquireTile(a,b,c,d);a.updateClippingStatus(this._clippingExtent);a.updateVisibility(this._frustum);
a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),a.shouldSplit(this._splitLimits,this._eyePosRenderSR)===I.TileUpdateTypes.SPLIT&&(a.pendingUpdates|=I.TileUpdateTypes.SPLIT,this._pendingUpdates=!0));this._loadTile(a);return a};f.prototype._mergeTile=function(a){T(!a.renderData,"_mergeTile sanity check");this._loadTile(a);this._purgeChildTiles(a);aa.spatialReference=this.spatialReference;aa.extent=a.extent;aa.scale=this._getLodBiasCorrectedScale(a.lij[0]);this.emit("scale-change",aa)};f.prototype._loadTile=
function(a){a.load(this._renderer);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,a.renderData,this._overlayOpacity);this._elevationUpdate(a)};f.prototype._handleHasHighlights=function(a){this._renderer.setNeedsHighlight(a)};f.prototype._decodeElevation=function(a,b){var c=a.layerInfo[I.LayerClass.ELEVATION];if(!c)return!0;for(var d=0;d<c.length;d++){var e=c[d];e.pendingUpdates&=~I.TileUpdateTypes.DECODE_ELEVATION;if(e.rawData){var g=a.decodeElevationData(e.rawData);
e.rawData=null;if(g){e.data=g;var e=[a],h=a.lij[0],f=this._iteratorPool.acquire();for(f.reset(e);!f.done;){var l=f.next();l.findElevationBoundsForLayer(d,h);l.computeElevationBounds()}this._iteratorPool.release(f);a.dataArrived(d,I.LayerClass.ELEVATION,g);this._updateTiles(e)}if(b.done())break}}return d===c.length};f.prototype._handleLayerViewChanges=function(a){var b=this,c=!1;a.added.forEach(function(a){var d=a.layer;S.isTiledLayerView(a)?(b._registerTiledLayer(a),d.loaded&&(c=!0)):a.supportsDraping&&
b.overlayManager&&b.overlayManager.registerLayerView(a)});a.removed.forEach(function(a){S.isTiledLayerView(a)?(c=!0,b._unregisterTiledLayerView(a.uid)):a.supportsDraping&&b.overlayManager&&b.overlayManager.unregisterLayerView(a)});(c=c||0<a.moved.filter(S.isTiledLayerView).length)&&this._updateTiledLayers()};f.prototype._registerTiledLayer=function(a){var b=this,c=[];c.push(a.watch("suspended",function(){b._updateTiledLayers()}));c.push(a.watch("fullOpacity",function(){return b._updateTileTextures()}));
a.on("data-changed",function(){var c=S.isElevationLayerView(a)?I.LayerClass.ELEVATION:I.LayerClass.MAP,d=b._layerIndexByLayerViewId[c][a.uid];null!=d&&b._invalidateLayerData(d,c)});this._basemapLayerViewHandles[a.uid]=c};f.prototype._unregisterTiledLayerView=function(a){var b=this._basemapLayerViewHandles[a];if(b){for(var c=0;c<b.length;c++)b[c].remove();delete this._basemapLayerViewHandles[a]}};f.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme){var b=this._view.allLayerViews,
c=[[],[]],d=null,e=u.empty();b.forEach(function(b){var g=b.layer;if(g&&!b.suspended&&S.isTiledLayerView(b)){var h=b.fullExtent;h?a.tilingScheme.compatibleWith(b.tileInfo)?(u.expand(e,h),S.isElevationLayerView(b)?c[I.LayerClass.ELEVATION].push(b):(Infinity!==b.maxDataLevel&&(null===d||b.maxDataLevel>d)&&(d=b.maxDataLevel),c[I.LayerClass.MAP].push(b))):R.warn("Terrain: tiling scheme of layer "+g.id+" is incompatible with other tiled layers, will not be drawn"):R.warn("Terrain: Map or elevation layer does not have fullExtent: "+
g.id)}},this);for(var b=function(a){var b=g._layerViews[a],d=c[a];d.reverse();var e=d.length,h=b.length!==e,f=Array(e),l=Array(b.length);g._layerIndexByLayerViewId[a]={};for(var k=0;k<e;k++){g._layerIndexByLayerViewId[a][d[k].uid]=k;var m=b.indexOf(d[k]);f[k]=m;k!==m&&(h=!0);-1<m&&(l[m]=k)}if(h){g._topLevelTilemapOnlyTiles.forEach(function(b){return b.modifyLayers(l,f,a)});b=g._postorderIterator;for(b.reset(g.rootTiles);!b.done;)b.next().modifyLayers(l,f,a);g._layerViews[a]=d;for(b.reset(g.rootTiles);!b.done;)d=
b.next(),d.restartAgents(a),a===I.LayerClass.ELEVATION&&d.computeElevationBounds();g._updateTiles()}},g=this,h=0;h<I.LayerClass.COUNT;h++)b(h);this.tilingScheme.levels.length-1<d&&(this.tilingScheme.ensureMaxLod(d),this._viewChangeUpdate())}};f.prototype._hasFixedExtent=function(){return!!this._clippingExtent};f.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};f.prototype.numLayers=function(a){return this._layerViews[a].length};f.prototype._updateTileTextures=function(a){void 0===
a&&(a=!1);var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;)b.next().updateTexture(a);this._iteratorPool.release(b)};f.prototype._invalidateLayerData=function(a,b){var c=this._iteratorPool.acquire();for(c.reset(this.rootTiles);!c.done;)c.next().removeLayerAgent(a,b);for(c.reset(this.rootTiles);!c.done;)c.next().invalidateLayerData(a,b);this._iteratorPool.release(c)};f.prototype.setPendingUpdates=function(){this._pendingUpdates=!0};f.prototype.requestTileData=function(a,b,c){var d=
this;this.tilemapStats.tilesRequested++;var e=this.layerViewByIndex(b,c),g=e.layer;if(g.tilemapCache&&!S.isVectorTileLayerView(e)){var h=this.getTilemapTile(a),f=h.layerInfo[c][b];if(f.tilemap){if(!h.hasDataAvailable(a,b,c))return this.tilemapStats.tilesNotPresent++,this._dispatchDataEvent(a,"dataMissing",c,e,{notInTilemap:!0}),b=new w.Promise,b.reject(),b}else{f.tilemapRequest||(f.tilemapRequest=this.requestTilemap(h,b,c,e,g));var l,k=new w.Promise(function(){l&&l.cancel()});f.tilemapRequest.catch(function(){}).then(function(){f.tilemapRequest=
null;if(!k.isCancelled()){var b=d._layerIndexByLayerViewId[c][e.uid];null!=b&&(h.hasDataAvailable(a,b,c)?(l=d._requestTileData(a,b,c,e),l.then(function(){return k.resolve()})):(d.tilemapStats.tilesNotPresent++,d._dispatchDataEvent(a,"dataMissing",c,e,{notInTilemap:!0}),k.reject()))}});return k}}return this._requestTileData(a,b,c,e)};f.prototype._requestTileData=function(a,b,c,d){this.tilemapStats.tileRequestsSent++;return c===I.LayerClass.ELEVATION?this._requestElevationTileData(a,b,c,d):this._requestMapTileData(a,
b,c,d)};f.prototype._requestElevationTileData=function(a,b,c,d){var e=this;if(S.isElevationLayerView(d)){var g=function(b){var g=e._layerIndexByLayerViewId[c][d.uid];null!=g?(g=a.layerInfo[c][g],g.rawData=b,a.pendingUpdates|=I.TileUpdateTypes.DECODE_ELEVATION,g.pendingUpdates|=I.TileUpdateTypes.DECODE_ELEVATION,e._pendingUpdates=!0):R.warn("TerrainSurface: received data from unknown layer %d %s",c,a.lij.toString())};b=function(b){K(b)||(e.tilemapStats.tileRequestErrors++,e._dispatchDataEvent(a,"dataMissing",
c,d,b))};var h=d.layer;if(S.useFetchTileForLayer(h))return h=h.fetchTile(a.lij[0],a.lij[1],a.lij[2],I.ELEVATION_NODATA_VALUE),h.then(function(a){return g(a)},b),h;h=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);h=this._streamDataSupplier.request(h,"binary");h.then(function(a,b){b.url=a;g(b)},b);return h}T(!1,"_requestElevationTileData can only be called for elevation layer views")};f.prototype._requestMapTileData=function(a,b,c,d){var e=this,g=function(b){e._dispatchDataEvent(a,"dataArrived",c,d,b)};b=
function(b){K(b)||(e._dispatchDataEvent(a,"dataMissing",c,d,b),e.tilemapStats.tileRequestErrors++)};if(S.isVectorTileLayerView(d)){var h=d.tileHandler,f=d.schemaHelper.getLevelRowColumn(a.lij);++this._vectorTileLayerRequests;h=h.getVectorTile(f[0],f[1],f[2],0);h.then(g).catch(b).then(function(){return--e._vectorTileLayerRequests});return h}if(S.useFetchTileForLayer(d.layer)&&S.isTileLayerView(d))return h=d.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2]),h.then(g).catch(b),h;h=d.getTileUrl(a.lij[0],a.lij[1],
a.lij[2]);null!=d.refreshInterval&&d.refreshTimestamp&&(h+=(-1<h.indexOf("?")?"\x26":"?")+"_ts\x3d"+d.refreshTimestamp);h=this._streamDataSupplier.request(h,"image");h.then(function(a,b){return g(b)},b);return h};f.prototype.requestTilemap=function(a,b,c,d,e){var g=this,h=a.lij[0]+I.TILEMAP_SIZE_EXP,f=a.lij[1]<<I.TILEMAP_SIZE_EXP,l=a.lij[2]<<I.TILEMAP_SIZE_EXP;this.tilemapStats.tilemapRequestsSent++;this.tilemapStats.tilemapRequestsPending++;return e.tilemapCache.fetchTilemap(h,f,l,{timeout:6E3}).then(function(e){g.tilemapStats.tilemapRequestsPending--;
b=g._layerIndexByLayerViewId[c][d.uid];null!=b&&(a.layerInfo[c][b].tilemap=e)}).catch(function(a){g.tilemapStats.tilemapRequestsPending--;g.tilemapStats.tilemapRequestErrors++})};f.prototype.getTilemapTile=function(a){var b=a.lij[0];return b>I.TILEMAP_SIZE_EXP?O.getTileNLevelsUp(a,I.TILEMAP_SIZE_EXP):this._topLevelTilemapOnlyTiles[b]};f.prototype._dispatchDataEvent=function(a,b,c,d,e){d=this._layerIndexByLayerViewId[c][d.uid];if(null!=d)a[b](d,c,e);else R.warn("TerrainSurface: received data from unknown layer")};
f.prototype._updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();b.renderData&&this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(b,b.renderData,this._overlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}};f.prototype._updateOverlayOpacity=function(a){if(this.overlayManager&&(a=this.overlayManager.updateOpacity(a),!isNaN(a))){if(a!==this._overlayOpacity){var b=this._iteratorPool.acquire();
for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.renderData&&(c.renderData.overlayOpacity=a)}this._iteratorPool.release(b)}this._overlayOpacity=a;this._renderer.setNeedsRender()}};f.prototype.getStats=function(){var a=0,b=0,c=0,d=[],e=this._iteratorPool.acquire();for(e.reset(this.rootTiles);!e.done;){var g=e.next();a++;g.renderData&&(b++,g.visible&&(c++,g=g.lij[0],d[g]=null!=d[g]?d[g]+1:1))}this._iteratorPool.release(e);return{numNodes:a,numLeaves:b,numVisible:c,numVisiblePerLevel:d}};f.prototype.getUsedMemory=
function(){if(!this.tilingScheme)return 0;if(0<this._memoryUsed)return this._memoryUsed;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();this._memoryUsed+=b.memoryUsed}this._iteratorPool.release(a);return this._memoryUsed};f.prototype.getMemoryUsage=function(){if(!this.tilingScheme)return{};var a=0,b=0,c=0,d=0,e=0,g=0,h=this._iteratorPool.acquire();h.reset(this.rootTiles);for(var f=this.tilingScheme.pixelSize,f=f[0]*f[1]*4;!h.done;){for(var l=h.next(),k=L(l),
m=0,n=l.layerInfo[I.LayerClass.MAP];m<n.length;m++){var q=n[m],q=q.data,r=0,u=0;q instanceof J?r+=1.3*q.descriptor.width*q.descriptor.height*4:q instanceof HTMLImageElement?u+=f:q instanceof Q&&(g+=q.getGpuMemoryUsage(),c+=q.getCpuMemoryUsage());l.renderData||k?(a+=u,d+=r):(b+=u,e+=r)}k=0;for(m=l.layerInfo[I.LayerClass.ELEVATION];k<m.length;k++)q=m[k],q=q.data,a+=q?f:0;l.renderData&&(q=l.renderData.texture,d+=q&&q.descriptor?1.3*q.descriptor.width*q.descriptor.height*4:0,l=l.renderData.estimateGeometryMemoryUsage(),
g+=l,c+=l)}this._iteratorPool.release(h);return{cpuVisibleImageData:a,cpuInvisibleImageData:b,cpuGeometryData:c,gpuVisibleImageData:d,gpuInvisibleImageData:e,gpuGeometryData:g}};f.prototype.hasPendingUpdates=function(){if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)return!0;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)if(0<a.next().pendingUpdates)return this._iteratorPool.release(a),!0;this._iteratorPool.release(a);return!1};f.prototype.getTile=
function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return this.rootTiles.forEach(function(a){if(a.lij[1]===b[1]&&a.lij[2]===b[2])return a}),null;var c=Math.pow(2,b[0]),d=Math.floor(b[1]/c),e=Math.floor(b[2]/c),g;this.rootTiles.some(function(a){return a.lij[1]===d&&a.lij[2]===e?(g=a,!0):!1});if(g){for(c=1<<b[0]-1;g.lij[0]<b[0];){var h=b[1]&c?2:0;0<(b[2]&c)&&h++;if(!g.children[h])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+O.tile2str(g)),null;g=g.children[h];
c>>=1}T(g.lij[0]===b[0]&&g.lij[1]===b[1]&&g.lij[2]===b[2],"not the right tile?");return g}return null};f.prototype.setBorders=function(a){this._renderer.drawBorders=a};f.prototype.setDisableRendering=function(a){this._renderer.disableRendering=a};Object.defineProperty(f.prototype,"debug",{get:function(){var a=this;return{renderer:this._renderer,mergeTile:function(b){return a._mergeTile(b)},updateTiles:function(b){return a._updateTiles(b)}}},enumerable:!0,configurable:!0});a([q.property({value:!1})],
f.prototype,"cullBackFaces",null);a([q.property({readOnly:!0})],f.prototype,"extent",null);a([q.property({readOnly:!0})],f.prototype,"loaded",void 0);a([q.property({value:1})],f.prototype,"baseOpacity",null);a([q.property({readOnly:!0})],f.prototype,"overlayManager",void 0);a([q.property({readOnly:!0})],f.prototype,"manifold",void 0);a([q.property()],f.prototype,"maxTextureScale",void 0);a([q.property({readOnly:!0})],f.prototype,"ready",null);a([q.property({value:1})],f.prototype,"renderOrder",null);
a([q.property({readOnly:!0})],f.prototype,"rootTiles",void 0);a([q.property({value:!0})],f.prototype,"skirtScale",null);a([q.property({readOnly:!0,dependsOn:["tilingScheme.spatialReference"]})],f.prototype,"spatialReference",null);a([q.property({})],f.prototype,"backgroundImage",void 0);a([q.property({type:g})],f.prototype,"backgroundColor",void 0);a([q.property({dependsOn:["backgroundColor","backgroundImage"]})],f.prototype,"_background",null);a([q.property({value:!1})],f.prototype,"slicePlaneEnabled",
null);a([q.property({readOnly:!0})],f.prototype,"tilingScheme",void 0);a([q.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],f.prototype,"tilingSchemeLocked",void 0);a([q.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],f.prototype,"tilingSchemeDone",void 0);a([q.property({readOnly:!0})],f.prototype,"tilingSchemeLogic",void 0);a([q.property({value:!0})],f.prototype,"velvetOverground",null);a([q.property({value:!1})],f.prototype,"wireframe",null);return f=
a([q.subclass("esri.views.3d.terrain.TerrainSurface")],f)}(q.declared(b,r.Evented));var X=1.2,ba=80/180*Math.PI,ca=110/180*Math.PI,Z=12,da=t.vec4f64.create(),U=u.create(),ia=[0,0,0],ea={spatialReference:null,tile:null,extent:null},aa={spatialReference:null,extent:null,scale:0};return p})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/on ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../symbols/SimpleMarkerSymbol ../state/utils/viewUtils ../support/debugFlags ../support/debugFlags ../support/earthUtils ../support/mathUtils ../support/projectionUtils ../webgl-engine/lib/localOrigin ../webgl-engine/lib/Selector".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B){var C=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],D=d.getLogger("esri.views.3d.OverlayManager"),E,G=function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;a._handles=new c;a._overlaySR=null;a._renderSR=null;a._overlaySREqualsRenderSR=!0;a._connectedLayers={};a._scale=0;a._dirty=!1;a._isSpherical=!1;a._latestOriginId=0;a.opacity=0;return a}
k(e,d);Object.defineProperty(e.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});e.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.getDrapedTextureRenderer();this._renderer.onHasHighlightsChanged=function(){return a.onHasHighlightsChanged()};this._renderer.onContentChanged=function(){return a.setOverlayDirty()};this._renderer.forceUpdate=function(b){return a.updateOverlays(b)};this.groundSelector=
new B(this.view.viewingMode);this.groundSelector.enableBackfacesTerrain=!0;this.groundSelector.enableInvisibleTerrain=!0;this.groundSelector.enableHUDSelection=!1;this._handles.add(this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location"],function(){return a.setOverlayDirty()}));this._handles.add(this.view.on("resize",function(){return a.setOverlayDirty()}))};e.prototype.destroy=function(){for(var a in this._connectedLayers)this.unregisterLayerView(this._connectedLayers[a].layerView);
this._disposeOverlays();this._handles&&(this._handles.destroy(),this._handles=null)};e.prototype.onHasHighlightsChanged=function(){this.setOverlayDirty();this.notifyChange("hasHighlights")};e.prototype.hasOverlays=function(){return!!this._overlays};e.prototype.setSpatialReference=function(a,b){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._longitudeCyclical=(this._isSpherical=b)?a.isWebMercator?new x.Cyclical(-2.0037508342788905E7,
2.0037508342788905E7):new x.Cyclical(-180,180):null):(this._disposeOverlays(),this._longitudeCyclical=null)};e.prototype.registerLayerView=function(a){var b=this,c=a.layer.uid;if(this._connectedLayers[c])D.warn("[OverlayManager#registerLayerView]: Layer "+c+" is already connected");else{var d=g(a,"draped-data-change",function(){return b.setOverlayDirty()});this._connectedLayers[c]={eventHandles:[d],layerView:a};a.setDrapingExtent&&this._overlays&&[this._overlays.inner,this._overlays.outer].forEach(function(c,
d){a.setDrapingExtent(d,c.extent,b._overlaySR,c.resolution,c.renderLocalOrigin)});this.setOverlayDirty();this._setLayerViewOverlayUpdating(a,this._dirty)}};e.prototype.unregisterLayerView=function(a){for(var b in this._connectedLayers){var c=this._connectedLayers[b];if(c.layerView===a){if(c.eventHandles)for(var d=0;d<c.eventHandles.length;d++)c.eventHandles[d].remove();delete this._connectedLayers[b];this.setOverlayDirty();a.destroyed||(a.overlayUpdating=!1)}}};e.prototype.setOverlayDirty=function(){this._dirty||
(this._setOverlayUpdating(!0),this._dirty=!0)};e.prototype._setLayerViewOverlayUpdating=function(a,b){if(!b||!a.suspended&&a.hasDraped)a.overlayUpdating=b};e.prototype._setOverlayUpdating=function(a){for(var b in this._connectedLayers)this._setLayerViewOverlayUpdating(this._connectedLayers[b].layerView,a);if(b=this.view.graphicsView)b.overlayUpdating=a};e.prototype.updateOverlays=function(a){void 0===a&&(a=this.view.state.camera);if(this._overlaySR){var b;b=x.nextHighestPowerOfTwo(Math.max(a.fullWidth,
a.fullHeight)+256);var c=Math.min(b,2048);this._computeOverlayExtents(a,b,P);this._overlays||this._initOverlays();this._updateOverlay(this._overlays.inner,0,P.inner,c);this._updateOverlay(this._overlays.outer,1,P.outer,c);this.opacity=1;this._setOverlayUpdating(!1);this._drawOverlays();this.terrainSurface._updateTileOverlayParams();this._dirty=!1}};e.prototype._updateOverlay=function(a,b,c,d){var e;a:{e=a.extent;for(var g=u.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS?0:G.EXTENTS_DIFFER_THRESHOLD*Math.max(c[2]-
c[0],c[3]-c[1],e[2]-e[0],e[3]-e[1]),h=0;4>h;h++)if(Math.abs(e[h]-c[h])>g){e=!0;break a}e=!1}if(e||d!==a.resolution){n.set(a.extent,c);a.resolution=d;e=n.center(a.extent);a.renderLocalOrigin=w.fromValues(e[0],e[1],0,"OV_"+this._latestOriginId++);for(var f in this._connectedLayers)e=this._connectedLayers[f].layerView,e.setDrapingExtent&&e.setDrapingExtent(b,c,this._overlaySR,d,a.renderLocalOrigin)}};e.prototype.overlaysNeedUpdate=function(){return this._dirty&&!!this._overlaySR};e.prototype.updateOpacity=
function(a){var b=1;if(this._overlays){var c=this._scale;3.5*a<c&&(b=Math.sqrt(x.clamp((a-c/10)/(c/3.5-c/10),0,1)))}return b};e.prototype.setOverlayParamsOfTile=function(a,b,c){var d=this._overlays.inner,e=this._overlays.outer;a=n.intersection(a.extent,a.parentSurface.extent,O);this._rectInsideRect(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1])):this._rectanglesOverlap(a,d.extent)?(this._setTileOverlayData(a,d,b.overlays[0]),this._setTileOverlayData(a,
e,b.overlays[1])):(this._rectanglesOverlap(a,e.extent)?this._setTileOverlayData(a,e,b.overlays[0]):this._invalidateTileOverlayData(b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1]));b.overlayOpacity=void 0!==c?c:1};e.prototype._setTileOverlayData=function(a,b,c){var d=b.extent;c.texScale[0]=(a[2]-a[0])/(d[2]-d[0]);c.texScale[1]=(a[3]-a[1])/(d[3]-d[1]);var e=a[0];if(this._longitudeCyclical){var e=this._longitudeCyclical.minimalMonotonic(d[0],e),g=this._longitudeCyclical.minimalMonotonic(d[0],
a[2]);e>g&&(e=g-(a[2]-a[0]))}c.texOffset[0]=(e-d[0])/(d[2]-d[0]);c.texOffset[1]=(a[1]-d[1])/(d[3]-d[1]);c.renderTargetId=b.valid?b.renderTargetId:null;c.highlightRenderTargetId=b.highlightValid?b.highlightRenderTargetId:null};e.prototype._invalidateTileOverlayData=function(a){a.renderTargetId=null;a.highlightRenderTargetId=null};e.prototype.overlayPixelSizeInMapUnits=function(a){var b;this._overlays&&(b=this._pointIsInExtent(a,this._overlays.inner.extent)?this._overlays.inner:this._overlays.outer);
return b?(b.extent[2]-b.extent[0])/b.resolution:0};e.prototype._createEmptyOverlay=function(a){var b=this._renderer.createRenderTarget("overlay"+a);a=this._renderer.createHighlightRenderTarget("overlayHighlight"+a);return{extent:n.create(),resolution:0,renderTargetId:b,valid:!1,highlightRenderTargetId:a,highlightValid:!1,renderLocalOrigin:w.fromValues(0,0,0,"O")}};e.prototype._initOverlays=function(){this._overlays={inner:this._createEmptyOverlay(0),outer:this._createEmptyOverlay(1)}};e.prototype._disposeOverlays=
function(){this._overlays&&(this._renderer.disposeRenderTarget(this._overlays.inner.renderTargetId),this._renderer.disposeRenderTarget(this._overlays.inner.highlightRenderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.renderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.highlightRenderTargetId),this._overlays=null)};e.prototype._intersectGroundFromView=function(a,b,c,d){var e=l.vec3f64.fromValues(b*a.fullWidth,c*a.fullHeight,1);a.unprojectPoint(e,e);b=l.vec3f64.fromValues(b*
a.fullWidth,c*a.fullHeight,0);a.unprojectPoint(b,b);this.groundSelector.init([],b,e,null,a,null,!1);this.view.basemapTerrain.intersect(this.groundSelector,null,b,e);return this.groundSelector.minResult.getIntersectionPoint(d)};e.prototype._findHorizonBasedPointOfInterest=function(a,b,c){var d=.5;if("global"===this.view.viewingMode){d=l.vec3f64.clone(a.eye);l.vec3.normalize(d,d);l.vec3.negate(d,d);b=l.vec3.length(b);b=Math.asin(b/l.vec3.length(a.eye));var e=Math.acos(l.vec3.dot(a.viewForward,d)),d=
x.clamp((b-(e-.5*a.fovY))/a.fovY,0,1);b=x.clamp((-b-(e-.5*a.fovY))/a.fovY,0,1);d=1===d&&0===b?.5:b+.55*(d-b)}else d=l.vec4f64.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0),d=l.vec4.transformMat4(d,d,a.projectionMatrix)[1],d=x.clamp(.5+.5*d,0,1),d=1===d||0===d?.5:0<a.eye[2]?.55*d:1-.55*(1-d);return this._intersectGroundFromView(a,.5,d,c)?!0:!1};e.prototype._computeOverlayExtents=function(a,c,d){var e=this.terrainSurface.extent,g=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,
f=l.vec3f64.create();this._findHorizonBasedPointOfInterest(a,g,f)||l.vec3.copy(f,g);this._scale=this.view.renderCoordsHelper.getAltitude(a.eye);var k=l.vec3.distance(a.eye,f),g=t.viewAngle(this.view.renderCoordsHelper,g,a.eye),g=Math.PI/2-Math.abs(g-Math.PI/2);if(r.OVERLAY_SHOW_CENTER){var m=new q({color:[255,0,0],outline:{color:[255,255,255],width:2}}),u=new h;z.vectorToPoint(f,this._renderSR,u,this._overlaySR);m=new b({geometry:u,symbol:m});void 0!==E&&this.view.graphics.remove(E);this.view.graphics.add(m);
E=m}this._overlaySREqualsRenderSR||z.vectorToVector(f,this._renderSR,f,this._overlaySR);c=c*a.perPixelRatio*k;u=!1;k=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(c/=Math.cos(z.webMercator.y2lat(f[1])),k=this.terrainSurface.extent[3],k*=.999):(u=!0,c/=y.metersPerDegree,k=90),c>=k&&(c=k,f[1]=0,this._overlaySR.isWebMercator&&(f[0]=0)));m=1;u&&(m=1/Math.max(.2,Math.cos(Math.abs(x.deg2rad(f[1])))),180<c*m&&(m=180/c));var w=c*m,u=d.inner;u[0]=f[0]-w;u[1]=f[1]-c;u[2]=f[0]+w;u[3]=f[1]+c;this._isSpherical&&
this._shiftExtentToFitBounds(u,Infinity,k);d=d.outer;n.set(d,u);6*w>e[2]-e[0]?n.set(d,e):g<=.25*Math.PI?(d[0]-=w,d[1]-=c,d[2]+=w,d[3]+=c):(z.vectorToVector(a.eye,this._renderSR,M,this._overlaySR),l.vec2.subtract(S,f,M),a=-Math.atan2(S[1],S[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),l.vec4.scale(S,C[Math.floor(a/(.25*Math.PI))],2*c),S[0]*=m,S[2]*=m,l.vec4.add(d,d,S));this._isSpherical&&(d[0]=this._longitudeCyclical.clamp(d[0]),d[2]=this._longitudeCyclical.clamp(d[2]),d[1]=Math.max(d[1],-k),d[3]=Math.min(d[3],
k));!this._isSpherical&&e&&(a=n.intersection(u,e,O),e=n.intersection(d,e,W),n.contains(a,e)&&(d[2]=d[0],d[3]=d[1]))};e.prototype._drawOverlays=function(){var a=this._overlays.inner.extent[2]-this._overlays.inner.extent[0];this._drawOverlay(this._overlays.inner,0,a);this._drawOverlay(this._overlays.outer,1,a)};e.prototype._drawOverlay=function(a,b,c){var d=this._renderer,e=a.extent,g=a.resolution,h=this._longitudeCyclical?e[2]>this._longitudeCyclical.max:!1,f=this._longitudeCyclical?e[0]<this._longitudeCyclical.min:
!1;if(h||f){H.views=N;var f=void 0,f=h?this._longitudeCyclical.max-e[0]:this._longitudeCyclical.min-e[0],f=Math.round(f/(e[2]-e[0])*g),k=H.views[0];l.vec4.set(k.viewport,0,0,f,g);l.vec4.set(k.extent,e[0],e[1],this._longitudeCyclical.max,e[3]);h||(k.extent[0]+=this._longitudeCyclical.range);k=H.views[1];l.vec4.set(k.viewport,f,0,g-f,g);l.vec4.set(k.extent,this._longitudeCyclical.min,e[1],e[2],e[3]);h&&(k.extent[2]-=this._longitudeCyclical.range)}else H.views=I,n.set(H.views[0].extent,e),l.vec4.set(H.views[0].viewport,
0,0,g,g);H.width=g;H.height=g;H.pixelRatio=c/(e[2]-e[0]);H.index=b;a.valid=d.draw(a.renderTargetId,H);a.highlightValid=d.drawHighlights(a.highlightRenderTargetId,H)};e.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):n.intersects(a,b)};e.prototype._rectInsideRect=function(a,b){return this._longitudeCyclical?
this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:n.contains(b,a)};e.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};e.prototype._shiftExtentToFitBounds=function(a,b,c){var d=0,e=0;a[0]<-b?d=a[0]+b:a[2]>b&&(d=b-a[2]);a[1]<-c?e=a[1]+c:a[3]>c&&(e=c-a[3]);n.offset(a,d,e)};e.EXTENTS_DIFFER_THRESHOLD=
1E-5;a([m.property()],e.prototype,"view",void 0);a([m.property()],e.prototype,"terrainSurface",void 0);a([m.property({type:Boolean})],e.prototype,"hasHighlights",null);return e=a([m.subclass("esri.views.3d.terrain.OverlayManager")],e)}(m.declared(e)),H={width:0,height:0,pixelRatio:0,views:null,index:0},I=[{viewport:n.create(),extent:n.create()}],N=[I[0],{viewport:n.create(),extent:n.create()}],S=l.vec4f64.create(),M=l.vec3f64.create(),P={inner:n.create(),outer:n.create()},O=n.create(),W=n.create();
return G})},"esri/views/3d/terrain/PlanarTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingBox ../support/geometryUtils ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),function(p,f,k,a,g,b,e,c,d,m){p=function(d){function g(a,b,c,e){var h=d.call(this,g.NumSubdivisionsAtLevel)||this;h.tileUp=l;void 0!==a&&h.init(a,b,c,e);return h}k(g,d);g.prototype.init=function(a,
b,e,g){d.prototype.init.call(this,a,b,e,g);this.edgeLen=this.extent[2]-this.extent[0];this.edgeLen2=this.edgeLen*this.edgeLen;this.curvatureHeight=0;this.centerAtSeaLevel[0]=c.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=c.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};g.prototype.updateRadiusAndCenter=function(){d.prototype.updateRadiusAndCenter.call(this);var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,b=.5*(this.elevationBounds[0]-
this.elevationBounds[1]);this.radius=Math.sqrt(a*a+b*b)};g.prototype.isVisible=function(a){return this.intersectsClippingArea?e.frustum.intersectsAABB(a,b.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1])):!1};g.prototype.createGeometry=function(a,b,c){a.needsUpdate=!1;m.createPlanarGlobeTile(a.numVertsPerRow,this.extent,a.samplerData,b,c,a.clippingArea,this.renderData);this.updateMemoryUsed()};g.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,
2];g.Pool=new a(g);return g}(d);var l=g.vec3f64.fromValues(0,0,1);return p})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingRect ../support/mathUtils ../support/buffer/typedArrayUtil ./ElevationData ./ElevationTileAgent ./MapTileAgent ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./tileUtils ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r){function y(a){a instanceof d?d.Pool.release(a):a instanceof m&&m.Pool.release(a)}var x=h.weakAssert,z=a.vec3f64.create(),w=a.vec3f64.create(),B=a.vec4f64.create(),C=a.vec3f64.create(),D=n.AGENT_DONE;return function(){function f(b){this.lij=[0,0,0];this.extent=g.create();this.elevationBounds=a.vec2f64.create();this.children=[null,null,null,null];this.layerInfo=Array(l.LayerClass.COUNT);this.extentWGS84Rad=g.create();this.centerAtSeaLevel=a.vec3f64.create();
this.center=a.vec3f64.create();this.tileUp=C;this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this._memoryUsed=this.radius=this.edgeLen2=this.edgeLen=this.renderOrder=this.screenDepth=this._maxTesselation=0;this.numSubdivisionsAtLevel=b}Object.defineProperty(f.prototype,"memoryUsed",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});f.prototype.init=function(b,c,d,e){this.lij[0]=b[0];this.lij[1]=b[1];this.lij[2]=b[2];e.getExtent(b[0],b[1],b[2],
this.extent,this.extentWGS84Rad);this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this.radius=this.edgeLen2=this.edgeLen=0;this.vlevel=b?b[0]:0;c&&c.elevationBounds?a.vec2.copy(this.elevationBounds,c.elevationBounds):a.vec2.set(this.elevationBounds,0,0);this.pendingUpdates=0;this.renderData=null;this.screenDepth=0;this.visible=!1;this.parent=c;this.parentSurface=d;for(b=0;4>b;b++)this.children[b]=null;for(b=0;b<l.LayerClass.COUNT;b++)if(d){c=d.numLayers(b);var g=void 0;
this.layerInfo[b]?(g=this.layerInfo[b],g.length=c):(g=Array(c),this.layerInfo[b]=g);for(var h=0;h<c;h++)g[h]=q.makeEmptyLayerInfo(b,g[h]),b===l.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(h,-1)}else this.layerInfo[b]=null;this.computeElevationBounds();this._maxTesselation=Math.min(e.pixelSize[0],l.MAX_TILE_TESSELATION)};f.prototype.dispose=function(){for(var a=0;a<l.LayerClass.COUNT;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++)c[b].dispose();this.updateMemoryUsed()};f.prototype.updateMemoryUsed=
function(){for(var a=this.parentSurface.tilingScheme.pixelSize,a=a[0]*a[1]*4,b=this._memoryUsed=0,c=this.layerInfo[l.LayerClass.MAP];b<c.length;b++){var d=c[b],d=d.data;d instanceof r?this._memoryUsed+=1.3*d.descriptor.width*d.descriptor.height*4:d instanceof HTMLImageElement?this._memoryUsed+=a:d instanceof u&&(this._memoryUsed+=d.getGpuMemoryUsage()+d.getCpuMemoryUsage())}b=0;for(c=this.layerInfo[l.LayerClass.ELEVATION];b<c.length;b++)d=c[b],this._memoryUsed+=d.data?a:0;this.renderData&&(this._memoryUsed+=
this.renderData.estimateGeometryMemoryUsage(),a=this.renderData.texture?this.renderData.texture.descriptor:null)&&(this._memoryUsed+=1.3*a.width*a.height*4)};f.prototype.updateScreenDepth=function(b){a.vec3.copy(B,this.center);B[3]=1;a.vec4.transformMat4(B,B,b);this.screenDepth=B[2]/B[3]};f.prototype.shouldSplit=function(c,d){var e=this.lij[0];a.vec3.subtract(z,this.center,d);var g=a.vec3.squaredLength(z),h=c[4];if(g<this.edgeLen2&&e<h)return l.TileUpdateTypes.SPLIT;var f=c[1],g=2*Math.sqrt(g),k=
this.edgeLen/(c[0]*g);return k<f?this.vlevel!==this.lij[0]?(this.vlevel=this.lij[0],l.TileUpdateTypes.VSPLITMERGE):l.TileUpdateTypes.NONE:e>=h?(c=e+Math.ceil(-b.log2(f/k)),c!==this.vlevel?(this.vlevel=c,l.TileUpdateTypes.VSPLITMERGE):l.TileUpdateTypes.NONE):6<e&&(a.vec3.scale(w,this.tileUp,a.vec3.dot(this.tileUp,z)),a.vec3.subtract(w,w,z),e=a.vec3.squaredLength(w),e>this.radius*this.radius&&(a.vec3.scale(w,w,this.radius/Math.sqrt(e)),a.vec3.add(w,w,this.center),a.vec3.subtract(w,d,w),d=this.elevationBounds[1]-
this.elevationBounds[0],Math.min(1,(Math.abs(a.vec3.dot(w,this.tileUp))+.5*d+this.curvatureHeight)/a.vec3.length(w))*(this.edgeLen/(c[2]*g))<.1/c[5]*c[3]))?l.TileUpdateTypes.NONE:l.TileUpdateTypes.SPLIT};f.prototype.decodeElevationData=function(a){var b;if(e.isArrayBuffer(a))try{b=c.createFromLERC(this.lij,this.extent,a,l.noDataValueOpt)}catch(I){console.warn("Error decoding raw data: %s",I.message)}else b=c.createFromFetchTileResult(this.lij,this.extent,a);return b};f.prototype.getWGS84Extent=function(){var a=
this.extentWGS84Rad;return g.fromValues(b.rad2deg(a[0]),b.rad2deg(a[1]),b.rad2deg(a[2]),b.rad2deg(a[3]))};f.prototype.load=function(a){for(var b=0;b<l.LayerClass.COUNT;b++)this.layerInfo[b]&&this._createOrUpdateAgents(0,b);a.loadTile(this)};f.prototype.unload=function(a){this.renderData&&a.unloadTile(this);for(a=0;a<l.LayerClass.COUNT;a++)for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==D&&(d.loadingAgent.dispose(),y(d.loadingAgent),d.loadingAgent=null);
d.pendingUpdates=0}this.pendingUpdates&=~l.TileUpdateTypes.UPDATE_GEOMETRY;this.pendingUpdates&=~l.TileUpdateTypes.UPDATE_TEXTURE};f.prototype.updateClippingStatus=function(a){if(k.equals(a,this.clippingArea))return!1;var b=this.intersectsClippingArea,c=this.isWithinClippingArea;a?(this.intersectsClippingArea=this.intersectsExtent(a),this.isWithinClippingArea=this.isWithinExtent(a)):this.isWithinClippingArea=this.intersectsClippingArea=!0;this.clippingArea=a;a=c&&this.isWithinClippingArea;b=!c&&!b&&
!this.isWithinClippingArea&&!this.intersectsClippingArea;!this.renderData||a||b||this.updateGeometry();return!0};f.prototype.updateVisibility=function(a){a=this.isVisible(a)&&this.intersectsClippingArea;if(a!==this.visible){this.visible=a;for(var b=this.layerInfo[0],c=0;c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==D&&d.loadingAgent.setSuspension(!a)}}return a};f.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};f.prototype.hasLayerData=function(a,b){return(a=this.layerInfo[b][a])&&
a.data&&!a.dataInvalidated};f.prototype.hasDataAvailable=function(a,b,c){return(b=this.layerInfo[c][b].tilemap)?"unavailable"!==b.getAvailability(a.lij[1],a.lij[2]):!0};f.prototype.requestLayerData=function(a,b,c){l.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",
this.lij.toString(),c.tile.lij.toString(),b,a),!0;d.waitingAgents.push(c);if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),setTimeout(c.dataArrived.bind(c,this),0),!0;if(d.pendingUpdates&l.TileUpdateTypes.DECODE_ELEVATION||d.requestPromise)return!0;var e=this.parentSurface.requestTileData(this,a,b);if(!e||e.isFulfilled())return!1;a=function(){d.requestPromise===e&&(d.requestPromise=
null)};d.requestPromise=e;e.then(a,a);return!0};f.prototype.descendants=function(a){a||(a=[]);for(var b=0;4>b;b++){var c=this.children[b];c&&(c.descendants(a),a.unshift(this.children[b]))}return a};f.prototype.hasLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};f.prototype.findByLij=function(a){if(this.hasLij(a))return this;for(var b=0;4>b;b++){var c=this.children[b];if(c&&(c=c.findByLij(a)))return c}return null};f.prototype.unrequestLayerData=function(a,b,c){l.TILE_LOADING_DEBUGLOG&&
console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a],e=d.waitingAgents;c=null!=k.removeUnordered(e,c);x(c,"agent has not requested this piece of map data");1>e.length&&(e=d.requestPromise,c=!1,b===l.LayerClass.MAP&&(c=this.parentSurface.layerViewByIndex(a,l.LayerClass.MAP),c=h.isVectorTileLayerView(c)),c||x(e||d.rawData,"no pending operations on layerInfo that agents were waiting for"),e&&!e.isFulfilled()&&(e.cancel(),d.requestPromise=
null),l.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),b,a),this.updateMemoryUsed())};f.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0;this.updateMemoryUsed()};f.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),b,a);a=this.layerInfo[b][a];
a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing(this);a.waitingAgents.length=0;this.updateMemoryUsed()};f.prototype.updateTexture=function(a){void 0===a&&(a=!1);this.renderData&&(a?this.parentSurface.renderer.updateTileTexture(this):(this.pendingUpdates|=l.TileUpdateTypes.UPDATE_TEXTURE,this.parentSurface.setPendingUpdates()))};f.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)};f.prototype.computeElevationBounds=
function(){a.vec2.set(this.elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);for(var b=this.layerInfo[l.LayerClass.ELEVATION],c=!1,d=0;d<b.length;d++){var e=b[d];e.elevationBounds&&(this.elevationBounds[0]=Math.min(this.elevationBounds[0],e.elevationBounds[0]),this.elevationBounds[1]=Math.max(this.elevationBounds[1],e.elevationBounds[1]),c=!0)}c||a.vec2.set(this.elevationBounds,0,0);this.updateRadiusAndCenter()};f.prototype.updateRadiusAndCenter=function(){a.vec3.scale(w,this.tileUp,.5*(this.elevationBounds[0]+
this.elevationBounds[1]));a.vec3.add(this.center,this.centerAtSeaLevel,w)};f.prototype.findElevationBoundsForLayer=function(b,c){var d=this.layerInfo[l.LayerClass.ELEVATION][b];if(!d.elevationBounds||d.elevationBounds[2]<c)if(c=this.parentSurface.layerViewByIndex(b,l.LayerClass.ELEVATION),t.fallsWithinLayer(this,c.layer,!1)){c=!1;if(d.data){var e=d.data;a.vec2.copy(B,e.bounds);B[2]=this.lij[0];c=!0}else{for(var g=this.parent,h=0,f=null,e=d.data;g&&(!e||h<l.ELEVATION_DESIRED_RESOLUTION_LEVEL);){h=
this.vlevel-g.lij[0];f=e||f;e=g.layerInfo[l.LayerClass.ELEVATION][b].data;if(!e&&f&&h>=l.ELEVATION_DESIRED_RESOLUTION_LEVEL)break;g=g.parent}if(e=e||f)e.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],B),Infinity!==B[0]&&(B[2]=e.level,c=!0)}c&&(d.elevationBounds?a.vec3.copy(d.elevationBounds,B):d.elevationBounds=[B[0],B[1],B[2]])}};f.prototype.updateGeometry=function(){this.pendingUpdates|=l.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface.setPendingUpdates()};f.prototype.modifyLayers=function(a,
b,c){for(var d=this.layerInfo[c],e=0;e<d.length;e++){var g=d[e];g.loadingAgent&&g.loadingAgent!==D&&(g.loadingAgent.dispose(),y(g.loadingAgent),g.loadingAgent=null);g.waitingAgents.length=0}if(c===l.LayerClass.MAP)for(e=0;e<d.length;++e)void 0===a[e]&&d[e].dispose();a=b.length;g=Array(a);for(e=0;e<a;e++){var h=b[e];g[e]=-1<h?d[h]:q.makeEmptyLayerInfo(c)}this.layerInfo[c]=g;this.updateMemoryUsed()};f.prototype.restartAgents=function(a){if(this.renderData)if(this._createOrUpdateAgents(0,a),a===l.LayerClass.ELEVATION){this.updateGeometry();
a=this.layerInfo[a];for(var b=0;b<a.length;b++)a[b].pendingUpdates|=l.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface.setPendingUpdates()}else this.updateTexture(!0)};f.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent===D&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};f.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==D&&a.loadingAgent.dispose();a.loadingAgent=
null};f.prototype.agentDone=function(a,b){var c=this.layerInfo[b],d=c[a];d.loadingAgent=D;d.data||d.upsampleFromTile||a<c.length-1&&this._createOrUpdateAgents(a+1,b)};f.prototype._createOrUpdateAgents=function(a,b){for(var c=b===l.LayerClass.ELEVATION?!1:!this.visible,e=this.layerInfo[b];a<e.length;++a){var g=e[a],h=!1,f=this.parentSurface.layerViewByIndex(a,b);if(g.loadingAgent)g.loadingAgent!==D&&(h=g.loadingAgent.update());else if(t.fallsWithinLayer(this,f.layer,!1)){var k;k=b===l.LayerClass.ELEVATION?
d.Pool.acquire():m.Pool.acquire();(h=k.init(this,a,b,c))?g.loadingAgent=k:(k.dispose(),y(k),g.loadingAgent=D)}if(h&&f.isOpaque)break}};f.prototype.geometryState=function(a){var c,d=this._getElevationInfo(a?a.samplerData:null),e=this.lij[0];d.samplerData?(c=this.vlevel-e,c=Math.max(e-d.maxTileLevel,l.ELEVATION_DESIRED_RESOLUTION_LEVEL-c),e=this._maxTesselation,c=b.clamp((e>>c)+1,2,e+1)):c=8>e?this.numSubdivisionsAtLevel[e]+1:2;e=this.clippingArea;if(!this.intersectsClippingArea||this.isWithinClippingArea)e=
null;a?(a.needsUpdate=!1,a.numVertsPerRow!==c&&(a.numVertsPerRow=c,a.needsUpdate=!0),d.changed&&(a.samplerData=d.samplerData,a.needsUpdate=!0),k.equals(a.clippingArea,e)||(a.clippingArea=e,a.needsUpdate=!0)):a={numVertsPerRow:c,samplerData:d.samplerData,needsUpdate:!0,clippingArea:e};return a};f.prototype._getElevationInfo=function(a){for(var b=this.layerInfo[l.LayerClass.ELEVATION],c=b.length,d=Array(c),e=0,g=0,h=!1,f=0;f<c;f++){var k=b[f];if(k.upsampleFromTile){var k=k.upsampleFromTile.tile,m=k.layerInfo[l.LayerClass.ELEVATION][f].data;
a&&a[e]===m.samplerData||(h=!0);d[e++]=m.samplerData;g=Math.max(g,k.lij[0])}else k.data&&(m=this.parentSurface.layerViewByIndex(f,l.LayerClass.ELEVATION),t.fallsWithinLayer(this,m.layer,!1)&&(m=k.data,a&&a[e]===m.samplerData||(h=!0),d[e++]=m.samplerData,g=this.lij[0]))}a&&a.length!==e&&(h=!0);0<e?d.length=e:d=null;return{changed:h,samplerData:d,maxTileLevel:g}};f.prototype.isWithinExtent=function(a){var b=this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};f.prototype.intersectsExtent=
function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};return f}()})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../../../layers/support/rasterFormats/LercCodec","../support/mathUtils","./TerrainConst"],function(p,f,k,a,g){return function(){function b(a,b,d,g){this.samplerData=null;this.level=a;this.i=b;this.j=d;this.extent=g}b.prototype.computeMinMaxValue=function(b,c,d,f){var e=Infinity,h=-Infinity;b-=this.level;var k=Math.pow(2,b);
if(Math.floor(c/k)===this.i&&Math.floor(d/k)===this.j&&0<b){var m=this.samplerData.width,t=this.samplerData.pixelData,u=.5*g.ELEVATION_NODATA_VALUE;b=(m-1)/k;d=(d-this.j*k)*b;c=(c-this.i*k)*b;if(1>b){var k=Math.floor(d),r=Math.floor(c),y=k+r*m,p=t[y],z=t[y+1],w=t[y+m],y=t[y+m+1];if(p+z+w+y<u)return e=a.bilerp(p,z,w,y,d-k,c-r),h=a.bilerp(p,z,w,y,d-k+b,c-r),m=a.bilerp(p,z,w,y,d-k,c-r+b),b=a.bilerp(p,z,w,y,d-k+b,c-r+b),f[0]=Math.min(e,h,m,b),f[1]=Math.max(e,h,m,b),f;d=k;c=r;b=1}else d=Math.floor(d),
c=Math.floor(c),b=Math.ceil(b);for(k=d;k<=d+b;k++)for(r=c;r<=c+b;r++)y=k+r*m,p=t[y],p<u?(e=Math.min(e,p),h=Math.max(h,p)):(e=0<e?0:e,h=0>h?0:h)}f[0]=e;f[1]=h;return f};b.createFromLERC=function(a,c,d,g){d=k.decode(d,g);a=new b(a[0],a[1],a[2],c);a.samplerData={pixelData:d.pixelData,width:d.width,height:d.height,minValue:d.minValue,maxValue:d.maxValue,noDataValue:d.noDataValue,safeWidth:.99999999*(d.width-1),dx:(d.width-1)/(a.extent[2]-a.extent[0]),dy:(d.width-1)/(a.extent[3]-a.extent[1]),x0:a.extent[0],
y1:a.extent[3]};a.bounds=[a.samplerData.minValue,-3E38<a.samplerData.maxValue?a.samplerData.maxValue:0];return a};b.createFromFetchTileResult=function(a,c,d){a=new b(a[0],a[1],a[2],c);c=d.values;for(var e=d.noDataValue,g=Infinity,h=-Infinity,f=!0,k=0;k<c.length;k++){var t=c[k];t!==e&&(g=t<g?t:g,h=t>h?t:h,f=!1)}f&&(h=g=0);a.samplerData={pixelData:d.values,width:d.width,height:d.height,minValue:g,maxValue:h,noDataValue:e,safeWidth:.99999999*(d.width-1),dx:(d.width-1)/(a.extent[2]-a.extent[0]),dy:(d.width-
1)/(a.extent[3]-a.extent[1]),x0:a.extent[0],y1:a.extent[3]};a.bounds=[g,h];return a};return b}()})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgent ./UpsampleInfo".split(" "),function(p,f,k,a,g,b,e){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a._scaleRangeEnabled=!1;return a}k(c,b);c.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):
(this._unsetUpsamplingTile(),this.updateGeometry());this._dataRequested=null;this._requestNext()};c.prototype.updateGeometry=function(){this._tileLayerInfo.pendingUpdates|=g.TileUpdateTypes.UPDATE_GEOMETRY;this.tile.updateGeometry()};c.prototype._findAncestorWithData=function(){for(var a=this.layerClass,b=this.layerIdx,c=this.tile,d=c.vlevel,f;c&&!(c.layerInfo[a][b].data&&(f=c,d-c.lij[0]>=g.ELEVATION_DESIRED_RESOLUTION_LEVEL));)c=c.parent;return f?(a=e.Pool.acquire(),a.init(f,0,0,1),a):null};c.prototype._desiredMinLevelDelta=
function(){return g.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])};c.prototype._setUpsamplingTile=function(a){this._unsetUpsamplingTile();var b=e.Pool.acquire();b.init(a,0,0,1);this._tileLayerInfo.upsampleFromTile=b;this.updateGeometry()};c.Pool=new a(c);return c}(b)})},"esri/views/3d/terrain/TileAgent":function(){define(["require","exports","./tileUtils","./UpsampleInfo"],function(p,f,k,a){function g(b,c,d,f,l,h,k){if(!b.parent||6<k)return null;f*=.5;l*=.5;h*=.5;b.lij[2]&
1&&(l+=.5);0===(b.lij[1]&1)&&(h+=.5);return b.parent.hasLayerData(c,d)?(c=a.Pool.acquire(),c.init(b.parent,l,h,f),c):g(b.parent,c,d,f,l,h,k+1)}var b=Error("Abstract method called on TileAgent");return function(){function e(){}e.prototype.init=function(b,d,e,g){this.tile=b;this.layerIdx=d;this.layerClass=e;this.suspended=g;this._tileLayerInfo=b.getLayerInfo(d,e);this._dataRequested=null;(b=this._findAncestorWithData())?(this._setUpsamplingTile(b.tile),a.Pool.release(b)):this._unsetUpsamplingTile();
return this._requestNext(!0)};e.prototype.dispose=function(){this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null);this._tileLayerInfo=this.tile=null};e.prototype.setSuspension=function(a){a!==this.suspended&&((this.suspended=a)?this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null):this._tileLayerInfo.data||this.update())};e.prototype.update=function(){var b=this._findAncestorWithData(),
d=this._tileLayerInfo.upsampleFromTile;b&&(d&&b.tile!==d.tile&&this._setUpsamplingTile(b.tile),a.Pool.release(b));return this._requestNext()};e.prototype.dataArrived=function(a){throw b;};e.prototype.dataMissing=function(a){this._dataRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};e.prototype._agentDone=function(){this.tile.agentDone(this.layerIdx,this.layerClass);this.dispose()};e.prototype._requestNext=function(a){void 0===a&&(a=!1);if(this.suspended)return!0;var b=this._findNextDownload();
if(this._dataRequested){if(b===this._dataRequested)return!0;this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this);this._dataRequested=null}b?b.requestLayerData(this.layerIdx,this.layerClass,this)&&(this._dataRequested=b):a||this._agentDone();return!!this._dataRequested};e.prototype._findNextDownload=function(){for(var a=this.layerIdx,b=this.layerClass,g=this.tile.parentSurface.layerViewByIndex(a,b),f=g.minDataLevel,h=g.maxDataLevel,n=this._desiredMinLevelDelta(),q=e.START_LOADING_LEVEL_DELTA+
n,t=this._scaleRangeEnabled,u,r=this.tile,y=0,p=r.lij[0],z=this._tileLayerInfo.upsampleFromTile,z=z?z.tile.lij[0]:-1,w=this.tile.parentSurface,B=w.tilemapStats,C=w.getTilemapTile(r),D=!1;r&&(!t||k.fallsWithinLayer(r,g.layer,!1))&&r.lij[0]>=f;){var E=r.layerInfo[b][a];if(E.data&&y>=n){r.lij[0]>z&&this._setUpsamplingTile(r);E.dataInvalidated&&(u=r);break}if(C&&!C.hasDataAvailable(r,a,b))D=!0;else if(r.lij[0]<=h&&!E.data&&!E.dataMissing&&(u=r,y>=q))break;(r=r.parent)&&C&&(C=C.parent||w.getTilemapTile(r));
y++}u&&p-u.lij[0]<n&&this._tileLayerInfo.upsampleFromTile&&(u=null);!u&&D&&B.tilesNotPresent++;return u};e.prototype._findAncestorWithData=function(){return g(this.tile,this.layerIdx,this.layerClass,1,0,0,0)};e.prototype._desiredMinLevelDelta=function(){throw b;};e.prototype._setUpsamplingTile=function(a){throw b;};e.prototype._unsetUpsamplingTile=function(){this._tileLayerInfo.upsampleFromTile&&a.Pool.release(this._tileLayerInfo.upsampleFromTile);this._tileLayerInfo.upsampleFromTile=null};e.START_LOADING_LEVEL_DELTA=
4;e.AGENT_DONE=new e;return e}()})},"esri/views/3d/terrain/tileUtils":function(){define("require exports ../../../core/PooledArray ../../../core/libs/gl-matrix-2/gl-matrix ./UpsampleInfo ../webgl-engine/materials/internal/MaterialUtil".split(" "),function(p,f,k,a,g,b){function e(a){return a[0]+"/"+a[1]+"/"+a[2]}function c(a,b){b(a);for(var d=0;4>d;d++){var e=a.children[d];e&&c(e,b)}}function d(a,b){for(var c=0;4>c;c++){var e=a.children[c];e&&d(e,b)}b(a)}Object.defineProperty(f,"__esModule",{value:!0});
p=function(){function a(){this.q=new k;this._last=null;this.done=!0}a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null;this.done=!1};a.prototype.reset=function(a){this.q.clear();a&&this.q.pushArray(a);this._last=null;this.done=0===this.q.length};a.prototype.skipSubtree=function(){this._last=null;0===this.q.length&&(this.done=!0)};a.prototype.next=function(){if(this.done)return null;if(this._last){var a=this._last.children;if(a[0])for(var b=3;0<=b;b--){var c=a[b];c&&this.q.push(c)}}this._last=
this.q.pop();0!==this.q.length||this._last.children[0]||(this.done=!0);return this._last};return a}();f.IteratorPreorder=p;p=function(){function a(){this.q=new k;this.done=!0}a.prototype.reset=function(a){this.q.clear();if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a)for(var b=this.q.data[a],c=0;4>c;c++){var d=b.children[c];d&&this.q.push(d)}this.done=0===this.q.length};a.prototype.next=function(){var a=this.q.pop();this.done=0===this.q.length;return a};return a}();f.IteratorPostorder=p;f.lij2str=
e;f.tile2str=function(a){return e(a.lij)};f.traverseTilesPreorder=function(a,b){if(Array.isArray(a))for(var d=0;d<a.length;d++)c(a[d],b);else c(a,b)};f.traverseTilesPostorder=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)d(a[c],b);else d(a,b)};f.fallsWithinLayer=function(a,b,c){if(!b)return!1;var d=b.fullExtent,e=a.extent;if(c){if(e[0]<d.xmin||e[1]<d.ymin||e[2]>d.xmax||e[3]>d.ymax)return!1}else if(d.xmin>e[2]||d.ymin>e[3]||d.xmax<e[0]||d.ymax<e[1])return!1;a=a.parentSurface.tilingScheme.levels[a.lij[0]].scale;
return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};f.isPosWithinTile=function(a,b){a=a.extent;return b[0]>=a[0]&&b[1]>=a[1]&&b[0]<=a[2]&&b[1]<=a[3]};f.getTileNLevelsUp=function(a,b){for(;b--;)a=a.parent;return a};f.nextTileInAncestry=function(a,b){var c=a.lij[0]-b.lij[0]-1,d=a.lij[2]>>c,e=0;a.lij[1]>>c&1&&(e+=2);d&1&&(e+=1);return b.children[e]};f.computeUpsampleInfoForAncestor=function(a,b){for(var c=1,d=0,e=0;a!==b;)if(c*=.5,d*=.5,e*=.5,a.lij[2]&1&&(d+=.5),
0===(a.lij[1]&1)&&(e+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of ancestorTile");a=g.Pool.acquire();a.init(b,d,e,c);return a};f.hasVisibleSiblings=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.parent;if(d)for(var e=0;4>e;e++){var g=d.children[e];if(g&&g!==c&&g.visible)return!0}}return!1};var m=Math.pow(2,-52),l=a.vec3f64.create(),h=a.vec3f64.create();f.intersectSkirts=function(c,d,e,g,f,k,p,z,w){var n=k.data,q=k.offsetIdx;k=k.strideIdx;var r=c[0],u=c[1];c=c[2];var t=
d[0]-r,y=d[1]-u;for(d=d[2]-c;e<g;e++){var x=p?p[e]:e,N=q+k*f[3*x],S=q+k*f[3*x+1],M=q+k*f[3*x+2],P=n[N],O=n[N+1],W=n[N+2];2<=n[N+3]&&(a.vec3.set(l,P,O,W),z(l),P+=l[0],O+=l[1],W+=l[2]);var Q=n[S],N=n[S+1],J=n[S+2];2<=n[S+3]&&(a.vec3.set(l,Q,N,J),z(l),Q+=l[0],N+=l[1],J+=l[2]);var S=n[M],F=n[M+1],K=n[M+2];2<=n[M+3]&&(a.vec3.set(l,S,F,K),z(l),S+=l[0],F+=l[1],K+=l[2]);var M=Q-P,N=N-O,J=J-W,S=S-P,F=F-O,K=K-W,L=y*K-F*d,T=d*S-K*t,R=t*F-S*y,Q=M*L+N*T+J*R,P=r-P,X=u-O,ba=c-W,W=X*J-N*ba,O=ba*M-J*P,ca=P*N-M*X;
if(Q>m){P=P*L+X*T+ba*R;if(0>P||P>Q)continue;L=t*W+y*O+d*ca;if(0>L||P+L>Q)continue}else if(Q<-m){P=P*L+X*T+ba*R;if(0<P||P<Q)continue;L=t*W+y*O+d*ca;if(0<L||P+L<Q)continue}else continue;W=(S*W+F*O+K*ca)/Q;0<=W&&(M=b.computeNormal(M,N,J,S,F,K,h),w(W,M,x))}}})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/ObjectPool","../../../core/libs/gl-matrix-2/gl-matrix"],function(p,f,k,a){return function(){function g(b,e,c,d){this.scale=0;this.tile=null;this.offset=
a.vec2f64.create();void 0!==b&&this.init(b,e,c,d)}g.prototype.init=function(a,e,c,d){this.tile=a;this.offset[0]=e;this.offset[1]=c;this.scale=d};g.prototype.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};g.Pool=new k(g);return g}()})},"esri/views/3d/terrain/MapTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TileAgent ./tileUtils".split(" "),function(p,f,k,a,g,b){return function(e){function c(){var a=e.call(this)||
this;a._scaleRangeEnabled=!0;return a}k(c,e);c.prototype.dataArrived=function(a){a===this.tile?(this._unsetUpsamplingTile(),this.tile.updateTexture()):this._setUpsamplingTile(a);this._dataRequested=null;a!==this.tile&&this._requestNext()};c.prototype._desiredMinLevelDelta=function(){return 0};c.prototype._setUpsamplingTile=function(a){this._tileLayerInfo.upsampleFromTile&&this._tileLayerInfo.upsampleFromTile.tile===a||(this._unsetUpsamplingTile(),this._tileLayerInfo.upsampleFromTile=b.computeUpsampleInfoForAncestor(this.tile,
a),this.tile.updateTexture())};c.Pool=new a(c);return c}(g)})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../../support/basemapDefinitions ./terrainUtilsPlanar ./terrainUtilsSpherical".split(" "),function(p,f,k,a,g,b,e,c){function d(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function m(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}
function l(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function h(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function n(){u={};for(var a in b)b[a].baseMapLayers.forEach(function(a){u[a.url]=19});u["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=20}function q(a,b,c,d){return t["local"===d||"planar"===d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,b,c)}Object.defineProperty(f,"__esModule",{value:!0});
var t={planar:e,spherical:c};f.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};f.autoUpdateSkirtsVisibility=function(a,b,c){var d=t[a.manifold],e,g=d.isInsideExtent(a,b);g?e=a.getElevation(b):(e=a.getElevationBounds(),e=.5*(e[0]+e[1]));e=b[2]-e;c=.9*Math.abs(e)<c?0:0>e?-1:1;g||(d.isInsideExtent(a,b,a.hideSkirtsDistanceFromExtentMargin)?(b=d.tiltToExtentEdge(a,b),b>a.hideSkirtsMinimumCameraTilt&&b<a.hideSkirtsMaximumCameraTilt&&(c=0)):c=0);a.skirtScale=c};f.isTiledLayer=function(a){return a&&
"base-tile"===a.type||"tile"===a.type||"elevation"===a.type||"base-elevation"===a.type||"open-street-map"===a.type||"web-tile"===a.type||"wmts"===a.type||"vector-tile"===a.type};f.isVectorTileLayer=function(a){return a&&a.isInstanceOf(g)};f.isTileLayerView=d;f.isVectorTileLayerView=m;f.isWMTSLayerView=l;f.isElevationLayerView=h;f.isTiledLayerView=function(a){return a&&(d(a)||h(a)||m(a)||l(a))};f.useFetchTileForLayer=function(b){return b.fetchTile&&!(b.fetchTile===a.prototype.fetchTile||b.fetchTile===
k.prototype.fetchTile)};var u=null;f.getKnownTiledServiceLevelCap=function(a){u||n();a=a&&a.replace(/https?:/,"");return a in u?u[a]:Infinity};f.prepareKnownTiledServiceLevelCaps=n;f.checkIfTileInfoSupportedForView=q;f.getTiledLayerInfo=function(a,b,c){var d,e;if("wmts"===a.type){if(a=a.activeLayer){var g=a.tileMatrixSet;if(g)d=g.tileInfo,e=g.fullExtent;else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==q(a.tileInfo,a.fullExtent,b,c)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else d=
"vector-tile"===a.type?a.compatibleTileInfo256:a.tileInfo,e=a.fullExtent;return d&&e&&null==q(d,e,b,c)?{tileInfo:d,fullExtent:e}:{tileInfo:null,fullExtent:null}}})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Error ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ArcGISCachedService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/vectorTiles/SchemaHelper ../views/vectorTiles/style/StyleRepository".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E){return function(c){function f(a,b){a=c.call(this)||this;a.capabilities=null;a.currentStyleInfo=null;a.fullExtent=null;a.style=null;a.operationalLayerType="VectorTileLayer";a.tileInfo=null;a.tilemapCache=null;a.type="vector-tile";a.url=null;return a}a(f,c);f.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?k({url:a},b):a};f.prototype.load=function(){var a=this,c=this.loadFromPortal({supportedTypes:["Vector Tile Service"],
supportsData:!1}).then(function(){if(a.portalItem&&a.portalItem.id){var c=a.portalItem.itemUrl+"/resources/styles/root.json";return b(c,{query:{f:"json"}}).then(function(b){b.data&&a.read({url:c},C.createForItem(a.portalItem))})}}).then(function(){return a.loadStyle()},function(){return a.loadStyle()});this.addResolvingPromise(c);return this.when()};Object.defineProperty(f.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&l.urlToObject(a.serviceUrl))?
this._getDefaultAttribution(a.path):null},enumerable:!0,configurable:!0});f.prototype.readCapabilities=function(a,b){var c=b.capabilities&&b.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});a=!!b.exportTilesAllowed;c=-1!==c.indexOf("tilemap");return{operations:{supportsExportTiles:a,supportsTileMap:c},exportTiles:a?{maxExportTilesCount:+b.maxExportTilesCount}:null}};Object.defineProperty(f.prototype,"parsedUrl",{get:function(){return this.serviceUrl?m.urlToObject(this.serviceUrl):
null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,
configurable:!0});f.prototype.writeStyleUrl=function(a,b){a&&l.isProtocolRelative(a)&&(a="https:"+a);b.styleUrl=a};f.prototype.readTileIndexType=function(a,b){return b.type};f.prototype.readTileIndexUrl=function(a,b){return l.join(this.serviceUrl,b.tileMap)};f.prototype.readTilemapCache=function(a,b){return b.capabilities&&-1<b.capabilities.indexOf("Tilemap")?new w({layer:this}):null};f.prototype.readTileServers=function(a,b){a=b.tiles;var c=this.serviceUrl||this.styleUrl&&l.removeFile(this.styleUrl);
c&&a.forEach(function(a,b,d){l.isAbsolute(a)?d[b]=a:d[b]=l.join(c,a)});return a};f.prototype.readVersion=function(a,b){return b.version?parseFloat(b.version):parseFloat(b.currentVersion)};f.prototype.readCompatibleTileInfo256=function(a,b){return z.fromJSON(D.create256x256CompatibleTileInfo(b.tileInfo))};f.prototype.readCompatibleTileInfo512=function(a,b){return z.fromJSON(D.create512x512CompatibleTileInfo(b.tileInfo))};f.prototype.loadStyle=function(a){a=a||this.style||this.url;if(this._loadingPromise&&
"string"===typeof a&&this.url===a)return this._loadingPromise;var b=this._loadingPromise;this._loadingPromise=this._getSourceAndStyle(a);b&&!b.isFulfilled()&&b.cancel();return this._loadingPromise};f.prototype.getStyleLayerId=function(a){return this.styleRepository.getStyleLayerId(a)};f.prototype.getPaintProperties=function(a){return this.styleRepository.getPaintProperties(a)};f.prototype.setPaintProperties=function(a,b){a=this.styleRepository.setPaintProperties(a,b);this.emit("paint-change",{layer:a,
paint:b})};f.prototype.getLayoutProperties=function(a){return this.styleRepository.getLayoutProperties(a)};f.prototype.setLayoutProperties=function(a,b){a=this.styleRepository.setLayoutProperties(a,b);this.emit("layout-change",{layer:a,layout:b})};f.prototype.getTileUrl=function(a,b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};f.prototype.write=function(a,b){return b&&b.origin&&!this.styleUrl?
(b.messages&&b.messages.push(new e("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,b])};f.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return d.create(function(a){return p(["../views/2d/layers/VectorTileLayerView2D"],a)});case "3d":return d.create(function(a){return p(["../views/3d/layers/VectorTileLayerView3D"],a)})}};f.prototype._getSourceAndStyle=
function(a){var b=this;return a?B.loadMetadata(a).then(function(c){b._set("currentStyleInfo",{serviceUrl:c.serviceUrl,styleUrl:c.styleUrl,spriteUrl:c.spriteUrl,glyphsUrl:c.glyphsUrl,style:c.style,layerDefinition:c.layerDefinition});"string"===typeof a?(b.url=a,b.style=null):(b.url=null,b.style=a);b._set("styleRepository",new E(c.style,c));b.read(c.layerDefinition,{origin:"service"})}):d.reject(Error("invalid style!"))};f.prototype._getDefaultAttribution=function(a){var b=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);
if(b&&(a=b[3]&&b[3].toLowerCase()))for(var b=b[2]||"",c=0,d="OpenStreetMap_v2 OpenStreetMap_Export_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84".split(" ");c<d.length;c++){var e=d[c];if(-1<e.toLowerCase().indexOf(a))return l.normalize("//static.arcgis.com/attribution/Vector"+b+"/"+e)}};g([h.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],f.prototype,"attributionDataUrl",null);g([h.property({readOnly:!0})],f.prototype,
"capabilities",void 0);g([h.reader("capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount"])],f.prototype,"readCapabilities",null);g([h.property({readOnly:!0})],f.prototype,"currentStyleInfo",void 0);g([h.property({type:n,readOnly:!0})],f.prototype,"fullExtent",void 0);g([h.property()],f.prototype,"style",void 0);g([h.property({type:["VectorTileLayer"]})],f.prototype,"operationalLayerType",void 0);g([h.property({readOnly:!0,dependsOn:["serviceUrl"]})],f.prototype,"parsedUrl",null);
g([h.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],f.prototype,"serviceUrl",null);g([h.property({type:q,dependsOn:["tileInfo"],readOnly:!0})],f.prototype,"spatialReference",null);g([h.property({readOnly:!0})],f.prototype,"styleRepository",void 0);g([h.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],f.prototype,"styleUrl",null);g([h.writer(["portal-item","web-document"],"styleUrl")],
f.prototype,"writeStyleUrl",null);g([h.property({readOnly:!0})],f.prototype,"tileIndexType",void 0);g([h.reader("tileIndexType",["tileIndexType","type"])],f.prototype,"readTileIndexType",null);g([h.property({readOnly:!0})],f.prototype,"tileIndexUrl",void 0);g([h.reader("tileIndexUrl",["tileIndexUrl","tileMap"])],f.prototype,"readTileIndexUrl",null);g([h.property({readOnly:!0,type:z})],f.prototype,"tileInfo",void 0);g([h.property({readOnly:!0,type:w})],f.prototype,"tilemapCache",void 0);g([h.reader("tilemapCache",
["capabilities"])],f.prototype,"readTilemapCache",null);g([h.property({readOnly:!0})],f.prototype,"tileServers",void 0);g([h.reader("tileServers",["tiles"])],f.prototype,"readTileServers",null);g([h.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],f.prototype,"type",void 0);g([h.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],f.prototype,"url",void 0);g([h.property({readOnly:!0})],f.prototype,"version",void 0);
g([h.reader("version",["version","currentVersion"])],f.prototype,"readVersion",null);g([h.property({readOnly:!0})],f.prototype,"compatibleTileInfo256",void 0);g([h.reader("compatibleTileInfo256",["tileInfo"])],f.prototype,"readCompatibleTileInfo256",null);g([h.property({readOnly:!0})],f.prototype,"compatibleTileInfo512",void 0);g([h.reader("compatibleTileInfo512",["tileInfo"])],f.prototype,"readCompatibleTileInfo512",null);return f=g([h.subclass("esri.layers.VectorTileLayer")],f)}(h.declared(t,r,
y,x,c,u))})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports ../../core/tsSupport/assignHelper ../../config ../../request ../../core/promiseUtils ../../core/urlUtils".split(" "),function(p,f,k,a,g,b,e){function c(a){a&&(a=e.getOrigin(a),l&&-1===l.indexOf(a)&&l.push(a))}function d(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var b=void 0,c=0;c<a.length;++c)e.isProtocolRelative(a[c])?b&&(b=b.split("://")[0]+":"+a[c].trim()):b=e.isAbsolute(a[c])?a[c]:
e.join(b,a[c]);return b}function m(a,f,l){var h,k,n;"string"===typeof f?(f=e.normalize(f),c(f),h=e.urlToObject(f),h=g(h.path,{query:{f:"json"},responseType:"json"}),n=k=f):(h=b.resolve({data:f}),k=f.jsonUrl||null,n=l);return h.then(function(g){var h=g.data;g.ssl&&(k&&(k=k.replace(/^http:/i,"https:")),n&&(n=n.replace(/^http:/i,"https:")));if(h.sources){a.styleUrl=k||null;g=n?e.removeFile(n):e.appBaseUrl;a.styleBase=g;a.style=h;a.styleUrl&&c(a.styleUrl);if(a.source)h=b.resolve();else{b:if(h=h.sources,
h.esri)h=h.esri;else{for(var f=0,l=Object.keys(h);f<l.length;f++){var q=l[f];if("vector"===h[q].type){h=h[q];break b}}h=null}h=h.url?m(a,d(g,h.url)):m(a,h,g)}return h}if(h.sources)return b.reject("You must specify the URL or the JSON for a service or for a style.");a.sourceUrl=k||null;g=n?e.removeTrailingSlash(n)+"/":e.appBaseUrl;a.sourceBase=g;a.source=h;if(h.hasOwnProperty("tileInfo"))f=h;else{for(var f={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,
spatialReference:{wkid:102100}},q=(f.xmax-f.xmin)/512,l=[],r=h.hasOwnProperty("minzoom")?parseFloat(h.minzoom):0,u=h.hasOwnProperty("maxzoom")?parseFloat(h.maxzoom):16;r<u;r++){var t=q/Math.pow(2,r);l.push({level:r,scale:Math.floor(3779.527559055118*t),resolution:t})}q=0;for(u=h.tiles;q<u.length;q++)c(d(g,u[q]));f={capabilities:"TilesOnly",initialExtent:f,fullExtent:f,minScale:l[0].scale,maxScale:l[l.length-1].scale,tiles:h.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,
y:2.0037508342787E7},lods:l,spatialReference:{wkid:102100}}}}a.validatedSource=f;a.sourceUrl&&c(a.sourceUrl);h=a.style?b.resolve():null==h.defaultStyles?b.reject():"string"===typeof h.defaultStyles?m(a,d(g,h.defaultStyles,"root.json")):m(a,h.defaultStyles,d(g,"root.json"));return h})}Object.defineProperty(f,"__esModule",{value:!0});var l=a.defaults&&a.defaults.io.corsEnabledServers;f.loadMetadata=function(a){var b={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,
styleUrl:null},g="string"===typeof a?[a,null]:[null,a.jsonUrl],h=g[0],g=g[1],f=h?e.urlToObject(h):null;return m(b,a,g).then(function(){var a={layerDefinition:b.validatedSource,url:h,parsedUrl:f,serviceUrl:b.sourceUrl,style:b.style,styleUrl:b.styleUrl,spriteUrl:b.style.sprite&&d(b.styleBase,b.style.sprite),glyphsUrl:b.style.glyphs&&d(b.styleBase,b.style.glyphs)};c(a.spriteUrl);c(a.glyphsUrl);return a})}})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils",
"../Portal"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.createForItem=function(g){return{origin:"portal-item",url:k.urlToObject(g.itemUrl),portal:g.portal||a.getDefault()}}})},"esri/views/vectorTiles/SchemaHelper":function(){define(["require","exports"],function(p,f){return function(){function f(a,g){this.lockedSchemaPixelSize=a;this.isWGS84=g}f.prototype.getLevelRowColumn=function(a){return this.isWGS84?[a[0],a[1]>>1,a[2]>>1]:256===this.lockedSchemaPixelSize&&0<a[0]?[a[0]-
1,a[1]>>1,a[2]>>1]:a};f.prototype.adjustLevel=function(a){return this.isWGS84?a:256===this.lockedSchemaPixelSize?0<a?a-1:0:a};f.prototype.getShift=function(a,g){var b=0,e=0;if(256===this.lockedSchemaPixelSize||this.isWGS84)a[2]%2&&(b=2*g),a[1]%2&&(e=2*g);return[b,e]};f.prototype.getScale=function(a){if(this.isWGS84){if(512===this.lockedSchemaPixelSize)return 2}else if(256===this.lockedSchemaPixelSize&&0===a)return.5;return 1};f.create256x256CompatibleTileInfo=function(a){if(!a)return null;if(256===
a.rows&&256===a.cols)return a;for(var g=4326===a.spatialReference.wkid,b=[],e=a.lods.length,c=0;c<e;c++){var d=a.lods[c];b.push({level:d.level,scale:d.scale,resolution:g?d.resolution:2*d.resolution})}return{rows:256,cols:256,dpi:a.dpi,format:a.format,compressionQuality:a.compressionQuality,origin:a.origin,spatialReference:a.spatialReference,lods:b}};f.create512x512CompatibleTileInfo=function(a){if(!a||256===a.rows||256===a.cols)return null;for(var g=[],b=a.lods.length,e=0;e<b;e++){var c=a.lods[e];
g.push({level:c.level,scale:c.scale,resolution:.5*c.resolution})}return{rows:512,cols:512,dpi:a.dpi,format:a.format,compressionQuality:a.compressionQuality,origin:a.origin,spatialReference:a.spatialReference,lods:g}};return f}()})},"esri/views/vectorTiles/style/StyleRepository":function(){define(["require","exports","../../../core/has","./StyleLayer"],function(p,f,k,a){return function(){function g(a,e){this._layerByName={};this.styleJSON=a;this.version=parseFloat(a.version);this.sprite=e?e.spriteUrl:
a.sprite;this.glyphs=e?e.glyphsUrl:a.glyphs;if(this.layers=(a.layers||[]).map(g._create))for(a=void 0,e=0;e<this.layers.length;e++)a=this.layers[e],this._layerByName[a.id.toLowerCase()]=a;this._identifyRefLayers()}g.prototype.getStyleLayerId=function(a){return a>=this.layers.length?null:this.layers[a].id};g.prototype.getLayoutProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?a.layout:null};g.prototype.getPaintProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?a.paint:
null};g.prototype.setPaintProperties=function(a,e){a=this._layerByName[a.toLowerCase()];if(!a)return"";var b=this.layers.indexOf(a);this.styleJSON.layers[b].paint=e;e=g._recreateLayer({id:a.id,type:a.typeName,source:a.source,sourceLayer:a["source-layer"],minzoom:a.minzoom,maxzoom:a.maxzoom,filter:a.filter,layout:a.layout,paint:e},a);this.layers[b]=e;this._layerByName[a.id.toLowerCase()]=e;return a.id};g.prototype.setLayoutProperties=function(a,e){a=this._layerByName[a.toLowerCase()];if(!a)return"";
var b=this.layers.indexOf(a);this.styleJSON.layers[b].layout=e;e=g._recreateLayer({id:a.id,type:a.typeName,source:a.source,sourceLayer:a["source-layer"],minzoom:a.minzoom,maxzoom:a.maxzoom,filter:a.filter,layout:e,paint:a.paint},a);this.layers[b]=e;this._layerByName[a.id.toLowerCase()]=e;return a.id};g.prototype._identifyRefLayers=function(){for(var a=[],e=[],c=0,d=0,g=this.layers;d<g.length;d++){var f=g[d];if(1===f.type){var h=f,k=f.sourceLayer,k=k+("|"+JSON.stringify(f.minzoom)),k=k+("|"+JSON.stringify(f.maxzoom)),
k=k+("|"+JSON.stringify(f.filter));if(h.hasDataDrivenFill||h.hasDataDrivenOutline)k+="|"+JSON.stringify(c);a.push({key:k,layer:f})}2===f.type&&(h=f,k=f.sourceLayer,k+="|"+JSON.stringify(f.minzoom),k+="|"+JSON.stringify(f.maxzoom),k+="|"+JSON.stringify(f.filter),k+="|"+JSON.stringify(f.layout&&f.layout["line-cap"]),k+="|"+JSON.stringify(f.layout&&f.layout["line-join"]),h.hasDataDrivenLine&&(k+="|"+JSON.stringify(c)),e.push({key:k,layer:f}));++c}this._assignRefLayers(a);this._assignRefLayers(e)};g.prototype._assignRefLayers=
function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var b,c,d=a.length,g=0;g<d;g++){var f=a[g];if(f.key===b)f.layer.refLayerId=c;else if(b=f.key,c=f.layer.id,1===f.layer.type&&!f.layer.getPaintProperty("fill-outline-color"))for(var h=g+1;h<d;h++){var k=a[h];if(k.key===b){if(k.layer.getPaintProperty("fill-outline-color")){a[g]=k;a[h]=f;c=k.layer.id;break}}else break}}};g._create=function(b,e,c){e=1-1/(c.length+1)*(1+e);switch(b.type){case "background":return new a.BackgroundStyleLayer(0,
b,e);case "fill":return new a.FillStyleLayer(1,b,e);case "line":return new a.LineStyleLayer(2,b,e);case "symbol":return new a.SymbolStyleLayer(3,b,e);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new a.CircleStyleLayer(4,b,e)}throw Error("Unknown vector tile layer");};g._recreateLayer=function(b,e){switch(b.type){case "background":return new a.BackgroundStyleLayer(0,b,e.z);case "fill":return new a.FillStyleLayer(1,b,e.z);case "line":return new a.LineStyleLayer(2,
b,e.z);case "symbol":return new a.SymbolStyleLayer(3,b,e.z);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new a.CircleStyleLayer(4,b,e.z)}};return g}()})},"esri/views/vectorTiles/style/StyleLayer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Filter ./StyleDefinition ./StyleProperty".split(" "),function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function a(a,
c,e){this.type=a;this.typeName=c.type;this.id=c.id;this.source=c.source;this.sourceLayer=c["source-layer"];this.minzoom=c.minzoom;this.maxzoom=c.maxzoom;this.filter=c.filter;this.layout=c.layout;this.paint=c.paint;this.z=e;switch(a){case 0:this._layoutDefinition=b.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=b.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=b.StyleDefinition.fillLayoutDefinition;this._paintDefinition=b.StyleDefinition.fillPaintDefinition;
break;case 2:this._layoutDefinition=b.StyleDefinition.lineLayoutDefinition;this._paintDefinition=b.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=b.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=b.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=b.StyleDefinition.circleLayoutDefinition,this._paintDefinition=b.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}
a.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=g.createFilter(this.filter)};a.prototype.getLayoutProperty=function(a){var b=this._layoutProperties;if(b)return b[a]};a.prototype.getPaintProperty=function(a){var b=this._paintProperties;if(b)return b[a]};a.prototype.getLayoutValue=function(a,b,c){var d,e=this._layoutProperties;e&&(e=e[a])&&(d=e.getValue(b,c));a=this._layoutDefinition[a];void 0===d&&(d=a["default"]);"enum"===a.type&&
(d=a.values.indexOf(d));return d};a.prototype.getPaintValue=function(a,b,c){var d,e=this._paintProperties;e&&(e=e[a])&&(d=e.getValue(b,c));a=this._paintDefinition[a];void 0===d&&(d=a["default"]);"enum"===a.type&&(d=a.values.indexOf(d));return d};a.prototype._parseLayout=function(a){var b={},c;for(c in a){var d=this._layoutDefinition[c];d&&(b[c]=new e(c,d,a[c]))}return b};a.prototype._parsePaint=function(a){var b={},c;for(c in a){var d=this._paintDefinition[c];d&&(b[c]=new e(c,d,a[c]))}return b};return a}();
f.StyleLayer=p;a=function(a){function b(b,c,d){return a.call(this,b,c,d)||this}k(b,a);return b}(p);f.BackgroundStyleLayer=a;a=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("fill-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("fill-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;b.hasDataDrivenFill=b.hasDataDrivenColor||b.hasDataDrivenOpacity;c=b.getPaintProperty("fill-outline-color");b.outlineUsesFillColor=!c;b.hasDataDrivenOutlineColor=
c?c.isDataDriven:!1;b.hasDataDrivenOutline=(c?b.hasDataDrivenOutlineColor:b.hasDataDrivenColor)||b.hasDataDrivenOpacity;return b}k(b,a);return b}(p);f.FillStyleLayer=a;a=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("line-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("line-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("line-width");b.hasDataDrivenWidth=c?c.isDataDriven:!1;b.hasDataDrivenLine=b.hasDataDrivenColor||
b.hasDataDrivenOpacity||b.hasDataDrivenWidth;return b}k(b,a);return b}(p);f.LineStyleLayer=a;a=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("icon-color");b.hasDataDrivenIconColor=c?c.isDataDriven:!1;c=b.getPaintProperty("icon-opacity");b.hasDataDrivenIconOpacity=c?c.isDataDriven:!1;c=b.getLayoutProperty("icon-size");b.hasDataDrivenIconSize=c?c.isDataDriven:!1;b.hasDataDrivenIcon=b.hasDataDrivenIconColor||b.hasDataDrivenIconOpacity||b.hasDataDrivenIconSize;c=b.getPaintProperty("text-color");
b.hasDataDrivenTextColor=c?c.isDataDriven:!1;c=b.getPaintProperty("text-opacity");b.hasDataDrivenTextOpacity=c?c.isDataDriven:!1;c=b.getLayoutProperty("text-size");b.hasDataDrivenTextSize=c?c.isDataDriven:!1;b.hasDataDrivenText=b.hasDataDrivenTextColor||b.hasDataDrivenTextOpacity||b.hasDataDrivenTextSize;return b}k(b,a);return b}(p);f.SymbolStyleLayer=a;p=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("circle-radius");b.hasDataDrivenRadius=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-color");
b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-width");b.hasDataDrivenStrokeWidth=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-color");b.hasDataDrivenStrokeColor=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-opacity");b.hasDataDrivenStrokeOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-blur");b.hasDataDrivenBlur=c?c.isDataDriven:!1;return b}k(b,a);return b}(p);
f.CircleStyleLayer=p;p=function(){return function(a,b,e){this.cap=a.getLayoutValue("line-cap",b,e);this.join=a.getLayoutValue("line-join",b,e);this.miterLimit=a.getLayoutValue("line-miter-limit",b,e);this.roundLimit=a.getLayoutValue("line-round-limit",b,e)}}();f.LineLayout=p;p=function(){return function(a,b,e,g){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",b,g);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",b,g);this.optional=a.getLayoutValue("icon-optional",b,g);this.rotationAlignment=
a.getLayoutValue("icon-rotation-alignment",b,g);this.size=a.getLayoutValue("icon-size",b,g);this.rotate=a.getLayoutValue("icon-rotate",b,g);this.padding=a.getLayoutValue("icon-padding",b,g);this.keepUpright=a.getLayoutValue("icon-keep-upright",b,g);this.offset=a.getLayoutValue("icon-offset",b,g);2===this.rotationAlignment&&(this.rotationAlignment=e?0:1)}}();f.IconLayout=p;p=function(){return function(a,b,e,g){this.allowOverlap=a.getLayoutValue("text-allow-overlap",b,g);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",
b,g);this.optional=a.getLayoutValue("text-optional",b,g);this.rotationAlignment=a.getLayoutValue("text-rotation-alignment",b,g);this.fontArray=a.getLayoutValue("text-font",b,g);this.maxWidth=a.getLayoutValue("text-max-width",b,g);this.lineHeight=a.getLayoutValue("text-line-height",b,g);this.letterSpacing=a.getLayoutValue("text-letter-spacing",b,g);this.justify=a.getLayoutValue("text-justify",b,g);this.anchor=a.getLayoutValue("text-anchor",b,g);this.maxAngle=a.getLayoutValue("text-max-angle",b,g);
this.size=a.getLayoutValue("text-size",b,g);this.rotate=a.getLayoutValue("text-rotate",b,g);this.padding=a.getLayoutValue("text-padding",b,g);this.keepUpright=a.getLayoutValue("text-keep-upright",b,g);this.transform=a.getLayoutValue("text-transform",b,g);this.offset=a.getLayoutValue("text-offset",b,g);2===this.rotationAlignment&&(this.rotationAlignment=e?0:1)}}();f.TextLayout=p})},"esri/views/vectorTiles/style/Filter":function(){define(["require","exports"],function(p,f){return function(){function f(a,
g,b){this._op=a;"$type"===g?(this._val=b instanceof Array?b.map(function(a){return f._types.indexOf(a)}):f._types.indexOf(b),this._op+=11):(this._key=g,this._val=b)}f.prototype.filter=function(a){switch(this._op){case 0:return this._val;case 1:return a.values[this._key]===this._val;case 2:return a.values[this._key]!==this._val;case 3:return a.values[this._key]<this._val;case 4:return a.values[this._key]>this._val;case 5:return a.values[this._key]<=this._val;case 6:return a.values[this._key]>=this._val;
case 7:return-1!==this._val.indexOf(a.values[this._key]);case 8:return-1===this._val.indexOf(a.values[this._key]);case 9:for(var g=0,b=this._val;g<b.length;g++){var e=b[g];if(e.filter(a))return!0}return!1;case 10:g=0;for(b=this._val;g<b.length;g++)if(e=b[g],!e.filter(a))return!1;return!0;case 11:g=0;for(b=this._val;g<b.length;g++)if(e=b[g],e.filter(a))return!1;return!0;case 12:return a.type===this._val;case 13:return a.type!==this._val;case 14:return a.type<this._val;case 15:return a.type>this._val;
case 16:return a.type>=this._val;case 17:return a.type<=this._val;case 18:return-1!==this._val.indexOf(a.type);case 19:return-1===this._val.indexOf(a.type);case 20:return void 0!==a.values[this._key];case 21:return void 0===a.values[this._key]}};f.createFilter=function(a){if(!a)return new f(0,void 0,!0);var g=a[0];if(1>=a.length)return new f(0,void 0,"any"!==g);switch(g){case "\x3d\x3d":return new f(1,a[1],a[2]);case "!\x3d":return new f(2,a[1],a[2]);case "\x3e":return new f(4,a[1],a[2]);case "\x3c":return new f(3,
a[1],a[2]);case "\x3e\x3d":return new f(6,a[1],a[2]);case "\x3c\x3d":return new f(5,a[1],a[2]);case "in":return new f(7,a[1],a.slice(2));case "!in":return new f(8,a[1],a.slice(2));case "any":return new f(9,void 0,a.slice(1).map(f.createFilter.bind(this)));case "all":return new f(10,void 0,a.slice(1).map(f.createFilter.bind(this)));case "none":return new f(11,void 0,a.slice(1).map(f.createFilter.bind(this)));case "has":return new f(20,a[1],void 0);case "!has":return new f(21,a[1],void 0);default:throw Error("invalid operator: "+
g);}};f._types=["Unknown","Point","LineString","Polygon"];return f}()})},"esri/views/vectorTiles/style/StyleDefinition":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function f(){}f.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};f.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};f.lineLayoutDefinition={visibility:{type:"enum",values:["visible",
"none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};f.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",minimum:1,default:250},"symbol-avoid-edges":{type:"boolean",
default:!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",default:!1},"icon-optional":{type:"boolean",default:!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"icon-rotate":{type:"number",default:0},"icon-padding":{type:"number",minimum:0,default:2},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",
length:2,default:[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,default:16},"text-max-width":{type:"number",minimum:0,default:10},"text-line-height":{type:"number",default:1.2},"text-letter-spacing":{type:"number",default:0},"text-justify":{type:"enum",values:["left","center","right"],default:"center"},
"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"text-max-angle":{type:"number",minimum:0,default:45},"text-rotate":{type:"number",default:0},"text-padding":{type:"number",minimum:0,default:2},"text-keep-upright":{type:"boolean",default:!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-allow-overlap":{type:"boolean",
default:!1},"text-ignore-placement":{type:"boolean",default:!1},"text-optional":{type:"boolean",default:!1}};f.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};f.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-color":{type:"color",default:[0,0,0,1]},"background-pattern":{type:"string"}};f.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-antialias":{type:"boolean",
default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"fill-pattern":{type:"string"}};f.linePaintDefinition={"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-color":{type:"color",default:[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",
values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-blur":{type:"number",minimum:0,default:0},"line-dasharray":{type:"array",value:"number",default:[]},"line-pattern":{type:"string"}};f.symbolPaintDefinition={"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-color":{type:"color",default:[0,0,0,0]},
"icon-halo-width":{type:"number",minimum:0,default:0},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-halo-blur":{type:"number",minimum:0,
default:0},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};f.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},
"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};f.circlePaintDefinition={"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-color":{type:"color",default:[0,0,0,1]},"circle-blur":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],
default:"map"},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1}};return f}();f.StyleDefinition=p})},"esri/views/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../Color","../GeometryUtils"],function(p,f,k,a){return function(){function g(a,e,c){this.isDataDriven=!1;switch(e.type){case "number":a=!0;break;case "color":a=!0;c=g._parseColor(c);
break;case "array":a="number"===e.value;break;default:a=!1}null==c&&(c=e.default);a&&"interval"===c.type&&(a=!1);var b=c&&c.stops&&0<c.stops.length;if(b)for(var f=0,l=c.stops;f<l.length;f++){var h=l[f];h[1]=this._validate(h[1],e)}if(this.isDataDriven=c?!!c.property:!1)if(void 0!==c.default&&(c.default=this._validate(c.default,e)),b)switch(c.type){case "identity":this.getValue=this._buildIdentity(c,e);break;case "categorical":this.getValue=this._buildCategorical(c,e);break;default:this.getValue=a?
this._buildInterpolate(c,e):this._buildInterval(c,e)}else this.getValue=this._buildIdentity(c,e);else b?this.getValue=a?this._buildZoomInterpolate(c):this._buildZoomInterval(c):(c=this._validate(c,e),this.getValue=this._buildSimple(c))}g.prototype._validate=function(a,e){if("number"===e.type){if(a<e.minimum)return e.minimum;if(a>e.maximum)return e.maximum}return a};g.prototype._buildSimple=function(a){return function(){return a}};g.prototype._buildIdentity=function(a,e){var b=this;return function(c,
f){var d;f&&(d=f.values[a.property],"color"===e.type&&(d=g._parseColor(d)));void 0===d&&(d=a.default);return void 0!==d?b._validate(d,e):e.default}};g.prototype._buildCategorical=function(a,e){var b=this;return function(c,g){var d;g&&(d=g.values[a.property]);d=b._categorical(d,a.stops);return void 0!==d?d:void 0!==a.default?a.default:e.default}};g.prototype._buildInterval=function(a,e){var b=this;return function(c,g){var d;g&&(d=g.values[a.property]);return"number"===typeof d?b._interval(d,a.stops):
void 0!==a.default?a.default:e.default}};g.prototype._buildInterpolate=function(a,e){var b=this;return function(c,g){var d;g&&(d=g.values[a.property]);return"number"===typeof d?b._interpolate(d,a.stops,a.base||1):void 0!==a.default?a.default:e.default}};g.prototype._buildZoomInterpolate=function(a){var b=this;return function(c){return b._interpolate(c,a.stops,a.base||1)}};g.prototype._buildZoomInterval=function(a){var b=this;return function(c){return b._interval(c,a.stops)}};g.prototype._categorical=
function(a,e){for(var b=e.length,d=0;d<b;d++)if(e[d][0]===a)return e[d][1]};g.prototype._interval=function(a,e){for(var b=e.length,d=0,g=0;g<b;g++)if(e[g][0]<=a)d=g;else break;return e[d][1]};g.prototype._interpolate=function(b,e,c){for(var d,g,f=e.length,h=0;h<f;h++){var k=e[h];if(k[0]<=b)d=k;else{g=k;break}}if(d&&g){h=g[0]-d[0];b-=d[0];c=1===c?b/h:(Math.pow(c,b)-1)/(Math.pow(c,h)-1);if(Array.isArray(d[1])){d=d[1];g=g[1];b=[];for(h=0;h<d.length;h++)b.push(a.interpolate(d[h],g[h],c));return b}return a.interpolate(d[1],
g[1],c)}if(d)return d[1];if(g)return g[1]};g._isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};g._parseColor=function(a){if(Array.isArray(a))return a;if("string"===typeof a){if(a=new k(a),!this._isEmpty(a))return k.toUnitRGBA(a)}else return a&&a.default&&(a.default=g._parseColor(a.default)),a&&a.stops&&(a.stops=a.stops.map(function(a){return[a[0],g._parseColor(a[1])]})),a};return g}()})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(p,
f){function k(a,b){a%=b;return 0<=a?a:a+b}Object.defineProperty(f,"__esModule",{value:!0});f.C_INFINITY=Number.POSITIVE_INFINITY;f.C_PI=Math.PI;f.C_2PI=2*f.C_PI;f.C_PI_BY_2=f.C_PI/2;f.C_RAD_TO_256=128/f.C_PI;f.C_256_TO_RAD=f.C_PI/128;f.C_DEG_TO_256=256/360;f.C_DEG_TO_RAD=f.C_PI/180;f.C_SQRT2=1.414213562;f.C_SQRT2_INV=1/f.C_SQRT2;var a=1/Math.LN2;f.positiveMod=k;f.radToByte=function(a){return k(a*f.C_RAD_TO_256,256)};f.degToByte=function(a){return k(a*f.C_DEG_TO_256,256)};f.log2=function(g){return Math.log(g)*
a};f.sqr=function(a){return a*a};f.clamp=function(a,b,e){return Math.min(Math.max(a,b),e)};f.interpolate=function(a,b,e){return a*(1-e)+b*e};f.between=function(a,b,e){return a>=b&&a<=e||a>=e&&a<=b}})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingRect ./TerrainConst ./TilingScheme".split(" "),function(p,f,k,a,g,b,e){function c(b,c,e,g){a.vec3.copy(d,e);d[g]=c[g];g=a.vec3.subtract(d,
d,c);var h=a.vec3.subtract(m,b,c),h=a.vec3.dot(h,g),f=a.vec3.dot(g,g);c=0>=h?c:f<=h?e:a.vec3.add(d,c,a.vec3.scale(g,g,h/f));b=a.vec3.subtract(d,b,c);return Math.PI/2-Math.atan(b[2]/Math.sqrt(b[0]*b[0]+b[1]*b[1]))}Object.defineProperty(f,"__esModule",{value:!0});var d=a.vec3f64.create(),m=a.vec3f64.create(),l=a.vec3f64.create(),h=a.vec3f64.create();f.isInsideExtent=function(a,b,c){void 0===c&&(c=0);a=a.extent;return 0===c?g.containsPoint(a,b):g.containsPointWithMargin(a,b,c*Math.min(a[2]-a[0],a[3]-
a[1]))};f.tiltOnEdge=c;f.tiltToExtentEdge=function(a,b){var d=a.getElevationBounds();a=a.extent;d=.5*(d[0]+d[1]);l[0]=a[0];l[1]=a[1];l[2]=d;h[0]=a[2];h[1]=a[3];h[2]=d;a=d=Infinity;b[0]<l[0]?d=c(b,l,h,0):b[0]>h[0]&&(d=c(b,h,l,0));b[1]<l[1]?a=c(b,l,h,1):b[1]>h[1]&&(a=c(b,h,l,1));return Math.min(d,a)};f.checkIfTileInfoSupportedForViewSR=function(a,c,d){if(a.spatialReference.isGeographic)return new k("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");
var h=e.checkUnsupported(a);if(h)return h;var f=a.lods,h=f[0].resolution*Math.pow(2,f[0].level),l=[h*a.size[0],h*a.size[1]],m=[a.origin.x,a.origin.y];c=g.fromExtent(c);var n=g.create();e.computeRowColExtent(c,l,m,n);l=(n[2]-n[0])*(n[3]-n[1]);l>b.MAX_ROOT_TILES?(f=f[0].scale*Math.pow(2,f[0].level),h=Math.max((c[3]-c[1])/a.size[1],(c[2]-c[0])/a.size[0])*f/h,c=Math.floor(Math.log(h)/Math.log(10)),h=Math.ceil(h/Math.pow(10,c))*Math.pow(10,c),h=new k("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+
Math.floor(f).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:f,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:b.MAX_ROOT_TILES})):h=null;return h?h:d&&!a.spatialReference.equals(d)?new k("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require","exports","../../../core/Error",
"./TilingScheme"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.isInsideExtent=function(a,b,e){void 0===e&&(e=0);return!0};f.tiltToExtentEdge=function(a,b){return 0};f.checkIfTileInfoSupportedForViewSR=function(g,b,e){b=g.lods.length-1;if(g.spatialReference.isWebMercator){if(!a.makeWebMercatorAuxiliarySphere(b).compatibleWith(g))return new k("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(g.spatialReference.isWGS84){if(!a.makeWGS84WithTileSize(g.size[1],
b).compatibleWith(g))return new k("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme")}else return new k("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(e&&!g.spatialReference.equals(e))return new k("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("require exports ./TerrainConst ./TileAgent ./UpsampleInfo ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),
function(p,f,k,a,g,b,e){return function(){function c(a){this.waitingAgents=[];this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(a)}c.prototype.init=function(a){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=null;this.pendingUpdates=
0;a===k.LayerClass.ELEVATION&&(this.elevationBounds=null)};c.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this.upsampleFromTile&&(g.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null)};c.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==a.AGENT_DONE&&(this.loadingAgent.dispose(),this.loadingAgent=null);this.requestPromise&&(this.requestPromise.cancel(),this.requestPromise=null);this.tilemap=null;this.tilemapRequest&&
(this.tilemapRequest.cancel(),this.tilemapRequest=null);this.upsampleFromTile&&(g.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null);this.rawData=null;this.pendingUpdates=0;this.disposeData()};c.prototype.disposeData=function(){var a=this.data;(a instanceof e||a instanceof b)&&a.dispose();this.data=null};c.makeEmptyLayerInfo=function(a,b){return b?(b.init(a),b):new c(a)};return c}()})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/ObjectPool ../../core/libs/gl-matrix-2/gl-matrix ../../geometry/support/spatialReferenceUtils ../2d/engine/DisplayObject ../2d/tiling/TileKey ./RenderBucket ../webgl/BufferObject".split(" "),
function(p,f,k,a,g,b,e,c,d,m){var l="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ");return function(e){function h(){for(var a,b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];c=e.call(this)||this;c._renderBuckets=[];c._vectorTileData=
null;c._symbolUpdateData=null;c.coords=[0,0];c.bounds=[0,0,0,0];c.tileTransform={transform:g.mat4f32.create(),displayCoord:g.vec2f32.create()};c.stencilData={mask:0,reference:0};0<b.length&&(a=c.acquire).call.apply(a,[c].concat(b));return c}k(h,e);h.prototype.reset=function(){c.pool.release(this.key);this.refKey=this.key=null;this.coords[0]=0;this.coords[1]=0;this.bounds[0]=0;this.bounds[1]=0;this.bounds[2]=0;this.height=this.width=this.bounds[3]=0;this.resolution=null;this.rotation=0;this.id=this.client=
this.styleLayers=this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this.stage=this._symbolUpdateData=null};h.prototype.acquire=function(a,c,d,e,g){this.key=a;this.refKey=c;c=d.lodAt(a.level);c=null!==c?c.resolution:0;var h=d.size[0]*c,f=d.origin,l=a.col*h,k=a.row*h,m=d.spatialReference,n=0;m&&(m._isWrappable?m._isWrappable():m.isWrappable)&&(m=b.getInfo(m),n=m.valid[1]-
m.valid[0]);l=f.x+l+a.world*n;f=f.y-k;this.coords[0]=l;this.coords[1]=f;this.bounds[0]=l;this.bounds[1]=f;this.bounds[2]=l+h;this.bounds[3]=f-h;this.widthInPixels=d.size[1];this.coordRange=4096;this.resolution=c;this.rotation=g;this.styleLayers=e;this.id=a.id};h.prototype.setData=function(a,b){this._vectorTileData=a;this.client=b};h.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};h.prototype.updateTileData=function(a){this._vectorTileData=a;this.stage.requestRender()};
h.prototype.dispose=function(){for(var a="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" "),
b=0;b<a.length;++b){var c=a[b];this[c]&&(this[c].dispose(),this[c]=null)}this._renderBuckets.length=0};h.prototype.getCpuMemoryUsage=function(){return null!=this._vectorTileData&&this._vectorTileData.bufferData?this._vectorTileData.bufferData.reduce(function(a,b){return a+b.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength:0};h.prototype.getGpuMemoryUsage=function(){var a=this,b=l.reduce(function(b,c){return a[c]?b+a[c].size:b},0);this.texture&&
(b+=this.texture.descriptor.width*this.texture.descriptor.height*4);return b};h.prototype.attachWithContext=function(a){this.stage={context:a};this.attached=this.attach()};h.prototype._commitChanges=function(){this._vectorTileData&&(this.dispose(),this._createRenderBuckets(),this._createBufferObjects(),this._vectorTileData=null)};h.prototype._createRenderBuckets=function(){for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),b=a.length,c=0;c<b;){var e=a[c];switch(a[c+1]){case 0:var g=new d.BackgroundRenderBucket;
g.layerID=e;this._renderBuckets.push(g);c+=2;break;case 1:g=new d.FillRenderBucket;g.layerID=e;g.triangleElementStart=a[c+2];g.triangleElementCount=a[c+3];g.outlineElementStart=a[c+4];g.outlineElementCount=a[c+5];this._renderBuckets.push(g);c+=6;break;case 2:g=new d.LineRenderBucket;g.layerID=e;g.triangleElementStart=a[c+2];g.triangleElementCount=a[c+3];this._renderBuckets.push(g);c+=4;break;case 3:g=new d.SymbolRenderBucket;g.layerID=e;g.isSDF=0!==a[c+2];var h=c+3,e=a[h];h++;if(0<e)for(var f=void 0,
l=void 0,k=void 0,m=0;m<e;m++)f=a[h],l=a[h+1],k=a[h+2],g.markerPerPageElementsMap.set(f,[l,k]),h+=3;var n=a[h];h++;if(0<n)for(k=l=f=void 0,m=0;m<n;m++)f=a[h],l=a[h+1],k=a[h+2],g.glyphPerPageElementsMap.set(f,[l,k]),h+=3;this._renderBuckets.push(g);c+=5+3*e+3*n;break;case 4:g=new d.CircleRenderBucket;g.layerID=e;g.triangleElementStart=a[c+2];g.triangleElementCount=a[c+3];this._renderBuckets.push(g);c+=4;break;default:console.error("Bad bucket type!"),c+=2}}};h._createBufferToObject=function(){var a=
[];a[1]={create:m.createVertex,var:"fillVertexBuffer"};a[2]={create:m.createVertex,var:"fillDDVertexBuffer"};a[3]={create:m.createIndex,var:"fillIndexBuffer"};a[4]={create:m.createVertex,var:"outlineVertexBuffer"};a[5]={create:m.createVertex,var:"outlineDDVertexBuffer"};a[6]={create:m.createIndex,var:"outlineIndexBuffer"};a[7]={create:m.createVertex,var:"lineVertexBuffer"};a[8]={create:m.createVertex,var:"lineDDVertexBuffer"};a[9]={create:m.createIndex,var:"lineIndexBuffer"};a[10]={create:m.createVertex,
var:"iconVertexBuffer"};a[11]={create:m.createVertex,var:"iconDDVertexBuffer"};a[12]={create:m.createIndex,var:"iconIndexBuffer"};a[13]={create:m.createVertex,var:"textVertexBuffer"};a[14]={create:m.createVertex,var:"textDDVertexBuffer"};a[15]={create:m.createIndex,var:"textIndexBuffer"};a[16]={create:m.createVertex,var:"circleVertexBuffer"};a[17]={create:m.createIndex,var:"circleIndexBuffer"};return a};h.prototype._createBufferObjects=function(){for(var a=this.stage.context,b=new Uint32Array(this._vectorTileData.bufferDataInfo),
c=b.length,d=0,e=0;e<c;e+=2,d++){var g=b[e];if(!(0>=b[e+1]||0===this._vectorTileData.bufferData[d].byteLength)){var f=h.bufferToObject[g];f?this[f.var]?this[f.var].setData(this._vectorTileData.bufferData[d]):this[f.var]=f.create(a,35044,this._vectorTileData.bufferData[d]):console.error("Bad buffer type "+g)}}};h.prototype.detach=function(){this.isReady&&this.client.invoke("destructTileData",this.id);this.dispose();e.prototype.detach.call(this)};h.prototype.doRender=function(a){if(this.visible&&this.isReady){var b=
this.stage.context,c=a.renderer;if(b&&c){this._commitChanges();var d=a.drawphase;this._symbolUpdateData&&(this._updateSymbolData(a,this._symbolUpdateData),this._symbolUpdateData=null);b.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var e=this.styleLayers,g,h=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==h){var f=this._renderBuckets.length;if(0===d)for(var l=f-1;0<=l;l--){var k=this._renderBuckets[l];g=e.layers[k.layerID];if(!k||!g)break;1!==k.type&&0!==k.type||!k.hasData()||
c.renderBucket(b,k,a.displayLevel,a.requiredLevel,d,this,g,h)}else for(l=0;l<f;l++){k=this._renderBuckets[l];g=e.layers[k.layerID];if(!k||!g)break;k.hasData()&&c.renderBucket(b,k,a.displayLevel,a.requiredLevel,d,this,g,h)}}}}};h.prototype._updateSymbolData=function(a,b){if(!b||!b.bucketDataInfo)return!0;a=new Uint32Array(b.bucketDataInfo);var c=a.length;if(0===c)return!0;if(!this.isReady)return this.requestRender(),!1;for(var e=this.stage.context,g=new Uint32Array(b.bufferDataInfo),h=g.length,f=0,
l=0;l<h;l+=2,f++)switch(g[l]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=m.createVertex(e,35044,b.bufferData[f]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=m.createVertex(e,35044,b.bufferData[f]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=m.createIndex(e,35044,b.bufferData[f]);
break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=m.createVertex(e,35044,b.bufferData[f]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=m.createVertex(e,35044,b.bufferData[f]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=m.createIndex(e,35044,b.bufferData[f])}b=[];for(e=0;e<this._renderBuckets.length;e++)this._renderBuckets[e]instanceof
d.SymbolRenderBucket||b.push(this._renderBuckets[e]);this._renderBuckets=b;for(e=0;e<c;){h=a[e];g=new d.SymbolRenderBucket;g.layerID=h;g.isSDF=0!==a[e+2];this.styleLayers.layers.length>g.layerID&&this.styleLayers.layers[g.layerID].type===g.type&&b.push(g);var k=e+3,h=a[k];k++;if(0<h)for(var n=l=f=void 0,q=0;q<h;q++)f=a[k],l=a[k+1],n=a[k+2],g.markerPerPageElementsMap.set(f,[l,n]),k+=3;var t=a[k];k++;if(0<t)for(n=l=f=void 0,q=0;q<t;q++)f=a[k],l=a[k+1],n=a[k+2],g.glyphPerPageElementsMap.set(f,[l,n]),
k+=3;e+=5+3*h+3*t}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);return!0};h.pool=new a(h);h.bufferToObject=h._createBufferToObject();return h}(e.DisplayObject)})},
"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./Evented"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._renderRequestedCalled=!1;b._attached=!1;b._isReady=!1;b._opacity=1;b.renderRequested=!1;b._visible=!0;return b}k(b,a);Object.defineProperty(b.prototype,"attached",{get:function(){return this._attached},set:function(a){this._attached!==
a&&((this._attached=a)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isReady",{get:function(){return this._attached&&this._isReady},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==a&&(this._opacity=a,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"visible",{get:function(){return this._visible},set:function(a){this._visible!==a&&(this._visible=a,this.requestRender())},enumerable:!0,configurable:!0});b.prototype.attach=function(){this.ready();return!0};b.prototype.detach=function(){};b.prototype.processRender=function(a){this.visible&&this.attached&&(this._renderRequestedCalled=!1,this.doRender(a),this._renderRequestedCalled||(this.renderRequested=!1),this.hasEventListener("post-render")&&this.emit("post-render"))};b.prototype.requestRender=
function(){var a=this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;this.parent&&this.parent.requestChildRender(this);a!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};b.prototype.dispose=function(){};b.prototype.ready=function(){this._isReady=!0;this.hasEventListener("isReady")&&this.emit("isReady")};return b}(a.Evented);f.DisplayObject=p})},"esri/views/2d/engine/Evented":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"dojo/aspect","dojo/on"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function b(){}b.prototype.on=function(b,c){return a.after(this,"on"+b,c,!0)};b.prototype.once=function(a,b){return g.once(this,a,b)};b.prototype.emit=function(a){g.emit(this,a,this)};b.prototype.hasEventListener=function(a){a="on"+a;return!(!this[a]||!this[a].after)};return b}();f.Evented=p;f.EventedMixin=function(b){return function(b){function c(){return null!==b&&b.apply(this,arguments)||this}
k(c,b);c.prototype.on=function(b,c){return a.after(this,"on"+b,c,!0)};c.prototype.once=function(a,b){return g.once(this,a,b)};c.prototype.emit=function(a,b){g.emit(this,a,b)};c.prototype.hasEventListener=function(a){a="on"+a;return!(!this[a]||!this[a].after)};return c}(b)}})},"esri/views/2d/tiling/TileKey":function(){define(["require","exports","../../../core/ObjectPool"],function(p,f,k){return function(){function a(a,b,e,c){this.set(a,b,e,c)}a.from=function(g,b,e,c){return a.pool.acquire(g,b,e,c)};
a.getId=function(a,b,e,c){return"object"===typeof a?a.level+"/"+a.row+"/"+a.col+"/"+a.world:a+"/"+b+"/"+e+"/"+c};Object.defineProperty(a.prototype,"key",{get:function(){return this},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this.toString()},enumerable:!0,configurable:!0});a.prototype.equals=function(a){return this.level===a.level&&this.row===a.row&&this.col===a.col&&this.world===a.world};a.prototype.release=function(){this.world=this.col=this.row=
this.level=0};a.prototype.set=function(a,b,e,c){null==a?this.world=this.col=this.row=this.level=0:"object"===typeof a?(this.level=a.level||0,this.row=a.row||0,this.col=a.col||0,this.world=a.world||0):"string"===typeof a?(a=a.split("/"),b=a[1],e=a[2],c=a[3],this.level=parseFloat(a[0]),this.row=parseFloat(b),this.col=parseFloat(e),this.world=parseFloat(c)):(this.level=+a,this.row=+b,this.col=+e,this.world=+c||0);return this};a.prototype.toString=function(){return this.level+"/"+this.row+"/"+this.col+
"/"+this.world};a.prototype.getChildKeys=function(){var g=this.level+1,b=this.row<<1,e=this.col<<1,c=this.world;return[a.pool.acquire(g,b,e,c),a.pool.acquire(g,b,e+1,c),a.pool.acquire(g,b+1,e,c),a.pool.acquire(g,b+1,e+1,c)]};a.prototype.compareRowMajor=function(a){return this.row<a.row?-1:this.row>a.row?1:this.col<a.col?-1:this.col>a.col?1:0};a.sort=function(g){return g.map(function(b){return a.from(b)}).sort(function(a,e){return a.compareRowMajor(e)}).map(function(a){return a.id})};a.pool=new k(a,
!0,null,25,50);return a}()})},"esri/views/vectorTiles/RenderBucket":function(){define(["require","exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(){return function(a){this.type=a}}();f.RenderBucket=p;a=function(a){function b(){var b=a.call(this,2)||this;b.triangleElementStart=0;b.triangleElementCount=0;return b}k(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount};
return b}(p);f.LineRenderBucket=a;a=function(a){function b(){var b=a.call(this,1)||this;b.triangleElementStart=0;b.triangleElementCount=0;b.outlineElementStart=0;b.outlineElementCount=0;return b}k(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};return b}(p);f.FillRenderBucket=a;a=function(a){function b(){var b=a.call(this,3)||this;b.markerPerPageElementsMap=new Map;b.glyphPerPageElementsMap=new Map;b.isSDF=!1;return b}k(b,a);b.prototype.hasData=
function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};return b}(p);f.SymbolRenderBucket=a;a=function(a){function b(){var b=a.call(this,4)||this;b.triangleElementStart=0;b.triangleElementCount=0;return b}k(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount};return b}(p);f.CircleRenderBucket=a;p=function(a){function b(){return a.call(this,0)||this}k(b,a);b.prototype.hasData=function(){return!0};return b}(p);f.BackgroundRenderBucket=p})},"esri/views/3d/terrain/TileGeometryFactory":function(){define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingBox ../support/ArrayPool ../support/earthUtils ../support/mathUtils ./TerrainConst".split(" "),
function(p,f,k,a,g,b,e,c){function d(a,b,d){for(var g=0;g<d.length;g++){var h=d[g];if(h){var f=h.safeWidth,l=h.width,k=h.pixelData,m=e.clamp(h.dy*(h.y1-b),0,f),h=e.clamp(h.dx*(a-h.x0),0,f),f=Math.floor(m),n=Math.floor(h),q=f*l+n,r=q+l,u=k[q],l=k[r],q=k[q+1],k=k[r+1];if(u+l+q+k<.5*c.ELEVATION_NODATA_VALUE)return m-=f,h-=n,a=u+(q-u)*h,a+(l+(k-l)*h-a)*m}}return null}function m(a,b,c,d){var e=0<(c&2),g=b+(d?1024:0)+(e?2048:0),h=t[g];if(!h){var h=b-1,f=b-1,l=b*b,k=2*h+2*f,m=h*f*6,q=6*k,r=6*(2*h+f-1);d&&
(m*=2,q*=2,r*=2);for(var k=65536<l+k?new Uint32Array(m+q):new Uint16Array(m+q),u=0,w=0,p=m,y,z,x,B,C=0,R=0;R<=f;R++){e&&(C=0===R?r:R===f?-r:0);for(var p=p+C,X=0;X<=h;X++)x=n(X,R,h,f),-1<x&&(B=0===R&&X!==h?1:X===h&&R!==f?h+1:R===f&&0!==X?-1:0===X&&0!==R?-(h+1):0,0!==B&&(y=u,z=l+x,x=l+(0===X&&1===R?0:x+1),B=u+B,d?(k[p+0]=y,k[p+1]=z,k[p+2]=z,k[p+3]=x,k[p+4]=x,k[p+5]=y,k[p+6]=x,k[p+7]=B,k[p+8]=B,k[p+9]=y,k[p+10]=y,k[p+11]=x,p+=12):(k[p+0]=y,k[p+1]=z,k[p+2]=x,k[p+3]=x,k[p+4]=B,k[p+5]=y,p+=6))),++u,X<h&&
R<f&&(y=R*(h+1)+X,z=y+1,x=z+(h+1),B=x-1,d?(k[w+0]=y,k[w+1]=z,k[w+2]=z,k[w+3]=x,k[w+4]=x,k[w+5]=y,k[w+6]=x,k[w+7]=B,k[w+8]=B,k[w+9]=y,k[w+10]=y,k[w+11]=x,w+=12):(k[w+0]=y,k[w+1]=z,k[w+2]=x,k[w+3]=x,k[w+4]=B,k[w+5]=y,w+=6));p-=C}h={values:k,numSurfaceIndices:m,numSkirtIndices:q};t[g]=h}a.indices=h.values;a.numSurfaceIndices=h.numSurfaceIndices;a.numSkirtIndices=h.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function l(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&(d[3]=a);
b<d[1]&&(d[1]=b);b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function h(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function n(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(f,"__esModule",{value:!0});var q=new g.ArrayPool(Float32Array);f.releaseGeometry=function(a){q.put(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};f.elevationSampler=d;f.createSphericalGlobeTile=function(c,g,f,t,p,E,G,H,I){var w=f[0],z=f[1],B=f[2];f=f[3];
var C=.1*b.earthRadius*(f-z),D=c-1,W=c-1,Q=c*c,J=q.get(5*(Q+(2*D+2*W))),F=I.geometryInfo.boundingBox;a.empty(F);var K=g[2]-g[0],L=g[3]-g[1],T=B-w,B=E[0],R=E[1];E=E[2];for(var X=0;X<=D;X++){var ba=X/D,ca=w+ba*T;u[X]=Math.sin(ca);r[X]=Math.cos(ca);y[X]=ba;x[X]=g[0]+ba*K}w=t&&!!(G&1);K=t&&!!(G&2);for(ca=T=0;ca<=W;ca++){var Z=ca/W,X=e.lerp(z,f,Z),da=Math.cos(X),U=Math.sin(X),ia=void 0;t?(ia=b.earthRadius/2*Math.log((1+U)/(1-U)),Z=(ia-g[1])/L):ia=180*X/Math.PI;for(X=0;X<=D;X++){var ba=y[X],ea=u[X],aa=
r[X],ga=b.earthRadius;p&&(ga+=d(x[X],ia,p)||0);aa=aa*da*ga-B;ea=ea*da*ga-R;ga=U*ga-E;l(aa,ea,ga,F);var fa=5*T;J[fa+0]=aa;J[fa+1]=ea;J[fa+2]=ga;J[fa+3]=ba;J[fa+4]=Z;fa=n(X,ca,D,W);if(-1<fa){var fa=5*(Q+fa),ja=w&&0===ca?-1:K&&ca===W?1:0,aa=0===ja?aa:-B,ea=0===ja?ea:-R,ga=0===ja?ga:b.earthRadius*ja-E;J[fa+0]=aa;J[fa+1]=ea;J[fa+2]=ga;J[fa+3]=0===ja?h(ba,Z):ba;J[fa+4]=0===ja?C:Z;0!==ja&&l(aa,ea,ga,F)}++T}}I.geometryInfo.numVertsPerRow=c;I.geometryInfo.vertexAttributes=J;I.geometryInfo.skirtLength=C;k.vec4.set(I.geometryInfo.uvOffsetAndScale,
0,0,1,1);m(I.geometryInfo,c,t?G:0,H)};f.createPlanarGlobeTile=function(b,c,e,g,f,r,u){var t=c[0],w=c[1],p=c[2]-t,y=c[3]-w,x=r?Math.max(0,(r[0]-c[0])/p):0,z=r?Math.max(0,(r[1]-c[1])/y):0,B=r?Math.min(1,(r[2]-c[0])/p):1;c=r?Math.min(1,(r[3]-c[1])/y):1;var C=B>x?1/(B-x):1,D=c>z?1/(c-z):1,J=-x*C,F=-z*D,K=.1*p,L=b-1,T=b-1,R=b*b,E=q.get(5*(R+(2*L+2*T))),G=u.geometryInfo.boundingBox;a.empty(G);for(var ca=0,Z=0;Z<=T;Z++){var da=Z/T,U=F+da*D,da=w+da*y;r&&(da<r[1]?(da=r[1],U=0):da>r[3]&&(da=r[3],U=1));for(var ia=
0;ia<=L;ia++){var ea=ia/L,aa=J+ea*C,ea=t+ea*p;r&&(ea<r[0]?(ea=r[0],aa=0):ea>r[2]&&(ea=r[2],aa=1));var ga=e?d(ea,da,e)||0:0,ea=ea-g[0],fa=da-g[1],ga=ga-g[2];l(ea,fa,ga,G);E[5*ca]=ea;E[5*ca+1]=fa;E[5*ca+2]=ga;E[5*ca+3]=aa;E[5*ca+4]=U;var ja=n(ia,Z,L,L);-1<ja&&(ja=5*(R+ja),E[ja]=ea,E[ja+1]=fa,E[ja+2]=ga,E[ja+3]=h(aa,U),E[ja+4]=K);++ca}}u.geometryInfo.numVertsPerRow=b;u.geometryInfo.vertexAttributes=E;u.geometryInfo.skirtLength=K;k.vec4.set(u.geometryInfo.uvOffsetAndScale,x,z,B-x,c-z);m(u.geometryInfo,
b,0,f)};var t=[],u=Array(c.MAX_TILE_TESSELATION+1),r=Array(c.MAX_TILE_TESSELATION+1),y=Array(c.MAX_TILE_TESSELATION+1),x=Array(c.MAX_TILE_TESSELATION+1)})},"esri/views/3d/support/ArrayPool":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function f(a,g){void 0===g&&(g=50);this.arrayConstructor=a;this.maxPoolSizePerCount=g;this.pool={}}f.prototype.get=function(a){var g=this.pool[a];g||(g={ptr:0,data:Array(this.maxPoolSizePerCount)},
this.pool[a]=g);0<g.ptr?(a=g.data[--g.ptr],g.data[g.ptr]=null):a=new this.arrayConstructor(a);return a};f.prototype.put=function(a){var g=this.pool[a.length];g.ptr<g.data.length&&(g.data[g.ptr++]=a)};return f}();f.ArrayPool=p})},"esri/views/3d/terrain/SphericalTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ../../../core/libs/gl-matrix-2/gl-matrix ../support/earthUtils ../support/geometryUtils ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),
function(p,f,k,a,g,b,e,c,d,m){function l(a,c,d,e){d=b.earthRadius+d;var g=Math.cos(a);e[0]=Math.cos(c)*g*d;e[1]=Math.sin(c)*g*d;e[2]=Math.sin(a)*d}return function(d){function h(a,b,c,e){var f=d.call(this,h.NumSubdivisionsAtLevel)||this;f.obb=[];f.isWebMercator=!1;f.tileUp=g.vec3f64.create();f.obb=Array(8);for(var l=0;8>l;l++)f.obb[l]=g.vec3f64.create();void 0!==a&&f.init(a,b,c,e);return f}k(h,d);h.prototype.init=function(a,e,h,f){d.prototype.init.call(this,a,e,h,f);this.isWebMercator=f.spatialReference.isWebMercator;
e=this.extentWGS84Rad[0];h=this.extentWGS84Rad[1];f=this.extentWGS84Rad[2];var k=this.extentWGS84Rad[3];a=a[0];var m=c.lerp(h,k,.5),n=c.lerp(e,f,.5);this.edgeLen=(f-e)*Math.cos(0===a?0:Math.min(Math.abs(h),Math.abs(k)))*b.earthRadius;this.edgeLen2=this.edgeLen*this.edgeLen;this.curvatureHeight=b.earthRadius-Math.sqrt(b.earthRadius*b.earthRadius-this.edgeLen2/4);l(m,n,0,this.centerAtSeaLevel);g.vec3.copy(this.tileUp,this.centerAtSeaLevel);g.vec3.normalize(this.tileUp,this.tileUp);this._updateOBB();
this.updateRadiusAndCenter()};h.prototype.updateRadiusAndCenter=function(){if(0===this.lij[0])g.vec3.set(this.center,0,0,0),this.radius=b.earthRadius+this.elevationBounds[1];else{d.prototype.updateRadiusAndCenter.call(this);var a=Math.max(g.vec3.squaredDistance(this.center,this.obb[0]),g.vec3.squaredDistance(this.center,this.obb[1]));this.radius=Math.sqrt(a)}};h.prototype.isVisible=function(a){if(!this.intersectsClippingArea)return!1;var b=a.planes;if(9<this.lij[0]){a=this.obb;for(var c=0;6>c;c++){for(var d=
void 0,d=0;8>d&&!e.plane.isPointOutside(b[c],a[d]);d++);if(8===d)return!1}return!0}return e.frustum.intersectsSphere(a,e.sphere.wrap(this.radius,this.center))};h.prototype.computeElevationBounds=function(){d.prototype.computeElevationBounds.call(this);this._updateOBB()};h.prototype.createGeometry=function(a,b,c){var d=this._isPole(this.lij[1],this.lij[0]);a.needsUpdate=!1;m.createSphericalGlobeTile(a.numVertsPerRow,this.extent,this.extentWGS84Rad,this.isWebMercator,a.samplerData,b,d,c,this.renderData);
this.updateMemoryUsed()};h.prototype._updateOBB=function(){for(var a=this.extentWGS84Rad,c=this.obb,d=0;2>d;d++){var e=this.elevationBounds[d],h=4*d;l(a[1],a[0],e,c[h++]);l(a[3],a[0],e,c[h++]);l(a[3],a[2],e,c[h++]);l(a[1],a[2],e,c[h++])}this.isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(g.vec3.set(c[1],0,0,b.earthRadius),g.vec3.set(c[2],0,0,b.earthRadius),g.vec3.set(c[5],0,0,b.earthRadius),g.vec3.set(c[6],0,0,b.earthRadius)):1===a&&(g.vec3.set(c[0],0,0,-b.earthRadius),g.vec3.set(c[3],
0,0,-b.earthRadius),g.vec3.set(c[4],0,0,-b.earthRadius),g.vec3.set(c[7],0,0,-b.earthRadius)))};h.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};h.NumSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];h.Pool=new a(h);return h}(d)})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ./TerrainConst ./terrainUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){function h(a,b){a&&!a.spatialReference.equals(b)&&(a=d.canProject(a.spatialReference,b)?d.project(a,b):null);return a}Object.defineProperty(f,"__esModule",{value:!0});p=function(d){function g(a){a=d.call(this,a)||this;a._changeListeners=new b;return a}k(g,d);g.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};g.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null};Object.defineProperty(g.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});g.prototype._computeStencilEnabledExtents=function(a,b){var d=[],e=0;for(a=a.items;e<a.length;e++){var g=a[e].layer;"IntegratedMeshLayer"===g.operationalLayerType&&null!=b&&(g=h(g.fullExtent,b),null!=g&&d.push(c.fromExtent(g)))}return d};
a([e.property({readOnly:!0})],g.prototype,"layerViewsExtent",null);a([e.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],g.prototype,"tiledLayersExtent",null);a([e.property({readOnly:!0,dependsOn:["spatialReference"]})],g.prototype,"stencilEnabledExtents",null);a([e.property()],g.prototype,"spatialReference",null);a([e.property()],g.prototype,"tilingScheme",null);a([e.property()],g.prototype,"defaultTiledLayersExtent",void 0);a([e.property({constructOnly:!0})],g.prototype,"layers",
void 0);a([e.property({constructOnly:!0})],g.prototype,"layerViews",void 0);return g=a([e.subclass()],g)}(e.declared(g));g=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}k(c,b);c.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};c.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};c.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?m.WEBMERCATOR_WORLD_EXTENT:m.GEOGRAPHIC_WORLD_EXTENT};a([e.property({dependsOn:["spatialReference"]})],
c.prototype,"layerViewsExtent",void 0);return c=a([e.subclass()],c)}(e.declared(p));f.SurfaceExtentHelperGlobal=g;p=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}k(d,b);d.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};d.prototype._computeLayerViewsExtent=function(){var a=c.empty(),b=this.spatialReference;
this.layerViews.forEach(function(d){d.isResolved()&&(d=d.fullExtentInLocalViewSpatialReference||d.layer.fullExtent,(d=h(d,b))&&c.expand(a,d))});var d=c.allFinite(a)?a:null,e=this._get("layerViewsExtent");return c.equals(d,e)?e:d};d.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var b=this.spatialReference,d=c.empty();this.layers.forEach(function(e){if(e.loaded&&l.isTiledLayer(e)){var g=l.getTiledLayerInfo(e,b,"local");e=g.tileInfo;g=g.fullExtent;e&&a.compatibleWith(e)&&
g&&g.spatialReference.equals(b)&&c.expand(d,g)}});this.defaultTiledLayersExtent&&c.expand(d,this.defaultTiledLayersExtent);var e=c.allFinite(d)?d:null,g=this._get("tiledLayersExtent");return c.equals(e,g)?g:e};return d=a([e.subclass()],d)}(e.declared(p));f.SurfaceExtentHelperLocal=p})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ./terrainUtils ./TilingScheme".split(" "),
function(p,f,k,a,g,b,e,c,d){return function(g){function f(a){a=g.call(this,a)||this;a._changeHandles=new b;return a}k(f,g);f.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};f.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};f.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var b=this.layers.find(function(b){return c.isTiledLayer(b)?b.isFulfilled()?b.isRejected()?!1:!!c.getTiledLayerInfo(b,a.viewSpatialReference,a.manifold).tileInfo:!0:!1});if(b)if(b.isResolved()){var e=c.getTiledLayerInfo(b,this.viewSpatialReference,this.manifold).tileInfo,e=new d(e),b=c.getKnownTiledServiceLevelCap(b.url);Infinity>b&&e.capMaxLod(b);this._set("tilingSchemeDone",
!0);this._lockTilingScheme(e)}else this._updateWhen(b);else this._set("tilingSchemeDone",!0)}};f.prototype._updateWhen=function(a){var b=this,c=a.when().catch(function(a){return a}).then(function(){c===b._waitTask&&b._update()});this._waitTask=c};f.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var c=a.levels.length-1;a=a.spatialReference.isWebMercator?d.makeWebMercatorAuxiliarySphere(c):d.makeWGS84WithTileSize(a.pixelSize[0],c)}this.tilingSchemeLocked=!0;this.tilingScheme=
a;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return b._updateTiledLayerExtent()}))};f.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};f.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold)this.tilingScheme=this.extentHelper.spatialReference.isWebMercator?d.WebMercatorAuxiliarySphere:d.makeWGS84WithTileSize(256),
this.extent=this.extentHelper.layerViewsExtent;else{var a=this.extentHelper.layerViewsExtent;a&&(this.tilingScheme=d.fromExtent(a,this.extentHelper.spatialReference),this.extent=a)}};a([e.property()],f.prototype,"tilingScheme",void 0);a([e.property()],f.prototype,"extent",void 0);a([e.property({value:!1})],f.prototype,"tilingSchemeLocked",void 0);a([e.property({readOnly:!0,value:!1})],f.prototype,"tilingSchemeDone",void 0);a([e.property({constructOnly:!0})],f.prototype,"viewSpatialReference",void 0);
a([e.property({constructOnly:!0})],f.prototype,"layers",void 0);a([e.property({constructOnly:!0})],f.prototype,"extentHelper",void 0);a([e.property({constructOnly:!0})],f.prototype,"manifold",void 0);return f=a([e.subclass()],f)}(e.declared(g))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../Color ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingBox ../support/imageUtils ./ResourceCounter ./TerrainConst ./TileGeometryFactory ./TileRenderData ./TileRenderer ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/tracer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainRendererPrograms ../../webgl/BufferObject ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H){function I(a){return function(b,c){b=b.screenDepth;c=c.screenDepth;return b<c?-a:b>c?a:0}}function N(a){var b=I(a);return function(c,d){return 0===c.tiles.length?-a:0===d.tiles.length?a:b(c.tiles.data[0],d.tiles.data[0])}}var S=B.assert,M=c.mat4f64.create(),P=c.vec3f64.create(),O=c.vec2f64.create(),W=d.create(),Q=c.vec4f64.create(),J=c.vec4f64.create(),F=c.vec4f64.create(),K=function(){return function(){this.extent=c.vec4f64.create();
this.maxLevel=this.minLevel=0;this.callback=null}}();p=function(){function f(a,c){this.initialized=!1;this.rctx=null;this.renderDataPool=new g(q.TileRenderData);this.perOriginTileData=new b({allocator:function(a){return a||{root:null,origin:null,tiles:new b}},deallocator:function(a){a.root=null;a.origin=null;a.tiles.clear();return a}});this.perOriginTileDataDirty=!0;this.tileIterator=new u.IteratorPreorder;this.highestVisibleLODTile=null;this.visible=!0;this.debugScreenSizePerspective=!1;this.wireframe=
C.copyParameters(L);this._opaque=!0;this._skirtScale=1;this._cullBackFaces=this._disableRendering=this._drawBorders=!1;this._renderOrder=1;this._velvetOverground=!0;this._slicePlaneEnabled=this._hasOverlays=!1;this.castShadows=!0;this.receiveShadows=!1;this.backgroundPromise=this.tileRenderer=this.emptyTex=null;this.tileBackgroundInitialized=!1;this.stencilEnabledLayerExtents=[];this.numOriginsRendered=this.numTilesCulled=this.numTilesRendered=this.numTrianglesRendered=0;this.resourceCounter=new l;
this.loaded=this.clippingExtent=null;this._loaded=!1;this.needsRender=!0;this.needsHighlight=this.didRender=!1;this.visibleScaleRangeQueries=new b({initialSize:10});this.visibleScaleRangeQueriesInvPtr=0;this.visibleScaleRangeQueryQueue=new b({initialSize:30});this.visibleScaleRangeQueryPool=new g(K,!1);this.manifold=a;this.tileSize=c||256}f.prototype.destroy=function(a){this.uninstall(a);this.backgroundPromise&&(this.backgroundPromise.cancel(),this.backgroundPromise=null)};f.prototype.install=function(a){a.addRenderPlugin([3,
8],this);this.drapedRenderer=a.getDrapedTextureRenderer()};f.prototype.uninstall=function(a){a.removeRenderPlugin(this)};Object.defineProperty(f.prototype,"disableRendering",{set:function(a){this._disableRendering=!!a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"opaque",{set:function(a){this._opaque=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"skirtScale",{set:function(a){this._skirtScale=a;this.setNeedsRender()},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"drawBorders",{set:function(a){this._drawBorders!==a&&(this._drawBorders=a,this._updatePrograms())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"cullBackFaces",{set:function(a){this._cullBackFaces=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderOrder",{set:function(a){this._renderOrder=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"velvetOverground",{set:function(a){this._velvetOverground!==a&&(this._velvetOverground=a,this._updatePrograms())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled!==a&&(this._slicePlaneEnabled=a,this._updatePrograms())},enumerable:!0,configurable:!0});f.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};f.prototype.setNeedsHighlight=function(a){this.needsHighlight=
a;this.setNeedsRender()};f.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=a;this.setNeedsRender()};f.prototype.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=a);this.setNeedsRender()};f.prototype.loadTile=function(a){S(null===a.renderData);a.renderData=this.renderDataPool.acquire();a.renderData.init();var b=this.getLocalOriginOfTile(a);a.createGeometry(a.renderData.updateGeometryState(a),b,"debug"===this.wireframe.mode);
a.renderData.localOrigin=b;this._updateTileGeometryBuffers(a);this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};f.prototype.queryVisibleLevelRange=function(a,b,d,e){var g=this.visibleScaleRangeQueryPool.acquire();c.vec4.copy(g.extent,a);g.minLevel=b?b:-Number.MAX_VALUE;g.maxLevel=null!=d?d:Number.MAX_VALUE;g.callback=e;this.visibleScaleRangeQueryQueue.push(g);this.setNeedsRender()};f.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};
f.prototype.updateTileGeometry=function(a){a.renderData.updateGeometryState(a);for(var b=a.renderData.geometryState,c=a.layerInfo[h.LayerClass.ELEVATION],d=0;d<c.length;d++)c[d].pendingUpdates&=~h.TileUpdateTypes.UPDATE_GEOMETRY;return b.needsUpdate?(a.renderData.vao&&this._releaseTileGeometry(a),a.createGeometry(b,a.renderData.localOrigin,"debug"===this.wireframe.mode),this._updateTileGeometryBuffers(a),!0):!1};f.prototype.unloadTile=function(a){this._releaseTileGeometry(a);a.renderData.texture&&
a.renderData.texture.dispose();this.renderDataPool.release(a.renderData);a.renderData=null;a.updateMemoryUsed()};f.prototype.getLocalOriginOfTile=function(a){if(10<=a.lij[0]){for(;7<a.lij[0];)a=a.parent;return a.centerAtSeaLevel}if("spherical"===this.manifold)return P;for(;a.parent;)a=a.parent;return a.centerAtSeaLevel};f.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};f.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,
numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}};f.prototype.getWireframeEnabled=function(){return"shader"===this.wireframe.mode};f.prototype.setDebugScreenSizePerspective=function(a){a!==this.debugScreenSizePerspective&&(this.debugScreenSizePerspective=a,this._updatePrograms())};f.prototype.setWireframe=function(a){var b=this;if(!1===a||!0===a)a={mode:a?"shader":"none"};var c=this.wireframe;if(void 0!==a.mode&&c.mode!==a.mode){var d="debug"===c.mode,e="debug"===
a.mode;c.mode=a.mode;this._updatePrograms();d!==e&&this.rootTiles&&u.traverseTilesPreorder(this.rootTiles,function(a){a.renderData&&(a.renderData.vao&&b._releaseTileGeometry(a),a.createGeometry(a.renderData.updateGeometryState(a),a.renderData.localOrigin,e),b._updateTileGeometryBuffers(a))})}for(var g in a)c.hasOwnProperty(g)&&(c[g]=a[g]),this.setNeedsRender();c.resolution&&(c.resolution=Math.min(c.resolution,this.tileSize),c.resolution=1<<Math.round(Math.log(c.resolution)/Math.LN2))};f.prototype.setNeedsRender=
function(){this.needsRender=!0;this.didRender=!1;this.perOriginTileDataDirty=!0};f.prototype.resetNeedsRender=function(){this.didRender&&(this.needsRender=0!==this.visibleScaleRangeQueryQueue.length,this.didRender=!1)};f.prototype.isOpaqueExcludingSlice=function(){var a=this.wireframe,a="shader"===a.mode&&(1>a.wireOpacity||1>a.surfaceOpacity);return this._opaque&&!a};f.prototype.isOpaque=function(){return this.isOpaqueExcludingSlice()&&!this._slicePlaneEnabled};f.prototype.updateTileBackground=function(b){this.backgroundPromise&&
this.backgroundPromise.cancel();this.backgroundPromise="string"===typeof b?m.requestImage(b).catch(function(){return null}):null!=b?e.resolve(a.toUnitRGBA(b)):e.resolve(null);this._renderTileBackground()};f.prototype.initializeRenderContext=function(a){var b=this,c=this.rctx=a.rctx;a=this.programRep=a.programRep;var d=function(a){e.when(a).then(function(){b.initialized=!0;b.setNeedsRender()}).catch(d)};d(this._renderTileBackground());this.programs={color:null,normal:null,depth:null,depthShadowMap:null,
highlight:null};this._updatePrograms();this.tileRenderer=new t(c,this.tileSize,a,this.resourceCounter,this.setNeedsRender.bind(this));this._renderTileBackground();this.emptyTex=x.createEmptyTexture(c)};f.prototype.uninitializeRenderContext=function(a){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};f.prototype.render=function(a){var b=a.rctx,c=b.gl;if(!this.initialized||this._disableRendering||!this.visible||
!this.rootTiles||!this.tileBackgroundInitialized)return!1;var d=this.isOpaque()?3:8;if(a.slot!==d)return!1;w.trace("# BEGIN RENDER TERRAIN");d=a.pass;b.setFaceCullingEnabled(this._cullBackFaces);var e=1===a.lightingData.helper.globalFactor;0===d?this._renderMaterialPass(a,this._updatePerOriginTileData()):3===d&&this.castShadows&&e?this._renderDepthPass(a,this.programs.depthShadowMap,this._updatePerOriginTileData()):1===d?this._renderDepthPass(a,this.programs.depth,this._updatePerOriginTileData()):
2===d?this._renderNormalPass(a,this._updatePerOriginTileData()):4===d&&this.needsHighlight&&(this._renderHighlightPass(a,this._updatePerOriginTileData()),b.clear(c.DEPTH_BUFFER_BIT));this._cullBackFaces&&b.setFaceCullingEnabled(!1);w.trace("# END RENDER TERRAIN");return!0};f.prototype.intersect=function(a,b,e,g,h){if(this.rootTiles&&(!a.isSelection||this.isOpaqueExcludingSlice())&&a.enableTerrain){var f=R,l=X;c.vec3.subtract(f,g,e);c.vec3.set(l,1/f[0],1/f[1],1/f[2]);var k=a.minResult,m=a.maxResult,
n=this.clippingExtent,r=this.tileIterator;r.reset(this.rootTiles);h=function(){var h=r.next();if(null===h.renderData)return"continue";if(a.enableInvisibleTerrain){if(!h.visible&&n&&!h.intersectsExtent(n))return"continue"}else if(!h.visible)return"continue";var t=h.renderData.geometryInfo,p=h.renderData.localOrigin,w=ba;c.vec3.subtract(w,e,p);var y=-q._skirtScale*t.skirtLength;if(0!==y){var x=h.tileUp;d.offset(t.boundingBox,y*x[0],y*x[1],y*x[2],W);d.expandWithBuffer(W,t.boundingBox,0,2)}if(!C.intersectAabbInvDir(0!==
y?W:t.boundingBox,w,l,a.tolerance))return"continue";var x=function(d,l,n){if(0<=d&&(a.enableBackfacesTerrain||0>c.vec3.dot(l,f))&&(a.enableInvisibleTerrain||!a.isSelection||null==b||b(e,g,d))){n=void 0;if(void 0===k.dist||d<k.dist)n=u.tile2str(h),k.set(void 0,n,d,l,M,void 0),k.setIntersector("TerrainRenderer");if(void 0===m.dist||d>m.dist)n=u.tile2str(h),m.set(void 0,n,d,l,M,void 0),m.setIntersector("TerrainRenderer")}},z=ca;c.vec3.subtract(z,g,p);var p=t.indices,B={data:t.vertexAttributes,size:3,
offsetIdx:0,strideIdx:5},t=t.numWithoutSkirtIndices/3;C.intersectTriangles(w,z,0,t,p,B,null,x);0!==y&&u.intersectSkirts(w,z,t,p.length/3,p,B,null,"spherical"===q.manifold?function(a){return c.vec3.scale(a,a,y/c.vec3.length(a))}:function(a){return c.vec3.set(a,0,0,y)},x)};for(var q=this;!r.done;)h()}};f.prototype._renderTileBackground=function(){var a=this;if(this.rctx&&this.backgroundPromise&&this.tileRenderer)return this.backgroundPromise.then(function(b){a.tileRenderer&&(a.tileBackgroundInitialized=
!0,a.tileRenderer.setBackground(b),a.rootTiles&&u.traverseTilesPreorder(a.rootTiles,function(b){a.tileRenderer.updateTileTexture(b)}))})};f.prototype._updatePrograms=function(){var a="spherical"===this.manifold,b=a?"global":"local",c="shader"===this.wireframe.mode,d=this.programRep;this.programs.color=d.getProgram(D.colorPass,{viewingMode:b,mode:c||this._drawBorders?"wireframe":"normal",spherical:a,overlay:this._hasOverlays,atmosphere:a&&this._velvetOverground,wireframeTexture:c,tileBorders:this._drawBorders,
receiveShadows:this.receiveShadows,screenSizePerspective:this.debugScreenSizePerspective,slice:this._slicePlaneEnabled});this.programs.normal=d.getProgram(D.normalPass,{viewingMode:b,spherical:a,alphaZero:!0});this.programs.depth=d.getProgram(D.depthPass,{viewingMode:b,spherical:a,shadowMap:!1});this.programs.depthShadowMap=d.getProgram(D.depthPass,{viewingMode:b,spherical:a,shadowMap:!0});this.programs.highlight=d.getProgram(D.highlightPass,{viewingMode:b,spherical:a});this.setNeedsRender()};f.prototype._renderMaterialPass=
function(a,b){var d=this,e=a.shadowMap&&a.shadowMap.enabled,g=a.rctx;this.receiveShadows!==e&&(this.receiveShadows=e,this._updatePrograms());e=!this.drapedRenderer.isEmpty();e!==this._hasOverlays&&(this._hasOverlays=e,this._updatePrograms());e=a.camera;g.setDepthTestEnabled(!0);var h=this.wireframe,f=this.programs.color;g.bindProgram(f);if("shader"===h.mode||this._drawBorders)f.setUniform1f("wireframe.width",this.wireframe.width),f.setUniform1f("wireframe.falloff",Math.min(h.width,h.falloff)),f.setUniform1f("wireframe.wireOpacity",
h.wireOpacity),f.setUniform1f("wireframe.surfaceOpacity",h.surfaceOpacity),f.setUniform4fv("wireframe.color",h.color);a.shadowMap&&a.shadowMap.bind(f);a.ssaoHelper&&a.ssaoHelper.setUniforms(f);f.setUniform1i("tex",0);f.setUniform1i("overlay0Tex",1);f.setUniform1i("overlay1Tex",2);f.setUniformMatrix4fv("viewNormal",e.viewInverseTransposeMatrix);f.setUniformMatrix4fv("proj",e.projectionMatrix);a.lightingData.helper.setUniforms(f,!0);g=e.viewMatrix;c.vec3.set(T,g[12],g[13],g[14]);c.vec3.normalize(T,
T);f.setUniform3fv("viewDirection",T);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();this.isOpaque()?this._renderTiles(a,f,b):a.offscreenRenderingHelper.renderToTargets(function(){return d._renderTiles(a,f,b)},a.offscreenRenderingHelper.tmpColor,a.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries();0<this.numTilesRendered&&!this._loaded&&(this._loaded=!0,this.loaded&&this.loaded())};f.prototype._renderDepthPass=
function(a,b,c){var d=a.rctx,e=a.camera;d.bindProgram(b);d.setBlendingEnabled(!1);d.setDepthTestEnabled(!0);b.setUniformMatrix4fv("model",M);b.setUniformMatrix4fv("viewNormal",e.viewInverseTransposeMatrix);O[0]=e.near;O[1]=e.far;b.setUniform2fv("nearFar",O);this._renderTilesAuxiliary(a,b,c,!1)};f.prototype._renderNormalPass=function(a,b){var c=a.rctx,d=a.camera,e=this.programs.normal;c.bindProgram(e);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);e.setUniformMatrix4fv("viewNormal",d.viewInverseTransposeMatrix);
this._renderTilesAuxiliary(a,e,b,!1)};f.prototype._renderHighlightPass=function(a,b){var c=a.rctx,d=this.programs.highlight;c.bindProgram(d);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);var e=a.offscreenRenderingHelper;c.bindTexture(e.depthTexture,3);d.setUniform1i("depthTex",3);d.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height);this._renderTilesAuxiliary(a,d,b,!0)};f.prototype._updatePerOriginTileData=function(){var a=this.perOriginTileData;if(!this.perOriginTileDataDirty)return a;
this.highestVisibleLODTile=null;a.clear();this._renderCollectOrigins(a);if(0!==this._renderOrder){for(var b=I(this._renderOrder),c=0;c<a.length;c++)this._sortFrontToBack(a.data[c].tiles,b);b=N(this._renderOrder);this._sortFrontToBack(a,b)}this.perOriginTileDataDirty=!1;return a};f.prototype._renderCollectOrigins=function(a){for(var b=this.rootTiles,c="spherical"===this.manifold,d=0;d<b.length;d++){var e=b[d],g=a.pushNew();g.root=e;g.origin=c?P:e.centerAtSeaLevel;g.tiles.clear();this._renderCollectOriginsForRoot(a,
g)}};f.prototype._renderCollectOriginsForRoot=function(a,b){var c=this.tileIterator;for(c.resetOne(b.root);!c.done;){var d=c.next(),e=d.renderData;if(e&&!d.visible)this.numTilesCulled++,c.skipSubtree();else{var g=a.back();if(7===d.lij[0]){if(g===b||0!==g.tiles.length)g=a.pushNew(),g.tiles.clear();g.root=d;g.origin=d.centerAtSeaLevel}if(e){10<=d.lij[0]?a.back().tiles.push(d):b.tiles.push(d);if(!this.highestVisibleLODTile||d.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=d;c.skipSubtree()}}}};
f.prototype._sortFrontToBack=function(a,b){a.sort(b)};f.prototype._scaleQueriesForTile=function(a){var b=a.extent;a=a.lij[0];for(var c=0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],e=d.extent;a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(c,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):c++}};f.prototype._updateStencilReadStateForTile=function(a,b){if(a.stencilRenderingHelper&&
a.stencilRenderingHelper.enabled){for(var c=this.stencilEnabledLayerExtents,d=!1,e=0;e<c.length;e++)if(b.intersectsExtent(c[e])){d=!0;break}d?a.stencilRenderingHelper.enableStencilRead():a.stencilRenderingHelper.disableStencilRead()}};f.prototype._renderTilesAuxiliary=function(a,b,c,d){var e=a.rctx,g=e.gl,h=a.camera,f=h.viewMatrix;b.setUniformMatrix4fv("proj",h.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);d&&(b.setUniform1i("overlay0Tex",1),b.setUniform1i("overlay1Tex",2));for(h=
0;h<c.length;h++){var l=c.data[h];b.setUniform3fv("origin",l.origin);C.bindView(l.origin,f,b);for(var k=0;k<l.tiles.length;k++){var m=l.tiles.data[k],n=m.renderData;d&&(this._bindOverlayTextures(b,n.overlays,!0),b.setUniform1f("overlayOpacity",n.overlayOpacity));this._updateStencilReadStateForTile(a,m);e.bindVAO(n.vao);G.assertCompatibleVertexAttributeLocations(n.vao,b);e.drawElements(g.TRIANGLES,0!==this._skirtScale?n.vao.indexBuffer.size:n.geometryInfo.numWithoutSkirtIndices,n.vao.indexBuffer.indexType,
0)}}e.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};f.prototype._renderTiles=function(a,b,d){var e=a.rctx,g=e.gl,h=a.camera,f=h.viewMatrix;if(this.debugScreenSizePerspective&&this.pointsOfInterest){var l=z.getSettings("spherical"===this.manifold?"global":"local");l.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:h.fovY});C.bindScreenSizePerspective(l,a,b,"screenSizePerspective")}b.setUniform1f("skirtScale",this._skirtScale);for(h=
0;h<d.length;h++){l=d.data[h];b.setUniform3fv("origin",l.origin);C.bindView(l.origin,f,b);var k=a.sliceHelper&&a.sliceHelper.plane;k&&C.bindSlicePlane(l.origin,k,b);a.shadowMap&&a.shadowMap.bindView(b,l.origin);this.numOriginsRendered++;l=l.tiles;if(0!==l.length){var k="debug"===this.wireframe.mode?g.LINES:g.TRIANGLES,m=this.highestVisibleLODTile,n=void 0,r=void 0;m?(n=m.vlevel,r=this.tileSize/this.wireframe.resolution):(n=16,r=this.tileSize/64);for(m=0;m<l.length;m++){var q=l.data[m],t=q.renderData;
this._updateStencilReadStateForTile(a,q);w.trace("# RENDER TILE "+u.tile2str(q)+", screenDepth:"+q.screenDepth);var p=t.geometryInfo.uvOffsetAndScale,y=t.texOffsetAndScale;c.vec4.set(F,p[0]*y[2]+y[0],p[1]*y[3]+y[1],p[2]*y[2],p[3]*y[3]);b.setUniform4fv("texOffsetAndScale",F);e.bindTexture(t.textureReference||t.texture,0);b.setUniform1f("opacity",t.opacity);this._bindOverlayTextures(b,t.overlays,!1);b.setUniform1f("overlayOpacity",t.overlayOpacity);("shader"===this.wireframe.mode||this._drawBorders)&&
b.setUniform1f("wireframe.subdivision",r*(1<<n-q.vlevel));p=0!==this._skirtScale?t.vao.indexBuffer.size:t.geometryInfo.numWithoutSkirtIndices;e.bindVAO(t.vao);G.assertCompatibleVertexAttributeLocations(t.vao,b);e.drawElements(k,p,t.vao.indexBuffer.indexType,0);q.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=p/3;this._scaleQueriesForTile(q)}}}e.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};f.prototype._bindOverlayTextures=
function(a,b,c){for(var d=0;2>d;d++){var e=2*d,g=b[d],h=c?g.highlightRenderTargetId:g.renderTargetId;h?(h=this.drapedRenderer.getRenderTargetTexture(h),Q[e]=g.texOffset[0],Q[e+1]=g.texOffset[1],J[e]=g.texScale[0],J[e+1]=g.texScale[1],this.rctx.bindTexture(h,1+d)):(Q[e]=0,Q[e+1]=0,J[e]=0,J[e+1]=0,this.rctx.bindTexture(this.emptyTex,1+d))}a.setUniform4fv("overlayTexOffset",Q);a.setUniform4fv("overlayTexScale",J)};f.prototype._updateTileGeometryBuffers=function(a){var b=this.rctx,c=b.gl;a=a.renderData;
var d=a.geometryInfo.indices;a.vao=new H(b,r.Default3D,{geometry:y.Pos3Tex},{geometry:E.createVertex(b,c.STATIC_DRAW,a.geometryInfo.vertexAttributes)},E.createIndex(b,c.STATIC_DRAW,d));this.setNeedsRender()};f.prototype._releaseTileGeometry=function(a){a=a.renderData;a.vao.dispose(!0);a.vao=null;n.releaseGeometry(a.geometryInfo);this.setNeedsRender()};f.prototype._prepareScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&
0<b.length;){var c=b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=a.length};f.prototype._processScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};return f}();var L={mode:"none",width:1.5,falloff:1.5,wireOpacity:1,surfaceOpacity:0,color:[1,1,1,0],resolution:64},T=c.vec3f64.create(),R=c.vec3f64.create(),X=c.vec3f64.create(),
ba=c.vec3f64.create(),ca=c.vec3f64.create();return p})},"esri/views/3d/terrain/ResourceCounter":function(){define(["require","exports"],function(p,f){return function(){function f(){this._numTileTexturesComposited=0}Object.defineProperty(f.prototype,"numTileTexturesComposited",{get:function(){return this._numTileTexturesComposited},enumerable:!0,configurable:!0});f.prototype.incrementNumTileTexturesComposited=function(){this._numTileTexturesComposited++};f.prototype.resetNumTileTexturesComposited=
function(){this._numTileTexturesComposited=0};return f}()})},"esri/views/3d/terrain/TileRenderData":function(){define(["require","exports","../../../core/libs/gl-matrix-2/gl-matrix","../../../geometry/support/aaBoundingBox"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function g(){this.overlayTexOffset=k.vec2f64.create();this.texOffsetAndScale=k.vec4f64.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:a.empty(),numSurfaceIndices:0,numSkirtIndices:0,
numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:k.vec4f64.create()};this.init()}g.prototype.init=function(){var b=this.geometryInfo;b.indices=null;b.vertexAttributes=null;a.empty(b.boundingBox);b.numSurfaceIndices=0;b.numSkirtIndices=0;b.numWithoutSkirtIndices=0;b.numVertsPerRow=0;this.textureReference=this.texture=this.vao=this.geometryState=null;k.vec4.set(this.texOffsetAndScale,0,0,1,1);this.opacity=1;if(this.overlays)for(var b=0,e=this.overlays;b<e.length;b++){var c=e[b];
c.renderTargetId=null;c.highlightRenderTargetId=null;k.vec2.set(c.texScale,1,1);k.vec2.set(c.texOffset,0,0)}else for(this.overlays=[null,null],b=0;2>b;b++)this.overlays[b]={renderTargetId:null,highlightRenderTargetId:null,texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};g.prototype.updateGeometryState=function(a){return this.geometryState=a.geometryState(this.geometryState)};g.prototype.estimateGeometryMemoryUsage=function(){var a=this.geometryInfo;return a.indices.byteLength+
a.vertexAttributes.byteLength};return g}();f.TileRenderData=p})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ./TerrainConst ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/shaders/MiscPrograms ../../vectorTiles/tileRendererHelper3D ../../vectorTiles/VectorTileDisplayObject ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t){function u(a){return a instanceof HTMLImageElement||a instanceof HTMLCanvasElement}var r=Array(20),y=[0,0];return function(){function f(a,d,h,f,k){this._blackTex=this._backgroundTex=null;this.tileSize=256;this._context=a;this.tileSize=d;this._resourceCounter=f;this._setNeedsRender=k;a.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,a.parameters.maxMaxAnisotropy));d=new Float32Array(20);d[0]=-1;d[1]=-1;d[2]=0;d[3]=0;d[4]=0;d[5]=1;d[6]=
-1;d[7]=0;d[8]=1;d[9]=0;d[10]=-1;d[11]=1;d[12]=0;d[13]=0;d[14]=1;d[15]=1;d[16]=1;d[17]=0;d[18]=1;d[19]=1;this._vaoQuad=new t(a,g.Default3D,{geometry:b.Pos3Tex},{geometry:l.createVertex(a,35044,d)});this._blendLayersProgram=h.getProgram(c.blendLayers);this._blackTex=e.createColorTexture(this._context,[0,0,0,1])}f.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vtFBO&&(this._vtFBO.dispose(),this._vtFBO=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);
this._backgroundTex&&(this._backgroundTex.dispose(),this._backgroundTex=null);this._blackTex&&(this._blackTex.dispose(),this._blackTex=null);this._blendLayersProgram&&(this._blendLayersProgram.dispose(),this._blendLayersProgram=null);this._context&&(this._context=null)};f.prototype.updateTileTexture=function(b){for(var c=a.LayerClass.MAP,d=b.layerInfo[c],e=0;e<d.length;e++)d[e].pendingUpdates&=~a.TileUpdateTypes.UPDATE_TEXTURE;if(b.renderData){for(var e=b.renderData,g=b.parentSurface,h=g.baseOpacity,
f=0,l=!1,m=d.length-1,q=d.length,t=0;t<d.length;t++){var p=d[t],y=g.layerViewByIndex(t,c),x=y.fullOpacity;r[t]=x;this._isBaseLayer(y.layer)&&q>=d.length&&(q=t);if(p.data||p.upsampleFromTile)if(f++,y.isOpaque&&1===x){l=!0;m=t;break}}0===f&&this._backgroundTex?(e.opacity=h,e.textureReference=this._backgroundTex,k.vec4.set(e.texOffsetAndScale,0,0,1,1)):1===f&&l?(p=d[m],g=d=void 0,p.data?(d=p,k.vec4.set(e.texOffsetAndScale,0,0,1,1)):(g=p.upsampleFromTile,d=g.tile.layerInfo[c][m],k.vec4.set(e.texOffsetAndScale,
g.offset[0],g.offset[1],g.scale,g.scale)),e.opacity=h,d&&(u(d.data)&&(d.data=this._buildTexture(d.data),g?g.tile.updateMemoryUsed():b.updateMemoryUsed()),d.data instanceof n&&(e.textureReference=d.data))):(e.opacity=this._composeMapLayers(b,d,m,q,l,r),e.textureReference=null,k.vec4.set(e.texOffsetAndScale,0,0,1,1));this._setNeedsRender()}};f.prototype.setBackground=function(a){u(a)?this._backgroundTex=this._buildTexture(a):this._backgroundTex=e.createColorTexture(this._context,a||[0,0,0,0])};f.prototype._buildTexture=
function(a){var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},c=this._context,d;if(a)try{d=new n(c,b,a)}catch(D){d=e.createEmptyTexture(c),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}else b.width=b.height=this.tileSize,d=new n(c,b);c.bindTexture(d);d.generateMipmap();return d};f.prototype._bindFBO=function(a,b,c,d){a&&a.width===b&&a.height===c||(a&&a.dispose(),
a=h.create(this._context,{colorTarget:0,depthStencilTarget:d?1:0,width:b,height:c}));this._context.bindFramebuffer(a);return a};f.prototype._drawRasterData=function(a,b,c,d){void 0===d&&(d=1);var e=this._context,g=this._blendLayersProgram,h=this._vaoQuad;e.bindProgram(g);e.bindVAO(h);q.assertCompatibleVertexAttributeLocations(h,g);e.bindTexture(a,0);g.setUniform1i("tex",0);g.setUniform1f("scale",b);g.setUniform2f("offset",c[0],c[1]);g.setUniform1f("opacity",d);e.drawArrays(5,0,q.vertexCount(h,"geometry"))};
f.prototype._composeMapLayers=function(b,c,e,g,h,f){b.renderData.texture||(b.renderData.texture=this._buildTexture(),b.updateMemoryUsed());var l=a.LayerClass.MAP,k=b.renderData.texture,r=this._context;this._fbo=this._bindFBO(this._fbo,k.descriptor.width,k.descriptor.height,!1);var q=r.gl;r.setViewport(0,0,this.tileSize,this.tileSize);r.setClearColor(0,0,0,0);r.setClearDepth(1);r.clear(q.COLOR_BUFFER_BIT);r.setDepthTestEnabled(!1);r.setBlendFunction(1,771);r.setBlendEquation(32774);r.setBlendingEnabled(!0);
!h&&this._backgroundTex&&this._drawRasterData(this._backgroundTex,1,y);h=b.parentSurface.baseOpacity;for(var t=!1;0<=e;e--){var p=c[e],w=p,x=b.lij,z=y,B=1;!p.data&&p.upsampleFromTile&&(B=p.upsampleFromTile,x=B.tile.lij,w=B.tile.layerInfo[l][e],z=[B.offset[0],B.offset[1]],B=B.scale);if(w){e<g&&1>h&&!t&&(r.setBlendFunction(0,770),this._drawRasterData(this._blackTex,1,y,h),r.setBlendFunction(1,771),t=!0);if(w.data instanceof m){var C=b.parentSurface.layerViewByIndex(e,l);this._vtFBO=this._bindFBO(this._vtFBO,
this.tileSize,this.tileSize,!0);r.setClearColor(1,1,1,0);r.clear(q.COLOR_BUFFER_BIT|q.DEPTH_BUFFER_BIT);d(this._context,x,w.data,C.renderer,C.schemaHelper,k.descriptor.width,k.descriptor.height);w.data.dispose();w.data=this._buildTexture();r.bindTexture(w.data);q.copyTexImage2D(r.gl.TEXTURE_2D,0,w.data.descriptor.pixelFormat,0,0,this.tileSize,this.tileSize,0);w.data.generateMipmap();r.bindFramebuffer(this._fbo);w===p?b.updateMemoryUsed():p.upsampleFromTile.tile.updateMemoryUsed()}else u(w.data)&&
(w.data=this._buildTexture(w.data),w===p?b.updateMemoryUsed():p.upsampleFromTile.tile.updateMemoryUsed());w.data instanceof n&&this._drawRasterData(w.data,B,z,f[e])}}r.bindTexture(k);q.copyTexImage2D(r.gl.TEXTURE_2D,0,k.descriptor.pixelFormat,0,0,k.descriptor.width,k.descriptor.height,0);k.generateMipmap();r.bindFramebuffer(null);r.setBlendFunctionSeparate(770,771,1,771);r.setBlendingEnabled(!1);this._resourceCounter.incrementNumTileTexturesComposited();return t?1:h};f.prototype._isBaseLayer=function(a){return a.parent&&
"esri.Basemap"===a.parent.declaredClass&&-1<a.parent.baseLayers.indexOf(a)};return f}()})},"esri/views/vectorTiles/tileRendererHelper3D":function(){define("require exports ../../geometry ../../Viewpoint ../../core/has ../../core/libs/gl-matrix-2/gl-matrix ../2d/ViewState".split(" "),function(p,f,k,a,g,b,e){var c=new e({viewpoint:new a({targetGeometry:new k.Point(0,0),scale:1,rotation:0}),size:[256,256]});return function(a,e,f,h,k,q,t){if(q!==t)throw Error("It is expected that tiles are square!");
var d=k.adjustLevel(e[0]),d={context:a,drawPhase:0,state:c,stationary:!0,pixelRatio:1,displayLevel:d,requiredLevel:d,drawphase:0,renderer:h,layerOpacity:1,globalOpacity:1};h.initializeProgramCache(a);var l=k.getScale(e[0]);k=k.getShift(e,l);var m=k[1];f.tileTransform.displayCoord[0]=-1-k[0];f.tileTransform.displayCoord[1]=1+m;k=f.tileTransform.transform;b.mat4.identity(k);l=.25*l/q;k[0]=l;k[5]=-l;a.setBlendFunctionSeparate(1,771,1,771);d.state.size=[q,t];h.setStateParams(d.state,d.pixelRatio,e[0]);
f.attachWithContext(a);a.setFaceCullingEnabled(!1);a.setDepthFunction(515);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);f.processRender(d);a.setDepthWriteEnabled(!1);a.setBlendingEnabled(!0);d.drawphase=1;f.processRender(d);d.drawphase=2;f.processRender(d);g("esri-vector-tiles-debug")&&h.renderTileInfo(a,f);a.setDepthWriteEnabled(!0);a.setDepthTestEnabled(!1);a.setFaceCullingEnabled(!0)}})},"esri/views/2d/ViewState":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators ./../../core/libs/gl-matrix-2/gl-matrix ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){var h=[0,0];return function(e){function f(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];a=e.apply(this,a)||this;a._viewpoint2D={center:d.vec2f64.create(),rotation:0,scale:0,spatialReference:null};a.center=[0,0];a.extent=new g.Extent;a.id=0;a.inverseTransform=d.mat2df64.create();a.resolution=0;a.rotation=0;a.scale=0;a.transform=d.mat2df64.create();a.transformNoRotation=d.mat2df64.create();a.displayMat3=d.mat3f32.create();a.displayViewMat3=d.mat3f32.create();
a.viewMat3=d.mat3f32.create();a.viewMat2d=d.mat2df32.create();a.worldScreenWidth=0;a.size=[0,0];return a}k(f,e);n=f;Object.defineProperty(f.prototype,"pixelRatio",{set:function(a){this._set("pixelRatio",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"size",{set:function(a){this._set("size",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"viewpoint",{set:function(a){if(a){var b=this._viewpoint2D,c=a.targetGeometry;b.center[0]=
c.x;b.center[1]=c.y;b.rotation=a.rotation;b.scale=a.scale;b.spatialReference=c.spatialReference}this._update()},enumerable:!0,configurable:!0});f.prototype.copy=function(a){var b=this.size,c=this.viewpoint;c&&b?(this.viewpoint=l.copy(c,a.viewpoint),this._set("size",d.vec2.copy(b,a.size))):(this.viewpoint=a.viewpoint.clone(),this._set("size",[a.size[0],a.size[1]]));this._set("pixelRatio",a.pixelRatio);return this};f.prototype.clone=function(){return new n({size:this.size,viewpoint:this.viewpoint.clone(),
pixelRatio:this.pixelRatio})};f.prototype.toMap=function(a,b,c){if(m.isVec2(b))return d.vec2.transformMat2d(a,b,this.inverseTransform);h[0]=b;h[1]=c;return d.vec2.transformMat2d(a,h,this.inverseTransform)};f.prototype.toScreen=function(a,b,c){if(m.isVec2(b))return d.vec2.transformMat2d(a,b,this.transform);h[0]=b;h[1]=c;return d.vec2.transformMat2d(a,h,this.transform)};f.prototype.toScreenNoRotation=function(a,b,c){if(m.isVec2(b))return d.vec2.transformMat2d(a,b,this.transformNoRotation);h[0]=b;h[1]=
c;return d.vec2.transformMat2d(a,h,this.transformNoRotation)};f.prototype.pixelSizeAt=function(a){return l.pixelSizeAt(a,this.viewpoint,this.size)};f.prototype.getScreenTransform=function(a,b){var c=this._viewpoint2D.center,d=this._get("pixelRatio")||1,e=this._get("size");l.getMatrix(a,c,e,b,0,d);return a};f.prototype._update=function(){var a=this._viewpoint2D,c=a.center,e=a.spatialReference,h=a.scale,f=a.rotation,a=this._get("pixelRatio")||1,k=this._get("size");this._set("id",this.id+1);var m=new b({targetGeometry:new g.Point(c[0],
c[1],e),scale:h,rotation:f});this._set("viewpoint",m);if(k&&e&&h)return this.resolution=l.getResolution(m),this.rotation=f,this.scale=h,this.spatialReference=e,d.vec2.copy(this.center,c),d.mat3.set(this.displayMat3,2/k[0],0,0,0,-2/k[1],0,-1,1,1),h=d.mat3.identity(this.viewMat3),c=d.vec2f32.fromValues(k[0]/2,k[1]/2),e=d.vec2f32.fromValues(-k[0]/2,-k[1]/2),f=d.common.toRadian(f),d.mat3.translate(h,h,c),d.mat3.rotate(h,h,f),d.mat3.translate(h,h,e),d.mat3.multiply(this.displayViewMat3,this.displayMat3,
h),h=d.mat2d.identity(this.viewMat2d),d.mat2d.translate(h,h,c),d.mat2d.rotate(h,h,f),d.mat2d.translate(h,h,e),l.getExtent(this.extent,m,k),l.getTransform(this.transform,m,k,a),d.mat2d.invert(this.inverseTransform,this.transform),l.getTransformNoRotation(this.transformNoRotation,m,k,a),this.worldScreenWidth=l.getWorldScreenWidth(this.spatialReference,this.resolution),this};var n;a([c.property({readOnly:!0})],f.prototype,"id",void 0);a([c.property({value:1,json:{write:!0}})],f.prototype,"pixelRatio",
null);a([c.property({json:{write:!0}})],f.prototype,"size",null);a([c.property({type:b,json:{write:!0}})],f.prototype,"viewpoint",null);return f=n=a([c.subclass("esri.views.2d.ViewState")],f)}(c.declared(e))})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["require","exports"],function(p,f){function k(a){return a instanceof Float32Array&&2<=a.length}function a(a){return Array.isArray(a)&&2<=a.length}Object.defineProperty(f,"__esModule",{value:!0});f.isVec2f32=k;f.isVec2f64=a;f.isVec2=
function(g){return k(g)||a(g)}})},"esri/views/2d/viewpointUtils":function(){define("require exports ../../Viewpoint ../../core/Error ../../core/promiseUtils ../../core/wgs84Constants ../../core/libs/gl-matrix-2/gl-matrix ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/scaleUtils ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../../geometry/support/webMercatorUtils".split(" "),function(p,
f,k,a,g,b,e,c,d,m,l,h,n,q,t){function u(a,b,c,d){return d&&c&&!d.equals(c)&&q.canProject(d,c)&&d.isWebMercator?(d.isWebMercator?(c=b[1],89.99999<c?c=89.99999:-89.99999>c&&(c=-89.99999),c=Math.sin(e.common.toRadian(c)),a=e.vec2.set(a,e.common.toRadian(b[0])*S,.5*S*Math.log((1+c)/(1-c)))):(c=e.common.toDegree(b[0]/S),a=e.vec2.set(a,c-360*Math.floor((c+180)/360),e.common.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*b[1]/S))))),a):e.vec2.copy(a,b)}function r(a){return a.wkid?a:a.spatialReference||l.WGS84}
function y(a,b){return b.type?e.vec2.set(a,b.x,b.y):e.vec2.copy(a,b)}function x(a,b){return Math.max(a.width/b[0],a.height/b[1])*I(a.spatialReference)}function z(a,b,e){var g;if(!a)return null;if(Array.isArray(a)&&2===a.length&&"number"===typeof a[0]&&"number"===typeof a[1])return new m(a);if(a.reduce)return a.reduce(function(a,c){return z(c,b,a)},e);a instanceof d?g=a:a.geometry&&(g=a.geometry);if(!g)return null;a="point"===g.type?new c({xmin:g.x,ymin:g.y,xmax:g.x,ymax:g.y,spatialReference:g.spatialReference}):
g.extent;if(!a)return null;g=q.canProject(a,b);if(!a.spatialReference.equals(b)&&g)a=q.project(a,b);else if(!g)return null;return e=e?e.union(a):a.clone()}function w(a,b){if(!a)return new k({targetGeometry:new m,scale:0,rotation:0});var d=b.spatialReference,g=b.size,h=b.viewpoint,f=b.constraints,l=null;"esri.Viewpoint"===a.declaredClass?l=a:a.viewpoint?l=a.viewpoint:a.target&&"esri.Viewpoint"===a.target.declaredClass&&(l=a.target);var n=null;if(l&&l.targetGeometry)n=l.targetGeometry;else if(a instanceof
c)n=a;else if(a||a&&(a.hasOwnProperty("center")||a.hasOwnProperty("extent")||a.hasOwnProperty("target")))n=z(a.center,d)||z(a.extent,d)||z(a.target,d)||z(a,d);!n&&h&&h.targetGeometry?n=h.targetGeometry:!n&&b.extent&&(n=b.extent);var p=r(n);d||(d=r(b.spatialReference||b.extent||n));if(!t.canProject(n,d)&&p&&!p.equals(d))return null;var w=y(e.vec2f64.create(),n.center?n.center:n),p=new m(u(w,w,p,d),d),w=null,w=l&&l.targetGeometry&&"point"===l.targetGeometry.type?l.scale:a.hasOwnProperty("scale")&&a.scale?
a.scale:a.hasOwnProperty("zoom")&&-1!==a.zoom&&f&&f.effectiveLODs?f.zoomToScale(a.zoom):Array.isArray(n)||"point"===n.type||"extent"===n.type&&0===n.width&&0===n.height?b.extent&&q.canProject(b.extent,d)?x(q.project(b.extent,d),g):b.extent?x(b.extent,g):h.scale:q.canProject(n.extent,d)?x(q.project(n.extent,d),g):x(n.extent,g);b=0;l?b=l.rotation:a.hasOwnProperty("rotation")?b=a.rotation:h&&(b=h.rotation);a=new k({targetGeometry:p,scale:w,rotation:b});f&&(a=f.fit(a),f.rotationEnabled||(a.rotation=b));
return a}function B(a,b){var c=a.targetGeometry,d=b.targetGeometry;c.x=d.x;c.y=d.y;c.spatialReference=d.spatialReference;a.scale=b.scale;a.rotation=b.rotation;return a}function C(a,b,c){return c?e.vec2.set(a,.5*(b[0]-c.right+c.left),.5*(b[1]-c.bottom+c.top)):e.vec2.scale(a,b,.5)}function D(a,b,c,d){f.getTransform(a,b,c,d);return e.mat2d.invert(a,a)}function E(a,b,c){var d=H(b);b=Math.abs(Math.cos(d));d=Math.abs(Math.sin(d));return e.vec2.set(a,Math.round(c[1]*d+c[0]*b),Math.round(c[1]*b+c[0]*d))}
function G(a){var b=a.scale;a=a.targetGeometry.spatialReference;a=n.isValid(a)?1/(39.37*h.getMetersPerUnitForSR(a)*96):1;return b*a}function H(a){return e.common.toRadian(a.rotation)||0}function I(a){return n.isValid(a)?39.37*h.getMetersPerUnitForSR(a)*96:1}function N(a){return a.isWrappable?(a=n.getInfo(a),a.valid[1]-a.valid[0]):0}Object.defineProperty(f,"__esModule",{value:!0});var S=b.wgs84Radius,M=180/Math.PI;f.extentToScale=x;f.create=w;f.copy=B;f.getAnchor=C;f.getExtent=function(){var a=e.vec2f64.create();
return function(b,c,d){var e=c.targetGeometry;y(a,e);c=.5*G(c);b.xmin=a[0]-c*d[0];b.ymin=a[1]-c*d[1];b.xmax=a[0]+c*d[0];b.ymax=a[1]+c*d[1];b.spatialReference=e.spatialReference;return b}}();f.setExtent=function(a,b,c,d,e){f.centerAt(a,b,c.center);a.scale=x(c,d);e&&e.constraints&&e.constraints.constrain(a);return a};f.getOuterExtent=function(){var a=e.vec2f64.create(),b=e.vec2f64.create();return function(c,d,e){y(a,d.targetGeometry);E(b,d,e);e=.5*G(d);c.set({xmin:a[0]-e*b[0],ymin:a[1]-e*b[1],xmax:a[0]+
e*b[0],ymax:a[1]+e*b[1],spatialReference:d.targetGeometry.spatialReference});return c}}();f.getOuterSize=E;f.getPaddingScreenTranslation=function(){var a=e.vec2f64.create();return function(b,c,d){return e.vec2.sub(b,e.vec2.scale(b,c,.5),C(a,c,d))}}();var P=function(){var a=e.mat2df64.create(),b=e.vec2f64.create();return function(c,d,g,h){var l=G(d);d=H(d);e.vec2.set(b,l,l);e.mat2d.fromScaling(a,b);e.mat2d.rotate(a,a,d);e.mat2d.translate(a,a,f.getPaddingScreenTranslation(b,g,h));e.mat2d.translate(a,
a,[0,h.top-h.bottom]);return e.vec2.set(c,a[4],a[5])}}();f.getResolution=G;f.getResolutionToScaleFactor=I;f.getMatrix=function(){var a=e.vec2f64.create(),b=e.vec2f64.create(),c=e.vec2f64.create();return function(d,g,h,f,l,k){e.vec2.negate(a,g);e.vec2.scale(b,h,.5*k);e.vec2.set(c,1/f*k,-1/f*k);e.mat2d.identity(d);e.mat2d.translate(d,d,b);l&&e.mat2d.rotate(d,d,l);e.mat2d.scale(d,d,c);e.mat2d.translate(d,d,a);return d}}();f.getTransform=function(){var a=e.vec2f64.create();return function(b,c,d,e){var g=
G(c),h=H(c);y(a,c.targetGeometry);return f.getMatrix(b,a,d,g,h,e)}}();f.getTransformNoRotation=function(){var a=e.vec2f64.create();return function(b,c,d,e){var g=G(c);y(a,c.targetGeometry);return f.getMatrix(b,a,d,g,0,e)}}();f.getWorldWidth=N;f.getWorldScreenWidth=function(a,b){return Math.round(N(a)/b)};f.createAsync=function(b,c){if(b=w(b,c))return g.resolve(b);b=new a("viewpointUtils-createAsync:different-spatialReference","Target spatialReference cannot be projected and is different from out spatialReference");
return g.reject(b)};f.angleBetween=function(){var a=e.vec2f64.create(),b=e.vec2f64.create(),c=[0,0,0];return function(d,g,h){e.vec2.subtract(a,d,g);e.vec2.normalize(a,a);e.vec2.subtract(b,d,h);e.vec2.normalize(b,b);e.vec2.cross(c,a,b);d=Math.acos(e.vec2.dot(a,b)/(e.vec2.length(a)*e.vec2.length(b)))*M;0>c[2]&&(d=-d);isNaN(d)&&(d=0);return d}}();f.addPadding=function(){var a=e.vec2f64.create();return function(b,c,d,e){var g=b.targetGeometry;B(b,c);P(a,c,d,e);g.x+=a[0];g.y+=a[1];return b}}();f.removePadding=
function(){var a=e.vec2f64.create();return function(b,c,d,e){var g=b.targetGeometry;B(b,c);P(a,c,d,e);g.x-=a[0];g.y-=a[1];return b}}();f.centerAt=function(){var a=e.vec2f64.create();return function(b,c,d){B(b,c);c=b.targetGeometry;var e=r(d),g=r(c);y(a,d);u(a,a,e,g);c.x=a[0];c.y=a[1];return b}}();f.pixelSizeAt=function(a,b,c){return G(b)};f.resize=function(){var a=e.vec2f64.create();return function(b,c,d,g,h){h||(h="center");e.vec2.sub(a,d,g);e.vec2.scale(a,a,.5);d=a[0];g=a[1];switch(h){case "center":e.vec2.set(a,
0,0);break;case "left":e.vec2.set(a,-d,0);break;case "top":e.vec2.set(a,0,g);break;case "right":e.vec2.set(a,d,0);break;case "bottom":e.vec2.set(a,0,-g);break;case "top-left":e.vec2.set(a,-d,g);break;case "bottom-left":e.vec2.set(a,-d,-g);break;case "top-right":e.vec2.set(a,d,g);break;case "bottom-right":e.vec2.set(a,d,-g)}f.translateBy(b,c,a);return b}}();f.rotateBy=function(a,b,c){B(a,b);a.rotation+=c;return a};f.rotateTo=function(a,b,c){B(a,b);a.rotation=c;return a};f.scaleBy=function(){var a=
e.vec2f64.create();return function(b,c,d,g,h){B(b,c);isNaN(d)||0===d||(f.toMap(a,g,c,h),b.scale=c.scale*d,f.toScreen(a,a,b,h),f.translateBy(b,b,e.vec2.set(a,a[0]-g[0],g[1]-a[1])));return b}}();f.scaleTo=function(a,b,c){B(a,b);a.scale=c;return a};f.scaleAndRotateBy=function(){var a=e.vec2f64.create();return function(b,c,d,g,h,l){B(b,c);isNaN(d)||0===d||(f.toMap(a,h,c,l),b.scale=c.scale*d,b.rotation+=g,f.toScreen(a,a,b,l),f.translateBy(b,b,e.vec2.set(a,a[0]-h[0],h[1]-a[1])));return b}}();f.padAndScaleAndRotateBy=
function(){var a=e.vec2f64.create(),b=e.vec2f64.create();return function(c,d,g,h,l,k,m){f.getPaddingScreenTranslation(b,k,m);e.vec2.add(a,l,b);return h?f.scaleAndRotateBy(c,d,g,h,a,k):f.scaleBy(c,d,g,a,k)}}();f.toMap=function(){var a=e.mat2df64.create();return function(b,c,d,g){return e.vec2.transformMat2d(b,c,D(a,d,g,1))}}();f.toScreen=function(){var a=e.mat2df64.create();return function(b,c,d,g){return e.vec2.transformMat2d(b,c,f.getTransform(a,d,g,1))}}();f.translateBy=function(){var a=e.vec2f64.create(),
b=e.mat2df64.create();return function(c,d,g){B(c,d);var h=G(d),f=c.targetGeometry;e.mat2d.fromRotation(b,H(d));e.mat2d.scale(b,b,e.vec2f64.fromValues(h,h));e.vec2.transformMat2d(a,g,b);f.x+=a[0];f.y+=a[1];return c}}()})},"esri/views/3d/webgl-engine/shaders/TerrainRendererPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});var b=function(a){return g.glslifyDefineMap({SPHERICAL:a.spherical,
OVERLAY:a.overlay,ATMOSPHERE:a.atmosphere,WIREFRAME_TEXTURE:a.wireframeTexture,TILE_BORDERS:a.tileBorders,RECEIVE_SHADOWS:a.receiveShadows,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,ALPHA_ZERO:a.alphaZero,BIAS_SHADOWMAP:a.shadowMap,SLICE:a.slice})};f.colorPass={name:"terrain-color",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("terrainRenderer/colorPass.vert"),fragmentShader:b(e)+a.resolveIncludes("terrainRenderer/colorPass.frag")}},attributes:k.Default3D};f.normalPass={name:"terrain-normal",
shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("terrainRenderer/normalPass.vert"),fragmentShader:b(e)+a.resolveIncludes("terrainRenderer/normalPass.frag")}},attributes:k.Default3D};f.depthPass={name:"terrain-depth",shaders:function(e){return{vertexShader:b(e)+a.resolveIncludes("terrainRenderer/depthPass.vert"),fragmentShader:b(e)+a.resolveIncludes("terrainRenderer/depthPass.frag")}},attributes:k.Default3D};f.highlightPass={name:"terrain-highlight",shaders:function(e){return{vertexShader:b(e)+
a.resolveIncludes("terrainRenderer/highlightPass.vert"),fragmentShader:b(e)+a.resolveIncludes("terrainRenderer/highlightPass.frag")}},attributes:k.Default3D}})},"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require","exports","./TerrainConst","./TilePerLayerInfo"],function(p,f,k,a){return function(){function g(a){this.parent=null;this.lij=a;this.layerInfo=Array(k.LayerClass.COUNT)}g.prototype.hasDataAvailable=function(a,e,c){return(e=this.layerInfo[c][e].tilemap)?"unavailable"!==e.getAvailability(a.lij[1],
a.lij[2]):!0};g.prototype.modifyLayers=function(b,e,c){b=this.layerInfo[c];for(var d=e.length,g=Array(d),f=0;f<d;f++){var h=e[f];g[f]=-1<h?b[h]:a.makeEmptyLayerInfo(c)}this.layerInfo[c]=g};return g}()})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/Error","../../core/has"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});var b={supportsMajorWebPerformanceCaveat:!1};f.check=function(e){e=k({},b,e);
return g("esri-webgl")?!e.supportsMajorWebPerformanceCaveat&&g("esri-webgl-major-performance-caveat")?new a("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is blacklisted."):g("esri-webgl-high-precision-fragment")?g("esri-webgl-vertex-shader-samplers")?g("esri-webgl-element-index-uint")?g("esri-webgl-standard-derivatives")?g("esri-webgl-instanced-arrays")?null:new a("webgl:instanced-arrays-required",
"WebGL support for instanced rendering is required but not supported."):new a("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new a("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new a("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new a("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):
new a("webgl:required","WebGL is required but not supported.")}})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),function(p,f,k,a,g,b){return function(b){function c(a){a=b.call(this)||this;a.components=["attribution","zoom","navigation-toggle","compass"];return a}k(c,b);a([g.property()],c.prototype,"components",void 0);return c=a([g.subclass("esri.views.ui.3d.DefaultUI3D")],
c)}(g.declared(b))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-geometry ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),function(p,f,k,a,g,b,e,c,d,m,l,h,n){return function(d){function f(a){a=d.call(this)||this;a._defaultPositionLookup=null;a.components=[];
return a}k(f,d);f.prototype.initialize=function(){this._handles.add([b.init(this,"components",this._componentsWatcher.bind(this)),b.init(this,"view",this._updateViewAwareWidgets.bind(this))])};f.prototype._findComponentPosition=function(a){if(!this._defaultPositionLookup){var b=g.isBodyLtr();this._defaultPositionLookup={attribution:"manual",compass:b?"top-left":"top-right","navigation-toggle":b?"top-left":"top-right",zoom:b?"top-left":"top-right"}}return this._defaultPositionLookup[a]};f.prototype._removeComponents=
function(a){var b=this;a.forEach(function(a){if(a=b.find(a))b.remove(a),a.destroy()})};f.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b.find(c))&&c.widget)&&void 0!==c.view&&c.set("view",a)})};f.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);this._adjustPadding(a)};f.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=this.padding.top)};f.prototype._addComponents=
function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),b._findComponentPosition(a))})};f.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new c({id:a,node:b})};f.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};f.prototype._createAttribution=
function(){return new m({view:this.view})};f.prototype._createCompass=function(){return new l({view:this.view})};f.prototype._createNavigationToggle=function(){return new h({view:this.view})};f.prototype._createZoom=function(){return new n({view:this.view})};a([e.property()],f.prototype,"components",void 0);return f=a([e.subclass("esri.views.ui.DefaultUI")],f)}(e.declared(d))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom dojo/dom-class ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(p,f,k,a,g,b,e,c){return function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;a.widget=null;return a}k(e,d);e.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(e.prototype,"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"node",{set:function(a){var c=this._get("node");a!==c&&(a&&b.add(a,"esri-component"),
c&&b.remove(c,"esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});e.prototype.castNode=function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in a)return this._set("widget",null),g.byId(a);a&&"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));this._set("widget",a);return a.domNode};a([c.property()],e.prototype,"id",null);a([c.property()],e.prototype,"node",null);a([c.cast("node")],e.prototype,"castNode",null);
a([c.property({readOnly:!0})],e.prototype,"widget",void 0);return e=a([c.subclass("esri.views.ui.Component")],e)}(c.declared(e))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-class dojo/dom-construct dojo/dom-style ../../core/Accessor ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t){function u(a){return"object"!==typeof a||a&&a.isInstanceOf&&a.isInstanceOf(t)||!("component"in a||"index"in a||"position"in a)?null:a}var r={left:0,top:0,bottom:0,right:0},y={bottom:30,top:15,right:15,left:15};return function(d){function f(){var a=d.call(this)||this;a._cornerNameToContainerLookup={};a._positionNameToContainerLookup={};a._components=[];a._handles=new h;a._componentToKey=new Map;a.view=null;a._initContainers();return a}a(f,d);f.prototype.initialize=
function(){this._handles.add([n.init(this,"view.padding, container",this._applyViewPadding.bind(this)),n.init(this,"padding",this._applyUIPadding.bind(this))])};f.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy();this._componentToKey.clear();this._componentToKey=null};Object.defineProperty(f.prototype,"container",{set:function(a){var b=this._get("container");a!==b&&(a&&(a.classList.add("esri-ui"),this._attachContainers(a)),
b&&(b.classList.remove("esri-ui"),c.set(b,{top:"",bottom:"",left:"",right:""}),m.orphan(b)),this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",a):this._clearOverride("padding")},
enumerable:!0,configurable:!0});f.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:k({},y,a)};Object.defineProperty(f.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});f.prototype.add=function(a,b){var c=this,d,e;if(Array.isArray(a))a.forEach(function(a){return c.add(a,b)});else{var g=u(a);g&&(d=g.index,b=g.position,a=g.component,
e=g.key);b&&"object"===typeof b&&(d=b.index,e=b.key,b=b.position);!a||b&&!this._isValidPosition(b)||(a&&a.isInstanceOf&&a.isInstanceOf(t)||(a=new t({node:a})),this._place({component:a,position:b,index:d}),this._components.push(a),e&&this._componentToKey.set(a,e))}};f.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,b)});var d=this.find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),d.node.parentNode&&
d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};f.prototype.empty=function(a){var c=this;if(Array.isArray(a))return a.map(function(a){return c.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";if("manual"===a)return Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!b.contains(a,"esri-ui-corner")}).map(function(a){return c.remove(a)});if(this._isValidPosition(a))return Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this)};f.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var d,e=u(a)||u(b);e&&(d=e.index,b=e.position,a=e.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}};f.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(t)?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};f.prototype._getViewPadding=function(){return this.get("view.padding")||
r};f.prototype._attachContainers=function(a){a.appendChild(this._manualContainer);a.appendChild(this._innerContainer)};f.prototype._initContainers=function(){var a=e.create("div",{className:"esri-ui-inner-container esri-ui-corner-container"}),b=e.create("div",{className:"esri-ui-inner-container esri-ui-manual-container"}),c=e.create("div",{className:"esri-ui-top-left esri-ui-corner"},a),d=e.create("div",{className:"esri-ui-top-right esri-ui-corner"},a),g=e.create("div",{className:"esri-ui-bottom-left esri-ui-corner"},
a),h=e.create("div",{className:"esri-ui-bottom-right esri-ui-corner"},a);this._innerContainer=a;this._manualContainer=b;this._cornerNameToContainerLookup={"top-left":c,"top-right":d,"bottom-left":g,"bottom-right":h};this._positionNameToContainerLookup=k({manual:b},this._cornerNameToContainerLookup)};f.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};f.prototype._place=function(a){var b=a.component,c=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];
var d;-1<c?(d=Array.prototype.slice.call(a.children),0===c?this._placeComponent(b,a,"first"):c>=d.length?this._placeComponent(b,a,"last"):this._placeComponent(b,d[c],"before")):this._placeComponent(b,a,"last")};f.prototype._placeComponent=function(a,b,c){var d=a.widget;d&&!d._started&&"function"===typeof d.postMixInProperties&&"function"===typeof d.buildRendering&&"function"===typeof d.postCreate&&"function"===typeof d.startup&&a.widget.startup();e.place(a.node,b,c)};f.prototype._applyViewPadding=
function(){var a=this.container;a&&c.set(a,this._toPxPosition(this._getViewPadding()))};f.prototype._applyUIPadding=function(){this._innerContainer&&c.set(this._innerContainer,this._toPxPosition(this.padding))};f.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};f.prototype._toPxUnit=function(a){return 0===a?0:a+"px"};f.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(d){(c=
d===a)&&(b=d);return c});return b};f.prototype._findById=function(a){var b=null,c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});return b};f.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};g([q.property()],f.prototype,"container",null);g([q.property({dependsOn:["view.height"]})],f.prototype,"height",null);g([q.property({value:y})],f.prototype,"padding",null);g([q.cast("padding")],f.prototype,"castPadding",
null);g([q.property()],f.prototype,"view",void 0);g([q.property({dependsOn:["view.width"]})],f.prototype,"width",null);return f=g([q.subclass("esri.views.ui.UI")],f)}(q.declared(d,l))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Attribution/nls/Attribution ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),function(p,f,
k,a,g,b,e,c,d,m){return function(c){function h(a){a=c.call(this)||this;a._isOpen=!1;a._attributionTextOverflowed=!1;a._prevSourceNodeHeight=0;a.iconClass="esri-icon-description";a.itemDelimiter=" | ";a.label=g.widgetLabel;a.view=null;a.viewModel=new d;return a}k(h,c);h.prototype.postInitialize=function(){var a=this;this.own(b.on(this,"viewModel.items","change",function(){return a.scheduleRender()}))};Object.defineProperty(h.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,
b){-1===a.indexOf(b.text)&&a.push(b.text);return a},[]).join(this.itemDelimiter)},enumerable:!0,configurable:!0});h.prototype.render=function(){var a,b=(a={},a["esri-attribution--open"]=this._isOpen,a);return m.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",b),onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),m.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",m.tsx("a",{target:"_blank",href:"http://www.esri.com/",class:this.classes("esri-attribution__link",
"esri-widget__anchor")},"Esri")))};h.prototype._renderSourcesNode=function(){var a,b=this._isOpen,c=this._isInteractive(),d=c?0:-1,e=this.attributionText,g=c?"button":void 0,b=(a={},a["esri-attribution__sources--open"]=b,a["esri-interactive"]=c,a);return m.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",b),innerHTML:e,role:g,tabIndex:d})};h.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=
a.clientWidth};h.prototype._afterSourcesNodeUpdate=function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};h.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};h.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};
a([e.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),m.renderable()],h.prototype,"attributionText",null);a([e.property()],h.prototype,"iconClass",void 0);a([e.property(),m.renderable()],h.prototype,"itemDelimiter",void 0);a([e.property()],h.prototype,"label",void 0);a([e.aliasOf("viewModel.view")],h.prototype,"view",void 0);a([e.property({type:d}),m.renderable(["state","view.size"])],h.prototype,"viewModel",void 0);a([m.accessibleHandler()],h.prototype,"_toggleState",
null);return h=a([e.subclass("esri.widgets.Attribution")],h)}(e.declared(c))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/Accessor ../../core/arrayUtils ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),function(p,f,k,a,g,
b,e,c,d,m,l,h,n){return function(b){function f(a){a=b.call(this,a)||this;a._handles=new d;a._pendingAttributionItemsByLayerId={};a._attributionDataByLayerId={};a.items=new c;a.view=null;a._updateAttributionItems=a._updateAttributionItems.bind(a);return a}k(f,b);f.prototype.initialize=function(){this._handles.add(m.init(this,"view",this._viewWatcher))};f.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(f.prototype,"state",{get:function(){return this.get("view.ready")?
"ready":"disabled"},enumerable:!0,configurable:!0});f.prototype._viewWatcher=function(a){var b=this,c=this._handles;c&&c.remove();a&&(c.add([a.allLayerViews.on("change",function(a){b._addLayerViews(a.added);0<a.removed.length&&(a.removed.forEach(function(a){c.remove(a.uid)}),b._updateAttributionItems())}),m.init(a,"stationary",this._updateAttributionItems)]),this._addLayerViews(a.allLayerViews))};f.prototype._addLayerViews=function(a){var b=this;a.forEach(function(a){b._handles.has(a.uid)||b._handles.add(m.init(a,
"suspended",b._updateAttributionItems),a.uid)})};f.prototype._updateAttributionItems=function(){var a=this,b=[];this._getActiveLayerViews().forEach(function(c){var d=c.layer;if(d&&"function"===typeof d.originOf&&"user"===d.originOf("copyright"))a._addIfUnique(b,{layer:d,text:d.copyright});else if(c=d.get("portalItem.accessInformation"))a._addIfUnique(b,{layer:d,text:c});else if(d.hasAttributionData){var e=a._attributionDataByLayerId;if(e[d.uid])a._addIfUnique(b,{layer:d,text:a._getDynamicAttribution(e[d.uid],
a.view,d)});else{var g=a._pendingAttributionItemsByLayerId;a._inProgress(g[d.uid])||(g[d.uid]=d.fetchAttributionData().then(function(b){b=a._createContributionIndex(b,a._isBingLayer(d));delete g[d.uid];e[d.uid]=b;a._updateAttributionItems()}))}}else a._addIfUnique(b,{layer:d,text:d.copyright})});this._itemsChanged(this.items,b)&&(this.items.removeAll(),this.items.addMany(b))};f.prototype._itemsChanged=function(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})};f.prototype._inProgress=
function(a){return a&&!a.isFulfilled()};f.prototype._getActiveLayerViews=function(){return this.get("view.allLayerViews").filter(function(a){return!a.suspended&&a.get("layer.attributionVisible")})};f.prototype._addIfUnique=function(a,b){var c=b.layer,d=b.text;d&&c&&(e.find(a,function(a){return a.layer===c&&a.text===d})||a.push({text:d,layer:c}))};f.prototype._isBingLayer=function(a){return"bing-maps"===a.type};f.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;
for(var d=0;d<a.length;d++){var e=a[d],h=e.coverageAreas;if(!h)return;for(var f=0;f<h.length;f++)for(var k=h[f],l=k.bbox,m=k.zoomMin-(b&&k.zoomMin?1:0),r=k.zoomMax-(b&&k.zoomMax?1:0),k={extent:n.geographicToWebMercator({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:g.SpatialReference.WGS84}),attribution:e.attribution||"",score:null!=k.score?k.score:100,id:d};m<=r;m++)c[m]=c[m]||[],c[m].push(k)}c.maxKey=Math.max.apply(null,Object.keys(c));return c};f.prototype._getDynamicAttribution=function(a,
b,c){var d=b.extent;c=c.tileInfo.scaleToZoom(b.scale);c=Math.min(a.maxKey,Math.round(c));if(!d||null==c||-1>=c)return"";a=a[c];var e=n.project(d.center.clone().normalize(),b.spatialReference),g={};return a.filter(function(a){var b=!g[a.id]&&e&&h.extentContainsPoint(a.extent,e);b&&(g[a.id]=!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-b.objectId}).map(function(a){return a.attribution}).join(", ")};a([l.property({readOnly:!0,type:c})],f.prototype,"items",void 0);a([l.property({dependsOn:["view.ready"],
readOnly:!0})],f.prototype,"state",null);a([l.property()],f.prototype,"view",void 0);return f=a([l.subclass("esri.widgets.Attribution.AttributionViewModel")],f)}(l.declared(b))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Compass/nls/Compass ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),function(p,f,k,a,g,b,e,c,d){return function(e){function f(a){a=
e.call(this)||this;a.goToOverride=null;a.iconClass="esri-icon-locate-circled";a.label=g.widgetLabel;a.view=null;a.viewModel=new c;return a}k(f,e);f.prototype.reset=function(){};f.prototype.render=function(){var a,b,c=this.viewModel,e=c.orientation,c=c.state,f="disabled"===c,k="compass"===("rotation"===c?"rotation":"compass"),c=f?-1:0,f=(a={},a["esri-disabled"]=f,a["esri-interactive"]=!f,a);a=(b={},b["esri-icon-compass"]=k,b["esri-icon-dial"]=!k,b);return d.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",
f),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:c,"aria-label":g.reset,title:g.reset},d.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",a),styles:this._toRotationTransform(e)}),d.tsx("span",{class:"esri-icon-font-fallback-text"},g.reset))};f.prototype._reset=function(){this.viewModel.reset()};f.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+a.z+"deg)"}};a([b.aliasOf("viewModel.goToOverride")],f.prototype,"goToOverride",void 0);a([b.property()],
f.prototype,"iconClass",void 0);a([b.property()],f.prototype,"label",void 0);a([b.aliasOf("viewModel.view")],f.prototype,"view",void 0);a([b.property({type:c}),d.renderable(["viewModel.orientation","viewModel.state"])],f.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.reset")],f.prototype,"reset",null);a([d.accessibleHandler()],f.prototype,"_reset",null);return f=a([b.subclass("esri.widgets.Compass")],f)}(b.declared(e))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),
function(p,f,k,a,g,b,e,c,d){return function(d){function g(a){a=d.call(this,a)||this;a._handles=new b;a.orientation={x:0,y:0,z:0};a.view=null;a._updateForCamera=a._updateForCamera.bind(a);a._updateForRotation=a._updateForRotation.bind(a);a._updateRotationWatcher=a._updateRotationWatcher.bind(a);return a}k(g,d);g.prototype.initialize=function(){this._handles.add(e.init(this,"view",this._updateRotationWatcher))};g.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(g.prototype,
"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return a&&(a.isWebMercator||a.isWGS84)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});g.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};g.prototype._updateForRotation=function(a){void 0!==
a&&null!==a&&(this.orientation={z:a})};g.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};g.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(e.init(this,"view.rotation",this._updateForRotation)):this._handles.add(e.init(this,"view.camera",this._updateForCamera)))};a([c.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],g.prototype,"canShowNorth",null);
a([c.property()],g.prototype,"orientation",void 0);a([c.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],g.prototype,"state",null);a([c.property()],g.prototype,"view",void 0);a([c.property()],g.prototype,"reset",null);return g=a([c.subclass("esri.widgets.CompassViewModel")],g)}(c.declared(g,d))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./NavigationToggle/nls/NavigationToggle ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),
function(p,f,k,a,g,b,e,c,d){return function(e){function f(a){a=e.call(this)||this;a.iconClass="esri-icon-pan2";a.label=g.widgetLabel;a.view=null;a.viewModel=new c;return a}k(f,e);Object.defineProperty(f.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});f.prototype.toggle=function(){};f.prototype.render=function(){var a,b,c,e="disabled"===this.get("viewModel.state"),f="pan"===this.get("viewModel.navigationMode"),k=(a={},a["esri-disabled"]=
e,a["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,a);a=(b={},b["esri-navigation-toggle__button--active"]=f,b);b=(c={},c["esri-navigation-toggle__button--active"]=!f,c);c=e?-1:0;return d.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",k),onclick:this._toggle,onkeydown:this._toggle,tabIndex:c,"aria-label":g.toggle,title:g.toggle},d.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",
a)},d.tsx("span",{class:"esri-icon-pan"})),d.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--rotate",b)},d.tsx("span",{class:"esri-icon-rotate"})))};f.prototype._toggle=function(){this.toggle()};a([b.property()],f.prototype,"iconClass",void 0);a([b.property()],f.prototype,"label",void 0);a([b.property({value:"vertical"}),d.renderable()],f.prototype,"layout",null);a([b.aliasOf("viewModel.view"),d.renderable()],f.prototype,"view",void 0);
a([b.property({type:c}),d.renderable(["viewModel.state","viewModel.navigationMode"])],f.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.toggle")],f.prototype,"toggle",null);a([d.accessibleHandler()],f.prototype,"_toggle",null);return f=a([b.subclass("esri.widgets.NavigationToggle")],f)}(b.declared(e))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),
function(p,f,k,a,g,b,e,c){return function(d){function g(a){a=d.call(this,a)||this;a._handles=new b;a.navigationMode="pan";a.view=null;a.toggle=a.toggle.bind(a);return a}k(g,d);g.prototype.initialize=function(){this._handles.add(e.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};g.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":
"disabled"},enumerable:!0,configurable:!0});g.prototype.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};g.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a([c.property({dependsOn:["view.ready"],readOnly:!0})],g.prototype,"state",null);a([c.property()],g.prototype,"navigationMode",void 0);a([c.property()],g.prototype,"view",void 0);
a([c.property()],g.prototype,"toggle",null);return g=a([c.subclass("esri.widgets.NavigationToggleViewModel")],g)}(c.declared(g))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Zoom/nls/Zoom ../core/accessorSupport/decorators ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel ./support/widget".split(" "),function(p,f,k,a,g,b,e,c,d,m){return function(e){function h(a){a=e.call(this)||this;a.iconClass="esri-icon-zoom-in-magnifying-glass";
a.label=g.widgetLabel;a.view=null;a.viewModel=new d;return a}k(h,e);h.prototype.postInitialize=function(){this._zoomInButton=new c({action:this.zoomIn,iconClass:"esri-icon-plus",title:g.zoomIn});this._zoomOutButton=new c({action:this.zoomOut,iconClass:"esri-icon-minus",title:g.zoomOut})};Object.defineProperty(h.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});h.prototype.render=function(){var a,b=this.viewModel,c=(a={},a["esri-zoom--horizontal"]=
"horizontal"===this.layout,a);this._zoomInButton.enabled="ready"===b.state&&b.canZoomIn;this._zoomOutButton.enabled="ready"===b.state&&b.canZoomOut;return m.tsx("div",{class:this.classes("esri-zoom esri-widget",c)},this._zoomInButton.render(),this._zoomOutButton.render())};h.prototype.zoomIn=function(){};h.prototype.zoomOut=function(){};a([b.property()],h.prototype,"iconClass",void 0);a([b.property()],h.prototype,"label",void 0);a([b.property({value:"vertical"}),m.renderable()],h.prototype,"layout",
null);a([b.aliasOf("viewModel.view"),m.renderable()],h.prototype,"view",void 0);a([b.property({type:d}),m.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],h.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.zoomIn")],h.prototype,"zoomIn",null);a([b.aliasOf("viewModel.zoomOut")],h.prototype,"zoomOut",null);return h=a([b.subclass("esri.widgets.Zoom")],h)}(b.declared(e))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(p,f,k,a,g,b,e){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.enabled=!0;a.iconClass="";a.title="";return a}k(c,b);c.prototype.render=function(){var a,b,c=this.enabled?0:-1,d=(a={},a["esri-disabled"]=!this.enabled,a["esri-interactive"]=this.enabled,a);a=(b={},b[this.iconClass]=!!this.iconClass,b);return e.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",d),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:c,
title:this.title},e.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",a)}),e.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};c.prototype._triggerAction=function(){this.action.call(this)};a([g.property()],c.prototype,"action",void 0);a([g.property(),e.renderable()],c.prototype,"enabled",void 0);a([g.property({readOnly:!1}),e.renderable()],c.prototype,"iconClass",void 0);a([g.property(),e.renderable()],c.prototype,"title",void 0);a([e.accessibleHandler()],
c.prototype,"_triggerAction",null);return c=a([g.subclass("esri.widgets.IconButton")],c)}(g.declared(b))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(p,f,k,a,g,b,e,c){return function(d){function g(a){a=d.call(this,a)||this;a.canZoomIn=null;a.canZoomOut=null;a.zoomIn=a.zoomIn.bind(a);
a.zoomOut=a.zoomOut.bind(a);return a}k(g,d);g.prototype.destroy=function(){this.view=null};Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new e({view:a}):"3d"===a.type&&(this._zoomConditions=new c):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});g.prototype.zoomIn=function(){this.canZoomIn&&
this._zoomToFactor(.5)};g.prototype.zoomOut=function(){this.canZoomOut&&this._zoomToFactor(2)};g.prototype._zoomToFactor=function(a){if("ready"===this.state){var b=this.view;"3d"===this.view.type?b.goTo({zoomFactor:1/a}):b.goTo({scale:this.get("view.scale")*a})}};a([b.property()],g.prototype,"_zoomConditions",void 0);a([b.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],g.prototype,"canZoomIn",void 0);a([b.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],g.prototype,"canZoomOut",
void 0);a([b.property({dependsOn:["view.ready"],readOnly:!0})],g.prototype,"state",null);a([b.property()],g.prototype,"view",null);a([b.property()],g.prototype,"zoomIn",null);a([b.property()],g.prototype,"zoomOut",null);return g=a([b.subclass("esri.widgets.Zoom.ZoomViewModel")],g)}(b.declared(g))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(p,f,k,a,g,b){return function(e){function c(){return null!==e&&e.apply(this,arguments)||this}k(c,e);Object.defineProperty(c.prototype,"canZoomIn",{get:function(){var a=this.get("view.animation.target.scale")||this.get("view.scale"),b=this.get("view.constraints.effectiveMaxScale");return 0===b||a>b},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"canZoomOut",{get:function(){var a=this.get("view.animation.target.scale")||this.get("view.scale"),b=this.get("view.constraints.effectiveMinScale");
return 0===b||a<b},enumerable:!0,configurable:!0});a([b.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],c.prototype,"canZoomIn",null);a([b.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],c.prototype,"canZoomOut",null);a([b.property()],c.prototype,"view",void 0);return c=a([b.subclass("esri.widgets.Zoom.ZoomConditions2D")],c)}(b.declared(g))})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(p,f,k,a,g,b){return function(e){function c(){var a=null!==e&&e.apply(this,arguments)||this;a.canZoomIn=!0;a.canZoomOut=!0;return a}k(c,e);a([b.property({readOnly:!0})],c.prototype,"canZoomIn",void 0);a([b.property({readOnly:!0})],c.prototype,"canZoomOut",void 0);return c=a([b.subclass("esri.widgets.Zoom.ZoomConditions3D")],c)}(b.declared(g))})},"esri/layers/graphics/controllers/SnapshotController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Accessor ../../../core/Error ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/Promise ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../geometry/support/scaleUtils ../../support/GraphicsManager ../../../views/3d/layers/graphics/Graphics3DVerticalScale".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u){var r=m.getLogger("esri.layers.graphics.controllers.SnapshotController");return function(b){function c(a){a=b.call(this)||this;a.type="snapshot";a._gManager=null;a._verticalScale=null;a._handles=new d;a._source=null;a._started=!1;a._pendingQueries=new Map;a.extent=null;a.hasAllFeatures=!1;a.hasFeatures=!1;a.layer=null;a.layerView=null;a.maxPageSize=null;a.defaultReturnZ=void 0;a.defaultReturnM=void 0;a.pageSize=null;a.paginationEnabled=!1;return a}k(c,b);
c.prototype.initialize=function(){var a=this,b=this.layer.when(function(){return a._verifyCapabilities()}).then(function(){return a._init()});this.addResolvingPromise(b)};c.prototype.destroy=function(){this.cancelQuery();this._gManager&&(this._gManager.destroy(),this._gManager=null);this._handles.destroy();this._pendingQueries=this._handles=null};Object.defineProperty(c.prototype,"updating",{get:function(){return!!(this._pendingQueries&&0<this._pendingQueries.size)},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"graphics",{set:function(a){var b=this._get("graphics");b!==a&&(this._handles.remove("graphics"),a&&(this._collectionChanged({added:a.toArray(),removed:b&&b.toArray()}),this._handles.add(a.on("change",this._collectionChanged.bind(this)),"graphics")),this._set("graphics",a))},enumerable:!0,configurable:!0});c.prototype.cancelQuery=function(){var a=this;this._pendingQueries&&(this._pendingQueries.forEach(function(b,c){b.isFulfilled()||b.cancel(Error(a._cancelErrorMsg))}),
this._pendingQueries.clear(),this.notifyChange("updating"))};c.prototype.refresh=function(){this.isResolved()&&this._started&&this._queryFeatures()};c.prototype.startup=function(){this._started||(this._started=!0,this._resolutionParams=this._getResolutionParams(),this._queryFeatures())};c.prototype.update=function(){this.startup()};c.prototype._init=function(){var a=this.layer;this.paginationEnabled=!!a.get("capabilities.query.supportsPagination");this._source=a.source;var b=a.maxRecordCount||4E3;
this.pageSize=null==this.maxPageSize?b:Math.min(b,this.maxPageSize);this._gManager=new t({graphics:this.graphics,objectIdField:a.objectIdField});this._verticalScale=new u({sourceSpatialReference:a.spatialReference,destSpatialReference:this.layerView.view.spatialReference});this._setupStateWatchers()};c.prototype._getResolutionParams=function(){var a=this.layer,b=a.get("capabilities.query.supportsQuantization"),c;if("polyline"===a.geometryType||"polygon"===a.geometryType){var d=q.getMetersPerUnit(this.layerView.view.spatialReference);
null!=d&&(c=this._featureResolution.scale,d=this._featureResolution.value/d,c=a.maxScale?a.maxScale:a.minScale?Math.min(c,a.minScale):Math.min(c,q.getScale(this.layerView.view,a.fullExtent)),c*=d/this._featureResolution.scale)}return c?{maxAllowableOffset:b?null:c,quantizationParameters:b?{mode:"view",originPosition:"upperLeft",tolerance:c,extent:a.fullExtent}:null}:null};c.prototype._setupStateWatchers=function(){var a=this;this._handles.add([this.watch("extent",this.refresh.bind(this)),this.layer.watch("outFields",
function(b,c){b&&c?-1===c.indexOf("*")&&(b.sort(),c.sort(),JSON.stringify(b)!==JSON.stringify(c)&&a.refresh()):a.refresh()}),this.layer.watch("definitionExpression, historicMoment",this.refresh.bind(this)),this.layer.on("edits",this._editsHandler.bind(this))])};c.prototype._createQueryParams=function(){var a=this.layer,b=this.layerView,c=a.createQuery();c.outSpatialReference=b.view.spatialReference;c.geometry=this.extent;(a=a.capabilities&&a.capabilities.data)&&a.supportsZ&&null==c.returnZ&&null!=
this.defaultReturnZ&&(c.returnZ=this.defaultReturnZ);a&&a.supportsM&&null==c.returnM&&null!=this.defaultReturnM&&(c.returnM=this.defaultReturnM);c.set(this._resolutionParams);this.paginationEnabled&&(c.start=0,c.num=this.pageSize);return c};c.prototype._queryFeatures=function(){this.cancelQuery();this.hasAllFeatures=this.hasFeatures=!1;this._gManager.beginPagedUpdate();this.emit("query-start");this._executeQuery(this._createQueryParams())};c.prototype._executeQuery=function(a){var b=this,c=this._source.queryFeatures(a),
d=this._gManager.createIntentToAdd();this._querySetup(d,c);c.then(this._processFeatureSet.bind(this,a,d)).catch(function(a){return b._queryError(d,a)}).then(function(){return b._queryTeardown(d)},function(){return b._queryTeardown(d)})};c.prototype._processFeatureSet=function(a,b,c){var d=c.exceededTransferLimit,e=c.features,g=this._maxFeatures[this.layer.geometryType]||0,h=e?e.length:0,f=this._gManager.numGraphics+h,k=f>=g;k&&(r.warn('Feature limit exceeded on layer "',this.layer.title,'". Not all features are shown.'),
(g=f-g)&&e.splice(h-g,g));a=d&&this.paginationEnabled&&!k?this._queryNextPage(a):!1;this._verticalScale.adjust(e);e&&this._gManager.addPage(e,b);this.hasFeatures=!0;a||(this._gManager.endPagedUpdate(),this.hasAllFeatures=!d,this.emit("query-end",{success:!0}));return c};c.prototype._queryNextPage=function(a){a.start+=this.pageSize;this._executeQuery(a);return!0};c.prototype._queryError=function(a,b){b&&"cancel"===b.dojoType&&!this.hasFeatures?this._gManager.revertPagedUpdate():this._gManager.endPagedUpdate();
this.emit("query-end",{success:!1});if(b&&"cancel"===b.dojoType)return h.reject(b);a=new e("snapshotcontroller:tile-request-failed","Failed to query for features",{error:b});r.error(a);return h.reject(a)};c.prototype._querySetup=function(a,b){this._pendingQueries.set(a,b);this.notifyChange("updating")};c.prototype._queryTeardown=function(a){this._gManager.removeIntent(a);this._pendingQueries.delete(a);this.notifyChange("updating")};c.prototype._processRefetch=function(a,b){(b=b.features)&&this._gManager.add(b,
a)};c.prototype._refetchError=function(a,b){};c.prototype._verifyCapabilities=function(){if(!this.layer.get("capabilities.operations.supportsQuery"))throw new e("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:this.layer});};c.prototype._collectionChanged=function(a){var b=a.added;if(b)for(var c=0;c<b.length;c++)b[c].layer=this.layer,b[c].sourceLayer=this.layer;if(b=a.removed)for(c=0;c<b.length;c++)b[c].layer=null,b[c].sourceLayer=
null};c.prototype._editsHandler=function(a){var b=this,c=function(a){return a.objectId},d=a.deletedFeatures.map(c);this._gManager.delete(d);a=a.addedFeatures.concat(a.updatedFeatures).map(c);if(a.length){c=this._createQueryParams();c.objectIds=a;var c=this._source.queryFeatures(c),e=this._gManager.createIntentToAdd(a);this._querySetup(e,c);c.then(this._processRefetch.bind(this,e)).catch(this._refetchError.bind(this,e)).then(function(){return b._queryTeardown(e)},function(){return b._queryTeardown(e)})}};
a([n.shared("SnapshotController: query cancelled")],c.prototype,"_cancelErrorMsg",void 0);a([n.property({readOnly:!0})],c.prototype,"type",void 0);a([n.shared({value:.25,scale:945})],c.prototype,"_featureResolution",void 0);a([n.shared({point:16E3,multipoint:8E3,polyline:4E3,polygon:4E3,multipatch:4E3})],c.prototype,"_maxFeatures",void 0);a([n.property()],c.prototype,"_pendingQueries",void 0);a([n.property({dependsOn:["_pendingQueries"]})],c.prototype,"updating",null);a([n.property()],c.prototype,
"graphics",null);a([n.property()],c.prototype,"extent",void 0);a([n.property()],c.prototype,"hasAllFeatures",void 0);a([n.property()],c.prototype,"hasFeatures",void 0);a([n.property()],c.prototype,"layer",void 0);a([n.property()],c.prototype,"layerView",void 0);a([n.property()],c.prototype,"maxPageSize",void 0);a([n.property()],c.prototype,"defaultReturnZ",void 0);a([n.property()],c.prototype,"defaultReturnM",void 0);a([n.property()],c.prototype,"pageSize",void 0);a([n.property()],c.prototype,"paginationEnabled",
void 0);return c=a([n.subclass("esri.layers.graphics.controllers.SnapshotController")],c)}(n.declared(b,l,c))})},"esri/layers/support/GraphicsManager":function(){define(["../../core/Accessor"],function(p){var f=0;return p.createSubclass({constructor:function(){this._deletedGraphicsIndex=new Set;this._intentsIndex=new Map},destroy:function(){this.removeAll();this._intentsIndex=this._deletedGraphicsIndex=null},properties:{graphics:null,indexById:{value:null,dependsOn:["graphics","objectIdField"],get:function(){return this._createIndexById(this.graphics&&
this.graphics.toArray(),this.objectIdField)}},numGraphics:{value:0,dependsOn:["indexById"],get:function(){return this.indexById?this.indexById.size:0}},objectIdField:null,updating:{value:!1,dependsOn:["_intentsIndex"],get:function(){return!!(this._intentsIndex&&0<this._intentsIndex.size)}},_intentsIndex:{value:null}},_oldIndex:null,_deletedGraphicsIndex:null,beginPagedUpdate:function(){this._oldIndex=this.indexById;this.indexById=null;this.notifyChange("numGraphics")},addPage:function(f,a){this.add(f,
a)},revertPagedUpdate:function(){var f=this._removeLeftOnly(this.indexById,this._oldIndex);this.indexById=this._oldIndex;this._oldIndex=null;this.graphics.removeMany(f);this.notifyChange("numGraphics")},endPagedUpdate:function(){var f=this._removeLeftOnly(this._oldIndex,this.indexById);this._oldIndex=null;this.graphics.removeMany(f);this.notifyChange("numGraphics")},findGraphic:function(f){return(f=this.indexById&&this.indexById.get(f))&&f.graphic},removeAll:function(){this.indexById=this._oldIndex=
null;this.graphics.removeAll();this.notifyChange("numGraphics")},add:function(f,a){if(f&&f.length){for(var g=this.objectIdField,b=this.indexById=this.indexById||new Map,e=this._oldIndex,c=this._createIndexById(f,g),c=this._extractObjectIds(c),b=this._extractObjectIds(b),e=this._extractObjectIds(e),b=b.concat(e),d=[],k=b.length,e=0;e<k;e++){var l=b[e];-1<c.indexOf(l)&&d.push(l)}d.length&&this._remove(d,!1);a=this.findIntent(a);c=new Map;b=f.length;for(e=0;e<b;e++)(d=f[e])&&d.attributes&&c.set(d.attributes[g],
a);f.length&&this._add(f,c)}},remove:function(f){this._remove(f,!1)},delete:function(f){this._remove(f,!0)},isDeleted:function(f){return this._deletedGraphicsIndex.has(f)},createIntentToAdd:function(k){k&&this._intentsIndex.forEach(function(a,b){k.forEach(function(b){a.ignoredIds.add(b)})},this);var a=f++;this._intentsIndex.set(a,{ignoredIds:new Set});this.notifyChange("updating");return a},findIntent:function(f){return this._intentsIndex.get(f)},removeIntent:function(f){this._intentsIndex.delete(f);
this.notifyChange("updating")},update:function(f,a){if(f&&f.length){var g=this.objectIdField,b=this.indexById=this.indexById||new Map,e=this._oldIndex;f=this._createIndexById(f,g);for(var g=this._extractObjectIds(f),c=this._extractObjectIds(b),d=this._extractObjectIds(e),c=c.concat(d),d=[],k=c.length,l=0;l<k;l++){var h=c[l];if(-1===g.indexOf(h))d.push(h);else{var n=b.get(h)||e.get(h),n=n&&n.graphic&&n.graphic._ts,q=f.get(h);(q&&q.graphic&&q.graphic._ts)>n&&d.push(h)}}b=[];e=g.length;for(l=0;l<e;l++)h=
g[l],(-1===c.indexOf(h)||-1<d.indexOf(h))&&b.push(h);d.length&&this._remove(d,!1);b.length&&this._add(this._extractGraphics(b,f),a)}},_createIndexById:function(f,a){var g;if(f&&f.length&&a){var b,e,c;g=new Map;for(b=0;e=f[b];b++)c=e.attributes&&e.attributes[a],null!=c&&g.set(c,{graphic:e,refCount:1})}return g},_add:function(f,a){var g=this.objectIdField;f.forEach(function(b){var e=a.get(b.attributes&&b.attributes[g]);this._addToIndex(b,this.indexById,e)},this);this.graphics.addMany(f);this.notifyChange("numGraphics")},
_addToIndex:function(f,a,g){var b=f.attributes&&f.attributes[this.objectIdField];a&&null!=b&&(a.has(b)?g&&g.ignoredIds.has(b)||(g=a.get(b),a.set(b,{graphic:f,refCount:g.refCount+1})):this.isDeleted(b)||a.set(b,{graphic:f,refCount:1}))},_remove:function(f,a){f=f||[];f="object"===typeof f[0]?f.map(function(a){return a.attributes&&a.attributes[this.objectIdField]}.bind(this)):f;var g=this._extractGraphics(f,this._oldIndex),b=this._extractGraphics(f,this.indexById);f.forEach(function(b){a&&this._deletedGraphicsIndex.add(b);
this._removeFromIndex(b,this._oldIndex,a);this._removeFromIndex(b,this.indexById,a)}.bind(this));this.graphics.removeMany(g.concat(b));this.notifyChange("numGraphics")},_removeFromIndex:function(f,a,g){if(a&&a.has(f))if(g)a.delete(f);else{g=a.get(f);var b=g.refCount-1;0===b?a.delete(f):g.refCount=b}},_removeLeftOnly:function(f,a){var g=[];f&&f.forEach(function(b,e){var c=b.graphic;!c||a&&a.has(e)||(--b.refCount,0===b.refCount&&f.delete(e),g.push(c))});return g},_extractGraphics:function(f,a){return f&&
a?f.map(function(g){return(g=a.get(g))&&g.graphic}):[]},_extractObjectIds:function(f){var a=[];f&&f.forEach(function(g,b){a.push(b)});return a}})})},"esri/views/3d/layers/graphics/Graphics3DVerticalScale":function(){define(["require","exports","../../../../geometry/support/scaleUtils"],function(p,f,k){return function(){function a(a){this.sourceSpatialReference=a.sourceSpatialReference;this.destSpatialReference=a.destSpatialReference}a.prototype.adjust=function(a){var b=this._getVerticalUnitScale();
1!==b&&this._scaleVerticalUnits(a,b)};a.prototype._getVerticalUnitScale=function(){if(this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)){var a=k.getMetersPerVerticalUnitForSR(this.sourceSpatialReference),b=k.getMetersPerVerticalUnitForSR(this.destSpatialReference);return a/b}return 1};a.prototype._vertexListsScaleZ=function(a,b){for(var e=0;e<a.length;++e)for(var c=a[e],d=0;d<c.length;++d)c[d][2]*=b};a.prototype._scaleVerticalUnits=function(a,b){for(var e=
0;e<a.length;++e){var c=a[e].geometry;c&&c.hasZ&&(this._geometryIsPoint(c)?null!==c.z&&(c.z*=b):this._geometryIsPolyline(c)?this._vertexListsScaleZ(c.paths,b):this._geometryIsPolygon(c)&&this._vertexListsScaleZ(c.rings,b))}};a.prototype._geometryIsPoint=function(a){return"point"===a.type};a.prototype._geometryIsPolygon=function(a){return"polygon"===a.type};a.prototype._geometryIsPolyline=function(a){return"polyline"===a.type};return a}()})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../PopupTemplate ../request ../core/Error ../core/Logger ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ./FeatureLayer ./Layer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/Field ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../portal/PortalItem ../renderers/support/jsonUtils ../renderers/support/styleUtils ../renderers/support/typeUtils ../tasks/support/Query".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H,I,N,S,M){function P(a,b,c){a&&((a=I.read(a,b,c)||void 0)||W.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var O=["3DObject","Point"],W=d.getLogger("esri.layers.SceneLayer"),Q={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
J={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(d){function f(a,b){a=d.call(this)||this;a.featureReduction=null;a.rangeInfos=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=[];a.definitionExpression=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=
!0;return a}a(f,d);f.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?k({url:a},b):a};f.prototype.getField=function(a){return C.getField(a,this.fields)};Object.defineProperty(f.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this.loaded&&this._validateElevationInfo()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"geometryType",{get:function(){return J[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"renderer",{set:function(a){C.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});f.prototype.readCachedDrawingInfo=function(a,b){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};f.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a||void 0};f.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&Q[a])return Q[a];W.error("Unknown or missing profile",
{profile:a,layer:this});return"mesh-pyramids"};f.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).then(function(){return a._fetchService()},function(){return a._fetchService()}).then(function(){return m.all([a._verifyRootNodeAndUpdateExtent(),a._setCompanionFeatureLayer()])}).then(function(){return a._validateElevationInfo()}).then(function(){return a._applyCompanionOverrides()}).then(function(){return a._populateFieldUsageInfo()}).then(function(){return N.loadStyleRenderer(a,
{origin:"service"})}).then(function(){return C.fixRendererFields(a.renderer,a.fields)});this.addResolvingPromise(b);return this.when()};f.prototype.createLayerView=function(a){var b=this;return(null==this.profile||"mesh-pyramids"===this.profile?m.create(function(a){return p(["../views/3d/layers/SceneLayerView3D"],a)}):m.create(function(a){return p(["../views/3d/layers/SceneLayerGraphicsView3D"],a)})).then(function(c){return new c({view:a,layer:b})})};f.prototype.createQuery=function(){var a=new M;
"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};f.prototype.queryExtent=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryExtent(a||b.createQuery())})};f.prototype.queryFeatureCount=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatureCount(a||b.createQuery())})};f.prototype.queryFeatures=function(a){var b=this;
return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatures(a||b.createQuery())}).then(function(a){if(a&&a.features)for(var c=0,d=a.features;c<d.length;c++){var e=d[c];e.layer=b;e.sourceLayer=b}return a})};f.prototype.queryObjectIds=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryObjectIds(a||b.createQuery())})};f.prototype.getFieldUsageInfo=function(a){var b={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,
supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[a]||b:(W.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),b)};f.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});var b=this.associatedLayer;return null!=b?m.resolve(b):m.reject(new c("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))};f.prototype.hasCachedStatistics=
function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})};f.prototype.queryCachedStatistics=function(a){if(!this.hasCachedStatistics(a))return m.reject(new c("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var b=0,d=this.statisticsInfo;b<d.length;b++){var g=d[b];if(g.name===a)return a=l.join(this.parsedUrl.path,g.href),e(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}};f.prototype.graphicChanged=
function(a){this.emit("graphic-update",a)};f.prototype._validateLayer=function(a){if(a.layerType&&-1===O.indexOf(a.layerType))throw new c("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new c("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new c("layer:service-version-too-new",
"Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,d=!1,e=!1;if(null==a)e=d=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":d=!0;e=b;break;case "vertex-reference-frame":d=!0;e=!b;break;default:d=!1}if(!d)throw new c("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!e)throw new c("scenelayer:incompatible-normal-reference-frame",
"Normal reference frame is incompatible with layer spatial reference.");};f.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),d=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||d,supportsLayerQuery:d}},
b=this,c=0,d=this.fields;c<d.length;c++)a(d[c])};f.prototype._applyCompanionOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var a=0,b=this.associatedLayer.fields;a<b.length;a++){var c=b[a];this.getField(c.name)||this.fields.push(c.clone())}a=["popupTemplate","popupEnabled"];b=q.getProperties(this);for(c=0;c<a.length;c++){var d=a[c];this._buddyIsMoreImportant(d)&&(b.setDefaultOrigin(this.associatedLayer.originOf(d)),b.set(d,this.associatedLayer[d]),b.setDefaultOrigin("user"))}}};
f.prototype._setCompanionFeatureLayer=function(){var a=this;return this._fetchCompanionFeatureLayer().then(function(b){a.associatedLayer=b})};f.prototype._fetchCompanionFeatureLayer=function(){var a=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?m.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchCompanionFeatureLayerFromRelatedItems(this.portalItem):this._fetchCompanionFeatureLayerFromUrl()).then(function(a){return a.load()}).catch(function(b){null==a.attributeStorageInfo?
W.warn("Companion FeatureLayer could not be loaded and no binary attributes found. Popups will not work for this SceneLayer: "+a.title):W.info("Companion FeatureLayer could not be loaded. Falling back to binary attributes for Popups on this SceneLayer: "+a.title);return null})};f.prototype._fetchCompanionFeatureLayerFromRelatedItems=function(a){var b=this;return a.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"}).then(function(a){return(a=a.filter(function(a){return"Feature Service"===
a.type})[0])?b._fetchCompanionFeatureLayerFromPortalItem(new H({id:a.id,portal:a.portal})):m.reject()}).catch(function(){return b._fetchCompanionFeatureLayerFromUrl()})};f.prototype._fetchCompanionFeatureLayerFromPortalItem=function(a){var b=this;return a.load().then(function(a){return b._findMatchingCompanionSublayerUrl(a.url)}).then(function(b){return m.resolve(new t({url:b,portalItem:a}))})};f.prototype._fetchCompanionFeatureLayerFromUrl=function(){return this._findMatchingCompanionSublayerUrl().then(function(a){return m.resolve(new t({url:a}))})};
f.prototype._findMatchingCompanionSublayerUrl=function(a){var b=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!b)return m.reject();null==a&&(a=b[1]+"/FeatureServer");var c=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");a={query:{f:"json"},responseType:"json"};var d=b[1]+"/SceneServer",g=parseInt(b[2],10),b=e(d,a).catch(function(a){return{data:{layers:null}}});a=e(c,a);return m.all([a,b]).then(function(a){var b=a[0];a=a[1];a=a.data&&a.data.layers;b=b.data&&b.data.layers;
if(!Array.isArray(b))throw Error("expected layers array");if(Array.isArray(a))for(var d=0;d<Math.min(a.length,b.length);d++){if(a[d].id===g)return c+"/"+b[d].id}else if(g<b.length)return c+"/"+b[g].id;throw Error("could not find matching associated sublayer");})};f.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var b=n.nameToId(this.originOf(a));a=n.nameToId(this.associatedLayer.originOf(a));return null!=a&&a<=n.OriginId.SERVICE?null==b||b<n.OriginId.SERVICE:null!=a&&
a<=n.OriginId.PORTAL_ITEM?null==b||b<n.OriginId.PORTAL_ITEM:!1};f.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("mesh-pyramids"===this.profile&&"absolute-height"!==a.mode&&W.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&W.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};g([h.shared("esri.layers.SceneLayer")],f.prototype,"declaredClass",
void 0);g([h.property({types:{key:"type",base:z.default,typeMap:{selection:w.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],f.prototype,"featureReduction",void 0);g([h.property({type:[G.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],f.prototype,"rangeInfos",void 0);g([h.property()],f.prototype,"associatedLayer",void 0);
g([h.property({type:["ArcGISSceneServiceLayer"]})],f.prototype,"operationalLayerType",void 0);g([h.property({json:{read:!1},readOnly:!0})],f.prototype,"type",void 0);g([h.property({type:[B]})],f.prototype,"fields",void 0);g([h.property({readOnly:!0})],f.prototype,"attributeStorageInfo",void 0);g([h.property({readOnly:!0})],f.prototype,"statisticsInfo",void 0);g([h.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],
f.prototype,"definitionExpression",void 0);g([h.property(y.elevationInfo)],f.prototype,"elevationInfo",null);g([h.property({type:String,dependsOn:["profile"]})],f.prototype,"geometryType",null);g([h.property(y.labelsVisible)],f.prototype,"labelsVisible",void 0);g([h.property({type:[D],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:E.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:E.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],
f.prototype,"labelingInfo",void 0);g([h.property(y.legendEnabled)],f.prototype,"legendEnabled",void 0);g([h.property({types:S.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:P}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:P},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],f.prototype,"renderer",null);g([h.property({json:{read:!1}})],f.prototype,"cachedDrawingInfo",void 0);g([h.reader("service","cachedDrawingInfo")],f.prototype,"readCachedDrawingInfo",
null);g([h.property(y.popupEnabled)],f.prototype,"popupEnabled",void 0);g([h.property({type:b,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],f.prototype,"popupTemplate",void 0);g([h.property({type:String,json:{read:!1}})],f.prototype,"objectIdField",void 0);g([h.reader("service","objectIdField",["objectIdField","fields"])],f.prototype,"readObjectIdField",null);g([h.property()],f.prototype,"objectIdFilter",void 0);g([h.property({type:String,json:{read:!1}})],f.prototype,"profile",void 0);
g([h.reader("service","profile",["store.profile"])],f.prototype,"readProfile",null);g([h.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],f.prototype,"normalReferenceFrame",void 0);g([h.property(x.screenSizePerspectiveEnabled)],f.prototype,"screenSizePerspectiveEnabled",void 0);return f=g([h.subclass()],f)}(h.declared(u,r))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/Error ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../Layer ./ArcGISService ./OperationalLayer ./PortalLayer ../support/arcgisLayerUrl ../support/commonProperties".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z){var w=e.getLogger("esri.layers.mixins.SceneService");return function(c){function e(){var a=null!==c&&c.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}k(e,c);e.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};
e.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return q.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new q(a):null};e.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent||!Array.isArray(a.extent)||a.extent.some(function(a){return-1E38>a})?null:new h({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],
spatialReference:b})};e.prototype.readVersion=function(a,b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};e.prototype.readTitlePortalItem=function(a,b){return"item-title"!==this.sublayerTitleMode?void 0:a};e.prototype.readTitleService=function(a,b){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return x.titleFromUrlAndName(this.url,
b.name);b=b.name||x.parse(this.url).title;"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return x.cleanTitle(b)};e.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(e.prototype,"url",{set:function(a){a=x.sanitizeUrlWithLayerId(this,a,w);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});e.prototype.writeUrl=function(a,b,c,d){x.writeUrlWithLayerId(this,a,"layers",b,d)};Object.defineProperty(e.prototype,
"parsedUrl",{get:function(){var a=this._get("url");if(!a)return null;a=m.urlToObject(a);null!=this.layerId&&x.match.test(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});e.prototype.readRootNode=function(a,b){return b.store.rootNode};e.prototype._verifyRootNodeAndUpdateExtent=function(){var a=this;return this._fetchRootNode().then(function(b){return a._updateExtentFromRootNode(b)})};e.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&
!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};e.prototype._fetchRootNode=function(){if(!this.rootNode)return d.resolve();var a=m.join(this.parsedUrl.path,this.rootNode);return g(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}).catch(function(c){throw new b("sceneservice:root-node-missing","Root node missing.",{error:c,url:a});})};e.prototype._fetchService=function(){var a=
this;return(null==this.layerId&&/SceneServer\/*$/i.test(this.url)?this._fetchFirstLayerId().then(function(b){null!=b&&(a.layerId=b)}):d.resolve()).then(function(){return a._fetchServiceLayer()})};e.prototype._fetchFirstLayerId=function(){return g(this.url,{query:{f:"json"},responseType:"json"}).then(function(a){if(a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length)return a.data.layers[0].id})};e.prototype._fetchServiceLayer=function(){var a=this;return g(this.parsedUrl.path,{query:{f:"json"},
responseType:"json"}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));b=b.data;a.read(b,{origin:"service",url:a.parsedUrl});a._validateLayer(b)})};e.prototype._validateLayer=function(a){};a([l.shared({id:{json:{origins:{service:{read:!1},"portal-item":{read:!1}}}}})],e.prototype,"properties",void 0);a([l.property({type:q})],e.prototype,"spatialReference",void 0);a([l.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readSpatialReference",
null);a([l.property({type:h})],e.prototype,"fullExtent",void 0);a([l.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readFullExtent",null);a([l.property({readOnly:!0,type:n})],e.prototype,"heightModelInfo",void 0);a([l.property({readOnly:!0})],e.prototype,"version",void 0);a([l.reader("version",["store.version"])],e.prototype,"readVersion",null);a([l.property({type:String,json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",
void 0);a([l.property({type:String})],e.prototype,"sublayerTitleMode",void 0);a([l.property({type:String})],e.prototype,"title",void 0);a([l.reader("portal-item","title")],e.prototype,"readTitlePortalItem",null);a([l.reader("service","title",["name"])],e.prototype,"readTitleService",null);a([l.property({type:Number})],e.prototype,"layerId",void 0);a([l.reader("service","layerId",["id"])],e.prototype,"readLayerId",null);a([l.property(z.url)],e.prototype,"url",null);a([l.writer("url")],e.prototype,
"writeUrl",null);a([l.property({dependsOn:["layerId"]})],e.prototype,"parsedUrl",null);a([l.property()],e.prototype,"store",void 0);a([l.property({type:String})],e.prototype,"rootNode",void 0);a([l.reader("rootNode",["store.rootNode"])],e.prototype,"readRootNode",null);return e=a([l.subclass("esri.layers.mixins.SceneService")],e)}(l.declared(t,u,c,r,y))})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});p=function(e){function c(){var a=null!==e&&e.apply(this,arguments)||this;a.name=null;a.field=null;a.currentRangeExtent=null;a.fullRangeExtent=null;a.type="rangeInfo";return a}k(c,e);a([b.property({type:String,json:{read:!0,write:!0}})],c.prototype,"name",void 0);a([b.property({type:String,json:{read:!0,write:!0}})],c.prototype,"field",void 0);a([b.property({type:[Number],json:{read:!0,write:!0}})],c.prototype,"currentRangeExtent",
void 0);a([b.property({type:[Number],json:{read:!0,write:!0}})],c.prototype,"fullRangeExtent",void 0);a([b.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0);return c=a([b.subclass("esri.layers.support.RangeInfo")],c)}(b.declared(g));f.RangeInfo=p;f.default=p})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./TiledLayerView3D ./support/tiledLayerUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m){return function(d){function h(){return null!==d&&d.apply(this,arguments)||this}k(h,d);h.prototype.initialize=function(){var a=this,c=this.get("view.map.ground.layers"),d=this.get("view.map.allLayers"),d=d&&d.includes(this.layer),c=c&&c.includes(this.layer);d&&!c&&(c=new g("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(b.reject(c)));(c=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent))?
this.addResolvingPromise(b.reject(c)):(c=e.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){m.throwIfError(a._getTileInfoCompatibilityError(a.tileInfo,a.view.basemapTerrain.tilingScheme))}),this.addResolvingPromise(c));this.addResolvingPromise(m.checkArcGISServiceVersionCompatibility(this.layer));this._updateMinMaxDataLevel()};a([c.property({aliasOf:"layer.fullExtent"})],h.prototype,"fullExtent",void 0);a([c.property()],h.prototype,"layer",void 0);a([c.property({aliasOf:"layer.tileInfo"})],
h.prototype,"tileInfo",void 0);return h=a([c.subclass("esri.views.3d.layers.ElevationLayerView3D")],h)}(c.declared(d))})},"esri/views/3d/layers/TiledLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/accessorSupport/decorators ./LayerView3D ./support/layerViewUpdatingProperties ../terrain/terrainUtils".split(" "),function(p,f,k,a,g,b,e,c,d){return function(e){function f(){var a=null!==
e&&e.apply(this,arguments)||this;a.minDataLevel=0;a.maxDataLevel=Infinity;a._isUpdating=!1;return a}k(f,e);Object.defineProperty(f.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"isOpaque",{get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0});f.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,c)};f.prototype.updatingChanged=function(a){this._isUpdating=
a;this.notifyChange("updating")};f.prototype.isUpdating=function(){return this._isUpdating};f.prototype._getTileInfoSupportError=function(a,b){if(a=d.checkIfTileInfoSupportedForView(a,b,this.view.spatialReference,this.view.basemapTerrain.manifold)){b={layer:this.layer,error:a};var c=void 0;switch(a.name){case "tilingscheme:local-gcs-not-supported":c=new g("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",b);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":c=
new g("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",b);break;default:c=new g("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",b)}return c}return null};f.prototype._getTileInfoCompatibilityError=function(a,b){return b.compatibleWith(a)?null:new g("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};
f.prototype._updateMinMaxDataLevel=function(){var a,b=Infinity,c=0;this.tileInfo.lods.forEach(function(a){b=Math.min(a.level,b);c=Math.max(a.level,c)});a=[b,c];this.minDataLevel=a[0];this.maxDataLevel=a[1]};a([b.property({readOnly:!0})],f.prototype,"imageFormatIsOpaque",null);a([b.property(c.updatingPercentage)],f.prototype,"updatingPercentage",void 0);a([b.property(c.updatingPercentageValue)],f.prototype,"updatingPercentageValue",void 0);a([b.property()],f.prototype,"fullExtent",void 0);a([b.property({readOnly:!0,
dependsOn:["fullOpacity","imageFormatIsOpaque"]})],f.prototype,"isOpaque",null);a([b.property()],f.prototype,"layer",void 0);a([b.property()],f.prototype,"minDataLevel",void 0);a([b.property()],f.prototype,"maxDataLevel",void 0);a([b.property()],f.prototype,"tileInfo",void 0);return f=a([b.subclass("esri.views.3d.layers.TiledLayerView3D")],f)}(b.declared(e))})},"esri/views/3d/layers/LayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/heightModelInfoUtils ../../layers/LayerView".split(" "),
function(p,f,k,a,g,b,e,c,d){return function(d){function f(){var a=null!==d&&d.apply(this,arguments)||this;a.slicePlaneEnabled=!1;a.supportsHeightUnitConversion=!1;return a}k(f,d);f.prototype.postscript=function(a){this.inherited(arguments);c.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};f.prototype._validateHeightModelInfo=function(){var a=this;return g.create(function(d,e){b.whenFalseOnce(a.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var b=
c.rejectLayerError(a.layer,a.view.heightModelInfo,a.supportsHeightUnitConversion);b?e(b):d()})})};a([e.property()],f.prototype,"view",void 0);a([e.property()],f.prototype,"slicePlaneEnabled",void 0);return f=a([e.subclass("esri.views.3d.layers.LayerView3D")],f)}(e.declared(d))})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.updatingPercentageValue={value:100,readOnly:!0};f.updatingPercentage=
{dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports dojo/request/xhr ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(p,f,k,a,g,b){function e(a){var b=null,c=a.search(/\/rest\/services\//i);0<c&&(b=a.substring(0,c+6));return b}Object.defineProperty(f,"__esModule",
{value:!0});f.checkArcGISServiceVersionCompatibility=function(c){if(!b.isHostedAgolService(c.url)){if(10.22>c.version)return c=new a("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+c.version,{minVersion:10.22,detectedVersion:c.version}),g.reject(c);if(10.22!==c.version||b.isHostedSecuredProxyService(c.url,c.get("portalItem.id")))return g.resolve();c=e(c.url);var d=new a("tiledlayerview3d:service-missing-cors-patch","Tiled Map Layers from 10.2.2 servers are only supported if all server updates have been applied.");
return k(c+"self?f\x3djson",{headers:{"X-Requested-With":null},timeout:1E4,handleAs:"json"}).then(function(a){if(!a||a.error)throw d;}).catch(function(){throw d;})}};f.throwIfError=function(a){if(a)throw a;}})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/compilerUtils ../../../core/Evented ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/controllers/FeatureTileController3D ../../../layers/graphics/controllers/support/controllerUtils ./FeatureLikeLayerView3D ./support/layerViewUpdatingProperties ./support/popupUtils3D ../../layers/FeatureLayerView".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r){p=function(d){function f(a){a=d.call(this)||this;a._controllerTotal=0;a._graphicsCoreTotal=0;a.suspendResumeExtentMode="data";return a}k(f,d);Object.defineProperty(f.prototype,"updatingPercentageValue",{get:function(){var a=0,b=0;this.controller&&this.controller.updating&&(a+=this.controller.updatingRemaining,b=this.controller.updatingTotal);var c=0;this.graphics3d&&this.graphics3d.graphicsCore&&(a+=this.graphics3d.graphicsCore.updatingRemaining,c=this.graphics3d.graphicsCore.updatingTotal);
0===b&&0===c?this._graphicsCoreTotal=this._controllerTotal=0:(this._controllerTotal=Math.max(b,this._controllerTotal),this._graphicsCoreTotal=Math.max(c,this._graphicsCoreTotal));return(b=this._controllerTotal+this._graphicsCoreTotal)?(b-a)/b*100:100},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"asyncGraphicsUpdates",{get:function(){if(this.controller)switch(this.controller.mode){case "snapshot":return this.controller.serviceDataCount>x;case "tiles":break;default:c.neverReached(this.controller.mode)}return!0},enumerable:!0,configurable:!0});f.prototype.fetchPopupFeatures=function(a,b){var c=this;this.hasDraped||(a=null);return this.inherited(arguments,[a,b]).then(function(a){if(0===a.length)return a;var b=new Set,d=c.layer.objectIdField;c.graphics3DGraphics.forEach(function(a){return b.add(a.graphic.attributes[d])});
return a.filter(function(a){return b.has(a.attributes[d])})})};f.prototype.getViewSpatialReference=function(){return this.view.spatialReference};f.prototype.createFetchPopupFeaturesQueryGeometry=function(a,b){return u.createQueryGeometry(a,b,this.view)};f.prototype.createController=function(){return e(this,void 0,void 0,function(){var a,c=this;return b(this,function(b){a=new h({layerView:this,graphics:new y,extent:this.clippingExtent});this.handles.add(m.init(a,"serviceDataExtent",function(a){c.graphics3d&&
(c.graphics3d.dataExtent=a)}));this.handles.add(m.init(this,"suspended",function(b){b?a.suspend():a.resume()},!0));this.handles.add(m.init(this.graphics3d.graphicsCore,"displayFeatureLimit",function(){return c.updateDisplayFeatureLimit(a)}));this.handles.add(this.view.resourceController.memoryEvents.on("quality-changed",function(){return c.updateDisplayFeatureLimit()}));return[2,a]})})};f.prototype.doRefresh=function(){!this.suspended&&n.isRefreshable(this.controller)&&this.controller.refresh()};
f.prototype.getStats=function(){var a=this.inherited(arguments);if(this.controller&&a.features){var b=this.controller.debug;a.features+="/"+b.storedFeatures+"/"+b.totalFeatures;a.totalVertices=b.totalVertices}b=(b=this.controller&&this.controller.displayFeatureLimit)&&b.maximumSymbolComplexity;a.numTiles=this.controller?this.controller.tileDescriptors.length:0;a.partial=this.maximumNumberOfFeaturesExceeded;a.mode=this.controller?this.controller.mode:"n/a";a.symbolComplexity=b?"f:"+b.primitivesPerFeature+
",v:"+b.primitivesPerCoordinate:"n/a";var c=this.graphics3d&&this.graphics3d.graphicsCore,b=c?c.unprocessedMemoryEstimate:0,c=this.controller?this.controller.expectedFeatureDiff*c.usedMemoryPerGraphic:0;a.memory="u:"+(this.getUsedMemory()/1024/1024).toFixed(1)+", pc:"+(""+(b/1024/1024).toFixed(1))+", pf:"+(""+(c/1024/1024).toFixed(1))+" MB";return a};f.prototype.getUsedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return(a?a.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:
0)};f.prototype.getUnloadedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return(a?a.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*a.usedMemoryPerGraphic:0)};f.prototype.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride};f.prototype.updateDisplayFeatureLimit=function(a){void 0===a&&(a=this.controller);if(a&&this.graphics3d&&this.graphics3d.graphicsCore){var b=this.graphics3d.graphicsCore.displayFeatureLimit,
c=this.view.resourceController.memoryFactor;1!==c&&(b=g({},b,{maximumNumberOfFeatures:Math.ceil(b.maximumNumberOfFeatures*c),maximumTotalNumberOfFeatures:Math.ceil(b.maximumTotalNumberOfFeatures*c),minimumTotalNumberOfFeatures:Math.ceil(b.minimumTotalNumberOfFeatures*c)}));a.displayFeatureLimit=b}};a([l.property()],f.prototype,"layer",void 0);a([l.property()],f.prototype,"controller",void 0);a([l.property({readOnly:!0,dependsOn:["controller.updatingRemaining","controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining",
"graphics3d.graphicsCore.updatingTotal"]})],f.prototype,"updatingPercentageValue",null);a([l.property({aliasOf:"controller.maximumNumberOfFeatures",set:null,get:null})],f.prototype,"maximumNumberOfFeatures",void 0);a([l.property({dependsOn:["suspended","controller.maximumNumberOfFeaturesExceeded"]})],f.prototype,"maximumNumberOfFeaturesExceeded",null);a([l.property(t.updatingPercentage)],f.prototype,"updatingPercentage",void 0);a([l.property({readOnly:!0,dependsOn:["controller.mode"]})],f.prototype,
"asyncGraphicsUpdates",null);a([l.property()],f.prototype,"suspendResumeExtentMode",void 0);return f=a([l.subclass("esri.views.3d.layers.FeatureLayerView3D")],f)}(l.declared(q,r));var y=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.items=new Set;return a}k(c,b);d=c;Object.defineProperty(c.prototype,"length",{get:function(){return this.items.size},enumerable:!0,configurable:!0});c.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this.items.add(a[b]);this.emit("change",
{added:a,removed:[],moved:[]})};c.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this.items.delete(a[b]);this.emit("change",{added:[],removed:a,moved:[]});return a};c.prototype.removeAll=function(){var a=this.toArray();this.emit("change",{added:[],removed:a,moved:[]})};c.prototype.toArray=function(){var a=[];this.items.forEach(function(b){return a.push(b)});return a};c.prototype.forEach=function(a){this.items.forEach(a)};c.prototype.some=function(a){return this.toArray().some(a)};c.prototype.find=
function(a){var b=null;this.forEach(function(c){!b&&a(c)&&(b=c)});return b};c.prototype.filter=function(a){var b=new d;this.forEach(function(c){a(c)&&b.items.add(c)});return b};var d;return c=d=a([l.subclass("esri.views.3d.layers.FeatureLayerView3D.SetCollection")],c)}(l.declared(d)),x=5E3;return p})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Accessor ../../../core/Collection ../../../core/compilerUtils ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../support/arcgisLayerUrl ../../../portal/support/geometryServiceUtils ../../../tasks/support/StatisticDefinition ../../../views/3d/layers/graphics/Graphics3DVerticalScale ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C){var D=h.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");p=function(b){function g(a){a=b.call(this)||this;a.type="feature-tile-3d";a.serviceDataExtent=null;a.serviceDataCount=f.constants.NO_SERVICE_DATA_COUNT;a.vertexLimitExceeded=!1;a.displayFeatureLimit=null;a.suspended=!1;a.tileFetcher=null;a.handles=new m;a.fetchDataInfoPromise=null;return a}k(g,b);f=g;Object.defineProperty(g.prototype,"extent",{set:function(a){if(a&&
!a.spatialReference.equals(this.layerView.view.spatialReference))D.error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var b=this._get("extent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("extent",a))}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||this.fetchDataInfoPromise)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updatingTotal",
{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingTotal:0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updatingRemaining",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"memoryForUnusedFeatures",{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"maximumNumberOfFeatures",
{get:function(){return this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(a){null!=a?this._override("maximumNumberOfFeatures",a):this._clearOverride("maximumNumberOfFeatures")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"mode",{get:function(){if(this.serviceDataCount===
f.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var a=this.layerView,b=a.layer,a=(a=(a=a.view)&&a.featureTiles)&&a.tilingScheme;return b&&b.minScale&&this.serviceDataExtent&&a&&(b=this.approximateExtentSizeAtScale(b.minScale,a),(this.serviceDataExtent.width/b+this.serviceDataExtent.height/b)/2>f.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"maxTotalSnapshotVertices",{get:function(){var a=this._get("maxTotalSnapshotVertices")||0;return Math.max(a,"snapshot"===this.mode&&this.tileFetcher&&this.tileFetcher.totalVertices||0)},enumerable:!0,configurable:!0});g.prototype.approximateExtentSizeAtScale=function(a,b){var c=this.layerView.view,d=b.levels[0];return(d.tileSize[0]/(d.scale/a)+d.tileSize[1]/(d.scale/a))/2*Math.ceil((c.width/b.pixelSize[0]+c.height/b.pixelSize[1])/2)};Object.defineProperty(g.prototype,
"tileDescriptors",{get:function(){return"snapshot"===this.mode?new e([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new e},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise}},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this.handles.add(this.watch("vertexLimitInfo",function(){return a.updateVertexLimitExceeded()}));
var b=q.resolve().then(function(){return a.verifyCapabilities()}).then(function(){return a.fetchServiceDataInfo()}).then(function(){return a.initializeTileFetcher()});this.addResolvingPromise(b)};g.prototype.verifyCapabilities=function(){var a=this.layerView.layer;if(!a.get("capabilities.operations.supportsQuery"))throw new d("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:a});};g.prototype.destroy=function(){this.cancelFetchServiceDataInfo();
this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null);this.handles&&(this.handles.destroy(),this.handles=null)};g.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())};g.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())};g.prototype.refresh=function(){var a=this,b=function(){a.tileFetcher&&a.tileFetcher.filtersChanged()};this.fetchServiceDataInfo().then(b,b)};g.prototype.initializeTileFetcher=
function(){var a=this,b=this.layerView.view;this.handles.add(t.whenOnce(b.featureTiles,"tilingScheme",function(){a.handles.add(b.featureTiles.addClient());var c=a.layerView,d=a.tileDescriptors,e=c.layer,g=new z({sourceSpatialReference:e.spatialReference,destSpatialReference:b.spatialReference});a.tileFetcher=new w.FeatureTileFetcher3D({layerView:c,filterExtent:a.filteredDataExtent,tilingScheme:b.featureTiles.tilingScheme,tileDescriptors:d,features:a.graphics,verticalScale:g,viewingMode:b.viewingMode});
a.suspended?a.tileFetcher.suspend():a.tileFetcher.resume();a.handles.add([e.watch("definitionExpression",function(){return a.definitionExpressionChanged()}),e.watch("outFields",function(b,c){return a.attributesChanged(c,b)}),e.on("apply-edits",function(b){return a.applyEdits(b)}),a.watch("filteredDataExtent",function(b){return a.tileFetcher.filterExtent=b},!0),a.watch("tileDescriptors",function(b){return a.tileFetcher.tileDescriptors=b},!0),t.init(a,"maximumNumberOfFeatures",function(b){a.tileFetcher.maximumNumberOfFeatures=
b;a.tileFetcher.useTileCount=a.serviceDataCount>b},!0),t.init(a,"serviceDataCount",function(b){return a.tileFetcher.useTileCount=b>a.maximumNumberOfFeatures},!0),t.init(C,"FEATURE_TILE_FETCH_SHOW_TILES",function(c){c&&a.tileFetcher&&!a.tileFetcher.debugger?(a.tileFetcher.debugger=new B.FeatureTileFetcher3DDebugger(a.tileFetcher,b.featureTiles.tilingScheme.toTileInfo(),b),a.tileFetcher.debugger.update()):!c&&a.tileFetcher&&a.tileFetcher.debugger&&(a.tileFetcher.debugger.destroy(),a.tileFetcher.debugger=
null)})]);a.supportsExceedsLimitQuery||a.watch("maxTotalSnapshotVertices",function(){return a.updateVertexLimitExceeded()})}))};g.prototype.definitionExpressionChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refresh()};g.prototype.applyEdits=function(a){var b=this;this.tileFetcher.applyEdits(a).then(function(a){a&&(a.deletedFeatures.length||a.updatedFeatures.length||a.addedFeatures.length)&&b.updateServiceDataExtent()})};g.prototype.attributesChanged=
function(a,b){if(!a||-1===a.indexOf("*"))if(a&&b){for(var c=new Set,d=0;d<a.length;d++){var e=a[d];c.add(e)}for(a=0;a<b.length;a++)if(e=b[a],!c.has(e)){this.refresh();break}}else this.refresh()};g.prototype.createVertexLimitExceededQuery=function(a){var b=this.layerView.layer.createQuery();b.outStatistics=[new x({statisticType:"exceedslimit",maxVertexCount:a,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];return b};g.prototype.createDataInfoQuery=function(){var a=this.layerView.layer,
b=a.createQuery();b.outSpatialReference=this.layerView.view.spatialReference;a.capabilities.query.supportsResultType&&(b.resultType="tile");return b};g.prototype.fullExtentIsAccurate=function(){var a=this.layerView.layer;if(a.definitionExpression)return!1;switch(a.type){case "feature":case "stream":return r.isHostedAgolService(a.url);case "csv":return!0;default:c.neverReached(a)}};g.prototype.updateServiceDataExtent=function(){var a=this,b=this.layerView,c=b.layer,d=c.capabilities.query.supportsExtent,
e=l.clone(b.fullExtentInLocalViewSpatialReference),g=c.fullExtent,h=this.fullExtentIsAccurate(),k=this.serviceDataCount,m=null;!(d&&k<=f.constants.MAX_FEATURE_COUNT_FOR_EXTENT)||e&&h?e?this._set("serviceDataExtent",e):g?m=y.projectGeometry(g,b.view.spatialReference,c.portalItem).then(function(b){a._set("serviceDataExtent",b)}):this._set("serviceDataExtent",null):(b=this.createDataInfoQuery(),m=c.queryExtent(b,{timeout:f.constants.QUERY_EXTENT_TIMEOUT}).then(function(b){a._set("serviceDataExtent",
b.extent)}));m&&(m=m.catch(function(b){b&&"cancel"===b.dojoType||a._set("serviceDataExtent",e)}));return m};g.prototype.updateServiceDataCount=function(){var a=this;return this.layerView.layer.queryFeatureCount(this.createDataInfoQuery(),{timeout:f.constants.QUERY_STATISTICS_TIMEOUT}).then(function(b){a._set("serviceDataCount",b)}).catch(function(b){if(b&&"cancel"===b.dojoType)throw b;a._set("serviceDataCount",f.constants.NO_SERVICE_DATA_COUNT)})};Object.defineProperty(g.prototype,"vertexLimitInfo",
{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var a=this.displayFeatureLimit,b=a.maximumSymbolComplexity,a=a.maximumTotalNumberOfPrimitives,c=b.primitivesPerCoordinate,b=b.primitivesPerFeature,d=this._get("vertexLimitInfo");return d&&d.maximumTotalNumberOfPrimitives===a&&d.primitivesPerCoordinate===c&&d.primitivesPerFeature===b?d:{primitivesPerCoordinate:c,primitivesPerFeature:b,maximumTotalNumberOfPrimitives:a}},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"supportsExceedsLimitQuery",{get:function(){var a=this.layerView.layer;return a.capabilities&&a.capabilities.operations&&a.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var a=this.layerView.layer.geometryType;switch(a){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;
default:return c.neverReached(a),0}},enumerable:!0,configurable:!0});g.prototype.updateVertexLimitExceeded=function(a){var b=this,c=this.layerView.layer,d=this.supportsExceedsLimitQuery;if(!(this.vertexLimitInfo&&0>=this.vertexLimitInfo.primitivesPerFeature))return this._set("vertexLimitExceeded",!1),q.resolve();var e=this.vertexLimitInfo,g=e.primitivesPerFeature,h=e.primitivesPerCoordinate,k=e.maximumTotalNumberOfPrimitives;return q.when(0!==g?a:null).then(function(){var a=b.serviceDataCount,e,l=
a!==f.constants.NO_SERVICE_DATA_COUNT;e=l?Math.ceil((k-a*g)/(h||1)):Math.ceil(k/(h||1));if(l&&b.minimumNumberOfVerticesForGeometry*a>e)b._set("vertexLimitExceeded",!0);else{if(d)return c.queryFeatures(b.createVertexLimitExceededQuery(e),{timeout:f.constants.QUERY_STATISTICS_TIMEOUT}).then(function(a){(a=a.features[0])&&a.attributes?b._set("vertexLimitExceeded",!!a.attributes.exceedslimit):b._set("vertexLimitExceeded",!1)}).catch(function(a){if(a&&"cancel"===a.dojoType)throw a;b._set("vertexLimitExceeded",
!1)});b._set("vertexLimitExceeded",b.maxTotalSnapshotVertices>e)}})};g.prototype.fetchServiceDataInfo=function(){var a=this;this.cancelFetchServiceDataInfo();var b=q.eachAlways([this.updateServiceDataCount(),this.updateVertexLimitExceeded()]),c=b.then(function(){return a.updateServiceDataExtent()}).catch(function(a){a&&"AbortError"===a.name||D.error("#fetchServiceDataInfo()",a)}).then(function(){c===a.fetchDataInfoPromise&&(a.fetchDataInfoPromise=null)});c.isFulfilled()||(this.fetchDataInfoPromise=
c);return b.catch(function(){})};g.prototype.cancelFetchServiceDataInfo=function(){var a=this.fetchDataInfoPromise;a&&(this.fetchDataInfoPromise=null,a.cancel())};Object.defineProperty(g.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!0,configurable:!0});var f;a([u.property({readOnly:!0})],g.prototype,
"type",void 0);a([u.property({constructOnly:!0})],g.prototype,"graphics",void 0);a([u.property({constructOnly:!0})],g.prototype,"layerView",void 0);a([u.property()],g.prototype,"extent",null);a([u.property({dependsOn:["tileFetcher.updating","fetchDataInfoPromise"]})],g.prototype,"updating",null);a([u.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],g.prototype,"updatingTotal",null);a([u.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],g.prototype,"updatingRemaining",
null);a([u.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],g.prototype,"expectedFeatureDiff",null);a([u.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],g.prototype,"memoryForUnusedFeatures",null);a([u.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],g.prototype,"maximumNumberOfFeaturesExceeded",null);a([u.property({readOnly:!0})],g.prototype,"serviceDataExtent",void 0);a([u.property({readOnly:!0})],g.prototype,"serviceDataCount",void 0);a([u.property({readOnly:!0})],
g.prototype,"vertexLimitExceeded",void 0);a([u.property({readOnly:!0,dependsOn:["extent"]})],g.prototype,"filteredDataExtent",null);a([u.property()],g.prototype,"displayFeatureLimit",void 0);a([u.property({type:Number,dependsOn:["displayFeatureLimit"]})],g.prototype,"maximumNumberOfFeatures",null);a([u.property({readOnly:!0,dependsOn:"serviceDataCount displayFeatureLimit maximumNumberOfFeatures vertexLimitExceeded serviceDataExtent layerView.layer.minScale layerView.view.featureTiles.tilingScheme".split(" ")})],
g.prototype,"mode",null);a([u.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],g.prototype,"maxTotalSnapshotVertices",null);a([u.property({readOnly:!0,dependsOn:["mode"]})],g.prototype,"tileDescriptors",null);a([u.property()],g.prototype,"tileFetcher",void 0);a([u.property()],g.prototype,"fetchDataInfoPromise",void 0);a([u.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],g.prototype,"vertexLimitInfo",null);return g=f=a([u.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],
g)}(u.declared(b,n));(function(a){(function(a){a.NO_SERVICE_DATA_COUNT=Infinity;a.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;a.reset=function(){a.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;a.QUERY_STATISTICS_TIMEOUT=12E3;a.QUERY_EXTENT_TIMEOUT=1E4}})(a.constants||(a.constants={}))})(p||(p={}));p.constants.reset();return p})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/now ../../../../core/promiseUtils ../../../../core/QueueProcessor ../../../../core/scheduling ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/QuantizationParameters ../../../../tasks/support/Query ./featureReference ./FeatureTile ./featureTileQuery3D".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D){function E(a,b){return null!=a.objectId?a.objectId:a.attributes[b]}function G(a){for(var b=0,c=0;c<a.length;c++){var d=a[c];d.features&&0<d.features.length&&d.alive&&(b=Math.max(b,d.descriptor.lij[0]))}return b}Object.defineProperty(f,"__esModule",{value:!0});var H=B.SingleFeatureReference,I=B.MultiFeatureReference,N=l.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");p=function(c){function g(a){a=c.call(this,a)||this;a.useTileCount=
!1;a.updating=!1;a.updatingTotal=0;a.updatingRemaining=0;a.expectedFeatureDiff=0;a.maximumNumberOfFeaturesExceeded=!1;a.maximumNumberOfFeaturesExceededThrottle=1E3;a.maximumNumberOfFeaturesExceededNext=0;a._fullRatio=1;a._farRatio=1;a.changes={updates:{adds:[],removes:[]},adds:[],removes:[]};a.handles=new m;a._dirty=!1;a.idToFeatureTile=new Map;a.displayingFeatureReferences=new Map;a.numDisplayingFeatureReferences=0;a.suspended=!0;a.pendingEdits=null;return a}k(g,c);Object.defineProperty(g.prototype,
"maximumNumberOfFeatures",{set:function(a){a=a||Infinity;var b=this._get("maximumNumberOfFeatures");a===b||1>a||(this._set("maximumNumberOfFeatures",a),this.maximumFeaturesUpdated(b,a))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"memoryForUnusedFeatures",{get:function(){var a=0;this.forEachFeatureTile(function(b){return a+=b.estimatedUnusedSize});return a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"totalVertices",{get:function(){var a=0;this.forEachFeatureTile(function(b){return a+=
b.numVertices});return a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"totalFeatures",{get:function(){var a=0;this.forEachFeatureTile(function(b){return a+=b.numFeatures});return a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"filterExtent",{set:function(a){if(a&&this.tilingScheme&&!a.spatialReference.equals(this.tilingScheme.spatialReference))N.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var b=
this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.reclip(a,b))}},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this.capabilities=this.calculateCapabilities();this.fetchQueue=this.createFetchQueue();var b=this.layerView.layer;this.handles.add(u.on(this,"tileDescriptors","change",function(){return a.setDirty()},function(){return a.setDirty()}));this.handles.add(b.watch("hasService",function(){return a._initMemCache()}));
u.init(b,"hasService",function(){return a._initMemCache()});this.objectIdField=b.objectIdField;this.FeatureReferenceClass=this.capabilities.supportsMultipleResolutions?I:H;this.featureTileQuery=D.createFeatureTileQuery3D(b);this._idleFrameWorker=this.layerView.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a._dirty||0<a.maximumNumberOfFeaturesExceededNext},idleBegin:function(){return a.unpause()},idleFrame:function(b){return a.update(b)},idleEnd:function(){return a.pause()}});
this.setDirty()};g.prototype.destroy=function(){var a=this;this._idleFrameWorker&&(this._idleFrameWorker.remove(),this._idleFrameWorker=null);this.handles&&(this.handles.destroy(),this.handles=null);this.forEachFeatureTile(function(b){return a.cancelFetchTile(b)});this.fetchQueue.clear();this.pendingEdits&&(this.pendingEdits.edits.cancel(O),this.pendingEdits=null);this._memCache&&this._memCache.destroy();this._memCache=null};Object.defineProperty(g.prototype,"paused",{get:function(){return this.suspended||
!!this.pendingEdits},enumerable:!0,configurable:!0});g.prototype.filtersChanged=function(){var a=this;this.fetchQueue.clear();this._memCache&&this._memCache.clear();this.forEachFeatureTile(function(b){a.resetFetchTile(b);a.queueFetchTile(b)});this.setDirty()};g.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())};g.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())};g.prototype.pause=function(){this.paused&&(this.fetchQueue.pause(),
this.fetchQueue.reset(),this.updated())};g.prototype.unpause=function(){this.paused||(this.setDirty(),this.fetchQueue.resume(),this.updated())};g.prototype.getFeatureTileById=function(a){return this.idToFeatureTile.get(a)||null};g.prototype.forEachFeatureTile=function(a){this.idToFeatureTile.forEach(a)};g.prototype.applyEdits=function(a){var b=this;this.pendingEdits||(this.pendingEdits={edits:n.resolve(),count:0},this.pause());this.pendingEdits.count++;var c=this.pendingEdits.edits.then(function(){return a.result.catch(function(a){if(a===
O)throw a;return null}).then(function(a){return a?(b.applyEditsDeleteFeatures(a.deletedFeatures),d.safeCast(b.applyEditsAddUpdateFeatures(a.addedFeatures,a.updatedFeatures).then(function(){return a}))):a}).then(function(a){0===--b.pendingEdits.count&&(b.pendingEdits=null,b._memCache&&b._memCache.clear(),b.unpause());return a})});return this.pendingEdits.edits=c};g.prototype.applyEditsDeleteFeatures=function(a){var b=this;if(0!==a.length){var c=new Set;a.forEach(function(a){return c.add(a.objectId)});
this.forEachFeatureTile(function(a){if(a.features){var d=a.features.filter(function(a){return!c.has(E(a,b.objectIdField))});d.length!==a.features.length&&(a.setFeatures(d,0),b.invalidateCounts())}})}};g.prototype.applyEditsAddUpdateFeatures=function(a,c){return b(this,void 0,void 0,function(){var b,g,f,h=this;return e(this,function(e){switch(e.label){case 0:b=[];g=new Set;a.forEach(function(a){return b.push(a.objectId)});c.forEach(function(a){b.push(a.objectId);g.add(a.objectId)});if(0===b.length)return[2];
f=[];this.forEachFeatureTile(function(a){(a=d.safeCast(h.applyEditsAddUpdateTile(a,b,g)))&&f.push(a)});return[4,n.eachAlways(f)];case 1:return e.sent(),[2]}})})};g.prototype.applyEditsAddUpdateTile=function(a,c,d){return b(this,void 0,void 0,function(){var b,g,f,h,k,l,m,n=this;return e(this,function(e){switch(e.label){case 0:if(!a.features)return[2];b=this.createQuery(a);b.resultType=void 0;b.objectIds=c;return[4,this.queryFeatures(b)];case 1:g=e.sent();f=null;0<d.size&&(h=a.features.filter(function(a){return!d.has(E(a,
n.objectIdField))}),h.length!==a.features.length&&(f=h));if(0<g.features.length)for(f||(f=a.features.slice()),this.verticalScale.adjust(g.features),k=0,l=g.features;k<l.length;k++)m=l[k],f.push(m);f&&(a.setFeatures(f,0),this.invalidateCounts());return[2]}})})};g.prototype.queryFeatures=function(a){return this.featureTileQuery.queryFeaturesDehydrated(a,{timeout:W})};g.prototype.calculateCapabilities=function(){var a=this.layerView.layer,b=!!(a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsPagination),
c=!!(a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsResultType),d=!!(a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsQuantization),e=!!(a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsQuantizationEditMode),g=!!(a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsMaxRecordCountFactor),a=!!(a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsFormatPBF);return{supportsMultipleResolutions:this.calculateSupportsMultipleResolutions(),
supportsPagination:b,supportsResultType:c,supportsQuantization:d,supportsQuantizationEditMode:e,supportsMaxRecordCountFactor:g,supportsFormatPBF:a}};g.prototype.calculateSupportsMultipleResolutions=function(){var a=this.layerView.layer;switch(a.geometryType){case "polyline":return!0;case "polygon":return a.capabilities&&a.capabilities.query&&a.capabilities.query.supportsQuantization;default:return!1}};g.prototype.createFetchQueue=function(){var a=this;return new q({concurrency:6,peeker:function(b){return a.highestPriorityTile(b)},
process:function(b){return d.safeCast(a.fetchTile(b))}})};g.prototype.highestPriorityTile=function(a){return a.reduce(function(a,b){return a&&a.descriptor.loadPriority<=b.descriptor.loadPriority?a:b},null)};g.prototype._initMemCache=function(){var a=this.layerView.layer;a.hasService?this._memCache||(this._memCache=this.layerView.view.resourceController.getMemCache(a.uid)):this._memCache&&(this._memCache.destroy(),this._memCache=null)};g.prototype.setDirty=function(){this._dirty=!0;this.forEachFeatureTile(function(a){a.featureLimit=
0});this.updated()};g.prototype.update=function(a){var b=this;this.maximumNumberOfFeaturesExceededNext&&h()>=this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded();if(this._dirty&&this.constructed){this._dirty=!1;var c=this.getListOfTiles();this.markTilesNotAlive(c);this.addTiles(c);this.filterExtentTiles(c);this.removeTiles(c);var d=this.sortTiles(c);a.runWithProgress(function(){return b.displayTiles(d,a)})&&a.runWithProgress(function(){return b.queueFetchTiles(d,
a)})||this.setDirty();this.updated()}};g.prototype.markTilesNotAlive=function(a){for(var b=0;b<a.length;b++)a[b].alive=!1};g.prototype.addTiles=function(a){var b=this;this.suspended||this.tileDescriptors.forEach(function(c){var d=b.getFeatureTileById(c.id);d?d.alive=!0:a.push(b.addTile(c))})};g.prototype.filterExtentTiles=function(a){for(var b=0;b<a.length;b++){var c=a[b];c.alive&&(c.filtered=!c.intersects(this.filterExtent),c.filtered&&this.clearTile(c))}};g.prototype.removeTiles=function(a){for(var b=
a.length-1;0<=b;b--){var c=a[b];c.alive||(this.removeTile(c),b!==a.length-1&&(a[b]=a[a.length-1]),a.pop())}};g.prototype.sortTiles=function(a){a.sort(function(a,b){return a.descriptor.loadPriority-b.descriptor.loadPriority});return a};g.prototype.displayTiles=function(a,b){for(var c=this,d=this.updateRatio(a),e=function(a){if(!b.runWithProgress(function(){var b=1>c._fullRatio?d(a)*c._farRatio:1;a.reduceFeatures(b,c.objectIdField)&&c.setDirty();return c.showTile(a)}))return g.setDirty(),"break"},g=
this,f=0;f<a.length&&"break"!==e(a[f]);f++);return!0};g.prototype.queueFetchTiles=function(a,b){for(var c=this,d=function(a){if(!b.runWithProgress(function(){return c.queueFetchTile(a)}))return e.setDirty(),{value:!0}},e=this,g=0;g<a.length;g++){var f=d(a[g]);if("object"===typeof f)return f.value}return!0};g.prototype.reclip=function(a,b){var c=this;this.constructed&&(this.forEachFeatureTile(function(d){d.displayingFeatures&&0!==d.displayingFeatures.length&&(d.intersection(b,M),d.intersection(a,P),
y.equals(M,P)||c.hideTileFeatures(d))}),this.forEachFeatureTile(function(a){c.showTile(a)}),this.updated())};g.prototype.updated=function(){var a=this,b=this._dirty||0<this.fetchQueue.length;this._set("updating",b);if(b){var c=b=0,d=0,e=0,g=0,f=0,k=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.forEachFeatureTile(function(b){++d;if(b.isFetching&&b.hasPreciseFeatureCount){var h=a.maximumFeaturesForTile(b)*(1-b.emptyFeatureRatio);f+=h-(b.displayingFeatures?b.displayingFeatures.length*
k:0)}b.needsFetching?++g:0<b.numFeatures&&(++e,c+=b.numFeatures)});var l=g+=this.fetchQueue?this.fetchQueue.length:0;c?(l=g*c/e,b=c+l):b=d;f=Math.min(this.maximumNumberOfFeatures-this.features.length,f);this._set("updatingTotal",b);this._set("updatingRemaining",l);this._set("expectedFeatureDiff",f)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update();this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||
h()+this.maximumNumberOfFeaturesExceededThrottle)};g.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var a=!1;this.forEachFeatureTile(function(b){a=a||b.perTileMaximumNumberOfFeaturesExceeded});this.maximumNumberOfFeaturesExceededNext=0;this._set("maximumNumberOfFeaturesExceeded",a)}};g.prototype.updateRatio=function(a){for(var b=G(a),c=function(a){return 1/(1<<b-a.descriptor.lij[0])},d=0,e=0,g=0;g<a.length;g++)var f=a[g],h=f.numFeatures,d=d+h,e=e+h*c(f);this._fullRatio=
Math.min(1,this.maximumNumberOfFeatures/d);this._farRatio=this.maximumNumberOfFeatures/e;this.scheduleUpdated();return c};g.prototype.maximumFeaturesUpdated=function(a,b){var c=this;a!==b&&(b>a&&this.forEachFeatureTile(function(a){if(a.featuresMissing){var b=c.maximumFeaturesForTile(a);a.features&&(a.features.length>=b||5===a.fetchStatus)||(c.cancelFetchTile(a),c.resetFetchTile(a))}}),this.setDirty())};g.prototype.addTile=function(a){a=new C(a);this.idToFeatureTile.set(a.id,a);this.resetFetchTile(a);
this.referenceDisplayingFeaturesFromRelatedTiles(a);return a};g.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(a){var b=this,c=a.descriptor.resolution;this.forEachFeatureTile(function(d){if(d.displayingFeatures&&b.tilesAreRelated(a,d)){a.displayingFeatures=a.displayingFeatures||[];var e=0;for(d=d.displayingFeatures;e<d.length;e++){var g=d[e];a.displayingFeatures.push(g);g=b.displayingFeatureReferences.get(E(g,b.objectIdField));g.ref(c,g.feature);b.numDisplayingFeatureReferences++}}});
a.featureLimit=a.displayingFeatures?a.displayingFeatures.length:0};g.prototype.tilesAreRelated=function(a,b){if(a===b)return!1;a=a.descriptor.lij;var c=b.descriptor.lij;if(!a||!c)return!0;var d=a[0]<c[0];b=d?a:c;a=d?c:a;c=a[0]-b[0];if(0===c)return!1;c=1<<c;return Math.floor(a[1]/c)===b[1]&&Math.floor(a[2]/c)===b[2]};g.prototype.removeTile=function(a){this.clearTile(a);this.idToFeatureTile.delete(a.id)};g.prototype.resetFetchTile=function(a){a.intersects(this.filterExtent)?(a.fetchStatus=0,a.filtered=
!1):(a.needsFetching&&(a.fetchStatus=4),a.filtered=!0)};g.prototype.cancelFetchTile=function(a){var b=a.fetchRequest;b&&(a.fetchRequest=null,a.fetchStatus=0,b.cancel())};g.prototype.fetchTile=function(a){return b(this,void 0,void 0,function(){var b,c,d,g,f,h,k,l,m,n,r;return e(this,function(e){switch(e.label){case 0:if(!this.needsNumFeatures(a))return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),b=a,[4,this.fetchCount(a)];case 2:return b.numFeatures=e.sent(),this.updateRatio(this.getListOfTiles()),
[3,4];case 3:return(c=e.sent())&&"cancel"===c.dojoType?[2]:[3,4];case 4:return d=this.maximumFeaturesForTile(a),g=Math.ceil(d/this.maxRecordCount),"dummy-tile-full-extent"===a.id||!this.capabilities.supportsMaxRecordCountFactor||a.numFeatures<=d&&g>w.MAX_MAX_RECORD_COUNT_FACTOR?[4,this.fetchPagedTile(a)]:[3,6];case 5:return[2,e.sent()];case 6:return f=this.createQuery(a),f.maxRecordCountFactor=Math.ceil(d/this.maxRecordCount),a.isRefetching&&a.features&&0<a.features.length&&(h=Math.ceil(a.features.length/
(1-a.emptyFeatureRatio)/this.maxRecordCount),f.maxRecordCountFactor=Math.max(h+1,f.maxRecordCountFactor)),[4,this.queryFeatures(f)];case 7:return k=e.sent(),l=k.features,n=(m=k.exceededTransferLimit)?f.maxRecordCountFactor>=w.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,a.featuresMissing=l.length<a.numFeatures||m,r=this._removeEmptyFeatures(l),this.verticalScale.adjust(l),a.setFeatures(l,r),this.invalidateCounts(),[2,n]}})})};g.prototype.fetchCount=function(a){return b(this,void 0,void 0,function(){return e(this,
function(b){return[2,this.layerView.layer.queryFeatureCount(this.createQuery(a))]})})};g.prototype.fetchPagedTile=function(a){return b(this,void 0,void 0,function(){var b,c,d,g,f,h,k,l,m,n;return e(this,function(e){switch(e.label){case 0:g=c=b=0,f=this.maximumFeaturesForTile(a)-g,e.label=1;case 1:return h=this.createQuery(a),k=this.setPagingParameters(h,b,f),[4,this.queryFeatures(h)];case 2:return l=e.sent(),m=l.features,n=l.exceededTransferLimit,b+=h.num,g+=m.length,c+=this._removeEmptyFeatures(m),
this.verticalScale.adjust(m),a.featuresMissing=b<a.numFeatures||n,d=d?d.concat(m):m,a.setFeatures(d,c),this.invalidateCounts(),this.setDirty(),f=this.maximumFeaturesForTile(a)-g,!k||!n||0>=f?[2,n?4:5]:[3,1];case 3:return[2]}})})};g.prototype.createQuery=function(a){var b=this.layerView.layer.createQuery(),c=this.layerView.layer.capabilities&&this.layerView.layer.capabilities.data;c&&c.supportsZ&&null==b.returnZ&&(b.returnZ=!0);c=this.tilingScheme.spatialReference;b.outSpatialReference=c;var d=a.descriptor.extent;
d&&(b.geometry=y.toExtent(d,c));this.setResolutionParams(b,a);this.capabilities.supportsResultType&&(b.resultType="tile");return b};g.prototype.setPagingParameters=function(a,b,c){if(!this.capabilities.supportsPagination)return!1;a.start=b;0<c&&this.capabilities.supportsMaxRecordCountFactor?(a.maxRecordCountFactor=Math.ceil(c/this.maxRecordCount),a.num=Math.min(a.maxRecordCountFactor*this.maxRecordCount,c)):a.num=Math.min(this.maxRecordCount);return!0};g.prototype.getEffectiveTileResolution=function(a){if(null==
a.descriptor.resolution)return null;var b="global"===this.viewingMode?this.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(a.descriptor.resolution,b)*J};g.prototype.setResolutionParams=function(a,b){if(!this.capabilities.supportsMultipleResolutions)return this.setDefaultResolutionParams(a,b);var c=this.layerView.layer;if("point"===c.geometryType)return this.setDefaultResolutionParams(a,b);var d=this.getEffectiveTileResolution(b);if(null==d)return this.setDefaultResolutionParams(a,b);this.capabilities.supportsQuantization?
a.quantizationParameters=new z.default({mode:"view",originPosition:"upper-left",tolerance:d,extent:c.fullExtent}):"polyline"===c.geometryType&&(a.maxAllowableOffset=d)};g.prototype.setDefaultResolutionParams=function(a,b){this.capabilities.supportsQuantization&&this.capabilities.supportsQuantizationEditMode&&this.capabilities.supportsFormatPBF&&(a.quantizationParameters=new z.default({mode:"edit"}))};g.prototype._removeEmptyFeatures=function(a){for(var b=a.length,c=0;c<a.length;)x.hasVertices(a[c].geometry)?
++c:(a[c]=a[a.length-1],--a.length);return b-a.length};g.prototype.needsNumFeatures=function(a){return this.useTileCount&&!a.hasPreciseFeatureCount&&"dummy-tile-full-extent"!==a.id};Object.defineProperty(g.prototype,"maxRecordCount",{get:function(){return this.capabilities.supportsResultType?this.layerView.layer.tileMaxRecordCount:this.layerView.layer.maxRecordCount?this.layerView.layer.maxRecordCount:S},enumerable:!0,configurable:!0});g.prototype.queueFetchTile=function(a){var b=this;if(!a.needsFetching)return!1;
var c=this._memCache&&this._memCache.pop(a.id);if(c)return a.loadCache(c),this.setDirty(),this.scheduleUpdated(),!0;a.fetchStatus=a.needsRefetching?3:2;var d=!1,e=this.fetchQueue.push(a).then(function(b){a.fetchRequest=null;a.fetchStatus=b}).catch(function(c){a.fetchRequest===e&&(a.fetchRequest=null,a.fetchStatus=4);c&&"cancel"===c.dojoType?d=!0:(a.setFeatures([],0),b.invalidateCounts(),a.featuresMissing=!1,N.error("#fetchTile()",b.layerView.layer,c&&c.message?c.message:c))}).then(function(){d||b.setDirty();
b.scheduleUpdated()});e.isFulfilled()||(a.fetchRequest=e);return!0};g.prototype.scheduleUpdated=function(){var a=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(t.schedule(function(){a.handles.remove("scheduleUpdated");a.updated()}),"scheduleUpdated")};g.prototype.showTile=function(a){if(a.displayingFeatures&&!a.needsDisplayUpdate)return!1;if(0===a.featureLimit||!a.features){var b=a.displayingFeatures&&0<a.displayingFeatures.length;this.hideTileFeatures(a);a.displayingFeatures=
[];return b}for(var b=a.descriptor.resolution,c=this.changes.updates,d=this.changes.adds,e=0;e<a.featureLimit;++e){var g=a.features[e],f=E(g,this.objectIdField),h=this.displayingFeatureReferences.get(f);h?(g=h.ref(b,g),g.oldVersion!==g.newVersion&&(c.removes.push(g.oldVersion),c.adds.push(g.newVersion))):(this.displayingFeatureReferences.set(f,new this.FeatureReferenceClass(b,g)),d.push(g));this.numDisplayingFeatureReferences++}this.hideTileFeatures(a);this.applyChanges();a.displayingFeatures=a.features.slice(0,
a.featureLimit);return!0};g.prototype.hideTile=function(a){this.cancelFetchTile(a);this.hideTileFeatures(a)};g.prototype.hideTileFeatures=function(a){if(a.displayingFeatures){for(var b=this.changes.updates,c=this.changes.removes,d=0,e=a.displayingFeatures;d<e.length;d++){var g=E(e[d],this.objectIdField),f=this.displayingFeatureReferences.get(g);f&&((f=f.unref(a.descriptor.resolution),this.numDisplayingFeatureReferences--,f)?f.oldVersion!==f.newVersion&&(null==f.newVersion?(this.displayingFeatureReferences.delete(g),
c.push(f.oldVersion)):(b.adds.push(f.newVersion),b.removes.push(f.oldVersion))):console.error("Hiding unreferenced feature"))}this.applyChanges();a.displayingFeatures=null}};g.prototype.applyChanges=function(){var a=this.changes.updates;0<a.removes.length&&(this.features.removeMany(a.removes),a.removes.length=0);0<a.adds.length&&(this.features.addMany(a.adds),a.adds.length=0);for(var a=this.changes.adds,b=this.changes.removes,c=Math.min(a.length,b.length),d=0;d<c;){var e=Math.min(d+Q,c);this.features.addMany(a.slice(d,
e));this.features.removeMany(b.slice(d,e));d=e}a.length>c&&this.features.addMany(0===d?a:a.slice(d));b.length>c&&this.features.removeMany(0===d?b:b.slice(d));a.length=0;b.length=0};g.prototype.clearTile=function(a){this.hideTile(a);a.features&&this._memCache&&this._memCache.put(a.id,a.cacheItem,16+a.estimatedSize);a.setFeatures(null,0);this.invalidateCounts()};g.prototype.invalidateCounts=function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};
g.prototype.getListOfTiles=function(){var a=Array(this.idToFeatureTile.size),b=0;this.forEachFeatureTile(function(c){return a[b++]=c});return a};Object.defineProperty(g.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce(function(a,b){return a+(b.features?b.features.length:0)},0)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"debug",{get:function(){var a=this;return{update:function(b){return a.update(b)}}},enumerable:!0,configurable:!0});g.prototype.maximumFeaturesForTile=
function(a){var b=a.hasPreciseFeatureCount?a.numFeatures:this.maximumNumberOfFeatures;return Math.min(Math.ceil(b*(1>this._fullRatio?this._farRatio:1)/(1-a.emptyFeatureRatio)),b)};a([r.property({constructOnly:!0})],g.prototype,"features",void 0);a([r.property()],g.prototype,"tileDescriptors",void 0);a([r.property({constructOnly:!0})],g.prototype,"tilingScheme",void 0);a([r.property({value:Infinity})],g.prototype,"maximumNumberOfFeatures",null);a([r.property()],g.prototype,"useTileCount",void 0);a([r.property({constructOnly:!0})],
g.prototype,"layerView",void 0);a([r.property({readOnly:!0})],g.prototype,"updating",void 0);a([r.property({readOnly:!0})],g.prototype,"updatingTotal",void 0);a([r.property({readOnly:!0})],g.prototype,"updatingRemaining",void 0);a([r.property({readOnly:!0})],g.prototype,"expectedFeatureDiff",void 0);a([r.property({readOnly:!0})],g.prototype,"memoryForUnusedFeatures",null);a([r.property({readOnly:!0})],g.prototype,"maximumNumberOfFeaturesExceeded",void 0);a([r.property({constructOnly:!0})],g.prototype,
"maximumNumberOfFeaturesExceededThrottle",void 0);a([r.property({readOnly:!0})],g.prototype,"totalVertices",null);a([r.property({readOnly:!0})],g.prototype,"totalFeatures",null);a([r.property()],g.prototype,"filterExtent",null);a([r.property({constructOnly:!0})],g.prototype,"verticalScale",void 0);a([r.property({constructOnly:!0})],g.prototype,"viewingMode",void 0);return g=a([r.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],g)}(r.declared(c));f.FeatureTileFetcher3D=p;f.getFeatureId=
E;var S=2E3,M=y.create(),P=y.create(),O={},W=6E5,Q=200,J=1/3;f.default=p})},"esri/core/QueueProcessor":function(){define("require exports ./compilerUtils ./promiseUtils ./Queue ./scheduling".split(" "),function(p,f,k,a,g,b){return function(){function e(a){this._apiPromises=new Map;this._processingItems=new Map;this._isPaused=!1;this._scheduledNextHandle=null;this._pendingProcessing=0;this.concurrency=1;this.ordered=!1;a.concurrency&&(this.concurrency=a.concurrency);a.ordered&&(this.ordered=!0,this._itemsToProcess=
[]);this._queue=new g({peeker:a.peeker});this.process=a.process}Object.defineProperty(e.prototype,"length",{get:function(){return this._processingItems.size+this._queue.length+this._pendingProcessing},enumerable:!0,configurable:!0});e.prototype.clear=function(){this._queue.clear();var a=[];this._processingItems.forEach(function(b){return a.push(b.resultPromise)});this._processingItems.clear();a.forEach(function(a){return a.cancel()});a.length=0;this._apiPromises.forEach(function(b){return a.push(b)});
this._apiPromises.clear();a.forEach(function(a){return a.cancel()});this._cancelNext()};e.prototype.find=function(a,b){var c=this,d=void 0;this._apiPromises.forEach(function(e,g){a.call(b,g)&&(d=c._apiPromises.get(g).promise)});return d};e.prototype.get=function(a){return(a=this._apiPromises.get(a))&&a.promise||void 0};e.prototype.isOngoing=function(a){return this._processingItems.has(a)};e.prototype.has=function(a){return this._apiPromises.has(a)};e.prototype.pause=function(){this._isPaused||(this._isPaused=
!0,this._cancelNext())};e.prototype.push=function(b){var c=this;if(this._apiPromises.has(b))return this._apiPromises.get(b).promise;var e=a.createDeferred(function(a){var d=c._processingItems.get(b);d?d.resultPromise.cancel(a):(c._remove(b),c._scheduleNext())});this._add(b,e);this._scheduleNext();return e.promise};e.prototype.reset=function(){var a=[];this._processingItems.forEach(function(b){return a.push(b)});this._processingItems.clear();for(var b=0;b<a.length;b++){var e=a[b];e.resultPromise.isFulfilled()?
this._processReset(e):(e.isReset=!0,e.resultPromise.cancel())}};e.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())};e.prototype._scheduleNext=function(){var a=this;this._isPaused||this._scheduledNextHandle||(this._scheduledNextHandle=b.schedule(function(){a._scheduledNextHandle=null;a._next()}))};e.prototype._next=function(){for(;0<this._queue.length&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())};e.prototype._processResult=function(a,
b){this._remove(a.item);this._scheduleNext();a.dfd.resolve(b)};e.prototype._processError=function(a,b){a.isReset?this._processReset(a):(this._remove(a.item),this._scheduleNext(),a.dfd.reject(b))};e.prototype._processReset=function(a){this._remove(a.item);this._add(a.item,a.dfd);this._scheduleNext()};e.prototype._processOrdered=function(a,b){var c=this;if(a.isReset)this._processReset(a);else{a.result=b;var d=!1;this._processingItems.forEach(function(a){d||(a.result?c._itemsToProcess.push(a):d=!0)});
a=0;for(b=this._itemsToProcess;a<b.length;a++){var e=b[a];!1===e.result.ok?this._processError(e,e.result.error):this._processResult(e,e.result.value)}this._itemsToProcess.length=0}};e.prototype._process=function(a){var b=this;if(!k.isNone(a)){var c=this._apiPromises.get(a);this._pendingProcessing++;var e=this.process(a);this._pendingProcessing--;if(e&&"function"===typeof e.then){var g={item:a,resultPromise:e,result:null,dfd:c,isReset:!1};this._processingItems.set(a,g);this.ordered?e.then(function(a){return b._processOrdered(g,
{ok:!0,value:a})},function(a){return b._processOrdered(g,{ok:!1,error:a})}):e.then(function(a){return b._processResult(g,a)},function(a){return b._processError(g,a)})}else c.resolve(e),this._remove(a)}};e.prototype._add=function(a,b){this._apiPromises.set(a,b);this._queue.push(a)};e.prototype._remove=function(a){this._queue.remove(a);this._apiPromises.delete(a);this._processingItems.delete(a)};e.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=
null)};return e}()})},"esri/core/Queue":function(){define(["require","exports"],function(p,f){return function(){function f(a){this._items=[];this._itemSet=new Set;this._peeker=function(a){return a[0]};this._length=0;a&&a.peeker&&(this._peeker=a.peeker)}Object.defineProperty(f.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0});f.prototype.clear=function(){this._itemSet.clear();this._length=this._items.length=0};f.prototype.peek=function(){if(0!==this._length)return this._peeker(this._items)};
f.prototype.push=function(a){this.contains(a)||this._add(a)};f.prototype.contains=function(a){return 0<this._length&&this._itemSet.has(a)};f.prototype.pop=function(){if(0!==this._length){var a=this.peek();this._remove(a);return a}};f.prototype.remove=function(a){this.contains(a)&&this._remove(a)};f.prototype._add=function(a){this._items.push(a);this._itemSet.add(a);this._length++};f.prototype._remove=function(a){this._itemSet.delete(a);this._items.splice(this._items.indexOf(a),1);this._length--};
return f}()})},"esri/views/3d/layers/support/featureReference":function(){define(["require","exports","../../../../layers/graphics/dehydratedFeatures"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function g(a,e){this.highestResolutionVersion=null;this.versions=[];this.markedTile=null;this.ref(a,e)}Object.defineProperty(g.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isSingle",
{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,configurable:!0});g.prototype.ref=function(b,e){var c=this.feature;a.oldVersion=c;this.feature&&(e.uid=this.feature.uid);for(var d=0,g=this.versions;d<g.length;d++){var f=g[d];if(f.resolution===b){f.refCount++;if((b=this.highestResolutionVersion===f&&!k.equals(e,f.feature))||this.highestResolutionVersion!==f)f.feature=e;a.newVersion=b?e:c;return a}}f={feature:e,resolution:b,refCount:1};this.versions.push(f);
!this.highestResolutionVersion||b<this.highestResolutionVersion.resolution?(a.newVersion=e,this.highestResolutionVersion=f):a.newVersion=c;return a};g.prototype.unref=function(b){for(var e=0;e<this.versions.length;e++){var c=this.versions[e];if(c.resolution===b)return c.refCount--,a.oldVersion=this.feature,0===c.refCount&&(this.versions[e]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===c&&(this.recalculateHighestResolutionVersion(),a.oldVersion=c.feature)),
a.newVersion=this.feature,a}return null};Object.defineProperty(g.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0});g.prototype.recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{for(var a=this.versions[0],e=1;e<this.versions.length;e++){var c=this.versions[e];c.resolution<a.resolution&&(a=c)}this.highestResolutionVersion=a}};return g}();
f.MultiFeatureReference=p;p=function(){function g(a,e){this._feature=e;this.refCount=1;this.markedTile=null}Object.defineProperty(g.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0});g.prototype.ref=function(b,e){++this.refCount;a.oldVersion=this._feature;this.feature&&(e.uid=this.feature.uid);k.equals(this._feature,e)||(this._feature=
e);a.newVersion=this._feature;return a};g.prototype.unref=function(b){a.oldVersion=this._feature;if(0<this.refCount&&(this.refCount--,!this.isReferenced))return a.newVersion=null,a;a.newVersion=this._feature;return a};Object.defineProperty(g.prototype,"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0});return g}();f.SingleFeatureReference=p;var a={oldVersion:null,newVersion:null}})},"esri/views/3d/layers/support/FeatureTile":function(){define("require exports ../../../../core/arrayUtils ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ./FeatureTileFetcher3D".split(" "),
function(p,f,k,a,g,b){p=function(){function c(a){this.descriptor=a;this.fetchRequest=null;this.fetchStatus=0;this._features=null;this.featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=c.UNKNOWN_COUNT;this._emptyFeatureRatio=0;this.displayingFeatures=null;this.alive=!0;this.filtered=!1}Object.defineProperty(c.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0});c.prototype.setFeatures=function(a,b){this._features=a;this._shuffled=!1;a&&0<a.length?(this._emptyFeatureRatio=b/(a.length+b),this._numVertices=a.reduce(function(a,b){return a+g.numVertices(b.geometry)},0)):this._numVertices=this._emptyFeatureRatio=0};Object.defineProperty(c.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"numFeatures",{get:function(){return this._numFeatures!==c.UNKNOWN_COUNT?this._numFeatures:this._features?this._features.length:0},set:function(a){this._numFeatures=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasPreciseFeatureCount",{get:function(){return this._numFeatures!==c.UNKNOWN_COUNT},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"estimatedSize",{get:function(){var a=0;if(this._features)for(var b=0,c=this._features;b<c.length;b++)a+=g.estimateSize(c[b]);return a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"estimatedUnusedSize",{get:function(){var a=0;if(this._features)for(var b=this.featureLimit;b<this._features.length;++b)a+=
g.estimateSize(this._features[b]);return a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isFetching",{get:function(){return 2===this.fetchStatus||3===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isRefetching",{get:function(){return 3===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"needsFetching",{get:function(){return 0===this.fetchStatus||1===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"needsRefetching",{get:function(){return 1===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"needsDisplayUpdate",{get:function(){var a;if(a=!!this._features){a:{a=this._features;var b=this.displayingFeatures,c=this.featureLimit;if(!b||!a||c!==b.length||c>a.length)a=!1;else{for(var e=0;e<c;++e)if(a[e]!==b[e]){a=!1;break a}a=
!0}}a=!a}return a},enumerable:!0,configurable:!0});c.prototype.intersects=function(b){if(!b||!this.descriptor.extent)return!0;a.fromExtent(b,e);return a.intersects(this.descriptor.extent,e)};c.prototype.intersection=function(b,c){if(!b&&!this.descriptor.extent)return a.set(c,a.POSITIVE_INFINITY),c;b?(a.fromExtent(b,c),this.descriptor.extent&&a.intersection(c,this.descriptor.extent,c)):a.set(c,this.descriptor.extent);return c};c.prototype._shuffle=function(a){this._features.sort(function(c,d){return b.getFeatureId(c,
a)-b.getFeatureId(d,a)});k.shuffle(this._features,16438);this._shuffled=!0};c.prototype.reduceFeatures=function(a,b){if(0>=a)return!1;var c=!1;this._features?(this.featureLimit=Math.ceil(this.numFeatures*a),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&0<this._features.length&&(this.fetchStatus=1,c=!0)),!this._shuffled&&1>a&&this._shuffle(b)):this.featureLimit=0;return c};Object.defineProperty(c.prototype,"cacheItem",{get:function(){return{features:this.features,
numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},enumerable:!0,configurable:!0});c.prototype.loadCache=function(a){this.fetchRequest=null;this._features=a.features;this._numFeatures=a.numFeatures;this._emptyFeatureRatio=a.emptyFeatureRatio;this.fetchStatus=a.fetchStatus;this.featuresMissing=a.featuresMissing};return c}();(p||(p={})).UNKNOWN_COUNT=-1;var e=a.create();return p})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/operations/query".split(" "),
function(p,f,k,a,g,b,e,c){Object.defineProperty(f,"__esModule",{value:!0});var d=function(d){function g(){return null!==d&&d.apply(this,arguments)||this}k(g,d);Object.defineProperty(g.prototype,"queryFeaturesDehydrated",{get:function(){var a=this,b=this.layer.capabilities;if((b=b&&b.query)&&b.supportsFormatPBF){var d={type:"dehydrated",applyTransform:!0,useWorker:!0,maxStringAttributeLength:1024};return function(b,e){return c.executeQueryPBF(a.layer.parsedUrl,b,d,e).then(function(a){return a.data})}}return function(b,
d){return c.executeQuery(a.layer.parsedUrl,b,d).then(function(a){return e.fromFeatureSetJSON(a.data)})}},enumerable:!0,configurable:!0});a([b.property({constructOnly:!0})],g.prototype,"layer",void 0);a([b.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],g.prototype,"queryFeaturesDehydrated",null);return g=a([b.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],g)}(b.declared(g)),m=function(c){function d(){return null!==c&&c.apply(this,
arguments)||this}k(d,c);d.prototype.queryFeaturesDehydrated=function(a,b){var c=this;return this.source.queryFeaturesJSON(a).then(e.fromFeatureSetJSON,function(b){if(b&&"query-features-json:unsupported"===b.name)return c.source.queryFeatures(a);throw b;})};a([b.property({constructOnly:!0})],d.prototype,"layer",void 0);a([b.aliasOf("layer.source")],d.prototype,"source",void 0);return d=a([b.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],d)}(b.declared(g));f.createFeatureTileQuery3D=
function(a){switch(a.source.type){case "feature-layer":return new d({layer:a});case "memory":case "csv":return new m({layer:a});case "stream-layer":throw Error("Tile based queries unsupported for stream sources");}}})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("require exports ../../../../Graphic ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),
function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,"__esModule",{value:!0});var m=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];p=function(){function f(a,b,c){this.loadingGraphics=new Map;this.loadedGraphics=new Map;this.pendingGraphics=new Map;this._enabled=!0;this.tileFetcher=a;this.view=c;this.tilingScheme=
new d(b);this.loadedSymbols=m.map(function(a){return new e(new g({material:{color:[a[0],a[1],a[2],.6]},outline:{color:"black",size:1}}))});this.loadingSymbols=[new e(new g({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this.pendingSymbols=[new e(new g({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this.dataExtentSymbol=new e(new g({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}f.prototype.destroy=function(){this.enabled=!1};Object.defineProperty(f.prototype,
"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!0,configurable:!0});f.prototype.update=function(){var a=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(a){return a.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(a){return!a.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(a){return!a.isFetching},symbols:this.pendingSymbols}),
this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(function(b){a.view.graphics.removeMany(b)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))};f.prototype.showDataExtent=function(b){this.dataExtentGraphic&&
(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null);b&&(b=a.fromExtent(b),this.dataExtentGraphic=new k({geometry:b,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic))};f.prototype.synchronizeMaps=function(a,d){var e=this,g=[];a.forEach(function(a,b){var c=e.tileFetcher.getFeatureTileById(b);c&&d.filter(c)||(e.view.graphics.removeMany(a),g.push(b))});g.forEach(function(b){return a.delete(b)});this.tileFetcher.forEachFeatureTile(function(g){if(d.filter(g)&&
!a.has(g.id)){var f=g.descriptor.lij,h=f[0],l=f[1],m=f[2];e.tilingScheme.ensureMaxLod(h);var n=e.tilingScheme.getExtentGeometry(h,l,m),f=new k({geometry:n,symbol:d.symbols[h%d.symbols.length]}),h=new k({geometry:n.center,symbol:new b({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new c({text:h+"/"+l+"/"+m,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})}),h=[f,h];a.set(g.id,h);e.view.graphics.addMany(h)}})};return f}();
f.FeatureTileFetcher3DDebugger=p;f.default=p})},"esri/layers/graphics/controllers/support/controllerUtils":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.isRefreshable=function(f){return f&&f.refresh}})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/QueryEngine ../../../renderers/support/renderingInfoUtils ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./support/projectExtentUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u){return function(f){function r(a){a=f.call(this)||this;a.controller=null;a.asyncGraphicsUpdates=!1;a.suspendResumeExtentMode="computed";a.slicePlaneEnabled=!1;a.supportsDraping=!0;a.overlayUpdating=!1;a.fullExtentInLocalViewSpatialReference=null;a.suspendResumeExtent=null;a._queryEngine=null;a._controllerCreated=!1;a._controllerClientSideFiltering=!1;a.clippingExtent=null;a.supportsHeightUnitConversion=!0;a.pendingController=null;return a}k(r,f);r.prototype.initialize=
function(){var a=this;this._set("graphics3d",new t({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,asyncGraphicsUpdates:this.asyncGraphicsUpdates,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(b){return a.updateClippingExtent(b)}}));this.handles.add([this.watch("asyncGraphicsUpdates",function(b){a.graphics3d.graphicsCore.asyncUpdates=b}),this.watch("suspendResumeExtentMode",
function(b){a.graphics3d.suspendResumeExtentMode=b})]);this.drawingOrder=this.view.getDrawingOrder(this.layer.uid);this.addResolvingPromise(this.graphics3d.setup().then(function(){return a.validateGeometryType()}).then(function(){return u.toViewIfLocal(a)}).then(function(b){return a.fullExtentInLocalViewSpatialReference=b}).then(function(){return a.initializeController()}));this.notifyChange("updating")};r.prototype.destroy=function(){this.destroyPendingController();this.controller&&(this.controller.destroy(),
this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this.loadedGraphics=null};r.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)};Object.defineProperty(r.prototype,"drawingOrder",{set:function(a){this.graphics3d.graphicsCore.setDrawingOrder(a);this._set("drawingOrder",a)},enumerable:!0,configurable:!0});r.prototype.getRenderingInfo=function(a){if((a=n.getRenderingInfo(a,
{renderer:this.layer.renderer}))&&a.color){var b=a.color;b[0]/=255;b[1]/=255;b[2]/=255}return a};r.prototype.getGraphicFromGraphicUid=function(a){var b=this,d=null;this.loadedGraphics&&this.loadedGraphics.forEach(function(c){c.uid===a&&(d=l.hydrateGraphic(c,b.layer))});return null!==d?c.resolve(d):c.reject()};Object.defineProperty(r.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,
"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0});r.prototype.whenGraphicBounds=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(a,b):null};r.prototype.queryFeatures=function(a){return this._queryEngine?
this._queryEngine.queryFeatures(a):this._rejectQuery()};r.prototype.queryObjectIds=function(a){return this._queryEngine?this._queryEngine.queryObjectIds(a):this._rejectQuery()};r.prototype.queryFeatureCount=function(a){return this._queryEngine?this._queryEngine.queryFeatureCount(a):this._rejectQuery()};r.prototype.queryExtent=function(a){return this._queryEngine?this._queryEngine.queryExtent(a):this._rejectQuery()};r.prototype.highlight=function(a,b){void 0===b&&(b={});return this.graphics3d.highlight(a,
b,this.layer.objectIdField)};r.prototype.getStats=function(){var a=this.graphics3d.graphicsCore.getStats();a.features=this.loadedGraphics.length;a.updating=this.updating;a.elevationUpdating=this.graphics3d.elevationAlignment.updating;a.visibilityFrustum=!this.graphics3d.frustumVisibility.suspended;a.visibilityScale=!this.graphics3d.scaleVisibility.suspended;return a};r.prototype.canResume=function(){return!this.inherited(arguments)||this.graphics3d&&this.graphics3d.suspended?!1:!0};r.prototype.isUpdating=
function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!this._controllerCreated||this.controller&&this.controller.updating||this.overlayUpdating||!this.view.basemapTerrain||!this.view.basemapTerrain.ready||this.graphics3d.updating};r.prototype.initializeController=function(){return b(this,void 0,void 0,function(){var a;return g(this,function(b){switch(b.label){case 0:return[4,this.createController()];case 1:return this.pendingController=a=b.sent(),[4,a.when()];case 2:return b.sent(),this.setControllerWhenInitialized(a),
[2]}})})};r.prototype.setControllerWhenInitialized=function(a){return b(this,void 0,void 0,function(){return g(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),[4,this.when()];case 1:return b.sent(),[3,3];case 2:return b.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,d.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return b.sent(),this.pendingController=null,this.controller=
a,this.loadedGraphics=a.graphics,this._queryEngine=new h({layer:this.layer,features:this.loadedGraphics,objectIdField:this.layer.objectIdField,dataSpatialReference:this.view.spatialReference}),this.notifyChange("updating"),[2]}})})};r.prototype.updateClippingExtent=function(a){this.clippingExtent=a;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=a,!0}};r.prototype.validateGeometryType=function(){var a=this.layer;
switch(a.geometryType){case "multipatch":case "multipoint":return c.reject(new e("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:a.geometryType}))}};r.prototype._rejectQuery=function(){return c.reject(new e("featurelayerview3d:query","Not ready to execute query"))};a([m.property()],r.prototype,"loadedGraphics",void 0);a([m.property({dependsOn:["graphics3d.suspended"]})],r.prototype,"suspended",void 0);a([m.property({dependsOn:["graphics3d.updating",
"controller.updating","overlayUpdating"]})],r.prototype,"updating",void 0);a([m.property()],r.prototype,"controller",void 0);a([m.property()],r.prototype,"graphics3d",void 0);a([m.property({readOnly:!0})],r.prototype,"asyncGraphicsUpdates",void 0);a([m.property({readOnly:!0})],r.prototype,"suspendResumeExtentMode",void 0);a([m.property({type:Boolean})],r.prototype,"slicePlaneEnabled",void 0);a([m.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],r.prototype,"hasDraped",void 0);a([m.property({readOnly:!0,
type:Boolean})],r.prototype,"supportsDraping",void 0);a([m.property({type:Boolean})],r.prototype,"overlayUpdating",void 0);a([m.property()],r.prototype,"drawingOrder",null);return r=a([m.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],r)}(m.declared(q))})},"esri/layers/graphics/QueryEngine":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/Accessor ../../core/Error ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ./dehydratedFeatures ../../tasks/support/FeatureSet".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h){p=function(b){function f(a){a=b.call(this)||this;a.features=null;a.layer=null;a.objectIdField=null;a.dataSpatialReference=null;return a}k(f,b);f.prototype.queryFeatures=function(a){var b=this;return this._queryFeatures(a).then(function(a){a=a.map(function(a){return l.hydrateGraphic(a,b.layer)});return new h({features:a,fields:b.layer?b.layer.fields.slice():null,geometryType:b.layer?b.layer.geometryType:null,spatialReference:b.dataSpatialReference?b.dataSpatialReference.clone():
null})})};f.prototype.queryObjectIds=function(a){var b=this;return this.objectIdField?this.queryFeatures(a).then(function(a){return b._getObjectIds(a.features)}):this._rejectQuery("Unsupported query")};f.prototype.queryFeatureCount=function(a){return this.features&&!a?c.resolve(this.features.length):this._queryFeatures(a).then(function(a){return a.length})};f.prototype.queryExtent=function(a){var b=this;return this.queryFeatures(a).then(function(a){return{count:a.features.length,extent:b._getExtent(a.features)}})};
f.prototype._queryFeatures=function(a){if(this.features){if(a){if(this._isSupportedQuery(a)){var b=this._createFilters(a);return b.length?this._executeQuery(a,b):this._rejectQuery("Invalid query")}return this._rejectQuery("Unsupported query")}return this._returnAllFeatures()}return this._rejectQuery("Engine not initialized")};f.prototype._returnAllFeatures=function(){return c.resolve(this.features.toArray())};f.prototype._executeQuery=function(a,b){var d=this,e=[];this.features.forEach(function(c){b.every(function(b){return b.call(d,
c,a)})&&e.push(c)});return c.resolve(e)};f.prototype._isSupportedQuery=function(a){var b=!0;if(null!=a.distance||null!=a.geometryPrecision||a.groupByFieldsForStatistics&&a.groupByFieldsForStatistics.length||null!=a.maxAllowableOffset||a.multipatchOption||null!=a.num||a.orderByFields&&a.orderByFields.length||a.outFields&&a.outFields.length||a.outSpatialReference||a.outStatistics&&a.outStatistics.length||a.pixelSize||a.quantizationParameters||a.relationParameter||a.returnDistinctValues||null!=a.start||
a.text||a.timeExtent||a.where||a.objectIds&&a.objectIds.length&&!this.objectIdField)b=!1;return b};f.prototype._createFilters=function(a){var b=[];a.objectIds&&a.objectIds.length&&b.push(this._createObjectIdFilter());a.geometry&&"extent"===a.geometry.type&&"intersects"===a.spatialRelationship&&b.push(this._createExtentFilter());return b};f.prototype._createExtentFilter=function(){return function(a,b){a=a.geometry;if(!a)return!1;m.fromExtent(b.geometry,n);l.computeAABR(a,q);return m.intersects(n,q)}};
f.prototype._createObjectIdFilter=function(){var a=this;return function(b,c){b=b.attributes;return-1<c.objectIds.indexOf(b&&b[a.objectIdField])}};f.prototype._rejectQuery=function(a){return c.reject(new e(this.declaredClass,a))};f.prototype._getObjectIds=function(a){var b=this.objectIdField,c=[];a.forEach(function(a){a=(a=a.attributes)&&a[b];null!=a&&c.push(a)});return c};f.prototype._getExtent=function(a){if(0===a.length)return null;m.empty(n);for(var b=0;b<a.length;b++)l.computeAABR(a[b].geometry,
q),m.expand(n,q,n);return new g.Extent({xmin:n[0],ymin:n[1],xmax:n[2],ymax:n[3],spatialReference:a[0].geometry.spatialReference})};a([d.property()],f.prototype,"features",void 0);a([d.property({constructOnly:!0})],f.prototype,"layer",void 0);a([d.property()],f.prototype,"objectIdField",void 0);a([d.property()],f.prototype,"dataSpatialReference",void 0);return f=a([d.subclass("esri.layers.graphics.QueryEngine")],f)}(d.declared(b));var n=m.create(),q=m.create();return p})},"esri/renderers/support/renderingInfoUtils":function(){define(["require",
"exports"],function(p,f){function k(a,b){if(!a||a.symbol)return null;b=b.renderer;return a&&b&&b.getObservationRenderer?b.getObservationRenderer(a):b}function a(a,b){if(a.symbol)return a.symbol;var e=k(a,b);return e&&e.getSymbol(a,b)}Object.defineProperty(f,"__esModule",{value:!0});f.getRenderer=k;f.getSymbol=a;f.getRenderingInfo=function(g,b){var e=k(g,b),c=a(g,b);if(!c)return null;c={renderer:e,symbol:c};if(!(e&&"visualVariables"in e&&e.visualVariables))return c;var d=["proportional","proportional",
"proportional"],f=0;for(g=e.getVisualVariableValues(g,b);f<g.length;f++){e=g[f];b=e.variable;var l=e.value;"color"===b.type?c.color=l.toRgba():"size"===b.type?"outline"===b.target?c.outlineSize=l:(e=b.axis,b=b.useSymbolValue?"symbolValue":l,"width"===e?d[0]=b:"depth"===e?d[1]=b:"height"===e?d[2]=b:d[0]="width-and-depth"===e?d[1]=b:d[1]=d[2]=b):"opacity"===b.type?c.opacity=l:"rotation"===b.type&&"tilt"===b.axis?c.tilt=l:"rotation"===b.type&&"roll"===b.axis?c.roll=l:"rotation"===b.type&&(c.heading=
l)}if(isFinite(d[0])||isFinite(d[1])||isFinite(d[2]))c.size=d;return c}})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../Graphic ../../../../core/Accessor ../../../../core/compilerUtils ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/diffUtils ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DHighlights ./Graphics3DScaleVisibility ./Graphics3DSpatialIndex ./graphicUtils ../support/attributeUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C){return function(b){function f(a){a=b.call(this)||this;a._handles=new c;a.highlights=new x;a.suspendResumeExtentMode="computed";a.dataExtent=null;a.suspendResumeExtent=null;return a}k(f,b);Object.defineProperty(f.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updating",
{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0});f.prototype.normalizeCtorArgs=function(a){var b=a.queryGraphicUIDsInExtent||!a.scaleVisibilityEnabled&&!a.elevationAlignmentEnabled?null:new w({spatialReference:a.owner.view.spatialReference}),c=a.frustumVisibilityEnabled?new y:null,d=a.scaleVisibilityEnabled?new z:null,e=a.elevationAlignmentEnabled?
new r:null,g=function(a,c,d){return b.queryGraphicUIDsInExtent(a,c,d)};return{graphicsCore:new u({owner:a.owner,layer:a.layer,asyncUpdates:a.asyncGraphicsUpdates,basemapTerrain:a.owner.view.basemapTerrain,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1}),frustumVisibility:c,scaleVisibility:d,elevationAlignment:e,spatialIndex:b,updateClippingExtent:a.updateClippingExtent,suspendResumeExtentMode:a.suspendResumeExtentMode,dataExtent:a.dataExtent,queryGraphicUIDsInExtent:a.queryGraphicUIDsInExtent||
g}};f.prototype.initialize=function(){var a=this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()}));this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(b,c){n.diff(b,c)&&a.graphicsCore.elevationInfoChange()}));this.graphicsCore&&(this._handles.add(this.layer.watch("labelsVisible",function(){return a.graphicsCore.updateVisibilityInfo()})),this._handles.add(this.layer.watch("labelingInfo",
function(b,c){n.diff(b,c)&&a.graphicsCore.updateLabelingInfo()})));this.idleClients=[this.frustumVisibility,this.scaleVisibility,this.graphicsCore,this.elevationAlignment]};f.prototype.setup=function(){var a=this;this.frustumVisibility&&this.frustumVisibility.setup(this.owner);var b=this.owner.view.basemapTerrain,c=this.owner.view.elevationProvider;this.scaleVisibility&&this.scaleVisibility.setup(this.owner,this.layer,this.queryGraphicUIDsInExtent,this.graphicsCore,b);this.elevationAlignment&&this.elevationAlignment.setup(this.owner,
this.queryGraphicUIDsInExtent,this.graphicsCore,c);this.highlights&&this.highlights.setup(this.graphicsCore);this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility,this.spatialIndex));this._set("deconfliction",this.owner.view.deconflictor.addGraphicsOwner(this.graphicsCore));this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,spatialIndex:this.spatialIndex,deconfliction:this.deconfliction,labeling:this.labeling,
highlights:this.highlights});this._handles.add([this.layer.watch("renderer",function(b){return a.graphicsCore.rendererChange(b)}),this.owner.watch("fullOpacity",function(){return a.graphicsCore.opacityChange()})]);this._handles.add(this.layer.on("graphic-update",function(b){return a.graphicsCore.graphicUpdateHandler(b)}));this.setupSuspendResumeExtent();this._handles.add(this.owner.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a.needsIdleUpdate()},idleFrame:function(b){return a.idleUpdate(b)}}));
this.updateClippingExtent&&(this._handles.add(this.owner.view.watch("clippingArea",function(){return a._updateClippingExtent()})),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();return this.graphicsCore.labelsEnabled?this.graphicsCore.updateLabelingInfo():d.resolve()};f.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null));this.scaleVisibility&&(this.scaleVisibility.destroy(),
this._set("scaleVisibility",null));this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",null));this.graphicsCore&&(this.graphicsCore.destroy(),this._set("graphicsCore",null));this.spatialIndex&&(this.spatialIndex.destroy(),this._set("spatialIndex",null));this.highlights&&(this.highlights.destroy(),this._set("highlights",null));this._set("layer",null);this._set("owner",null)};f.prototype.highlight=function(a,b,c){var d=this;if(a instanceof q){b=this.highlights.acquireSet(b,
c);var e=b.set,f=b.handle;this.owner.queryObjectIds(a).then(function(a){return d.highlights.setObjectIds(e,a)});return f}if("number"===typeof a||a instanceof g)return this.highlight([a],b,c);"toArray"in a&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof g)if(f=a,c&&f[0].attributes&&null!==C.attributeLookup(f[0].attributes,c))a=f.map(function(a){return C.attributeLookup(a.attributes,c)});else return a=f.map(function(a){return a.uid}),f=this.highlights.acquireSet(b,null),b=f.set,
f=f.handle,this.highlights.setUids(b,a),f;if("number"===typeof a[0])return f=this.highlights.acquireSet(b,c),b=f.set,f=f.handle,this.highlights.setObjectIds(b,a),f}return{remove:function(){}}};f.prototype.needsIdleUpdate=function(){for(var a=0,b=this.idleClients;a<b.length;a++){var c=b[a];if(c&&c.needsIdleUpdate())return!0}return!1};f.prototype.idleUpdate=function(a){for(var b=0,c=this.idleClients;b<c.length;b++){var d=c[b];if(d&&d.needsIdleUpdate()&&(d.idleUpdate(a),a.done()))break}};f.prototype._updateClippingExtent=
function(){var a=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||this.graphicsCore.recreateAllGraphics())};f.prototype.setupSuspendResumeExtent=function(){var a=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(m.init(this,"suspendResumeExtentMode",function(b){a._handles.remove("suspendResumeExtentMode");switch(a.suspendResumeExtentMode){case "computed":a._handles.add(m.init(a.graphicsCore,"computedExtent",
function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;case "data":a._handles.add(m.init(a,"dataExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;default:e.neverReached(a.suspendResumeExtentMode)}}))};f.prototype.updateSuspendResumeExtent=function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};f.prototype.extentToSuspendResumeRect=function(a,
b){var c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!h.canProject(a,c))return;a=h.project(a,c)}return B.enlargeExtent(a,b,t.SUSPEND_RESUME_EXTENT_OPTIMISM)};f.prototype.suspendResumeExtentChanged=function(a){this.frustumVisibility&&this.frustumVisibility.setExtent(a);this.scaleVisibility&&this.scaleVisibility.setExtent(a)};a([l.property({aliasOf:"graphicsCore.layer"})],f.prototype,"layer",void 0);a([l.property({aliasOf:"graphicsCore.owner"})],f.prototype,"owner",void 0);
a([l.property({constructOnly:!0})],f.prototype,"updateClippingExtent",void 0);a([l.property({constructOnly:!0})],f.prototype,"queryGraphicUIDsInExtent",void 0);a([l.property({constructOnly:!0})],f.prototype,"graphicsCore",void 0);a([l.property({constructOnly:!0})],f.prototype,"spatialIndex",void 0);a([l.property({constructOnly:!0})],f.prototype,"scaleVisibility",void 0);a([l.property({constructOnly:!0})],f.prototype,"elevationAlignment",void 0);a([l.property({constructOnly:!0})],f.prototype,"frustumVisibility",
void 0);a([l.property({readOnly:!0})],f.prototype,"deconfliction",void 0);a([l.property({readOnly:!0})],f.prototype,"labeling",void 0);a([l.property({readOnly:!0})],f.prototype,"highlights",void 0);a([l.property()],f.prototype,"suspendResumeExtentMode",void 0);a([l.property()],f.prototype,"dataExtent",void 0);a([l.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],f.prototype,"suspended",null);a([l.property({readOnly:!0,dependsOn:["graphicsCore.updating",
"frustumVisibility.updating","scaleVisibility.updating"]})],f.prototype,"updating",null);return f=a([l.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],f)}(l.declared(b))})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry ../../../../renderers ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/Logger ../../../../core/now ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/diffUtils ../../../../renderers/support/rendererConversion ../../../../symbols/support/symbolConversion ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DGraphic ./Graphics3DOwner ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./graphicUtils ./symbolComplexity ../../support/mathUtils ../../support/projectionUtils ../../support/PropertiesPool ../../webgl-engine/Stage ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/Layer".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H,I,N,S,M,P,O,W,Q,J,F,K,L,T,R,X,ba,ca){var Z=new e.Point,da=C.vec3f64.create(),U=D.create(),ia=u.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");p=function(f){function m(a){a=f.call(this)||this;a.propertiesPool=new R.PropertiesPool({computedExtent:e.Extent},a);a.computedExtent=null;a.symbolCreationContext=new W.Graphics3DSymbolCreationContext;a.graphics=new Map;a.stageLayer=null;a.stage=null;a.graphicsDrapedUids=new Set;a.graphicsBySymbol=
new Map;a.symbolConversionCache=new Map;a.symbols=new Map;a.graphicsWithoutSymbol={};a.graphicsWaitingForSymbol=new Set;a.lastFastUpdate=null;a.handles=new q;a.viewSR=null;a.elevationAlignment=null;a.scaleVisibility=null;a.spatialIndex=null;a.deconfliction=null;a.labeling=null;a.highlights=null;a.viewElevationProvider=null;a.sharedSymbolResourcesOwnerHandle=null;a.whenGraphics3DGraphicRequests={};a.pendingUpdates=new Map;a.pendingAdds=0;a.pendingRemoves=0;a.pendingUpdatesPool=new x({allocator:function(a){return a||
{add:null,remove:null}},deallocator:function(a){a.add=null;a.remove=null;return a}});a.symbolWarningLogged=!1;a.geometryWarningLogged=!1;a._whenSymbolRemoved=[];a.asyncUpdates=!1;a.elevationFeatureExpressionEnabled=!0;a.owner=null;a.layer=null;a.hasDraped=!1;a.graphicSymbolSupported=!0;a._usedMemory=0;a.numberOfGraphics=0;a._visible=void 0;a._startCreateGraphics=!1;a.maxPendingUpdates=0;return a}k(m,f);u=m;Object.defineProperty(m.prototype,"updating",{get:function(){return!!(0<this.graphicsWaitingForSymbol.size||
this.needsIdleUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"updatingRemaining",{get:function(){return this.updating?this.pendingUpdates.size:0},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"updatingTotal",{get:function(){return this.updating?this.maxPendingUpdates:0},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"displayFeatureLimit",
{get:function(){var a=this.owner&&this.owner.view&&this.owner.view.qualitySettings,b=a?a.graphics3D.minTotalNumberOfFeatures:0,c=a?a.graphics3D.maxTotalNumberOfFeatures:0,a=a?a.graphics3D.maxTotalNumberOfPrimitives:0,d=this.maxSymbolComplexity,e=Math.max(b,Math.min(c,Math.ceil(a/Math.max(1,d?d.primitivesPerFeature:1)))),g=this._get("displayFeatureLimit");return g&&g.minimumTotalNumberOfFeatures===b&&g.maximumTotalNumberOfFeatures===c&&g.maximumTotalNumberOfPrimitives===a&&g.maximumSymbolComplexity===
d&&g.maximumNumberOfFeatures===e?g:{minimumTotalNumberOfFeatures:b,maximumTotalNumberOfFeatures:c,maximumTotalNumberOfPrimitives:a,maximumSymbolComplexity:d,maximumNumberOfFeatures:e}},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"maxSymbolComplexity",{get:function(){for(var a=null,b=0,c=this.getSymbolComplexities();b<c.length;b++){var d=c[b];a?0===a.primitivesPerCoordinate&&d.primitivesPerFeature>a.primitivesPerFeature?a=d:0!==a.primitivesPerCoordinate&&d.primitivesPerCoordinate>
a.primitivesPerCoordinate&&(a=d):a=d}b=this._get("maxSymbolComplexity");return!a||b&&b.primitivesPerFeature===a.primitivesPerFeature&&b.primitivesPerCoordinate===a.primitivesPerCoordinate?b:a},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"usedMemory",{get:function(){return this._usedMemory},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"usedMemoryPerGraphic",{get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:
this.maxSymbolComplexity?this.maxSymbolComplexity.memory.bytesPerFeature:0},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"unprocessedMemoryEstimate",{get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)},enumerable:!0,configurable:!0});m.prototype.getSymbolComplexities=function(){return this.layer.renderer?this.getSymbolComplexitiesUsedOrRenderer(this.layer.renderer):this.getSymbolComplexitiesUsed()};m.prototype.getConvertedSymbol=
function(a){if("web-style"===a.type)return a.clone();var b=this.symbolConversionCache.get(a.id);if(void 0!==b)return b;var b=S.to3D(a,!0,!1,this.hasLabelingContext(a)),c=b.symbol||null;c||b.error&&ia.error(b.error.message);this.symbolConversionCache.set(a.id,c);return c};m.prototype.getSymbolComplexitiesUsedOrRenderer=function(a){a=a.getSymbols();if(!a||!a.length)return[];for(var b=[],c=0;c<a.length;c++){var d=a[c],e=this.symbols.get(d.id);e?b.push(e.complexity):(d=this.getConvertedSymbol(d))&&b.push(K.defaultSymbolComplexity(d))}return b};
m.prototype.getSymbolComplexitiesUsed=function(){var a=[];this.symbols.forEach(function(b){b&&a.push(b.complexity)});return a};m.prototype.initialize=function(){this.viewSR=this.owner.view.spatialReference};m.prototype.setup=function(a){var b=this;this._set("elevationAlignment",a.elevationAlignment);this._set("scaleVisibility",a.scaleVisibility);this._set("spatialIndex",a.spatialIndex);this._set("deconfliction",a.deconfliction);this._set("labeling",a.labeling);this._set("highlights",a.highlights);
var c=this.owner.view;this.viewElevationProvider=new M.ViewElevationProvider(this.viewSR,c);this.initializeStage(c,this.layer.uid);this.symbolCreationContext.sharedResources=c.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=c.sharedSymbolResources.addGraphicsOwner(this.owner);this.symbolCreationContext.renderer=this.layer.renderer;this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataSupplier=c.sharedSymbolResources.streamDataSupplier;this.symbolCreationContext.renderSpatialReference=
c.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=c.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.layerView=this.owner;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=new ba;this.symbolCreationContext.elevationProvider=c.elevationProvider;a=P.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=P.createContext(a,
this.viewSR,ia);c.deconflictor.addGraphicsOwner(this);this.symbolCreationContext.screenSizePerspectiveEnabled=c.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.handles.add(this.owner.watch("suspended",function(){return b.updateLayerVisibility()}));this.handles.add([this.owner.watch("layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled",
function(){var a=c.screenSizePerspectiveEnabled&&b.layer.screenSizePerspectiveEnabled;a!==b.symbolCreationContext.screenSizePerspectiveEnabled&&(b.symbolCreationContext.screenSizePerspectiveEnabled=a,b.recreateAllGraphics())}),this.owner.watch("slicePlaneEnabled",function(a){return b.slicePlaneEnabledChange(!!a)}),this.owner.watch("layer.featureReduction",function(){b.deconfliction.featureReductionChange()})]);this.handles.add(w.when(c.basemapTerrain,"tilingScheme",function(a){a.spatialReference.equals(b.symbolCreationContext.overlaySR)||
(b.symbolCreationContext.overlaySR=b.basemapTerrain.spatialReference);b.handles.has("loaded-graphics")?b.recreateAllGraphics():b.handles.add(w.on(b.owner,"loadedGraphics","change",function(a){return b.graphicsCollectionChanged(a)},function(){return b.recreateAllGraphics()}),"loaded-graphics")}));this.validateRenderer(this.layer.renderer);this.notifyChange("maxSymbolComplexity")};m.prototype.destroy=function(){this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);
this.clear();this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(X.ModelContentType.LAYER,this.stageLayer.id),this.stage=this.stageLayer=null);this.handles.destroy();this.viewSR=this.handles=null;this._set("owner",null);for(var a in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[a].reject(new n("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),
this.sharedSymbolResourcesOwnerHandle=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null);this.pendingUpdatesPool=null;this.symbolConversionCache.clear()};m.prototype.clear=function(){this.graphics.forEach(function(a){return a.destroy()});this.spatialIndex&&this.spatialIndex.clear();this.graphics.clear();this._usedMemory=this.numberOfGraphics=0;this.updateLayerVisibility();this.symbols.forEach(function(a){a&&a.destroy()});this.symbols.clear();this.graphicsBySymbol.clear();
this.graphicsWithoutSymbol={};this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this.pendingRemoves=this.pendingAdds=this.maxPendingUpdates=0;this._set("hasDraped",!1);this.notifyChange("updating");this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};m.prototype.initializeStage=function(a,b){this.stage=a._stage;this.stageLayer=new ca(b,{isPickable:!this.owner.suspended},b);this.stage.add(X.ModelContentType.LAYER,this.stageLayer);
this.stage.addToViewContent([this.stageLayer.id])};m.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=a;var b=new Set;this.symbols.forEach(function(c){c&&c.setDrawOrder(a,b)});0<b.size&&this.stage.getDrapedTextureRenderer().updateRenderOrder(b)};m.prototype.updateLayerVisibility=function(){var a=this.numberOfGraphics>this.displayFeatureLimit.maximumNumberOfFeatures*fa,a=!this.owner.suspended&&!a;a!==this._visible&&((this._visible=a)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):
(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())};m.prototype.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};Object.defineProperty(m.prototype,"graphics3DGraphics",{get:function(){return this.graphics},enumerable:!0,configurable:!0});m.prototype.getGraphics3DGraphicById=function(a){return this.graphics.get(a)};Object.defineProperty(m.prototype,"graphics3DGraphicsByObjectID",{get:function(){var a=
this.owner.layer&&this.owner.layer.objectIdField;if(!a)return null;var b=new Map;this.graphics.forEach(function(c){if(c){var d=c.graphic,d=d.attributes&&d.attributes[a];null!=d&&b.set(d,c)}});return b},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"labelsEnabled",{get:function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},enumerable:!0,configurable:!0});m.prototype.updateLabelingInfo=function(a){this.deconfliction&&this.deconfliction.labelingInfoChange();return this.labeling&&
this.labeling.labelingInfoChange(a)};m.prototype.updateVisibilityInfo=function(){this.deconfliction&&this.deconfliction.labelingInfoChange();return this.labeling&&this.labeling.visibilityInfoChange()};Object.defineProperty(m.prototype,"symbolUpdateType",{get:function(){var a=this;if(0<this.pendingUpdates.size)return"unknown";var b=0,c=0;return t.everyMap(this.symbols,function(d,e){if(d){d=d.getFastUpdateStatus();if(0<d.loading)return!1;a.graphicsBySymbol.has(e)&&(c+=d.fast,b+=d.slow)}})?0<=c&&0===
b?"fast":0<=b&&0===c?"slow":"mixed":"unknown"},enumerable:!0,configurable:!0});m.prototype.needsIdleUpdate=function(){return 0<this.pendingUpdates.size?!0:!!this.lastFastUpdate&&500<r()-this.lastFastUpdate};m.prototype.idleUpdate=function(a){var b=this.needsIdleUpdate();this._applyPendingUpdates(a);!a.done()&&this.lastFastUpdate&&(this.lastFastUpdate=null);a=this.needsIdleUpdate();b!==a&&this.notifyChange("updating")};m.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics.get(a.uid);if(b)return z.resolve(b);
if(b=this.whenGraphics3DGraphicRequests[a.uid])return b.promise;b=z.createDeferred();this.whenGraphics3DGraphicRequests[a.uid]=b;return b.promise};m.prototype.boundsForGraphics3DGraphic=function(a,c){return b(this,void 0,void 0,function(){var b,d,e,f,h,k,l,m,n,r;return g(this,function(g){switch(g.label){case 0:return b=this.owner.view.spatialReference,d=this.owner.view.renderSpatialReference,e=this.owner.view.basemapTerrain.spatialReference,f=function(a,c,e){return T.bufferToBuffer(a,d,c,a,b,c,e)},
h=function(a,c,d){return T.bufferToBuffer(a,e,c,a,b,c,d)},k=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:c&&c.useViewElevation,minDemResolution:c&&c.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,[4,a.getProjectedBoundingBox(f,h,k)];case 1:l=g.sent();if(!l)return[2,null];m=l.boundingBox;l.requiresDrapedElevation&&(n=this.symbolCreationContext.elevationProvider)&&(D.center(m,da),Z.x=da[0],Z.y=da[1],Z.z=void 0,Z.spatialReference=b,r=n.getElevation(Z)||
0,m[2]=Math.min(m[2],r),m[5]=Math.max(m[5],r));return[2,{boundingBox:m,screenSpaceObjects:l.screenSpaceObjects}]}})})};m.prototype.whenGraphicBounds=function(a,b){var c=this;return w.whenOnce(this.owner,"loadedGraphics").then(function(){var b=c.owner.layer&&c.owner.layer.objectIdField,d=c.owner.loadedGraphics.find(function(c){return c===a?!0:b&&c.attributes&&a.attributes&&c.attributes[b]===a.attributes[b]});if(d)return c.whenGraphics3DGraphic(d);throw new n("internal:graphic-not-part-of-view","Graphic is not part of this view");
}).then(function(a){return c.boundsForGraphics3DGraphic(a,b)})};m.prototype.graphicsCollectionChanged=function(a){this._startCreateGraphics&&(this.add(a.added),this.remove(a.removed))};m.prototype.graphicUpdateHandler=function(a){var b=this.graphics.get(a.graphic.uid);if(b)switch(a.property){case "visible":this.graphicUpdateVisible(b,a);break;case "geometry":case "attributes":case "symbol":this.recreateGraphic(b);break;default:h.neverReached(a)}};m.prototype.graphicUpdateVisible=function(a,b){(a=
a.setVisibilityFlag(0,b.newValue))&&this.labeling&&(this.lastFastUpdate=r(),this.owner.view.labeler.setDirty());a&&this.owner.view.deconflictor.setDirty()};m.prototype.recreateGraphic=function(a){a=[a.graphic];this.remove(a);this.add(a)};m.prototype._beginGraphicUpdate=function(a){this.graphicsWaitingForSymbol.add(a.uid);1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating");this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)};m.prototype._endGraphicUpdate=function(a){a&&
(this.graphicsWaitingForSymbol.delete(a.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))};m.prototype.expandComputedExtent=function(a){var b=a.spatialReference;H.computeAABB(a,U);a=this.viewSR;var c=u.tmpVec;!b.equals(a)&&T.xyzToVector(U[0],U[1],0,b,c,a)&&(U[0]=c[0],U[1]=c[1],T.xyzToVector(U[3],U[4],0,b,c,a),U[3]=c[0],U[4]=c[1]);if(L.isFinite(U[0])&&
L.isFinite(U[3])&&L.isFinite(U[1])&&L.isFinite(U[4])){var b=this.computedExtent,c=null,d=L.isFinite(U[2])&&L.isFinite(U[5]),e=d&&(!b||null==b.zmin||U[2]<b.zmin),d=d&&(!b||null==b.zmax||U[5]>b.zmax);if(b){if(U[0]<b.xmin||U[1]<b.ymin||U[3]>b.xmax||U[4]>b.ymax||e||d)c=this.propertiesPool.get("computedExtent"),c.xmin=Math.min(U[0],b.xmin),c.ymin=Math.min(U[1],b.ymin),c.xmax=Math.max(U[3],b.xmax),c.ymax=Math.max(U[4],b.ymax),c.spatialReference=a}else c=this.propertiesPool.get("computedExtent"),c.xmin=
U[0],c.ymin=U[1],c.xmax=U[3],c.ymax=U[4],c.spatialReference=a;c&&(e&&(c.zmin=U[2]),d&&(c.zmax=U[5]),this._set("computedExtent",c))}};m.prototype.updateHasDraped=function(){this._set("hasDraped",0<this.graphicsDrapedUids.size)};m.prototype.elevationInfoChange=function(){var a=this,b=P.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=P.createContext(b,this.viewSR,ia);this.labeling&&this.labeling.elevationInfoChange();
this.layer.renderer!==this.symbolCreationContext.renderer&&this.rendererChange(this.layer.renderer);this.forEachGraphics3DSymbol(function(b,c,d){if(b.layerPropertyChanged("elevationInfo",c))for(var e in c){d=c[e];b=d.graphic;d=d._labelGraphics;for(var g=0;g<d.length;g++){var f=d[g];f.graphics3DSymbolLayer.updateGraphicElevationContext(b,f)}}else a._recreateSymbol(d)});this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()};m.prototype.clearSymbolsAndGraphics=function(){this.clear();
this.labeling&&this.labeling.reset();this.deconfliction&&this.deconfliction.clear();this.elevationAlignment&&this.elevationAlignment.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()};m.prototype.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};m.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=
this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};m.prototype._recreateSymbol=function(a){var b=this,c=[],d=[];this.graphicsBySymbol.get(a).forEach(function(a,e){var g=a.usedMemory;a.isDraped()&&b.graphicsDrapedUids.delete(e);b.labeling&&b.labeling.removeGraphic(a);b.deconfliction&&
b.deconfliction.removeGraphic(a);b.spatialIndex&&c.push(a);d.push(a.graphic);a.destroy();b.removeGraphics3DGraphic(e,g);b.updateLayerVisibility()});0<c.length&&this.spatialIndex.removeMany(c);this.graphicsBySymbol.set(a,new Map);var e=this.symbols.get(a);e&&e.destroy();this.symbols.delete(a);this.updateHasDraped();this.add(d)};m.prototype.add=function(a){this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this.asyncUpdates?this._addDelayed(a):this._addImmediate(a),this.notifyChange("updating")):
ia.error("#add()","Cannot add graphics before terrain surface has been initialized")};m.prototype._addImmediate=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;ea.clear();for(var c=0;c<a.length;c++)this._startAddGraphic(a[c],ea);ea.forEach(function(a){return b._finishAddGraphics(a)});ea.clear();this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty();this._cleanupSymbols()};m.prototype._addDelayed=function(a){for(var b=0;b<a.length;b++){var c=
a[b],d=c.uid,e=this.pendingUpdates.get(d);e?(e.add||this.pendingAdds++,e.add=c):(e=this.pendingUpdatesPool.pushNew(),e.add=c,this.pendingAdds++,this.pendingUpdates.set(d,e))}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};m.prototype.remove=function(a){this.asyncUpdates?this._removeDelayed(a):this._removeImmediate(a);this.notifyChange("updating")};m.prototype._removeImmediate=function(a){for(var b=
0;b<a.length;b++)this._removeGraphic(a[b]);this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty()};m.prototype._removeDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add&&(e.remove?e.add=null:this.pendingUpdates.delete(d),this.pendingAdds--):(e=this.pendingUpdatesPool.pushNew(),e.remove=c,this.pendingUpdates.set(d,e),this.pendingRemoves++)}0===this.pendingUpdates.size&&this._finishPendingUpdates();this.maxPendingUpdates=
Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};m.prototype._finishPendingUpdates=function(){this.pendingUpdatesPool.clear();this.maxPendingUpdates=0;this._cleanupSymbols();(this.pendingAdds||this.pendingRemoves)&&ia.warn("pendingAdds/Removes in inconsistent state!");this.pendingRemoves=this.pendingAdds=0};m.prototype._applyPendingUpdates=function(a){var b=this;if(!a.done()){this.symbolWarningLogged=this.geometryWarningLogged=
!1;var c=0;ea.clear();t.everyMap(this.pendingUpdates,function(d,e){if(a.done())return!1;d.remove&&(b.pendingRemoves--,b._removeGraphic(d.remove));d.add&&(b.pendingAdds--,b._startAddGraphic(d.add,ea)&&c++);b.pendingUpdates.delete(e);1E3<c&&(ea.forEach(function(a){return b._finishAddGraphics(a)}),ea.clear(),c=0)});ea.forEach(function(a){return b._finishAddGraphics(a)});ea.clear();0===this.pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");
this.updateHasDraped()}};m.prototype._startAddGraphic=function(a,b){this.graphicsWithoutSymbol[a.uid]=a;var c=this._getRenderingInfo(a,ia);if(!c)return!1;var d=this.getOrCreateGraphics3DSymbol(c.symbol,c.renderer);if(!d)return!1;this.expandComputedExtent(a.geometry);this._beginGraphicUpdate(a);a={graphic:a,renderingInfo:c,layer:this.layer};var c=d.symbol.id,e=b.get(c);e?e.graphics.push(a):(e=ga.acquire(),e.clear(),e.push(a),b.set(c,{asyncSymbol:d,graphics:e}));return!0};m.prototype._finishAddGraphics=
function(a){var b=this,c=!1,d=function(b){b===a.asyncSymbol.symbol.id&&(c=!0)};this._whenSymbolRemoved.push(d);a.asyncSymbol.then(function(){l.removeUnordered(b._whenSymbolRemoved,d);aa.clear();for(var e=0;e<a.graphics.length;e++){var g=a.graphics.data[e],f=g.graphic;c||a.asyncSymbol.destroyed||(b.graphicsWaitingForSymbol.has(f.uid)&&(g=b.createGraphics3DGraphic(a.asyncSymbol,g),b.spatialIndex&&g&&aa.push(g)),b._endGraphicUpdate(f));--a.asyncSymbol.referenced}0<aa.length&&(b.spatialIndex.addMany(aa.data,
aa.length),aa.clear());a.graphics.clear();ga.release(a.graphics);b.labeling&&(b.lastFastUpdate=r(),b.owner.view.labeler.setDirty())},function(){l.removeUnordered(b._whenSymbolRemoved,d);if(!c&&!a.asyncSymbol.destroyed)for(var e=0;e<a.graphics.length;e++)b._endGraphicUpdate(a.graphics.data[e].graphic);a.graphics.clear();ga.release(a.graphics)})};m.prototype._removeGraphic=function(a){a=a.uid;var b=this.graphics.get(a);if(b){var c=b.usedMemory;b.isDraped()&&this.graphicsDrapedUids.delete(a);this.deconfliction&&
this.deconfliction.removeGraphic(b);this.labeling&&this.labeling.removeGraphic(b);this.spatialIndex&&this.spatialIndex.remove(b);this.graphicsBySymbol.get(b.graphics3DSymbol.symbol.id).delete(a);delete this.graphicsWithoutSymbol[a];this.removeGraphics3DGraphic(a,c);b.destroy()}else delete this.graphicsWithoutSymbol[a],this.graphicsWaitingForSymbol.delete(a)};m.prototype.hasLabelingContext=function(a){if(a instanceof d.LabelSymbol3D||a instanceof d.TextSymbol){var b=this.symbolCreationContext.layer;
return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};m.prototype.hasValidSymbolCreationContext=function(a){return a instanceof d.LabelSymbol3D&&!this.hasLabelingContext(a)?(ia.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};m.prototype._getRenderingInfo=function(a,b){if(!a.geometry)return b&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+
" has no geometry and will not render")),null;if(!this.graphicSymbolSupported&&a.symbol)return b&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),null;a=this.owner.getRenderingInfo&&this.owner.getRenderingInfo(a);return a&&a.symbol?a:(b&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,b.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),null)};m.prototype.createGraphics3DSymbol=
function(a,b){var c=this;if(!this.hasValidSymbolCreationContext(a))return null;a=this.getConvertedSymbol(a);if(!a)return null;var d;b&&"backgroundFillSymbol"in b&&b.backgroundFillSymbol&&(b=S.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&"web-style"!==b.symbol.type&&(d=b.symbol.symbolLayers));d=Q.make(a,this.symbolCreationContext,d);d.then(function(){return c.notifyChange("maxSymbolComplexity")});return d};m.prototype.getOrCreateGraphics3DSymbol=function(a,b){var c=this,e=this.symbols.get(a.id);void 0===
e&&(e=a instanceof d.WebStyleSymbol?new J(a,function(a){return c.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols.set(a.id,e));e&&++e.referenced;return e};m.prototype.addGraphics3DGraphic=function(a){this._usedMemory+=a.usedMemory;this.graphics.set(a.graphic.uid,a);this.numberOfGraphics++;this.updateLayerVisibility()};m.prototype.removeGraphics3DGraphic=function(a,b){this._usedMemory-=b;this.graphics.delete(a);this.numberOfGraphics--;this.updateLayerVisibility()};m.prototype.createGraphics3DGraphic=
function(a,b){var c=b.graphic;delete this.graphicsWithoutSymbol[c.uid];if(!this.symbols.has(a.symbol.id))this.add([c]);else if(!this.graphics.has(c.uid)){b=a.createGraphics3DGraphic(b);a=a.symbol.id;this.addGraphics3DGraphic(b);this.graphicsBySymbol.has(a)||this.graphicsBySymbol.set(a,new Map);this.graphicsBySymbol.get(a).set(c.uid,b);b.initialize(this.stageLayer,this.stage);b.isDraped()&&(this.graphicsDrapedUids.add(c.uid),this._set("hasDraped",!0));b.centroid=null;"point"!==c.geometry.type&&b instanceof
O&&(b.centroid=F.computeCentroid(c.geometry,this.viewSR));a=this.scaleVisibility&&this.scaleVisibility.scaleRangeActive();this.deconfliction&&this.deconfliction.addGraphic(b);this.labeling&&this.labeling.addGraphic(b);a&&this.scaleVisibility.updateGraphicScaleVisibility(b);b.setVisibilityFlag(0,!!c.visible&&!this.owner.suspended);this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,b);if(a=this.whenGraphics3DGraphicRequests[c.uid])delete this.whenGraphics3DGraphicRequests[c.uid],a.resolve(b);
this.highlights&&this.highlights.graphicCreated(b);return b}};m.prototype.rendererChange=function(a){var b=this.symbolCreationContext.renderer;if(a!==b){this.validateRenderer(a);this.symbolConversionCache.clear();var c=I.diff(b,a);this.updateUnchangedSymbolMappings(c,a,b);this.symbolCreationContext.renderer=a;c&&("complete"===c.type?this.recreateAllGraphics():"partial"===c.type&&(this.applyRendererDiff(c,a,b)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("maxSymbolComplexity"))}};
m.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};m.prototype.applySymbolSetDiff=function(a,b,c,d){var e=this;a=a||[];b=b||[];var g=[];d=function(b){var d=f.graphicsBySymbol.get(b.id);d&&d.forEach(function(f,h){var k=f.graphic,l=e.layer instanceof G?e.layer:null;if(b!==c.defaultSymbol||c.getSymbol(H.hydrateGraphic(k,
l))!==c.defaultSymbol)l=f.usedMemory,f.isDraped()&&e.graphicsDrapedUids.delete(h),a.length||c.defaultSymbol?g.push(k):e.graphicsWithoutSymbol[h]=k,k=e.graphics.get(h),e.highlights&&e.highlights.graphicDeleted(k),e.labeling&&e.labeling.removeGraphic(k),f.destroy(),d.delete(h),e.removeGraphics3DGraphic(h,l),e.updateLayerVisibility()});for(var h=0,k=f._whenSymbolRemoved;h<k.length;h++)(0,k[h])(b.id)};for(var f=this,h=0;h<b.length;h++)d(b[h]);if(a.length||g.length){for(var k in this.graphicsWithoutSymbol)g.push(this.graphicsWithoutSymbol[k]);
this.graphicsWithoutSymbol={};this.add(g)}this.updateHasDraped();this._cleanupSymbols();this.owner.view.labeler.setDirty()};m.prototype.applyUniqueValueRendererDiff=function(a,b,c){var d=a.diff.defaultSymbol,e=a.diff.uniqueValueInfos;if(d||e){var g=e?e.added.map(function(a){return a.symbol}):[],f=e?e.removed.map(function(a){return a.symbol}):[];if(e)for(var h=0;h<e.changed.length;h++)g.push(e.changed[h].newValue.symbol),f.push(e.changed[h].oldValue.symbol);d?(c.defaultSymbol&&f.push(c.defaultSymbol),
b.defaultSymbol&&g.push(b.defaultSymbol)):c.defaultSymbol&&g.length&&f.push(b.defaultSymbol);this.applySymbolSetDiff(g,f,b,c);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};m.prototype.calculateUnchangedSymbolMapping=function(a,b,d){if(b instanceof c.UniqueValueRenderer&&d instanceof c.UniqueValueRenderer&&(!a||"partial"===a.type)){var e=a&&a.diff;a=e&&e.defaultSymbol;var e=e&&e.uniqueValueInfos,g=void 0,g=e?e.unchanged.map(function(a){return{oldId:a.oldValue.symbol.id,
newId:a.newValue.symbol.id}}):d.uniqueValueInfos.map(function(a,c){return{oldId:a.symbol.id,newId:b.uniqueValueInfos[c].symbol.id}});!a&&d.defaultSymbol&&g.push({oldId:d.defaultSymbol.id,newId:b.defaultSymbol.id});return g}return[]};m.prototype.updateUnchangedSymbolMappings=function(a,b,c){var d=0;for(a=this.calculateUnchangedSymbolMapping(a,b,c);d<a.length;d++)if(c=a[d],b=c.oldId,c=c.newId,b&&b!==c){var e=this.graphicsBySymbol.get(b);this.graphicsBySymbol.delete(b);void 0!==e&&this.graphicsBySymbol.set(c,
e);e=this.symbols.get(b);this.symbols.delete(b);void 0!==e&&(this.symbols.set(c,e),e.symbol.id=c)}};m.prototype.applyRendererDiff=function(a,b,d){var e=this;return this.diffHasSymbolChange(a)?!1:b instanceof c.UniqueValueRenderer&&d instanceof c.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(a,b,d)&&0===Object.keys(a.diff).length?!0:t.everyMap(this.graphicsBySymbol,function(c,d){if((c=e.symbols.get(d))&&!c.applyRendererDiff(a,b))return!1})};m.prototype.opacityChange=function(){this.forEachGraphics3DSymbol(function(a){return a.layerPropertyChanged("opacity")});
this.updateStageLayerVisibility()};m.prototype.slicePlaneEnabledChange=function(a){a!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=a,this.stageLayer.isSliceable=a,this.forEachGraphics3DSymbol(function(a,b){return a.layerPropertyChanged("slicePlaneEnabled",b)}),this.deconfliction&&this.deconfliction.slicePlaneEnabledChange(),this.labeling&&this.labeling.slicePlaneEnabledChange())};m.prototype.setClippingExtent=function(a,b){var c=this.symbolCreationContext.clippingExtent,
d=E.create();T.extentToBoundingRect(a,d,b)?this.symbolCreationContext.clippingExtent=[d[0],d[1],-Infinity,d[2],d[3],Infinity]:this.symbolCreationContext.clippingExtent=null;return!l.equals(this.symbolCreationContext.clippingExtent,c)};m.prototype.forEachGraphics3DGraphic=function(a){var b=this;if(this.owner.loadedGraphics){var c=!1;this.owner.loadedGraphics.forEach(function(d){var e=b.getGraphics3DGraphicById(d.uid);e&&a(e,d)&&(c=!0)});c&&(this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty())}};
m.prototype.forEachGraphics3DSymbol=function(a){var b=this;this.graphicsBySymbol.forEach(function(c,d){var e=b.symbols.get(d);e&&a(e,c,d)})};m.prototype.updateAllGraphicsVisibility=function(){var a=this;this.forEachGraphics3DGraphic(function(b,c){c=b.setVisibilityFlag(0,c.visible);var d=!1;a.scaleVisibility&&(d=a.scaleVisibility.updateGraphicScaleVisibility(b));return c||d})};m.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(0,!1)})};m.prototype.validateRenderer=
function(a){(a=N.validateTo3D(a))&&ia.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)};m.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=r(),this.labeling.reset());this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};m.prototype._cleanupSymbols=function(){var a=this;if(!(0<this.graphicsWaitingForSymbol.size)){var b=
!1;this.symbols.forEach(function(c,d){if(c&&!(0<c.referenced)){var e=a.graphicsBySymbol.get(d);e&&0!==e.size||(a.graphicsBySymbol.delete(d),a.symbols.delete(d),c&&c.destroy(),b=!0)}});b&&this.notifyChange("maxSymbolComplexity")}};m.prototype.snapshotInternals=function(){var a=this;return{graphics:l.keysOfMap(this.graphics).sort(),symbols:l.keysOfMap(this.symbols).sort(),graphicsBySymbol:l.keysOfMap(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,graphics:l.keysOfMap(a.graphicsBySymbol.get(b)).sort()}}),
graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:l.keysOfSet(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}};Object.defineProperty(m.prototype,"debug",{get:function(){return{symbols:this.symbols}},enumerable:!0,configurable:!0});m.prototype.getStats=function(){return{coreVisible:this.graphics.size,coreMissing:Object.keys(this.graphicsWithoutSymbol).length,corePending:this.pendingUpdates.size}};var u;m.tmpVec=C.vec3f64.create();a([B.property({readOnly:!0})],
m.prototype,"computedExtent",void 0);a([B.property({readOnly:!0})],m.prototype,"elevationAlignment",void 0);a([B.property({readOnly:!0})],m.prototype,"scaleVisibility",void 0);a([B.property({readOnly:!0})],m.prototype,"spatialIndex",void 0);a([B.property({readOnly:!0})],m.prototype,"deconfliction",void 0);a([B.property({readOnly:!0})],m.prototype,"labeling",void 0);a([B.property({readOnly:!0})],m.prototype,"highlights",void 0);a([B.property()],m.prototype,"asyncUpdates",void 0);a([B.property({constructOnly:!0})],
m.prototype,"elevationFeatureExpressionEnabled",void 0);a([B.property({constructOnly:!0})],m.prototype,"owner",void 0);a([B.property({constructOnly:!0})],m.prototype,"layer",void 0);a([B.property({constructOnly:!0})],m.prototype,"basemapTerrain",void 0);a([B.property({readOnly:!0})],m.prototype,"hasDraped",void 0);a([B.property({readOnly:!0})],m.prototype,"symbolsUpdating",void 0);a([B.property({constructOnly:!0})],m.prototype,"graphicSymbolSupported",void 0);a([B.property({readOnly:!0,dependsOn:["elevationAlignment.updating",
"scaleVisibility.updating"]})],m.prototype,"updating",null);a([B.property({readOnly:!0})],m.prototype,"updatingRemaining",null);a([B.property({readOnly:!0})],m.prototype,"updatingTotal",null);a([B.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","maxSymbolComplexity"]})],m.prototype,"displayFeatureLimit",null);a([B.property({readOnly:!0})],m.prototype,"maxSymbolComplexity",null);return m=
u=a([B.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],m)}(B.declared(m));var ea=new Map,aa=new x,ga=new y(x);(function(){return function(){this.remove=this.add=null}})();var fa=10;return p})},"esri/renderers/support/rendererConversion":function(){define(["require","exports","../../core/Error","../../symbols/support/symbolConversion"],function(p,f,k,a){function g(a,b){if(!b)return null;b=Array.isArray(b)?b:[b];if(0<b.length){var c=b.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});
c.sort();var d=[];c.forEach(function(a,b){0!==b&&a===c[b-1]||d.push(a)});return new k("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+d.join(", ")+") which are not supported in 3D",{renderer:a,symbolErrors:b})}return null}function b(b){var c=b.uniqueValueInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),e=a.to3D(b.defaultSymbol);e.error&&c.unshift(e.error);return g(b,c)}function e(b){var c=b.classBreakInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),
e=a.to3D(b.defaultSymbol);e.error&&c.unshift(e.error);return g(b,c)}Object.defineProperty(f,"__esModule",{value:!0});f.validateTo3D=function(c){return c?"simple"===c.type?g(c,a.to3D(c.symbol).error):"unique-value"===c.type?b(c):"class-breaks"===c.type?e(c):new k("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(c.type||c.declaredClass)+"'",{renderer:c}):null}})},"esri/views/3d/layers/graphics/Graphics3DOwner":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,
"__esModule",{value:!0});p=function(){return function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.renderSpatialReference=this.clippingExtent=this.layerOrderDelta=this.layerOrder=this.stage=this.renderer=this.elevationProvider=this.streamDataSupplier=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.slicePlaneEnabled=!1}}();f.Graphics3DSymbolCreationContext=p})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require",
"exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});f.make=function(g,b,e){var c;switch(g.type){case "point-3d":c=k;break;default:c=a}return new c(g,b,e)}})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./Graphics3DCalloutSymbolLayerFactory","./Graphics3DSymbol"],function(p,f,k,a,g){return function(b){function e(c,d,e){c=b.call(this,c,
d,e)||this;c.calloutSymbolLayer=null;c.symbol.hasVisibleCallout()&&(c.calloutSymbolLayer=a.make(c.symbol,d));return c}k(e,b);e.prototype.destroy=function(){b.prototype.destroy.call(this)};e.prototype.createGraphics3DGraphic=function(a,d,e){d=b.prototype.createGraphics3DGraphic.call(this,a,e);this.calloutSymbolLayer&&(a=this.createCalloutGraphic(a))&&d.addAuxiliaryGraphic(a);return d};e.prototype.layerPropertyChanged=function(a,d){var c=this;return b.prototype.layerPropertyChanged.call(this,a,d)?this.calloutSymbolLayer?
this.calloutSymbolLayer.layerPropertyChanged(a,d,function(a){var b=0;for(a=a._auxiliaryGraphics;b<a.length;b++){var d=a[b];if(d.graphics3DSymbolLayer===c.calloutSymbolLayer)return d}}):!0:!1};e.prototype.createCalloutGraphic=function(a){var b=a.renderingInfo;a.renderingInfo={renderer:b.renderer,symbol:b.symbol,needsOffsetAdjustment:b.needsOffsetAdjustment,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(a)};
return e}(g)})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect".split(" "),function(p,f,k,a,g,b,e,c){var d=function(){function a(){this.extents=new b({allocator:function(a){return a||c.create()}});this.tempExtent=c.create()}
Object.defineProperty(a.prototype,"count",{get:function(){return this.extents.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"area",{get:function(){var a=0;this.extents.forEach(function(b){return a+=c.area(b)});return a},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.extents.clear()};a.prototype.add=function(a){this.contains(a)||(this.removeContained(a),c.set(this.extents.pushNew(),a))};a.prototype.pop=function(){return this.extents.pop()};a.prototype.forEach=
function(a){this.extents.forEach(function(b){return a(b)})};a.prototype.mergeAll=function(){for(;1<this.extents.length;){var a=this.extents.length-1;c.expand(this.extents.data[a-1],this.extents.data[a]);this.extents.pop()}};a.prototype.mergeTight=function(){for(var a=this.extents,b=this.tempExtent,d=!1;!d;)for(var d=!0,e=0;e<a.length;++e){for(var g=e,f=a.data[g],k=c.area(f),m=!1,p=a.length-1;p>g;--p){var z=a.data[p],w=c.area(z);c.expand(f,z,b);z=k+w;.05>(c.area(b)-z)/z&&(c.set(f,b),k=c.area(f),a.swapElements(p,
a.length-1),a.pop(),m=!0)}if(m){d=!1;break}}};a.prototype.toArray=function(){return this.extents.toArray()};a.prototype.contains=function(a){return this.extents.some(function(b){return c.contains(b,a)})};a.prototype.removeContained=function(a){for(var b=this.extents.length-1;0<=b;--b)c.contains(a,this.extents.data[b])&&(this.extents.swapElements(b,this.extents.length-1),this.extents.pop())};return a}();return function(c){function g(){var a=c.call(this)||this;a.dirtyExtents=new d;a.globalDirty=!1;
a.dirtyGraphicsQueue=new b({deallocator:null});a.elevationUpdateEventHandle=null;a.eventHandles=[];a.updateElevation=!1;a.layerView=null;a.graphicsCore=null;return a}k(g,c);Object.defineProperty(g.prototype,"updating",{get:function(){return this.hasPendingOperations()},enumerable:!0,configurable:!0});g.prototype.setup=function(a,b,c,d){var e=this;this.layerView=a;this.graphicsCore=c;this.elevationProvider=d;this.queryGraphicUIDsInExtent=b;this.elevationUpdateEventHandle=d.on("elevation-change",function(a){return e.elevationUpdateHandler(a)});
this.eventHandles.push(this.layerView.watch("suspended",function(){return e.suspendedChange()}))};g.prototype.destroy=function(){this.dirtyGraphicsQueue=null;this.elevationUpdateEventHandle&&(this.elevationUpdateEventHandle.remove(),this.elevationUpdateEventHandle=null);this.eventHandles.forEach(function(a){return a.remove()});this.queryGraphicUIDsInExtent=this.graphicsCore=this.layerView=this.eventHandles=null};g.prototype.clear=function(){this.dirtyGraphicsQueue.clear();this.notifyChange("updating")};
g.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&this.markAllGraphicsElevationDirty()};g.prototype.elevationInfoChange=function(){this.markAllGraphicsElevationDirty()};g.prototype.needsIdleUpdate=function(){return this.hasPendingOperations()};g.prototype.idleUpdate=function(a){var b=this;this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1);for(var c=this.layerView.view,d=this.graphicsCore.stageLayer.id,
e=this.graphicsCore.labelsEnabled?c.labeler.labelStageLayerId:null,g=!1;this.hasPendingOperations()&&!a.done();){for(;0<this.dirtyGraphicsQueue.length&&!a.done();){for(var f=Math.min(this.dirtyGraphicsQueue.length,100),h=0;h<f;h++){var k=this.dirtyGraphicsQueue.pop();(k=this.graphicsCore.getGraphics3DGraphicById(k))&&k.alignWithElevation(this.elevationProvider,c.renderCoordsHelper)}c._stage.processDirtyLayer(d);null!=e&&c._stage.processDirtyLayer(e)}for(;0<this.dirtyExtents.count&&100>this.dirtyGraphicsQueue.length&&
!a.done();)g||(this.dirtyExtents.mergeTight(),g=!0),f=this.dirtyExtents.pop(),this.queryGraphicUIDsInExtent(f,this.spatialReference,function(a){var c=b.graphicsCore.getGraphics3DGraphicById(a);c&&c.needsElevationUpdates()&&b.dirtyGraphicsQueue.push(a)})}c.deconflictor.setDirty();this.notifyChange("updating")};g.prototype.markAllGraphicsElevationDirty=function(){var a=this;this.dirtyExtents.clear();this.dirtyGraphicsQueue.clear();this.graphicsCore.graphics3DGraphics.forEach(function(b,c){return a.dirtyGraphicsQueue.push(c)});
this.notifyChange("updating")};g.prototype.hasPendingOperations=function(){return 0<this.dirtyGraphicsQueue.length||0<this.dirtyExtents.count||this.globalDirty};g.prototype.elevationUpdateHandler=function(a){var b=a.extent;this.layerView.suspended?this.updateElevation||(a=this.graphicsCore.computedExtent)&&b[2]>a.xmin&&b[0]<a.xmax&&b[3]>a.ymin&&b[1]<a.ymax&&(this.updateElevation=!0):(-Infinity===b[0]?this.globalDirty=!0:this.dirtyExtents.add(b),this.spatialReference=a.spatialReference,this.notifyChange("updating"))};
a([e.property({readOnly:!0})],g.prototype,"updating",null);return g=a([e.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],g)}(e.declared(g))})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../support/earthUtils ../../support/FrustumExtentIntersection".split(" "),
function(p,f,k,a,g,b,e,c,d,m){var l=-.3*d.earthRadius;return function(d){function g(){var a=d.call(this)||this;a.suspended=!0;a._frustumVisibilityDirty=!0;a.extent=null;a.extentIntersectionDirty=!0;a._isVisibleBelowSurface=!1;a.handles=new b;a.layerView=null;return a}k(g,d);Object.defineProperty(g.prototype,"frustumVisibilityDirty",{get:function(){return this._frustumVisibilityDirty},set:function(a){a!==this._frustumVisibilityDirty&&(this._frustumVisibilityDirty=a,this.notifyChange("updating"))},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return this.frustumVisibilityDirty},enumerable:!0,configurable:!0});g.prototype.setup=function(a){var b=this;this.layerView=a;this.extentIntersection=new m.FrustumExtentIntersection({renderCoordsHelper:a.view.renderCoordsHelper});a=a.view;var c=a.basemapTerrain;this.handles.add([a.on("resize",function(){return b.viewChange()}),a.state.watch("camera",function(){return b.viewChange()},!0),c.on("elevation-bounds-change",
function(){return b.elevationBoundsChange()})]);"local"===a.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(e.init(c,["opacity","wireframe"],function(){return b.isVisibleBelowSurface=!c.isOpaque()}))};g.prototype.destroy=function(){this.extentIntersection=this.extent=this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};g.prototype.needsIdleUpdate=function(){return this.frustumVisibilityDirty};g.prototype.setExtent=function(a){this.extent=a;this.frustumVisibilityDirty=
this.extentIntersectionDirty=!0};g.prototype.viewChange=function(){this.frustumVisibilityDirty=!0};g.prototype.elevationBoundsChange=function(){this.extentIntersectionDirty=this.frustumVisibilityDirty=!0};Object.defineProperty(g.prototype,"isVisibleBelowSurface",{set:function(a){this._isVisibleBelowSurface=a;this.extentIntersectionDirty=this.frustumVisibilityDirty=!0},enumerable:!0,configurable:!0});g.prototype.idleUpdate=function(a){!a.done()&&this.frustumVisibilityDirty&&(this.updateSuspendFrustumVisible(),
this.frustumVisibilityDirty=!1)};g.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var a=this.layerView.view,b;if(this._isVisibleBelowSurface)b=l;else{b=a.basemapTerrain.getElevationBounds();var c=b[0];b=c-Math.max(1,(b[1]-c)*(1.2-1))}this.extentIntersection.update(this.extent,a.spatialReference,b)}};g.prototype.updateSuspendFrustumVisible=function(){this.extent?(this.updateExtentIntersection(),this._set("suspended",!this.extentIntersection.isVisibleInFrustum(this.layerView.view.frustum))):
this._set("suspended",!1)};a([c.property({readOnly:!0})],g.prototype,"suspended",void 0);a([c.property({readOnly:!0})],g.prototype,"updating",null);return g=a([c.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],g)}(c.declared(g))})},"esri/views/3d/layers/graphics/Graphics3DHighlights":function(){define(["require","exports","./Graphics3DHighlightSet"],function(p,f,k){return function(){function a(){this.graphicsCore=null;this.highlights=[]}a.prototype.destroy=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()});
this.highlights=null};a.prototype.setup=function(a){this.graphicsCore=a};a.prototype.acquireSet=function(a,b){var e=this,c=new k(a,b);this.highlights.push(c);return{set:c,handle:{remove:function(){return e.releaseSet(c)}}}};a.prototype.releaseSet=function(a){a.highlightSet.removeAll();a=this.highlights?this.highlights.indexOf(a):-1;-1!==a&&this.highlights.splice(a,1)};a.prototype.setUids=function(a,b){for(var e=this.graphicsCore.graphics3DGraphics,c=0;c<b.length;c++){var d=b[c];a.ids.add(d);(d=e.get(d))&&
d.addHighlight(a.highlightSet,a.options)}};a.prototype.setObjectIds=function(a,b){var e=this.graphicsCore.graphics3DGraphics;b.forEach(function(b){return a.ids.add(b)});e.forEach(function(b){b&&a.hasGraphic(b)&&b.addHighlight(a.highlightSet,a.options)})};a.prototype.graphicCreated=function(a){this.highlights.forEach(function(b){b.hasGraphic(a)&&a.addHighlight(b.highlightSet,b.options)})};a.prototype.graphicDeleted=function(a){this.highlights.forEach(function(b){b.hasGraphic(a)&&a.removeHighlight(b.highlightSet)})};
a.prototype.allGraphicsDeleted=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()})};return a}()})},"esri/views/3d/layers/graphics/Graphics3DHighlightSet":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(p,f,k){return function(){function a(a,b){this.highlightSet=new k;this.ids=new Set;this.options=a;this.objectIdField=b}a.prototype.hasGraphic=function(a){return this.objectIdField?this.ids.has(a.graphic.attributes[this.objectIdField]):
this.ids.has(a.graphic.uid)};return a}()})},"esri/views/3d/webgl-engine/lib/HighlightSet":function(){define(["require","exports"],function(p,f){return function(){function f(){this.items=[]}f.prototype.addObject=function(a,g){this.items.push({type:"object",highlightId:g,object:a})};f.prototype.addRenderGeometry=function(a,g,b){this.items.push({type:"renderGeometry",highlightId:b,renderGeometry:a,renderer:g})};f.prototype.addExternal=function(a,g){this.items.push({type:"external",highlightId:g,remove:a})};
f.prototype.remove=function(a){for(var g=this.items.length-1;0<=g;--g){var b=this.items[g];b.highlightId===a&&(this.removeHighlight(b),this.items.splice(g,1))}};f.prototype.removeObject=function(a){for(var g=this.items.length-1;0<=g;--g){var b=this.items[g];"object"===b.type&&b.object===a&&(this.removeHighlight(b),this.items.splice(g,1))}};f.prototype.removeRenderGeometry=function(a){for(var g=this.items.length-1;0<=g;--g){var b=this.items[g];"renderGeometry"===b.type&&b.renderGeometry===a&&(this.removeHighlight(b),
this.items.splice(g,1))}};f.prototype.removeAll=function(){var a=this;this.items.forEach(function(g){a.removeHighlight(g)});this.items=[]};f.prototype.removeHighlight=function(a){switch(a.type){case "object":a.object.removeHighlights(a.highlightId);break;case "renderGeometry":a.renderer.removeRenderGeometryHighlight(a.renderGeometry,a.highlightId);break;case "external":a.remove(a.highlightId)}};return f}()})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),
function(p,f,k,a,g,b){function e(a,b){return null!==a&&0<a&&8E7>a||50<b}return function(c){function d(){var a=c.call(this)||this;a._scaleRangeActive=!1;a._layerScaleRangeVisibilityDirty=!0;a.layerScaleRangeVisibilityQuery=!1;a.scaleChangeEventHandle=null;a.layerView=null;a.layer=null;a.queryGraphicUIDsInExtent=null;a.extent=null;a.graphicsCore=null;a.basemapTerrain=null;a.suspended=!1;return a}k(d,c);Object.defineProperty(d.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},
set:function(a){this._layerScaleRangeVisibilityDirty!==a&&(this._layerScaleRangeVisibilityDirty=a,this.notifyChange("updating"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0});d.prototype.setup=function(a,b,c,d,e){this.layerView=a;this.layer=b;this.queryGraphicUIDsInExtent=c;this.graphicsCore=d;this.basemapTerrain=e;this.updateScaleRangeActive()};
d.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=null};d.prototype.needsIdleUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty};d.prototype.setExtent=function(a){this.extent=a;this.layerScaleRangeVisibilityDirty=!0};d.prototype.idleUpdate=function(a){this.layerView.view.basemapTerrain&&!a.done()&&
this.layerScaleRangeVisibilityDirty&&(this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=!1)};d.prototype.scaleRangeActive=function(){return this._scaleRangeActive};d.prototype.updateScaleRangeActive=function(){var a=this,b=this.layer,c=!1;b.labelingInfo&&(c=c||b.labelingInfo.some(function(a){return a&&e(a.minScale,a.maxScale)}));c=c||e(b.minScale,b.maxScale);b=this._scaleRangeActive!==c;(this._scaleRangeActive=c)&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=
this.basemapTerrain.on("scale-change",function(b){return a.scaleUpdateHandler(b)}):!c&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);return b};d.prototype.updateSuspendScaleVisibleFinish=function(a){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!a)};d.prototype.updateSuspendScaleVisible=function(){var a=this,b=this.layerView.view.basemapTerrain;this.extent&&b&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=
!0,b.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(b){return a.updateSuspendScaleVisibleFinish(b)})):this.updateSuspendScaleVisibleFinish(!0)};d.prototype.visibleAtScale=function(a,b,c){return null==a?!0:a>c&&(!b||a<b)};d.prototype.visibleAtLayerScale=function(a){return this.visibleAtScale(a,this.layer.minScale,this.layer.maxScale)};d.prototype.visibleAtLabelScale=function(a,b){return this.visibleAtScale(a,b.minScale,b.maxScale)};d.prototype.graphicScale=function(a){var b;
a.centroid?b=a.centroid:"point"===a.graphic.geometry.type&&(b=a.graphic.geometry);return b?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(b):1:null};d.prototype.graphicVisible=function(a){a=this.graphicScale(a);return this.visibleAtLayerScale(a)};d.prototype.updateGraphicScaleVisibility=function(a){if(this._scaleRangeActive){var b=this.graphicVisible(a);return a.setVisibilityFlag(1,b)}return!1};d.prototype.updateGraphicLabelScaleVisibility=function(a){if(!this._scaleRangeActive||
!a._labelGraphics||0===a._labelGraphics.length)return!1;var b=this.graphicScale(a);if(a=this.updateLabelScaleVisibility(a,b))this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty();return a};d.prototype.updateLabelScaleVisibility=function(a,b){if(!a._labelGraphics||0===a._labelGraphics.length)return!1;var c=a._labelGraphics[0]._labelClass;return c&&null!=c.minScale&&null!=c.maxScale&&(b=this.visibleAtLabelScale(b,c),a.setVisibilityFlag(1,b,1))?!0:!1};d.prototype.scaleUpdateHandler=
function(a){var b=this;if(!this.layerView.suspended){var c=a.extent,d=a.scale,e=this.visibleAtLayerScale(d),g=!1;this.queryGraphicUIDsInExtent(c,a.spatialReference,function(a){if(a=b.graphicsCore.getGraphics3DGraphicById(a)){var f=a.centroid;f&&(c[0]>f.x||c[1]>f.y||c[2]<f.x||c[3]<f.y)||(f=!1,a.setVisibilityFlag(1,e)&&(f=!0),b.updateLabelScaleVisibility(a,d)&&(f=!0),f&&(g=!0))}});g&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=
!0};d.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(1,void 0)}));this.layerScaleRangeVisibilityDirty=!0};a([b.property({readOnly:!0})],d.prototype,"suspended",void 0);a([b.property({readOnly:!0})],d.prototype,"updating",null);return d=a([b.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],d)}(b.declared(g))})},
"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/has ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../core/libs/rbush/PooledRBush".split(" "),function(p,f,k,a,g,b,e,c,d){p=function(e){function g(a){a=e.call(this)||this;a.index=new d.default(9,b("csp-restrictions")?function(a){return{minX:a.extent[0],
minY:a.extent[1],maxX:a.extent[2],maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);a.spatialReference=null;return a}k(g,e);g.prototype.destroy=function(){this.index.clear();this.index=null};g.prototype.queryGraphicUIDsInExtent=function(a,b,c){b.equals(this.spatialReference)&&(l.minX=a[0],l.minY=a[1],l.maxX=a[2],l.maxY=a[3],this.index.search(l,function(a){c(a.graphic.uid)}))};g.prototype.add=function(a){!a.addedToSpatialIndex&&a.computeExtent(this.spatialReference)&&(this.index.insert(a),
a.addedToSpatialIndex=!0)};g.prototype.addMany=function(a,b){void 0===b&&(b=a.length);m.clear();for(var c=0;c<b;c++){var d=a[c];!d.addedToSpatialIndex&&d.computeExtent(this.spatialReference)&&(m.push(d),d.addedToSpatialIndex=!0)}this.index.load(m.data,m.length)};g.prototype.remove=function(a){a.addedToSpatialIndex&&(a.addedToSpatialIndex=!1,this.index.remove(a))};g.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this.remove(a[b])};g.prototype.clear=function(){this.index.clear()};a([c.property({constructOnly:!0})],
g.prototype,"spatialReference",void 0);return g=a([c.subclass("esri.views.3d.layers.graphics.Graphics3DSpatialIndex")],g)}(c.declared(g));var m=new e,l={minX:0,minY:0,maxX:0,maxY:0};return p})},"esri/core/libs/rbush/PooledRBush":function(){define(["require","exports","../../PooledArray","../quickselect/quickselect"],function(p,f,k,a){function g(a,c){b(a,0,a.children.length,c,a)}function b(a,b,c,d,g){g||(g=q(null,!0));g.minX=Infinity;g.minY=Infinity;g.maxX=-Infinity;g.maxY=-Infinity;for(var f=void 0;b<
c;b++)f=a.children[b],e(g,a.leaf?d(f):f);return g}function e(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function c(a,b){return a.minX-b.minX}function d(a,b){return a.minY-b.minY}function m(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function l(a){return a.maxX-a.minX+(a.maxY-a.minY)}function h(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function n(a,b){return b.minX<=a.maxX&&
b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function q(a,b){return{children:a,height:1,leaf:b,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function t(b,c,d,e,g){for(var f=[c,d];f.length;)if(d=f.pop(),c=f.pop(),!(d-c<=e)){var h=c+Math.ceil((d-c)/e/2)*e;a(b,h,c,d,g);f.push(c,h,h,d)}}Object.defineProperty(f,"__esModule",{value:!0});p=function(){function a(a,b){void 0===a&&(a=9);this.compareMinX=c;this.compareMinY=d;this.toBBox=function(a){return a};this._maxEntries=Math.max(4,a||9);
this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));b&&("function"===typeof b?this.toBBox=b:this._initFormat(b));this.clear()}a.prototype.all=function(a){this._all(this.data,a)};a.prototype.search=function(a,b){var c=this.data,d=this.toBBox;if(n(a,c))for(u.clear();c;){for(var e=0,g=c.children.length;e<g;e++){var f=c.children[e],k=c.leaf?d(f):f;n(a,k)&&(c.leaf?b(f):h(a,k)?this._all(f,b):u.push(f))}c=u.pop()}};a.prototype.collides=function(a){var b=this.data,c=this.toBBox;if(!n(a,b))return!1;
for(u.clear();b;){for(var d=0,e=b.children.length;d<e;d++){var g=b.children[d],f=b.leaf?c(g):g;if(n(a,f)){if(b.leaf||h(a,f))return!0;u.push(g)}}b=u.pop()}return!1};a.prototype.load=function(a,b){void 0===b&&(b=a.length);if(!b)return this;if(b<this._minEntries){for(var c=0;c<b;c++)this.insert(a[c]);return this}a=this._build(a.slice(0,b),0,b-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(c=this.data,this.data=a,a=c),this._insert(a,
this.data.height-a.height-1,!0)):this.data=a;return this};a.prototype.insert=function(a){a&&this._insert(a,this.data.height-1);return this};a.prototype.clear=function(){this.data=q([],!0);return this};a.prototype.remove=function(a,b){if(!a)return this;var c=this.data,d,e,g,f,k=this.toBBox(a);y.clear();for(x.clear();c||y.length;){c||(c=y.pop(),d=y.data[y.length-1],e=x.pop(),g=!0);if(c.leaf){a:{f=a;var l=c.children,m=b;if(m){for(var n=0;n<l.length;n++)if(m(f,l[n])){f=n;break a}f=-1}else f=l.indexOf(f)}if(-1!==
f){c.children.splice(f,1);y.push(c);this._condense(y);break}}g||c.leaf||!h(c,k)?d?(e++,c=d.children[e],g=!1):c=null:(y.push(c),x.push(e),e=0,d=c,c=c.children[0])}return this};a.prototype.toJSON=function(){return this.data};a.prototype.fromJSON=function(a){this.data=a;return this};a.prototype._all=function(a,b){for(r.clear();a;){if(!0===a.leaf){var c=0;for(a=a.children;c<a.length;c++)b(a[c])}else r.pushArray(a.children);a=r.pop()}};a.prototype._build=function(a,b,c,d){var e=c-b+1,f=this._maxEntries,
h;if(e<=f)return h=q(a.slice(b,c+1),!0),g(h,this.toBBox),h;d||(d=Math.ceil(Math.log(e)/Math.log(f)),f=Math.ceil(e/Math.pow(f,d-1)));h=q([],!1);h.height=d;e=Math.ceil(e/f);f=e*Math.ceil(Math.sqrt(f));for(t(a,b,c,f,this.compareMinX);b<=c;b+=f){var k=Math.min(b+f-1,c);t(a,b,k,e,this.compareMinY);for(var l=b;l<=k;l+=e)h.children.push(this._build(a,l,Math.min(l+e-1,k),d-1))}g(h,this.toBBox);return h};a.prototype._chooseSubtree=function(a,b,c,d){for(;;){d.push(b);if(!0===b.leaf||d.length-1===c)break;for(var e=
Infinity,g=Infinity,f=void 0,h=0,k=b.children.length;h<k;h++){var l=b.children[h],n=m(l),r=(Math.max(l.maxX,a.maxX)-Math.min(l.minX,a.minX))*(Math.max(l.maxY,a.maxY)-Math.min(l.minY,a.minY))-n;r<g?(g=r,e=n<e?n:e,f=l):r===g&&n<e&&(e=n,f=l)}b=f||b.children[0]}return b};a.prototype._insert=function(a,b,c){var d=this.toBBox;c=c?a:d(a);y.clear();d=this._chooseSubtree(c,this.data,b,y);d.children.push(a);for(e(d,c);0<=b;)if(y.data[b].children.length>this._maxEntries)this._split(y,b),b--;else break;this._adjustParentBBoxes(c,
y,b)};a.prototype._split=function(a,b){var c=a.data[b],d=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,d);d=this._chooseSplitIndex(c,e,d);d=q(c.children.splice(d,c.children.length-d),c.leaf);d.height=c.height;g(c,this.toBBox);g(d,this.toBBox);b?a.data[b-1].children.push(d):this._splitRoot(c,d)};a.prototype._splitRoot=function(a,b){this.data=q([a,b],!1);this.data.height=a.height+1;g(this.data,this.toBBox)};a.prototype._chooseSplitIndex=function(a,c,d){var e,g,f;e=g=Infinity;for(var h=
c;h<=d-c;h++){var k=b(a,0,h,this.toBBox),l=b(a,h,d,this.toBBox),n;n=Math.max(0,Math.min(k.maxX,l.maxX)-Math.max(k.minX,l.minX))*Math.max(0,Math.min(k.maxY,l.maxY)-Math.max(k.minY,l.minY));k=m(k)+m(l);n<e?(e=n,f=h,g=k<g?k:g):n===e&&k<g&&(g=k,f=h)}return f};a.prototype._chooseSplitAxis=function(a,b,e){var g=a.leaf?this.compareMinX:c,f=a.leaf?this.compareMinY:d,h=this._allDistMargin(a,b,e,g);b=this._allDistMargin(a,b,e,f);h<b&&a.children.sort(g)};a.prototype._allDistMargin=function(a,c,d,g){a.children.sort(g);
g=this.toBBox;for(var f=b(a,0,c,g),h=b(a,d-c,d,g),k=l(f)+l(h),m=c;m<d-c;m++){var n=a.children[m];e(f,a.leaf?g(n):n);k+=l(f)}for(m=d-c-1;m>=c;m--)n=a.children[m],e(h,a.leaf?g(n):n),k+=l(h);return k};a.prototype._adjustParentBBoxes=function(a,b,c){for(;0<=c;c--)e(b.data[c],a)};a.prototype._condense=function(a){for(var b=a.length-1,c=void 0;0<=b;b--)0===a.data[b].children.length?0<b?(c=a.data[b-1].children,c.splice(c.indexOf(a.data[b]),1)):this.clear():g(a.data[b],this.toBBox)};a.prototype._initFormat=
function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")};return a}();f.PooledRBush=p;var u=new k,r=new k,y=new k,x=new k({deallocator:null});f.default=p})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function p(a,g,b,e,c){for(;e>b;){if(600<e-b){var d=e-b+1,k=g-b+1,l=Math.log(d),
h=.5*Math.exp(2*l/3),l=.5*Math.sqrt(l*h*(d-h)/d)*(0>k-d/2?-1:1);p(a,g,Math.max(b,Math.floor(g-k*h/d+l)),Math.min(e,Math.floor(g+(d-k)*h/d+l)),c)}d=a[g];k=b;h=e;f(a,b,g);for(0<c(a[e],d)&&f(a,b,e);k<h;){f(a,k,h);k++;for(h--;0>c(a[k],d);)k++;for(;0<c(a[h],d);)h--}0===c(a[b],d)?f(a,b,h):(h++,f(a,h,e));h<=g&&(b=h+1);g<=h&&(e=h-1)}}function f(a,g,b){var e=a[g];a[g]=a[b];a[b]=e}function k(a,g){return a<g?-1:a>g?1:0}return function(a,g,b,e,c){p(a,g,b||0,e||a.length-1,c||k)}})},"esri/views/3d/layers/support/attributeUtils":function(){define(["require",
"exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.attributeLookup=function(f,a){a=a.toLowerCase();for(var g=0,b=Object.keys(f);g<b.length;g++){var e=b[g];if(e.toLowerCase()===a)return f[e]}return null}})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["require","exports","../../../../core/promiseUtils","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",
{value:!0});f.toViewIfLocal=function(b){var e=b.view.spatialReference,c=b.layer.fullExtent,d=c&&c.spatialReference;return d?d.equals(e)?k.resolve(c.clone()):a.canProject(d,e)?k.resolve(a.project(c,e)):b.view.state.isLocal?g.projectGeometry(c,e,b.layer.portalItem).then(function(a){if(!b.destroyed&&a)return a}).catch(function(){return null}):k.resolve(null):k.resolve(null)}})},"esri/views/3d/layers/support/popupUtils3D":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../geometry/Extent ../../../../geometry/support/scaleUtils ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/clickToleranceUtils".split(" "),
function(p,f,k,a,g,b,e,c){function d(a,c,d){var e=d.get("basemapTerrain"),f=d.get("basemapTerrain.overlayManager"),f=f?f.overlayPixelSizeInMapUnits(a):1,e=e&&!e.spatialReference.equals(d.spatialReference)?b.getMetersPerUnitForSR(e.spatialReference)/b.getMetersPerUnitForSR(d.spatialReference):c*f;c=a.clone().offset(-e,-e);a=a.clone().offset(e,e);return new g({xmin:Math.min(c.x,a.x),ymin:Math.min(c.y,a.y),xmax:Math.max(c.x,a.x),ymax:Math.max(c.y,a.y),spatialReference:d.spatialReference})}Object.defineProperty(f,
"__esModule",{value:!0});f.createQueryGeometry=d;f.queryDrapedGraphics=function(a){var b=a.area,g=a.view,f=a.loadedGraphics,k=a.popupTemplate,m=a.layer;a=a.clientGraphics;var u=c.calculateTolerance(),r=d(b,u,g),p=[];f.forEach(function(a){a.visible&&r.intersects(a.geometry)&&(k||e.isHydratedGraphic(a)&&a.popupTemplate)&&p.push(e.hydrateGraphic(a,m))});return a&&a.length?a.concat(p):p}})},"esri/renderers/support/clickToleranceUtils":function(){define(["require","exports"],function(p,f){function k(a,
g){return g&&g.xoffset?Math.max(a,Math.abs(g.xoffset)):g&&g.yoffset?Math.max(a,Math.abs(g.yoffset)):a}Object.defineProperty(f,"__esModule",{value:!0});f.calculateTolerance=function(a){if(!a)return 6;if("simple"===a.type)return k(6,a.symbol);if("unique-value"===a.type){var g=6;a.uniqueValueInfos.forEach(function(a){g=k(g,a.symbol)});return g}if("class-breaks"===a.type){var b=6;a.classBreakInfos.forEach(function(a){b=k(b,a.symbol)});return b}return 6}})},"esri/views/layers/FeatureLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/arrayUtils ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/accessorSupport/decorators ../../renderers/support/clickToleranceUtils ../../support/arcadeUtils ../../support/graphicUtils ./RefreshableLayerView ./support/popupUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q){var t=e.getLogger("esri.views.layers.FeatureLayerView");return function(e){function f(a){a=e.call(this,a)||this;a.layer=null;return a}k(f,e);Object.defineProperty(f.prototype,"maximumNumberOfFeatures",{get:function(){return 0},set:function(a){t.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!1},
enumerable:!0,configurable:!0});f.prototype.highlight=function(a,b){return this.inherited(arguments)};f.prototype.queryFeatures=function(a){return this.inherited(arguments)};f.prototype.queryObjectIds=function(a){return this.inherited(arguments)};f.prototype.queryFeatureCount=function(a){return this.inherited(arguments)};f.prototype.queryExtent=function(a){return this.inherited(arguments)};f.prototype.fetchPopupFeatures=function(a,b){var d=this._validateFetchPopupFeatures();if(d)return c.reject(d);
d=this._fetchClientPopupFeatures(b);if(!a)return d;a=this._fetchServicePopupFeatures(a,b);return c.eachAlwaysValues([d,a]).then(g.concatAll)};f.prototype._validateFetchPopupFeatures=function(){var a=this.layer,c=a.popupTemplate;if(!a.popupEnabled)return new b("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:a});if(!c)return new b("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:a})};f.prototype._fetchClientPopupFeatures=function(a){if(!a||0===
a.length)return c.resolve([]);for(var b=[],d=[],e=this.layer,g=l.hasGeometryOperations(e.popupTemplate),f=this._createPopupQuery(),k=0;k<a.length;k++){var m=a[k];g||!h.hasRequiredFields(m,f.outFields)?d.push(m):b.push(m)}if(0===d.length)return c.resolve(b);f.objectIds=d.map(function(a){return a.attributes[e.objectIdField]});return e.queryFeatures(f).then(function(a){return b.concat(a.features)}).catch(function(){return d})};f.prototype._fetchServicePopupFeatures=function(a,b){var c=this._createPopupQuery(),
d=this.layer,e=m.calculateTolerance(d.renderer);c.geometry=this.createFetchPopupFeaturesQueryGeometry(a,e);var g=new Set,f=d.objectIdField;for(a=0;a<b.length;a++)g.add(b[a].attributes[f]);return d.queryFeatures(c).then(function(a){return a.features.filter(function(a){return!g.has(a.attributes[f])})})};f.prototype._createPopupQuery=function(){var a=this.layer.createQuery();a.returnGeometry=!0;a.returnZ=!0;a.returnM=!0;a.outFields=q.getRequiredFields(this.layer);a.outSpatialReference=this.getViewSpatialReference();
return a};a([d.property()],f.prototype,"layer",void 0);a([d.property({type:Number})],f.prototype,"maximumNumberOfFeatures",null);a([d.property({readOnly:!0,type:Boolean})],f.prototype,"maximumNumberOfFeaturesExceeded",null);return f=a([d.subclass("esri.views.layers.FeatureLayerView")],f)}(d.declared(n))})},"esri/support/graphicUtils":function(){define(["require","exports"],function(p,f){Object.defineProperty(f,"__esModule",{value:!0});f.hasRequiredFields=function(a,g){if(!g)return!0;var b=a.attributes||
k;return!g.some(function(a){return!(a in b)})};var k={}})},"esri/views/layers/RefreshableLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(p,f,k,a,g,b){return function(e){function c(){var a=null!==e&&e.apply(this,arguments)||this;a.refreshTimestamp=null;return a}k(c,e);c.prototype.refresh=function(a){void 0===a&&(a=Date.now());this._set("refreshTimestamp",
a);this.doRefresh&&this.doRefresh()};a([b.property()],c.prototype,"layer",void 0);a([b.aliasOf("layer.refreshInterval")],c.prototype,"refreshInterval",void 0);a([b.property({readOnly:!0})],c.prototype,"refreshTimestamp",void 0);return c=a([b.subclass("esri.layers.mixins.RefreshableLayerView")],c)}(b.declared(g))})},"esri/views/layers/support/popupUtils":function(){define(["require","exports"],function(p,f){function k(a,g){if(!a.fields)return!1;var b=g.toLowerCase();return a.fields.some(function(a){return a.name.toLowerCase()===
b})}Object.defineProperty(f,"__esModule",{value:!0});f.getRequiredFields=function(a){var g=a.popupTemplate,b=g.requiredFields,g=g.lastEditInfoEnabled,e=a.objectIdField,c=a.editFieldsInfo;if(b&&1===b.length&&"*"===b[0])return b;b=b&&b.filter(function(b){return k(a,b)});c&&g&&(c.creatorField&&b.push(c.creatorField),c.creationDateField&&b.push(c.creationDateField),c.editorField&&b.push(c.editorField),c.editDateField&&b.push(c.editDateField));b&&e&&k(a,e)&&-1===b.indexOf(e)&&b.push(e);return b}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/arrayUtils ../../../core/arrayUtils ../../../core/Logger ../../../core/promiseUtils ../../../core/requireUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingBox ../../../geometry/support/scaleUtils ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorker ./i3s/I3SUtil ./i3s/IdleQueue ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointRenderer ./support/layerViewUpdatingProperties ../support/geometryUtils ../support/orientedBoundingBox ../support/projectionUtils module".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H,I,N,S,M){var P=c.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),O=I.plane.create();return function(c){function f(){var a=null!==c&&c.apply(this,arguments)||this;a.maximumPointCount=4E6;a.slicePlaneEnabled=!1;a._renderer=null;a._rendererAdded=!1;a._renderedNodes=new Set;a._updateViewNeeded=!0;a._lodFactor=1;a._worker=new z;a._maxLoggedBoxWarnings=5;a._pageMultiplier=1;a._indexQueue=[];a._workQueue=[];a._idleQueue=new B.IdleQueue;
a._indexPagesLoading=new Map;a._loadingNodes=new Map;a._layerIsVisible=!1;a._totalWork=0;a._index=null;a._loadingInitNodePage=!1;a._nodeIdArray=[];return a}k(f,c);Object.defineProperty(f.prototype,"pointScale",{get:function(){var a=E.getSplatSizeAlgorithm(this.layer.renderer);return a&&null!=a.scaleFactor?a.scaleFactor:1},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"useRealWorldSymbolSizes",{get:function(){var a=E.getFixedSizeAlgorithm(this.layer.renderer);return a&&null!=a.useRealWorldSymbolSizes?
a.useRealWorldSymbolSizes:!1},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"pointSize",{get:function(){var a=E.getFixedSizeAlgorithm(this.layer.renderer);return a&&null!=a.size?a.size:0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"inverseDensity",{get:function(){return this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"_clippingBox",{get:function(){var a=u.create();return S.extentToBoundingBox(this.view.clippingArea,
a,this.view.renderSpatialReference)?a:null},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"_elevationOffset",{get:function(){var a=this.layer.elevationInfo;if(a&&"absolute-height"===a.mode){var b=r.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=y.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0});f.prototype.initialize=function(){var a=this;w.checkPointCloudLayerValid(this.layer);w.checkPointCloudLayerCompatibleWithView(this.layer,
this.view);this._initRenderer();var b=this._initNodePages(),c={idleBegin:function(){return a._idleBegin()},idleEnd:function(){return a._idleEnd()}};n.open(m.getAbsMid("./PointCloudWorker",p,M)).then(function(b){a.destroyed?b.close():a._worker.thread=b});this._memCache=this.view.resourceController.getMemCache(this.layer.uid);this.handles.add(h.init(this,"_clippingBox",function(){return a._setUpdateViewNeeded()}));this.handles.add(h.init(this,"_elevationOffset",function(){return a._elevationOffsetChanged()}));
this.handles.add(h.init(this.layer,"renderer",function(){return a._rendererChanged()}));this.handles.add(h.init(this.layer,"filters",function(){return a._filterChanged()}));this.handles.add(h.init(this,"clippingArea",function(){a._setUpdateViewNeeded()}));this.handles.add(this.view.state.watch("camera",function(){a._setUpdateViewNeeded()}));this.view.resourceController.memoryEvents.on("quality-changed",function(){return a._setUpdateViewNeeded()});this.addResolvingPromise(b);this.when(function(){a.handles.add(a.view.resourceController.registerFrameWorker(function(b){return a._process(b)}));
a.handles.add(a.view.resourceController.registerIdleFrameWorker(c));a.handles.add(h.init(a,"suspended",function(b){b?a._clearNodeState():a._setUpdateViewNeeded()}))})};f.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};f.prototype.destroy=function(){this._cancelNodeLoading();this._worker&&this._worker.thread&&(this._worker.thread.close(),this._worker=this._worker.thread=null);this._destroyRenderer();this._memCache.destroy();this._memCache=null};f.prototype._initRenderer=
function(){var a=this;this._renderer=new G;this._renderer.layerUid=this.layer.uid;this.handles.add(h.init(this,"_clippingBox",function(b){a._renderer.clippingBox=b}));this.handles.add(h.init(this,"_clippingBox",function(b){a._renderer.clippingBox=b}));this.handles.add(h.init(this,"suspended",function(b){return a._setPointsVisible(!b)}));this.handles.add(h.init(this,"pointScale",function(b){a._renderer.scaleFactor=b}));this._renderer.minSizePx=Math.sqrt(2);this.handles.add(h.init(this,"useRealWorldSymbolSizes",
function(b){a._renderer.useRealWorldSymbolSizes=b}));this.handles.add(h.init(this,"pointSize",function(b){var c=l.pt2px(b);a._renderer.size=b;a._renderer.sizePx=c}));this.handles.add(h.init(this,"slicePlaneEnabled",function(b){a._renderer.slicePlaneEnabled=b}));this.handles.add(h.init(this,["inverseDensity","maximumPointCount"],function(){a._setUpdateViewNeeded()}));this.handles.add(h.init(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",function(b){a._lodFactor=b;a._setUpdateViewNeeded()}))};
f.prototype._destroyRenderer=function(){this._setPointsVisible(!1)};f.prototype._setPointsVisible=function(a){a&&!this._rendererAdded?(this.view._stage.addRenderPlugin([5],this._renderer),this._rendererAdded=!0):!a&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};f.prototype._rendererChanged=function(){this._clearNodeState();this._memCache.clear();this._renderer.useFixedSizes=E.rendererUsesFixedSizes(this.layer.renderer);this._setUpdateViewNeeded()};
f.prototype._filterChanged=function(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()};f.prototype._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};f.prototype.displayNodes=function(a){this._workQueue=C.nodeDiff(b.keysOfSet(this._renderedNodes),a,this._index);C.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,this._index);C.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=
this._computeWork();this._updateLoading();this._layerIsVisible=0<a.length||this._loadingInitNodePage;this.notifyChange("suspended")};f.prototype.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};f.prototype._cancelNodeLoading=function(){var a=[];this._loadingNodes.forEach(function(b){return a.push(b)});this._loadingNodes.clear();for(var b=0;b<a.length;b++)a[b].cancel();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};
f.prototype._updateQueues=function(){var a=this,b=new Set;this._workQueue.forEach(function(a){a.load.forEach(function(a){b.add(a)})});var c=[],d=new Map;this._loadingNodes.forEach(function(a,e){b.has(e)?d.set(e,a):c.push(a)});this._loadingNodes=d;for(var e=0;e<c.length;e++)c[e].cancel();this._workQueue=this._workQueue.filter(function(b){var c=0;for(b=b.load;c<b.length;c++)if(a._loadingNodes.has(b[c]))return!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};f.prototype._cancelIndexLoading=
function(){this._indexQueue=[];this._indexPagesLoading.forEach(function(a){return a.cancel()});this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};f.prototype._clearNodeState=function(){var a=this;this._renderedNodes.forEach(function(b){return a._removeFromRenderer(b)});this._cancelNodeLoading()};f.prototype._idleBegin=function(){this._setUpdateViewNeeded()};f.prototype._idleEnd=function(){this._setUpdateViewNeeded()};f.prototype._process=function(a){var b=this;
if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,a=this._isRootNodeVisible(),a!==this._layerIsVisible&&(this._layerIsVisible=a,this.notifyChange("suspended")));else{for(this._updateViewNeeded&&a.run(function(){return b._updateWorkQueues()});0<this._indexQueue.length&&a.run(function(){return b._processIndexQueue()}););for(this._processWorkQueue(a);0<this._idleQueue.length()&&a.run(function(){return b._idleQueue.process()}););}};f.prototype._processIndexQueue=function(){var a=this,
b=this._indexQueue.shift();this._indexPagesLoading.set(b,this._loadNodePage(b));this._indexPagesLoading.get(b).then(function(c){a._index.addPage(b,c,a._elevationOffset);a._setUpdateViewNeeded()}).then(function(){a._indexPagesLoading.delete(b)},function(){a._indexPagesLoading.delete(b)})};f.prototype._processWorkQueue=function(a){for(;!a.done();){var b=this._scheduleWorkEntry();if(!b)break;this._processWorkEntry(b)}};f.prototype._scheduleWorkEntry=function(){var a=this;if(8<=this._loadingNodes.size)return null;
for(var b=0;b<this._workQueue.length;++b){var c=this._workQueue[b];if(!e.find(c.remove,function(b){return!a._renderedNodes.has(b)})){for(;0<b;--b)this._workQueue[b]=this._workQueue[b-1];this._workQueue.shift();return c}}return null};f.prototype._processWorkEntry=function(a){var b=this;if(0===a.load.length)for(var c=0;c<a.remove.length;c++)this._removeFromRenderer(a.remove[c]);else d.all(a.load.map(function(a){var c=b._memCache.pop(a.toString());c?b._loadingNodes.set(a,d.resolve(c)):b._loadingNodes.has(a)||
b._loadingNodes.set(a,b.loadNode(a));return b._loadingNodes.get(a)})).then(function(c){for(var d=0;d<a.load.length;d++)if(c[d]){var e=b._setupRendererData(a.load[d],c[d]);b._addToRenderer(e)}for(d=0;d<a.remove.length;d++)b._removeFromRenderer(a.remove[d])}).catch(function(){}).then(function(){for(var c=0;c<a.load.length;c++)b._loadingNodes.delete(a.load[c]);b._updateLoading()}),this._updateLoading()};f.prototype._computeWork=function(){for(var a=0,b=0;b<this._workQueue.length;b++)a+=this._workQueue[b].load.length;
a+=this._loadingNodes.size;a+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;a+=this._loadingInitNodePage?100:0;return a+=this._updateViewNeeded?100:0};Object.defineProperty(f.prototype,"updatingPercentageValue",{get:function(){var a=this._computeWork();return 100*Math.min(this._totalWork,a)/this._totalWork},enumerable:!0,configurable:!0});f.prototype._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingPercentageValue")};f.prototype.canResume=
function(){return this.inherited(arguments)&&this._layerIsVisible};f.prototype.isUpdating=function(){return 0<this._computeWork()};f.prototype._initNodePages=function(){var a=this,b=this.layer.store.index;this._index=new D(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,b.nodesPerPage||b.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");
this._updateLoading();this._pageMultiplier=null!=b.nodesPerPage?1:b.nodePerIndexBlock;return this._loadNodePage(0).then(function(b){a._index.addPage(0,b,a._elevationOffset);a._loadingInitNodePage=!1;a._setUpdateViewNeeded()})};f.prototype._loadNodePage=function(a){var b=this;return this._requestJSON(this.baseUrl+"/nodepages/"+a*this._pageMultiplier).then(function(c){return c.data.nodes.map(function(c,d){return{resourceId:null!=c.resourceId?c.resourceId:a*b._index.pageSize+d,obb:c.obb,firstChild:c.firstChild,
childCount:c.childCount,vertexCount:null!=c.vertexCount?c.vertexCount:c.pointCount,lodThreshold:null!=c.lodThreshold?c.lodThreshold:c.effectiveArea}})})};f.prototype._updateWorkQueues=function(){for(var a=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),b=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),e=Math.sqrt(d/(.75*b));d>b;)a*=e,c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),
e=Math.sqrt(2);this.displayNodes(c);this._updateViewNeeded=!1;this._updateLoading()};f.prototype._computePointCount=function(a){for(var b=0,c=0;c<a.length;c++){var d=this._index.getNode(a[c]);d&&(b+=d.vertexCount)}return b};f.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryFactor};f.prototype._isRootNodeVisible=function(){var a=!1;this._traverseVisible({frustumPlanes:this.view.state.camera.frustum.planes,clippingBox:this._clippingBox},{predicate:function(b,c,d){a=
d;return!1},pageMiss:function(a,b){}});return a};f.prototype._computeNodesForMinimumDensity=function(a){var b=this,c=this.view.state.camera,d=c.frustum,e=this._clippingBox,g=c.viewForward,f=t.vec3.dot(g,c.eye),h=I.plane.fromNormalAndOffset(g,-f,O),k=c.perPixelRatio,l=a*a,m=this._nodeIdArray;m.length=0;this._traverseVisible({frustumPlanes:d.planes,clippingBox:e},{predicate:function(a,c,d){if(!d)return!1;if(0===c.childCount)return m.push(a),!1;d=b._index.getRenderObb(a);return b._computeAveragePixelArea(d,
c.lodThreshold,c.vertexCount,h,k)<=l?(m.push(a),!1):!0},pageMiss:function(a,c){m.push(a);0>b._indexQueue.indexOf(c)&&b._indexQueue.push(c)}});return m};f.prototype._computeAveragePixelArea=function(a,b,c,d,e){a=Math.max(1E-7,N.minimumDistancePlane(a,d));return b/(a*a)/(4*e*e)/c};f.prototype.loadNode=function(a){var b=this,c=this._index.getNode(a),e=E.getRendererInfo(this.layer),g=E.getFilterInfo(this.layer),f=c.resourceId,h=[],k=function(a){a=b.loadAttribute(f,a);h.push(a);return a};return this._idleQueue.push().then(function(){var a=
b.loadGeometry(f);h.push(a);var c=k(e.primaryAttribute),l=k(e.modulationAttribute),m=g.map(function(a){return k(a.attributeInfo)});return d.all([a,c,l,d.all(m)])}).then(function(c){var d=c[0],f=c[1],h=c[2],k=c[3];c=[d];f&&c.push(f);h&&c.push(h);for(var l=0;l<k.length;l++)c.push(k[l]);d={geometryBuffer:d,primaryAttribute:f,modulationAttribute:h,filterAttributes:k,schema:b.layer.store.defaultGeometrySchema,rendererInfo:e,filterInfo:g,obb:b._index.getRenderObb(a),elevationOffset:b._elevationOffset,inSR:b.layer.spatialReference.toJSON(),
outSR:b.view.renderCoordsHelper.spatialReference.toJSON()};return b._worker.transform(d,c)}).catch(function(a){if(null==a||"CancelError"!==a.name&&"AbortError"!==a.name)P.error(a);else for(var b=0;b<h.length;b++)h[b].cancel();return d.reject(a)})};f.prototype.loadGeometry=function(a){return this._requestBinary(this.baseUrl+"/nodes/"+a+"/geometries/0").then(function(a){return a.data})};f.prototype.loadAttribute=function(a,b){return b&&b.storageInfo?this._requestBinary(this.baseUrl+"/nodes/"+a+"/attributes/"+
b.storageInfo.key).then(function(a){return a.data}):d.resolve(null)};f.prototype._requestJSON=function(a){return g(a,{query:{f:"json"},responseType:"json"})};f.prototype._requestBinary=function(a){return g(a,{responseType:"array-buffer"})};f.prototype._removeFromRenderer=function(a){if(this._renderedNodes.has(a)){var b=this._renderer.removeNode(a);this._renderedNodes.delete(a);this._memCache.put(b.id.toString(),b,5*b.coordinates.length+128)}};f.prototype._addToRenderer=function(a){this._renderedNodes.has(a.id)||
(this._renderedNodes.add(a.id),this._renderer.addNode(a))};f.prototype._setupRendererData=function(a,b){var c=this._index.getNode(a),d=Math.sqrt(c.lodThreshold/c.vertexCount),e=this._index.getRenderObb(a);if(G.isInstanceOfNode(b))return b.splatSize=d,b.obb=e,b.origin=t.vec3f32.clone(b.obb.center),b;if(b.obb.halfSize[0]>e.halfSize[0]||b.obb.halfSize[1]>e.halfSize[1]||b.obb.halfSize[2]>e.halfSize[2])0<this._maxLoggedBoxWarnings&&(P.warn("Node",a,"reported bounding box too small, got",e,"but points cover",
b.obb),0===--this._maxLoggedBoxWarnings&&P.warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(a,b.obb);return{id:a,coordinates:b.points,origin:t.vec3f32.clone(e.center),rgb:b.rgb,splatSize:d,obb:e,isLeaf:0===c.childCount}};f.prototype.getUsedMemory=function(){var a=this;return b.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+15*a._index.getNode(c).vertexCount+128},0)};f.prototype.getUnloadedMemory=function(){var a=this,c=this._renderedNodes.size;
if(4>c)return 0;for(var d=b.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount}),e=this._loadingNodes.size,g=0;g<this._workQueue.length;g++)e+=this._workQueue[g].load.length,e-=this._workQueue[g].remove.length;return 0>e?0:e*d/c*15+128*e};f.prototype.ignoresMemoryFactor=function(){return!1};f.prototype.getStats=function(){var a=this;return{"Rendered Nodes":this._renderedNodes.size,"Rendered Points":b.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+
a._index.getNode(c).vertexCount},0),"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length()}};a([q.property()],f.prototype,"layer",void 0);a([q.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],f.prototype,"baseUrl",void 0);a([q.property({readOnly:!0,dependsOn:["layer.renderer"]})],f.prototype,"pointScale",null);a([q.property({readOnly:!0,dependsOn:["layer.renderer"]})],f.prototype,"useRealWorldSymbolSizes",
null);a([q.property({readOnly:!0,dependsOn:["layer.renderer"]})],f.prototype,"pointSize",null);a([q.property({readOnly:!0,dependsOn:["layer.renderer"]})],f.prototype,"inverseDensity",null);a([q.property()],f.prototype,"maximumPointCount",void 0);a([q.property({readOnly:!0,dependsOn:["view.clippingArea"]})],f.prototype,"_clippingBox",null);a([q.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],f.prototype,"_elevationOffset",null);a([q.property({type:Boolean})],f.prototype,"slicePlaneEnabled",
void 0);a([q.property(H.updatingPercentage)],f.prototype,"updatingPercentage",void 0);a([q.property({readOnly:!0})],f.prototype,"updatingPercentageValue",null);return f=a([q.subclass("esri.views.3d.layers.PointCloudLayerView3D")],f)}(q.declared(x))})},"esri/views/3d/layers/PointCloudWorker":function(){define("require exports ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/SpatialReference ./i3s/I3SBinaryReader ./i3s/LEPCC ./i3s/PointCloudRendererUtil ../support/projectionUtils".split(" "),
function(p,f,k,a,g,b,e,c,d){p=function(){function f(){}f.prototype.transform=function(a,b){return this.thread?this.thread.invoke("_process",a,{transferList:b}):k.resolve(this._transform(a))};f.prototype._process=function(a){a=this._transform(a);return k.resolve({result:a,transferList:[a.points.buffer,a.rgb.buffer]})};f.prototype._transform=function(a){var b=this.readGeometry(a.schema,a.geometryBuffer),d=b.length/3,e=c.evaluateRenderer(a.rendererInfo,a.primaryAttribute,a.modulationAttribute,b,d);a.filterInfo&&
0<a.filterInfo.length&&(d=c.filterInPlace(b,e,a.filterInfo,a.filterAttributes));3*d<e.length&&(e=new Uint8Array(e.buffer.slice(0,3*d)));this._applyElevationOffsetInPlace(b,d,a.elevationOffset);b=this._transformCoordinates(b,d,a.obb,g.fromJSON(a.inSR),g.fromJSON(a.outSR));return{obb:a.obb,points:b,rgb:e}};f.prototype.readGeometry=function(a,c){if(null==a.encoding||""===a.encoding){a=b.createGeometryDataIndex(c,a,!1);c=b.createTypedView(c,a.vertexAttributes.position);var d=a.header.fields;a=[d.offsetX,
d.offsetY,d.offsetZ];for(var d=[d.scaleX,d.scaleY,d.scaleZ],g=c.length/3,f=new Float64Array(3*g),h=0;h<g;h++)f[3*h]=c[3*h]*d[0]+a[0],f[3*h+1]=c[3*h+1]*d[1]+a[1],f[3*h+2]=c[3*h+2]*d[2]+a[2];return f}if("lepcc-xyz"===a.encoding)return e.decodeXYZ(c).result};f.prototype._transformCoordinates=function(b,c,e,g,f){if(!d.bufferToBuffer(b,g,0,b,f,0,c))throw Error("Can't reproject");g=a.vec3f32.fromValues(e.center[0],e.center[1],e.center[2]);f=a.vec3f32.create();var h=a.vec3f32.create();a.quat.conjugate(m,
e.quaternion);for(var k=new Float32Array(3*c),l=0;l<c;l++)f[0]=b[3*l]-g[0],f[1]=b[3*l+1]-g[1],f[2]=b[3*l+2]-g[2],a.vec3.transformQuat(h,f,m),e.halfSize[0]=Math.max(e.halfSize[0],Math.abs(h[0])),e.halfSize[1]=Math.max(e.halfSize[1],Math.abs(h[1])),e.halfSize[2]=Math.max(e.halfSize[2],Math.abs(h[2])),k[3*l]=f[0],k[3*l+1]=f[1],k[3*l+2]=f[2];return k};f.prototype._applyElevationOffsetInPlace=function(a,b,c){if(0!==c)for(var d=0;d<b;d++)a[3*d+2]+=c};return f}();var m=a.quatf32.create();return p})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("require exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC".split(" "),
function(p,f,k,a,g,b){function e(a,b,c){for(var d="",e=0;e<c;){var g=a[b+e];if(128>g)d+=String.fromCharCode(g),e++;else if(192<=g&&224>g){if(e+1>=c)throw new k("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var f=a[b+e+1],g=(g&31)<<6|f&63,d=d+String.fromCharCode(g),e=e+2}else if(224<=g&&240>g){if(e+2>=c)throw new k("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");var f=a[b+e+1],h=a[b+e+2],g=(g&15)<<12|(f&63)<<6|h&63,d=d+String.fromCharCode(g),
e=e+3}else if(240<=g&&248>g){if(e+3>=c)throw new k("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");f=a[b+e+1];h=a[b+e+2];g=(g&7)<<18|(f&63)<<12|(h&63)<<6|a[b+e+3]&63;d=65536<=g?d+String.fromCharCode((g-65536>>10)+55296,(g&1023)+56320):d+String.fromCharCode(g);e+=4}else throw new k("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return d}function c(a,b){for(var c={byteOffset:0,byteCount:0,fields:Object.create(null)},d=0,e=0;e<b.length;e++){var g=
b[e],h=g.valueType||g.type;c.fields[g.property]=(0,f.valueType2ArrayBufferReader[h])(a,d);d+=f.valueType2TypedArrayClassMap[h].BYTES_PER_ELEMENT}c.byteCount=d;return c}function d(a,b,c){var d=[],g,f=0,h;for(h=0;h<a;h+=1){g=b[h];if(0<g){if(d.push(e(c,f,g-1)),0!==c[f+g-1])throw new k("string-array-error","Invalid string array: missing null termination.");}else d.push(null);f+=g}return d}function m(a,b){return new f.valueType2TypedArrayClassMap[b.valueType](a,b.byteOffset,b.count*b.valuesPerElement)}
function l(a,b){return new Uint8Array(a,b.byteOffset,b.byteCount)}function h(b,d,e){b=null!=d.header?c(b,d.header):{byteOffset:0,byteCount:0,fields:{count:e}};e={header:b,byteOffset:b.byteCount,byteCount:0,entries:Object.create(null)};for(var g=b.byteCount,f=0;f<d.ordering.length;f++){var h=d.ordering[f],l=a.clone(d[h]);l.count=b.fields.count;if("String"===l.valueType){if(l.byteOffset=g,l.byteCount=b.fields[h+"ByteCount"],"UTF-8"!==l.encoding)throw new k("unsupported-encoding","Unsupported String encoding.",
{encoding:l.encoding});}else if(q(l.valueType)){var m=t(l.valueType),g=g+(0!==g%m?m-g%m:0);l.byteOffset=g;l.byteCount=m*l.valuesPerElement*l.count}else throw new k("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});g+=l.byteCount;e.entries[h]=l}e.byteCount=g-e.byteOffset;return e}function n(a,b,c){b!==a&&u.error("Invalid "+c+" buffer size\n expected: "+a+", actual: "+b+")");if(b<a)throw new k("buffer-too-small","Binary buffer is too small",{expectedSize:a,actualSize:b});
}function q(a){return f.valueType2TypedArrayClassMap.hasOwnProperty(a)}function t(a){return q(a)&&f.valueType2TypedArrayClassMap[a].BYTES_PER_ELEMENT}Object.defineProperty(f,"__esModule",{value:!0});var u=g.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");f.readHeader=c;f.readStringArray=d;f.createTypedView=m;f.createRawView=l;f.createAttributeDataIndex=h;f.createGeometryDataIndex=function(b,d,e){var g=c(b,d&&d.header),f=g.byteCount,h={header:g,byteOffset:g.byteCount,byteCount:0,vertexAttributes:a.clone(d.vertexAttributes)},
k=h.vertexAttributes;e||null==k.region||delete k.region;var g=g.fields,l=null!=g.vertexCount?g.vertexCount:g.count;for(e=0;e<d.ordering.length;e++){var m=d.ordering[e];null!=k[m]&&(k[m].byteOffset=f,k[m].count=l,f+=t(k[m].valueType)*k[m].valuesPerElement*l)}k=g.faceCount;if(d.faces&&k)for(h.faces=a.clone(d.faces),l=h.faces,e=0;e<d.ordering.length;e++)m=d.ordering[e],null!=l[m]&&(l[m].byteOffset=f,l[m].count=k,f+=t(l[m].valueType)*l[m].valuesPerElement*k);g=g.featureCount;if(d.featureAttributes&&d.featureAttributeOrder&&
g)for(h.featureAttributes=a.clone(d.featureAttributes),k=h.featureAttributes,e=0;e<d.featureAttributeOrder.length;e++)l=d.featureAttributeOrder[e],k[l].byteOffset=f,k[l].count=g,m=t(k[l].valueType),"UInt64"===k[l].valueType&&(m=8),f+=m*k[l].valuesPerElement*g;n(f,b.byteLength,"geometry");h.byteCount=f-h.byteOffset;return h};f.readBinaryAttribute=function(a,c,e){if("lepcc-rgb"===a.encoding)return b.decodeRGB(c);if("lepcc-intensity"===a.encoding)return b.decodeIntensity(c);if(null!=a.encoding&&""!==
a.encoding)throw new k("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");a["attributeByteCounts "]&&!a.attributeByteCounts&&(u.warn("Warning: Trailing space in 'attributeByteCounts '."),a.attributeByteCounts=a["attributeByteCounts "]);"ObjectIds"===a.ordering[0]&&a.hasOwnProperty("objectIds")&&(u.warn("Warning: Case error in objectIds"),a.ordering[0]="objectIds");e=h(c,a,e);n(e.byteOffset+e.byteCount,c.byteLength,"attribute");if(a=e.entries.attributeValues||e.entries.objectIds){if("String"===
a.valueType){e=e.entries.attributeByteCounts;var g=m(c,e);c=l(c,a);return d(e.count,g,c)}return m(c,a)}throw new k("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};f.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array};f.valueType2ArrayBufferReader={Float32:function(a,b){return(new DataView(a,0)).getFloat32(b,!0)},Float64:function(a,b){return(new DataView(a,
0)).getFloat64(b,!0)},UInt8:function(a,b){return(new DataView(a,0)).getUint8(b)},Int8:function(a,b){return(new DataView(a,0)).getInt8(b)},UInt16:function(a,b){return(new DataView(a,0)).getUint16(b,!0)},Int16:function(a,b){return(new DataView(a,0)).getInt16(b,!0)},UInt32:function(a,b){return(new DataView(a,0)).getUint32(b,!0)},Int32:function(a,b){return(new DataView(a,0)).getInt32(b,!0)}};f.isValueType=q;f.getBytesPerValue=t})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["require","exports",
"../../../../core/Error"],function(p,f,k){function a(a,b,g){return{identifier:String.fromCharCode.apply(null,new Uint8Array(a,g+e.identifierOffset,e.identifierLength)),version:b.getUint16(g+e.versionOffset,!0),checksum:b.getUint32(g+e.checksumOffset,!0)}}function g(a,d,e){var c=[];d=b(a,d,c);for(var g=[],f=0;f<c.length;f++){g.length=0;d=b(a,d,g);for(var k=0;k<g.length;k++)e.push(g[k]+c[f])}return d}function b(a,b,e){var c=new DataView(a,b),d=c.getUint8(0),g=d&31,f=!!(d&32),m=(d&192)>>6,d=0;if(0===
m)d=c.getUint32(1,!0),b+=5;else if(1===m)d=c.getUint16(1,!0),b+=3;else if(2===m)d=c.getUint8(1),b+=2;else throw new k("lepcc-decode-error","Bad count type");if(f)throw new k("lepcc-decode-error","LUT not implemented");a=new Uint8Array(a,b,Math.ceil(d*g/8));for(var m=f=c=0,p=-1>>>32-g,r=0;r<d;r++){for(;f<g;)c|=a[m]<<f,f+=8,m+=1;e[r]=c&p;c>>>=g;f-=g;32<f+g&&(c|=a[m-1]>>8-f)}return b+m}Object.defineProperty(f,"__esModule",{value:!0});var e={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,
byteCount:16};f.decodeXYZ=function(b){var c,f,l,h,n,q,t,p,r,y,x,z,w=new DataView(b,0),B=0;h=a(b,w,B);l=h.identifier;h=h.version;B+=e.byteCount;if("LEPCC     "!==l)throw new k("lepcc-decode-error","Bad identifier");if(1<h)throw new k("lepcc-decode-error","Unknown version");var C=B;c=w.getUint32(C+0,!0);f=w.getUint32(C+4,!0);l=w.getFloat64(C+8,!0);h=w.getFloat64(C+16,!0);n=w.getFloat64(C+24,!0);q=w.getFloat64(C+32,!0);t=w.getFloat64(C+40,!0);p=w.getFloat64(C+48,!0);r=w.getFloat64(C+56,!0);y=w.getFloat64(C+
64,!0);x=w.getFloat64(C+72,!0);z=w.getUint32(C+80,!0);w.getUint32(C+84,!0);B+=88;if(f*Math.pow(2,32)+c!==b.byteLength)throw new k("lepcc-decode-error","Bad size");w=new Float64Array(3*z);c=[];f=[];z=[];C=[];B=g(b,B,c);B=g(b,B,f);B=g(b,B,z);B=g(b,B,C);if(B!==b.byteLength)throw new k("lepcc-decode-error","Bad length");for(var D=B=b=0;D<c.length;D++)for(var B=B+c[D],E=0,G=0;G<f[D];G++){var E=E+z[b],H=C[b];w[3*b]=Math.min(q,l+2*r*E);w[3*b+1]=Math.min(t,h+2*y*B);w[3*b+2]=Math.min(p,n+2*x*H);b++}return{errorX:r,
errorY:y,errorZ:x,result:w}};f.decodeRGB=function(b){var c,g,f,h,n,q,t=new DataView(b,0),p=0;h=a(b,t,p);f=h.identifier;h=h.version;p+=e.byteCount;if("ClusterRGB"!==f)throw new k("lepcc-decode-error","Bad identifier");if(1<h)throw new k("lepcc-decode-error","Unknown version");q=p;c=t.getUint32(q+0,!0);g=t.getUint32(q+4,!0);f=t.getUint32(q+8,!0);h=t.getUint16(q+12,!0);n=t.getUint8(q+14);q=t.getUint8(q+15);p+=16;if(g*Math.pow(2,32)+c!==b.byteLength)throw new k("lepcc-decode-error","Bad size");if(2!==
n&&1!==n||0!==q){if(0===n&&0===q){if(3*f+p!==b.byteLength||0!==h)throw new k("lepcc-decode-error","Bad count");return(new Uint8Array(b,p)).slice()}if(2>=n&&1===q){if(p+3!==b.byteLength||1!==h)throw new k("lepcc-decode-error","Bad count");h=t.getUint8(p);c=t.getUint8(p+1);t=t.getUint8(p+2);p=new Uint8Array(3*f);for(b=0;b<f;b++)p[3*b]=h,p[3*b+1]=c,p[3*b+2]=t;return p}throw new k("lepcc-decode-error","Bad method "+n+","+q);}if(3*h+f+p!==b.byteLength||256<h)throw new k("lepcc-decode-error","Bad count");
t=new Uint8Array(b,p,3*h);h=new Uint8Array(b,p+3*h,f);p=new Uint8Array(3*f);for(b=0;b<f;b++)c=h[b],p[3*b]=t[3*c],p[3*b+1]=t[3*c+1],p[3*b+2]=t[3*c+2];return p};f.decodeIntensity=function(c){var d,g,f,h,n,q=new DataView(c,0),t=0;h=a(c,q,t);f=h.identifier;h=h.version;t+=e.byteCount;if("Intensity "!==f)throw new k("lepcc-decode-error","Bad identifier");if(1<h)throw new k("lepcc-decode-error","Unknown version");var p=t;d=q.getUint32(p+0,!0);g=q.getUint32(p+4,!0);f=q.getUint32(p+8,!0);h=q.getUint16(p+12,
!0);n=q.getUint8(p+14);q.getUint8(p+15);t+=16;if(g*Math.pow(2,32)+d!==c.byteLength)throw new k("lepcc-decode-error","Bad size");q=new Uint16Array(f);if(8===n){if(f+t!==c.byteLength)throw new k("lepcc-decode-error","Bad size");n=new Uint8Array(c,t,f)}else if(16===n){if(2*f+t!==c.byteLength)throw new k("lepcc-decode-error","Bad size");n=new Uint16Array(c,t,f)}else if(n=[],b(c,t,n)!==c.byteLength)throw new k("lepcc-decode-error","Bad size");for(c=0;c<f;c++)q[c]=n[c]*h;return q}})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define("require exports ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader".split(" "),
function(p,f,k,a,g,b){function e(a){var b=0,c=0;for(a=a?a:[];c<a.length;c++)b|=1<<a[c];return b}function c(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b&&null!=d.attributeValues&&"UInt8"===d.attributeValues.valueType&&3===d.attributeValues.valuesPerElement)return{storageInfo:d,useElevation:!1}}return null}function d(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b)return a="embedded-elevation"===d.encoding,{storageInfo:a?null:d,useElevation:a}}return"elevation"===b.toLowerCase()?
{storageInfo:null,useElevation:!0}:null}function m(a,c,d,e){if(a&&a.useElevation){a=new Float64Array(e);for(c=0;c<e;c++)a[c]=d[3*c+2];return a}return a&&c?b.readBinaryAttribute(a.storageInfo,c,e):null}function l(a){return null==a||"none"===a?null:"low-four-bit"===a?function(a){return a&15}:"high-four-bit"===a?function(a){return(a&240)>>4}:"absolute-value"===a?function(a){return Math.abs(a)}:"modulo-ten"===a?function(a){return a%10}:null}Object.defineProperty(f,"__esModule",{value:!0});f.getRendererInfo=
function(a){var b=a.renderer,e=b&&b.type,g=b&&a.renderer.toJSON()||null,f=null,h=!1;"point-cloud-unique-value"===e?f=d(a.attributeStorageInfo,b.field):"point-cloud-stretch"===e?f=d(a.attributeStorageInfo,b.field):"point-cloud-class-breaks"===e?f=d(a.attributeStorageInfo,b.field):(f="point-cloud-rgb"===e?c(a.attributeStorageInfo,b.field):c(a.attributeStorageInfo,"RGB"),h=null!=f);e=null;b&&b.colorModulation&&(e=d(a.attributeStorageInfo,b.colorModulation.field));return{rendererJSON:g,isRGBRenderer:h,
primaryAttribute:f,modulationAttribute:e}};f.getFilterInfo=function(a){var b=a.filters;return b?b.map(function(b){return{filterJSON:b.toJSON(),attributeInfo:d(a.attributeStorageInfo,b.field)}}):[]};f.evaluateRenderer=function(b,c,d,e,f){var h=b.rendererJSON,n=b.isRGBRenderer,q=b.modulationAttribute;b=m(b.primaryAttribute,c,e,f);d=m(q,d,e,f);q=e=null;if(b&&n)e=b;else if(b&&"pointCloudUniqueValueRenderer"===h.type){var q=g.fromJSON(h),p=q.colorUniqueValueInfos;e=new Uint8Array(3*f);n=l(q.fieldTransformType);
for(h=0;h<f;h++){c=n?n(b[h]):b[h];c+="";for(var t=0;t<p.length;t++)if(0<=p[t].values.indexOf(c)){e[3*h]=p[t].color.r;e[3*h+1]=p[t].color.g;e[3*h+2]=p[t].color.b;break}}}else if(b&&"pointCloudStretchRenderer"===h.type)for(q=a.fromJSON(h),p=q.stops,e=new Uint8Array(3*f),n=l(q.fieldTransformType),h=0;h<f;h++)if(c=n?n(b[h]):b[h],t=p.length-1,c<p[0].value)e[3*h]=p[0].color.r,e[3*h+1]=p[0].color.g,e[3*h+2]=p[0].color.b;else if(c>=p[t].value)e[3*h]=p[t].color.r,e[3*h+1]=p[t].color.g,e[3*h+2]=p[t].color.b;
else for(t=1;t<p.length;t++){if(c<p[t].value){c=(c-p[t-1].value)/(p[t].value-p[t-1].value);e[3*h]=p[t].color.r*c+p[t-1].color.r*(1-c);e[3*h+1]=p[t].color.g*c+p[t-1].color.g*(1-c);e[3*h+2]=p[t].color.b*c+p[t-1].color.b*(1-c);break}}else if(b&&"pointCloudClassBreaksRenderer"===h.type)for(q=k.fromJSON(h),p=q.colorClassBreakInfos,e=new Uint8Array(3*f),n=l(q.fieldTransformType),h=0;h<f;h++)for(c=n?n(b[h]):b[h],t=0;t<p.length;t++){if(c>=p[t].minValue&&c<=p[t].maxValue){e[3*h]=p[t].color.r;e[3*h+1]=p[t].color.g;
e[3*h+2]=p[t].color.b;break}}else for(e=new Uint8Array(3*f),h=0;h<e.length;h++)e[h]=255;if(d&&q&&q.colorModulation)for(b=q.colorModulation.minValue,q=q.colorModulation.maxValue,h=0;h<f;h++)c=d[h],n=c>=q?1:c<=b?.3:.3+.7*(c-b)/(q-b),e[3*h]*=n,e[3*h+1]*=n,e[3*h+2]*=n;return e};f.filterInPlace=function(a,b,c,d){var g=a.length/3;d=d.map(function(b,d){return m(c[d].attributeInfo,b,a,g)});for(var f=0,h=0;h<g;h++){for(var k=!0,l=0;l<c.length&&k;l++){var n=c[l].filterJSON,q=d[l][h];switch(n.type){case "pointCloudValueFilter":var p=
"exclude"===n.mode;-1!==n.values.indexOf(q)===p&&(k=!1);break;case "pointCloudBitfieldFilter":p=e(n.requiredSetBits);n=e(n.requiredClearBits);if((q&p)!==p||0!==(q&n))k=!1;break;case "pointCloudReturnFilter":for(var t=q&15,E=q>>>4&15,q=1<E,p=1===t,t=t===E,E=!1,G=0,n=n.includedReturns;G<n.length;G++){var H=n[G];if("last"===H&&t||"firstOfMany"===H&&p&&q||"lastOfMany"===H&&t&&q||"single"===H&&!q){E=!0;break}}E||(k=!1)}}k&&(a[3*f]=a[3*h],a[3*f+1]=a[3*h+1],a[3*f+2]=a[3*h+2],b[3*f]=b[3*h],b[3*f+1]=b[3*h+
1],b[3*f+2]=b[3*h+2],f++)}return f};f.getSplatSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"splat"===a.type?a:null};f.getFixedSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"fixed-size"===a.type?a:null};f.rendererUsesFixedSizes=function(a){return(a=a&&a.pointSizeAlgorithm)&&a.type?"fixed-size"===a.type:!1}})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(p,f,k,a,g,b,e,c,d,m){return function(f){function h(a){a=f.call(this)||this;a.type="point-cloud-class-breaks";a.field=null;a.legendOptions=null;a.fieldTransformType=null;a.colorClassBreakInfos=null;return a}a(h,f);l=h;h.prototype.clone=function(){return new l(k({},this.cloneProperties(),{field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:b.clone(this.colorClassBreakInfos),legendOptions:b.clone(this.legendOptions)}))};var l;g([e.enumeration.serializable()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
h.prototype,"type",void 0);g([e.property({json:{write:!0},type:String})],h.prototype,"field",void 0);g([e.property({type:d.default,json:{write:!0}})],h.prototype,"legendOptions",void 0);g([e.property({type:c.fieldTransformTypeKebabDict.apiValues,json:{type:c.fieldTransformTypeKebabDict.jsonValues,read:c.fieldTransformTypeKebabDict.read,write:c.fieldTransformTypeKebabDict.write}})],h.prototype,"fieldTransformType",void 0);g([e.property({type:[m.default],json:{write:!0}})],h.prototype,"colorClassBreakInfos",
void 0);return h=l=g([e.subclass("esri.renderers.PointCloudClassBreaksRenderer")],h)}(e.declared(c))})},"esri/renderers/PointCloudRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/kebabDictionary ../core/lang ../core/accessorSupport/decorators ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmJSONUtils ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(p,f,k,
a,g,b,e,c,d,m,l){var h=b.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});p=function(b){function g(a){a=b.call(this)||this;a.type=void 0;a.pointSizeAlgorithm=null;a.colorModulation=null;a.pointsPerInch=10;return a}k(g,b);g.prototype.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);return null};g.prototype.cloneProperties=
function(){return{pointSizeAlgorithm:e.clone(this.pointSizeAlgorithm),colorModulation:e.clone(this.colorModulation),pointsPerInch:e.clone(this.pointsPerInch)}};a([c.property({type:h.apiValues,readOnly:!0,nonNullable:!0,json:{type:h.jsonValues,read:!1,write:h.write}})],g.prototype,"type",void 0);a([c.property({types:l.pointSizeAlgorithmTypes,json:{read:m.read,write:!0}})],g.prototype,"pointSizeAlgorithm",void 0);a([c.property({type:d.default,json:{write:!0}})],g.prototype,"colorModulation",void 0);
a([c.property({json:{write:!0},nonNullable:!0,type:Number})],g.prototype,"pointsPerInch",void 0);return g=a([c.subclass("esri.renderers.PointCloudRenderer")],g)}(c.declared(g));(p||(p={})).fieldTransformTypeKebabDict=b({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return p})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});p=function(e){function c(){var a=null!==e&&e.apply(this,arguments)||this;a.field=null;a.minValue=0;a.maxValue=255;return a}k(c,e);d=c;c.prototype.clone=function(){return new d({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};var d;a([b.property({type:String,json:{write:!0}})],c.prototype,"field",void 0);a([b.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"minValue",void 0);a([b.property({type:Number,
nonNullable:!0,json:{write:!0}})],c.prototype,"maxValue",void 0);return c=d=a([b.subclass("esri.renderers.support.pointCloud.ColorModulation")],c)}(b.declared(g));f.ColorModulation=p;f.default=p})},"esri/renderers/support/pointCloud/pointSizeAlgorithmJSONUtils":function(){define(["require","exports","../../../core/Warning","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});var b={pointCloudFixedSizeAlgorithm:a.default,
pointCloudSplatAlgorithm:g.default};f.read=function(a,c,d){if(c=a?b[a.type]||null:null)return c=new c,c.read(a,d),c;d&&d.messages&&a&&d.messages.push(new k("pointsizealgorithm:unsupported","Point size algorithms of type '"+(a.type||"unknown")+"' are not supported",{definition:a,context:d}));return null};f.fromJSON=function(a){var c=a?b[a.type]||null:null;return c?c.fromJSON(a):null}})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),
function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.type="fixed-size";a.size=0;a.useRealWorldSymbolSizes=null;return a}k(c,b);d=c;c.prototype.clone=function(){return new d({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};var d;a([g.enumeration.serializable()({pointCloudFixedSizeAlgorithm:"fixed-size"})],c.prototype,"type",void 0);a([g.property({type:Number,nonNullable:!0,json:{write:!0}})],
c.prototype,"size",void 0);a([g.property({type:Boolean,json:{write:!0}})],c.prototype,"useRealWorldSymbolSizes",void 0);return c=d=a([g.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],c)}(g.declared(b.default));f.PointSizeFixedSizeAlgorithm=p;f.default=p})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/JSONSupport ../../../core/kebabDictionary ../../../core/accessorSupport/decorators".split(" "),
function(p,f,k,a,g,b,e){Object.defineProperty(f,"__esModule",{value:!0});f.typeKebabDictionary=b({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});p=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}k(c,b);a([e.property({type:f.typeKebabDictionary.apiValues,readOnly:!0,nonNullable:!0,json:{type:f.typeKebabDictionary.jsonValues,read:!1,write:f.typeKebabDictionary.write}})],c.prototype,"type",void 0);return c=a([e.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],
c)}(e.declared(g));f.PointSizeAlgorithm=p;f.default=p})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),function(p,f,k,a,g,b){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.type="splat";a.scaleFactor=1;return a}k(c,b);
d=c;c.prototype.clone=function(){return new d({scaleFactor:this.scaleFactor})};var d;a([g.enumeration.serializable()({pointCloudSplatAlgorithm:"splat"})],c.prototype,"type",void 0);a([g.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],c.prototype,"scaleFactor",void 0);return c=d=a([g.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],c)}(g.declared(b.default));f.PointSizeSplatAlgorithm=p;f.default=p})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["require",
"exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(p,f,k,a,g){Object.defineProperty(f,"__esModule",{value:!0});f.pointSizeAlgorithmTypes={key:"type",base:k.default,typeMap:{"fixed-size":a.default,splat:g.default}}})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.description=null;a.label=null;a.minValue=0;a.maxValue=0;a.color=null;return a}k(f,b);h=f;f.prototype.clone=function(){return new h({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:e.clone(this.color)})};var h;a([c.property({type:String,json:{write:!0}})],f.prototype,"description",void 0);a([c.property({type:String,
json:{write:!0}})],f.prototype,"label",void 0);a([c.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],f.prototype,"minValue",void 0);a([c.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],f.prototype,"maxValue",void 0);a([c.property({type:g,json:{type:[d.Integer],write:!0}})],f.prototype,"color",void 0);return f=h=a([c.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],f)}(c.declared(b));f.ColorClassBreakInfo=
p;f.default=p})},"esri/renderers/PointCloudStretchRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/StopInfo".split(" "),function(p,f,k,a,g,b,e,c,d,m){return function(f){function h(a){a=f.call(this)||this;a.type="point-cloud-stretch";a.field=null;a.legendOptions=null;a.fieldTransformType=
null;a.stops=null;return a}a(h,f);l=h;h.prototype.clone=function(){return new l(k({},this.cloneProperties(),{field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),stops:b.clone(this.stops),legendOptions:b.clone(this.legendOptions)}))};var l;g([e.enumeration.serializable()({pointCloudStretchRenderer:"point-cloud-stretch"})],h.prototype,"type",void 0);g([e.property({json:{write:!0},type:String})],h.prototype,"field",void 0);g([e.property({type:d.default,json:{write:!0}})],h.prototype,
"legendOptions",void 0);g([e.property({type:c.fieldTransformTypeKebabDict.apiValues,json:{type:c.fieldTransformTypeKebabDict.jsonValues,read:c.fieldTransformTypeKebabDict.read,write:c.fieldTransformTypeKebabDict.write}})],h.prototype,"fieldTransformType",void 0);g([e.property({type:[m.default],json:{write:!0}})],h.prototype,"stops",void 0);return h=l=g([e.subclass("esri.renderers.PointCloudStretchRenderer")],h)}(e.declared(c))})},"esri/renderers/support/pointCloud/StopInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,"__esModule",{value:!0});p=function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.label=null;a.value=0;a.color=null;return a}k(f,b);h=f;f.prototype.clone=function(){return new h({label:this.label,value:this.value,color:e.clone(this.color)})};var h;a([c.property({type:String,json:{write:!0}})],f.prototype,"label",void 0);a([c.property({type:Number,nonNullable:!0,json:{write:!0}})],f.prototype,"value",void 0);a([c.property({type:g,
json:{type:[d.Integer],write:!0}})],f.prototype,"color",void 0);return f=h=a([c.subclass("esri.renderers.support.pointCloud.StopInfo")],f)}(c.declared(b));f.StopInfo=p;f.default=p})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(p,f,k,a,g,b,e,c,d,m){return function(f){function h(a){a=f.call(this)||this;a.type="point-cloud-unique-value";a.field=null;a.fieldTransformType=null;a.colorUniqueValueInfos=null;a.legendOptions=null;return a}a(h,f);l=h;h.prototype.clone=function(){return new l(k({},this.cloneProperties(),{field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),colorUniqueValueInfos:b.clone(this.colorUniqueValueInfos),legendOptions:b.clone(this.legendOptions)}))};var l;g([e.enumeration.serializable()({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],
h.prototype,"type",void 0);g([e.property({json:{write:!0},type:String})],h.prototype,"field",void 0);g([e.property({type:c.fieldTransformTypeKebabDict.apiValues,json:{type:c.fieldTransformTypeKebabDict.jsonValues,read:c.fieldTransformTypeKebabDict.read,write:c.fieldTransformTypeKebabDict.write}})],h.prototype,"fieldTransformType",void 0);g([e.property({type:[m.default],json:{write:!0}})],h.prototype,"colorUniqueValueInfos",void 0);g([e.property({type:d.default,json:{write:!0}})],h.prototype,"legendOptions",
void 0);return h=l=g([e.subclass("esri.renderers.PointCloudUniqueValueRenderer")],h)}(e.declared(c))})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(p,f,k,a,g,b,e,c,d){Object.defineProperty(f,"__esModule",{value:!0});
p=function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.description=null;a.label=null;a.values=null;a.color=null;return a}k(f,b);h=f;f.prototype.clone=function(){return new h({description:this.description,label:this.label,values:e.clone(this.values),color:e.clone(this.color)})};var h;a([c.property({type:String,json:{write:!0}})],f.prototype,"description",void 0);a([c.property({type:String,json:{write:!0}})],f.prototype,"label",void 0);a([c.property({type:[String],json:{write:!0}})],
f.prototype,"values",void 0);a([c.property({type:g,json:{type:[d.Integer],write:!0}})],f.prototype,"color",void 0);return f=h=a([c.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],f)}(c.declared(b));f.ColorUniqueValueInfo=p;f.default=p})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("require exports ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils ../../../../tasks/QueryTask ../../../../tasks/support/Query ./I3SBinaryReader ../../support/projectionUtils ../../support/buffer/typedArrayUtil".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t){function u(a){return a&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10)}function r(a,b,c,d,e,g){if(null!=c){var f=c.mbs;b!==d&&(f=P,q.mbsToMbs(c.mbs,d,f,b));if(0!==y(a,f)&&(g(c),c.children))for(f=0;f<c.children.length;++f)r(a,b,e[c.children[f].id],d,e,g)}}function y(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var g=0;if(c<a[0])var f=a[0]-c,g=g+f*f;d<a[1]&&(f=a[1]-d,g+=f*f);e<a[2]&&(f=a[2]-e,g+=f*f);c>a[3]&&(f=c-a[3],g+=f*f);d>a[4]&&(f=d-a[4],g+=f*f);e>a[5]&&
(f=e-a[5],g+=f*f);if(g>b*b)return 0;if(0<g)return 1;g=Infinity;c-a[0]<g&&(g=c-a[0]);d-a[1]<g&&(g=d-a[1]);e-a[2]<g&&(g=e-a[2]);a[3]-c<g&&(g=a[3]-c);a[4]-d<g&&(g=a[4]-d);a[5]-e<g&&(g=a[5]-e);return g>b?2:1}function x(a,b,c){var d=[],e=c&&c.missingFields;c=c&&c.originalFields;for(var g=0;g<a.length;g++){for(var f=a[g],h=f.toLowerCase(),k=!1,l=0,m=b;l<m.length;l++){var n=m[l];if(h===n.name.toLowerCase()){d.push(n.name);k=!0;c&&c.push(f);break}}!k&&e&&e.push(f)}return d}function z(a,b){return a.filter(function(a){return a.toLowerCase()!==
b.toLowerCase()}).concat([b])}function w(a,b,c,d){b.sort(function(a,b){return a.attributes[c]-b.attributes[c]});var e=b.map(function(a){return a.attributes[c]}),g=[],f=x(d,a.fields,{originalFields:g});return C(a,e,f).then(function(a){for(var c=0;c<b.length;c++){var d=b[c],e=a[c];d.attributes={};for(var h=0;h<g.length;h++)d.attributes[g[h]]=e[f[h]]}return b})}function B(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e in b.attributes||c.push(e)}return c}function C(a,c,d){if(null!=a.maxRecordCount&&
c.length>a.maxRecordCount){var e=G(c,a.maxRecordCount);return b.all(e.map(function(b){return C(a,b,d)})).then(H)}e=new h({objectIds:c,outFields:d,orderByFields:[a.objectIdField]});return(new l(a.parsedUrl.path)).execute(e).then(function(a){return a&&a.features&&a.features.length===c.length?a.features.map(function(a){return a.attributes}):b.reject(new g("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function D(a,c,d,f,h){for(var l=[],m=0;m<c.attributeData.length;m++){var q=
c.attributeData[m],r=a[m];r&&-1!==f.indexOf(r.name)&&(q=e.makeAbsolute(q.href,c.baseUrl),l.push({url:q,storageInfo:r}))}return b.eachAlways(l.map(function(a){return k(a.url,{responseType:"array-buffer"}).then(function(b){return n.readBinaryAttribute(a.storageInfo,b.data)})})).then(function(a){var c=[];if(!h.ignoreUnavailableFields&&a.some(function(a){return null==a.value})){for(var c=[],e=0;e<a.length;e++)null==a[e].value&&c.push({name:l[e].storageInfo.name,error:a[e].error});return b.reject(new g("scenelayer:attribute-request-failed",
"Request for scene layer attributes failed",{failedAttributes:c}))}for(var f=0;f<d.length;f++){for(var k=d[f],m={},e=0;e<a.length;e++)null!=a[e].value&&(m[l[e].storageInfo.name]=E(a[e].value,k));c.push(m)}return c})}function E(a,b){b=a[b];return t.isInt16Array(a)?b===O?null:b:t.isInt32Array(a)?b===W?null:b:b!==b?null:b}function G(a,b){var c=a.length;b=Math.ceil(c/b);for(var d=[],e=0;e<b;e++)d.push(a.slice(Math.floor(c*e/b),Math.floor(c*(e+1)/b)));return d}function H(a){for(var b=[],c=0;c<a.length;c++)b=
b.concat(a[c]);return b}function I(a){var b=new d(u(a.store.indexCRS||a.store.geographicCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function N(a){var b=new d(u(a.store.vertexCRS||a.store.projectedCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function S(a,b,c){if(!m.canProject(a,b))throw new g("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===c&&a.isGeographic)throw new g("layerview:local-gcs-not-supported",
"Geographic coordinate systems are not supported in local scenes",{});}function M(a,b,c){var d=I(a);a=N(a);S(d,b,c);S(a,b,c)}Object.defineProperty(f,"__esModule",{value:!0});f.DDS_ENCODING_STRING="image/vnd-ms.dds";f.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"];f.extractWkid=u;f.getAppropriateTextureEncoding=function(a,b){if(Array.isArray(a)){if(b&&(b=a.indexOf(f.DDS_ENCODING_STRING),-1<b))return b;for(b=0;b<a.length;b++)if(-1<f.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(a[b]))return b;
throw Error("Could not find appropriate texture encoding (among "+a.toString()+")");}return-1};f.findIntersectingNodes=r;f.buildTopNodeMap=function(a,b,c,d){void 0===d&&(d=Number.POSITIVE_INFINITY);if(0>=b)a.clear();else{var e=new Map,g=Number.POSITIVE_INFINITY;a.forEach(function(f,h){var k=c(f);if(h<b)g=Math.min(g,k),e.set(f.id,k);else if(!(k<=g||k>=d)){e.set(f.id,k);h=g=e.get(a.front().id);for(var k=0,l=1;l<b;++l){var m=e.get(a.data[l].id);m<g&&(k=l,h=g,g=m)}a.data[k]=f;g=h}});a.length=Math.min(a.length,
b);a.sort(function(a,b){return e.get(b.id)-e.get(a.id)})}};var P=c.vec4f64.create();f.intersectBoundingBoxWithMbs=y;f.findFieldsCaseInsensitive=x;f.whenGraphicAttributes=function(c,d,e,f,h,k){var l=!0===(k&&k.populateObjectId),m=k.ignoreUnavailableFields?void 0:[],n=1===f.length&&"*"===f[0];!n&&l&&(f=z(f,e));f=n?f:x(f,c.fields,{missingFields:m});if(m&&0!==m.length)return b.reject(new g("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:m}));if(0===d.length)return b.resolve(d);
var m=c.associatedLayer,q=c.attributeStorageInfo,r=n?c.fields.map(function(a){return a.name}):f;if(m)return w(m,d,e,r);var p=B(r,d[0]);return 0===p.length?b.resolve(d):q?(c=h(d))?b.all(c.map(function(a){return D(q,a.node,a.indices,p,k).then(function(b){for(var c=0;c<a.graphics.length;c++){for(var d=0,e=r;d<e.length;d++){var g=e[d];g in b[c]||(b[c][g]=a.graphics[c].attributes[g])}a.graphics[c].attributes=b[c]}return a.graphics})})).then(a.concatAll):b.reject(new g("scenelayer:features-not-loaded",
"Tried to query attributes for unloaded features")):b.reject(new g("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var O=-Math.pow(2,15),W=-Math.pow(2,31);f.getCachedAttributeValue=E;f.convertFlatRangesToOffsets=function(a,b,c){void 0===c&&(c=2);b=null!=b?b:a.length/c;for(var d=new Uint32Array(b+1),e=0;e<b;e++){var f=a[e*c];d[e]=3*f;var h=(e-1)*c+1;if(0<=h&&f-1!==a[h])throw new g("Face ranges are not continuous");}d[d.length-1]=3*(a[(b-1)*c+1]+
1);return d};f.getIndexCrs=I;f.getVertexCrs=N;f.getCacheKeySuffix=function(a,b){return b===q.SphericalECEFSpatialReference?"@ECEF":a.equals(b)?"":null!=b.wkid?"@"+b.wkid:null};f.checkSpatialReference=S;f.checkSpatialReferences=M;f.checkSceneLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,b=!!(null!=a.geometryType&&"triangles"!==a.geometryType||null!=a.topology&&"PerAttributeArray"!==a.topology||null==a.vertexAttributes||null==a.vertexAttributes.position));
if(b)throw new g("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{});};f.checkSceneLayerCompatibleWithView=function(a,b){M(a,b.spatialReference,b.viewingMode)};f.checkPointCloudLayerValid=function(a){var b;(b=null==a.store||null==a.store.defaultGeometrySchema)||(a=a.store.defaultGeometrySchema,b=!!(null==a.geometryType||"points"!==a.geometryType||null!=a.topology&&"PerAttributeArray"!==a.topology||null!=a.encoding&&""!==a.encoding&&"lepcc-xyz"!==
a.encoding||null==a.vertexAttributes||null==a.vertexAttributes.position));if(b)throw new g("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};f.checkPointCloudLayerCompatibleWithView=function(a,b){S(a.spatialReference,b.spatialReference,b.viewingMode)};f.rendererNeedsTextures=function(a){if(null==a||"simple"!==a.type&&"class-breaks"!==a.type&&"unique-value"!==a.type||("unique-value"===a.type||"class-breaks"===a.type)&&null==a.defaultSymbol)return!0;
a=a.getSymbols();if(0===a.length)return!0;for(var b=0;b<a.length;b++){var c=a[b];if("mesh-3d"!==c.type||0===c.symbolLayers.length)return!0;for(var d=0,c=c.symbolLayers.items;d<c.length;d++){var e=c[d];if("fill"!==e.type||null==e.material||"replace"!==e.material.colorMixMode)return!0}}return!1};var Q=function(){return function(){this.material=this.edges=null}}();f.SymbolInfo=Q;f.getSymbolInfo=function(a){var b=new Q,c=!1,d=!1,e=0;for(a=a.symbolLayers.items;e<a.length;e++){var g=a[e];if("fill"===g.type&&
g.enabled){var f=g.material,h=g.edges;f&&!c&&(c=f.color,b.material={color:c?[c.r/255,c.g/255,c.b/255]:null,alpha:c?c.a:null,colorMixMode:f.colorMixMode},c=!0);h&&!d&&(b.edges=g.edges,d=!0)}}return b}})},"esri/views/3d/layers/i3s/IdleQueue":function(){define(["require","exports","dojo/errors/CancelError","../../../../core/promiseUtils"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function g(){this._deferreds=[];this._values=[]}g.prototype.push=function(b){var e=
this;return a.create(function(a,d){e._deferreds.push({resolve:a,reject:d});e._values.push(b)})};g.prototype.unshift=function(b){var e=this;return a.create(function(a,d){e._deferreds.unshift({resolve:a,reject:d});e._values.unshift(b)})};g.prototype.length=function(){return this._deferreds.length};g.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())};g.prototype.cancelAll=function(){for(var a=new k,e=0,c=this._deferreds;e<c.length;e++)c[e].reject(a);this._deferreds.length=
0;this._values.length=0};return g}();f.IdleQueue=p})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix"],function(p,f,k){function a(a,b,c){for(;0<a;){var d=b.indexOf(a);if(0<=d)return d;a=c.getParentId(a)}return b.indexOf(a)}function g(a,b){for(var c=[a.remove[0]],d=[];1===c.length;)for(var e=c.pop(),g=d.length=0;g<a.load.length;g++){for(var f=a.load[g],k=b.getParentId(f);k!==e;)f=k,k=b.getParentId(f);k=c.indexOf(f);0>k&&(k=c.length,
c.push(f),d.push([]));d[k].push(a.load[g])}b=[];b.push({remove:a.remove,load:c});for(g=0;g<c.length;g++)1<d[g].length?b.push({remove:[c[g]],load:d[g]}):c[g]=d[g][0];return b}Object.defineProperty(f,"__esModule",{value:!0});f.nodeDiff=function(g,f,h){for(var k=0;k<f.length;k++)c[k]=!1,d[k]=null;for(k=0;k<g.length;k++)b[k]=!1,e[k]=null;for(k=0;k<f.length;k++){var l=a(f[k],g,h);0<=l&&(c[k]=!0,null!=e[l]?e[l].push(f[k]):e[l]=[f[k]])}for(k=0;k<g.length;k++)l=a(g[k],f,h),0<=l&&(b[k]=!0,null!=d[l]?d[l].push(g[k]):
d[l]=[g[k]]);h=[];for(k=0;k<g.length;k++)null!=e[k]||b[k]||h.push({load:[],remove:[g[k]]});for(k=0;k<f.length;k++)null!=d[k]||c[k]||h.push({load:[f[k]],remove:[]});for(k=0;k<f.length;k++)null!=d[k]&&(1<d[k].length||d[k][0]!==f[k])&&h.push({load:[f[k]],remove:d[k]});for(k=0;k<g.length;k++)null!=e[k]&&(1<e[k].length||e[k][0]!==g[k])&&h.push({load:e[k],remove:[g[k]]});return h};var b=[!1],e=[null],c=[!1],d=[null];f.sortFrontToBack=function(a,b,c){return a.sort(function(a,d){if(0===a.load.length&&0===
d.load.length)return 0;if(0===a.load.length)return-1;if(0===d.load.length)return 1;if(0===a.remove.length&&0===d.remove.length)return a=c.getRenderCenter(a.load[0]),d=c.getRenderCenter(d.load[0]),k.vec3.dot(a,b)-k.vec3.dot(d,b);if(0===a.remove.length)return-1;if(0===d.remove.length)return 1;if(1===a.load.length&&1===d.load.length)return a=c.getRenderCenter(a.load[0]),d=c.getRenderCenter(d.load[0]),k.vec3.dot(a,b)-k.vec3.dot(d,b);if(1===a.load.length)return-1;if(1===d.load.length)return 1;a=c.getRenderCenter(a.remove[0]);
d=c.getRenderCenter(d.remove[0]);return k.vec3.dot(a,b)-k.vec3.dot(d,b)})};f.splitWorkEntries=function(a,b,c){for(var d=0;d<a.length;++d){var e=a[d];if(e.load.length>b&&1===e.remove.length){e=g(e,c);a[d]=e[0];for(var f=1;f<e.length;f++)a.push(e[f])}}};f.splitWorkEntry=g})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ../../support/orientedBoundingBox ../../support/projectionUtils".split(" "),
function(p,f,k,a,g,b){var e=k.vec3f64.create();p=function(){function f(a,b,c){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=a;this._renderSR=b;this.pageSize=c}f.prototype.addPage=function(a,f,m){for(void 0===m&&(m=0);this._pages.length<a;)this._pages.push(null);for(var h=this._nodeSR,l=this._renderSR,n=new g.ObbArray(f.length),r=0;r<f.length;r++){var p=f[r].obb,x=n.obbs[r];g.set(p,x);k.vec3.set(e,p.center[0],p.center[1],p.center[2]+m);h.isGeographic||l!==b.SphericalECEFSpatialReference||
(b.computeLinearTransformation(h,e,c,l),p=2*Math.sqrt(1+c[0]+c[5]+c[10]),d[0]=(c[9]-c[6])/p,d[1]=(c[2]-c[8])/p,d[2]=(c[4]-c[1])/p,d[3]=.25*p,k.quat.conjugate(d,d),k.quat.multiply(x.quaternion,d,x.quaternion));b.bufferToBuffer(e,h,0,x.center,l,0,1)}this._pages[a]={nodes:f,renderObbs:n.obbs,parents:new Uint32Array(this.pageSize)};a=this._pages;f=this.pageSize;for(h=[0];h.length;)for(l=h.pop(),m=a[l/f|0].nodes[l%f],n=0;n<m.childCount;n++)r=m.firstChild+n,null!=a[r/f|0]&&(a[r/f|0].parents[r%f]=l,h.push(r))};
f.prototype.hasPage=function(a){return!!this._pages[a]};f.prototype.getNode=function(a){var b=this.pageSize;return this._pages[a/b|0].nodes[a%b]};f.prototype.getRenderObb=function(a){var b=this.pageSize;return this._pages[a/b|0].renderObbs[a%b]};f.prototype.getRenderCenter=function(a){return this.getRenderObb(a).center};f.prototype.setRenderObb=function(a,b){var c=this.pageSize;g.set(b,this._pages[a/c|0].renderObbs[a%c])};f.prototype.getParentId=function(a){var b=this.pageSize;return this._pages[a/
b|0].parents[a%b]};f.prototype.hasNodes=function(a,b){b=(a+b-1)/this.pageSize|0;for(a=a/this.pageSize|0;a<=b;a++)if(null==this._pages[a])return!1;return!0};f.prototype.createVisibilityTraverse=function(){var b=this,c=[],d=[],e=a.create();return function(f,h){if(b.hasNodes(0,1))for(c.length=0,c.push(0),d.length=0,d.push(0);0<c.length;){var k=c.pop(),l=d.pop(),m=b.getNode(k),n=b.getRenderObb(k),q=!0;if(null!=f.clippingBox){var p=1<<f.frustumPlanes.length;if(0===(l&p)){var t=g.toAaBoundingBox(n,e);a.contains(f.clippingBox,
t)?l|=p:a.intersects(f.clippingBox,t)||(q=!1)}}for(t=0;t<f.frustumPlanes.length&&q;t++)if(p=1<<t,0===(l&p)){var u=g.intersectPlane(n,f.frustumPlanes[t]);0<u?q=!1:0>u&&(l|=p)}if(h.predicate(k,m,q)){n=m.firstChild;m=m.childCount;t=!1;q=(n+m-1)/b.pageSize|0;for(p=n/b.pageSize|0;p<=q;p++)if(!b.hasPage(p)){h.pageMiss(k,p);t=!0;break}if(!t)for(t=0;t<m;t++)c.push(n+t),d.push(l)}}}};return f}();var c=k.mat4f64.create(),d=k.quatf32.create();return p})},"esri/views/3d/support/orientedBoundingBox":function(){define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingBox ./dito ./geometryUtils".split(" "),
function(p,f,k,a,g,b){function e(a,b,c){return{center:k.vec3f64.clone(a),halfSize:k.vec3f32.clone(b),quaternion:k.quatf32.clone(c)}}function c(a,c){var e=b.plane.signedDistance(c,a.center);a=d(a,c);return e>a?1:e<-a?-1:0}function d(a,b){k.quat.conjugate(m,a.quaternion);k.vec3.transformQuat(l,b,m);a=a.halfSize;return Math.abs(l[0]*a[0])+Math.abs(l[1]*a[1])+Math.abs(l[2]*a[2])}Object.defineProperty(f,"__esModule",{value:!0});var m=k.quatf32.create(),l=k.vec3f32.create(),h=k.vec3f32.create(),n=k.mat3f32.create();
p=function(){return function(a){this.buffer=new ArrayBuffer(56*a);this.obbs=Array(a);for(var b=0;b<a;b++)this.obbs[b]={center:k.vec3f64.createView(this.buffer,56*b+0),halfSize:k.vec3f32.createView(this.buffer,56*b+24),quaternion:k.quatf32.createView(this.buffer,56*b+36)}}}();f.ObbArray=p;f.create=e;f.clone=function(a){return e(a.center,a.halfSize,a.quaternion)};f.set=function(a,b){k.vec3.copy(b.center,a.center);k.vec3.copy(b.halfSize,a.halfSize);k.quat.copy(b.quaternion,a.quaternion)};f.compute=function(a,
b){b||(b=e([0,0,0],[-1,-1,-1],[0,0,0,1]));g.computeOBB(a,b);return b};f.intersectPlane=c;f.toAaBoundingBox=function(b,c){c||(c=a.create());var d=k.mat3.fromQuat(n,b.quaternion),e=b.halfSize[0]*Math.abs(d[0])+b.halfSize[1]*Math.abs(d[3])+b.halfSize[2]*Math.abs(d[6]),g=b.halfSize[0]*Math.abs(d[1])+b.halfSize[1]*Math.abs(d[4])+b.halfSize[2]*Math.abs(d[7]),d=b.halfSize[0]*Math.abs(d[2])+b.halfSize[1]*Math.abs(d[5])+b.halfSize[2]*Math.abs(d[8]);c[0]=b.center[0]-e;c[1]=b.center[1]-g;c[2]=b.center[2]-d;
c[3]=b.center[0]+e;c[4]=b.center[1]+g;c[5]=b.center[2]+d;return c};f.minimumDistancePlane=function(a,c){var e=b.plane.signedDistance(c,a.center);a=d(a,c);return e-a};f.maximumDistancePlane=function(a,c){var e=b.plane.signedDistance(c,a.center);a=d(a,c);return e+a};f.isVisible=function(a,b){return 0>=c(a,b.planes[0])&&0>=c(a,b.planes[1])&&0>=c(a,b.planes[2])&&0>=c(a,b.planes[3])&&0>=c(a,b.planes[4])&&0>=c(a,b.planes[5])};f.intersectLine=function(a,b,c,d){void 0===d&&(d=0);k.quat.conjugate(m,a.quaternion);
k.vec3.subtract(l,b,a.center);b=k.vec3.transformQuat(l,l,m);c=k.vec3.transformQuat(h,c,m);for(var e=-Infinity,g=Infinity,f=0;3>f;f++)if(1E-6<Math.abs(c[f]))var n=(d+a.halfSize[f]-b[f])/c[f],r=(-d-a.halfSize[f]-b[f])/c[f],e=Math.max(e,Math.min(n,r)),g=Math.min(g,Math.max(n,r));else if(b[f]>a.halfSize[f]+d||b[f]<-a.halfSize[f]-d)return!1;return e<=g}})},"esri/views/3d/support/dito":function(){define(["require","exports","../../../core/libs/gl-matrix-2/gl-matrix"],function(p,f,k){function a(a,b,c,e,
f,h){if(!(1E-6>k.vec3.squaredLength(b)))for(k.vec3.cross(B,c,b),k.vec3.cross(C,e,b),k.vec3.cross(D,f,b),g(a,b,w),G[1]=w[0],E[1]=w[1],H[1]=E[1]-G[1],c=[c,e,f],e=[B,C,D],f=0;3>f;++f){g(a,c[f],w);G[0]=w[0];E[0]=w[1];g(a,e[f],w);G[2]=w[0];E[2]=w[1];H[0]=E[0]-G[0];H[2]=E[2]-G[2];var l=d(H);l<h.quality&&(k.vec3.copy(h.b0,c[f]),k.vec3.copy(h.b1,b),k.vec3.copy(h.b2,e[f]),h.quality=l)}}function g(a,b,c){var d=a.data,e=a.offsetIdx;a=a.strideIdx;c[0]=Number.POSITIVE_INFINITY;for(c[1]=Number.NEGATIVE_INFINITY;e<
d.length;e+=a){var g=d[e]*b[0]+d[e+1]*b[1]+d[e+2]*b[2];c[0]=Math.min(c[0],g);c[1]=Math.max(c[1],g)}}function b(a,b,c){k.vec3.copy(c.center,a);k.vec3.scale(c.halfSize,b,.5);k.quat.identity(c.quaternion)}function e(a,b,c,d,e,f){g(a,b,w);e[0]=w[0];f[0]=w[1];g(a,c,w);e[1]=w[0];f[1]=w[1];g(a,d,w);e[2]=w[0];f[2]=w[1]}function c(a,b,c,d,e,g,f){J[0]=a[0];J[1]=a[1];J[2]=a[2];J[3]=b[0];J[4]=b[1];J[5]=b[2];J[6]=c[0];J[7]=c[1];J[8]=c[2];k.quat.fromMat3(f.quaternion,J);k.vec3.add(F,d,e);k.vec3.scale(F,F,.5);k.vec3.scale(f.center,
a,F[0]);k.vec3.scale(Q,b,F[1]);k.vec3.add(f.center,f.center,Q);k.vec3.scale(Q,c,F[2]);k.vec3.add(f.center,f.center,Q);k.vec3.scale(f.halfSize,g,.5)}function d(a){return a[0]*a[1]+a[0]*a[2]+a[1]*a[2]}Object.defineProperty(f,"__esModule",{value:!0});var m=k.vec3f64.create(),l=k.vec3f64.create();f.computeOBB=function(g,f){var p=g.data.length/g.strideIdx;if(!(0>=p)){var B=new K(g);k.vec3.add(m,B.minProj,B.maxProj);k.vec3.scale(m,m,.5);k.vec3.subtract(l,B.maxProj,B.minProj);var C=d(l),F=new L;F.quality=
C;14>p&&(g={data:new Float64Array(B.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var D=k.vec3f64.create(),E=k.vec3f64.create(),R=k.vec3f64.create(),p=k.vec3f64.create(),G=k.vec3f64.create(),J=k.vec3f64.create(),H=k.vec3f64.create(),T;T=g;for(var Q=k.vec3.squaredDistance(B.maxVert[0],B.minVert[0]),V=0,ha=1;7>ha;++ha){var ma=k.vec3.squaredDistance(B.maxVert[ha],B.minVert[ha]);ma>Q&&(Q=ma,V=ha)}k.vec3.copy(D,B.minVert[V]);k.vec3.copy(E,B.maxVert[V]);if(1E-6>k.vec3.squaredDistance(D,E))T=1;else{k.vec3.subtract(p,
D,E);k.vec3.normalize(p,p);B=T.data;Q=T.strideIdx;V=Number.NEGATIVE_INFINITY;ha=0;for(ma=T.offsetIdx;ma<B.length;ma+=Q){k.vec3.set(z,B[ma]-D[0],B[ma+1]-D[1],B[ma+2]-D[2]);var ka=p[0]*z[0]+p[1]*z[1]+p[2]*z[2],ka=z[0]*z[0]+z[1]*z[1]+z[2]*z[2]-ka*ka/(p[0]*p[0]+p[1]*p[1]+p[2]*p[2]);ka>V&&(V=ka,ha=ma)}k.vec3.set(R,B[ha],B[ha+1],B[ha+2]);1E-6>V?T=2:(k.vec3.subtract(G,E,R),k.vec3.normalize(G,G),k.vec3.subtract(J,R,D),k.vec3.normalize(J,J),k.vec3.cross(H,G,p),k.vec3.normalize(H,H),a(T,H,p,G,J,F),T=0)}switch(T){case 1:b(m,
l,f);return;case 2:C=g;k.vec3.copy(N,p);Math.abs(p[0])>Math.abs(p[1])&&Math.abs(p[0])>Math.abs(p[2])?N[0]=0:Math.abs(p[1])>Math.abs(p[2])?N[1]=0:N[2]=0;1E-6>k.vec3.squaredLength(N)&&(N[0]=N[1]=N[2]=1);k.vec3.cross(S,p,N);k.vec3.normalize(S,S);k.vec3.cross(M,p,S);k.vec3.normalize(M,M);e(C,p,S,M,P,O);k.vec3.subtract(W,O,P);c(p,S,M,P,O,W,f);return}T=g;B=h;Q=n;V=w;ha=T.data;ka=T.offsetIdx;ma=T.strideIdx;k.vec3.set(Q,ha[ka],ha[ka+1],ha[ka+2]);k.vec3.copy(B,Q);V[0]=k.vec3.dot(I,H);V[1]=V[0];for(ka+=ma;ka<
ha.length;ka+=ma){var v=ha[ka]*H[0]+ha[ka+1]*H[1]+ha[ka+2]*H[2];v<V[0]&&(V[0]=v,k.vec3.set(Q,ha[ka],ha[ka+1],ha[ka+2]));v>V[1]&&(V[1]=v,k.vec3.set(B,ha[ka],ha[ka+1],ha[ka+2]))}H=k.vec3.dot(D,H);w[1]-1E-6<=H&&(B[0]=void 0);w[0]+1E-6>=H&&(Q[0]=void 0);void 0!==h[0]&&(k.vec3.subtract(q,h,D),k.vec3.normalize(q,q),k.vec3.subtract(t,h,E),k.vec3.normalize(t,t),k.vec3.subtract(u,h,R),k.vec3.normalize(u,u),k.vec3.cross(r,t,p),k.vec3.normalize(r,r),k.vec3.cross(y,u,G),k.vec3.normalize(y,y),k.vec3.cross(x,q,
J),k.vec3.normalize(x,x),a(T,r,p,t,q,F),a(T,y,G,u,t,F),a(T,x,J,q,u,F));void 0!==n[0]&&(k.vec3.subtract(q,n,D),k.vec3.normalize(q,q),k.vec3.subtract(t,n,E),k.vec3.normalize(t,t),k.vec3.subtract(u,n,R),k.vec3.normalize(u,u),k.vec3.cross(r,t,p),k.vec3.normalize(r,r),k.vec3.cross(y,u,G),k.vec3.normalize(y,y),k.vec3.cross(x,q,J),k.vec3.normalize(x,x),a(T,r,p,t,q,F),a(T,y,G,u,t,F),a(T,x,J,q,u,F));e(g,F.b0,F.b1,F.b2,P,O);g=k.vec3f64.create();k.vec3.subtract(g,O,P);F.quality=d(g);F.quality<C?c(F.b0,F.b1,
F.b2,P,O,g,f):b(m,l,f)}};var h=k.vec3f64.create(),n=k.vec3f64.create(),q=k.vec3f64.create(),t=k.vec3f64.create(),u=k.vec3f64.create(),r=k.vec3f64.create(),y=k.vec3f64.create(),x=k.vec3f64.create(),z=k.vec3f64.create(),w=k.vec2f64.create(),B=k.vec3f64.create(),C=k.vec3f64.create(),D=k.vec3f64.create(),E=k.vec3f64.create(),G=k.vec3f64.create(),H=k.vec3f64.create(),I=k.vec3f64.create(),N=k.vec3f64.create(),S=k.vec3f64.create(),M=k.vec3f64.create(),P=k.vec3f64.create(),O=k.vec3f64.create(),W=k.vec3f64.create(),
Q=k.vec3f64.create(),J=k.mat3f32.create(),F=k.vec3f64.create(),K=function(){return function(a){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var b=0;this.minProj=new Float64Array(this.buffer,b,7);b+=56;this.maxProj=new Float64Array(this.buffer,b,7);for(var b=b+56,c=0;7>c;++c)this.minVert[c]=k.vec3f64.createView(this.buffer,b),b+=24;for(c=0;7>c;++c)this.maxVert[c]=k.vec3f64.createView(this.buffer,b),b+=24;for(c=0;7>c;++c)this.minProj[c]=Number.POSITIVE_INFINITY,this.maxProj[c]=
Number.NEGATIVE_INFINITY;for(var b=Array(7),d=Array(7),e=a.data,g=a.strideIdx,c=a.offsetIdx;c<e.length;c+=g)a=e[c],a<this.minProj[0]&&(this.minProj[0]=a,b[0]=c),a>this.maxProj[0]&&(this.maxProj[0]=a,d[0]=c),a=e[c+1],a<this.minProj[1]&&(this.minProj[1]=a,b[1]=c),a>this.maxProj[1]&&(this.maxProj[1]=a,d[1]=c),a=e[c+2],a<this.minProj[2]&&(this.minProj[2]=a,b[2]=c),a>this.maxProj[2]&&(this.maxProj[2]=a,d[2]=c),a=e[c]+e[c+1]+e[c+2],a<this.minProj[3]&&(this.minProj[3]=a,b[3]=c),a>this.maxProj[3]&&(this.maxProj[3]=
a,d[3]=c),a=e[c]+e[c+1]-e[c+2],a<this.minProj[4]&&(this.minProj[4]=a,b[4]=c),a>this.maxProj[4]&&(this.maxProj[4]=a,d[4]=c),a=e[c]-e[c+1]+e[c+2],a<this.minProj[5]&&(this.minProj[5]=a,b[5]=c),a>this.maxProj[5]&&(this.maxProj[5]=a,d[5]=c),a=e[c]-e[c+1]-e[c+2],a<this.minProj[6]&&(this.minProj[6]=a,b[6]=c),a>this.maxProj[6]&&(this.maxProj[6]=a,d[6]=c);for(c=0;7>c;++c)a=b[c],k.vec3.set(this.minVert[c],e[a],e[a+1],e[a+2]),a=d[c],k.vec3.set(this.maxVert[c],e[a],e[a+1],e[a+2])}}(),L=function(){return function(){this.b0=
k.vec3f64.fromValues(1,0,0);this.b1=k.vec3f64.fromValues(0,1,0);this.b2=k.vec3f64.fromValues(0,0,1);this.quality=0}}()})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ../../support/geometryUtils ../../support/orientedBoundingBox ../../webgl-engine/lib/ProgramRepository ../../webgl-engine/materials/internal/MaterialUtil ../../webgl-engine/shaders/PointRendererPrograms ../../../webgl/BufferObject ../../../webgl/VertexArrayObject".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){function h(a,b,c,d,e){if(c.drawScreenSpace)return c.fixedSize*b*d;e=(e?256:64)*b*d;return c.drawFixedSize?Math.min(c.fixedSize/2,e):0<c.screenMinSize?Math.min(Math.max(c.screenMinSize*b*d,a/2),e):Math.min(a/2,e)}function n(a,b,c){null==c&&(c=k.vec3f64.create());c[0]=a.origin[0]+a.coordinates[3*b];c[1]=a.origin[1]+a.coordinates[3*b+1];c[2]=a.origin[2]+a.coordinates[3*b+2];return c}var q=k.mat4f64.create(),t={positions:[{name:"aPosition",count:3,type:5126,offset:0,stride:12,
normalized:!1}],colors:[{name:"aColor",count:3,type:5121,offset:0,stride:3,normalized:!0}]};p=function(){function f(){this.didRender=!1;this.needsRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=a.create(a.POSITIVE_INFINITY);this._programRep=null;this._needsPrograms=!0;this._programScreenDepth=this._programWorldDepth=this._programScreen=this._programWorld=null;
this.tempMatrix4=k.mat4f32.create();this.tempVec3=k.vec3f32.create();this.nodes=[]}f.prototype.initializeRenderContext=function(a){this._programRep=new e(a.rctx);this._needsPrograms=this.needsRender=!0};f.prototype.uninitializeRenderContext=function(a){this._programRep.dispose();this._programScreenDepth=this._programWorldDepth=this._programScreen=this._programWorld=this._programRep=null};f.prototype.intersect=function(c,d,e,f,l){var m=k.vec3f64.create(),r=k.vec3f64.create(),p=k.vec3f64.create(),t=
k.vec3f64.create(),u=g.plane.create(),y=c.camera.perPixelRatio,x=c.camera.near,w=this._getSizeParams();k.vec3.subtract(r,f,e);var z=1/k.vec3.length(r);k.vec3.scale(r,r,z);k.vec3.negate(p,r);k.vec4.set(u,r[0],r[1],r[2],-k.vec3.dot(r,e));var M={};l={};var P=a.create(),O=a.create(this._clipBox);a.offset(O,-e[0],-e[1],-e[2],O);for(var W=0,Q=this.nodes;W<Q.length;W++){var J=Q[W],F=J.splatSize*this._scaleFactor,K=b.minimumDistancePlane(J.obb,u),L=b.maximumDistancePlane(J.obb,u),K=K-(w.drawScreenSpace?0:
h(F,K+x,w,y,J.isLeaf)),L=L-(w.drawScreenSpace?0:h(F,L+x,w,y,J.isLeaf)),K=null!=M.dist&&null!=l.dist&&M.dist<K*z&&l.dist>L*z;if(!(0>L||K)&&(L=h(F,L+x,w,y,J.isLeaf),b.intersectLine(J.obb,e,r,L))){L*=L;b.toAaBoundingBox(J.obb,P);a.offset(P,-e[0],-e[1],-e[2],P);K=!a.contains(O,P);k.vec3.subtract(t,J.origin,e);for(var T=J.coordinates.length/3,R=0;R<T;R++)if(m[0]=t[0]+J.coordinates[3*R],m[1]=t[1]+J.coordinates[3*R+1],m[2]=t[2]+J.coordinates[3*R+2],!K||a.containsPoint(O,m)){var X=k.vec3.dot(m,r),ba=k.vec3.squaredLength(m)-
X*X;if(!(ba>L)){var ca=X+x,Z=w.drawScreenSpace?0:h(F,ca,w,y,J.isLeaf);if(!(0>X-Z||(ca-=Z,ca=h(F,ca,w,y,J.isLeaf),ba>ca*ca))){ba=this.layerUid+"/"+J.id+"/"+R;X=(X-Z)*z;if(null==M.dist||X<M.dist)if(Z=M,null==d||d(e,f,X))Z.point=n(J,R,Z.point),Z.dist=X,Z.normal=p,Z.pointId=ba,Z.layerUid=this.layerUid;if(null==l.dist||X>l.dist)if(Z=l,null==d||d(e,f,X))Z.point=n(J,R,Z.point),Z.dist=X,Z.normal=p,Z.pointId=ba,Z.layerUid=this.layerUid}}}}}null!=M.dist&&(e=c.minResult,null==e.dist||M.dist<e.dist)&&(d={type:"external",
point:M.point,metadata:{pointId:M.pointId,layerUid:M.layerUid}},e.set(d,M.pointId,M.dist,M.normal,q,void 0),e.setIntersector("PointRenderer"));null!=l.dist&&(c=c.maxResult,null==c.dist||l.dist>c.dist)&&(d={type:"external",point:l.point,metadata:{pointId:l.pointId,layerUid:l.layerUid}},c.set(d,l.pointId,l.dist,l.normal,q,void 0),c.setIntersector("PointRenderer"))};f.prototype.render=function(b){if(0!==b.pass&&1!==b.pass)return!1;for(var d=1===b.pass,e=b.rctx,g=0,f=this.nodes;g<f.length;g++){var h=
f[g];null==h.vao&&this._initNode(b,h)}this._selectPrograms();g=this._getSizeParams();f=d?g.drawScreenSpace?this._programScreenDepth:this._programWorldDepth:g.drawScreenSpace?this._programScreen:this._programWorld;if(null==f||0===this.nodes.length)return!0;var l=this._clipBox,m=!a.equals(l,a.POSITIVE_INFINITY,function(a,b){return a===b});m||(k.vec3.set(this.tempVec3,-Infinity,-Infinity,-Infinity),f.setUniform3fv("uClipMin",this.tempVec3),k.vec3.set(this.tempVec3,Infinity,Infinity,Infinity),f.setUniform3fv("uClipMax",
this.tempVec3));e.setDepthTestEnabled(!0);e.bindProgram(f);f.setUniformMatrix4fv("uProjectionMatrix",b.camera.projectionMatrix);d&&f.setUniform2f("nearFar",b.camera.near,b.camera.far);g.drawFixedSize&&f.setUniform2f("uPointScale",g.fixedSize,b.camera.fullHeight);for(var d=this._slicePlaneEnabled?b.sliceHelper&&b.sliceHelper.plane:null,n=0,r=this.nodes;n<r.length;n++){h=r[n];f.setUniform2f("uScreenMinMaxSize",g.screenMinSize,h.isLeaf?256:64);g.drawFixedSize||f.setUniform2f("uPointScale",h.splatSize*
this._scaleFactor,b.camera.fullHeight);var q=h.origin;m&&(k.vec3.set(this.tempVec3,l[0]-q[0],l[1]-q[1],l[2]-q[2]),f.setUniform3fv("uClipMin",this.tempVec3),k.vec3.set(this.tempVec3,l[3]-q[0],l[4]-q[1],l[5]-q[2]),f.setUniform3fv("uClipMax",this.tempVec3));k.mat4.identity(this.tempMatrix4);k.mat4.translate(this.tempMatrix4,this.tempMatrix4,q);k.mat4.multiply(this.tempMatrix4,b.camera.viewMatrix,this.tempMatrix4);f.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4);d&&c.bindSlicePlane(q,d,f);e.bindVAO(h.vao);
e.drawArrays(0,0,h.coordinates.length/3)}return!0};Object.defineProperty(f.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(a){this._useFixedSizes!==a&&(this._useFixedSizes=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(a){this._scaleFactor!==a&&(this._scaleFactor=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"minSizePx",{get:function(){return this._minSizePx},set:function(a){this._minSizePx!==a&&(this._minSizePx=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},set:function(a){this._useRealWorldSymbolSizes!==a&&(this._useRealWorldSymbolSizes=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"size",{get:function(){return this._size},set:function(a){this._size!==
a&&(this._size=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"sizePx",{get:function(){return this._sizePx},set:function(a){this._sizePx!==a&&(this._sizePx=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"clippingBox",{set:function(b){a.set(this._clipBox,b||a.POSITIVE_INFINITY)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},
set:function(a){this._slicePlaneEnabled!==a&&(this._slicePlaneEnabled=a,this._requestRender(),this._needsPrograms=!0)},enumerable:!0,configurable:!0});f.prototype.addNode=function(a){this.nodes.push(a);this._requestRender()};f.prototype.removeNode=function(a){var b=null;this.nodes=this.nodes.filter(function(c){return c.id===a?(b=c,c.vao&&(c.vao.dispose(!0),c.vao=null),!1):!0});this._requestRender();return b};f.prototype.removeAll=function(){this.nodes.forEach(function(a){a.vao&&(a.vao.dispose(!0),
a.vao=null)});this.nodes=[];this._requestRender()};f.prototype._initNode=function(a,b){a=a.rctx;b.vao=new l(a,d.program.attributes,t,{positions:m.createVertex(a,35044,b.coordinates),colors:m.createVertex(a,35044,b.rgb)})};f.prototype._requestRender=function(){this.didRender=!1;this.needsRender=!0};f.prototype._getSizeParams=function(){var a=this._useFixedSizes,b=a&&!this._useRealWorldSymbolSizes,c=b?this._sizePx:this._size,d=this._minSizePx;a&&(d=0);return{drawScreenSpace:b,drawFixedSize:a,fixedSize:c,
screenMinSize:d}};f.prototype._selectPrograms=function(){this._needsPrograms&&(this._needsPrograms=!1,this._programWorld=this._programRep.getProgram(d.program,{slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreen=this._programRep.getProgram(d.program,{drawScreenSize:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programWorldDepth=this._programRep.getProgram(d.program,{depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreenDepth=this._programRep.getProgram(d.program,
{drawScreenSize:!0,depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}))};return f}();(function(a){a.isInstanceOfNode=function(a){return a.hasOwnProperty("splatSize")}})(p||(p={}));return p})},"esri/views/3d/webgl-engine/shaders/PointRendererPrograms":function(){define(["require","exports","./sources/resolver","../../../webgl/programUtils"],function(p,f,k,a){Object.defineProperty(f,"__esModule",{value:!0});var g=function(b){return a.glslifyDefineMap({DEPTH_PASS:b.depthPass,DRAW_SCREEN_SIZE:b.drawScreenSize,
SLICE:b.slicePlaneEnabled})};f.program={name:"point-renderer",shaders:function(a){return{vertexShader:g(a)+k.resolveIncludes("pointRenderer/pointRenderer.vert"),fragmentShader:g(a)+k.resolveIncludes("pointRenderer/pointRenderer.frag")}},attributes:{aPosition:0,aColor:1}}})},"esri/views/3d/layers/SceneLayerView3D":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/Logger ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingBox ../../../tasks/support/Query ./I3SMeshView3D ./LayerView3D ./i3s/I3SQueryEngine ./i3s/I3SUtil ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/projectionUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y){var x=e.getLogger("esri.views.3d.layers.SceneLayerView3D");(function(){return function(){}})();return function(e){function f(){var a=null!==e&&e.apply(this,arguments)||this;a._queryEngine=null;a.progressiveLoadFactor=1;a._elevationContext="scene";a._isIntegratedMesh=!1;return a}a(f,e);Object.defineProperty(f.prototype,"lodFactor",{get:function(){return this.get("view.qualitySettings.sceneService.3dObject.lodFactor")||1},enumerable:!0,configurable:!0});
f.prototype.initialize=function(){var a=this;this.handles.add(c.init(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)}))};f.prototype.destroy=function(){};f.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&x.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};f.prototype.queryExtent=function(a){return this._ensureQueryEngine().queryExtent(a)};f.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().queryFeatureCount(a)};
f.prototype.queryFeatures=function(a){return this._ensureQueryEngine().queryFeatures(a)};f.prototype.queryObjectIds=function(a){return this._ensureQueryEngine().queryObjectIds(a)};f.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};f.prototype._createQueryEngine=function(){var a=this,b={id:0,index:0,meta:null,bbCorners:new Float64Array(24)};return new q(this.layer,{forAll:function(c,d){a._forAllFeatures(function(d,e,
g){b.id=d;b.index=e;b.meta=g;a._boundingBoxCornerPoints(e,g.engineObject,b.bbCorners);c(b)},d)},createGraphic:function(b){return a._createGraphic(b.index,b.meta)},requestFields:function(b,c,d){return t.whenGraphicAttributes(a.layer,c,a._getObjectIdField(),d,function(c){var d=a._getGraphicIndices(b,c);return[{node:b,indices:d,graphics:c}]},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){return a._createExtentBuilder()}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})};
f.prototype._createExtentBuilder=function(){var a=this.view.renderSpatialReference,b=this.view.spatialReference,c=m.empty(),d=new Float64Array(24);return{add:function(e){y.bufferToBuffer(e.bbCorners,a,0,d,b,0,8)&&m.expandWithBuffer(c,d,0,8)},getExtent:function(){return m.toExtent(c,b)}}};f.prototype.highlight=function(a,b){void 0===b&&(b={});var c=this._highlights;if(a instanceof l){var d=c.acquireSet(b),e=d.set,d=d.handle;this.queryObjectIds(a).then(function(a){return c.setFeatureIds(e,a)});return d}return this.inherited(arguments)};
f.prototype._createLayerGraphic=function(a){a=new b(null,null,a);a.layer=this.layer;a.sourceLayer=this.layer;return a};f.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};f.prototype.isUpdating=function(){return!(!this._controller||!this._controller.updating)};g([d.property()],f.prototype,"layer",void 0);g([d.property({dependsOn:["_controller.updating"]})],f.prototype,"updating",void 0);g([d.property({dependsOn:["_controller.rootNodeVisible"]})],
f.prototype,"suspended",void 0);g([d.property(u.updatingPercentage)],f.prototype,"updatingPercentage",void 0);g([d.property({readOnly:!0})],f.prototype,"lodFactor",null);g([d.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],f.prototype,"updatingPercentageValue",void 0);return f=g([d.subclass("esri.views.3d.layers.SceneLayerView3D")],f)}(d.declared(n,h,r.PopupSceneLayerView))})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/errors/CancelError ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/asyncUtils ../../../core/Collection ../../../core/compilerUtils ../../../core/Evented ../../../core/HandleOwner ../../../core/has ../../../core/iteratorUtils ../../../core/lang ../../../core/Logger ../../../core/Promise ../../../core/promiseUtils ../../../core/requireUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingBox ../../../geometry/support/scaleUtils ../../../layers/graphics/controllers/I3SOnDemandController ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./SceneLayerWorker ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SElevationProvider ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ./support/edgeUtils ./support/layerViewUpdatingProperties ./support/symbolColorUtils ../support/mathUtils ../support/orientedBoundingBox ../support/projectionUtils ../support/buffer/glUtil ../support/buffer/typedArrayUtil ../webgl-engine/Stage ../webgl-engine/lib/Geometry ../webgl-engine/lib/Layer ../webgl-engine/lib/Object3D ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/TextureBackedBuffer/BufferManager ../webgl-engine/materials/DefaultMaterial module".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H,I,N,S,M,P,O,W,Q,J,F,K,L,T,R,X,ba,ca,Z,da,U,ia,ea,aa,ga,fa,ja,V,ha,ma,ka){function v(a,b,c,d,e){var g=!1,f;b.encoding===F.DDS_ENCODING_STRING?f=ja.DDS_ENCODING:g=!(ba.isPowerOfTwo(a.width)&&ba.isPowerOfTwo(a.height));c=((a=b.usedByEngineMats.some(function(a){return a.getParams().atlasRegions})||b.atlas)?d:c)&&!g;return{mipmap:c,wrap:a||!b.wrap?{s:33071,t:33071}:{s:10497,t:10497},disableAnisotropy:a&&c&&e,encoding:f,noUnpackFlip:!0}}function ta(a){return U.isArrayBuffer(a.data)}
function za(a,b){for(var c=1024,d=0;d<a.length;d++)var e=a[d],c=c+(e.interleavedVertexData.byteLength+(e.indices?e.indices.byteLength:0)),c=c+(e.positionData.data.byteLength+e.positionData.indices.byteLength);for(a=0;a<b.length;a++)d=b[a],U.isArrayBuffer(d.data)&&(c+=d.data.byteLength);return c}function Da(a,b){return 104857600<b.byteSize?(qa.warn("Node is too big to store in IndexedDB cache: "+a.baseUrl+" ("+b.byteSize+" bytes)"),!1):!0}var ua=ia.ModelContentType,qa=y.getLogger("esri.views.3d.layers.SceneLayerView3D"),
La=[1,1,1,1],Ma=[.8,.8,.8],xa=[.5,.5,.5],va=function(){return function(){}}();f=function(e){function f(){var a=null!==e&&e.apply(this,arguments)||this;a._layerUid="";a._highlights=new W(a);a._elevationProvider=null;a._worker=new P;a._workerThread=null;a._texId2Meta=new Map;a._nodeId2Meta=new Map;a._addTasks=new Map;a._rendererVersion=0;a._rendererFields=null;a._colorVariable=null;a._opacityVariable=null;a._symbolInfos=new Map;a._idbCache=new K.IDBCache("esri-scenelayer-cache","geometries",10);a._cancelCount=
0;a._hasColors=!1;a._hasTextures=!1;a._hasData=!1;a.slicePlaneEnabled=!1;a.alwaysLoadEverythingModeEnabled=!1;a._cacheKeySuffix=null;a._definitionExpressionErrors=0;a._maxDefinitionExpressionErrors=20;a._tmpAttributeOnlyGraphic=new c(null,null,{});return a}a(f,e);n=f;Object.defineProperty(f.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"rendererNeedsTextures",
{get:function(){return F.rendererNeedsTextures(this.layer.renderer)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"elevationOffset",{get:function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var b=I.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=M.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0});f.prototype._enableSecretAlwayLoadMode=function(){this.layer.store.lodModel&&
"always-load"===this.layer.store.lodModel&&(this.alwaysLoadEverythingModeEnabled=!0)};Object.defineProperty(f.prototype,"uncompressedTextureDownsamplingEnabled",{get:function(){return this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"useCompressedTextures",{get:function(){var a=this.layer.version,a=!t("trident")||1<a.major||1===a.major&&3<a.minor;return this.view._stage.has("s3tc")&&
a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"_atlasBiasCompensationEnabled",{get:function(){return this.view&&this.view._stage&&!this.view._stage.has("shaderTextureLOD")&&this._enableAtlasMipMaps},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0});f.prototype.initialize=function(){var a=this;D.open(w.getAbsMid("./SceneLayerWorker",p,ka)).then(function(b){a.destroyed?b.close():a._workerThread=b});F.checkSceneLayerValid(this.layer);F.checkSceneLayerCompatibleWithView(this.layer,this.view);this._layerUid=this.layer.uid;this._controller=new N({layerView:this});this.geoMemoryEstimate=
this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;if(this._isIntegratedMesh||!this.layer.store.defaultGeometrySchema)this._hasSymbolColors=!1;else{var b=this.layer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(b&&b.faceRange&&b.id)}this._hasVertexColors=null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.view.getEdgeView());
this._memCache=this.view.resourceController.getMemCache(this.layer.uid,function(b){return a._deleteNodeStageData(b)});this._addThisLayerToStage();this._elevationProvider=new Q({layerView:this,stageLayer:this._stageLayer});this.handles.add([C.init(this.view,"clippingArea",function(){return a._clippingAreaChanged()}),C.init(this.layer,"renderer",function(b){return a._rendererChange(b)}),C.init(this.layer,"objectIdFilter",function(){return a._filterChange()}),C.init(this,"_controller.parsedDefinitionExpression",
function(){return a._filterChange()}),C.watch(this,"fullOpacity",function(b){return a._opacityChange(b)}),C.watch(this,"slicePlaneEnabled",function(b){return a._slicePlaneEnabledChange(b)}),C.watch(this,"elevationOffset",function(b,c){return a._reloadAll(c)}),C.watch(this,["rendererNeedsTextures","uncompressedTextureDownsamplingEnabled"],function(){a._reloadAll();a._memCache.clear()}),C.init(this,"suspended",function(b){return a._suspendedChange(b)})],"sceneLayerHandles");t("disable-feature:single-idb-cache")&&
(this._idbCache=new K.IDBCache("esri-scenelayer-cache-v10","geometries",10));this._idbCache.init().catch(function(a){qa.warn("Failed to initialize IndexedDB cache: "+a)});this._cacheKeySuffix=F.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference);this._componentColorManager=this._hasSymbolColors?new ha.BufferManager(this._stage.view.renderingContext):null;this._enableSecretAlwayLoadMode()};f.prototype.destroy=function(){this.handles.remove("sceneLayerHandles");this._workerThread&&
(this._workerThread.close(),this._workerThread=null);this._removeAllNodeDataFromStage();this._memCache.destroy();this._memCache=null;this._removeThisLayerFromStage();this._stage=null;this._idbCache&&(this._idbCache.destroy(),this._idbCache=null);null!=this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();this._nodeId2Meta=this._texId2Meta=null;this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),
this._visibleGeometryChangedSchedulerHandle=null)};f.prototype.memEstimateTextureAdded=function(a){a=a.getEstimatedTexMemRequired();this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=a;return a};f.prototype.memEstimateTextureRemoved=function(a){a=a.getEstimatedTexMemRequired();this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a};f.prototype.memEstimateGeometryAdded=function(a){a=a.estimateGpuMemoryUsage();this.gpuMemoryEstimate+=a;this.geoMemoryEstimate+=a;return a};f.prototype.memEstimateGeometryRemoved=
function(a){a=a.estimateGpuMemoryUsage();this.gpuMemoryEstimate-=a;this.geoMemoryEstimate-=a};f.prototype.isNodeLoaded=function(a){return this._nodeId2Meta.has(a.id)};f.prototype.getUsedMemory=function(){var a=0;this._nodeId2Meta.forEach(function(b){return a+=b.node.memory});return a};f.prototype.getUnloadedMemory=function(){return this._controller?this._controller.unloadedMemoryEstimate:0};f.prototype.ignoresMemoryFactor=function(){return!1};f.prototype._suspendedChange=function(a){a?(this._removeAllNodeDataFromStage(),
this.view.elevationProvider.unregister(this._elevationProvider)):this.view.elevationProvider.register(this._elevationContext,this._elevationProvider)};f.prototype.getStats=function(){var a={index:0,nodes:this._nodeId2Meta.size.toString(),textures:this._texId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB"};this._controller&&
(this._cachingEnabled()&&(a.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(a));return a};f.prototype._addThisLayerToStage=function(){for(var a=this._stage,b=new Uint8Array(256),c=0;c<b.length;c++)b[c]=255;this._whiteTexture=new ja(b,"white",{width:8,height:8});a.add(ua.TEXTURE,this._whiteTexture);b=this.layer.id+"";this._stageLayer=b=new aa(b,{},b);a.add(ua.LAYER,b);this._stage.addToViewContent([b.id])};f.prototype._removeThisLayerFromStage=function(){if(null!=
this._stageLayer){var a=this._stage;a.remove(ua.TEXTURE,this._whiteTexture.id);this._removeAllNodeDataFromStage();V.assert(0===this._nodeId2Meta.size);V.assert(0===this._texId2Meta.size);a.remove(ua.LAYER,this._stageLayer.id);this._stageLayer=void 0;this.gpuMemoryEstimate=0}};f.prototype.getLoadedAttributes=function(a){if((a=this._nodeId2Meta.get(a.id))&&a.attributeInfo)return a.attributeInfo.loadedAttributes};f.prototype.getAttributeData=function(a){if((a=this._nodeId2Meta.get(a.id))&&a.attributeInfo)return a.attributeInfo.attributeData};
f.prototype.setAttributeData=function(a,b){var c=this._nodeId2Meta.get(a.id);c&&(c.attributeInfo=b,c.cachedRendererVersion=this._getInvalidRendererVersion(),this._updateEngineObject(a,c))};f.prototype.getLoadedNodeIDs=function(){return d.keysOfMap(this._nodeId2Meta)};f.prototype._calcEngineMaterialTransparencyParams=function(a,b,c){var d=this.fullOpacity,e=1-ba.clamp(V.fallbackIfUndefined(b.transparency,0),0,1);a=1>e||1>d||a&&r.endsWith(a.channels,"a")||!0===b.useVertexColorAlpha||c;return{opacity:e,
layerOpacity:d,transparent:a}};f.prototype._calcEngineMaterialDoubleSidedParams=function(a){return null!=a.doubleSided?a.doubleSided:!0};f.prototype._calcEngineMaterialCullFaceParams=function(a){return a.cullFace?a.cullFace:null!=a.doubleSided?a.doubleSided?"none":"back":"none"};f.prototype._getMaterialParameters=function(a,b,c,d){var e;null!=a&&(e=(e=this._texId2Meta.get(b))&&e.engineTex?e.engineTex.id:this._whiteTexture.id);b=c.params;var g=V.fallbackIfUndefined(b.diffuse,Ma);"standard"!==c.type&&
qa.warn("Unknown material type '"+c.type+"', must be 'standard'");c=this._isIntegratedMesh;d={ambient:g,diffuse:g,specular:V.fallbackIfUndefined(b.specular,xa),atlasRegions:b.vertexRegions,textureId:e,vertexColors:this._hasVertexColors,componentIndices:this._hasSymbolColors,componentColorBuffer:this._hasSymbolColors&&d?d.textureBuffer:null,flipV:!1,doubleSided:this._calcEngineMaterialDoubleSidedParams(b),cullFace:this._calcEngineMaterialCullFaceParams(b),writeStencil:c,receiveSSAO:!c,groundNormalShading:c,
compressedNormals:!c};c||(a=this._calcEngineMaterialTransparencyParams(a,b),r.mixin(d,a));return d};f.prototype._createEngineMaterial=function(a,b,c,d,e,g,f){var h=null==b?null:this._getI3STexEncoding(b);f=this._getMaterialParameters(b,c,d,f);f=new ma(f,e);f.metadata={i3sMatId:e,i3sTexId:c,i3sTex:b,i3sMatParams:d.params};if(null!=b){(d=this._texId2Meta.get(c))?d.usedByEngineMats.push(f):(d={id:c,usedByEngineMats:[f],images:b.images,encoding:h,atlas:!0===b.atlas,wrap:"none"!==b.wrap[0]||"none"!==b.wrap[1]},
this._texId2Meta.set(c,d));a:{for(b=0;b<g.length;b++)if(h=g[b],h.i3sTexId===c){c=h.data;break a}c=null}null!=c&&null==d.engineTex&&(g=v(c,d,this._enableMipMaps,this._enableAtlasMipMaps,this._disableAtlasAnisotropy),d.engineTex=new ja(c,d.id,g),this._stage.add(ua.TEXTURE,d.engineTex),a.memory+=this.memEstimateTextureAdded(d.engineTex));if(null!=d.engineTex)for(a=d.engineTex.id,c=0,g=d.usedByEngineMats;c<g.length;c++)g[c].setParameterValues({textureId:a})}return f};f.prototype._getI3STexEncoding=function(a){var b=
F.getAppropriateTextureEncoding(a.encoding,this.useCompressedTextures);return-1<b?a.encoding[b]:a.encoding};f.prototype._getVertexBufferLayout=function(a,b){var c=a.params.materialID,d=b.materialDefinitions[c];V.assert(void 0!==d,"geometry wants unknown material "+c);a=a.params.textureID||"none";var e;"none"!==a&&(null!=b.textureDefinitions&&null!=b.textureDefinitions[a]||qa.warn("textureDefinitions missing in shared resource"),e=b.textureDefinitions[a]);b=this._getMaterialParameters(e,a,d);return da.glLayout(ma.getVertexBufferLayout(b))};
f.prototype._createEngineMat=function(a,b,c,d,e){var g=b.params.materialID,f=c.materialDefinitions[g];V.assert(void 0!==f,"geometry wants unknown material "+g);b=b.params.textureID||"none";var h;"none"!==b&&(null!=c.textureDefinitions&&null!=c.textureDefinitions[b]||qa.warn("textureDefinitions missing in shared resource"),h=c.textureDefinitions[b]);return this._createEngineMaterial(a,h,b,f,g,d,e)};f.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};f.prototype._findGraphicNodeAndIndex=
function(a){var b=L.attributeLookup(a.attributes,this._getObjectIdField()),c=null;u.everyMap(this._nodeId2Meta,function(a,d){d=a.featureIds.indexOf(b);if(-1===d)return!0;c={node:a.node,index:d};return!1});return c};f.prototype._getGraphicIndices=function(a,b){a=this._nodeId2Meta.get(a.id);if(!a)return[];for(var c=[],d=this._getObjectIdField(),e=0;e<b.length;e++){var g=L.attributeLookup(b[e].attributes,d),g=a.featureIds.indexOf(g);-1!==g&&c.push(g)}return c};f.prototype.whenGraphicBounds=function(a){a=
this._findGraphicNodeAndIndex(a);if(!a)return z.reject();var b=this._nodeId2Meta.get(a.node.id).engineObject;a=this._boundingBoxCornerPoints(a.index,b,new Float64Array(24));if(Z.bufferToBuffer(a,this.view.renderSpatialReference,0,a,this.view.spatialReference,0,8))return b=H.empty(),H.expandWithBuffer(b,a,0,8),z.resolve({boundingBox:b,screenSpaceObjects:[]})};f.prototype.whenGraphicAttributes=function(a,b){var c=this;return F.whenGraphicAttributes(this.layer,a,this._getObjectIdField(),b,function(a){for(var b=
new Map,d=[],e=0;e<a.length;e++){var g=a[e],f=c._findGraphicNodeAndIndex(g),h=b.get(f.node);h||(h={node:f.node,indices:[],graphics:[]},d.push(h));h.indices.push(f.index);h.graphics.push(g)}return d},{ignoreUnavailableFields:!0,populateObjectId:!0})};f.prototype.getGraphicFromStageObject=function(a,b){if(this._isIntegratedMesh)return z.reject();var c=this._getMetadata(a);a=a.getComponentFromTriangleNr(0,b);return null!=a&&null!=c.featureIds&&a<c.featureIds.length?(c=this._createGraphic(a,c),z.resolve(c)):
z.reject()};f.prototype.hasStageObject=function(a){var b=a.getMetadata();return(b=this._nodeId2Meta.get(b.i3sNode))&&b.engineObject===a};f.prototype._getMetadata=function(a){a=a.getMetadata();return this._nodeId2Meta.get(a.i3sNode)};f.prototype._getCacheKey=function(a){return a.baseUrl+this._cacheKeySuffix};f.prototype._getMemCacheKey=function(a,b){void 0===b&&(b=this.elevationOffset);return a+"#"+b};f.prototype._cachingEnabled=function(){return!this._controller.disableIDBCache&&0===this.elevationOffset&&
null!=this._cacheKeySuffix};f.prototype.additionalCancelNodeLoadingHandler=function(){this._cancelCount=(this._cancelCount|0)+1|0};f.prototype._handleCancelled=function(a){if(0<((this._cancelCount|0)+(-a|0)|0))throw new b;};f.prototype.loadCachedGPUData=function(a){return this._memCache.pop(this._getMemCacheKey(a.id))};f.prototype.loadCachedNodeData=function(a,b){var c=this,d=this._cancelCount;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(a)).then(function(e){if(null==e)return null;
c._handleCancelled(d);if(e.nodeVersion!==a.version)return c._idbCache.remove(c._getCacheKey(a)),null;a.obb||(a.obb=ca.clone(e.nodeObb),c._controller.updateVisibility(a.id));var g=function(a){if(null==a.data)return!0;var b=c._getI3STexEncoding(e.sharedResource.textureDefinitions[a.i3sTexId]);return a.encoding!==b};return c.rendererNeedsTextures&&e.textureData.some(g)?b(e.allGeometryData,e.sharedResource).then(function(b){e.textureData=b;e.byteSize=za(e.transformedGeometries,e.textureData);b.every(ta)&&
Da(a,e)&&c._idbCache.put(c._getCacheKey(a),e).catch(function(b){b&&"indexedb:not-initialized"===b.name||qa.warn("Failed to update node with textures in IndexedDB cache: "+a.id+": "+b)});c._handleCancelled(d);return e}):e}):z.resolve(null)};f.prototype.addNodeData=function(a,b){var c=this;return this._addData(a,b.attributeDataInfo,function(){return c._transformBundle(a,b).then(function(b){return c._controller.reschedule(a.id,b)}).then(function(d){a.obb||(a.obb=d.obb,c._controller.updateVisibility(a.id));
d={allGeometryData:b.allGeometryData,transformedGeometries:d.transformedGeometries,textureData:b.textureData,sharedResource:b.sharedResource,nodeVersion:a.version,nodeObb:a.obb,byteSize:c._cachingEnabled()?za(d.transformedGeometries,b.textureData):0};if(Da(a,d)&&0<d.byteSize){var e=d.textureData.map(function(a){return ta(a)?a:{i3sTexId:a.i3sTexId,encoding:a.encoding,data:null}});c._idbCache.put(c._getCacheKey(a),k({},d,{textureData:e})).catch(function(b){return qa.warn("Failed to store node in IndexedDB cache: "+
a.id+": "+b)})}return c._addCachedNodeData(a,d)})})};f.prototype._transformBundle=function(a,b){for(var c=this,d=[],e=[b.geometryBuffer],g=0,f=b.allGeometryData;g<f.length;g++)for(var h=0,k=f[g].geometries;h<k.length;h++)d.push(this._getVertexBufferLayout(k[h],b.sharedResource));b={geometryBuffer:b.geometryBuffer,geometryData:b.allGeometryData,layouts:d,mbs:a.mbs,obb:a.obb,elevationOffset:this.elevationOffset,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||
"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};return this._workerThread?this._workerThread.invoke("process",b,{transferList:e}):this._controller.reschedule(a.id,b).then(function(a){return c._worker.transform(a)})};f.prototype.addCachedGPUData=function(a,b){if(this.alwaysLoadEverythingModeEnabled||this._controller.isGeometryVisible(a)){this._nodeId2Meta.set(a.id,b);b.engineObject.setHidden(b.engineObject.geometryRecords[0],
!1);for(var c=0,d=b.engineObject.getGeometryRecords();c<d.length;c++)d[c].material.setParameterValues({slicePlaneEnabled:this.slicePlaneEnabled});this._updateEngineObject(a,b);this._highlights.objectCreated(b.engineObject)}else this._memCache.put(this._getMemCacheKey(a.id),b,a.memory)};f.prototype.addCachedNodeData=function(a,b,c){var d=this;return this._addData(a,c,function(){return d._addCachedNodeData(a,b)})};f.prototype._addCachedNodeData=function(a,b){var c=this;if(this.suspended||!this.alwaysLoadEverythingModeEnabled&&
!this._controller.isGeometryVisible(a))return z.resolve();var d=b.allGeometryData,e=b.transformedGeometries,g=b.textureData;b=b.sharedResource;if(0===d.length)return z.resolve();1!==d.length&&console.warn("Node with",d.length,"geometries is unsupported");if(!this.rendererNeedsTextures)for(var f=0;f<g.length;f++)g[f].data=null;var h={};h[ua.OBJECT]={};h[ua.GEOMETRY]={};h[ua.MATERIAL]={};var f=0,k=!1;a.memory=0;var l=d[0],d=l.componentOffsets,m=l.geometries,l=l.featureIds,n=null,r=null;if(this._hasSymbolColors)for(var n=
this._componentColorManager.getBuffer(l.length),r=new Uint16Array(l.length),q=0;q<l.length;q++)r[q]=n.aquireIndex();for(var q=a.id+"|"+l[0],p=[],t=[],u=[],y=[],x,v=0;v<m.length;v++){var w=m[v],B=this._createEngineMat(a,w,b,g,n),F=e[f++];x=F.corMatrices.globalTrafo;k=k||F.hasColors;F=new fa(new Float32Array(F.interleavedVertexData),F.layout,F.positionData,d||fa.DefaultOffsets,F.indices||fa.DefaultIndices,!0);this._hasSymbolColors&&this._setComponentIndices(F,r);var w=null!=w.transformation?G.mat4f64.clone(w.transformation):
G.mat4f64.create(),C=p.length,F=new ea(F,q+(0<C?"_"+C:""));p.push(F);u.push(w);y.push(B);t.push(J.createOrigin(a.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference));a.memory+=this.memEstimateGeometryAdded(F.data);h[ua.MATERIAL][B.id]=B;h[ua.GEOMETRY][F.id]=F}var D=new ga({idHint:a.id,name:q,geometries:p,materials:y,transformations:u,origins:t,castShadow:!0,metadata:{i3sNode:a.id,layerUid:this._layerUid}});D.setObjectTransformation(x);h[ua.OBJECT][D.id]=D;var E=this._addTasks.get(a.id),
K=new va;K.node=a;K.engineObject=D;K.featureIds=l;K.componentColorBuffer=n;K.componentIndices=r;K.cachedRendererVersion=this._getInvalidRendererVersion();K.cachedSymbolInfos=[];K.attributeInfo=E.attributeInfo;!this._hasTextures&&null!=a.textureData&&0<a.textureData.length&&(this._hasTextures=!0);this._hasColors||(this._hasColors=k);this._hasData=!0;this.notifyChange("hasTexturesOrVertexColors");var R=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(K).then(function(){var b=c._stageLayer,
d=c._stage,e=h[ua.OBJECT],g;for(g in e)e.hasOwnProperty(g)&&b.addObject(e[g]);for(var f in h)if(h.hasOwnProperty(f)){var b=h[f],k;for(k in b)b.hasOwnProperty(k)&&null==d.get(f,k)&&d.add(f,b[k])}c._nodeId2Meta.set(a.id,K);if(c.suspended)c._removeNodeStageData(a.id);else for(K.attributeInfo=E.attributeInfo,K.cachedRendererVersion===c._rendererVersion&&R===c.slicePlaneEnabled||c._addOrUpdateEdgeRendering(K),c._setObjectSymbology(K),c._applyFilters(a),c.visibleGeometryChanged(D),c._highlights.objectCreated(D),
d=0,f=K.engineObject.getGeometryRecords();d<f.length;d++)f[d].material.setParameterValues({slicePlaneEnabled:c.slicePlaneEnabled})})};f.prototype._addData=function(a,b,c){var d=this,e=this._addTasks.get(a.id);e?e.attributeInfo=b:(e=k({},z.createResolver(),{attributeInfo:b}),this._addTasks.set(a.id,e),c().then(e.resolve,e.reject).then(function(){return d._addTasks.delete(a.id)}));return e.promise};f.prototype._clippingAreaChanged=function(){var a=H.create();Z.extentToBoundingBox(this.view.clippingArea,
a,this.view.renderSpatialReference)?this._clippingArea=a:this._clippingArea=null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};f.prototype._filterChange=function(){var a=this;this._filters=this.getFilters();this._nodeId2Meta.forEach(function(b){return a._applyFilters(b.node)})};f.prototype.getFilters=function(){var a=this,b=[];if(this.layer.objectIdFilter){var c=new Float64Array(this.layer.objectIdFilter.ids),d="include"===this.layer.objectIdFilter.method;
c.sort();b.push(function(b){return a._objectIdFilter(c,d,b)})}if(this._controller&&this._controller.parsedDefinitionExpression&&this._controller.definitionExpressionFields){this._definitionExpressionErrors=0;var e=this._controller.parsedDefinitionExpression,g=this._controller.definitionExpressionFields;b.push(function(b,c){return a._sqlFilter(b,c,e,g)})}this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,c,a._clippingArea)});return b};f.prototype._sqlFilter=function(a,b,c,d){var e=
this,g={},f=this._createLayerGraphic(g),h=this.layer.objectIdField,k=b.featureIds,l=b.attributeInfo.attributeData;d.every(function(a){return null!=l[a]||a===h})&&n.filterInPlace(a,k,function(a){g[h]=k[a];for(var b=0;b<d.length;b++){var m=d[b];m!==h&&(g[m]=F.getCachedAttributeValue(l[m],a))}return e._evaluateClause(c,f)})};f.filterInPlace=function(a,b,c){for(var d=0,e=0,g=0;g<b.length&&d<a.length;g++)a[d]===b[g]&&(c(g)&&(a[e]=a[d],e++),d++);a.length=e};f.prototype._evaluateClause=function(a,b){try{return a.testFeature(b)}catch(Ta){return this._definitionExpressionErrors<
this._maxDefinitionExpressionErrors&&qa.error("Error while evaluating definitionExpression: "+Ta),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&qa.error("Further errors are ignored"),!1}};f.prototype._objectIdFilter=function(a,b,c){for(var e=0,g=0;e<c.length;)0<=d.binaryIndexOf(a,c[e])===b&&(c[g]=c[e],g++),e++;c.length=g};f.prototype._boundingboxFilter=function(a,b,c){var d=[0,0,0,0];Z.mbsToMbs(b.node.mbs,this._controller.crsIndex,d,this.view.renderSpatialReference);
d=null!=c?F.intersectBoundingBoxWithMbs(c,d):2;if(2!==d)if(0===d)a.length=0;else{var d=b.engineObject.getObjectTransformation(),e=b.engineObject.getGeometryRecords()[0].getShaderTransformation();G.mat4.multiply(d,d,e);if(0===d[1]&&0===d[2]&&0===d[3]&&0===d[4]&&0===d[6]&&0===d[7]&&0===d[8]&&0===d[9]&&0===d[11]&&1===d[15]){var g=Aa;g[0]=(c[0]-d[12])/d[0];g[1]=(c[1]-d[13])/d[5];g[2]=(c[2]-d[14])/d[10];g[3]=(c[3]-d[12])/d[0];g[4]=(c[4]-d[13])/d[5];g[5]=(c[5]-d[14])/d[10];var f=b.engineObject.getGeometryRecords()[0].geometry;
f.componentCount===b.featureIds.length&&n.filterInPlace(a,b.featureIds,function(a){return H.intersects(g,f.getComponentAABB(a,Ca))})}}};f.prototype._addOrUpdateEdgeRendering=function(a,b){void 0===b&&(b=!0);if(!this._edgeView)return z.resolve();var c=a.engineObject,d=this._edgeView.hasObject(c),e=this._extractObjectEdgeMaterials(a);a=e.perFeatureEdgeMaterials;var g={slicePlaneEnabled:this.slicePlaneEnabled};if(e.hasEdges)if(e=!c.isHidden(c.geometryRecords[0]),d)this._edgeView.updateAllComponentMaterials(c,
a,g,b),this._edgeView.updateObjectVisibility(c,e);else{if(e)return m.safeCast(this._edgeView.addObject(c,a,g))}else d&&this._edgeView.removeObject(c);return z.resolve()};f.prototype._applyFilters=function(a){var b=this._nodeId2Meta.get(a.id);b&&(this._applyFiltersToObjects(a,b),this._updateEdgeRendering(b))};f.prototype._applyFiltersToObjects=function(a,b){a=b.engineObject;a.unhideAllComponents();if(0!==this._filters.length){for(var c=b.featureIds,d=c.slice(),e=0,g=this._filters;e<g.length;e++)(0,g[e])(d,
b);if(d.length!==c.length)for(b=0,e=a.getGeometryRecords()[0],g=0;g<c.length;g++){var f=c[g];b>=d.length||d[b]!==f?a.setComponentVisibility(e,g,!1):b++}}};f.prototype._removeAllNodeDataFromStage=function(a){var b=this;void 0===a&&(a=this.elevationOffset);this._nodeId2Meta.forEach(function(c,d){return b._removeNodeStageData(d,a)})};f.prototype.removeNodeData=function(a){var b=this;a.forEach(function(a){return b._removeNodeStageData(a.id)})};f.prototype._removeNodeStageData=function(a,b){void 0===b&&
(b=this.elevationOffset);var c=this._nodeId2Meta.get(a);if(c){var d=c.engineObject;d.setHidden(d.geometryRecords[0],!0);this.visibleGeometryChanged(d);this._addOrUpdateEdgeRendering(c);this._nodeId2Meta.delete(a);this._highlights.objectDeleted(d);this._memCache.put(this._getMemCacheKey(a,b),c,c.node.memory)}};f.prototype._deleteNodeStageData=function(a){var b=this._stage,c=this._stageLayer,d=a.engineObject;this._edgeView&&this._edgeView.removeObject(d);c.removeObject(d);for(var c=0,e=d.getGeometryRecords();c<
e.length;c++){var g=e[c];this.memEstimateGeometryRemoved(g.geometry.data);b.remove(ua.GEOMETRY,g.geometry.id);this._removeMaterial(g.material,b)}if(a.componentIndices){for(c=0;c<a.componentIndices.length;c++)a.componentColorBuffer.releaseIndex(a.componentIndices[c]);this._componentColorManager.garbageCollect()}b.remove(ua.OBJECT,d.id)};f.prototype._removeMaterial=function(a,b){b.remove(ua.MATERIAL,a.id);var c=a.metadata.i3sTexId;if(c){var e=this._texId2Meta.get(c);if(e){var g=e.usedByEngineMats;d.removeUnordered(g,
a)||qa.error("Missing reference from material to texture");0===g.length&&((a=e.engineTex)&&a!==this._whiteTexture&&(this.memEstimateTextureRemoved(a),b.remove(ua.TEXTURE,e.engineTex.id)),this._texId2Meta.delete(c))}}};f.prototype.setPolygonOffset=function(a,b){var c=this._nodeId2Meta.get(a.id);if(c)for(a=0,c=c.engineObject.getGeometryRecords();a<c.length;a++)c[a].material.setParameterValues({polygonOffset:b})};f.prototype._getInvalidRendererVersion=function(){return(this._rendererVersion|0)+-1|0};
f.prototype._rendererChange=function(a){this._currentRenderer=a;this._rendererVersion=(this._rendererVersion|0)+1|0;this._opacityVariable=this._colorVariable=this._rendererFields=null;a&&a.requiredFields&&(this._rendererFields=F.findFieldsCaseInsensitive(a.requiredFields,this.layer.fields));if(a&&"visualVariables"in a&&a.visualVariables)for(var b=0,c=a.visualVariables;b<c.length;b++){var d=c[b];"color"===d.type?this._colorVariable=d:"opacity"===d.type?this._opacityVariable=d:qa.warn("Unsupported visual variable type for 3D Object Scene Services: "+
d.type)}if(a)for(b=0,a=a.getSymbols();b<a.length;b++)c=a[b],"mesh-3d"!==c.type&&qa.error("Symbols of type '"+c.type+"' are not supported for 3D Object Scene Services.");this.view.resourceController.setMemoryDirty()};f.prototype._getSymbolInfos=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return a.cachedSymbolInfos};f.prototype._getSymbolColors=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&
this._updateCachedRendererData(a);return a.cachedSymbolColors};f.prototype._updateCachedRendererData=function(a){a.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var b=a.featureIds?a.featureIds.length:1,c={},d=this._tmpAttributeOnlyGraphic;d.attributes=c;for(var e=this._currentRenderer,g=a.attributeInfo.attributeData,f=null!=a.featureIds?this.layer.objectIdField:null,h=null!=g?this._rendererFields:null,k=0;k<b;k++){null!=f&&(c[f]=a.featureIds[k]);if(null!=h)for(var l=0,m=h;l<
m.length;l++){var n=m[l];g[n]&&(c[n]=F.getCachedAttributeValue(g[n],k))}m=e&&e.getSymbol(d);l=null;m instanceof S&&(this._symbolInfos.has(m.id)||this._symbolInfos.set(m.id,F.getSymbolInfo(m)),l=this._symbolInfos.get(m.id));a.cachedSymbolInfos[k]=l;null==a.cachedSymbolColors&&(a.cachedSymbolColors=new Uint8Array(4*a.featureIds.length));n=m=null;if(e&&"visualVariables"in e){if(this._colorVariable){var r=e.getColor(d,{colorInfo:this._colorVariable,color:gb});r&&(m=Pa,m[0]=r.r/255,m[1]=r.g/255,m[2]=r.b/
255,this._opacityVariable||null===r.a||(n=r.a))}this._opacityVariable&&(n=e.getOpacity(d,{opacityInfo:this._opacityVariable}))}l&&l.material?(l=l.material,m=null==m||null==n?O.overrideColor(m,n,l.color,l.alpha,La,Pa):O.overrideColor(m,n,null,null,La,Pa),X.encodeSymbolColor(m,l.colorMixMode,a.cachedSymbolColors,4*k)):X.encodeSymbolColor(null,null,a.cachedSymbolColors,4*k)}}};f.prototype._extractObjectEdgeMaterials=function(a){var b=[],c=a.engineObject,d=a.featureIds?a.featureIds.length:1,e={opacity:this.fullOpacity},
g=this._edgeView.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),f=!1,k=null,l=null;a=this._getSymbolInfos(a);for(var m=0;m<d;m++){var n=a[m];c.getComponentVisibility(c.getGeometryRecords()[0],m)&&n?(l!==n&&(l=n,(k=T.createMaterialFromEdges(this._edgeView,n.edges,e))&&(f=!0)),b.push(h.isSome(k)?k:g)):b.push(g)}return{hasEdges:f,perFeatureEdgeMaterials:b}};f.prototype._setObjectSymbology=function(a){if(this._hasSymbolColors){for(var b=a.featureIds?a.featureIds.length:1,c=!1,d=this._getSymbolColors(a),
e=a.componentColorBuffer.textureBuffer,g=0;g<b;g++){var f=4*g;e.setData(a.componentIndices[g],0,d[f],d[f+1],d[f+2],d[f+3]);X.isOpaqueSymbolColor(d,f)||(c=!0)}this._updateObjectOpacity(a.engineObject,c)}};f.prototype._setComponentIndices=function(a,b){for(var c=a.getAttribute(V.VertexAttrConstants.COMPONENTINDEX),d=c.data,e=c.offsetIdx,c=c.strideIdx,g=a.getIndices(V.VertexAttrConstants.COMPONENTINDEX),f=0;f<b.length;f++)for(var h=a.componentOffsets[f+1],k=a.componentOffsets[f];k<h;k++)d[e+g[k]*c]=
b[f]};f.prototype._reloadAll=function(a){void 0===a&&(a=this.elevationOffset);this._removeAllNodeDataFromStage(a);null!=this._controller&&this._controller.restartNodeLoading()};f.prototype._opacityChange=function(a){var b=this;this._nodeId2Meta.forEach(function(a){b._updateObjectOpacity(a.engineObject);b._updateEdgeRendering(a)})};f.prototype._updateObjectOpacity=function(a,b){var c=0;for(a=a.getGeometryRecords();c<a.length;c++){var d=a[c].material,e=d.metadata;void 0!==b&&(e.symbolIsTransparent=
b);var g=d.getParams(),e=this._calcEngineMaterialTransparencyParams(e.i3sTex,e.i3sMatParams,e.symbolIsTransparent);g.transparent===e.transparent&&g.layerOpacity===e.layerOpacity||d.setParameterValues(e)}};f.prototype._updateEngineObject=function(a,b){this._setObjectSymbology(b);this._addOrUpdateEdgeRendering(b);this._applyFilters(a);this.visibleGeometryChanged(b.engineObject)};f.prototype._slicePlaneEnabledChange=function(a){var b=this,c={slicePlaneEnabled:a};this._stageLayer.isSliceable=a;this._nodeId2Meta.forEach(function(a){for(var d=
0,e=a.engineObject.getGeometryRecords();d<e.length;d++)e[d].material.setParameterValues(c);b._updateEdgeRendering(a,!1)})};f.prototype._updateEdgeRendering=function(a,b){void 0===b&&(b=!0);this._edgeView&&this._edgeView.hasObject(a.engineObject)&&this._addOrUpdateEdgeRendering(a,b)};f.prototype._forAllFeatures=function(a,b,c){var d=this;this._nodeId2Meta.forEach(function(e,g){d._forAllFeaturesOfNode(e,a,c);b&&b(e.node)})};f.prototype._forAllFeaturesOfNode=function(a,b,c){for(var d=a.featureIds,e=
a.engineObject.getGeometryRecords()[0],g=0;g<d.length;g++)(c||a.engineObject.getComponentVisibility(e,g))&&b(d[g],g,a,e)};f.prototype._createGraphic=function(a,b){var c={};null!=b.featureIds&&(c[this._getObjectIdField()]=b.featureIds[a]);b=b.attributeInfo.attributeData;if(null!=b)for(var d=0,e=Object.keys(b);d<e.length;d++){var g=e[d];c[g]=F.getCachedAttributeValue(b[g],a)}return this._createLayerGraphic(c)};f.prototype._boundingBoxCornerPoints=function(a,b,c){a=b.geometries[0].getComponentAABB(a,
Aa);for(var d=0;8>d;++d)wa[0]=d&1?a[0]:a[3],wa[1]=d&2?a[1]:a[4],wa[2]=d&4?a[2]:a[5],G.vec3.transformMat4(wa,wa,b.objectTransformation),c[3*d]=wa[0],c[3*d+1]=wa[1],c[3*d+2]=wa[2];return c};f.prototype.highlight=function(a,b){var d=this;void 0===b&&(b={});var e=this._highlights;"number"===typeof a?a=[a]:a instanceof c?a=[a]:a instanceof l&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof c){a=a.map(function(a){return L.attributeLookup(a.attributes,d._getObjectIdField())});var g=e.acquireSet(b);
b=g.set;g=g.handle;e.setFeatureIds(b,a);return g}if("number"===typeof a[0])return g=e.acquireSet(b),b=g.set,g=g.handle,e.setFeatureIds(b,a),g}return{remove:function(){}}};f.prototype.visibleGeometryChanged=function(a){var b=this;a?this._elevationProvider.objectChanged(a):this._elevationProvider.layerChanged();null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=B.schedule(function(){b.emit("visible-geometry-changed");b._visibleGeometryChangedSchedulerHandle=
null}))};var n;g([E.property()],f.prototype,"view",void 0);g([E.property()],f.prototype,"layer",void 0);g([E.property()],f.prototype,"_controller",void 0);g([E.property({dependsOn:["_controller.updating"]})],f.prototype,"updating",void 0);g([E.property({dependsOn:["_controller.rootNodeVisible"]})],f.prototype,"suspended",void 0);g([E.property(R.updatingPercentage)],f.prototype,"updatingPercentage",void 0);g([E.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],f.prototype,"updatingPercentageValue",
void 0);g([E.property({readOnly:!0})],f.prototype,"hasTexturesOrVertexColors",null);g([E.property({readOnly:!0,dependsOn:["layer.renderer"]})],f.prototype,"rendererNeedsTextures",null);g([E.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],f.prototype,"elevationOffset",null);g([E.property({type:Boolean})],f.prototype,"slicePlaneEnabled",void 0);g([E.property()],f.prototype,"alwaysLoadEverythingModeEnabled",void 0);g([E.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled",
"useCompressedTextures"]})],f.prototype,"uncompressedTextureDownsamplingEnabled",null);g([E.property({dependsOn:["layer.version"]})],f.prototype,"useCompressedTextures",null);return f=n=g([E.subclass("esri.views.3d.layers.I3SMeshView3D")],f)}(E.declared(q,n,x));var wa=G.vec3f64.create(),Aa=H.create(),Ca=H.create(),Pa=[0,0,0,0],gb=new e([0,0,0,0]);return f})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/errors/CancelError ../../../core/Accessor ../../../core/arrayUtils ../../../core/Evented ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/gl-matrix ../../../core/sql/WhereClause ../../../geometry/support/aaBoundingBox ../../../views/3d/layers/i3s/I3SFrameWorker ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/i3s/IdleQueue ../../../views/3d/support/projectionUtils ../../../views/3d/support/ResourceController".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H,I){function N(a,b){return a.length===b.length&&a.every(function(a){return 0<=S(b,a.name)})}function S(a,b){b=b.toLowerCase();for(var c=0;c<a.length;c++)if(a[c].name.toLowerCase()===b)return c;return-1}function M(a){return null!=a&&null!=a.loadedAttributes&&null!=a.attributeData}var P=l.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");p=function(b){function c(a){a=b.call(this)||this;a.nodeIndex={};a.screenSizeFactor=
0;a.featureTarget=5E4;a.fixedFeatureTarget=!1;a.updating=!0;a.updatingPercentage=0;a.leafsReached=!1;a.uncompressedTextureDownsamplingEnabled=!1;a.alwaysLoadEverythingModeEnabled=!1;a._featureLOD=1;a._stableFeatureLOD=!1;a._isIdle=!1;a._cameraDirty=!0;a._hasFeatures=!1;a._downloadingNodes=new Set;a._loadingNodes=new Set;a._updatingNodes=new Map;a._progressMaxNumNodes=1;a._poi=null;a._requiredAttributesDirty=!0;a._updatesDisabled=!1;a.disableIDBCache=!1;a.disableMemCache=!1;a._restartNodeLoading=!1;
a._fields=null;a._attributeStorageInfo=null;a._handles=new d;a._idleQueue=new G.IdleQueue;a._errorCount=0;return a}k(c,b);Object.defineProperty(c.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.getStreamDataSupplier(I.ClientType.SCENE,{trackRequests:!0})},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"parsedDefinitionExpression",{get:function(){if("definitionExpression"in this.layer&&this.layer.definitionExpression)try{var a=y.create(this.layer.definitionExpression);if(!a.isStandardized())return P.error("definitionExpression is using non standard function"),null;var b=[],c=a.getFields();D.findFieldsCaseInsensitive(c,this.layer.fields,{missingFields:b});return 0<b.length?(P.error("definitionExpression references unknown fields: "+b.join(", ")),null):a}catch(T){return P.error("Failed to parse definitionExpression: "+
T),null}else return null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"definitionExpressionFields",{get:function(){if(this.parsedDefinitionExpression){var a=this.parsedDefinitionExpression.getFields();return D.findFieldsCaseInsensitive(a,this._fields)}return null},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"crsVertex",{get:function(){return D.getVertexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"crsIndex",{get:function(){return D.getIndexCrs(this.layer)},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"rootNodeVisible",{get:function(){var a=this._rootNodeId&&this.nodeIndex[this._rootNodeId];return a&&this._viewportQueries?this._viewportQueries.isNodeVisible(a):!0},enumerable:!0,configurable:!0});c.prototype.initialize=function(){var a=this;this.updateEventListener={needsUpdate:function(){return!1},idleBegin:function(){return a._updateIdleState(!0)},idleEnd:function(){return a._updateIdleState(!1)}};this.updateEventListenerWhileSuspended=
{idleBegin:function(){return a._startNodeLoadingWhileSuspended()}};this._lodHandling=new B(this.layerView,function(){return a.updatingChanged()});var b=this.layerView.layer;this.layer=b;this._defaultGeometrySchema=b.store.defaultGeometrySchema;this._rootNodeUrl=b.store.rootNode;var c=this._rootNodeUrl.split("/");this._rootNodeId=c[c.length-1];this.disableIDBCache=m("disable-feature:idb-cache");"fields"in b&&(this._fields=b.fields,this._attributeStorageInfo=b.attributeStorageInfo);b=q.all([this.layer.when(),
this.layerView.when()]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){var b=a.layerView.view;a.setClippingArea(b.clippingArea);a._centerOnSurface=b.pointsOfInterest.centerOnSurfaceFrequent;a._handles.add(a._centerOnSurface.watch("renderLocation",function(){return a._pointOfInterestChanged()}));var c=a.layerView.view.resourceController;a._handles.add(c.memoryEvents.on("quality-changed",function(){return a._setCameraDirty()}));a._handles.add(t.init(a.layerView,"suspended",function(b){a._idleFrameWorker&&
(a._idleFrameWorker.remove(),a._idleFrameWorker=null,a.restartNodeLoading());a._removeFrameWorker();b?a._idleFrameWorker=c.registerIdleFrameWorker(a.updateEventListenerWhileSuspended):(a._idleFrameWorker=c.registerIdleFrameWorker(a.updateEventListener),a._initFrameWorker())}),"layerview");a._handles.add(a.layer.watch("elevationInfo",function(b){return a._elevationInfoChanged(b)}),"layer");a.watch("uncompressedTextureDownsamplingEnabled",function(){return a.restartNodeLoading()});a.watch("alwaysLoadEverythingModeEnabled",
function(){return a.restartNodeLoading()});a._handles.add(b.state.watch("camera",function(){return a._setCameraDirty()}));a._handles.add(a.watch(["featureTarget","fixedFeatureTarget"],function(){return a._stableFeatureLOD=!1}));a._handles.add(a.layerView.watch("lodFactor",function(){return a._setCameraDirty()}),"quality");a._handles.add([a.layer.watch("renderer",function(){return a._requiredFieldsChange()}),a.layer.watch("definitionExpression",function(){return a._requiredFieldsChange()}),a.layer.watch("labelsVisible",
function(){return a._labelingChanged()}),a.layer.watch("labelingInfo",function(){return a._labelingChanged()}),a.layerView.watch("additionalRequiredFields",function(){return a._requiredFieldsChange()})],"requiredAttributes")}});this.addResolvingPromise(b);this.when(function(){return a._startNodeLoading()})};c.prototype.destroy=function(){this._removeFrameWorker();this._idleFrameWorker&&(this._isIdle=!1,this._idleFrameWorker.remove(),this._idleFrameWorker=null);this._handles.destroy();this._nodeLoader=
null};c.prototype._initFrameWorker=function(){var a=this;this._frameWorker=z.addFrameWorker(this.layerView.view.resourceController,function(b,c){a._frame(b,c);return a._index?a._index.getPriority():-Infinity})};c.prototype._removeFrameWorker=function(){null!=this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null)};c.prototype._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields)return[];var a=Object.create(null);this.layer.renderer&&this.layer.renderer.collectRequiredFields(a);
this.layer.labelsVisible&&this.layer.labelingInfo&&this.layer.labelingInfo.forEach(function(b){b._collectRequiredFields(a)});if(null!=this.definitionExpressionFields)for(var b=0,c=this.definitionExpressionFields;b<c.length;b++){var d=c[b];a[d]=!0}if(null!=this.layerView.additionalRequiredFields)for(b=0,c=this.layerView.additionalRequiredFields;b<c.length;b++)d=c[b],a[d]=!0;var e=this._attributeStorageInfo,g=this._fields,f=this.layer.objectIdField;return Object.keys(a).map(function(a){var b=S(e,a);
a=S(g,a);return 0<=b&&0<=a?{index:b,name:g[a].name,field:g[a],attributeStorageInfo:e[b]}:null}).filter(function(a){return null!=a&&a.name!==f}).sort(function(a,b){return b.index-a.index}).filter(function(a,b,c){return 0===b||c[b-1].index!==a.index})};c.prototype._requiredFieldsChange=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};c.prototype._labelingChanged=function(){var a=this._requiredAttributes,b=this._getRequiredAttributes();N(a,b)||this._requiredFieldsChange()};c.prototype.setClippingArea=
function(a){var b=x.create();H.extentToBoundingBox(a,b,this.layerView.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null};c.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.updatePointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=W.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestReload())))};c.prototype._calculatePointOfInterest=
function(a){void 0===a&&(a=r.vec3f64.create());var b=this._centerOnSurface.renderLocation,c=r.vec3f64.create();r.vec3.subtract(c,b,this.camPos);r.vec3.normalize(c,c);var d=this.layerView.view.renderCoordsHelper,e=r.vec3f64.create();d.worldUpAtPosition(b,e);c=Math.acos(r.vec3.dot(e,c))-.5*Math.PI;r.vec3.lerp(a,this.camPos,b,Math.max(0,Math.min(1,c/(.5*Math.PI))));return a};c.prototype.updateClippingArea=function(a){this.setClippingArea(a);this._cameraDirty=!0;this._viewportQueries&&this._viewportQueries.updateExtent(this._clippingArea)};
c.prototype._setCameraDirty=function(){this._cameraDirty=!0;this.updatingChanged()};c.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path};c.prototype.updateElevationChanged=function(a,b,c){D.findIntersectingNodes(a,b,this.nodeIndex.root,this.crsIndex,this.nodeIndex,function(a){c.push(a)});for(a=0;a<c.length;a++)b=c.data[a],this._viewportQueries.invalidateCache(b.id),b.id===this._rootNodeId&&this.notifyChange("rootNodeVisible");c.length&&this.restartNodeLoading()};c.prototype._elevationInfoChanged=
function(a){this._viewportQueries.invalidateCache();this._initViewData()};c.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0;this.updatingChanged()};c.prototype.schedule=function(a,b){var c=this;return this._idleQueue.push(b).then(function(b){if(!c._loadingNodes.has(a)&&!c._updatingNodes.has(a))throw new g;return b})};c.prototype.reschedule=function(a,b){var c=this;return this._idleQueue.unshift(b).then(function(b){if(!c._loadingNodes.has(a)&&!c._updatingNodes.has(a))throw new g;
return b})};Object.defineProperty(c.prototype,"unloadedMemoryEstimate",{get:function(){return!this._index||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor},enumerable:!0,configurable:!0});c.prototype._frame=function(a,b){null!==this._viewportQueries&&this._viewportQueries.setCameraIdle(!this._cameraDirty);this.layerView.visible&&this._processLogError(a,b)};c.prototype._processLogError=function(a,b){try{this._process(a,b)}catch(L){50>this._errorCount?P.error("Error during processing: "+
L):50===this._errorCount&&P.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};c.prototype._process=function(a,b){var c=this;this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading());if(null!=this._nodeLoader&&null!=this._index){this._updateViewData();a.runWithProgress(function(){return c._processIndex(b)});this._updateFeatureLOD();for(a.runWithProgress(function(){return c._processNodes(a,b)});0<this._idleQueue.length()&&!a.doneWithProgress();)this._idleQueue.process(),
a.madeProgress();a.runWithProgress(function(){return c._prefetchIndex(b)});b.numIndexLoading+=this._index.getIndexLoading();b.numNodesLoading+=this._downloadingNodes.size;this.updatingChanged();this._lodHandling.lodGlobalHandling()}};c.prototype._processIndex=function(a){a=Math.min(10-a.numIndexLoading-this._index.getIndexLoading(),this._getAvailableLoadTokens(1,a));this._index.update(e.keysOfSet(this._loadingNodes));var b=this._index.getFeatureEstimate().leafsReached;this._index.isLoading()||b===
this._get("leafsReached")||this._set("leafsReached",b);return this._index.load(a)};c.prototype._prefetchIndex=function(a){if(0<this._loadingNodes.size)return!1;a=Math.min(10-a.numIndexLoading-this._index.getIndexLoading(),this._getAvailableLoadTokens(1,a));return this._index.prefetch(a)};c.prototype._updateFeatureLOD=function(){var a=this._index.getFeatureEstimate();if(a.estimate){var b=this.featureTarget*this.baseLOD,c=!this._index.isLoading();if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;
this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(c&&a.estimate<b){if(a.leafsReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.max(b/a.estimate,1.001);a=this.lod;b=this._index.checkFeatureTarget(b,a);b!==a&&(this._featureLOD=b/this.baseLOD,this._stableFeatureLOD=!0)}else if(a.estimate>1.2*b||c&&a.estimate>b){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(a.estimate/b-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,
this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.requestReload()}};c.prototype._processNodes=function(a,b){var c=this,d=this._index.getUpdates((this._isIdle?100:2)-this._loadingNodes.size);d.cancel.forEach(this._cancelNodeIdLoading,this);d.update.some(function(b){if(a.doneWithProgress())return!0;c._updateLoadedNode(b);a.madeProgress();return!1});d.add.some(function(d){if(a.doneWithProgress())return!0;if(d.notInCache&&!c._hasNodeLoadToken(b))return!1;c._loadNode(d);
a.madeProgress();return!1});return a.hasProgressed};c.prototype._cancelNodeLoading=function(){var a=this;this._loadingNodes.clear();this._downloadingNodes.clear();this._updatingNodes.forEach(function(b,c){return a._updatingNodes.get(c).cancel()});this._updatingNodes.clear()};c.prototype._cancelNodeIdLoading=function(a){this._loadingNodes.delete(a);this._downloadingNodes.delete(a)};c.prototype._getAvailableLoadTokens=function(a,b){var c=b.numIndexLoading+this._index.getIndexLoading();return Math.floor((12-
1*c-2*(b.numNodesLoading+this._loadingNodes.size))/a)};c.prototype._hasNodeLoadToken=function(a){var b=this._isIdle&&!this._index.isLoading()?5:2;return a.numNodesLoading+this._loadingNodes.size>=b?!1:0<this._getAvailableLoadTokens(2,a)};c.prototype.updatingChanged=function(){var a=this._index?this._index.getIndexMissing():0,b=this._index?this._index.getNodesMissing():0,a=a+3*b+2*this._loadingNodes.size,b=!(!(0<a||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length()||
this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&this._isIdle);0===a&&(this._progressMaxNumNodes=1);this._progressMaxNumNodes=Math.max(a,this._progressMaxNumNodes);b!==this._get("updating")&&this._set("updating",b);a=100*a/this._progressMaxNumNodes;a!==this._get("updatingPercentage")&&this._set("updatingPercentage",a)};c.prototype._initViewData=function(){var a=this.layerView.view,b=a.state.camera,c=a.renderCoordsHelper;this.camPos=r.vec3f64.clone(a.pointsOfInterest.renderPointOfView);
this.screenSizeFactor=1/b.perPixelRatio;this._poi=this._calculatePointOfInterest();var d=this.lod;this._viewportQueries=new E(this.crsIndex,c,b,this._poi,this._clippingArea,a.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(this.layer),screenspaceErrorBias:d,angleDependentLoD:.5>d,disableLod:this.alwaysLoadEverythingModeEnabled});this._cameraDirty=!1;this.notifyChange("rootNodeVisible")};c.prototype._updateViewData=function(){if(this._cameraDirty&&this._index){var a=
this.layerView.view,b=a.state.camera;this.camPos=r.vec3f64.clone(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/b.perPixelRatio;this._poi=this._calculatePointOfInterest(this._poi);this._viewportQueries.updateCamera(b);this._viewportQueries.updatePointOfInterest(this._poi);this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.progressiveLoadPenalty=W.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestReload();this._stableFeatureLOD=!1;this.alwaysLoadEverythingModeEnabled||
this._removeInvisibleNodes();this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};c.prototype._getProgressiveLoadFactor=function(a){return 1>this.layerView.view.resourceController.memoryFactor?1:this.layerView.progressiveLoadFactor};Object.defineProperty(c.prototype,"lod",{get:function(){return this._featureLOD*this.baseLOD},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"baseLOD",{get:function(){return this.fixedFeatureTarget?1:this.layerView.lodFactor*this.layerView.view.resourceController.memoryFactor},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"lodDropFactor",{get:function(){return this.fixedFeatureTarget?0:2*Math.min(this.layerView.view.resourceController.memoryFactor,.5)},enumerable:!0,configurable:!0});c.prototype._startNodeLoadingWhileSuspended=function(){this._initViewData();this.alwaysLoadEverythingModeEnabled&&this.layerView.visible&&!this.layerView.get("parent.suspended")||this._removeInvisibleNodes()};c.prototype.isGeometryVisible=function(a){return this._viewportQueries.isGeometryVisible(a)};
c.prototype.updateVisibility=function(a){return this._viewportQueries.updateNode(a)};c.prototype._shouldLoadNode=function(a){return!this._lodHandling.shouldLoadNode(a)||this._shouldDropNode(a)?!1:a.obb?this._viewportQueries.isGeometryVisible(a):!0};c.prototype._shouldDropNode=function(a){var b=this.lodDropFactor;return 1>b&&this._lodHandling.childrenEmpty(a)&&this._viewportQueries.calcCameraDistance(a)>this._viewportQueries.maxDistance*b};c.prototype._startNodeLoading=function(){var a=this;this._restartNodeLoading=
!1;if(!this._updatesDisabled&&null!=this.streamDataSupplier){this._initViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);var b=C.TextureFormat.Normal;this.layerView.useCompressedTextures?b=C.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(b=C.TextureFormat.Downsampled);var c=this._defaultGeometrySchema;this._nodeLoader=new C(this.streamDataSupplier,P,c,this._requiredAttributes,{textureFormat:b,
loadTextureData:this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid||null==c||null==c.ordering});b=W.distancePenalty*this._viewportQueries.distCameraToPOI();this._index=new w(this.getBaseUrl(),this._rootNodeUrl,this._rootNodeId,b,this.nodeIndex,this.streamDataSupplier,this._viewportQueries,P,function(b){return a.layerView.isNodeLoaded(b)},function(b){return a._shouldLoadNode(b)},function(b){return a._enableFromGPUCache(b)},function(b){return a._needsUpdate(b)});b=this.layerView.view.renderSpatialReference;
b=this.crsIndex.equals(b)||this.crsIndex.isWGS84&&b.equals(H.SphericalECEFSpatialReference);this._index.ignoreServiceOBB=!b;this.alwaysLoadEverythingModeEnabled||this._removeInvisibleNodes();this._lodHandling.startNodeLoading(function(b){return a._viewportQueries.isNodeVisible(b)},function(b){return a._viewportQueries.isGeometryVisible(b)},function(b){return a._index.nodeTraversalState(b)},this.nodeIndex,this._rootNodeId,{maxLodLevel:this._viewportQueries.maxLodLevel});this.updatingChanged()}};c.prototype.isNodeLoading=
function(){return null!=this._nodeLoader&&null!=this._index};c.prototype.cancelNodeLoading=function(){this.isNodeLoading()&&(this._nodeLoader.cancelAll(),this.streamDataSupplier.cancelAll(),this._idleQueue.cancelAll(),this._cancelNodeLoading(),this._poi=this._index=this._nodeLoader=null,this.layerView.additionalCancelNodeLoadingHandler&&this.layerView.additionalCancelNodeLoadingHandler(),this.updatingChanged())};c.prototype._removeInvisibleNodes=function(){var a=this.layerView.getLoadedNodeIDs();
O.clear();for(var b=0;b<a.length;b++){var c=this.nodeIndex[a[b]];if(!this._viewportQueries.isGeometryVisible(c)||this._shouldDropNode(c))this._lodHandling.setLodGlobalDirty(),O.push(c)}return 0<O.length?(this.layerView.removeNodeData(O),O.clear(),!0):!1};c.prototype._needsUpdate=function(a){if(null==a.featureData||0===a.featureData.length||this._updatingNodes.has(a.id))return!1;a=this.layerView.getLoadedAttributes(a);return null!=a&&a!==this._requiredAttributes};c.prototype._updateLoadedNode=function(a){var b=
this,c=a.baseUrl,d=this.layerView.getLoadedAttributes(a),c=N(d,this._requiredAttributes)?q.resolve(this.layerView.getAttributeData(a)):this._nodeLoader.loadAttributes(a,c,this._requiredAttributes);this._updatingNodes.set(a.id,c);c.then(function(c){return b.schedule(a.id).then(function(){return b.layerView.setAttributeData(a,{loadedAttributes:b._requiredAttributes,attributeData:c})})}).catch(function(c){c instanceof g||b.layerView.setAttributeData(a,{loadedAttributes:b._requiredAttributes,attributeData:{}})}).catch(function(){}).then(function(){b._updatingNodes.delete(a.id);
b.updatingChanged()});this.updatingChanged()};c.prototype._loadNode=function(a){var b=this;this._loadingNodes.add(a.id);this.updatingChanged();this._loadAndAddBundle(a).catch(function(a){return a}).then(function(){b._loadingNodes.delete(a.id);b._hasFeatures=b._hasFeatures||!!a.numFeatures;b.updatingChanged()})};c.prototype._loadAndAddBundle=function(a){1!==a.featureData.length&&P.warn("Node ${node.id} has ${node.featureData.length} bundles. Only the first bundle will be loaded.");return a.notInCache?
this._loadUncached(a):this._loadCached(a).then(function(b){b||(a.notInCache=!0)}).catch(function(b){b instanceof g||(a.notInCache=!0)})};c.prototype._enableFromGPUCache=function(a){if(this.disableMemCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var b=this.layerView.loadCachedGPUData(a);if(!b||!M(b.attributeInfo)||!N(b.attributeInfo.loadedAttributes,this._requiredAttributes))return!1;this.layerView.addCachedGPUData(a,b);this._lodHandling.lodSwapBundleLoaded(a);
return!0};c.prototype._loadCached=function(a){var b=this,c=this.layerView;return!this.disableIDBCache&&c.loadCachedNodeData&&c.addCachedNodeData?this.schedule(a.id).then(function(){return c.loadCachedNodeData(a,function(a,c){return b._nodeLoader.loadTextures(a,c)})}).then(function(d){if(null==d)return!1;var e=b._requiredAttributes;return M(d)&&N(d.loadedAttributes,e)?b.reschedule(a.id).then(function(){return c.addCachedNodeData(a,d,d)}).then(function(){b._lodHandling.lodSwapBundleLoaded(a);return!0}):
b.reschedule(a.id).then(function(){return b._nodeLoader.loadAttributes(a,a.baseUrl,e)}).then(function(c){return b.reschedule(a.id,{loadedAttributes:e,attributeData:c})}).then(function(b){return c.addCachedNodeData(a,d,b)}).then(function(){b._lodHandling.lodSwapBundleLoaded(a);return!0})}):q.resolve(!1)};c.prototype._loadUncached=function(a){var b=this;this._downloadingNodes.add(a.id);return this._nodeLoader.loadBundleData(a,0).then(function(c){b._downloadingNodes.delete(a.id);return b.schedule(a.id,
c)}).then(function(c){return b.layerView.addNodeData(a,c)}).then(function(){b._lodHandling.lodSwapBundleLoaded(a);a.notInCache=!1}).catch(function(b){b instanceof g||(P.error("Failed to load node '"+a.id+"' bundle 0: "+b),a.failed=!0)})};c.prototype._updateIdleState=function(a){a!==this._isIdle&&(this._isIdle=a,this._viewportQueries&&this._viewportQueries.setCameraIdle(!0),this.updatingChanged())};c.prototype.updateStats=function(a){a.index=Object.keys(this.nodeIndex).length;this._hasFeatures&&(a.detail=
this._featureLOD,a.target=this.featureTarget*this.baseLOD);this._index&&this._index.updateStats(a)};a([u.property({readOnly:!0})],c.prototype,"isMeshPyramid",null);a([u.property({readOnly:!0})],c.prototype,"streamDataSupplier",null);a([u.property({readOnly:!0,dependsOn:["layer.definitionExpression"]})],c.prototype,"parsedDefinitionExpression",null);a([u.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],c.prototype,"definitionExpressionFields",null);a([u.property({readOnly:!0})],c.prototype,
"crsVertex",null);a([u.property({readOnly:!0})],c.prototype,"crsIndex",null);a([u.property({readOnly:!0})],c.prototype,"nodeIndex",void 0);a([u.property()],c.prototype,"camPos",void 0);a([u.property()],c.prototype,"screenSizeFactor",void 0);a([u.property()],c.prototype,"featureTarget",void 0);a([u.property()],c.prototype,"fixedFeatureTarget",void 0);a([u.property()],c.prototype,"layerView",void 0);a([u.property()],c.prototype,"layer",void 0);a([u.property({readOnly:!0})],c.prototype,"updating",void 0);
a([u.property({readOnly:!0})],c.prototype,"updatingPercentage",void 0);a([u.property({readOnly:!0})],c.prototype,"leafsReached",void 0);a([u.property({readOnly:!0})],c.prototype,"rootNodeVisible",null);a([u.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled"})],c.prototype,"uncompressedTextureDownsamplingEnabled",void 0);a([u.property({aliasOf:"layerView.alwaysLoadEverythingModeEnabled"})],c.prototype,"alwaysLoadEverythingModeEnabled",void 0);return c=a([u.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],
c)}(u.declared(b,n,c));var O=new h,W={factorIM:.2,factor3dObject:.05,distancePenalty:10};return p})},"esri/core/sql/WhereClause":function(){define("require exports @dojo/framework/shim/array @dojo/framework/shim/Map ../../moment ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(p,f,k,a,g,b,e,c){function d(a){return Array.isArray(a)?a:[a]}function m(a){return null!==a?!0!==a:null}function l(a,b){if(null==a)return null;for(var c=!1,d=0;d<b.length;d++){var e=b[d];if(null==
e)c=null;else if(a===e){c=!0;break}}return c}function h(a,b,c){if(null==a)return null;for(var d="",e=0,g=0;g<b.length;g++){var f=b.charAt(g);switch(e){case 0:f===c?e=1:d=0<="-[]/{}()*+?.\\^$|".indexOf(f)?d+("\\"+f):"%"===f?d+".*":"_"===f?d+".":d+f;break;case 1:d=0<="-[]/{}()*+?.\\^$|".indexOf(f)?d+("\\"+f):d+f,e=0}}return(new RegExp("^"+d+"$")).test(a)}function n(a){return a instanceof Date?a.valueOf():a}function q(a,b,c){if(null==b||null==c)return null;b=n(b);c=n(c);switch(a){case "\x3c\x3e":return b!==
c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function t(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d],g=e.toLowerCase();void 0===c[g]&&(b.push(e),c[g]=1)}return b}return function(){function f(){this._hasAggregateFunctions=this._hasStandardizedFunctions=this.parameters=this.parseTree=null}f.create=function(a){var d=new f;d.parseTree=c.WhereGrammar.parse(a);var g=!0,h=!0;d.visitAll(d.parseTree,function(a){if("function"===
a.type){var c=a.name;a=a.args.value.length;g&&(g=e.isStandardized(c,a));h&&(h=b.isAggregate(c,a))}});d._hasStandardizedFunctions=g;d._hasAggregateFunctions=h;return d};f.prototype.isStandardized=function(){return this._hasStandardizedFunctions};f.prototype.isAggregate=function(){return this._hasAggregateFunctions};f.prototype.setVariablesDictionary=function(a){this.parameters=a};f.prototype.testFeature=function(a){return!!this.evaluateNode(this.parseTree,a)};f.prototype.testSet=function(b){var c=
this,d=new a.default;this.visitAll(this.parseTree,function(a){"column_ref"!==a.type||d.has(a.column)||d.set(a.column,a)});for(var e={},g=function(a){d.forEach(function(b,d){b=c.featureValue(a,d,b);e[d]?e[d].push(b):e[d]=[b]})},f=0;f<b.length;f++)g(b[f]);return!!this.evaluateNode(this.parseTree,{attributes:e})};f.prototype.calculateValue=function(a){return this.evaluateNode(this.parseTree,a)};f.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&
a.push(b.name.toLowerCase())});return t(a)};f.prototype.getExpressions=function(){var b=new a.default;this.visitAll(this.parseTree,function(a){if("function"===a.type){var c=a.name.toLowerCase();a=a.args.value[0];if("column_ref"===a.type){a=a.column;var d=c+"-"+a;b.has(d)||b.set(d,{aggregateType:c,field:a})}}});return k.from(b.values())};f.prototype.getFields=function(){var a=[];this.visitAll(this.parseTree,function(b){"column_ref"===b.type&&a.push(b.column)});return t(a)};f.prototype.getVariables=
function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return t(a)};f.prototype.featureValue=function(a,b,c){a=a&&"object"===typeof a.attributes?a.attributes:a;var d=a[b];if(void 0!==d)return d;for(var e in a)if(b.toLowerCase()===e.toLowerCase())return c.column=e,a[e];return null};f.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,b);this.visitAll(a.value,b);break;case "case_expression":for(var c=
0,d=a.clauses;c<d.length;c++){var e=d[c];this.visitAll(e,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)e=a[c],this.visitAll(e,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};f.prototype.evaluateNode=function(a,c){switch(a.type){case "case_expression":if("simple"===a.format)for(var f=
n(this.evaluateNode(a.operand,c)),k=0;k<a.clauses.length;k++){if(f===n(this.evaluateNode(a.clauses[k].operand,c)))return this.evaluateNode(a.clauses[k].value,c)}else for(k=0;k<a.clauses.length;k++)if(!0===this.evaluateNode(a.clauses[k].operand,c))return this.evaluateNode(a.clauses[k].value,c);return null!==a.else?this.evaluateNode(a.else,c):null;case "param":return this.parameters[a.value.toLowerCase()];case "expr_list":f=[];k=0;for(a=a.value;k<a.length;k++){var r=a[k];f.push(this.evaluateNode(r,
c))}return f;case "unary_expr":return m(this.evaluateNode(a.expr,c));case "binary_expr":switch(a.operator){case "AND":return f=this.evaluateNode(a.left,c),c=this.evaluateNode(a.right,c),null!=f&&null!=c?!0===f&&!0===c:!1===f||!1===c?!1:null;case "OR":return f=this.evaluateNode(a.left,c),c=this.evaluateNode(a.right,c),null!=f&&null!=c?!0===f||!0===c:!0===f||!0===c?!0:null;case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(a.left,c);case "ISNOT":if("null"!==
a.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(a.left,c);case "IN":return f=d(this.evaluateNode(a.right,c)),l(this.evaluateNode(a.left,c),f);case "NOT IN":return f=d(this.evaluateNode(a.right,c)),m(l(this.evaluateNode(a.left,c),f));case "BETWEEN":return f=this.evaluateNode(a.left,c),c=this.evaluateNode(a.right,c),null==f||null==c[0]||null==c[1]?null:f>=c[0]&&f<=c[1];case "NOTBETWEEN":return f=this.evaluateNode(a.left,c),c=this.evaluateNode(a.right,c),null==f||null==
c[0]||null==c[1]?null:f<c[0]||f>c[1];case "LIKE":return h(this.evaluateNode(a.left,c),this.evaluateNode(a.right,c),a.escape);case "NOT LIKE":return m(h(this.evaluateNode(a.left,c),this.evaluateNode(a.right,c),a.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return q(a.operator,this.evaluateNode(a.left,c),this.evaluateNode(a.right,c));case "*":return this.evaluateNode(a.left,c)*this.evaluateNode(a.right,c);case "-":return this.evaluateNode(a.left,c)-this.evaluateNode(a.right,
c);case "+":return this.evaluateNode(a.left,c)+this.evaluateNode(a.right,c);case "/":return this.evaluateNode(a.left,c)/this.evaluateNode(a.right,c)}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return a.value;case "date":return g(a.value,["YYYY-M-D"]).toDate();case "timestamp":return g(a.value,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate();case "column_ref":return"CURRENT_DATE"===a.column.toUpperCase()?
(r=new Date,r.setHours(0,0,0,0),r):"CURRENT_TIMESTAMP"===a.column.toUpperCase()?new Date:this.featureValue(c,a.column,a);case "function":return c=this.evaluateNode(a.args,c),this.isAggregate()?b.aggregateFunction(a.name,c):e.evaluateFunction(a.name,c)}throw Error("Unsupported sql syntax "+a.type);};return f}()})},"@dojo/framework/shim/Map":function(){(function(p){"object"===typeof module&&"object"===typeof module.exports?(p=p(require,exports),void 0!==p&&(module.exports=p)):"function"===typeof define&&
define.amd&&define("require exports tslib ./iterator ./global ./object ./support/has ./Symbol".split(" "),p)})(function(p,f){Object.defineProperty(f,"__esModule",{value:!0});var k=p("tslib"),a=p("./iterator"),g=p("./global"),b=p("./object"),e=p("./support/has");p("./Symbol");f.Map=g.default.Map;e.default("es6-map")||(f.Map=(c=function(){function c(b){this._keys=[];this._values=[];this[Symbol.toStringTag]="Map";if(b)if(a.isArrayLike(b))for(var c=0;c<b.length;c++){var d=b[c];this.set(d[0],d[1])}else try{for(var c=
k.__values(b),e=c.next();!e.done;e=c.next())d=e.value,this.set(d[0],d[1])}catch(u){g={error:u}}finally{try{e&&!e.done&&(f=c.return)&&f.call(c)}finally{if(g)throw g.error;}}var g,f}c.prototype._indexOfKey=function(a,c){for(var d=0,e=a.length;d<e;d++)if(b.is(a[d],c))return d;return-1};Object.defineProperty(c.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0});c.prototype.clear=function(){this._keys.length=this._values.length=0};c.prototype.delete=function(a){a=
this._indexOfKey(this._keys,a);if(0>a)return!1;this._keys.splice(a,1);this._values.splice(a,1);return!0};c.prototype.entries=function(){var b=this,c=this._keys.map(function(a,c){return[a,b._values[c]]});return new a.ShimIterator(c)};c.prototype.forEach=function(a,b){for(var c=this._keys,d=this._values,e=0,g=c.length;e<g;e++)a.call(b,d[e],c[e],this)};c.prototype.get=function(a){a=this._indexOfKey(this._keys,a);return 0>a?void 0:this._values[a]};c.prototype.has=function(a){return-1<this._indexOfKey(this._keys,
a)};c.prototype.keys=function(){return new a.ShimIterator(this._keys)};c.prototype.set=function(a,b){var c=this._indexOfKey(this._keys,a),c=0>c?this._keys.length:c;this._keys[c]=a;this._values[c]=b;return this};c.prototype.values=function(){return new a.ShimIterator(this._values)};c.prototype[Symbol.iterator]=function(){return this.entries()};return c}(),c[Symbol.species]=c,c));f.default=f.Map;var c})},"@dojo/framework/shim/object":function(){(function(p){"object"===typeof module&&"object"===typeof module.exports?
(p=p(require,exports),void 0!==p&&(module.exports=p)):"function"===typeof define&&define.amd&&define(["require","exports","./global","./support/has","./Symbol"],p)})(function(p,f){Object.defineProperty(f,"__esModule",{value:!0});var k=p("./global"),a=p("./support/has"),g=p("./Symbol");a.default("es6-object")?(p=k.default.Object,f.assign=p.assign,f.getOwnPropertyDescriptor=p.getOwnPropertyDescriptor,f.getOwnPropertyNames=p.getOwnPropertyNames,f.getOwnPropertySymbols=p.getOwnPropertySymbols,f.is=p.is,
f.keys=p.keys):(f.keys=function(a){return Object.keys(a).filter(function(a){return!a.match(/^@@.+/)})},f.assign=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(null==a)throw new TypeError("Cannot convert undefined or null to object");var d=Object(a);b.forEach(function(a){a&&f.keys(a).forEach(function(b){d[b]=a[b]})});return d},f.getOwnPropertyDescriptor=function(a,e){g.isSymbol(e);return Object.getOwnPropertyDescriptor(a,e)},f.getOwnPropertyNames=function(a){return Object.getOwnPropertyNames(a).filter(function(a){return!a.match(/^@@.+/)})},
f.getOwnPropertySymbols=function(a){return Object.getOwnPropertyNames(a).filter(function(a){return!!a.match(/^@@.+/)}).map(function(a){return Symbol.for(a.substring(2))})},f.is=function(a,e){return a===e?0!==a||1/a===1/e:a!==a&&e!==e});a.default("es2017-object")?(p=k.default.Object,f.getOwnPropertyDescriptors=p.getOwnPropertyDescriptors,f.entries=p.entries,f.values=p.values):(f.getOwnPropertyDescriptors=function(a){return f.getOwnPropertyNames(a).reduce(function(b,c){b[c]=f.getOwnPropertyDescriptor(a,
c);return b},{})},f.entries=function(a){return f.keys(a).map(function(b){return[b,a[b]]})},f.values=function(a){return f.keys(a).map(function(b){return a[b]})})})},"esri/core/sql/AggregateFunctions":function(){define(["require","exports"],function(p,f){function k(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b/a.length}function a(a){for(var b=k(a),c=a.length,d=0,g=0;g<a.length;g++)d+=Math.pow(a[g]-b,2);return 1<c?d/(c-1):0}Object.defineProperty(f,"__esModule",{value:!0});f.aggregateFunction=function(a,
e){var b=g[a.toLowerCase()];if(null==b)throw Error("Function Not Recognised");if(e.length<b.minParams||e.length>b.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return b.evaluate(e)};f.isAggregate=function(a,e){a=g[a.toLowerCase()];return null!=a&&e>=a.minParams&&e<=a.maxParams};var g={min:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.min.apply(Math,a[0])}},max:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.max.apply(Math,
a[0])}},avg:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:k(a[0])}},sum:{minParams:1,maxParams:1,evaluate:function(a){if(null==a[0])a=null;else{a=a[0];for(var b=0,c=0;c<a.length;c++)b+=a[c];a=b}return a}},stddev:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.sqrt(a(b[0]))}},count:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].length}},var:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:a(b[0])}}}})},
"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","dojo/regexp"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});f.evaluateFunction=function(g,b){var e=a[g.toLowerCase()];if(null==e)throw Error("Function Not Recognised");if(b.length<e.minParams||b.length>e.maxParams)throw Error("Invalid Parameter count for call to "+g.toUpperCase());return e.evaluate(b)};f.isStandardized=function(g,b){g=a[g.toLowerCase()];return null!=g&&b>=g.minParams&&b<=g.maxParams};
var a={extract:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];if(null==a)return null;if(a instanceof Date)switch(b.toUpperCase()){case "SECOND":return a.getSeconds();case "MINUTE":return a.getMinutes();case "HOUR":return a.getHours();case "DAY":return a.getDate();case "MONTH":return a.getMonth()+1;case "YEAR":return a.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(a){if(2===a.length){var b=a[0],e=a[1];return null==
b||null==e?null:b.toString().substring(e-1)}if(3===a.length)return b=a[0],e=a[1],a=a[2],null==b||null==e||null==a?null:0>=a?"":b.toString().substring(e-1,e+a-1)}},position:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];return null==b||null==a?null:a.indexOf(b)+1}},trim:{minParams:2,maxParams:3,evaluate:function(a){var b=3===a.length,e=b?a[1]:" ",b=b?a[2]:a[1];if(null==e||null==b)return null;e="("+k.escapeString(e)+")";switch(a[0]){case "BOTH":return b.replace(new RegExp("^"+e+"*|"+
e+"*$","g"),"");case "LEADING":return b.replace(new RegExp("^"+e+"*","g"),"");case "TRAILING":return b.replace(new RegExp(e+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.abs(a[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.ceil(a[0])}},floor:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.floor(a[0])}},log:{minParams:1,maxParams:1,evaluate:function(a){return null==
a[0]?null:Math.log(a[0])}},log10:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sin(a[0])}},cos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.cos(a[0])}},tan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.tan(a[0])}},asin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.asin(a[0])}},acos:{minParams:1,
maxParams:1,evaluate:function(a){return null==a[0]?null:Math.acos(a[0])}},atan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.atan(a[0])}},sign:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:0<a[0]?1:0>a[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:Math.pow(a[0],a[1])}},mod:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:a[0]%a[1]}},round:{minParams:1,maxParams:2,evaluate:function(a){var b=
a[0];a=2===a.length?Math.pow(10,a[1]):1;return null==b?null:Math.round(b*a)/a}},truncate:{minParams:1,maxParams:2,evaluate:function(a){return null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(a){return"string"===typeof a[0]||a[0]instanceof String?a[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(a){for(var b="",e=0;e<a.length;e++){if(null==a[e])return null;b+=a[e].toString()}return b}},
lower:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require","exports","./sql92grammar"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});p=function(){function a(){}a.parse=function(a){return k.parse(a)};return a}();f.WhereGrammar=p})},"esri/core/sql/sql92grammar":function(){define([],
function(){function p(f,k,a,g){this.message=f;this.expected=k;this.found=a;this.location=g;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,p)}(function(f,k){function a(){this.constructor=f}a.prototype=k.prototype;f.prototype=new a})(p,Error);p.buildMessage=function(f,k){function a(a){return a.charCodeAt(0).toString(16).toUpperCase()}function g(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,
"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}function b(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}var e={literal:function(a){return'"'+g(a.text)+
'"'},"class":function(a){var c="",e;for(e=0;e<a.parts.length;e++)c+=a.parts[e]instanceof Array?b(a.parts[e][0])+"-"+b(a.parts[e][1]):b(a.parts[e]);return"["+(a.inverted?"^":"")+c+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};return"Expected "+function(a){var b=Array(a.length),c;for(c=0;c<a.length;c++){var g=c,f;f=a[c];f=e[f.type](f);b[g]=f}b.sort();if(0<b.length){for(a=c=1;c<b.length;c++)b[c-1]!==b[c]&&(b[a]=b[c],a++);b.length=
a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(f)+" but "+(k?'"'+g(k)+'"':"end of input")+" found."};return{SyntaxError:p,parse:function(f,k){function a(a,b){return{type:"literal",text:a,ignoreCase:b}}function g(a,b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function b(a){var b=Va[a],c;if(!b){for(c=a-1;!Va[c];)c--;b=Va[c];for(b={line:b.line,column:b.column};c<a;)10===f.charCodeAt(c)?(b.line++,b.column=
1):b.column++,c++;Va[a]=b}return b}function e(a,c){var d=b(a),e=b(c);return{start:{offset:a,line:d.line,column:d.column},end:{offset:c,line:e.line,column:e.column}}}function c(a){A<Ea||(A>Ea&&(Ea=A,ib=[]),ib.push(a))}function d(){var a,b,c;a=A;b=V();b!==v?(b=l(),b!==v?(c=V(),c!==v?a=b:(A=a,a=v)):(A=a,a=v)):(A=a,a=v);return a}function m(){var a,b,c,d,e,g,f,h;a=A;b=l();if(b!==v){c=[];d=A;e=V();e!==v?(g=ga(),g!==v?(f=V(),f!==v?(h=l(),h!==v?d=e=[e,g,f,h]:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v);for(;d!==
v;)c.push(d),d=A,e=V(),e!==v?(g=ga(),g!==v?(f=V(),f!==v?(h=l(),h!==v?d=e=[e,g,f,h]:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v);if(c!==v){a={type:"expr_list"};b=[b];for(d=0;d<c.length;d++)b.push(c[d][3]);a.value=b}else A=a,a=v}else A=a,a=v;return a}function l(){var a,b,c,d,e,g,f,k;a=A;b=h();if(b!==v){c=[];d=A;e=V();e!==v?(g=ba(),g!==v?(f=V(),f!==v?(k=h(),k!==v?d=e=[e,g,f,k]:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v);for(;d!==v;)c.push(d),d=A,e=V(),e!==v?(g=ba(),g!==v?(f=V(),f!==v?(k=h(),k!==v?d=e=[e,
g,f,k]:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v);c!==v?a=b=ka(b,c):(A=a,a=v)}else A=a,a=v;return a}function h(){var a,b,c,d,e,g,f,h;a=A;b=n();if(b!==v){c=[];d=A;e=V();e!==v?(g=X(),g!==v?(f=V(),f!==v?(h=n(),h!==v?d=e=[e,g,f,h]:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v);for(;d!==v;)c.push(d),d=A,e=V(),e!==v?(g=X(),g!==v?(f=V(),f!==v?(h=n(),h!==v?d=e=[e,g,f,h]:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v);c!==v?a=b=ka(b,c):(A=a,a=v)}else A=a,a=v;return a}function n(){var a,b,d,e,g;a=A;b=R();b===v&&(b=
A,33===f.charCodeAt(A)?(d=Da,A++):(d=v,0===Y&&c(ua)),d!==v?(e=A,Y++,61===f.charCodeAt(A)?(g=qa,A++):(g=v,0===Y&&c(La)),Y--,g===v?e=void 0:(A=e,e=v),e!==v?b=d=[d,e]:(A=b,b=v)):(A=b,b=v));b!==v?(d=V(),d!==v?(e=n(),e!==v?a=b={type:"unary_expr",operator:"NOT",expr:e}:(A=a,a=v)):(A=a,a=v)):(A=a,a=v);if(a===v)if(a=A,b=r(),b!==v)if(d=V(),d!==v){var h,k,l;d=[];e=A;g=V();g!==v?(h=q(),h!==v?(k=V(),k!==v?(l=r(),l!==v?e=g=[g,h,k,l]:(A=e,e=v)):(A=e,e=v)):(A=e,e=v)):(A=e,e=v);if(e!==v)for(;e!==v;)d.push(e),e=A,
g=V(),g!==v?(h=q(),h!==v?(k=V(),k!==v?(l=r(),l!==v?e=g=[g,h,k,l]:(A=e,e=v)):(A=e,e=v)):(A=e,e=v)):(A=e,e=v);else d=v;d!==v&&(d={type:"arithmetic",tail:d});d===v&&(d=A,e=u(),e!==v?(g=V(),g!==v?(g=fa(),g!==v?(g=V(),g!==v?(g=m(),g!==v?(h=V(),h!==v?(h=ja(),h!==v?d=e={op:e,right:g}:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v),d===v&&(d=A,e=u(),e!==v?(g=V(),g!==v?(g=fa(),g!==v?(g=V(),g!==v?(g=ja(),g!==v?d=e={op:e,right:{type:"expr_list",value:[]}}:(A=d,d=v)):(A=d,d=v)):(A=
d,d=v)):(A=d,d=v)):(A=d,d=v),d===v&&(d=A,e=u(),e!==v?(g=V(),g!==v?(g=G(),g!==v?d=e={op:e,right:g}:(A=d,d=v)):(A=d,d=v)):(A=d,d=v))),d===v&&(d=A,g=R(),g!==v?(e=V(),e!==v?(e=ca(),e!==v?(h=V(),h!==v?(h=r(),h!==v?(k=V(),k!==v?(k=X(),k!==v?(g=V(),g!==v?(g=r(),g!==v?d=g={op:"NOT"+e,right:{type:"expr_list",value:[h,g]}}:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v),d===v&&(d=A,g=ca(),g!==v?(e=V(),e!==v?(e=r(),e!==v?(h=V(),h!==v?(h=X(),h!==v?(k=V(),k!==
v?(k=r(),k!==v?d=g={op:g,right:{type:"expr_list",value:[e,k]}}:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)),d===v&&(d=A,e=L(),e!==v?(g=V(),g!==v?(g=R(),g!==v?(g=V(),g!==v?(g=r(),g!==v?d=e={op:e+"NOT",right:g}:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v),d===v&&(d=A,e=L(),e!==v?(g=V(),g!==v?(g=r(),g!==v?d=e={op:e,right:g}:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)),d===v&&(d=A,e=t(),e!==v?(g=V(),g!==v?(g=I(),g!==v?(h=V(),h!==v?(h=A,f.substr(A,6).toLowerCase()===zd?(k=
f.substr(A,6),A+=6):(k=v,0===Y&&c(Ad)),k!==v?(k=A,Y++,l=D(),Y--,l===v?k=void 0:(A=k,k=v),k!==v?h="ESCAPE":(A=h,h=v)):(A=h,h=v),h!==v?(h=V(),h!==v?(h=N(),h!==v?d=e={op:e,right:g,escape:h.value}:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v),d===v&&(d=A,e=t(),e!==v?(g=V(),g!==v?(g=I(),g!==v?d=e={op:e,right:g,escape:""}:(A=d,d=v)):(A=d,d=v)):(A=d,d=v))))));d===v&&(d=null);d!==v?(a=b,b=d,""==b||void 0==b||null==b?b=a:(d=null,b=d="arithmetic"==b.type?ka(a,b.tail):ma(b.op,a,
b.right,b.escape)),a=b):(A=a,a=v)}else A=a,a=v;else A=a,a=v;return a}function q(){var a;f.substr(A,2)===Ma?(a=Ma,A+=2):(a=v,0===Y&&c(xa));a===v&&(62===f.charCodeAt(A)?(a=va,A++):(a=v,0===Y&&c(wa)),a===v&&(f.substr(A,2)===Aa?(a=Aa,A+=2):(a=v,0===Y&&c(Ca)),a===v&&(f.substr(A,2)===Pa?(a=Pa,A+=2):(a=v,0===Y&&c(gb)),a===v&&(60===f.charCodeAt(A)?(a=rb,A++):(a=v,0===Y&&c(hb)),a===v&&(61===f.charCodeAt(A)?(a=qa,A++):(a=v,0===Y&&c(La)),a===v&&(f.substr(A,2)===Fa?(a=Fa,A+=2):(a=v,0===Y&&c(Na))))))));return a}
function t(){var a,b,c,d;a=a=A;b=R();b!==v?(c=V(),c!==v?(d=T(),d!==v?a=b=[b,c,d]:(A=a,a=v)):(A=a,a=v)):(A=a,a=v);a!==v&&(a=a[0]+" "+a[2]);a===v&&(a=T());return a}function u(){var a,b,c,d;a=a=A;b=R();b!==v?(c=V(),c!==v?(d=K(),d!==v?a=b=[b,c,d]:(A=a,a=v)):(A=a,a=v)):(A=a,a=v);a!==v&&(a=a[0]+" "+a[2]);a===v&&(a=K());return a}function r(){var a,b,c,d,e,g,f,h;a=A;b=x();if(b!==v){c=[];d=A;e=V();e!==v?(g=y(),g!==v?(f=V(),f!==v?(h=x(),h!==v?d=e=[e,g,f,h]:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v);for(;d!==
v;)c.push(d),d=A,e=V(),e!==v?(g=y(),g!==v?(f=V(),f!==v?(h=x(),h!==v?d=e=[e,g,f,h]:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v);c!==v?a=b=ka(b,c):(A=a,a=v)}else A=a,a=v;return a}function y(){var a;43===f.charCodeAt(A)?(a=sb,A++):(a=v,0===Y&&c(Ta));a===v&&(45===f.charCodeAt(A)?(a=qb,A++):(a=v,0===Y&&c(tb)));return a}function x(){var a,b,c,d,e,g,f,h;a=A;b=w();if(b!==v){c=[];d=A;e=V();e!==v?(g=z(),g!==v?(f=V(),f!==v?(h=w(),h!==v?d=e=[e,g,f,h]:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v);for(;d!==v;)c.push(d),
d=A,e=V(),e!==v?(g=z(),g!==v?(f=V(),f!==v?(h=w(),h!==v?d=e=[e,g,f,h]:(A=d,d=v)):(A=d,d=v)):(A=d,d=v)):(A=d,d=v);c!==v?a=b=ka(b,c):(A=a,a=v)}else A=a,a=v;return a}function z(){var a;42===f.charCodeAt(A)?(a=dd,A++):(a=v,0===Y&&c(ed));a===v&&(47===f.charCodeAt(A)?(a=fd,A++):(a=v,0===Y&&c(gd)));return a}function w(){var a,b,d,e,g,h,k;k=N();if(k===v){var n,q,r,p;n=A;var t,u,w,x;t=A;u=O();u!==v?(w=W(),w!==v?(x=Q(),x!==v?t=u=parseFloat(u+w+x):(A=t,t=v)):(A=t,t=v)):(A=t,t=v);t===v&&(t=A,u=O(),u!==v?(w=W(),
w!==v?t=u=parseFloat(u+w):(A=t,t=v)):(A=t,t=v),t===v&&(t=A,u=O(),u!==v?(w=Q(),w!==v?t=u=parseFloat(u+w):(A=t,t=v)):(A=t,t=v),t===v&&(t=A,u=O(),u!==v&&(u=parseFloat(u)),t=u)));q=t;q!==v?(r=A,Y++,p=C(),Y--,p===v?r=void 0:(A=r,r=v),r!==v?n=q={type:"number",value:q}:(A=n,n=v)):(A=n,n=v);k=n;if(k===v){var y,z;y=A;var R,F,Ca,L;R=A;f.substr(A,4).toLowerCase()===Bd?(F=f.substr(A,4),A+=4):(F=v,0===Y&&c(Cd));F!==v?(Ca=A,Y++,L=D(),Y--,L===v?Ca=void 0:(A=Ca,Ca=v),Ca!==v?R=F=[F,Ca]:(A=R,R=v)):(A=R,R=v);z=R;z!==
v&&(z={type:"bool",value:!0});y=z;if(y===v){y=A;var J,T,X,Pa;J=A;f.substr(A,5).toLowerCase()===Dd?(T=f.substr(A,5),A+=5):(T=v,0===Y&&c(Ed));T!==v?(X=A,Y++,Pa=D(),Y--,Pa===v?X=void 0:(A=X,X=v),X!==v?J=T=[T,X]:(A=J,J=v)):(A=J,J=v);z=J;z!==v&&(z={type:"bool",value:!1});y=z}k=y;if(k===v){var ca,ba,aa,Aa,gb;ba=A;f.substr(A,4).toLowerCase()===yd?(aa=f.substr(A,4),A+=4):(aa=v,0===Y&&c(Fd));aa!==v?(Aa=A,Y++,gb=D(),Y--,gb===v?Aa=void 0:(A=Aa,Aa=v),Aa!==v?ba=aa=[aa,Aa]:(A=ba,ba=v)):(A=ba,ba=v);ca=ba;ca!==v&&
(ca={type:"null",value:null});k=ca;if(k===v){var ea,ga,ha,rb;ea=A;var ka,hb,ma,ua;ka=A;f.substr(A,4).toLowerCase()===Gd?(hb=f.substr(A,4),A+=4):(hb=v,0===Y&&c(Hd));hb!==v?(ma=A,Y++,ua=D(),Y--,ua===v?ma=void 0:(A=ma,ma=v),ma!==v?ka=hb="DATE":(A=ka,ka=v)):(A=ka,ka=v);ga=ka;ga!==v?(ha=V(),ha!==v?(rb=I(),rb!==v?ea=ga={type:"date",value:rb.value}:(A=ea,ea=v)):(A=ea,ea=v)):(A=ea,ea=v);k=ea;if(k===v){var Fa,ta,Na,za;Fa=A;var qa,va,wa,Da;qa=A;f.substr(A,9).toLowerCase()===Id?(va=f.substr(A,9),A+=9):(va=v,
0===Y&&c(Jd));va!==v?(wa=A,Y++,Da=D(),Y--,Da===v?wa=void 0:(A=wa,wa=v),wa!==v?qa=va="TIMESTAMP":(A=qa,qa=v)):(A=qa,qa=v);ta=qa;ta!==v?(Na=V(),Na!==v?(za=I(),za!==v?Fa=ta={type:"timestamp",value:za.value}:(A=Fa,Fa=v)):(A=Fa,Fa=v)):(A=Fa,Fa=v);k=Fa}}}}}a=k;if(a===v){var ra,xa,sb,Ea,La,Ma,Ta,Ua,Va,Sa,ib,qb;ra=A;var Wa,Pb,Ab,tb;Wa=A;f.substr(A,7).toLowerCase()===Kd?(Pb=f.substr(A,7),A+=7):(Pb=v,0===Y&&c(Ld));Pb!==v?(Ab=A,Y++,tb=D(),Y--,tb===v?Ab=void 0:(A=Ab,Ab=v),Ab!==v?Wa=Pb="EXTRACT":(A=Wa,Wa=v)):
(A=Wa,Wa=v);xa=Wa;if(xa!==v)if(sb=V(),sb!==v)if(Ea=fa(),Ea!==v)if(La=V(),La!==v){var Ga,Xa,Qb,Bb,ub;Xa=A;f.substr(A,4).toLowerCase()===Md?(Qb=f.substr(A,4),A+=4):(Qb=v,0===Y&&c(Nd));Qb!==v?(Bb=A,Y++,ub=D(),Y--,ub===v?Bb=void 0:(A=Bb,Bb=v),Bb!==v?Xa=Qb="YEAR":(A=Xa,Xa=v)):(A=Xa,Xa=v);Ga=Xa;if(Ga===v){var Ya,Rb,Cb,vb;Ya=A;f.substr(A,5).toLowerCase()===Od?(Rb=f.substr(A,5),A+=5):(Rb=v,0===Y&&c(Pd));Rb!==v?(Cb=A,Y++,vb=D(),Y--,vb===v?Cb=void 0:(A=Cb,Cb=v),Cb!==v?Ya=Rb="MONTH":(A=Ya,Ya=v)):(A=Ya,Ya=v);
Ga=Ya;if(Ga===v){var Za,Sb,Db,wb;Za=A;f.substr(A,3).toLowerCase()===Qd?(Sb=f.substr(A,3),A+=3):(Sb=v,0===Y&&c(Rd));Sb!==v?(Db=A,Y++,wb=D(),Y--,wb===v?Db=void 0:(A=Db,Db=v),Db!==v?Za=Sb="DAY":(A=Za,Za=v)):(A=Za,Za=v);Ga=Za;if(Ga===v){var $a,Tb,Eb,xb;$a=A;f.substr(A,4).toLowerCase()===Sd?(Tb=f.substr(A,4),A+=4):(Tb=v,0===Y&&c(Td));Tb!==v?(Eb=A,Y++,xb=D(),Y--,xb===v?Eb=void 0:(A=Eb,Eb=v),Eb!==v?$a=Tb="HOUR":(A=$a,$a=v)):(A=$a,$a=v);Ga=$a;if(Ga===v){var ab,Ub,Fb,yb;ab=A;f.substr(A,6).toLowerCase()===
Ud?(Ub=f.substr(A,6),A+=6):(Ub=v,0===Y&&c(Vd));Ub!==v?(Fb=A,Y++,yb=D(),Y--,yb===v?Fb=void 0:(A=Fb,Fb=v),Fb!==v?ab=Ub="MINUTE":(A=ab,ab=v)):(A=ab,ab=v);Ga=ab;if(Ga===v){var bb,Vb,Gb,zb;bb=A;f.substr(A,6).toLowerCase()===Wd?(Vb=f.substr(A,6),A+=6):(Vb=v,0===Y&&c(Xd));Vb!==v?(Gb=A,Y++,zb=D(),Y--,zb===v?Gb=void 0:(A=Gb,Gb=v),Gb!==v?bb=Vb="SECOND":(A=bb,bb=v)):(A=bb,bb=v);Ga=bb}}}}}Ma=Ga;Ma!==v?(Ta=V(),Ta!==v?(Ua=Z(),Ua!==v?(Va=V(),Va!==v?(Sa=l(),Sa!==v?(ib=V(),ib!==v?(qb=ja(),qb!==v?ra=xa={type:"function",
name:"extract",args:{type:"expr_list",value:[{type:"string",value:Ma},Sa]}}:(A=ra,ra=v)):(A=ra,ra=v)):(A=ra,ra=v)):(A=ra,ra=v)):(A=ra,ra=v)):(A=ra,ra=v)):(A=ra,ra=v)}else A=ra,ra=v;else A=ra,ra=v;else A=ra,ra=v;else A=ra,ra=v;a=ra;if(a===v){var pa,nc,wc,xc,yc,Wb,zc,Ac,Bc,Xb,Cc,Ba,jb,oc,pc,qc;pa=A;var cb,Yb,Hb,Dc;cb=A;f.substr(A,9).toLowerCase()===Yd?(Yb=f.substr(A,9),A+=9):(Yb=v,0===Y&&c(Zd));Yb!==v?(Hb=A,Y++,Dc=D(),Y--,Dc===v?Hb=void 0:(A=Hb,Hb=v),Hb!==v?cb=Yb="SUBSTRING":(A=cb,cb=v)):(A=cb,cb=v);
nc=cb;if(nc!==v)if(wc=V(),wc!==v)if(xc=fa(),xc!==v)if(yc=V(),yc!==v)if(Wb=l(),Wb!==v)if(zc=V(),zc!==v)if(Ac=Z(),Ac!==v)if(Bc=V(),Bc!==v)if(Xb=l(),Xb!==v)if(Cc=V(),Cc!==v){Ba=A;var db,Zb,Ib,Ec;db=A;f.substr(A,3).toLowerCase()===$d?(Zb=f.substr(A,3),A+=3):(Zb=v,0===Y&&c(ae));Zb!==v?(Ib=A,Y++,Ec=D(),Y--,Ec===v?Ib=void 0:(A=Ib,Ib=v),Ib!==v?db=Zb="FOR":(A=db,db=v)):(A=db,db=v);jb=db;jb!==v?(oc=V(),oc!==v?(pc=l(),pc!==v?(qc=V(),qc!==v?Ba=jb=[jb,oc,pc,qc]:(A=Ba,Ba=v)):(A=Ba,Ba=v)):(A=Ba,Ba=v)):(A=Ba,Ba=
v);Ba===v&&(Ba=null);Ba!==v?(jb=ja(),jb!==v?pa=nc={type:"function",name:"substring",args:{type:"expr_list",value:Ba?[Wb,Xb,Ba[2]]:[Wb,Xb]}}:(A=pa,pa=v)):(A=pa,pa=v)}else A=pa,pa=v;else A=pa,pa=v;else A=pa,pa=v;else A=pa,pa=v;else A=pa,pa=v;else A=pa,pa=v;else A=pa,pa=v;else A=pa,pa=v;else A=pa,pa=v;else A=pa,pa=v;a=pa;if(a===v){var la,kb,$b,ac,bc,Ha,cc,lb,dc,ec,Fc,rc,Gc,Hc;la=A;kb=da();kb!==v?($b=V(),$b!==v?(ac=fa(),ac!==v?(bc=V(),bc!==v?(Ha=H(),Ha===v&&(Ha=null),Ha!==v?(cc=V(),cc!==v?(lb=l(),lb!==
v?(dc=V(),dc!==v?(ec=Z(),ec!==v?(Fc=V(),Fc!==v?(rc=l(),rc!==v?(Gc=V(),Gc!==v?(Hc=ja(),Hc!==v?la=kb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Ha?"BOTH":Ha},lb,rc]}}:(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v);la===v&&(la=A,kb=da(),kb!==v?($b=V(),$b!==v?(ac=fa(),ac!==v?(bc=V(),bc!==v?(Ha=H(),Ha===v&&(Ha=null),Ha!==v?(cc=V(),cc!==v?(lb=
l(),lb!==v?(dc=V(),dc!==v?(ec=ja(),ec!==v?la=kb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Ha?"BOTH":Ha},lb]}}:(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v)):(A=la,la=v));a=la;if(a===v){var sa,sc,Ic,Jc,Kc,tc,Lc,Mc,Nc,uc,Oc,Pc;sa=A;var eb,fc,Jb,Qc;eb=A;f.substr(A,8).toLowerCase()===be?(fc=f.substr(A,8),A+=8):(fc=v,0===Y&&c(ce));fc!==v?(Jb=A,Y++,Qc=D(),Y--,Qc===v?Jb=void 0:(A=Jb,Jb=v),Jb!==v?eb=fc="POSITION":
(A=eb,eb=v)):(A=eb,eb=v);sc=eb;sc!==v?(Ic=V(),Ic!==v?(Jc=fa(),Jc!==v?(Kc=V(),Kc!==v?(tc=l(),tc!==v?(Lc=V(),Lc!==v?(Mc=K(),Mc!==v?(Nc=V(),Nc!==v?(uc=l(),uc!==v?(Oc=V(),Oc!==v?(Pc=ja(),Pc!==v?sa=sc={type:"function",name:"position",args:{type:"expr_list",value:[tc,uc]}}:(A=sa,sa=v)):(A=sa,sa=v)):(A=sa,sa=v)):(A=sa,sa=v)):(A=sa,sa=v)):(A=sa,sa=v)):(A=sa,sa=v)):(A=sa,sa=v)):(A=sa,sa=v)):(A=sa,sa=v)):(A=sa,sa=v);a=sa;if(a===v){var ya,gc,Rc,Sc,Tc,mb,Uc,Vc;ya=A;var Ia,Kb,Lb,Oa;Ia=A;Ia=Kb=B();if(Ia===v)if(Ia=
A,96===f.charCodeAt(A)?(Kb=Wc,A++):(Kb=v,0===Y&&c(Xc)),Kb!==v){Lb=[];Yc.test(f.charAt(A))?(Oa=f.charAt(A),A++):(Oa=v,0===Y&&c(Zc));if(Oa!==v)for(;Oa!==v;)Lb.push(Oa),Yc.test(f.charAt(A))?(Oa=f.charAt(A),A++):(Oa=v,0===Y&&c(Zc));else Lb=v;Lb!==v?(96===f.charCodeAt(A)?(Oa=Wc,A++):(Oa=v,0===Y&&c(Xc)),Oa!==v?Ia=Kb=Lb.join(""):(A=Ia,Ia=v)):(A=Ia,Ia=v)}else A=Ia,Ia=v;gc=Ia;gc!==v?(Rc=V(),Rc!==v?(Sc=fa(),Sc!==v?(Tc=V(),Tc!==v?(mb=m(),mb===v&&(mb=null),mb!==v?(Uc=V(),Uc!==v?(Vc=ja(),Vc!==v?ya=gc={type:"function",
name:gc,args:mb?mb:{type:"expr_list",value:[]}}:(A=ya,ya=v)):(A=ya,ya=v)):(A=ya,ya=v)):(A=ya,ya=v)):(A=ya,ya=v)):(A=ya,ya=v)):(A=ya,ya=v);a=ya;if(a===v){var hc,na,nb,ic,ob,jc,Qa,Ja,Mb,$c,ad;na=A;nb=U();if(nb!==v)if(ic=V(),ic!==v)if(ob=l(),ob!==v)if(jc=V(),jc!==v){Qa=[];for(Ja=M();Ja!==v;)Qa.push(Ja),Ja=M();Qa!==v?(Ja=V(),Ja!==v?(Mb=ia(),Mb!==v?na=nb={type:"case_expression",format:"simple",operand:ob,clauses:Qa,else:null}:(A=na,na=v)):(A=na,na=v)):(A=na,na=v)}else A=na,na=v;else A=na,na=v;else A=na,
na=v;else A=na,na=v;if(na===v)if(na=A,nb=U(),nb!==v)if(ic=V(),ic!==v)if(ob=l(),ob!==v)if(jc=V(),jc!==v){Qa=[];for(Ja=M();Ja!==v;)Qa.push(Ja),Ja=M();Qa!==v?(Ja=V(),Ja!==v?(Mb=P(),Mb!==v?($c=V(),$c!==v?(ad=ia(),ad!==v?na=nb={type:"case_expression",format:"simple",operand:ob,clauses:Qa,else:Mb.value}:(A=na,na=v)):(A=na,na=v)):(A=na,na=v)):(A=na,na=v)):(A=na,na=v)}else A=na,na=v;else A=na,na=v;else A=na,na=v;else A=na,na=v;hc=na;if(hc===v){var oa,pb,kc,Ra,Ka,Nb,bd,cd;oa=A;pb=U();if(pb!==v)if(kc=V(),kc!==
v){Ra=[];for(Ka=S();Ka!==v;)Ra.push(Ka),Ka=S();Ra!==v?(Ka=V(),Ka!==v?(Nb=ia(),Nb!==v?oa=pb={type:"case_expression",format:"searched",clauses:Ra,else:null}:(A=oa,oa=v)):(A=oa,oa=v)):(A=oa,oa=v)}else A=oa,oa=v;else A=oa,oa=v;if(oa===v)if(oa=A,pb=U(),pb!==v)if(kc=V(),kc!==v){Ra=[];for(Ka=S();Ka!==v;)Ra.push(Ka),Ka=S();Ra!==v?(Ka=V(),Ka!==v?(Nb=P(),Nb!==v?(bd=V(),bd!==v?(cd=ia(),cd!==v?oa=pb={type:"case_expression",format:"searched",clauses:Ra,else:Nb.value}:(A=oa,oa=v)):(A=oa,oa=v)):(A=oa,oa=v)):(A=
oa,oa=v)):(A=oa,oa=v)}else A=oa,oa=v;else A=oa,oa=v;hc=oa}a=hc;if(a===v){var Ob,fb,vc,lc,mc;fb=A;vc=C();if(vc!==v){lc=[];for(mc=E();mc!==v;)lc.push(mc),mc=E();lc!==v?fb=vc+=lc.join(""):(A=fb,fb=v)}else A=fb,fb=v;Ob=fb;Ob!==v&&(Ob={type:"column_ref",table:"",column:Ob});a=Ob;a===v&&(a=G(),a===v&&(a=A,b=fa(),b!==v?(d=V(),d!==v?(e=l(),e!==v?(g=V(),g!==v?(h=ja(),h!==v?(e.paren=!0,a=b=e):(A=a,a=v)):(A=a,a=v)):(A=a,a=v)):(A=a,a=v)):(A=a,a=v)))}}}}}}}return a}function B(){var a,b,c,d;a=A;b=C();if(b!==v){c=
[];for(d=D();d!==v;)c.push(d),d=D();c!==v?a=b+=c.join(""):(A=a,a=v)}else A=a,a=v;return a}function C(){var a;hd.test(f.charAt(A))?(a=f.charAt(A),A++):(a=v,0===Y&&c(id));return a}function D(){var a;jd.test(f.charAt(A))?(a=f.charAt(A),A++):(a=v,0===Y&&c(kd));return a}function E(){var a;ld.test(f.charAt(A))?(a=f.charAt(A),A++):(a=v,0===Y&&c(md));return a}function G(){var a,b,d;a=A;64===f.charCodeAt(A)?(b=nd,A++):(b=v,0===Y&&c(od));b!==v?(d=B(),d!==v?a=b=[b,d]:(A=a,a=v)):(A=a,a=v);a!==v&&(a={type:"param",
value:a[1]});return a}function H(){var a,b,d;a=A;f.substr(A,7).toLowerCase()===de?(b=f.substr(A,7),A+=7):(b=v,0===Y&&c(ee));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="LEADING":(A=a,a=v)):(A=a,a=v);a===v&&(a=A,f.substr(A,8).toLowerCase()===fe?(b=f.substr(A,8),A+=8):(b=v,0===Y&&c(ge)),b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="TRAILING":(A=a,a=v)):(A=a,a=v),a===v&&(a=A,f.substr(A,4).toLowerCase()===he?(b=f.substr(A,4),A+=4):(b=v,0===Y&&c(ie)),b!==v?(b=A,Y++,d=D(),Y--,
d===v?b=void 0:(A=b,b=v),b!==v?a="BOTH":(A=a,a=v)):(A=a,a=v)));return a}function I(){var a;a=N();a===v&&(a=G());return a}function N(){var a,b,d;a=A;39===f.charCodeAt(A)?(b=ub,A++):(b=v,0===Y&&c(vb));b===v&&(f.substr(A,2)===wb?(b=wb,A+=2):(b=v,0===Y&&c(pd)));if(b!==v){b=[];d=A;f.substr(A,2)===Ua?(d=Ua,A+=2):(d=v,0===Y&&c(xb));d!==v&&(d="'");d===v&&(yb.test(f.charAt(A))?(d=f.charAt(A),A++):(d=v,0===Y&&c(zb)));for(;d!==v;)b.push(d),d=A,f.substr(A,2)===Ua?(d=Ua,A+=2):(d=v,0===Y&&c(xb)),d!==v&&(d="'"),
d===v&&(yb.test(f.charAt(A))?(d=f.charAt(A),A++):(d=v,0===Y&&c(zb)));b!==v?(39===f.charCodeAt(A)?(d=ub,A++):(d=v,0===Y&&c(vb)),d!==v?a=b={type:"string",value:b.join("")}:(A=a,a=v)):(A=a,a=v)}else A=a,a=v;return a}function S(){var a,b,c;a=A;b=ea();b!==v?(b=V(),b!==v?(b=l(),b!==v?(c=V(),c!==v?(c=aa(),c!==v?(c=V(),c!==v?(c=l(),c!==v?a=b={type:"when_clause",operand:b,value:c}:(A=a,a=v)):(A=a,a=v)):(A=a,a=v)):(A=a,a=v)):(A=a,a=v)):(A=a,a=v)):(A=a,a=v);return a}function M(){var a,b,c;a=A;b=ea();b!==v?(b=
V(),b!==v?(b=l(),b!==v?(c=V(),c!==v?(c=aa(),c!==v?(c=V(),c!==v?(c=l(),c!==v?a=b={type:"when_clause",operand:b,value:c}:(A=a,a=v)):(A=a,a=v)):(A=a,a=v)):(A=a,a=v)):(A=a,a=v)):(A=a,a=v)):(A=a,a=v);return a}function P(){var a,b;a=A;var d,e;b=A;f.substr(A,4).toLowerCase()===je?(d=f.substr(A,4),A+=4):(d=v,0===Y&&c(ke));d!==v?(d=A,Y++,e=D(),Y--,e===v?d=void 0:(A=d,d=v),d!==v?b="ELSE":(A=b,b=v)):(A=b,b=v);b!==v?(b=V(),b!==v?(b=l(),b!==v?a={type:"else_clause",value:b}:(A=a,a=v)):(A=a,a=v)):(A=a,a=v);return a}
function O(){var a,b,d;a=J();a===v&&(a=A,45===f.charCodeAt(A)?(b=qb,A++):(b=v,0===Y&&c(tb)),b===v&&(43===f.charCodeAt(A)?(b=sb,A++):(b=v,0===Y&&c(Ta))),b!==v?(d=J(),d!==v?a=b=b[0]+d:(A=a,a=v)):(A=a,a=v));return a}function W(){var a,b;a=A;46===f.charCodeAt(A)?(b=qd,A++):(b=v,0===Y&&c(rd));b!==v?(b=J(),b===v&&(b=null),b!==v?a="."+(null!=b?b:""):(A=a,a=v)):(A=a,a=v);return a}function Q(){var a,b,d;b=a=A;ud.test(f.charAt(A))?(d=f.charAt(A),A++):(d=v,0===Y&&c(vd));d!==v?(wd.test(f.charAt(A))?(d=f.charAt(A),
A++):(d=v,0===Y&&c(xd)),d===v&&(d=null),d!==v?b="e"+(null===d?"":d):(A=b,b=v)):(A=b,b=v);b!==v?(d=J(),d!==v?a=b+d:(A=a,a=v)):(A=a,a=v);return a}function J(){var a,b;a=[];b=F();if(b!==v)for(;b!==v;)a.push(b),b=F();else a=v;a!==v&&(a=a.join(""));return a}function F(){var a;sd.test(f.charAt(A))?(a=f.charAt(A),A++):(a=v,0===Y&&c(td));return a}function K(){var a,b,d;a=A;f.substr(A,2).toLowerCase()===le?(b=f.substr(A,2),A+=2):(b=v,0===Y&&c(me));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a=
"IN":(A=a,a=v)):(A=a,a=v);return a}function L(){var a,b,d;a=A;f.substr(A,2).toLowerCase()===ne?(b=f.substr(A,2),A+=2):(b=v,0===Y&&c(oe));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="IS":(A=a,a=v)):(A=a,a=v);return a}function T(){var a,b,d;a=A;f.substr(A,4).toLowerCase()===pe?(b=f.substr(A,4),A+=4):(b=v,0===Y&&c(qe));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="LIKE":(A=a,a=v)):(A=a,a=v);return a}function R(){var a,b,d;a=A;f.substr(A,3).toLowerCase()===re?(b=f.substr(A,
3),A+=3):(b=v,0===Y&&c(se));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="NOT":(A=a,a=v)):(A=a,a=v);return a}function X(){var a,b,d;a=A;f.substr(A,3).toLowerCase()===te?(b=f.substr(A,3),A+=3):(b=v,0===Y&&c(ue));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="AND":(A=a,a=v)):(A=a,a=v);return a}function ba(){var a,b,d;a=A;f.substr(A,2).toLowerCase()===ve?(b=f.substr(A,2),A+=2):(b=v,0===Y&&c(we));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="OR":(A=a,a=v)):(A=a,a=
v);return a}function ca(){var a,b,d;a=A;f.substr(A,7).toLowerCase()===xe?(b=f.substr(A,7),A+=7):(b=v,0===Y&&c(ye));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="BETWEEN":(A=a,a=v)):(A=a,a=v);return a}function Z(){var a,b,d;a=A;f.substr(A,4).toLowerCase()===ze?(b=f.substr(A,4),A+=4):(b=v,0===Y&&c(Ae));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="FROM":(A=a,a=v)):(A=a,a=v);return a}function da(){var a,b,d;a=A;f.substr(A,4).toLowerCase()===Be?(b=f.substr(A,4),A+=4):(b=v,0===
Y&&c(Ce));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="TRIM":(A=a,a=v)):(A=a,a=v);return a}function U(){var a,b,d;a=A;f.substr(A,4).toLowerCase()===De?(b=f.substr(A,4),A+=4):(b=v,0===Y&&c(Ee));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="CASE":(A=a,a=v)):(A=a,a=v);return a}function ia(){var a,b,d;a=A;f.substr(A,3).toLowerCase()===Fe?(b=f.substr(A,3),A+=3):(b=v,0===Y&&c(Ge));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="END":(A=a,a=v)):(A=a,a=v);return a}function ea(){var a,
b,d;a=A;f.substr(A,4).toLowerCase()===He?(b=f.substr(A,4),A+=4):(b=v,0===Y&&c(Ie));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="WHEN":(A=a,a=v)):(A=a,a=v);return a}function aa(){var a,b,d;a=A;f.substr(A,4).toLowerCase()===Je?(b=f.substr(A,4),A+=4):(b=v,0===Y&&c(Ke));b!==v?(b=A,Y++,d=D(),Y--,d===v?b=void 0:(A=b,b=v),b!==v?a="THEN":(A=a,a=v)):(A=a,a=v);return a}function ga(){var a;44===f.charCodeAt(A)?(a=Le,A++):(a=v,0===Y&&c(Me));return a}function fa(){var a;40===f.charCodeAt(A)?(a=Ne,
A++):(a=v,0===Y&&c(Oe));return a}function ja(){var a;41===f.charCodeAt(A)?(a=Pe,A++):(a=v,0===Y&&c(Qe));return a}function V(){var a,b;a=[];for(b=ha();b!==v;)a.push(b),b=ha();return a}function ha(){var a;Re.test(f.charAt(A))?(a=f.charAt(A),A++):(a=v,0===Y&&c(Se));return a}function ma(a,b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function ka(a,b){for(var c=0;c<b.length;c++)a=ma(b[c][1],a,b[c][3]);return a}k=void 0!==k?k:{};var v={},ta={start:d},za=d,Da=
"!",ua=a("!",!1),qa="\x3d",La=a("\x3d",!1),Ma="\x3e\x3d",xa=a("\x3e\x3d",!1),va="\x3e",wa=a("\x3e",!1),Aa="\x3c\x3d",Ca=a("\x3c\x3d",!1),Pa="\x3c\x3e",gb=a("\x3c\x3e",!1),rb="\x3c",hb=a("\x3c",!1),Fa="!\x3d",Na=a("!\x3d",!1),sb="+",Ta=a("+",!1),qb="-",tb=a("-",!1),dd="*",ed=a("*",!1),fd="/",gd=a("/",!1),hd=/^[A-Za-z_\x80-\uFFFF]/,id=g([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),jd=/^[A-Za-z0-9_]/,kd=g([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),ld=/^[A-Za-z0-9_.\x80-\uFFFF]/,md=g([["A","Z"],
["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),nd="@",od=a("@",!1),ub="'",vb=a("'",!1),wb="N'",pd=a("N'",!1),Ua="''",xb=a("''",!1),yb=/^[^']/,zb=g(["'"],!0,!1),qd=".",rd=a(".",!1),sd=/^[0-9]/,td=g([["0","9"]],!1,!1),ud=/^[eE]/,vd=g(["e","E"],!1,!1),wd=/^[+\-]/,xd=g(["+","-"],!1,!1),yd="null",Fd=a("NULL",!0),Bd="true",Cd=a("TRUE",!0),Dd="false",Ed=a("FALSE",!0),le="in",me=a("IN",!0),ne="is",oe=a("IS",!0),pe="like",qe=a("LIKE",!0),zd="escape",Ad=a("ESCAPE",!0),re="not",se=a("NOT",!0),te="and",
ue=a("AND",!0),ve="or",we=a("OR",!0),xe="between",ye=a("BETWEEN",!0),ze="from",Ae=a("FROM",!0),$d="for",ae=a("FOR",!0),Yd="substring",Zd=a("SUBSTRING",!0),Kd="extract",Ld=a("EXTRACT",!0),Be="trim",Ce=a("TRIM",!0),be="position",ce=a("POSITION",!0),Id="timestamp",Jd=a("TIMESTAMP",!0),Gd="date",Hd=a("DATE",!0),de="leading",ee=a("LEADING",!0),fe="trailing",ge=a("TRAILING",!0),he="both",ie=a("BOTH",!0),Md="year",Nd=a("YEAR",!0),Od="month",Pd=a("MONTH",!0),Qd="day",Rd=a("DAY",!0),Sd="hour",Td=a("HOUR",
!0),Ud="minute",Vd=a("MINUTE",!0),Wd="second",Xd=a("SECOND",!0),De="case",Ee=a("CASE",!0),Fe="end",Ge=a("END",!0),He="when",Ie=a("WHEN",!0),Je="then",Ke=a("THEN",!0),je="else",ke=a("ELSE",!0),Le=",",Me=a(",",!1),Ne="(",Oe=a("(",!1),Pe=")",Qe=a(")",!1),Re=/^[ \t\n\r]/,Se=g([" ","\t","\n","\r"],!1,!1),Wc="`",Xc=a("`",!1),Yc=/^[^`]/,Zc=g(["`"],!0,!1),A=0,Va=[{line:1,column:1}],Ea=0,ib=[],Y=0,Sa;if("startRule"in k){if(!(k.startRule in ta))throw Error("Can't start parsing from rule \""+k.startRule+'".');
za=ta[k.startRule]}Sa=za();if(Sa!==v&&A===f.length)return Sa;Sa!==v&&A<f.length&&c({type:"end"});throw function(a,b,c){return new p(p.buildMessage(a,b),a,b,c)}(ib,Ea<f.length?f.charAt(Ea):null,Ea<f.length?e(Ea,Ea+1):e(Ea,Ea));}}})},"esri/views/3d/layers/i3s/I3SFrameWorker":function(){define(["require","exports","../../../../core/arrayUtils"],function(p,f,k){Object.defineProperty(f,"__esModule",{value:!0});var a=function(){function a(a){var b=this;this.referenceCount=0;this.callbacks=[];this.runIndex=
0;this.handle=a.registerFrameWorker(function(a){return b.work(a)})}a.prototype.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)};a.prototype.work=function(a){this.sort();for(var b=this.callbacks,d={numIndexLoading:0,numNodesLoading:0},e=0;e<b.length&&!a.doneWithProgress();++e)b[e].priority=b[e](a,d),this.runIndex=e};a.prototype.sort=function(){for(var a=this.callbacks,b=a.length,d=this.runIndex;0<d;d--){for(var g=a[d-1],f=d;f<a.length&&g.priority<=a[f].priority&&(f!==b||g.priority<
a[f].priority);)a[f-1]=a[f],f++;a[f-1]=g;b=f-1}this.runIndex=0};a.prototype.add=function(a){this.sort();a.priority=Infinity;this.callbacks.unshift(a)};a.prototype.remove=function(a){k.removeUnordered(this.callbacks,a);this.runIndex=this.callbacks.length;this.sort()};return a}(),g=new Map;f.addFrameWorker=function(b,e){var c=g.get(b);null==c&&(c=new a(b),g.set(b,c));c.add(e);return{remove:function(){null!=c&&(c.remove(e),0<c.callbacks.length||(g.delete(b),c.destroy()),c=null)}}}})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/PooledArray ../../../../core/urlUtils ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(p,f,k,a,g,b,e){var c="version level sharedResource attributeData geometryData textureData lodSelection".split(" ");p=function(){function f(b,c,e,f,k,l,m,p,z,w,B,C){var h=this;this.rootId=e;this.progressiveLoadPenalty=f;this.nodeIndex=k;this.streamDataSupplier=l;this.viewportQueries=m;this.logger=p;this._isLoaded=z;this._isSelected=w;this._enable=B;this._needsUpdate=C;this._dirty=!0;this._loadingNodes=new Set;this._indexMissing=1;this._nodesMissing=0;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;
this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState={};this._version=0;this._featureEstimate={estimate:0,leafsReached:!1};this._unloadedMemoryEstimate=0;this._missing=new a;this._prefetch=new a;this._updates=new d;this.ignoreServiceOBB=!1;this._maxLodLevel=this.viewportQueries.maxLodLevel;this.rootUrl=g.makeAbsolute(c,b);this.traverseVisible(function(a,b){return h.nodeTraversalState(b)})}f.prototype.requestReload=function(){this._dirty=!0;this._indexMissing=1;++this._version};
f.prototype.update=function(a){var b=this;if(this._dirty){this._nodesMissing=this._indexMissing=0;this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(a);var c=!0,d=new m,e=new m;this.traverseVisible(function(g,f,h){b._updateNodeFeatureEstimate(f,e);if(f){if(0===b._missing.length&&f.children)for(g=0,h=f.children;g<h.length;g++){var l=h[g];b.nodeIndex[l.id]||b._loadingNodes.has(l.id)||b._prefetch.push(k({},l,{baseUrl:f.baseUrl}))}!f.failed&&
f.featureData&&0!==f.featureData.length&&(b._isLoaded(f)?(d.known+=f.memory,++d.knownNodes,b._isSelected(f)?f.children&&(c=!1):(d.unremoved+=f.memory,c=!1),b._needsUpdate(f)&&(b._maxProcessingPrio=Math.max(b._maxProcessingPrio,b.entryPriority(f)),b._updates.update.push(f))):(f.memory&&(d.known+=f.memory,++d.knownNodes),b._isSelected(f)&&(++b._nodesMissing,f.children&&(c=!1),f.memory?(d.missing+=f.memory,d.known+=f.memory,++d.knownNodes):++d.missingNodes,0<=a.indexOf(f.id)?(b._maxProcessingPrio=Math.max(b._maxProcessingPrio,
b.entryPriority(f)),b._updates.cancel=b._updates.cancel.filter(function(a){return a!==f.id})):b._enable(f)||(b._maxProcessingPrio=Math.max(b._maxProcessingPrio,b.entryPriority(f)),b._updates.add.push(f)))))}else++b._indexMissing,b._loadingNodes.has(g.id)||b._missing.push(k({},g,{baseUrl:h})),b._maxProcessingPrio=Math.max(b._maxProcessingPrio,b.entryPriority(g))});this._unloadedMemoryEstimate=d.missing-d.unremoved;3<d.knownNodes&&0<d.missingNodes&&(this._unloadedMemoryEstimate+=d.known/d.knownNodes*
d.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(e);this._featureEstimate.leafsReached=c;this._dirty=0<this._indexMissing||0<this._nodesMissing||0<this._updates.add.length||0<this._updates.update.length||0<this._updates.cancel.length}};f.prototype.checkFeatureTarget=function(a,b){for(var c=this.viewportQueries.updateScreenSpaceErrorBias(b),d=b,e=b,g=c,f=10;f--;){var h=new m;this._updateFeatureEstimate(d,
h);if(this._computeFeatureEstimate(h)<=a){if(d>=b||0<h.missingNodes||0===f)break;g=d;d=.5*(d+e)}else e=d,d=.5*(d+g)}++this._version;this.viewportQueries.updateScreenSpaceErrorBias(c);return Math.min(b,d)};f.prototype._updateFeatureEstimate=function(a,b){var c=this;++this._version;this.viewportQueries.updateScreenSpaceErrorBias(a);this.traverseVisible(function(a,d){return c._updateNodeFeatureEstimate(d,b)})};f.prototype._updateNodeFeatureEstimate=function(a,b){a&&!a.failed&&a.featureData&&0!==a.featureData.length&&
(this._isLoaded(a)?(b.known+=a.numFeatures,++b.knownNodes,this._isSelected(a)||(b.unremoved+=a.numFeatures)):this._isSelected(a)&&(a.numFeatures?(b.missing+=a.numFeatures,b.known+=a.numFeatures,++b.knownNodes):++b.missingNodes))};f.prototype._computeFeatureEstimate=function(a){var b=a.known-a.unremoved;3<a.knownNodes&&0<a.missingNodes&&(b+=a.known/a.knownNodes*a.missingNodes);return Math.max(0,b)};f.prototype.load=function(a){var c=this;b.buildTopNodeMap(this._missing,a,function(a){return c.entryPriority(a)});
if(0>=this._missing.length)return!1;this._maxUnloadedPrio=this.entryPriority(this._missing.front());this._missing.forEach(function(a){return c._loadNode(a)});this._missing.clear();return!0};f.prototype.prefetch=function(a){var c=this;b.buildTopNodeMap(this._prefetch,a,function(a){return c.entryPriority(a)});if(0>=this._prefetch.length)return!1;this._prefetch.forEach(function(a){return c._loadNode(a)});this._prefetch.clear();return!0};f.prototype.isLoading=function(){return 0<this._indexMissing};f.prototype.getIndexLoading=
function(){return this._loadingNodes.size};f.prototype.getIndexMissing=function(){return this._indexMissing};f.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};f.prototype.getNodesMissing=function(){return this._nodesMissing};f.prototype.getUpdates=function(a){var c=this;b.buildTopNodeMap(this._updates.add,a,function(a){return c.entryPriority(a)},this._maxUnloadedPrio);b.buildTopNodeMap(this._updates.update,Number.POSITIVE_INFINITY,function(a){return c.entryPriority(a)});
return this._updates};f.prototype.getFeatureEstimate=function(){return this._featureEstimate};f.prototype.nodeTraversalState=function(a){if(!a)return null;var b=this._nodeTraversalState[a.id];if(b&&b.version===this._version)return b;var c=this.viewportQueries.getLodLevel(a),d=this.viewportQueries.hasLOD(a),e=!0;if(d)if(a.parentNode){e=this.nodeIndex[a.parentNode.id];if(null==e)return null;e=(e=this._nodeTraversalState[e.id])&&c>e.lodLevel}else e=0<c;if(b)return b.lodLevel=c,b.isChosen=e,b.version=
this._version,b;this._nodeTraversalState[a.id]={nodeHasLOD:d,lodLevel:c,isChosen:e,version:this._version};return this._nodeTraversalState[a.id]};f.prototype._loadNode=function(a){var b=this;this._loadingNodes.add(a.id);var d=g.makeAbsolute(a.href,a.baseUrl);this.streamDataSupplier.request(d,"json").then(function(a,d){var g={id:d.id,mbs:d.mbs,parentNode:d.parentNode,children:d.children,featureData:d.featureData};c.forEach(function(a){g[a]=d.hasOwnProperty(a)?d[a]:null});d.hasOwnProperty("obb")&&!b.ignoreServiceOBB&&
(g.obb=e.clone(d.obb),g.hasServiceOBB=!0,b.viewportQueries.updateNode(g.id));b.nodeIndex[g.id]=g;g.baseUrl=a;g.featureData&&1===g.featureData.length&&g.featureData[0].featureRange&&(g.numFeatures=g.featureData[0].featureRange[1]-g.featureData[0].featureRange[0]+1);b.nodeTraversalState(g);b._loadingNodes.delete(g.id);b._dirty=!0},function(c){b.loadErrorCallback(d);b._loadingNodes.delete(a.id);b._dirty=!0})};f.prototype.entryPriority=function(a){if(null==a.mbs&&a.id===this.rootId)return Infinity;var b=
0,c=this.nodeIndex[a.id];if(null!=c&&null!=c.parentNode){var d=this._nodeTraversalState[c.parentNode.id];null!=d&&(b=d.lodLevel)}for(d=this.progressiveLoadPenalty;c;c=c.parentNode?this.nodeIndex[c.parentNode.id]:null)if(this._isLoaded(c)){d=0;break}a=this.viewportQueries.distToPOI(a);return-a-b*(a+this.progressiveLoadPenalty)+d};f.prototype.traverseVisible=function(a){var b=this.nodeIndex[this.rootId];b?this._traverse({id:this.rootId,mbs:b.mbs,href:this.rootUrl},b,a,""):a({id:this.rootId,mbs:null,
href:this.rootUrl},null,"")};f.prototype._traverse=function(a,b,c,d){if(!b.children||0===b.children.length)this.viewportQueries.isGeometryVisible(b)&&c(a,b,d);else if(this.viewportQueries.isNodeVisible(b)&&(c(a,b,d),a=this.nodeTraversalState(b),!a.nodeHasLOD||a.lodLevel!==this._maxLodLevel))for(a=0,d=b.children;a<d.length;a++){var e=d[a],g=this.nodeIndex[e.id];g?this._traverse(e,g,c,b.baseUrl):this.viewportQueries.isNodeVisible(e)&&c(e,null,b.baseUrl)}};f.prototype.loadErrorCallback=function(a){this.logger.warn("Error loading node: "+
a)};f.prototype.updateStats=function(a){this._nodesMissing&&(a.nodes+=" + "+Math.round(this._nodesMissing));this._indexMissing&&(a.index+=" + "+this._indexMissing);a.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){var b=this._featureEstimate.estimate-a.features;0<b?a.features+=" + "+b:0>b&&(a.features+=" - "+-b)}};f.prototype.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)};return f}();var d=function(){function b(){this.update=new a;this.add=new a;
this.cancel=[]}b.prototype.reset=function(a){this.add.clear();this.update.clear();this.cancel=a};return b}(),m=function(){return function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}();return p})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["require","exports","../../../../core/PooledArray"],function(p,f,k){p=function(){function g(a,e){this.layerView=a;this.lodGlobalDirtyChanged=e}g.prototype.startNodeLoading=function(a,e,c,d,g,f){this._lodGlobalDirty=
!1;this._maxLodLevel=f.maxLodLevel;this._nodeIndex=d;this._rootId=g;this._nodeTraversalState=c;this._isNodeVisible=a;this._isGeometryVisible=e;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};g.prototype.shouldLoadNode=function(a){var b=this._nodeTraversalState(a);return b.isChosen?b.lodLevel===this._maxLodLevel?!0:this._childrenRequireLoading(a):!1};g.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};g.prototype.lodSwapBundleLoaded=
function(a){this.setLodGlobalDirty()};Object.defineProperty(g.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._rootId&&(!0===this._lodGlobalDirty||1.1<this.layerView.view.resourceController.usedMemory)},enumerable:!0,configurable:!0});g.prototype.lodGlobalHandling=function(){if(this.requiresLODGlobalHandling){var b=this._rootId,e=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.usedMemory-1)));a.clear();this._lodGlobalHandlingRecursion(b,e);this.layerView.removeNodeData(a);
a.clear();this._lodGlobalDirty=!1;this.lodGlobalDirtyChanged(this._lodGlobalDirty)}};g.prototype._lodGlobalHandlingRecursion=function(b,e){b=this._nodeIndex[b];if(null==b)return!1;var c=this._nodeTraversalState(b),d=c.isChosen&&(!c.nodeHasLOD||c.lodLevel===this._maxLodLevel);(c=this.layerView.isNodeLoaded(b))&&null!=this.layerView.setPolygonOffset&&this.layerView.setPolygonOffset(b,!d);if(d&&c)return this._removeChildrenRecursive(b),!0;var g=!1;if(null!=b.children&&0!==b.children.length)for(var g=
!0,f=0,h=b.children;f<h.length;f++){var k=h[f],q=this._nodeIndex[k.id];if(q?this._isGeometryVisible(q):this._isNodeVisible(k))k=this._lodGlobalHandlingRecursion(k.id,e),g=g&&k}c&&!d&&(g||a.length<e)&&(a.push(b),c=!1);e=!b.featureData||0===b.featureData.length;return g||c||e};g.prototype._removeChildrenRecursive=function(b){if(null!=b.children){var e=0;for(b=b.children;e<b.length;e++){var c=this._nodeIndex[b[e].id];null!=c&&(this._removeChildrenRecursive(c),a.push(c))}}};g.prototype.childrenEmpty=
function(a){if(null==a.children)return!0;var b=0;for(a=a.children;b<a.length;b++){var c=a[b];if(this._isNodeVisible(c)&&(c=this._nodeIndex[c.id],null!=c&&(this.layerView.isNodeLoaded(c)||!this.childrenEmpty(c))))return!1}return!0};g.prototype._childrenRequireLoading=function(a){var b=this,c={finalInvisible:!0},d=function(a,c){var e=b._nodeTraversalState(a);e.isChosen&&(0===e.lodLevel||e.lodLevel===b._maxLodLevel)&&b._isGeometryVisible(a)&&(c.finalInvisible=!1);if(null==a.children)return!0;e=0;for(a=
a.children;e<a.length;e++){var g=a[e];if(b._isNodeVisible(g)&&(g=b._nodeIndex[g.id],null!=g&&(b.layerView.isNodeLoaded(g)||!d(g,c))))return!1}return!0};return d(a,c)?!c.finalInvisible:!1};return g}();var a=new k;return p})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("require exports dojo/errors/CancelError ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ./I3SBinaryReader ./I3SUtil ../../webgl-engine/lib/Util".split(" "),function(p,f,k,a,g,b,e,c,d){p=function(){function f(a,
c,d,e,k){this.loader=a;this.logger=c;this.defaultGeometrySchema=d;this.requiredAttributes=e;this.options=k;this.cancelled=!1;this.loadShared=function(a){if(null==a.sharedResource)return g.resolve({});var c=b.makeAbsolute(a.sharedResource.href,a.baseUrl);return this.load(c,"json").then(function(a){f.fixTextureEncodings(a);f.addAbsoluteHrefTexture(a,c);return a})}}f.prototype.cancelAll=function(){this.cancelled=!0};f.prototype.load=function(a,b){var c=this;return g.create(function(d,e){c.loader.request(a,
b).then(function(a,b){d(b)},function(b){e(Error("Failed to load: "+a))})})};f.prototype.loadAttribute=function(a,c,d){a=b.makeAbsolute(d,a);return this.load(a,"binary").then(function(a){return e.readBinaryAttribute(c,a)})};f.prototype.loadAttributes=function(a,b,c){var d=this,e=c.map(function(c){return null==a.attributeData||null==a.attributeData[c.index]?(d.logger.error("Missing attributeData for '"+c.name+"' on node '"+a.id+"'"),g.resolve(null)):d.loadAttribute(b,c.attributeStorageInfo,a.attributeData[c.index].href).catch(function(b){d.logger.error("Failed to load attributeData for '"+
c.name+"' on node '"+a.id+"'");return null})});return g.all(e).then(function(a){for(var b={},d=0;d<c.length;++d)a[d]&&(b[c[d].name]=a[d]);return b})};f.prototype.prepareBinaryGeometryData=function(b,d,g,f){a.mixin(b.geometries[0].params,g);f||null!=g.vertexAttributes.region||delete g.vertexAttributes.region;if(null!=g.featureAttributes){f=g.featureAttributes;if(f.faceRange){var h=e.createTypedView(d,f.faceRange);b.componentOffsets=c.convertFlatRangesToOffsets(h,g.header.fields.featureCount,f.faceRange.valuesPerElement)}if(f.id){b.featureIds=
[];var h=1,k=e.valueType2TypedArrayClassMap[f.id.valueType];"UInt64"===f.id.valueType&&(k=Uint32Array,h=2);d=new k(d,f.id.byteOffset,f.id.count*f.id.valuesPerElement*h);for(k=0;k<g.header.fields.featureCount;k++)if(b.featureIds[k]=d[k*f.id.valuesPerElement*h],2===h){var l=d[k*f.id.valuesPerElement*h+1];if(2097150<=l)throw Error("ID exceeded maximum range supported by javascript (max \x3d 53bit-1 \x3d 9007199254740991)");b.featureIds[k]+=4294967296*l}}}};f.prototype.loadBundleData=function(a,c){var d=
this,f=a.baseUrl,h=null,k=this.loadShared(a),l=null;null!=this.requiredAttributes&&(l=this.loadAttributes(a,f,this.requiredAttributes));var m=null;null!=a.geometryData&&(f=b.makeAbsolute(a.geometryData[c].href,f),m=this.load(f,"binary"));return k.then(function(b){d.handleCancelled();return(d.options.loadFeatureData?d.loadFeatureData(a,c):g.resolve(null)).then(function(c){d.handleCancelled();var f=d.options.loadFeatureData?d.collectGeometries(a,c,b):d.meshPyramidGeometryData(a,b);c=null!=m?m.then(function(a){h=
a;var c=Object.keys(b.materialDefinitions)[0],c=b.materialDefinitions[c].params.vertexRegions,g=e.createGeometryDataIndex(a,d.defaultGeometrySchema,c);d.prepareBinaryGeometryData(f[0],a,g,c);return f}):g.resolve(f);var k=d.loadTextures(f,b);return g.all([k,c,l])}).then(function(a){var c=a[0],e=a[1];a=a[2];d.handleCancelled();var g=null;a&&(g={attributeData:a,loadedAttributes:d.requiredAttributes});return{allGeometryData:e,attributeDataInfo:g,geometryBuffer:h,sharedResource:b,textureData:c}})})};f.addAbsoluteHrefTexture=
function(a,c){a=a.textureDefinitions;if(null!=a)for(var d=0,e=Object.keys(a);d<e.length;d++)for(var g=0,f=a[e[d]].images;g<f.length;g++){var h=f[g];Array.isArray(h.href)?h.hrefConcat=h.href.map(function(a){return b.makeAbsolute(a,c)}):h.hrefConcat=b.makeAbsolute(h.href,c)}};f.fixTextureEncodings=function(a){a=a.textureDefinitions;if(null!=a)for(var b in a){var c=a[b];if(Array.isArray(c.encoding))for(var d=0;d<c.encoding.length;d++){var e=c.encoding[d];"data:"===e.substring(0,5)&&(c.encoding[d]=e.substring(5))}else e=
c.encoding,"data:"===e.substring(0,5)&&(c.encoding=e.substring(5))}};f.prototype.loadTexture=function(a,b,d,e){var g=this;return e===c.DDS_ENCODING_STRING?this.load(a,"binary").then(function(a){g.handleCancelled();return{i3sTexId:b,data:a,encoding:e}}):this.load(a,"image").then(function(a){var c=a;g.handleCancelled();if(d&&4096<=a.width*a.height){var c=Math.ceil(a.width/2),f=Math.ceil(a.height/2),h=document.createElement("canvas");h.width=c;h.height=f;h.getContext("2d").drawImage(a,0,0,c,f);c=h}return{i3sTexId:b,
data:c,encoding:e}})};f.prototype.loadTextures=function(a,b){for(var e=[],h=0;h<a.length;h++){var k=a[h].geometries;if(null!=k)for(var l=0;l<k.length;l++){var m=k[l].params.textureID||"none";if("none"!==m){null!=b.textureDefinitions&&null!=b.textureDefinitions[m]||this.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+m);var p=b.textureDefinitions[m];d.assert(void 0!==p,"geometry wants unknown texture "+m);if(0!==p.images.length){var x=p.images[p.images.length-1],z=this.options.textureFormat===
f.TextureFormat.Downsampled,w=c.getAppropriateTextureEncoding(p.encoding,this.options.textureFormat===f.TextureFormat.Compressed),p=-1<w?p.encoding[w]:p.encoding,x=-1<w?x.hrefConcat[w]:x.hrefConcat;this.options.loadTextureData?e.push(this.loadTexture(x,m,z,p)):e.push({i3sTexId:m,encoding:p,data:null})}}}}return g.all(e)};f.prototype.meshPyramidGeometryData=function(a,b){a=b.materialDefinitions?Object.keys(b.materialDefinitions)[0]:null;b=b.textureDefinitions?Object.keys(b.textureDefinitions)[0]:null;
return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:a,textureID:b}}],featureDataPosition:[0,0,0]}]};f.prototype.collectGeometries=function(a,b,c){a=[];c=0;for(b=b.featureData;c<b.length;c++){var d=b[c],e=d.geometries;if(null!=e)for(var g=0;g<e.length;g++)a.push({featureIds:[d.id],featureDataPosition:d.position,geometries:[d.geometries[g]]});else null!=d.position&&a.push({featureIds:[d.id],featureDataPosition:d.position,geometries:null})}return a};f.prototype.loadFeatureData=
function(a,c){a=b.makeAbsolute(a.featureData[c].href,a.baseUrl);return this.load(a,"json")};f.prototype.handleCancelled=function(){if(this.cancelled)throw new k;};return f}();(function(a){a=a.TextureFormat||(a.TextureFormat={});a[a.Compressed=0]="Compressed";a[a.Normal=1]="Normal";a[a.Downsampled=2]="Downsampled"})(p||(p={}));return p})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Point ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ../graphics/Graphics3DSymbolCommonCode ./I3SUtil ../../support/geometryUtils ../../support/orientedBoundingBox ../../support/projectionUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l){return function(){function f(c,e,f,h,l,m,p,z){void 0===z&&(z={});this.indexSR=c;this._renderCoordsHelper=e;this.extent=l;this.elevationProvider=m;this.options=z;this._computedOBBs={};this._computedMBSs={};this._isNodeVisibleCached={};this.fp=d.frustum.create();this._idleCamera=!0;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=k.vec3f64.create();this._tmp2=k.vec3f64.create();this._tmp3=k.vec3f64.create();this._tmp0=k.vec3f64.create();this.supportedMetrics=["maxScreenThreshold",
"screenSpaceRelative","removedFeatureDiameter","distanceRangeFromDefaultCamera"];this.screenspaceErrorBias=z.screenspaceErrorBias||1;this.progressiveLoadFactor=z.progressiveLoadFactor||1;this.enableLoD=!z.disableLod;this.updateCamera(f);this._poi=k.vec3f64.clone(h);this.engineSR=this._renderCoordsHelper.spatialReference;p?(this._elevationContext=new g,this._elevationContext.featureExpressionInfoContext=b.createContext(b.extractExpressionInfo(p,!1)),this._elevationContext.mixinApi(p)):this._elevationContext=
null;this.tmpPoint=new a({x:0,y:0,z:0,spatialReference:c})}f.prototype.updateCamera=function(a){d.frustum.fromMatrix(a.viewMatrix,a.projectionMatrix,this.fp);this._screenSizeFactor=1/a.perPixelRatio;this._camPos=a.eye;this._isNodeVisibleCached={};this.maxDistance=0};f.prototype.updateNode=function(a){delete this._isNodeVisibleCached[a]};f.prototype.updatePointOfInterest=function(a){k.vec3.copy(this._poi,a)};f.prototype.updateScreenSpaceErrorBias=function(a){var b=this.screenspaceErrorBias;this.screenspaceErrorBias=
a;return b};f.prototype.setCameraIdle=function(a){this._idleCamera!==a&&(this._idleCamera=a,this._isNodeVisibleCached={})};f.prototype.updateExtent=function(a){this.extent=a;this._isNodeVisibleCached={}};f.prototype.computeMbs=function(a){var b=this._computedMBSs[a.id];b||(b=k.vec4f64.fromValues(a.mbs[0],a.mbs[1],a.mbs[2],-1),this._computedMBSs[a.id]=b);0>b[3]&&(k.vec4.copy(b,a.mbs),this._elevationContext&&1E5>b[3]&&(this.tmpPoint.x=b[0],this.tmpPoint.y=b[1],this.tmpPoint.z=b[2],b[2]=e.computeElevation(this.elevationProvider,
this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),l.mbsToMbs(b,this.indexSR,b,this.engineSR));return b};f.prototype.computeObb=function(a){if(a.obb&&!(0>a.obb.halfSize[0])){var b=this._computedOBBs[a.id];b||(b=m.clone(a.obb),b.halfSize[0]=-1,this._computedOBBs[a.id]=b);0>b.halfSize[0]&&(b.halfSize[0]=a.obb.halfSize[0],k.vec3.copy(b.center,a.obb.center),this._elevationContext&&1E5>a.mbs[3]&&(this.tmpPoint.x=a.obb.center[0],this.tmpPoint.y=a.obb.center[1],this.tmpPoint.z=a.obb.center[2],
b.center[2]=e.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),l.bufferToBuffer(b.center,this.indexSR,0,b.center,this.engineSR,0,1));return b}};f.prototype._isNodeVisible=function(a){var b=this.computeMbs(a);return this.isMBSinExtent(b)?a.hasServiceOBB&&a.obb?(a=this.computeObb(a),m.isVisible(a,this.fp)):this.isMBSVisible(b):!1};f.prototype.isNodeVisible=function(a){if(!this.enableLoD)return!0;if(!this._idleCamera)return this._isNodeVisible(a);
if(null!=this._isNodeVisibleCached[a.id])return this._isNodeVisibleCached[a.id];this._isNodeVisibleCached[a.id]=this._isNodeVisible(a);return this._isNodeVisibleCached[a.id]};f.prototype.isGeometryVisible=function(a){return this.isNodeVisible(a)?a.hasServiceOBB?!0:(a=this.computeObb(a))?m.isVisible(a,this.fp):!0:!1};f.prototype.invalidateCache=function(a){if(null==a){for(var b=0,c=Object.keys(this._computedMBSs);b<c.length;b++)a=c[b],this._computedMBSs[a][3]=-1;b=0;for(c=Object.keys(this._computedOBBs);b<
c.length;b++)a=c[b],this._computedOBBs[a].halfSize[0]=-1}else this._computedMBSs[a]&&(this._computedMBSs[a][3]=-1),this._computedOBBs[a]&&(this._computedOBBs[a].halfSize[0]=-1)};f.prototype.isMBSinExtent=function(a){return this.extent?0!==c.intersectBoundingBoxWithMbs(this.extent,a):!0};f.prototype.isMBSVisible=function(a){return d.frustum.intersectsSphere(this.fp,d.sphere.wrap(a[3],a))};f.prototype.calcScreenSpaceSize=function(a,b){var c=this.computeMbs(a);a=k.vec3.squaredDistance(c,this._camPos);
c=c[3];this.maxDistance=Math.max(this.maxDistance,Math.sqrt(a)-c);a-=c*c;return 0>a?.5*Number.MAX_VALUE:b/Math.sqrt(a)*this._screenSizeFactor};f.prototype.calcCameraDistance=function(a){a=this.computeMbs(a);a=k.vec3.distance(a,this._camPos)-a[3];this.maxDistance=Math.max(this.maxDistance,a);return a};f.prototype.calcAngleDependentLoD=function(a){a=this.computeMbs(a);var b=a[3];a=(Math.abs(a[0]*(a[0]-this._camPos[0])+a[1]*(a[1]-this._camPos[1])+a[2]*(a[2]-this._camPos[2]))/k.vec3.length(a)+b)/k.vec3.distance(a,
this._camPos);return Math.min(1,a)};f.prototype.hasLOD=function(a){return null!=a.lodSelection};f.prototype.hasFeatures=function(a){return null!=a.featureData};f.prototype.getDistancePlanarMode=function(a,b,c){var d=a[0]-b[0],e=a[1]-b[1];a=a[2]-b[2];d=d*d+e*e;if(d<=c*c)return Math.abs(a);c=Math.sqrt(d)-c;return Math.sqrt(a*a+c*c)};f.prototype.getDistanceGlobeMode=function(a,b,c){var d=k.vec3.length(b),e=k.vec3.length(a)-d;k.vec3.scale(this._tmp0,a,k.vec3.dot(a,b)/k.vec3.squaredLength(a));if(k.vec3.squaredDistance(b,
this._tmp0)<=c*c)return Math.abs(e);b=k.vec3.scale(this._tmp0,b,1/d);var d=k.vec3.scale(this._tmp1,b,d-c*c/2/d),g=k.vec3.subtract(this._tmp2,a,d),g=k.vec3.subtract(this._tmp2,g,k.vec3.scale(this._tmp3,b,k.vec3.dot(b,g))),d=k.vec3.add(this._tmp2,d,k.vec3.scale(this._tmp2,g,c/k.vec3.length(g)));c=k.vec3.distance(a,d);2E5<=e&&(a=k.vec3.subtract(this._tmp1,a,d),a=k.vec3.dot(a,b)/k.vec3.length(a),.08>a&&(a=1E-4),c/=a);return c};f.prototype.getDistance=function(a,b,c){return this.engineSR===l.SphericalECEFSpatialReference?
this.getDistanceGlobeMode(a,b,c):this.getDistancePlanarMode(a,b,c)};f.prototype._selectErrorMetric=function(a){for(var b=0;b<a.length;b++)if(0<=this.supportedMetrics.indexOf(a[b].metricType))return a[b];return null};f.prototype.getLodLevel=function(a){if(!a.lodSelection||0>=a.lodSelection.length||!1===this.hasFeatures(a))return 0;if(null==a.children||0===a.children.length)return this.maxLodLevel;var b=this.enableLoD?this._selectErrorMetric(a.lodSelection):null;if(null==b)return 0;if(1>this.progressiveLoadFactor){var c=
this.screenspaceErrorBias;return this.evaluateLODmetric(a,this.progressiveLoadFactor*this.screenspaceErrorBias,b)?this.evaluateLODmetric(a,c,b)?2:1:0}return this.evaluateLODmetric(a,this.screenspaceErrorBias,b)?this.maxLodLevel:0};f.prototype.evaluateLODmetric=function(a,b,c){switch(c.metricType){case "screenSpaceRelative":return a=this.computeMbs(a),a=this.getDistance(this._camPos,a,a[3]),this.maxDistance=Math.max(this.maxDistance,a),c.maxError*b<=2*a/this._screenSizeFactor;case "maxScreenThreshold":return b=
this.calcScreenSpaceSize(a,a.mbs[3]*b),this.options.angleDependentLoD&&(b*=this.calcAngleDependentLoD(a)),b<c.maxError;case "removedFeatureDiameter":return 10>this.calcScreenSpaceSize(a,c.maxError)*b;case "distanceRangeFromDefaultCamera":return this.calcCameraDistance(a)>c.maxError*b}return!1};f.prototype.distToPOI=function(a){a=this.computeMbs(a);return k.vec3.distance(a,this._poi)-a[3]};f.prototype.distCameraToPOI=function(){return k.vec3.distance(this._camPos,this._poi)};return f}()})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/SpatialReference ./i3s/I3SGeometryUtil ./i3s/I3SProjectionUtil ../support/meshProcessing ../support/orientedBoundingBox ../support/projectionUtils ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Util".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h){p=function(){function f(){}f.prototype.process=function(a){var b=[a.geometryBuffer];return k.resolve({result:this.transform(a,b),transferList:b})};f.prototype.transform=function(f,k){var p=g.fromJSON(f.indexSR),r=g.fromJSON(f.vertexSR),t=g.fromJSON(f.renderSR),u=!1,y=0,D=[],E=e.computeGlobalTransformation(f.mbs,f.elevationOffset,p,t),G=f.obb?null:d.create([0,0,0],[-1,-1,-1],[0,0,0,1]);a.vec3.copy(n,f.mbs);n[2]+=f.elevationOffset;a.vec3.copy(q,n);for(var H=0,I=f.geometryData;H<
I.length;H++)for(var N=I[H],S=N.componentOffsets,M=0,N=N.geometries;M<N.length;M++){var P=N[M],O=f.layouts[y];++y;var W=b.interleaveGeometryBuffer(P,f.geometryBuffer,O,[{name:h.VertexAttrConstants.COLOR,byteValue:255}],[h.VertexAttrConstants.NORMAL,h.VertexAttrConstants.NORMALCOMPRESSED,h.VertexAttrConstants.SYMBOLCOLOR,h.VertexAttrConstants.COMPONENTINDEX]),Q=new l(new Float32Array(W),O,void 0,void 0,void 0,!0),J=Q.getAttribute(h.VertexAttrConstants.POSITION);e.reprojectPoints(J,f.mbs,E,f.elevationOffset,
p,r,t);G&&this._updateObb(G,J,E);f.needNormals&&(J={normals:Q.getAttribute(h.VertexAttrConstants.NORMALCOMPRESSED),positions:J,normalInd:Q.getIndices(h.VertexAttrConstants.NORMALCOMPRESSED),positionInd:Q.getIndices(h.VertexAttrConstants.POSITION)},b.processAndInterleaveNormals(f.normalReferenceFrame,P,f.geometryBuffer,E,J));(P=Q.getAttribute(h.VertexAttrConstants.COMPONENTINDEX))&&this._createComponentNumbers(P,S);(Q=Q.getAttribute(h.VertexAttrConstants.COLOR))&&!u&&(u=this._hasColors(Q));Q={globalTrafo:E};
P=O[0].stride;P=c.deduplicate(W,P/4,1-.8*P/(P+4));null!=P?(W=65536>P.uniqueCount?new Uint16Array(P.indices):P.indices,J=b.extractPositionData(P.buffer,O,W),D.push({layout:O,interleavedVertexData:P.buffer,indices:W,corMatrices:Q,hasColors:u,positionData:J}),k&&(k.push(P.buffer),k.push(W.buffer),k.push(J.data.buffer),k.push(J.indices.buffer))):(J=b.extractPositionData(W,O),D.push({layout:O,interleavedVertexData:W,corMatrices:Q,hasColors:u,positionData:J}),k&&(k.push(W),k.push(J.data.buffer),k.push(J.indices.buffer)))}G&&
(a.vec3.transformMat4(G.center,G.center,E),m.vectorToVector(G.center,t,G.center,p),G.center[2]-=f.elevationOffset);return{geometryBuffer:f.geometryBuffer,transformedGeometries:D,obb:G}};f.prototype._hasColors=function(a){var b=a.data,c=a.size,d=a.strideIdx;for(a=a.offsetIdx;a<b.length;a+=d)for(var e=0;e<c;e++)if(255!==b[a+e])return!0;return!1};f.prototype._createComponentNumbers=function(a,b){var c=a.data,d=a.strideIdx,e=c.length/d,g=0;a=a.offsetIdx;for(var f=0;f<e;f++)f>=b[g+1]&&g++,c[a]=g,a+=d};
f.prototype._updateObb=function(b,c,e){if(0<b.halfSize[0]){a.vec3.subtract(n,b.center,b.halfSize);a.vec3.add(q,b.center,b.halfSize);for(e=c.offsetIdx;e<c.data.length;e+=c.strideIdx)n[0]=Math.min(n[0],c.data[e]),n[1]=Math.min(n[1],c.data[e+1]),n[2]=Math.min(n[2],c.data[e+2]),q[0]=Math.max(q[0],c.data[e]),q[1]=Math.max(q[1],c.data[e+1]),q[2]=Math.max(q[2],c.data[e+2]);a.vec3.subtract(b.halfSize,q,n);a.vec3.scale(b.halfSize,b.halfSize,.5);a.vec3.add(b.center,n,q);a.vec3.scale(b.center,b.center,.5)}else d.compute(c,
b),c=2*Math.sqrt(1+e[0]+e[5]+e[10]),t[0]=(e[9]-e[6])/c,t[1]=(e[2]-e[8])/c,t[2]=(e[4]-e[1])/c,t[3]=.25*c,a.quat.conjugate(t,t),a.quat.multiply(b.quaternion,t,b.quaternion)};return f}();var n=a.vec3f64.create(),q=a.vec3f64.create(),t=a.quatf32.create();return p})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ./I3SBinaryReader ../../support/meshProcessing ../../webgl-engine/lib/Util".split(" "),function(p,f,k,a,g,b){function e(a,
b,c,d,e,g,f){switch(c){case 1:for(c=0;c<f;c++)d[e]=a[b],b+=1,e+=g;break;case 2:for(c=0;c<f;c++)d[e]=a[b],d[e+1]=a[b+1],b+=2,e+=g;break;case 3:for(c=0;c<f;c++)d[e]=a[b],d[e+1]=a[b+1],d[e+2]=a[b+2],b+=3,e+=g;break;case 4:for(c=0;c<f;c++)d[e]=a[b],d[e+1]=a[b+1],d[e+2]=a[b+2],d[e+3]=a[b+3],b+=4,e+=g;break;default:throw h("Unhandled stride size "+c);}}function c(a,b,c,d,e,g){switch(b){case 1:for(b=0;b<g;b++)c[d]=a,d+=e;break;case 2:for(b=0;b<g;b++)c[d]=a,c[d+1]=a,d+=e;break;case 3:for(b=0;b<g;b++)c[d]=
a,c[d+1]=a,c[d+2]=a,d+=e;break;case 4:for(b=0;b<g;b++)c[d]=a,c[d+1]=a,c[d+2]=a,c[d+3]=a,d+=e;break;default:throw h("Unhandled stride size "+b);}}function d(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}function m(a){switch(a){case 5120:return"Int8";case 5126:return"Float32";case 5124:return"Int32";
case 5122:return"Int16";case 5121:return"UInt8";case 5125:return"UInt32";case 5123:return"UInt16"}throw Error("Unhandled data type: "+a);}function l(a){return 0<a&&0===a%Uint32Array.BYTES_PER_ELEMENT}function h(a){return Error("I3SGeometryUtil processing failed: "+a)}Object.defineProperty(f,"__esModule",{value:!0});var n=new Uint8Array(64);f.interleaveGeometryBuffer=function(a,b,g,f,k){void 0===f&&(f=[]);void 0===k&&(k=[]);var q=a.params.vertexAttributes,p=q.position.count;if(!l(g[0].stride))throw h("Layout stride must use "+
Uint32Array.BYTES_PER_ELEMENT+"-byte words");var r=new Uint32Array(g[0].stride/Uint32Array.BYTES_PER_ELEMENT*p);g=g.slice(0).sort(function(a,b){return a.offset-b.offset});a=function(a){if(-1!==k.indexOf(a.name))return"continue";var g=q[a.name],t=d(a.type),u=void 0,w=!1;if(null==g)if(w=f.filter(function(b){return b.name===a.name})[0]){g={valueType:m(a.type),byteOffset:0,count:p,valuesPerElement:a.count};for(u=0;u<n.length;u++)n[u]=w.byteValue;u=n.buffer;w=!0}else throw h("Geometry definition is missing attribute");
else u=b;if(m(a.type)!==g.valueType)throw h("Geometry definition type must match attribute type");if(0!==g.byteOffset%Uint32Array.BYTES_PER_ELEMENT||0!==a.offset%Uint32Array.BYTES_PER_ELEMENT)throw h(a.name+" offset must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!l(g.valuesPerElement*t.BYTES_PER_ELEMENT)||!l(a.count*t.BYTES_PER_ELEMENT))throw h(a.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var u=new Uint32Array(u),x=g.byteOffset/Uint32Array.BYTES_PER_ELEMENT,g=
g.valuesPerElement*t.BYTES_PER_ELEMENT/Uint32Array.BYTES_PER_ELEMENT,t=a.offset/Uint32Array.BYTES_PER_ELEMENT,z=a.stride/Uint32Array.BYTES_PER_ELEMENT;w?c(u[0],g,r,t,z,p):e(u,x,g,r,t,z,p)};for(var t=0;t<g.length;t++)a(g[t]);return r.buffer};f.processAndInterleaveNormals=function(c,d,e,g,f){if("none"===c){var h=f.normals,l=f.positions;d=f.normalInd;c=f.positionInd;b.assert(f.normalInd.length===f.positionInd.length);f=k.vec3f32.create();g=k.vec3f32.create();e=k.vec2f32.create();for(var m=l.data,n=l.offsetIdx,
l=l.strideIdx,p=h.data,r=h.offsetIdx,h=h.strideIdx,u=0;u<c.length;u+=3){var x=c[u],x=n+l*x,z=m[x],y=m[x+1],M=m[x+2],x=c[u+1],x=n+l*x;f[0]=m[x]-z;f[1]=m[x+1]-y;f[2]=m[x+2]-M;x=c[u+2];x=n+l*x;g[0]=m[x]-z;g[1]=m[x+1]-y;g[2]=m[x+2]-M;k.vec3.cross(f,f,g);b.encodeNormal(f,e);for(z=0;3>z;z++)y=r+h*d[u+z],p[y]=b.encodeInt16(e[0]),p[y+1]=b.encodeInt16(e[1])}}else if(d=a.createTypedView(e,d.params.vertexAttributes.normal),e=f.normals,y="earth-centered"===c?g:null,c=d.length/3,f=e.data,g=e.offsetIdx,e=e.strideIdx,
null!=y)for(m=y[0],n=y[1],l=y[2],p=y[4],r=y[5],h=y[6],u=y[8],z=y[9],y=y[10],M=0;M<c;M++){var x=d[3*M],P=d[3*M+1],O=d[3*M+2];q[0]=m*x+n*P+l*O;q[1]=p*x+r*P+h*O;q[2]=u*x+z*P+y*O;b.encodeNormal(q,t);f[g+M*e]=b.encodeInt16(t[0]);f[g+M*e+1]=b.encodeInt16(t[1])}else for(M=0;M<c;M++)q[0]=d[3*M],q[1]=d[3*M+1],q[2]=d[3*M+2],b.encodeNormal(q,t),f[g+M*e]=b.encodeInt16(t[0]),f[g+M*e+1]=b.encodeInt16(t[1])};f.extractPositionData=function(a,b,c){b=b[0];if(null==b||"position"!==b.name||5126!==b.type)return null;
var d=new Float32Array(a),e=b.stride/4,f=3*d.length/e,h=new Float32Array(f);for(a=0;a<f/3;a++)h[3*a]=d[a*e+b.offset],h[3*a+1]=d[a*e+b.offset+1],h[3*a+2]=d[a*e+b.offset+2];b=g.deduplicate(h.buffer,3);a=65536>b.uniqueCount;if(c)for(d=new (a?Uint16Array:Uint32Array)(c.length),a=0;a<c.length;a++)d[a]=b.indices[c[a]];else d=a?new Uint16Array(b.indices):b.indices;return{data:new Float32Array(b.buffer),indices:d}};var q=k.vec3f32.create(),t=k.vec2f32.create()})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/earthUtils ../../support/projectionUtils ../../webgl-engine/lib/localOrigin".split(" "),
function(p,f,k,a,g,b){function e(b,c,d){var e=k.vec3f64.create(),g=Math.ceil(Math.log(b[3])*Math.LOG2E/h),f=Math.pow(2,g*h+l),m;if(d.isGeographic){m=f/a.earthRadius*180/Math.PI;d=Math.round(b[1]/m);var n=Math.max(-90,Math.min(90,d*m)),p=m/Math.cos((Math.abs(n)-m/2)/180*Math.PI);m=Math.round(b[0]/p);e[0]=m*p;e[1]=n}else m=Math.round(b[0]/f),d=Math.round(b[1]/f),e[0]=m*f,e[1]=d*f;b=Math.round((b[2]+c)/f);e[2]=b*f;return{center:e,id:g+"_"+m+"_"+d+"_"+b}}Object.defineProperty(f,"__esModule",{value:!0});
var c=new Float64Array(3E3),d=k.vec3f64.create(),m=k.mat4f64.create();f.computeGlobalTransformation=function(a,b,c,d){a=e(a,b,c).center;b=k.mat4f64.create();g.computeLinearTransformation(c,a,b,d);return b};f.reprojectPoints=function(a,b,e,f,h,l,p){var n=a.data,q=a.offsetIdx;a=a.strideIdx;k.mat4.invert(m,e);k.vec3.copy(d,b);d[2]+=f;b=[0,0,0];e=n.length/a;g.vectorToVector(d,h,b,l);for(h=0;h<e;h+=1E3){f=Math.min(1E3,e-h);for(var r=0;r<f;r++){var t=q+a*(h+r);c[3*r]=n[t]+b[0];c[3*r+1]=n[t+1]+b[1];c[3*
r+2]=n[t+2]+b[2]}g.bufferToBuffer(c,l,0,c,p,0,f);for(r=0;r<f;r++){var t=c[3*r],u=c[3*r+1],x=c[3*r+2],y=q+a*(h+r);n[y]=m[0]*t+m[4]*u+m[8]*x+m[12];n[y+1]=m[1]*t+m[5]*u+m[9]*x+m[13];n[y+2]=m[2]*t+m[6]*u+m[10]*x+m[14]}}};f.createOrigin=function(a,c,d,f){c=e(a,c,d);a=c.center;c=c.id;g.vectorToVector(a,d,a,f);return b.fromVector(a,c)};var l=1,h=5-l})},"esri/views/3d/layers/i3s/Highlights":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(p,f,k){var a=function(){return function(a){this.highlightSet=
new k;this.ids=new Set;this.options=a}}();return function(){function g(a){this.highlights=[];this.layerView=a}g.prototype.destroy=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()});this.highlights=null};g.prototype.acquireSet=function(b){var e=this,c=new a(b);this.highlights.push(c);return{set:c,handle:{remove:function(){return e.releaseSet(c)}}}};g.prototype.releaseSet=function(a){a.highlightSet.removeAll();a=this.highlights?this.highlights.indexOf(a):-1;-1!==a&&this.highlights.splice(a,
1)};g.prototype.setFeatureIds=function(a,e){e.forEach(function(b){return a.ids.add(b)});this.layerView._forAllFeatures(function(b,d,e,g){a.ids.has(b)&&(b=e.engineObject.setComponentHighlight(g,d,a.options),a.highlightSet.addObject(e.engineObject,b))},null,!0)};g.prototype.objectCreated=function(a){var b=this;this.highlights.forEach(function(c){b.layerView._forAllFeaturesOfNode(b.layerView._getMetadata(a),function(b,e,g,f){c.ids.has(b)&&(b=a.setComponentHighlight(f,e,c.options),c.highlightSet.addObject(a,
b))},!0)})};g.prototype.objectDeleted=function(a){this.highlights.forEach(function(b){b.highlightSet.removeObject(a)})};g.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()})};return g}()})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../support/Evented ../../webgl-engine/lib/Selector".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h){var n=d.empty(),q={spatialReference:null,extent:n},t=c.vec3f64.create(),u=c.vec3f64.create(),r=c.vec3f64.create(),y=b.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(b){function g(a){return b.call(this)||this}k(g,b);g.prototype.initialize=function(){var a=this.layerView.view;this.view=a;this.renderCoordsHelper=a.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.selector=new h(a.viewingMode);a=this.layerView.layer.fullExtent;
this.zmin=a.zmin;this.zmax=a.zmax};g.prototype.getElevation=function(a){if(m.isPoint(a)){if(!this.renderCoordsHelper.toRenderCoords(a,t))return y.error("could not project point for elevation alignment"),-Infinity}else if(!this.renderCoordsHelper.toRenderCoords(a,this.spatialReference,t))return y.error("could not project point for elevation alignment"),-Infinity;var b=this.layerView.elevationOffset;a=this.zmin+b;b=this.zmax+b;c.vec3.copy(u,t);c.vec3.copy(r,t);this.renderCoordsHelper.setAltitude(b,
u);this.renderCoordsHelper.setAltitude(a,r);this.selector.init(this.intersectLayers,u,r,null,null,1,!1);return this.selector.minResult.getIntersectionPoint(t)?this.renderCoordsHelper.getAltitude(t):-Infinity};g.prototype.layerChanged=function(){this.spatialReference&&(q.extent=this.computeLayerExtent(this.intersectLayers[0]),q.spatialReference=this.spatialReference,this.emit("elevation-change",q))};g.prototype.objectChanged=function(a){this.spatialReference&&(q.extent=this.computeObjectExtent(a),
q.spatialReference=this.spatialReference,this.emit("elevation-change",q))};g.prototype.computeObjectExtent=function(a){d.empty(n);this.expandExtent(a,n);return n};g.prototype.computeLayerExtent=function(a){d.empty(n);var b=0;for(a=a.getObjects();b<a.length;b++)this.expandExtent(a[b],n);return n};g.prototype.expandExtent=function(a,b){for(var e=a.getBBMin(!0),g=a.getBBMax(!0),f=0;8>f;++f)t[0]=f&1?e[0]:g[0],t[1]=f&2?e[1]:g[1],t[2]=f&4?e[2]:g[2],c.vec3.transformMat4(t,t,a.objectTransformation),this.renderCoordsHelper.fromRenderCoords(t,
t,this.spatialReference),d.expand(b,t);return b};a([e.property({constructOnly:!0})],g.prototype,"layerView",void 0);a([e.property({constructOnly:!0})],g.prototype,"stageLayer",void 0);a([e.property()],g.prototype,"view",void 0);a([e.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],g.prototype,"spatialReference",void 0);return g=a([e.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],g)}(e.declared(g,l.Evented))})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["require",
"exports","../../../../core/Error","../../../../core/promiseUtils"],function(p,f,k,a){function g(b){return a.create(function(a,d){b.oncomplete=function(){return a()};b.onerror=function(){return d(b.error)};b.onabort=function(){return d(b.error)}})}function b(b){return a.create(function(a,d){"done"===b.readyState?null!=b.error?d(b.error):a(b.result):(b.onsuccess=function(){return a(b.result)},b.onerror=function(){return d(b.error)})})}Object.defineProperty(f,"__esModule",{value:!0});p=function(){function e(a,
b,e){this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=a;this._storeName=b;this._version=e}e.prototype.init=function(){var c=this;return a.resolve().then(function(){var a=indexedDB.open(c._dbName,c._version);a.onupgradeneeded=function(b){var d=a.result,e=a.transaction,g=d.objectStoreNames.contains(c._storeName)?e.objectStore(c._storeName):d.createObjectStore(c._storeName),
d=d.objectStoreNames.contains("last_access")?e.objectStore("last_access"):d.createObjectStore("last_access");d.indexNames.contains("date")||d.createIndex("date","date",{unique:!1});d.indexNames.contains("byteSize")||d.createIndex("byteSize","byteSize",{unique:!1});b.oldVersion<c._version&&(g.clear(),d.clear())};return b(a)}).then(function(a){c._destroyed?a.close():c._db=a})};e.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};e.prototype.getHitRate=function(){return this._hit/
(this._hit+this._miss)};e.prototype.put=function(b,d){var c=this;return null==this._db?a.reject(new k("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:a.resolve()).then(function(){return c._put(b,d)}).catch(function(a){if(a&&"QuotaExceededError"===a.name)return null==c._quotaReductionPromise&&(c._quotaReductionPromise=c._getCacheSize().then(function(a){return c._removeLeastRecentlyAccessed(d.byteSize+Math.ceil(a*c.quotaReductionFactor))}),
c._quotaReductionPromise.then(function(){c._quotaReductionPromise=null},function(){c._quotaReductionPromise=null})),c._quotaReductionPromise.then(function(){return c._put(b,d)});throw a;}).then(function(){c._gcCounter--;0>c._gcCounter&&null!=c._db&&(c._gcCounter=c.gcFrequency,c._getCacheSize().then(function(a){return c._removeLeastRecentlyAccessed(a-c.maxByteSize)}))})};e.prototype.get=function(c){var d=this;return null==this._db?a.resolve(null):a.resolve().then(function(){var a=d._db.transaction(d._storeName,
"readonly").objectStore(d._storeName).get(c);return b(a)}).then(function(a){null==a?++d._miss:(++d._hit,d._db.transaction("last_access","readwrite").objectStore("last_access").put({date:(new Date).getTime(),byteSize:a.byteSize},c));return a}).catch(function(a){++d._miss;return null})};e.prototype.remove=function(c){var d=this;return null==this._db?a.resolve():a.resolve().then(function(){var e=d._db.transaction([d._storeName,"last_access"],"readwrite"),f=e.objectStore(d._storeName),h=e.objectStore("last_access"),
f=f.delete(c),h=h.delete(c);return a.all([b(f),b(h),g(e)])})};e.prototype._put=function(c,d){var e=this._db.transaction([this._storeName,"last_access"],"readwrite"),f=e.objectStore(this._storeName),h=e.objectStore("last_access"),f=f.put(d,c);c=h.put({date:(new Date).getTime(),byteSize:d.byteSize},c);return a.all([b(f),b(c),g(e)])};e.prototype._removeLeastRecentlyAccessed=function(a){if(!(0>=a)){var b=this._db.transaction([this._storeName,"last_access"],"readwrite"),c=b.objectStore(this._storeName),
e=b.objectStore("last_access"),f=0,k=e.index("date").openCursor(null,"next");k.onsuccess=function(b){b=k.result;null!=b&&(null!=b.value.byteSize&&(f+=b.value.byteSize),c.delete(b.primaryKey),e.delete(b.primaryKey),f<a&&b.continue())};return g(b)}};e.prototype._getCacheSize=function(){var a=this._db.transaction("last_access"),b=0,e=a.objectStore("last_access").index("byteSize").openKeyCursor();e.onsuccess=function(a){if(a=e.result){var c=a.key;null!=c&&(b+=c);a.continue()}};return g(a).then(function(){return b})};
return e}();f.IDBCache=p;f.whenTransaction=g;f.whenRequest=b})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("require exports ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/FeatureSet".split(" "),function(p,f,k,a,g,b){return function(){function e(a,b,e){this._layer=a;this._support=b;this._options=e}e.prototype.queryExtent=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=0,d=
b._support.createExtentBuilder();b._forAllQueried(a,function(a){c++;d.add(a)});return{count:c,extent:0===c?null:d.getExtent()}})};e.prototype.queryFeatureCount=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=0;b._forAllQueried(a,function(){return c++});return c})};e.prototype.queryFeatures=function(c){var d=this;return this._rejectUnsupported(c).then(function(){var b=[],e=c&&c.outFields,g=[];if(0<d._forAllQueried(c,function(a){return g.push(d._support.createGraphic(a))},
function(a){e&&(b.push(d._support.requestFields(a,g,e)),g=[])})&&!c.num)return a.reject(new k("Unsupported Query","Large feature query, use Query.num and Query.start to batch"));e||b.push(a.resolve(g));return a.all(b)}).then(function(a){for(var c=[],e=0;e<a.length;++e)for(var f=a[e],k=0;k<f.length;++k)c.push(g.hydrateGraphic(f[k],d._layer));a=new b;a.features=c;return a})};e.prototype.queryObjectIds=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=[];b._forAllQueried(a,
function(a){return c.push(a.id)});return c})};e.defaultExtentBuilder=function(a){var b=null;return{add:function(c){(c=a(c))&&(b=null!=b?b.union(c):c.clone())},getExtent:function(){return b}}};e.prototype._forAllQueried=function(a,b,e){var c=[];if(a&&a.objectIds){var d=a.objectIds;c.push(function(a){return 0<=d.indexOf(a.id)})}var g=a&&a.start||0,f=a&&a.num||1E4;c.push(function(){if(0>=f)return--f,!1;if(0<g)return--g,!1;--f;return!0});this._support.forAll(function(a){for(var d=0;d<c.length;d++)if(!(0,c[d])(a))return;
b(a)},e);return Math.max(0,-f)};e.prototype._rejectUnsupported=function(b){if(null==b)return a.resolve();var c=function(b){return a.reject(new k("Unsupported Query","Unsupported property '"+b+"'"))};return null!=b.distance?c("distance"):null!=b.geometryPrecision?c("geometryPrecision"):b.groupByFieldsForStatistics&&b.groupByFieldsForStatistics.length?c("groupByFieldsForStatistics"):null!=b.maxAllowableOffset?c("maxAllowableOffset"):b.multipatchOption?c("multipatchOption"):b.orderByFields&&b.orderByFields.length?
c("orderByFields"):b.outSpatialReference?c("outSpatialReference"):b.outStatistics&&b.outStatistics.length?c("outStatistics"):b.pixelSize?c("pixelSize"):b.quantizationParameters?c("quantizationParameters"):b.relationParameter?c("relationParameter"):b.returnDistinctValues?c("returnDistinctValues"):b.text?c("text"):b.timeExtent?c("timeExtent"):b.where?c("where"):b.geometry?c("geometry"):!this._options.enableOutFields&&b.outFields&&b.outFields.length?c("outFields"):!this._options.enableObjectId&&b.objectIds&&
b.objectIds.length?c("objectIds"):a.resolve()};return e}()})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Error ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../support/graphicUtils ../LayerView3D ./popupUtils3D ../../../layers/support/popupUtils".split(" "),function(p,f,k,a,g,b,e,c,d,m,l){Object.defineProperty(f,
"__esModule",{value:!0});p=function(d){function f(){return null!==d&&d.apply(this,arguments)||this}k(f,d);f.prototype._validateFetchPopupFeatures=function(){var a=this.layer,b=a.popupTemplate;if(!a.popupEnabled)return new g("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:a});if(!b)return new g("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:a})};f.prototype.fetchPopupFeatures=function(a,d){var e=this._validateFetchPopupFeatures();if(e)return b.reject(e);
a&&this.hasDraped&&this.loadedGraphics&&(d=m.queryDrapedGraphics({view:this.view,loadedGraphics:this.loadedGraphics,layer:this.layer,popupTemplate:this.layer.popupTemplate,area:a,clientGraphics:d}));if(!d||0===d.length)return b.resolve([]);var g=[],f=[];a=l.getRequiredFields(this.layer);for(e=0;e<d.length;e++){var h=d[e];c.hasRequiredFields(h,a)?g.push(h):f.push(h)}return 0===f.length?b.resolve(g):this.whenGraphicAttributes(f,a).catch(function(){return f}).then(function(a){return g.concat(a)})};return f=
a([e.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],f)}(e.declared(d));f.PopupSceneLayerView=p;f.default=p})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/gl-matrix ../../../core/libs/rbush/PooledRBush ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../renderers/support/renderingInfoUtils ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/Graphics3DVerticalScale ./i3s/I3SQueryEngine ./i3s/I3SUtil ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/EventedArray ../support/orientedBoundingBox ../support/projectionUtils".split(" "),
function(p,f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H,I,N){var S=e.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D");p=function(e){function f(a){a=e.call(this)||this;a._nodesAddedToStage={};a.overlayUpdating=!1;a.supportsDraping=!0;a._queryEngine=null;a._memCache=null;a.loadedGraphics=new H;a.progressiveLoadFactor=1;a.supportsHeightUnitConversion=!0;a._coordinatesOutsideExtentErrors=0;a._maxCoordinatesOutsideExtentErrors=20;a._definitionExpressionErrors=0;a._maxDefinitionExpressionErrors=
20;return a}k(f,e);f.prototype.initialize=function(){var a=this;D.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode);this.handles.add([m.init(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)}),this.layer.watch("renderer",function(b,c){return a._rendererChange(b,c)}),this.layer.watch("objectIdFilter",function(){return a._objectIdFilterChange()}),this.watch("_controller.parsedDefinitionExpression",function(){return a._definitionExpressionChange()})]);
this._set("graphics3d",new w({owner:this,layer:this.layer,asyncGraphicsUpdates:!0,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:this.layer.fullExtent,updateClippingExtent:function(b){return a._updateClippingExtent(b)},queryGraphicUIDsInExtent:function(b,c,d){return a._queryGraphicUIDsInExtent(b,c,d)}}));this.supportsHeightUnitConversion&&(this._verticalScale=new B({sourceSpatialReference:this.layer.spatialReference,
destSpatialReference:this.view.spatialReference}));this.addResolvingPromise(this.graphics3d.setup());this.drawingOrder=this.view.getDrawingOrder(this.layer.uid);this._memCache=this.view.resourceController.getMemCache(this.layer.uid);this._controller=new y({layerView:this});this.when(function(){a.handles.add([m.init(a,"maximumNumberOfFeatures",function(b){return a._controller.featureTarget=b}),m.whenTrue(a,"suspended",function(){return a._removeAllNodeData()})])})};f.prototype.destroy=function(){this.graphics3d&&
(this.graphics3d.destroy(),this._set("graphics3d",null));this._controller&&(this._controller.destroy(),this._controller=null);this._memCache.destroy();this._nodesAddedToStage=this._elevationUpdateNodes=this._memCache=null};Object.defineProperty(f.prototype,"maximumNumberOfFeatures",{get:function(){var a=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return a?a.maximumNumberOfFeatures:0},set:function(a){null!=a?(this._override("maximumNumberOfFeatures",
a),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return this.suspended?!1:!!this._controller&&!this._controller.leafsReached},enumerable:!0,configurable:!0});f.prototype.whenGraphicAttributes=function(a,b){var c=this;return D.whenGraphicAttributes(this.layer,a,this._getObjectIdField(),b,function(a){for(var b=
new Map,d=[],e=0;e<a.length;e++){var f=a[e],g=c._findGraphicNodeAndIndex(f),h=b.get(g.node);h||(h={node:g.node,indices:[],graphics:[]},d.push(h));h.indices.push(g.index);h.graphics.push(f)}return d},{ignoreUnavailableFields:!0,populateObjectId:!0})};f.prototype.getGraphicFromGraphicUid=function(a){if(!this.loadedGraphics)return d.reject();var b=r.hydrateGraphic(this.loadedGraphics.find(function(b){return b.uid===a}),this.layer),c=this._getObjectIdField();if(!b||!b.attributes||!b.attributes[c])return d.reject();
b.layer=this.layer;b.sourceLayer=this.layer;return d.resolve(b)};f.prototype.whenGraphicBounds=function(a,b){return this.graphics3d.graphicsCore.whenGraphicBounds(a,b)};f.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};f.prototype.isUpdating=function(){return this.overlayUpdating||this._controller&&this._controller.updating||!this.graphics3d.destroyed&&this.graphics3d.updating};f.prototype.getRenderingInfo=function(a){if((a=x.getRenderingInfo(a,
{renderer:this.layer.renderer}))&&a.color){var b=a.color;b[0]/=255;b[1]/=255;b[2]/=255}return a};Object.defineProperty(f.prototype,"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!0,configurable:!0});f.prototype._findGraphicNodeAndIndex=function(a){a=a.attributes[this.layer.objectIdField];for(var b=0,c=Object.keys(this._nodesAddedToStage);b<c.length;b++){var d=c[b],e=this._findGraphicIndex(this._nodesAddedToStage[d].bundle,a);if(0<=e)return{node:this._controller.nodeIndex[d],
index:e}}return null};f.prototype._forAllFeatures=function(a,b){for(var c=0,d=Object.keys(this._nodesAddedToStage);c<d.length;c++){for(var e=d[c],f=this._nodesAddedToStage[e].bundle,g=0;g<f.length;g++)for(var h=f[g].graphics,k=0;k<h.length;k++){var l=h[k],m=f[g].featureIds[k];l.visible&&a(m,g,l)}null!=b&&b({nodeId:e})}};f.prototype._getGraphicIndices=function(a,b){a=this._nodesAddedToStage[a];for(var c=this._getObjectIdField(),d=[],e=0;e<b.length;e++){var f=this._findGraphicIndex(a.bundle,b[e].attributes[c]);
0<=f&&d.push(f)}return d};f.prototype._findGraphicIndex=function(a,b){for(var c=0;c<a.length;c++)for(var d=0,e=a[c].featureIds;d<e.length;d++)if(e[d]===b)return c;return-1};f.prototype._queryGraphicUIDsInExtent=function(a,d,e){if(this._controller){var f=this._controller.crsIndex;N.boundingRectToBoundingRect(a,d,O,f);var g=W;q.fromRect(g,O);g[2]=-Infinity;g[5]=Infinity;null==this._elevationUpdateNodes&&(this._elevationUpdateNodes=new c);var h=this._elevationUpdateNodes;h.clear();this._controller.updateElevationChanged(g,
f,h);for(f=0;f<h.length;f++){var k=this._nodesAddedToStage[h.data[f].id];if(null!=k){if(!k.spatialIndex&&k.bundle.length>=P){for(var l=new n.PooledRBush(9,b("csp-restrictions")?function(a){return{minX:a.extent[0],minY:a.extent[1],maxX:a.extent[2],maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),m=F.length=0,p=k.bundle;m<p.length;m++){for(var u=p[m],w=t.empty(),x=0,y=u.graphics;x<y.length;x++)g=y[x],r.expandAABR(g.geometry,w);u.extent=w;F.push(u)}l.load(F);k.spatialIndex=l}if(k.spatialIndex)g=
O,N.boundingRectToBoundingRect(a,d,O,this.view.spatialReference),Q.minX=g[0],Q.minY=g[1],Q.maxX=g[2],Q.maxY=g[3],k.spatialIndex.search(Q,function(a){var b=0;for(a=a.graphics;b<a.length;b++)e(a[b].uid)});else for(l=0,k=k.bundle;l<k.length;l++)for(u=k[l],m=0,u=u.graphics;m<u.length;m++)g=u[m],e(g.uid)}}}};f.prototype.highlight=function(a,b){void 0===b&&(b={});return this.graphics3d.highlight(a,b,this.layer.objectIdField)};f.prototype.addNodeData=function(a,b){var c=b.allGeometryData,e=b.attributeDataInfo,
f=this._controller.crsIndex;b=this.view.spatialReference;var h=[0,0,0],k=this._getObjectIdField();null==this._nodesAddedToStage[a.id]&&(this._nodesAddedToStage[a.id]={bundle:[],attributeInfo:e});var l=[];this._nodesAddedToStage[a.id].bundle=l;if(e=this.layer.fullExtent)e=this.layer.fullExtent.clone(),e.xmin-=.5,e.ymin-=.5,e.xmax+=.5,e.ymax+=.5,e.hasZ&&(e.zmin-=.5,e.zmax+=.5),e.hasM&&(e.mmin-=.5,e.mmax+=.5);for(var m=e,e=[],n=[],p=0;p<c.length;p++){var q=c[p],t=q.featureDataPosition,w=t.length,x=q.geometries||
[M[w]],y=q.featureIds;m&&!u.extentContainsCoords3D(m,t)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&S.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&S.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);for(var z=0;z<x.length;z++){var v=x[z];if("points"===v.params.type){var B=[],C=y[z<y.length?z:0],D={};null!=
C&&(D[k]=C);C=void 0;"Embedded"===v.type&&(C=v.params.vertexAttributes.position);for(v=0;v<C.length;v+=w){for(var E=0;E<w;E++)h[E]=t[E]+C[v+E];N.bufferToBuffer(h,f,0,J,b,0,1);E=r.makeDehydratedPoint(J[0],J[1],J[2],b);3>w&&(E.z=void 0);B.push({uid:g.generateUID(),geometry:E,attributes:D,visible:!0});a.obb||n.push(E.x,E.y,E.z?E.z:0)}e.push.apply(e,B);l.push({featureIds:q.featureIds,graphics:B})}}}a.numFeatures=e.length;this._updateNodeMemory(a);c=this._nodesAddedToStage[a.id];this._setBundleAttributes(c.bundle,
c.attributeInfo);0<n.length&&(f=this.view.renderSpatialReference,h=this._controller.crsVertex,N.bufferToBuffer(n,b,0,n,f,0,n.length/3),a.obb=I.compute({data:n,size:3,offsetIdx:0,strideIdx:3}),N.vectorToVector(a.obb.center,f,a.obb.center,h),this._controller.updateVisibility(a.id));if(!this._controller.isGeometryVisible(a))return this._cacheNodeData(a.id,this._nodesAddedToStage[a.id]),delete this._nodesAddedToStage[a.id],d.resolve();this._verticalScale&&this._verticalScale.adjust(e);this.loadedGraphics.addMany(e);
this._filterNode(c);return d.resolve()};f.prototype.isNodeLoaded=function(a){return null!=this._nodesAddedToStage[a.id]};f.prototype._updateNodeMemory=function(a){a.memory=4096+a.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic};f.prototype._cacheNodeData=function(a,b){var c=b.bundle.reduce(function(a,b){return b.graphics.reduce(function(a,b){return r.estimateSize(b)+a},512+8*b.featureIds.length+a)},1024);this._memCache.put(a,b,c)};f.prototype._removeAllNodeData=function(){var a=this;
Object.keys(this._nodesAddedToStage).forEach(function(b){var c=a._nodesAddedToStage[b];c&&(a._updateNodeMemory(a._controller.nodeIndex[b]),a._cacheNodeData(b,c))});this._nodesAddedToStage={};this.loadedGraphics.clear()};f.prototype.removeNodeData=function(a){var b=this,c=[];a.forEach(function(a){var d=b._removeNodeStageData(a,c);d&&(b._updateNodeMemory(a),b._cacheNodeData(a.id,d))});this.loadedGraphics.removeUnorderedMany(c)};f.prototype._removeNodeStageData=function(a,b){var c=this._nodesAddedToStage[a.id];
if(!c)return null;for(var d=0,e=c.bundle;d<e.length;d++)b.push.apply(b,e[d].graphics);delete this._nodesAddedToStage[a.id];return c};f.prototype.loadCachedNodeData=function(a,b){return d.resolve(this._memCache.pop(a.id))};f.prototype.addCachedNodeData=function(a,b,c){for(var e=[],f=0,g=b.bundle;f<g.length;f++)e.push.apply(e,g[f].graphics);this._updateNodeMemory(a);this._nodesAddedToStage[a.id]=b;this.setAttributeData(a,c);this.loadedGraphics.addMany(e);this._filterNode(b);return d.resolve()};f.prototype.getLoadedNodeIDs=
function(){return Object.keys(this._nodesAddedToStage)};f.prototype.getLoadedAttributes=function(a){if(a=this._nodesAddedToStage[a.id])return a.attributeInfo.loadedAttributes};f.prototype.getAttributeData=function(a){if(a=this._nodesAddedToStage[a.id])return a.attributeInfo.attributeData};f.prototype.setAttributeData=function(a,b){if(a=this._nodesAddedToStage[a.id])a.attributeInfo=b,this._setBundleAttributes(a.bundle,b),this._filterNode(a),this.graphics3d.graphicsCore.labelsEnabled&&(b=a.bundle.map(function(a){return a.graphics.length&&
a.graphics[0].uid}),this.graphics3d.graphicsCore.updateLabelingInfo(b))};f.prototype._setBundleAttributes=function(a,b){for(var c=0;c<a.length;c++)for(var d=0,e=a[c].graphics;d<e.length;d++){var f=e[d];f.attributes||(f.attributes={});if(b.loadedAttributes)for(var g=0,h=b.loadedAttributes;g<h.length;g++){var k=h[g].name;b.attributeData[k]&&(f.attributes[k]=D.getCachedAttributeValue(b.attributeData[k],c))}}};f.prototype._updateClippingExtent=function(a){this._controller&&this._controller.updateClippingArea(a);
return!1};f.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};f.prototype._rendererChange=function(a,b){var c=a?a.requiredFields:[],d=b?b.requiredFields:[];c.length===d.length&&c.every(function(a,b){return c[b]===d[b]})||this._reloadAllNodes()};f.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&S.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};f.prototype._objectIdFilterChange=
function(){var a=this;Object.keys(this._nodesAddedToStage).forEach(function(b){return a._filterNode(a._nodesAddedToStage[b])})};f.prototype._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};f.prototype._definitionExpressionChange=function(){this._definitionExpressionErrors=0};f.prototype._evaluateClause=function(a,b){try{return!!a.calculateValue(b)}catch(ba){return this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&S.error("Error while evaluating definitionExpression: "+
ba),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&S.error("Further errors are ignored"),!1}};f.prototype._filterNode=function(a){var b=this._getObjectIdField(),c=null;if(this.layer.objectIdFilter)var d=this.layer.objectIdFilter.ids,e="include"===this.layer.objectIdFilter.method,c=function(a){return 0<=d.indexOf(a)===e};var f=this._controller.parsedDefinitionExpression,g=0;for(a=a.bundle;g<a.length;g++)for(var h=0,k=a[g].graphics;h<k.length;h++){var l=
k[h],m=l.visible;c&&!c(l.attributes[b])?l.visible=!1:l.visible=f?this._evaluateClause(f,l):!0;m!==l.visible&&(K.graphic=l,K.property="visible",K.oldValue=m,K.newValue=l.visible,this.layer.graphicChanged(K))}};f.prototype.queryExtent=function(a){return this._ensureQueryEngine().queryExtent(a)};f.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().queryFeatureCount(a)};f.prototype.queryFeatures=function(a){return this._ensureQueryEngine().queryFeatures(a)};f.prototype.queryObjectIds=
function(a){return this._ensureQueryEngine().queryObjectIds(a)};f.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};f.prototype._createQueryEngine=function(){var a=this,b={id:0,index:0,graphic:null},c=this;return new C(this.layer,{forAll:function(c,d){a._forAllFeatures(function(a,d,e){b.id=a;b.index=d;b.graphic=e;c(b)},d)},createGraphic:function(a){return r.hydrateGraphic(a.graphic,c.layer)},requestFields:function(b,
c,d){return D.whenGraphicAttributes(a.layer,c,a._getObjectIdField(),d,function(c){var d=a._getGraphicIndices(b.nodeId,c);return[{node:a._controller.nodeIndex[b.nodeId],indices:d,graphics:c}]},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){var b=q.empty(),c=a.layer.spatialReference;return{add:function(a){return r.expandAABB(a.graphic.geometry,b)},getExtent:function(){return q.toExtent(b,c)}}}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})};f.prototype.getUsedMemory=
function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return a?a.usedMemory:0};f.prototype.getUnloadedMemory=function(){var a=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(a?a.unprocessedMemoryEstimate:0))};f.prototype.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};f.prototype.getNumberOfNodes=function(){return Object.keys(this._nodesAddedToStage).length};f.prototype.getNumberOfFeatures=
function(){return this.loadedGraphics.length};f.prototype.getStats=function(){var a=this.inherited(arguments)||{};a.index=this._controller?Object.keys(this._controller.nodeIndex).length:0;a.nodes=Object.keys(this._nodesAddedToStage).length;a.features=this.loadedGraphics.length;this._controller&&this._controller.updateStats(a);return a};a([l.property()],f.prototype,"graphics3d",void 0);a([l.property()],f.prototype,"drawingOrder",void 0);a([l.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],
f.prototype,"hasDraped",void 0);a([l.property({type:Boolean})],f.prototype,"overlayUpdating",void 0);a([l.property({type:Boolean})],f.prototype,"supportsDraping",void 0);a([l.property()],f.prototype,"loadedGraphics",void 0);a([l.property()],f.prototype,"layer",void 0);a([l.property()],f.prototype,"_controller",void 0);a([l.property({dependsOn:["_controller.updating","graphics3d.updating","overlayUpdating"]})],f.prototype,"updating",void 0);a([l.property({dependsOn:["_controller.rootNodeVisible"]})],
f.prototype,"suspended",void 0);a([l.property(E.updatingPercentage)],f.prototype,"updatingPercentage",void 0);a([l.property({aliasOf:"_controller.updatingPercentage"})],f.prototype,"updatingPercentageValue",void 0);a([l.property({type:Number,dependsOn:["graphics3d.graphicsCore.displayFeatureLimit"]})],f.prototype,"maximumNumberOfFeatures",null);a([l.property({readOnly:!0,dependsOn:["suspended","_controller.leafsReached"]})],f.prototype,"maximumNumberOfFeaturesExceeded",null);a([l.property({readOnly:!0,
aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],f.prototype,"lodFactor",void 0);return f=a([l.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],f)}(l.declared(z,G.PopupSceneLayerView));var M={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},P=100,O=t.create(),W=q.create(q.POSITIVE_INFINITY),Q={minX:0,minY:0,maxX:0,maxY:0},J=h.vec3f64.create(),F=[],K={graphic:null,property:null,
oldValue:null,newValue:null};return p})},"esri/views/3d/support/EventedArray":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/PooledArray","./Evented"],function(p,f,k,a,g){return function(b){function e(){var c=null!==b&&b.apply(this,arguments)||this;c.array=new a;return c}k(e,b);e.prototype.clear=function(){0<this.array.length&&this.emit("change",{added:[],removed:this.toArray()});this.array.clear()};Object.defineProperty(e.prototype,"length",{get:function(){return this.array.length},
enumerable:!0,configurable:!0});e.prototype.getItemAt=function(a){return this.array.data[a]};e.prototype.push=function(a){var b=this.array.push(a);this.emit("change",{added:[a],removed:[]});return b};e.prototype.addMany=function(a){var b=this.array.pushArray(a);this.emit("change",{added:a,removed:[]});return b};e.prototype.pushNew=function(){var a=this.array.pushNew();this.emit("change",{added:[a],removed:[]});return a};e.prototype.pop=function(){var a=this.array.pop();void 0!==a&&this.emit("change",
{added:[],removed:[a]});return a};e.prototype.removeMany=function(a){a=this.array.removeMany(a);0<a.length&&this.emit("change",{added:[],removed:a});return a};e.prototype.removeUnordered=function(a){a=this.array.removeUnordered(a);void 0!==a&&this.emit("change",{added:[],removed:[a]});return a};e.prototype.removeUnorderedMany=function(a){a=this.array.removeUnorderedMany(a);0<a.length&&this.emit("change",{added:[],removed:a});return a};e.prototype.toArray=function(){return this.array.toArray()};e.prototype.some=
function(a,b){return this.array.some(a,b)};e.prototype.find=function(a,b){return this.array.find(a,b)};e.prototype.filter=function(a,b,f){f=f||new e;this.array.filter(a,b,f.array);return f};e.prototype.forEach=function(a,b){this.array.forEach(a,b)};e.prototype.map=function(a,b){return this.array.map(a,b)};return e}(g.Evented)})},"*now":function(p){p(['dojo/i18n!*preload*esri/views/nls/SceneView*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},
"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper dojo/dom ../Camera ../geometry ../Graphic ../Viewpoint ../core/asyncUtils ../core/Error ../core/Handles ../core/has ../core/Logger ../core/promiseUtils ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/accessorSupport/watch ../core/libs/gl-matrix-2/gl-matrix ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ./BreakpointsOwner ./DOMContainer ./PopupView ./View ./ViewAnimation ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/Deconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/layers/support/FeatureTileTree3DDebugger ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/geometryUtils ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SharedSymbolResources ./3d/support/geometryUtils/boundedPlane ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Selector ./support/screenshotUtils ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment".split(" "),function(p,
f,k,a,g,b,e,c,d,m,l,h,n,q,t,u,r,y,x,z,w,B,C,D,E,G,H,I,N,S,M,P,O,W,Q,J,F,K,L,T,R,X,ba,ca,Z,da,U,ia,ea,aa,ga,fa,ja,V,ha,ma,ka,v,ta,za,Da,ua,qa,La,Ma){var xa=u.getLogger("esri.views.SceneView");f=function(f){function u(a){a=f.call(this)||this;a._clippingArea=null;a._internallyReady=!1;a._userClippingArea=null;a._initialDefaultSpatialReference=null;a._defaults={};a._externallySet={environment:!1};a._handles=new q;a._createGraphicsViewPromise=null;a._updateUpdatingMonitorsHandle=null;a._mapLayersChangeHandle=
null;a._updateDrawingOrderHandle=null;a._stageFrameTask=null;a.onViewExtentUpdateHandle=null;a._resolveWhenReady=[];a.propertiesPool=new ga.default({slicePlane:ma.BoundedPlaneClass},a);a.resourceController=new V(a);a.deconflictor=new F.Deconflictor(a);a.labeler=new K.Labeler({view:a});a.renderSpatialReference=null;a.sharedSymbolResources=null;a.basemapTerrain=null;a.elevationProvider=null;a.camera=null;a.canvas=null;a.center=null;a.constraints=new O.default;a.extent=null;a.fullOpacity=1;a.graphicsView=
null;a.map=null;a.screenSizePerspectiveEnabled=!0;a.state=null;a.scale=null;a.isHeightModelInfoRequired=!0;a.alphaCompositingEnabled=!1;a.supersampleScreenhotsEnabled=!0;a.type="3d";a.ui=new La;a.updating=!1;a.updatingPercentage=0;a.viewpoint=null;a.zoom=null;a.highlightOptions=new ia;x.when(a,"ready",a._viewReadyHandler.bind(a));a._evaluateUpdating=a._evaluateUpdating.bind(a);a.watch("map",function(a){a&&a.load&&a.load()});a.inputManager=new J({view:a});a.stateManager=new X.ViewStateManager({view:a});
return a}k(u,f);u.prototype.getDefaults=function(a){var b=this.inherited(arguments);b.environment||a.environment||(this._defaults.environment=new W,b.environment=this._defaults.environment);return b};u.prototype.initialize=function(){var a=this;this.environmentManager=new Q.default({view:this});this._updateUpdatingMonitorsHandle=this.allLayerViews.on("change",function(b){return a._updateUpdatingMonitors(b)});this._updateUpdatingMonitors({added:this.allLayerViews.toArray(),removed:[]});x.whenNot(this,
"ready",this._viewUnreadyHandler.bind(this));this.resourceController.memoryEvents.on("updating-changed",function(){return a._evaluateUpdating()});x.init(this.qualitySettings,"gpuMemoryLimit",function(b){a.resourceController&&(a.resourceController.maxGpuMemory=b)});x.init(this.qualitySettings,"additionalCacheMemory",function(b){a.resourceController&&(a.resourceController.additionalCacheMemory=b)});x.init(this.qualitySettings,"frameRate",function(a){y.setFrameRate(a)});x.init(Z,"SCENEVIEW_LOCKING_LOG",
function(b){a.defaultsFromMap.logDebugInformation=b})};u.prototype.destroy=function(){this.activeTool=null;B.dispatchTarget(this);this.environmentManager.destroy();this._disposeGraphicsView();this._updateUpdatingMonitorsHandle.remove();this._updateUpdatingMonitorsHandle=null;this._handles.removeAll();this.inputManager&&(this.inputManager.destroy(),this._set("inputManager",null));this.propertiesPool.destroy()};Object.defineProperty(u.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;
if(this._userClippingArea)return this._userClippingArea;var a=this.get("map.clippingEnabled"),b=this.get("map.clippingArea");if(!a||!b)return this._clippingArea=null;if(!(b instanceof d.Extent))return xa.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(H.canProject(b.spatialReference,this.spatialReference))b=H.project(b,this.spatialReference);else return xa.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;
return this._clippingArea&&b&&this._clippingArea.equals(b)?this._clippingArea:this._clippingArea=b},set:function(a){this.ready&&"global"===this.viewingMode&&a?xa.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"dataExtent",{get:function(){var a=[],b=this.spatialReference||d.SpatialReference.WGS84,c=this.clippingArea;c&&(c=H.project(c,b));
var e=function(d){d&&(d=H.project(d,b))&&(c&&(d=d.intersection(c)),d&&a.push(d))},f=this._get("basemapTerrain");f&&f.spatialReference&&e(new d.Extent({xmin:f.extent[0],ymin:f.extent[1],zmin:0,xmax:f.extent[2],ymax:f.extent[3],zmax:0,spatialReference:f.spatialReference}));this.map&&this.map.allLayers.forEach(function(a){e(a.fullExtent)});return 0<a.length?(f=a.reduce(function(a,b){return a.union(b)}),f.hasZ?(f.zmin=Math.min(0,f.zmin),f.zmax=Math.max(0,f.zmax)):(f.zmin=0,f.zmax=0),f):new d.Extent({xmin:0,
ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b})},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"environment",{set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",a)},enumerable:!0,configurable:!0});u.prototype.castEnvironment=function(a){return a?a instanceof W?a:a instanceof Ma?W.fromWebsceneEnvironment(a):w.ensureType(W,a):new W};Object.defineProperty(u.prototype,"groundExtent",{get:function(){var a=this._get("basemapTerrain");
if(a&&a.spatialReference){var b=a.extent;return new d.Extent({xmin:b[0],ymin:b[1],xmax:b[2],ymax:b[3],spatialReference:a.spatialReference})}return new d.Extent({spatialReference:this.spatialReference||d.SpatialReference.WGS84})},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"initialExtentRequired",{get:function(){return!this.stateManager.hasInitialView},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"interacting",{get:function(){return!!this.state&&this.state.interacting},
enumerable:!0,configurable:!0});u.prototype._mapSetter=function(a){a!==this._get("map")&&(this._mapLayersChangeHandle&&(this._mapLayersChangeHandle.remove(),this._mapLayersChangeHandle=null),a&&(this._mapLayersChangeHandle=a.allLayers.on("change",this.notifyChange.bind(this,"dataExtent"))),this.inherited(arguments))};Object.defineProperty(u.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||da.getDefaultProfile()},set:function(a){da.isValidProfile(a)&&(da.apply(a,this.qualitySettings),
this._set("qualityProfile",a))},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"slicePlane",{set:function(a){this._stage.setRenderParams({slicePlane:a});if(a){var b=this.propertiesPool.get("slicePlane");U.boundedPlane.copy(a,b);this._set("slicePlane",b)}else this._set("slicePlane",null)},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"resolution",{get:function(){return null!=this.spatialReference?G.getResolutionForScale(this.scale,this.spatialReference):0},enumerable:!0,
configurable:!0});Object.defineProperty(u.prototype,"heightModelInfo",{get:function(){var a=this.getDefaultHeightModelInfo();return null!=a?D.deriveUnitFromSR(a,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"viewingMode",{get:function(){var a=this.get("map.initialViewProperties.viewingMode"),b=this.spatialReference;a||(a=!b||b.isWebMercator||b.isWGS84?"global":"local");return a},set:function(a){this._internallyReady?xa.error("#viewingMode","viewingMode cannot be set once view is ready"):
0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")},enumerable:!0,configurable:!0});u.prototype.on=function(a,b,c){var d=this.inputManager.viewEvents.register(a,b,c);return d?d:this.inherited(arguments)};u.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.inputManager&&this.inputManager.viewEvents.hasHandler(a)};u.prototype.toMap=function(a,b,c){if(!this.ready)return xa.error("#toMap()","Scene view cannot be used before it is ready"),
null;var d;"number"===typeof a?(d=a,a=b):(d=a.x,a=a.y,c=b);b=C.vec2f64.fromValues(d,this.height-a);b=this.sceneIntersectionHelper.intersectSelectorScreen(b).minResult;return this._computeMapPointFromIntersectionResult(b,c)};u.prototype.toScreen=function(a,b,c,d){if(!this.ready)return xa.error("#toScreen()","Scene view cannot be used before it is ready"),null;"number"===typeof a?("object"===typeof c&&(d=c),aa.vectorToVector([a,b,"number"===typeof c?c:0],this.spatialReference,va,this.renderSpatialReference)):
(aa.pointToVector(a,va,this.renderSpatialReference),d=b);return this.engineToScreen(va,d)};u.prototype.pixelSizeAt=function(a,b){if(!this.ready)return xa.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if("number"===typeof a){if(a=this.sceneIntersectionHelper.intersectSelectorScreen(C.vec2f64.fromValues(a,this.height-b)).minResult,!a.getIntersectionPoint(va))return 0}else if(a instanceof d.Point)aa.pointToVector(a,va,this.renderSpatialReference);else if(a=this.sceneIntersectionHelper.intersectSelectorScreen(C.vec2f64.fromValues(a.x,
this.height-a.y)).minResult,!a.getIntersectionPoint(va))return 0;return this.state.camera.computePixelSizeAt(va)};u.prototype.hitTest=function(a){if(!this.ready)return xa.error("#hitTest()","Scene view cannot be used before it is ready"),null;var b=C.vec2f64.fromValues(a.x,this.height-a.y),c=this.sceneIntersectionHelper.intersectSelectorScreen(b,null,null,!0),b=c.minResult,e=this._computeMapPointFromIntersectionResult(b),f=null;if(b.target)switch(b.target.type){case "stage":f=this._getGraphicFromStageObject(b.target.obj,
b.triangleNr);break;case "external":switch(b.intersector){case "PointRenderer":f=r.when(this._getGraphicFromPointRenderer(b.target));break;case "LodRenderer":f=this._getGraphicFromLodRenderer(b.target)}}return r.when(f).catch(function(){return null}).then(function(b){var f=[];(b||e)&&f.push({mapPoint:e,graphic:b});b={screenPoint:new d.ScreenPoint({x:a.x,y:a.y}),results:f};Z.SCENEVIEW_HITTEST_RETURN_SELECTOR&&(b.selector=c);return b})};u.prototype.popupHitTest=function(a){var b=this;return this.hitTest(a).then(function(c){var d=
[],e=null;0===c.results.length&&(e=C.vec2f64.fromValues(a.x,b.height-a.y),e=b.sceneIntersectionHelper.intersectSelectorScreen(e,null,new Set).minResult,e=b._computeMapPointFromIntersectionResult(e));var f=0;for(c=c.results;f<c.length;f++){var g=c[f];g.graphic?d.push(g):e||(e=g.mapPoint)}return{results:d,screenPoint:a,mapPoint:e}})};u.prototype.goTo=function(a,b){return this.stateManager.goTo(a,b)};u.prototype.takeScreenshot=function(a){var b=this;return this.whenReady().then(function(){return b._stage.takeScreenshot(ua.toRenderSettings(a,
b))})};u.prototype.destroyLayerViews=function(){var a=this;this.allLayerViews.forEach(function(b){return a._handles.remove(b.layer.uid)});this.stateManager.deinit();this._disposeSurface();this.inherited(arguments);this._stage&&(this._stage.dispose(),this._stage=null,this._handles.remove("stage"));this._set("canvas",null);this.labeler=null;this.deconflictor.destroy();this.deconflictor=null;this.resourceController.destroy();this.resourceController=null};u.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||
this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null};u.prototype.validate=function(){var a=qa.check();t("safari")&&9>t("safari")&&(a=new n("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:t("safari")}));return a?(xa.warn("#validate()",a.message),r.reject(a)):r.resolve()};u.prototype.isSpatialReferenceSupported=function(a,
b,c){var d=a.isGeographic,e=a.isWebMercator,f=a.isWGS84,g="local"===this.viewingMode,h=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(h){if(g&&d)return c&&c("Layer "+b.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!g&&!e&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(d&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is geographic but not WGS84"),
!1;if(b)if(ta.isTiledLayer(b)){if(d=void 0,h?h=ta.getTiledLayerInfo(b,a,this.viewingMode):(h=ta.getTiledLayerInfo(b,a,"global"),null==h.tileInfo&&(h=ta.getTiledLayerInfo(b,a,"local"))),d=null!=h.tileInfo,!d)return c&&c("Layer "+b.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((f||e)&&!g)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=a),h||this._internallyReady||(this.viewingMode=
"global",c&&c("Viewing mode locked to global due to reprojectable layer "+b.id)),c&&c("Layer "+b.id+" is ignored because it supports server-side reprojection"),!1;return!0};u.prototype.whenReady=function(){var a=this;return r.create(function(b){a._internallyReady?b(a):a._resolveWhenReady.push(b)})};u.prototype.engineToScreen=function(a,b){var c=C.vec3f64.create();this.state.camera.projectPoint(a,c);a=c[0];var e=this.height-c[1],c=c[2];return b?(b.x=a,b.y=e,b.z=c,b):new d.ScreenPoint({x:a,y:e,z:c})};
u.prototype.flushDisplayModifications=function(){this._stage.processDirty()};u.prototype.getDrawingOrder=function(a){return this.allLayerViews.findIndex(function(b){return b.layer&&b.layer.uid===a})};u.prototype.getViewForGraphic=function(a){return a.layer?this.allLayerViews.find(function(b){return b.layer===a.layer}):this.graphicsView};u.prototype.whenViewForGraphic=function(a){var b=this;return a.layer?this.whenLayerView(a.layer):this.graphicsView||this._createGraphicsViewPromise||0<this.graphics.length?
x.whenOnce(this,"graphicsView").then(function(){return b.graphicsView}):r.reject()};u.prototype._computeMapPointFromIntersectionResult=function(a,b){if(a.getIntersectionPoint(va)){b=this._computeMapPointFromVec3d(va,b);var c=this._get("basemapTerrain");"TerrainRenderer"===a.intersector&&c&&(a=c.getElevation(b),null!==a&&(b.z=a));return b}return null};u.prototype._computeMapPointFromVec3d=function(a,b){var c=this.spatialReference||d.SpatialReference.WGS84;aa.vectorToVector(a,this.renderSpatialReference,
a,c)||(c=d.SpatialReference.WGS84,aa.vectorToVector(a,this.renderSpatialReference,a,c));b?(b.x=a[0],b.y=a[1],b.z=a[2],b.spatialReference=c):b=new d.Point(a,c);return b};u.prototype._getGraphicFromStageObject=function(a,b){var c=a.getMetadata();if(null!=c&&null!=c.layerUid){if(this.graphicsView&&c.layerUid===this.graphicsView.mockLayerId)return this.graphicsView.getGraphicFromGraphicUid(a.metadata.graphicUid);if(c=this.map.findLayerByUid(c.layerUid))return this.whenLayerView(c).then(function(c){if(c&&
!c.suspended){if(c.getGraphicFromStageObject)return c.getGraphicFromStageObject(a,b);if(c.getGraphicFromGraphicUid&&null!=a.metadata.graphicUid)return c.getGraphicFromGraphicUid(a.metadata.graphicUid)}})}return null};u.prototype._getGraphicFromPointRenderer=function(a){var b=this._computeMapPointFromVec3d(a.point),b=new m(b);a=a.metadata.layerUid;null!=a&&(a=this.map.findLayerByUid(a),b.layer=a,b.sourceLayer=a);return b};u.prototype._getGraphicFromLodRenderer=function(a){var b=a.metadata;if(null!=
b&&null!=b.layerUid){if(this.graphicsView&&b.layerUid===this.graphicsView.mockLayerId)return this.graphicsView.getGraphicFromGraphicUid(b.graphicUid);if(a=this.map.findLayerByUid(b.layerUid))return this.whenLayerView(a).then(function(a){if(a&&!a.suspended)return a.getGraphicFromGraphicUid(b.graphicUid)})}return null};u.prototype._viewingModeToManifold=function(a){switch(a){case "global":return"spherical";case "local":return"planar"}};u.prototype._initBasemapTerrain=function(a){var b=this;this._disposeBasemapTerrain();
this._set("basemapTerrain",new v(this,this._viewingModeToManifold(a)));this._set("elevationProvider",new ca({view:this}));this.elevationProvider.register("ground",this.basemapTerrain);this._handles.add([x.init(this,"map.ground.opacity",function(a){b.basemapTerrain.baseOpacity=null!=a?a:1}),x.init(this,"map.ground.surfaceColor",function(a){b.basemapTerrain.backgroundColor=a})],"basemapTerrain")};u.prototype._initGlobe=function(a){var b=this;this._initCoordinateSystem();this._initState();this._stage.setViewParams({backgroundColor:[0,
0,0,0]});this._initBasemapTerrain(a);this._set("pointsOfInterest",new ka.default({view:this}));this._set("featureTiles",new L.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,resourceController:this.resourceController}));this._handles.add(this.featureTiles.watch("updating",function(){return b._evaluateUpdating()}));this._handles.add(x.init(Z,"FEATURE_TILE_TREE_SHOW_TILES",
function(a){a&&b.featureTiles&&!b.featureTilesDebugger?b.featureTilesDebugger=new T.FeatureTileTree3DDebugger(b):!a&&b.featureTilesDebugger&&(b.featureTilesDebugger.destroy(),b.featureTilesDebugger=null)}),"feature-tiles");this._handles.add(x.init(this,["clippingArea","basemapTerrain.extent"],function(){if(b.clippingArea||b.basemapTerrain.extent)if(b.basemapTerrain.extent&&b.basemapTerrain.spatialReference){var a=E.toExtent(b.basemapTerrain.extent,b.basemapTerrain.spatialReference);b.featureTiles.filterExtent=
b.clippingArea?a.intersection(b.clippingArea):a}else b.featureTiles.filterExtent=b.clippingArea;else b.featureTiles.filterExtent=null},!0),"feature-tiles");this.stateManager.init()};u.prototype._initCoordinateSystem=function(){var a=this;if(this.spatialReference){var b=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(b)||this._set("mapCoordsHelper",new ea.default(this.map,b));var c="global"===this.viewingMode,b=c?aa.SphericalECEFSpatialReference:b;b!==this.renderSpatialReference&&
(this.renderSpatialReference=b,this._set("renderCoordsHelper",ja.RenderCoordsHelper.createMode(this.viewingMode,b)),c||this._handles.add(this.watch("basemapTerrain.extent",function(b){if(0!==b[0]||0!==b[1]||0!==b[2]||0!==b[3])a.renderCoordsHelper.extent=b},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Da.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null),this.renderSpatialReference=
null};u.prototype._evaluateUpdating=function(){var a=0,b=0,c=!1;this.allLayerViews.forEach(function(d){d.updating&&(c=!0,d=d.updatingPercentage,null!=d&&(++b,a+=d))});if(this._createGraphicsViewPromise||this.graphicsView&&this.graphicsView.updating||this.resourceController&&this.resourceController.updating||this.featureTiles&&this.featureTiles.updating||this.labeler&&this.labeler.updating)c=!0;c!==this.updating&&this._set("updating",c);a=0!==b?a/b:c?100:0;this.updatingPercentage!==a&&this._set("updatingPercentage",
a)};u.prototype._updateUpdatingMonitors=function(a){for(var b=this,c=0,d=a.removed;c<d.length;c++){var e=d[c];this._handles.remove(e.uid)}c=0;for(a=a.added;c<a.length;c++)e=a[c],e.destroyed||this._handles.add([e.watch(["updating","updatingPercentage"],this._evaluateUpdating),e.watch("suspended",function(a){return b._updateLayerViewSuspension(a)})],e.uid);this._evaluateUpdating()};u.prototype._updateLayerViewSuspension=function(a){a&&this.resourceController.setMemoryDirty()};u.prototype._disposeSurface=
function(){var a=function(a){a&&a.remove();return null};this._stageFrameTask=a(this._stageFrameTask);this._updateDrawingOrderHandle=a(this._updateDrawingOrderHandle);this.onViewExtentUpdateHandle=a(this.onViewExtentUpdateHandle);this._mapLayersChangeHandle=a(this._mapLayersChangeHandle);this.pointsOfInterest&&(this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null));this.featureTiles&&(this.featureTiles.destroy(),this._set("featureTiles",null));this._handles.remove("feature-tiles");this._handles.remove("render-coords-helper");
this._disposeBasemapTerrain();this.environmentManager&&this.environmentManager.disposeRendering()};u.prototype._disposeBasemapTerrain=function(){var a=this._get("basemapTerrain");a&&(this._handles.remove("basemapTerrain"),a.destroy(),this._set("basemapTerrain",null))};u.prototype._renderScreenshotOverlay=function(a,b){if(this.overlay&&this.overlay.hasVisibleItems){var c=a.getContext("2d");c.putImageData(b,0,0);this.overlay.renderCanvas(a);a=c.getImageData(0,0,b.width,b.height);for(c=0;c<a.data.length;c++)b.data[c]=
a.data[c]}};u.prototype._initStage=function(){var a=this,b={};b.renderContext=this.renderContext;b.deactivatedWebGLExtensions=this.deactivatedWebGLExtensions;b.viewingMode=this.viewingMode;b.alpha=this.alphaCompositingEnabled;b.supersampleScreenshots=this.supersampleScreenhotsEnabled;b.renderScreenshotOverlay=function(b,c){return a._renderScreenshotOverlay(b,c)};this.renderCanvas&&(b.canvas=this.renderCanvas);var c=new ba.SceneIntersectionHelper(this.viewingMode,{forEachLayer:function(b){var c=a._stage.getLayers();
Object.keys(c).forEach(function(a){b(c[a])})}},{camera:function(){return a.state.camera},extent:function(){return a.dataExtent},slicePlane:function(){return a.slicePlane},hasOpaqueTerrain:function(){return!!a.basemapTerrain&&a.basemapTerrain.isOpaque()}});this._set("sceneIntersectionHelper",c);this._stage=new za(this.viewingMode,e.byId(this.surface),b,c);this._handles.add(x.init(this.qualitySettings,"antialiasingEnabled",function(){a._stage.setRenderParams({antialiasingEnabled:a.qualitySettings.antialiasingEnabled})}),
"stage");b=function(){a._stage.setRenderParams({defaultHighlightOptions:ia.toEngineOptions(a.highlightOptions)})};this._handles.add(this.watch(["highlightOptions","highlightOptions.color","highlightOptions.haloOpacity","highlightOptions.fillOpacity"],b),"stage");b();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Da.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.getCanvas());this._stageFrameTask=y.addFrameTask(this._stage.getFrameTask())};
u.prototype._initSurface=function(){this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new ha.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this.resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})};u.prototype._createGraphicsViewIfNeeded=function(){this.graphicsView||this._createGraphicsViewPromise||0===this.graphics.length||(this._handles.remove("graphics-view"),this._createGraphicsViewPromise=h.safeCast(this._createGraphicsViewAsync()),
this._createGraphicsViewPromise.isFulfilled()&&(this._createGraphicsViewPromise=null),this._evaluateUpdating())};u.prototype._createGraphicsViewAsync=function(){return b(this,void 0,void 0,function(){var a,b=this;return g(this,function(c){switch(c.label){case 0:return[4,r.create(function(a){return p(["./3d/layers/GraphicsView3D"],a)})];case 1:return a=c.sent(),[4,x.whenTrueOnce(this.basemapTerrain,"ready")];case 2:return c.sent(),this._set("graphicsView",new a({view:this})),this._handles.add([x.init(this.graphicsView,
"updating",this._evaluateUpdating),x.init(this.graphicsView,"suspended",function(){return b._updateLayerViewSuspension(!0)})],this.graphicsView.mockLayerId),this._createGraphicsViewPromise=null,this._evaluateUpdating(),[2]}})})};u.prototype._disposeGraphicsView=function(){this._createGraphicsViewPromise&&(this._createGraphicsViewPromise.cancel(),this._createGraphicsViewPromise=null);this._handles.remove("graphics-view");this.graphicsView&&(this._handles.remove(this.graphicsView.mockLayerId),this.graphicsView.destroy(),
this._set("graphicsView",null))};u.prototype._initState=function(){this._set("state",new R.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}))};u.prototype._viewReadyHandler=function(a,b){var c=this;b||("global"===this.viewingMode&&(this._clippingArea=null),this._internallyReady=!0,this._initSurface(),this._handles.add(x.on(this,"graphics","change",function(){return c._createGraphicsViewIfNeeded()},function(){return c._createGraphicsViewIfNeeded()}),"graphics-view"),this._createGraphicsViewPromise&&
this._handles.remove("graphics-view"),this._evaluateUpdating(),!this._externallySet.environment&&(a=this.get("map.initialViewProperties.environment"))&&(this.environment=a),this._updateDrawingOrderHandle=this.allLayerViews.on("change",function(){return c._updateDrawingOrder()}),this._updateDrawingOrder(),this.labeler.setup(),this.environmentManager.updateReadyChange(!0),a=this._resolveWhenReady,this._resolveWhenReady=[],a.forEach(function(a){return a(c)}))};u.prototype._viewUnreadyHandler=function(a,
b){b&&(this.activeTool&&(this.activeTool.deactivate&&this.activeTool.deactivate(),this._set("activeTool",null)),this._initialDefaultSpatialReference=null,this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),this._internallyReady=!1,this.stateManager.deinit(),this._disposeSurface(),this.state.destroy(),this._set("state",null),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler&&this.labeler.dispose(),this._stage&&(this._stage.dispose(),
this._stage=null),this._handles.remove("stage"),this._set("canvas",null))};u.prototype._updateDrawingOrder=function(){var a=this.allLayerViews.length-1;this.allLayerViews.forEach(function(b,c){"drawingOrder"in b&&(b.drawingOrder=a-c)})};a([z.property({type:P,readOnly:!0,aliasOf:"state.animation"})],u.prototype,"animation",void 0);a([z.property()],u.prototype,"layerViews",void 0);a([z.property({readOnly:!0})],u.prototype,"basemapTerrain",void 0);a([z.property({readOnly:!0})],u.prototype,"elevationProvider",
void 0);a([z.property({type:c,aliasOf:"stateManager.camera"})],u.prototype,"camera",void 0);a([z.property({readOnly:!0})],u.prototype,"canvas",void 0);a([z.property({type:d.Point,aliasOf:"stateManager.center"})],u.prototype,"center",void 0);a([z.property({type:d.Extent,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],u.prototype,"clippingArea",null);a([z.property({type:O.default})],u.prototype,"constraints",void 0);a([z.property({type:d.Extent,dependsOn:["basemapTerrain.extent",
"clippingArea","map"],readOnly:!0})],u.prototype,"dataExtent",null);a([z.property({value:null})],u.prototype,"environment",null);a([z.cast("environment")],u.prototype,"castEnvironment",null);a([z.property()],u.prototype,"environmentManager",void 0);a([z.property({type:d.Extent,aliasOf:"stateManager.extent"})],u.prototype,"extent",void 0);a([z.property({type:d.ScreenPoint,readOnly:!0,aliasOf:"stateManager.screenCenter"})],u.prototype,"screenCenter",void 0);a([z.property({aliasOf:"stateManager.frustum"})],
u.prototype,"frustum",void 0);a([z.property({type:Number,readOnly:!0})],u.prototype,"fullOpacity",void 0);a([z.property({readOnly:!0})],u.prototype,"graphicsView",void 0);a([z.property({type:d.Extent,dependsOn:["basemapTerrain.extent"],readOnly:!0})],u.prototype,"groundExtent",null);a([z.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],u.prototype,"initialExtentRequired",null);a([z.property({type:Boolean,dependsOn:["state.interacting"],readOnly:!0})],u.prototype,"interacting",null);
a([z.property()],u.prototype,"map",void 0);a([z.property({readOnly:!0})],u.prototype,"mapCoordsHelper",void 0);a([z.property({aliasOf:"stateManager.padding"})],u.prototype,"padding",void 0);a([z.property({type:ka.default,readOnly:!0})],u.prototype,"pointsOfInterest",void 0);a([z.property({type:L.default,readOnly:!0})],u.prototype,"featureTiles",void 0);a([z.property({type:T.FeatureTileTree3DDebugger})],u.prototype,"featureTilesDebugger",void 0);a([z.property({type:Boolean})],u.prototype,"screenSizePerspectiveEnabled",
void 0);a([z.property({constructOnly:!0})],u.prototype,"deactivatedWebGLExtensions",void 0);a([z.property({constructOnly:!0})],u.prototype,"renderCanvas",void 0);a([z.property({readOnly:!0})],u.prototype,"state",void 0);a([z.property({readOnly:!0})],u.prototype,"inputManager",void 0);a([z.property({readOnly:!0})],u.prototype,"stateManager",void 0);a([z.property()],u.prototype,"qualityProfile",null);a([z.property({type:fa,get:function(){var a=this._get("qualitySettings");a||(a=new fa,da.apply(this.qualityProfile,
a));return a}})],u.prototype,"qualitySettings",void 0);a([z.property()],u.prototype,"slicePlane",null);a([z.property({dependsOn:["viewingMode"]})],u.prototype,"ready",void 0);a([z.property({readOnly:!0})],u.prototype,"renderCoordsHelper",void 0);a([z.property({readOnly:!0})],u.prototype,"sceneIntersectionHelper",void 0);a([z.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],u.prototype,"resolution",null);a([z.property({type:Number,aliasOf:"stateManager.scale"})],u.prototype,
"scale",void 0);a([z.property()],u.prototype,"heightModelInfo",null);a([z.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],u.prototype,"spatialReference",void 0);a([z.property({type:Boolean})],u.prototype,"isHeightModelInfoRequired",void 0);a([z.property({type:Boolean,constructOnly:!0})],u.prototype,"alphaCompositingEnabled",void 0);a([z.property({type:Boolean,constructOnly:!0})],u.prototype,"supersampleScreenhotsEnabled",void 0);a([z.property()],
u.prototype,"type",void 0);a([z.property({type:La})],u.prototype,"ui",void 0);a([z.property({type:Boolean,readOnly:!0})],u.prototype,"updating",void 0);a([z.property({type:Number,readOnly:!0})],u.prototype,"updatingPercentage",void 0);a([z.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],u.prototype,"viewingMode",null);a([z.property({type:l,aliasOf:"stateManager.viewpoint"})],u.prototype,"viewpoint",void 0);a([z.property({type:Number,aliasOf:"stateManager.zoom"})],
u.prototype,"zoom",void 0);a([z.property({type:ia})],u.prototype,"highlightOptions",void 0);return u=a([z.subclass("esri.views.SceneView")],u)}(z.declared(N,M,I,S));var va=C.vec3f64.create();return f});