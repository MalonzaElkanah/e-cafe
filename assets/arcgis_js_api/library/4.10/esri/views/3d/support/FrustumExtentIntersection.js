// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/compilerUtils ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),function(m,n,y,c,r,z,l,f,A,t,v){Object.defineProperty(n,"__esModule",{value:!0});m=.5*Math.PI;var B=m/Math.PI*180,C=m*l.earthRadius,D=.9*l.earthRadius;l=function(){function h(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);
this.planes=Array(6);this.maxSpan=0;this.center={origin:c.vec3f64.create(),direction:c.vec3f64.create()};for(a=0;4>a;a++)this.extent[a]={origin:c.vec3f64.create(),direction:c.vec3f64.create(),cap:{next:null,direction:c.vec3f64.create()}},this.planes[a]=f.plane.create();this.planes[4]=f.plane.create();this.planes[5]=f.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}h.prototype.update=function(a,p,d,q){void 0===q&&(q=!0);var b=this.extent;this.toRenderBoundingExtent(a,p,d);c.vec3.add(this.center.origin,
b[0].origin,b[2].origin);c.vec3.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);q||c.vec3.scale(this.center.direction,this.center.direction,-1);for(d=0;4>d;d++){var e=b[d];this.renderCoordsHelper.worldUpAtPosition(e.origin,e.direction);var g=b[3===d?0:d+1];e.cap.next=g.origin;t.directionFromTo(e.cap.direction,e.origin,g.origin);f.plane.fromVectorsAndPoint(e.direction,e.cap.direction,e.origin,this.planes[d]);q||c.vec3.scale(e.direction,
e.direction,-1)}f.plane.fromVectorsAndPoint(b[0].cap.direction,b[1].cap.direction,b[0].origin,this.planes[4]);q?f.plane.negate(this.planes[4],this.planes[5]):(f.plane.copy(this.planes[4],this.planes[5]),f.plane.negate(this.planes[4],this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));this.maxSpanSpatialReference=p};h.prototype.isVisibleInFrustum=function(a,c){void 0===c&&(c=!1);if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isWGS84?
B:C))return!0;if(a.altitude>=D)return this.isVisibleInFrustumGlobal(a)}for(var d=0;d<this.extent.length;d++){var b=this.extent[d];if(!c&&a.intersectsRay(f.ray.wrap(b.origin,b.direction))||a.intersectsLineSegment(f.lineSegment.fromPoints(b.origin,b.cap.next,E),b.cap.direction))return!0}c=c?this.planes:this.planesWithoutFar;for(d=0;d<a.lines.length;d++)if(b=a.lines[d],A.frustumLineSegment(c,b.origin,b.endpoint,b.direction))return!0;return!1};h.prototype.toRenderBoundingExtentGlobal=function(a,p,d){z.center(a,
g);g[2]=d;v.computeLinearTransformation(p,g,u,this.renderCoordsHelper.spatialReference);c.mat4.invert(w,u);r.empty(b);for(var f=0,h=F;f<h.length;f++)for(var e=h[f],l=e.x0,m=e.x1,n=e.y0,e=e.y1,k=0;5>k;k++){var x=k/4;g[0]=t.lerp(a[l],a[m],x);g[1]=t.lerp(a[n],a[e],x);g[2]=d;v.vectorToVector(g,p,g,this.renderCoordsHelper.spatialReference);c.vec3.transformMat4(g,g,w);r.expandPointInPlace(b,g)}c.vec3.set(this.extent[0].origin,b[0],b[1],b[2]);c.vec3.set(this.extent[1].origin,b[3],b[1],b[2]);c.vec3.set(this.extent[2].origin,
b[3],b[4],b[2]);c.vec3.set(this.extent[3].origin,b[0],b[4],b[2]);for(k=0;4>k;++k)c.vec3.transformMat4(this.extent[k].origin,this.extent[k].origin,u)};h.prototype.toRenderBoundingExtentLocal=function(a,b,d){c.vec3.set(this.extent[0].origin,a[0],a[1],d);c.vec3.set(this.extent[1].origin,a[2],a[1],d);c.vec3.set(this.extent[2].origin,a[2],a[3],d);c.vec3.set(this.extent[3].origin,a[0],a[3],d)};h.prototype.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,
b,c);break;case "local":this.toRenderBoundingExtentLocal(a,b,c);break;default:y.neverReached(this.renderCoordsHelper.type)}};h.prototype.isVisibleInFrustumGlobal=function(a){if(0>c.vec3.dot(this.center.direction,a.direction))return!0;for(var b=0;4>b;b++)if(0>c.vec3.dot(this.extent[b].direction,a.direction))return!0;return!1};return h}();n.FrustumExtentIntersection=l;var F=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],g=c.vec3f64.create(),u=c.mat4f64.create(),
w=c.mat4f64.create(),b=r.create(),E=f.lineSegment.create();n.default=l});