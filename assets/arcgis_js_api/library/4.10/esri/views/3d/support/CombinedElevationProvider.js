// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../layers/graphics/ElevationQuery ./Evented".split(" "),function(u,v,m,h,w,x,n,p,g,q,r,t){return function(k){function c(b){var a=k.call(this)||this;a.providers={im:[],ground:[],scene:[]};
a.handles=new Map;a.elevationChange=function(b){a.emit("elevation-change",b)};return a}m(c,k);c.prototype.getElevation=function(b,a){var d=-Infinity,e=!0;"scene"===a&&(d=this._updateElevation(d,this.providers.im,b,a),isFinite(d)&&(e=!1));e&&(d=this._updateElevation(d,this.providers.ground,b,a));"scene"===a&&(d=this._updateElevation(d,this.providers.scene,b,a));return isFinite(d)?d:null};c.prototype._updateElevation=function(b,a,d,e){for(var c=0;c<a.length;c++){var l=a[c].getElevation(d,e);null!=l&&
(b=Math.max(l,b))}return b};c.prototype.queryElevation=function(b,a,d){var c=this;void 0===a&&(a=0);this._elevationService||(this._elevationService=new r.ElevationQuery(this.view.spatialReference,function(){return c.view.map&&c.view.map.ground},{maximumAutoTileRequests:4}));var f=p.createResolver();(q.isPoint(b)?this._elevationService.queryElevation(b.x,b.y,a):this._elevationService.queryElevation(b[0],b[0],a)).then(function(a){"scene"===d&&(a=c._updateElevation(a,c.providers.scene,b,d));f.resolve(isFinite(a)?
a:null)}).catch(function(){return f.resolve(c.getElevation(b))});return f.promise};c.prototype.register=function(b,a){this.handles.set(a,a.on("elevation-change",this.elevationChange));this.providers[b].push(a)};c.prototype.unregister=function(b){this.handles.has(b)&&(this.handles.get(b).remove(),this.handles.delete(b));for(var a=0,c=Object.keys(this.providers);a<c.length;a++){var e=c[a],f=this.providers[e].indexOf(b);-1<f&&this.providers[e].splice(f,1)}};h([g.property({constructOnly:!0})],c.prototype,
"view",void 0);h([g.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],c.prototype,"spatialReference",void 0);return c=h([g.subclass("esri.views.3d.support.CombinedElevationProvider")],c)}(g.declared(n,t.Evented))});