// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/gl-matrix ../geometryUtils ../mathUtils ../stack ./ray".split(" "),function(E,e,x,y,z,d,A,k,f,l){function m(a){return a?{radius:a.radius,center:d.vec3f64.clone(a.center)}:{radius:1,center:d.vec3f64.create()}}function n(a,b){void 0===b&&(b=m());return p(a.radius,a.center,b)}function p(a,b,c){void 0===c&&(c=m());d.vec3.copy(c.center,b);c.radius=a;return c}function h(a,
b,c){var e=d.vec3.subtract(f.sv3d.get(),b.origin,a.center),g=d.vec3.dot(b.direction,b.direction),h=2*d.vec3.dot(b.direction,e);a=d.vec3.dot(e,e)-a.radius*a.radius;a=h*h-4*g*a;if(0>a)return!1;e=Math.sqrt(a);a=(-h-e)/(2*g);g=(-h+e)/(2*g);if(0>a||g<a&&0<g)a=g;if(0>a)return!1;c&&d.vec3.add(c,b.origin,d.vec3.scale(f.sv3d.get(),b.direction,a));return!0}function q(a,b,c){var e=f.sv3d.get(),g=f.sm4d.get();d.vec3.cross(e,b.origin,b.direction);d.vec3.cross(c,e,b.origin);d.vec3.scale(c,c,1/d.vec3.length(c)*
a.radius);a=r(a,b.origin);b=A.vector.angle(b.origin,c);d.mat4.identity(g);d.mat4.rotate(g,g,b+a,e);d.vec3.transformMat4(c,c,g);return c}function t(a,b,c){b=d.vec3.subtract(f.sv3d.get(),b,a.center);b=d.vec3.scale(f.sv3d.get(),b,a.radius/d.vec3.length(b));return d.vec3.add(c,b,a.center)}function r(a,b){b=d.vec3.subtract(f.sv3d.get(),b,a.center);b=d.vec3.length(b);return k.acos(a.radius/(a.radius+Math.abs(a.radius-b)))}function u(a,b,c,e){a=d.vec3.subtract(f.sv3d.get(),b,a.center);switch(c){case 0:return a=
k.cartesianToSpherical(a,f.sv3d.get()),a=a[2],d.vec3.set(e,-Math.sin(a),Math.cos(a),0);case 1:return a=k.cartesianToSpherical(a,f.sv3d.get()),c=a[1],a=a[2],b=Math.sin(c),d.vec3.set(e,-b*Math.cos(a),-b*Math.sin(a),Math.cos(c));case 2:return d.vec3.normalize(e,a);default:x.neverReached(c)}}function v(a,b){b=d.vec3.subtract(f.sv3d.get(),b,a.center);return d.vec3.length(b)-a.radius}Object.defineProperty(e,"__esModule",{value:!0});var B=y.getLogger("esri.views.3d.support.geometryUtils.sphere");e.create=
m;e.wrap=function(a,b){var c=C.get();c.radius=a;c.center=b||w;return c};e.copy=n;e.fromValues=p;e.elevate=function(a,b,c){a!==c&&d.vec3.copy(c.center,a.center);c.radius=a.radius+b;return c};e.setExtent=function(a,b,c){B.error("sphere.setExtent is not yet supported");return a===c?c:n(a,c)};e.intersectRay=h;e.intersectScreen=function(a,b,c,d){b=l.fromScreenAtEye(b,c,D);return h(a,b,d)};e.intersectsRay=function(a,b){return h(a,b,null)};e.intersectRayClosestSilhouette=function(a,b,c){if(h(a,b,c))return c;
a=q(a,b,f.sv3d.get());d.vec3.add(c,b.origin,d.vec3.scale(f.sv3d.get(),b.direction,d.vec3.distance(b.origin,a)/d.vec3.length(b.direction)));return c};e.closestPointOnSilhouette=q;e.closestPoint=function(a,b,c){if(h(a,b,c))return c;l.closestPoint(b,a.center,c);return t(a,c,c)};e.projectPoint=t;e.distanceToSilhouette=function(a,b){b=d.vec3.subtract(f.sv3d.get(),b,a.center);b=d.vec3.squaredLength(b);return Math.sqrt(Math.abs(b-a.radius*a.radius))};e.angleToSilhouette=r;e.axisAt=u;e.altitudeAt=v;e.setAltitudeAt=
function(a,b,c,e){var g=v(a,b);a=u(a,b,2,f.sv3d.get());c=d.vec3.scale(f.sv3d.get(),a,c-g);d.vec3.add(e,b,c);return e};var C=new z.ObjectStack(function(){return{center:null,radius:0}}),D=l.create(),w=d.vec3f64.create();Object.freeze(w)});