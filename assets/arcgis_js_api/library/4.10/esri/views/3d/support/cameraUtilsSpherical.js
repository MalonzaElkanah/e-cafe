// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),function(J,k,b,G,w,H,B,C,m){function D(e,a,d,l){void 0===l&&(l=B.createDirectionUp());b.vec3.cross(q,e,E);0===b.vec3.dot(q,q)&&b.vec3.cross(q,e,F);b.mat4.identity(n);b.mat4.rotate(n,n,-m.deg2rad(a),e);b.mat4.rotate(n,n,-m.deg2rad(d),q);a=l.up;d=l.direction;b.vec3.cross(a,q,
e);b.vec3.normalize(a,a);b.vec3.transformMat4(a,a,n);b.vec3.normalize(d,e);b.vec3.negate(d,d);b.vec3.transformMat4(d,d,n);return l}function z(e){var a=e[1];e[1]=-e[2];e[2]=a}function A(e,a){a=D(a,e.heading,e.tilt);e.up=a.up;return e}Object.defineProperty(k,"__esModule",{value:!0});var E=b.vec3f64.fromValues(0,0,1),F=b.vec3.normalize(b.vec3f64.create(),b.vec3f64.fromValues(1,1,1)),I=new m.Cyclical(-180,180),n=b.mat4f64.create(),q=b.vec3f64.create(),p=b.vec3f64.create();k.headingTiltToDirectionUp=D;
k.directionToHeadingTilt=function(e,a,d,l){var c=q;b.vec3.normalize(c,e);b.vec3.cross(p,c,E);0===b.vec3.dot(p,p)&&b.vec3.cross(p,c,F);b.vec3.cross(p,p,c);return B.directionToHeadingTilt(a,d,l,c,p)};k.eyeForCenterWithHeadingTilt=function(e,a,d,l){var c={eye:b.vec3f64.create(),up:null,tilt:l,heading:d},g=q;g[0]=e[0];g[1]=e[2];g[2]=-e[1];d=m.deg2rad(d);var f=m.deg2rad(l);l=Math.sin(d);d=Math.cos(d);var h=Math.sin(f),x=Math.cos(f),u=b.vec3.length(g);if(1E-8>Math.abs(f))f=a+u;else var v=u/h,k=m.asin(a/
v),f=v*Math.sin(Math.PI-f-k);var v=h*a,x=x*a,k=d*v,n=f-x,p=n*n,y=a*a*h*h,h=d*d*y,y=l*l*y,r=g[1]*n,t=h*(h+p-g[1]*g[1]);if(0>t)return b.vec3.scale(c.eye,g,f/u),c.tilt=0,c;var w=Math.sqrt(t),t=h+p,r=0<d?-w+r:w+r;if(1E-8>Math.abs(t))return 1E-8>u?(c.eye[0]=0,c.eye[1]=0,c.eye[2]=a):b.vec3.scale(c.eye,g,f/u),c.tilt=0,z(c.eye),A(c,e);c.eye[1]=r/t;t=c.eye[1]*c.eye[1];a=1-t;r=Math.sqrt(a);k=h*t+y-2*k*c.eye[1]*r*n+a*p;if(1E-8>Math.abs(k))return b.vec3.scale(c.eye,g,f/u),c.tilt=0,z(c.eye),A(c,e);c.eye[0]=(a*
(f*g[0]-x*g[0])-v*r*(g[0]*c.eye[1]*d+g[2]*l))/k;c.eye[2]=(a*(f*g[2]-x*g[2])-v*r*(g[2]*c.eye[1]*d-g[0]*l))/k;b.vec3.scale(c.eye,c.eye,f);z(c.eye);return A(c,e)};k.lookAtTiltToEyeTilt=function(e,a,d){e=b.vec3.length(e);a=m.asin(a/(Math.sqrt(a*a+e*e-2*a*e*Math.cos(Math.PI-d))/Math.sin(d)));return m.rad2deg(d-a)};k.eyeTiltToLookAtTilt=function(e,a,d){d=m.deg2rad(d);e=b.vec3.length(e);return m.asin(a/(e/Math.sin(d)))+d};k.toExtent=function(e,a,d,b,c){function g(a){var b=Math.PI/2;a=m.cyclical2PI.normalize(a,
-b);a>b&&(a=Math.PI-a);return a}var f;f=a.latitude;a=a.longitude;var h=C.getLonDeltaForDistance(a,f,d)/2;d=a-h;a+=h;f=m.deg2rad(f);h=C.earthRadius;f=(1+Math.sin(f))/(1-Math.sin(f));var k=(f+1)*Math.tan(b/h/2);f=1.5*Math.PI-2*Math.atan(.5*(k+Math.sqrt(4*f+k*k)));b=f+b/h;f=g(f);b=g(b);b<f&&(h=b,b=f,f=h);f=Math.max(m.rad2deg(f),-90);b=Math.min(m.rad2deg(b),90);a=I.monotonic(d,a);180<a-d&&(h=(a-d-180)/2,d+=h,a-=h);c?(c.xmin=d,c.ymin=f,c.xmax=a,c.ymax=b,c.spatialReference=w.WGS84):c=new G(d,f,a,b,w.WGS84);
e.spatialReference&&e.spatialReference.isWebMercator&&H.geographicToWebMercator(c,!1,c);return c}});