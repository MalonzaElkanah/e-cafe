// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/Point ../PropertiesPool ./PointOfInterest".split(" "),function(c,h,m,f,n,p,d,g,k,q,r){Object.defineProperty(h,"__esModule",{value:!0});var t=Array;c=function(c){function a(b){b=c.call(this,b)||this;b.propertiesPool=new q.default({location:k,
renderLocation:t},b);b.estimatedSurfaceAltitude=0;b.pendingElevationQuery=null;b.renderLocation=g.vec3f64.create();return b}m(a,c);a.prototype.initialize=function(){var b=this;this.measureSurfaceAltitudeThrottle=n.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);this.measureSurfaceAltitude();var a=function(){return b.measureSurfaceAltitudeThrottle()};this.map&&this.handles.add([p.on(this.map,"ground.layers","change",a,
a,a)])};a.prototype.destroy=function(){this.cancelPendingRequest()};Object.defineProperty(a.prototype,"location",{get:function(){var b=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,b,this.state.spatialReference);return b},enumerable:!0,configurable:!0});a.prototype.update=function(b){this.measureSurfaceAltitudeThrottle();this.updateCameraOnSurface()};a.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCameraOnSurface()};
a.prototype.hasPendingUpdates=function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()||!!this.pendingElevationQuery};a.prototype.cancelPendingRequest=function(){var b=this.pendingElevationQuery;b&&(this.pendingElevationQuery=null,b.cancel())};a.prototype.measureSurfaceAltitude=function(){var b=this;this.cancelPendingRequest();if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,l,this.state.spatialReference);var a=this.map.ground.queryElevation(l).then(function(a){b.updateSurfaceAltitude(a.geometry.z)}).catch(function(a){a&&
"cancel"===a.dojoType||b.updateSurfaceAltitude(0)}).catch(function(){}).then(function(){b.pendingElevationQuery===a&&(b.pendingElevationQuery=null)});a.isFulfilled()||(this.pendingElevationQuery=a)}else this.updateSurfaceAltitude(0)};a.prototype.updateSurfaceAltitude=function(a){this.estimatedSurfaceAltitude!==a&&(this.estimatedSurfaceAltitude=a,this.updateCameraOnSurface())};a.prototype.updateCameraOnSurface=function(){g.vec3.copy(e,this.state.camera.eye);this.renderCoordsHelper.setAltitude(this.estimatedSurfaceAltitude,
e);var a=this._get("renderLocation");a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]||this._set("renderLocation",g.vec3.copy(this.propertiesPool.get("renderLocation"),e))};a.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;f([d.property({constructOnly:!0})],a.prototype,"altitudeEstimationInterval",void 0);f([d.property({readOnly:!0,dependsOn:["renderLocation"]})],a.prototype,"location",null);f([d.property({constructOnly:!0})],a.prototype,"map",void 0);f([d.property({readOnly:!0})],a.prototype,"renderLocation",void 0);
return a=f([d.subclass("esri.views.3d.support.CameraOnSurface")],a)}(d.declared(r.PointOfInterest));h.CameraOnSurface=c;var e=g.vec3f64.create(),l=new k;h.default=c});