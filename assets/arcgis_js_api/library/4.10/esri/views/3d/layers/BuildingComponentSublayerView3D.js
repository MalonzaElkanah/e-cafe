// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../support/graphicUtils ./BuildingSublayerView3D ./I3SMeshView3D ./i3s/I3SUtil ../../layers/support/popupUtils".split(" "),function(v,w,x,n,d,p,k,l,f,c,q,r,m,t,u){return function(g){function a(){var b=null!==g&&g.apply(this,
arguments)||this;b._elevationContext="scene";b._isIntegratedMesh=!1;b.demolishedFilterField=null;b.progressiveLoadFactor=1;return b}n(a,g);a.prototype.initialize=function(){var b=this;this._layerUid=this.layer.layer.uid;this.watch("demolishedFilterField",function(){return b._filterChange()})};Object.defineProperty(a.prototype,"lodFactor",{get:function(){return this.get("view.qualitySettings.sceneService.3dObject.lodFactor")||1},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"additionalRequiredFields",
{get:function(){return k.isSome(this.demolishedFilterField)?[this.demolishedFilterField]:null},enumerable:!0,configurable:!0});a.prototype._createLayerGraphic=function(b){b=new p(null,null,b);b.layer=this.layer.layer;b.sourceLayer=this.layer;return b};a.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};a.prototype.isUpdating=function(){return!(!this._controller||!this._controller.updating)};a.prototype.fetchPopupFeatures=function(b,
a){if(b=this._validateFetchPopupFeatures())return f.reject(b);if(!a||0===a.length)return f.resolve([]);var c=[],e=[];b=u.getRequiredFields(this.layer);for(var h=0;h<a.length;h++){var d=a[h];q.hasRequiredFields(d,b)?c.push(d):e.push(d)}return 0===e.length?f.resolve(c):this.whenGraphicAttributes(e,b).catch(function(){return e}).then(function(b){return c.concat(b)})};a.prototype._validateFetchPopupFeatures=function(){var b=this.layer,a=b.popupTemplate;if(!b.popupEnabled)return new l("buildingscenelayerview3d:fetchPopupFeatures",
"Popups are disabled",{layer:b});if(!a)return new l("buildingscenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:b})};a.prototype.getFilters=function(){var b=this,a=this.inherited(arguments);if(k.isSome(this.demolishedFilterField)){var c=this.demolishedFilterField;a.push(function(a,d){return b._filterNonNull(a,d,c)})}return a};a.prototype._filterNonNull=function(a,c,d){var b=c.attributeInfo.attributeData[d];null!=b&&m.filterInPlace(a,c.featureIds,function(a){return null==
t.getCachedAttributeValue(b,a)})};d([c.property({dependsOn:["_controller.updating"]})],a.prototype,"updating",void 0);d([c.property({dependsOn:["_controller.rootNodeVisible"]})],a.prototype,"suspended",void 0);d([c.property({readOnly:!0})],a.prototype,"lodFactor",null);d([c.property({type:String})],a.prototype,"demolishedFilterField",void 0);d([c.property({type:[String],readOnly:!0,dependsOn:["demolishedFilterField"]})],a.prototype,"additionalRequiredFields",null);return a=d([c.subclass("esri.views.3d.layers.BuildingComponentSublayerView3D")],
a)}(c.declared(r,m))});