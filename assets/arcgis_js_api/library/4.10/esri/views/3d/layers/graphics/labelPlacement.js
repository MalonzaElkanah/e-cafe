// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ./graphicUtils ../../webgl-engine/materials/HUDMaterial".split(" "),function(m,n,v,w,x,h,y,p,z){function q(a){a=a.graphics3DGraphic.graphic.geometry.type;switch(a){case "polyline":case "polygon":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return f["above-center"];
case "mesh":return f["above-center"];default:v.neverReached(a)}}function l(a,c){null==g&&(A.log(a,c),g=x.schedule(function(){g.remove();g=null}))}function r(a,c,b){b=b.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace(B);b=h.vec3f64.fromValues(b[3]-b[0],b[4]-b[1],b[5]-b[2]);a.centerOffset[0]=1.1*Math.max(b[0],b[1])/2*c.normalizedOffset[0];var e=b[2]/2*c.normalizedOffset[1]+a.translation[2];a.translation[2]=e*(1.1-1);a.elevationOffset=e;b=h.vec3.length(b);a.centerOffset[2]=1.1*b/2*c.normalizedOffset[2]}
function C(a){var c=a.labelClass.labelPlacement,b=a.labelSymbol,e=a.graphics3DGraphic,d=p.getGraphics3DSymbol(e.graphics3DSymbol).symbol;a=f[c]||q(a);if("point-3d"===d.type&&d.supportsCallout()&&d.hasVisibleVerticalOffset()&&!e.isDraped())return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:t(d.verticalOffset),anchor:null,normalizedOffset:null};if(b&&b.hasVisibleVerticalOffset()&&("point-3d"!==d.type||!d.supportsCallout()||!d.verticalOffset||e.isDraped())){a:switch(a.placement){case "above-center":e=
!0;break a;default:e=!1}if(e)return{placement:"above-center",verticalOffset:t(b.verticalOffset),anchor:"bottom",normalizedOffset:[0,a.normalizedOffset[1],0],hasLabelVerticalOffset:!0};l("error","Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+c+" placement)");return null}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function t(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,
maxWorldLength:a.maxWorldLength}}Object.defineProperty(n,"__esModule",{value:!0});var A=w.getLogger("esri.views.3d.layers.graphics.labelPlacement"),g=null;n.get=function(a){var c=C(a);if(!c)return null;var b;if(c.anchor)b=c;else{var e=a.labelClass.labelPlacement,d=f[e];b=d||q(a);e&&!d&&l("warn","the requested label placement '"+e+"' is not currently supported in SceneView");e=a.graphics3DGraphic.graphic.geometry.type;d=a.labelClass.labelPlacement;switch(e){case "polyline":case "polygon":case "extent":case "multipoint":d&&
(l("warn","the requested label placement '"+b.placement+"' is currently unsupported for '"+e+"' geometries in SceneView"),b=f["center-center"])}}var e=a.graphics3DGraphic._graphics[0],d=e.graphics3DSymbolLayer.getGraphicElevationContext(a.graphics3DGraphic.graphic),g=!!c.hasLabelVerticalOffset,c={anchor:b.anchor,needsOffsetAdjustment:"draped"===e.type?void 0:d.hasOffsetAdjustment,verticalOffset:c.verticalOffset,screenOffset:h.vec2f64.create(),centerOffset:h.vec4f64.fromValues(0,0,0,-1),centerOffsetUnits:"world",
translation:h.vec3f64.create(),elevationOffset:0,hasLabelVerticalOffset:g};switch(a.graphics3DGraphic.graphic.geometry.type){case "point":e=a.graphics3DGraphic;d=p.getGraphics3DSymbol(e.graphics3DSymbol).symbol.symbolLayers.getItemAt(0);e.getCenterObjectSpace(c.translation);switch(d.type){case "icon":case "text":d=a.graphics3DGraphic;e=d._graphics[0].getScreenSize();d.isDraped()?c.hasLabelVerticalOffset||"center"===c.anchor||(f[a.labelClass.labelPlacement]&&l("warn","the requested placement '"+b.placement+
"' is currently unsupported for draped graphics"),c.anchor="center"):(d=void 0,void 0===d&&(d=D),a=a.graphics3DGraphic._graphics[0].stageObject.getGeometryRecords()[0].material,a instanceof z?(a=a.getParams().anchorPos,d[0]=2*(a[0]-.5),d[1]=2*(a[1]-.5)):(d[0]=0,d[1]=0),a=d,k[0]=e[0]/2*(b.normalizedOffset[0]-a[0]),k[1]=e[1]/2*(b.normalizedOffset[1]-a[1]),c.screenOffset[0]=k[0],c.hasLabelVerticalOffset?(c.centerOffset[1]=k[1],c.centerOffsetUnits="screen"):c.screenOffset[1]=k[1]);break;case "object":r(c,
b,a)}break;case "mesh":r(c,b,a)}return c};var f={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",
normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},u={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],
"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};m=function(a){var c=f[a];u[a].forEach(function(a){f[a]=c})};for(var E in u)m(E);Object.freeze&&(Object.freeze(f),Object.keys(f).forEach(function(a){Object.freeze(f[a]);Object.freeze(f[a].normalizedOffset)}));
var k=[0,0],D=[0,0],B=y.create()});