// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/Logger ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingBox ../../../tasks/support/Query ./I3SMeshView3D ./LayerView3D ./i3s/I3SQueryEngine ./i3s/I3SUtil ./support/layerViewUpdatingProperties ./support/PopupSceneLayerView ../support/projectionUtils".split(" "),function(z,
A,B,h,d,k,l,m,c,f,n,p,q,r,t,u,v,w){var x=l.getLogger("esri.views.3d.layers.SceneLayerView3D");(function(){return function(){}})();return function(g){function a(){var b=null!==g&&g.apply(this,arguments)||this;b._queryEngine=null;b.progressiveLoadFactor=1;b._elevationContext="scene";b._isIntegratedMesh=!1;return b}h(a,g);Object.defineProperty(a.prototype,"lodFactor",{get:function(){return this.get("view.qualitySettings.sceneService.3dObject.lodFactor")||1},enumerable:!0,configurable:!0});a.prototype.initialize=
function(){var b=this;this.handles.add(m.init(this.layer,"rangeInfos",function(a){return b._rangeInfosChanged(a)}))};a.prototype.destroy=function(){};a.prototype._rangeInfosChanged=function(b){null!=b&&0<b.length&&x.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};a.prototype.queryExtent=function(b){return this._ensureQueryEngine().queryExtent(b)};a.prototype.queryFeatureCount=function(b){return this._ensureQueryEngine().queryFeatureCount(b)};
a.prototype.queryFeatures=function(b){return this._ensureQueryEngine().queryFeatures(b)};a.prototype.queryObjectIds=function(b){return this._ensureQueryEngine().queryObjectIds(b)};a.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};a.prototype._createQueryEngine=function(){var b=this,a={id:0,index:0,meta:null,bbCorners:new Float64Array(24)};return new r(this.layer,{forAll:function(y,e){b._forAllFeatures(function(e,c,
d){a.id=e;a.index=c;a.meta=d;b._boundingBoxCornerPoints(c,d.engineObject,a.bbCorners);y(a)},e)},createGraphic:function(a){return b._createGraphic(a.index,a.meta)},requestFields:function(a,e,c){return t.whenGraphicAttributes(b.layer,e,b._getObjectIdField(),c,function(c){var e=b._getGraphicIndices(a,c);return[{node:a,indices:e,graphics:c}]},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){return b._createExtentBuilder()}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})};
a.prototype._createExtentBuilder=function(){var a=this.view.renderSpatialReference,c=this.view.spatialReference,d=f.empty(),e=new Float64Array(24);return{add:function(b){w.bufferToBuffer(b.bbCorners,a,0,e,c,0,8)&&f.expandWithBuffer(d,e,0,8)},getExtent:function(){return f.toExtent(d,c)}}};a.prototype.highlight=function(a,c){void 0===c&&(c={});var b=this._highlights;if(a instanceof n){var e=b.acquireSet(c),d=e.set,e=e.handle;this.queryObjectIds(a).then(function(a){return b.setFeatureIds(d,a)});return e}return this.inherited(arguments)};
a.prototype._createLayerGraphic=function(a){a=new k(null,null,a);a.layer=this.layer;a.sourceLayer=this.layer;return a};a.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};a.prototype.isUpdating=function(){return!(!this._controller||!this._controller.updating)};d([c.property()],a.prototype,"layer",void 0);d([c.property({dependsOn:["_controller.updating"]})],a.prototype,"updating",void 0);d([c.property({dependsOn:["_controller.rootNodeVisible"]})],
a.prototype,"suspended",void 0);d([c.property(u.updatingPercentage)],a.prototype,"updatingPercentage",void 0);d([c.property({readOnly:!0})],a.prototype,"lodFactor",null);d([c.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],a.prototype,"updatingPercentageValue",void 0);return a=d([c.subclass("esri.views.3d.layers.SceneLayerView3D")],a)}(c.declared(q,p,v.PopupSceneLayerView))});