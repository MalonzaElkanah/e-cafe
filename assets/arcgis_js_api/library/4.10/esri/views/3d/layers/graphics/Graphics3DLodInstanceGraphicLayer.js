// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../webgl-engine/lib/HighlightUtils".split(" "),function(n,F,G,w,x,g,h,y,z,A,B){n=function(){function c(b,a,c,d){this.type="lod-instance";this.alignedTerrainElevation=0;this.needsElevationUpdates=
!1;this.graphics3DSymbolLayer=b;this.instanceIndex=a;this.elevationAligner=c;this.elevationContext=new z(d)}c.prototype.initialize=function(b,a){};c.prototype.setVisibility=function(b){var a=this.lodRenderer.instanceData;return b!==a.getVisible(this.instanceIndex)?(a.setVisible(this.instanceIndex,b),!0):!1};c.prototype.destroy=function(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};c.prototype.alignWithElevation=
function(b,a,c){this.elevationAligner&&(y.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),b=this.elevationAligner(this,this.elevationContext,b,a),null!=b&&(this.alignedTerrainElevation=b))};c.prototype.getBSRadius=function(){var b=this.lodRenderer;return b.baseBoundingSphere.radius*b.instanceData.getCombinedScaleFactor(this.instanceIndex)};c.prototype.getCenterObjectSpace=function(b){void 0===b&&(b=g.vec3f64.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,
l);return g.vec3.transformMat4(b,this.lodRenderer.baseBoundingSphere.center,l)};c.prototype.getBoundingBoxObjectSpace=function(b){void 0===b&&(b=h.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,l);var a=this.lodRenderer.baseBoundingBox;h.empty(b);for(var c=0;8>c;++c)g.vec3.set(d,0===(c&1)?a[0]:a[3],0===(c&2)?a[1]:a[4],0===(c&4)?a[2]:a[5]),g.vec3.transformMat4(d,d,l),h.expandPointInPlace(b,d);return b};c.prototype.getProjectedBoundingBox=function(b,c,C,D){return x(this,
void 0,void 0,function(){var a,u,q,e,r,t,f,p,n;return w(this,function(m){switch(m.label){case 0:a=this.getBoundingBoxObjectSpace(D);u=E;q=h.isPoint(a)?1:u.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,l);for(e=0;e<q;e++)r=u[e],d[0]=a[r[0]],d[1]=a[r[1]],d[2]=a[r[2]],g.vec3.transformMat4(d,d,l),k[3*e+0]=d[0],k[3*e+1]=d[1],k[3*e+2]=d[2];if(!b(k,0,q))return[2,null];h.empty(a);t=null;this.calculateRelativeScreenBounds&&(t=this.calculateRelativeScreenBounds());for(e=0;e<3*q;e+=
3){for(f=0;3>f;f++)a[f]=Math.min(a[f],k[e+f]),a[f+3]=Math.max(a[f+3],k[e+f]);t&&C.push({location:k.slice(e,e+3),screenSpaceBoundingRect:t})}if(!c)return[3,5];h.center(a,v);if("absolute-height"===this.elevationContext.mode)return[3,5];p=void 0;n=A.demResolutionForBoundingBox(a,c);m.label=1;case 1:return m.trys.push([1,3,,4]),[4,c.service.queryElevation(v[0],v[1],n)];case 2:return p=m.sent(),[3,4];case 3:return m.sent(),p=null,[3,4];case 4:null!=p&&h.offset(a,0,0,-this.alignedTerrainElevation+p),m.label=
5;case 5:return[2,a]}})})};c.prototype.addHighlight=function(b,a){var c=this;a=B.generateHighlightId();this.addHighlightId(a);b.addExternal(function(a){c.removeHighlightId(a)},a)};c.prototype.removeHighlight=function(b){this.highlights&&this.highlights.forEach(function(a){return b.remove(a)})};c.prototype.addHighlightId=function(b){this.highlights=this.highlights||new Set;this.highlights.add(b);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};c.prototype.removeHighlightId=function(b){this.highlights&&
(this.highlights.delete(b),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this.highlights.size),0===this.highlights.size&&(this.highlights=null))};Object.defineProperty(c.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0});return c}();var k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],d=g.vec3f64.create(),v=g.vec3f64.create(),E=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],l=g.mat4f64.create();
return n});