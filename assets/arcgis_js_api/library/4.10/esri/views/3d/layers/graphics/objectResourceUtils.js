// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/arrayUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(v,g,w,m,n,p,f,q,r,t){function u(b){var a=b.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return{fileType:a?"gltf":"wosr",url:a?a[1]:b,specifiedLodIndex:a&&null!=a[4]?Number(a[4]):null}}function l(b,a){void 0===
a&&(a=0);var d,e=b.lods[a];b={stageResources:{textures:[],materials:[],geometries:[]},pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:e.boundingBox,lodThreshold:e.lodThreshold};a=0;for(e=e.components;a<e.length;a++){var c=e[a];b.stageResources.geometries.push(c.geometry);b.stageResources.materials.push(c.material);(d=b.stageResources.textures).push.apply(d,c.textures);b.numberOfVertices+=c.geometry.vertexCount}b.stageResources.geometries=f.unique(b.stageResources.geometries);b.stageResources.materials=
f.unique(b.stageResources.materials);b.stageResources.textures=f.unique(b.stageResources.textures);return b}Object.defineProperty(g,"__esModule",{value:!0});g.fetch=function(b,a){void 0===a&&(a={});return n(this,void 0,void 0,function(){var d,e,c,f,g,h;return m(this,function(k){switch(k.label){case 0:d=u(b);if("gltf"!==d.fileType)return[3,2];a.materialParamsMixin=p({textureAlphaCutoff:.1},a.materialParamsMixin);e=new q.DefaultLoadingContext(a.streamDataSupplier);return[4,r.load(e,d.url,a)];case 1:return c=
k.sent(),f=c.lods[0].boundingBox,null!=d.specifiedLodIndex?(g=Math.min(d.specifiedLodIndex,c.lods.length-1),[2,{lods:[l(c,g)],referenceBoundingBox:f}]):[2,{lods:c.lods.map(function(a,b){return l(c,b)}),referenceBoundingBox:f}];case 2:return[4,t.load(d.url,a)];case 3:return h=k.sent(),[2,{lods:[h],referenceBoundingBox:h.boundingBox}]}})})}});