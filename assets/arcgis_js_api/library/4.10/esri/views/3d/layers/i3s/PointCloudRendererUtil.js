// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader".split(" "),function(B,m,x,y,z,A){function v(a){var b=0,g=0;for(a=a?a:[];g<a.length;g++)b|=1<<a[g];return b}function w(a,b){for(var g=0;g<a.length;g++){var d=a[g];if(d.name===b&&null!=d.attributeValues&&"UInt8"===d.attributeValues.valueType&&3===d.attributeValues.valuesPerElement)return{storageInfo:d,useElevation:!1}}return null}
function n(a,b){for(var g=0;g<a.length;g++){var d=a[g];if(d.name===b)return a="embedded-elevation"===d.encoding,{storageInfo:a?null:d,useElevation:a}}return"elevation"===b.toLowerCase()?{storageInfo:null,useElevation:!0}:null}function u(a,b,g,d){if(a&&a.useElevation){a=new Float64Array(d);for(b=0;b<d;b++)a[b]=g[3*b+2];return a}return a&&b?A.readBinaryAttribute(a.storageInfo,b,d):null}function q(a){return null==a||"none"===a?null:"low-four-bit"===a?function(a){return a&15}:"high-four-bit"===a?function(a){return(a&
240)>>4}:"absolute-value"===a?function(a){return Math.abs(a)}:"modulo-ten"===a?function(a){return a%10}:null}Object.defineProperty(m,"__esModule",{value:!0});m.getRendererInfo=function(a){var b=a.renderer,g=b&&b.type,d=b&&a.renderer.toJSON()||null,l=null,c=!1;"point-cloud-unique-value"===g?l=n(a.attributeStorageInfo,b.field):"point-cloud-stretch"===g?l=n(a.attributeStorageInfo,b.field):"point-cloud-class-breaks"===g?l=n(a.attributeStorageInfo,b.field):(l="point-cloud-rgb"===g?w(a.attributeStorageInfo,
b.field):w(a.attributeStorageInfo,"RGB"),c=null!=l);g=null;b&&b.colorModulation&&(g=n(a.attributeStorageInfo,b.colorModulation.field));return{rendererJSON:d,isRGBRenderer:c,primaryAttribute:l,modulationAttribute:g}};m.getFilterInfo=function(a){var b=a.filters;return b?b.map(function(b){return{filterJSON:b.toJSON(),attributeInfo:n(a.attributeStorageInfo,b.field)}}):[]};m.evaluateRenderer=function(a,b,g,d,l){var c=a.rendererJSON,h=a.isRGBRenderer,k=a.modulationAttribute;a=u(a.primaryAttribute,b,d,l);
g=u(k,g,d,l);k=d=null;if(a&&h)d=a;else if(a&&"pointCloudUniqueValueRenderer"===c.type){var k=z.fromJSON(c),f=k.colorUniqueValueInfos;d=new Uint8Array(3*l);h=q(k.fieldTransformType);for(c=0;c<l;c++){b=h?h(a[c]):a[c];b+="";for(var e=0;e<f.length;e++)if(0<=f[e].values.indexOf(b)){d[3*c]=f[e].color.r;d[3*c+1]=f[e].color.g;d[3*c+2]=f[e].color.b;break}}}else if(a&&"pointCloudStretchRenderer"===c.type)for(k=y.fromJSON(c),f=k.stops,d=new Uint8Array(3*l),h=q(k.fieldTransformType),c=0;c<l;c++)if(b=h?h(a[c]):
a[c],e=f.length-1,b<f[0].value)d[3*c]=f[0].color.r,d[3*c+1]=f[0].color.g,d[3*c+2]=f[0].color.b;else if(b>=f[e].value)d[3*c]=f[e].color.r,d[3*c+1]=f[e].color.g,d[3*c+2]=f[e].color.b;else for(e=1;e<f.length;e++){if(b<f[e].value){b=(b-f[e-1].value)/(f[e].value-f[e-1].value);d[3*c]=f[e].color.r*b+f[e-1].color.r*(1-b);d[3*c+1]=f[e].color.g*b+f[e-1].color.g*(1-b);d[3*c+2]=f[e].color.b*b+f[e-1].color.b*(1-b);break}}else if(a&&"pointCloudClassBreaksRenderer"===c.type)for(k=x.fromJSON(c),f=k.colorClassBreakInfos,
d=new Uint8Array(3*l),h=q(k.fieldTransformType),c=0;c<l;c++)for(b=h?h(a[c]):a[c],e=0;e<f.length;e++){if(b>=f[e].minValue&&b<=f[e].maxValue){d[3*c]=f[e].color.r;d[3*c+1]=f[e].color.g;d[3*c+2]=f[e].color.b;break}}else for(d=new Uint8Array(3*l),c=0;c<d.length;c++)d[c]=255;if(g&&k&&k.colorModulation)for(a=k.colorModulation.minValue,k=k.colorModulation.maxValue,c=0;c<l;c++)b=g[c],h=b>=k?1:b<=a?.3:.3+.7*(b-a)/(k-a),d[3*c]*=h,d[3*c+1]*=h,d[3*c+2]*=h;return d};m.filterInPlace=function(a,b,g,d){var l=a.length/
3;d=d.map(function(b,c){return u(g[c].attributeInfo,b,a,l)});for(var c=0,h=0;h<l;h++){for(var k=!0,f=0;f<g.length&&k;f++){var e=g[f].filterJSON,p=d[f][h];switch(e.type){case "pointCloudValueFilter":var m="exclude"===e.mode;-1!==e.values.indexOf(p)===m&&(k=!1);break;case "pointCloudBitfieldFilter":m=v(e.requiredSetBits);e=v(e.requiredClearBits);if((p&m)!==m||0!==(p&e))k=!1;break;case "pointCloudReturnFilter":for(var n=p&15,r=p>>>4&15,p=1<r,m=1===n,n=n===r,r=!1,q=0,e=e.includedReturns;q<e.length;q++){var t=
e[q];if("last"===t&&n||"firstOfMany"===t&&m&&p||"lastOfMany"===t&&n&&p||"single"===t&&!p){r=!0;break}}r||(k=!1)}}k&&(a[3*c]=a[3*h],a[3*c+1]=a[3*h+1],a[3*c+2]=a[3*h+2],b[3*c]=b[3*h],b[3*c+1]=b[3*h+1],b[3*c+2]=b[3*h+2],c++)}return c};m.getSplatSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"splat"===a.type?a:null};m.getFixedSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"fixed-size"===a.type?a:null};m.rendererUsesFixedSizes=function(a){return(a=a&&a.pointSizeAlgorithm)&&
a.type?"fixed-size"===a.type:!1}});