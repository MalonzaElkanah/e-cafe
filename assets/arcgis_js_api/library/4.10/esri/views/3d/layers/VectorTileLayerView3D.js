// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./TiledLayerView3D ../../vectorTiles/SchemaHelper ../../vectorTiles/TileHandler ../../vectorTiles/renderers/Renderer".split(" "),function(r,t,k,f,g,l,d,m,n,p,q){return function(h){function a(c){return h.call(this)||this}k(a,h);a.prototype.initialize=function(){var c=this,b;b=this._getTileInfoSupportError(this.layer.compatibleTileInfo256,
this.layer.fullExtent);var a;b?this.addResolvingPromise(g.reject(b)):a=l.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){var a=c.view.basemapTerrain.tilingScheme,b=a.pixelSize[0];c.schemaHelper=new n(b,c.view.spatialReference.isWGS84);b=256===b?c.layer.compatibleTileInfo256:c.view.spatialReference.isWGS84?c.layer.compatibleTileInfo512:c.layer.tileInfo;if(a=c._getTileInfoCompatibilityError(b,a))throw a;c.tileInfo=b;c._updateMinMaxDataLevel()});var e=null;b=this._initializeTileHandler();
this.tileHandler=b[0];this.renderer=b[1];e=b[2];this.watch("layer.currentStyleInfo",function(){var a,b,d;e.isFulfilled()||e.cancel();a=c._initializeTileHandler();b=a[0];d=a[1];e=a[2];e.then(function(){var a=c.tileHandler;c.renderer=d;c.tileHandler=b;c.emit("data-changed");a.destroy()})});a=g.all([a,e]);this.addResolvingPromise(a)};a.prototype.destroy=function(){this.renderer=null;this.tileHandler.destroy();this.tileHandler=null};a.prototype._initializeTileHandler=function(){var a=new p(this.layer,
1,!1,null),b=new q,d=a.start();d.then(function(){b.initialize(a.spriteMosaic,a.glyphMosaic,!1)});return[a,b,d]};f([d.property({aliasOf:"layer.fullExtent"})],a.prototype,"fullExtent",void 0);f([d.property()],a.prototype,"layer",void 0);f([d.property()],a.prototype,"updatingPercentageValue",void 0);return a=f([d.subclass("esri.views.3d.layers.VectorTileLayerView3D")],a)}(d.declared(m))});