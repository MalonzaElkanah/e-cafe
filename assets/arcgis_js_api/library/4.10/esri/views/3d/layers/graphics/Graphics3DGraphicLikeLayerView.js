// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/assignHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DScaleVisibility ./Graphics3DSpatialIndex ./graphicUtils".split(" "),
function(z,A,l,e,h,m,n,g,p,c,q,r,t,u,v,w,x,y){return function(k){function a(b){b=k.call(this)||this;b.graphicsCore=null;b.elevationAlignment=new v;b.handles=new n;b.suspendResumeExtent=null;return b}l(a,k);a.prototype.normalizeCtorArgs=function(b){var a=null;b.scaleVisibilityEnabled&&(b=h({},b),delete b.scaleVisibilityEnabled,a=new w);var d=new u({owner:b.owner,layer:b.layer,basemapTerrain:b.owner.view.basemapTerrain,asyncUpdates:!1,graphicSymbolSupported:!0});return h({},b,{graphicsCore:d,scaleVisibility:a})};
a.prototype.initialize=function(){var b=this;this._set("spatialIndex",new x({spatialReference:this.owner.view.spatialReference}));this.scaleVisibility&&"minScale"in this.layer&&this.handles.add(this.layer.watch(["minScale","maxScale"],function(){return b.scaleVisibility.layerMinMaxScaleChangeHandler()}));this.idleClients=[this.scaleVisibility,this.graphicsCore,this.elevationAlignment]};a.prototype.setup=function(){var b=this;this.elevationAlignment.setup(this.owner,function(a,d,f){return b.spatialIndex.queryGraphicUIDsInExtent(a,
d,f)},this.graphicsCore,this.view.elevationProvider);this.scaleVisibility&&"minScale"in this.layer&&this.scaleVisibility.setup(this.owner,this.layer,function(a,d,f){return b.spatialIndex.queryGraphicUIDsInExtent(a,d,f)},this.graphicsCore,this.owner.view.basemapTerrain);this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,spatialIndex:this.spatialIndex,scaleVisibility:this.scaleVisibility});this.handles.add(this.view.watch("clippingArea",function(){return b.updateClippingExtent()}));
this.updateClippingExtent();this.setupSuspendResumeExtent();this.handles.add(this.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return b.needsIdleUpdate()},idleFrame:function(a){return b.idleUpdate(a)}}));this.graphicsCore.startCreateGraphics()};a.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",null));this.scaleVisibility&&(this.scaleVisibility.destroy(),
this._set("scaleVisibility",null));this.graphicsCore&&(this.graphicsCore.destroy(),this._set("graphicsCore",null));this.spatialIndex&&(this.spatialIndex.destroy(),this._set("spatialIndex",null))};Object.defineProperty(a.prototype,"suspended",{get:function(){return!(!this.scaleVisibility||!this.scaleVisibility.suspended)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.scaleVisibility&&this.scaleVisibility.updating)},
enumerable:!0,configurable:!0});a.prototype.getGraphicFromGraphicUid=function(b){var a=this,d=null;this.owner.loadedGraphics&&this.owner.loadedGraphics.some(function(f){return f.uid===b?(d=r.hydrateGraphic(f,a.layer instanceof q?a.layer:null),!0):!1});return g.create(function(b,a){null!==d?b(d):a()})};a.prototype.whenGraphicBounds=function(b,a){return this.spatialIndex?this.graphicsCore?this.graphicsCore.whenGraphicBounds(b,a):g.reject():g.reject()};a.prototype.needsIdleUpdate=function(){for(var b=
0,a=this.idleClients;b<a.length;b++){var d=a[b];if(d&&d.needsIdleUpdate())return!0}return!1};a.prototype.idleUpdate=function(a){for(var b=0,d=this.idleClients;b<d.length;b++){var c=d[b];if(c&&c.needsIdleUpdate()&&(c.idleUpdate(a),a.done()))break}};a.prototype.updateClippingExtent=function(){this.graphicsCore.setClippingExtent(this.view.clippingArea,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()};a.prototype.setupSuspendResumeExtent=function(){var a=this;this.scaleVisibility&&
p.init(this.graphicsCore,"computedExtent",function(b){a.suspendResumeExtent=y.enlargeExtent(b,a.suspendResumeExtent,t.SUSPEND_RESUME_EXTENT_OPTIMISM);a.scaleVisibility.setExtent(a.suspendResumeExtent)},!0)};e([c.property({constructOnly:!0})],a.prototype,"owner",void 0);e([c.property({constructOnly:!0})],a.prototype,"layer",void 0);e([c.property({readOnly:!0,aliasOf:"owner.view"})],a.prototype,"view",void 0);e([c.property({constructOnly:!0})],a.prototype,"graphicsCore",void 0);e([c.property({readOnly:!0})],
a.prototype,"spatialIndex",void 0);e([c.property({constructOnly:!0})],a.prototype,"scaleVisibility",void 0);e([c.property({readOnly:!0})],a.prototype,"elevationAlignment",void 0);e([c.property({readOnly:!0,dependsOn:["scaleVisibility.suspended"]})],a.prototype,"suspended",null);e([c.property({readOnly:!0,dependsOn:["graphicsCore.updating","scaleVisibility.updating"]})],a.prototype,"updating",null);return a=e([c.subclass("esri.views.3d.layers.graphics.Graphics3DGraphicLikeLayerView")],a)}(c.declared(m))});