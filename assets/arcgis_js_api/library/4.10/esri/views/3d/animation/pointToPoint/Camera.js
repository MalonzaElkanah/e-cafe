// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/libs/gl-matrix-2/gl-matrix","../../support/mathUtils"],function(t,u,c,p){Object.defineProperty(u,"__esModule",{value:!0});var q=p.angle,r=p.lerp,x=p.slerp,g=c.vec3f64.create(),f=c.vec3f64.create(),k=c.vec3f64.create(),d=c.vec3f64.create(),h=c.vec3f64.create(),m=c.vec3f64.create(),l=c.vec3f64.fromValues(0,0,1),v=c.vec3f64.fromValues(0,1,0),n=c.vec3f64.fromValues(1,0,0),w=c.mat3f64.create();t=function(){function e(a){void 0===a&&(a="global");this.viewingMode=
a;this.center=c.vec3f64.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=c.vec3f64.clone(v)}e.prototype.pixelsPerPanAtZoom=function(a){return this.size/2/(this._zoomToPanScale*a)};e.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};e.prototype.pixelsPerRotateAtZoom=function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};e.prototype.compareTo=function(a,b){b||(b={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var d=
c.vec3.length(this.center),e=c.vec3.length(a.center),d=(d+e)/2;b.pan=q(this.center,a.center)*d}else b.pan=c.vec3.distance(this.center,a.center);d=Math.abs(a.yaw-this.yaw);d>=Math.PI&&(d=2*Math.PI-d);b.rotate=Math.max(d,Math.abs(a.pitch-this.pitch));b.sourceZoom=this.distance;b.targetZoom=a.distance;return b};e.prototype.interpolate=function(a,b,d){"global"===this.viewingMode?x(a.center,b.center,d.pan,this.center):c.vec3.lerp(this.center,a.center,b.center,d.pan);this.distance=r(a.distance,b.distance,
d.zoom);this.pitch=r(a.pitch,b.pitch,d.rotate);a=a.yaw;b=b.yaw;Math.abs(b-a)>=Math.PI&&(a+=2*(a<b?1:-1)*Math.PI);this.yaw=r(a,b,d.rotate)};e.prototype.copyFrom=function(a){c.vec3.copy(this.center,a.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;c.vec3.copy(this.lookAtDirection,a.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};e.prototype.copyFromRenderCamera=function(a){var b=this._lookAtOrientation(a.center,w);c.vec3.copy(this.center,a.center);
c.vec3.subtract(d,a.center,a.eye);c.vec3.transformMat3(d,d,b);c.vec3.transformMat3(h,a.up,b);this.distance=c.vec3.length(d);d[0]/=this.distance;d[1]/=this.distance;d[2]/=this.distance;this.pitch=this._eyeUpToPitch(d,h);this.yaw=this._eyeUpToYaw(d,h);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};e.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};e.prototype.copyToRenderCamera=function(a){var b=this._lookAtOrientation(this.center,
w);c.mat3.transpose(b,b);this._axisAngleVec3(n,this.pitch-Math.PI/2,v,d);this._axisAngleVec3(l,this.yaw,d);this._axisAngleVec3(n,this.pitch-Math.PI/2,l,h);this._axisAngleVec3(l,this.yaw,h);c.vec3.scale(d,d,this.distance);c.vec3.transformMat3(d,d,b);c.vec3.transformMat3(h,h,b);a.center=this.center;a.eye=c.vec3.subtract(d,this.center,d);a.up=h};e.prototype._axisAngleVec3=function(a,b,d,e){void 0===e&&(e=d);var h=Math.cos(b);b=Math.sin(b);c.vec3.scale(g,d,h);c.vec3.cross(f,a,d);c.vec3.scale(f,f,b);c.vec3.scale(k,
a,(1-h)*c.vec3.dot(a,d));return c.vec3.add(e,c.vec3.add(e,g,f),k)};e.prototype._lookAtOrientation=function(a,b){this._upAtLookAt(a,k);c.vec3.cross(g,this.lookAtDirection,k);c.vec3.normalize(g,g);0===g[0]&&0===g[1]&&0===g[2]&&c.vec3.copy(g,n);c.vec3.cross(f,k,g);c.vec3.normalize(f,f);b||(b=c.mat3f64.create());b[0]=g[0];b[1]=f[0];b[2]=k[0];b[3]=g[1];b[4]=f[1];b[5]=k[1];b[6]=g[2];b[7]=f[2];b[8]=k[2];return b};e.prototype._upAtLookAt=function(a,b){return"local"===this.viewingMode?c.vec3.copy(b,l):c.vec3.normalize(b,
a)};e.prototype._eyeUpToPitch=function(a,b){return Math.PI-q(l,a)};e.prototype._eyeUpToYaw=function(a,b){.5>Math.abs(b[2])?(c.vec3.copy(m,b),0<a[2]&&c.vec3.scale(m,m,-1)):c.vec3.copy(m,a);c.vec3.cross(f,m,l);c.vec3.normalize(f,f);return q(n,f,l)};return e}();u.default=t});