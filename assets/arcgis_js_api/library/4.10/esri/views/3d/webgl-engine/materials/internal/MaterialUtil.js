// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../../../geometry/support/aaBoundingBox ../../../support/mathUtils ../../lib/ComponentUtils ../../lib/doublePrecisionUtils ../../lib/screenSizePerspectiveUtils ../../lib/Util".split(" "),function(ha,f,h,l,aa,K,ba,C,L){function M(a,b,c,d,g){var e=N(b,c,O);l.setMin(n,a.getBBMin());l.setMax(n,a.getBBMax());if(r(n,b,e,d)){var e=a.getPrimitiveIndices(),k=a.getIndices(),f=a.getPosition(),h=e?e.length:k.length/3;if(h>ca&&(a=a.getChildren(),
void 0!==a)){for(e=0;8>e;++e)void 0!==a[e]&&M(a[e],b,c,d,g);return}y(b,c,0,h,k,f,e,g)}}function y(a,b,c,d,g,e,f,h){var k=e.data,I=e.offsetIdx;e=e.strideIdx;var n=a[0],t=a[1];a=a[2];var B=b[0]-n,l=b[1]-t;for(b=b[2]-a;c<d;c++){var r=f?f[c]:c,p=I+e*g[3*r],v=I+e*g[3*r+1],w=I+e*g[3*r+2],x=k[p],z=k[p+1],A=k[p+2],p=k[v]-x,D=k[v+1]-z,v=k[v+2]-A,E=k[w]-x,F=k[w+1]-z,w=k[w+2]-A,m=l*w-F*b,u=b*E-w*B,y=B*F-E*l,q=p*m+D*u+v*y,x=n-x,G=t-z,H=a-A,z=G*v-D*H,A=H*p-v*x,J=x*D-p*G;if(q>P){m=x*m+G*u+H*y;if(0>m||m>q)continue;
u=B*z+l*A+b*J;if(0>u||m+u>q)continue}else if(q<-P){m=x*m+G*u+H*y;if(0<m||m<q)continue;u=B*z+l*A+b*J;if(0<u||m+u<q)continue}else continue;q=(E*z+F*A+w*J)/q;0<=q&&(p=Q(p,D,v,E,F,w,ea),h(q,p,r))}}function Q(a,b,c,d,g,e,k){h.vec3.set(R,a,b,c);h.vec3.set(S,d,g,e);h.vec3.cross(k,R,S);h.vec3.normalize(k,k);return k}function N(a,b,c){return h.vec3.set(c,1/(b[0]-a[0]),1/(b[1]-a[1]),1/(b[2]-a[2]))}function r(a,b,c,d){var g=(a[0]-d-b[0])*c[0],e=(a[3]+d-b[0])*c[0],k=Math.min(g,e),g=Math.max(g,e),e=(a[1]-d-b[1])*
c[1],f=(a[4]+d-b[1])*c[1],k=Math.max(k,Math.min(e,f)),g=Math.min(g,Math.max(e,f));if(k>g)return!1;e=(a[2]-d-b[2])*c[2];a=(a[5]+d-b[2])*c[2];k=Math.max(k,Math.min(e,a));g=Math.min(g,Math.max(e,a));return k<=g}function T(a,b){b=b?T(b):{};for(var c in a){var d=a[c];d&&d.forEach&&(d=fa(d));null==d&&c in b||(b[c]=d)}return b}function fa(a){var b=[];a.forEach(function(a){return b.push(a)});return b}Object.defineProperty(f,"__esModule",{value:!0});var U=h.mat4f64.create(),n=l.create(),V=L.VertexAttrConstants;
f.IDENTITY=h.mat4f64.create();f.intersectTriangleGeometry=function(a,b,c,d,g,e,f){L.assert("triangle"===a.data.primitiveType);b=b&&b.componentVisibilities;d=d.tolerance;if(1<a.componentCount){c=N(g,e,O);var k=a.boundingInfo;l.setMin(n,k.getBBMin());l.setMax(n,k.getBBMax());if(r(n,g,c,d))for(var h=a.data,k=a.componentCount,da=h.getIndices(V.POSITION),C=h.getAttribute(V.POSITION),h=h.componentOffsets,t=0;t<k;t++)if(!b||K.getVisibility(b,t)){var B=a.getComponentAABB(t,n);r(B,g,c,d)&&y(g,e,h[t]/3,h[t+
1]/3,da,C,void 0,f)}}else b&&!K.getVisibility(b,0)||M(a.boundingInfo,g,e,d,f)};var O=h.vec3f64.create(),P=Math.pow(2,-52),ea=h.vec3f64.create();f.intersectTriangles=y;var R=h.vec3f64.create(),S=h.vec3f64.create();f.computeNormal=Q;f.intersectAabbInvDir=r;f.transformToWorld=function(a,b,c){return h.vec4.set(c,a[0]-b[0],a[1]-b[1],a[2]-b[2],1)};f.transformToView=function(a,b,c,d){h.mat4.translate(U,c,b);c=U;return h.vec4.transformMat4(d,a,c)};f.transformToProjection=function(a,b,c,d){d[0]=a[0]+c[0];
d[1]=a[1]+c[1];d[2]=a[2]+c[2];d[3]=a[3];return h.vec4.transformMat4(d,d,b)};f.transformToNDC=function(a,b){return h.vec4.scale(b,a,1/Math.abs(a[3]))};f.applyScreenSizePerspectiveScale=function(a,b,c,d,g){return C.scale(a,d,c,g)};f.verticalOffsetAtDistance=function(a,b,c,d,g){var e=c.screenLength||0;g&&(e=C.scale(e,d,b,g));return aa.clamp(e*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*b,c.minWorldLength||0,null!=c.maxWorldLength?c.maxWorldLength:Infinity)};f.aquireIfNotUndefined=function(a,b,c){if(void 0!==
a)return b.aquire(a,c)};f.releaseIfNotUndefined=function(a,b){void 0!==a&&b.release(a)};var W=h.mat4f32.create();f.bindView=function(a,b,c){h.mat4.translate(W,b,a);c.setUniform3fv("localOrigin",a);c.setUniformMatrix4fv("view",W)};f.bindCamPos=function(a,b,c){c.setUniform3f("camPos",b[3]-a[0],b[7]-a[1],b[11]-a[2])};var X=h.vec3f64.create(),Y=h.vec3f64.create();f.bindViewOriginDouble=function(a,b){ba.encodeDoubleArraySplit(a,X,Y,3);b.setUniform3fv("viewOriginHi",X);b.setUniform3fv("viewOriginLo",Y)};
var Z=h.vec3f64.create();f.bindSlicePlane=function(a,b,c){h.vec3.subtract(Z,b.origin,a);c.setUniform3fv("slicePlaneOrigin",Z);c.setUniform3fv("slicePlaneBasis1",b.basis1);c.setUniform3fv("slicePlaneBasis2",b.basis2)};f.bindVerticalOffset=function(a,b,c){if(a){var d=b.fovY,g=b.viewport[3],e=void 0;void 0===e&&(e=ga);e.screenLength=a.screenLength;e.perDistance=Math.tan(.5*d)/(.5*g);e.minWorldLength=a.minWorldLength;e.maxWorldLength=a.maxWorldLength;a=e;c.setUniform4f("verticalOffset",a.screenLength*
(b.pixelRatio||1),a.perDistance,a.minWorldLength,a.maxWorldLength)}};f.bindScreenSizePerspective=function(a,b,c,d){void 0===d&&(d="screenSizePerspectiveAlignment");if(a){var g=a.parameters;c.setUniform4f(d,g.divisor,g.offset,g.minPixelSize*(b.pixelRatio||1),a.paddingPixelsOverride)}};f.copyParameters=T;f.updateParameters=function(a,b){var c=!1,d;for(d in b){var g=b[d];void 0!==g&&(c=!0,Array.isArray(g)?a[d]=g.slice():a[d]=g)}return c};(function(a){function b(a){return(a.shadowMappingEnabled?1:0)|
(a.ssaoEnabled?2:0)}a.create=function(a,d){for(var c=[],e=0;2>e;e++)for(var f=0;2>f;f++){var h=b({shadowMappingEnabled:1===e,ssaoEnabled:1===f}),l=b({shadowMappingEnabled:1===e,ssaoEnabled:1===f&&a.receiveSSAO});c[h]=c[l]||d({receiveShadows:1===e,receiveSSAO:1===f&&a.receiveSSAO})}return{programs:c.filter(function(a){return null!=a}),byParameter:c}};a.lookup=function(a,d){return a.byParameter[b(d)]};a.programs=function(a){return a.programs}})(f.BindParametersMap||(f.BindParametersMap={}));f.colorMixModes=
{multiply:1,ignore:2,replace:3,tint:4};var ca=1E3,ga={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}});