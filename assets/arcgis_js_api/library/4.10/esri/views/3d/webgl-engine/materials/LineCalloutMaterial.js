// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/LineCalloutPrograms".split(" "),function(l,z,m,h,r,t,u,g,k,f,n){function p(c,a,b){3===b.length?c.setUniform4f(a,b[0],b[1],b[2],1):c.setUniform4fv(a,b)}l=function(c){function a(b,e){e=c.call(this,e)||this;e.bufferWriter=new v;e.params=f.copyParameters(b,
w);e._uniqueMaterialIdentifier=a.uniqueMaterialIdentifier(e.params);return e}m(a,c);Object.defineProperty(a.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});a.prototype.dispose=function(){};a.prototype.getGLMaterials=function(){return{color:x,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};a.prototype.getAllTextureIds=function(){return[]};a.prototype.intersect=function(b,e,a,d,c,g,f,h){};a.prototype.getParameterValues=
function(){return f.copyParameters(this.params)};a.prototype.setParameterValues=function(b){f.updateParameters(this.params,b)&&(this._uniqueMaterialIdentifier=a.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};a.uniqueMaterialIdentifier=function(b){return JSON.stringify({screenOffset:b.screenOffset||[0,0],centerOffsetUnits:b.centerOffsetUnits||"world"})};return a}(u);var x=function(c){function a(b,a,A){b=c.call(this,b,a)||this;b.isRenderSlot=!0;b.updateParameters();return b}
m(a,c);a.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};a.prototype.selectProgram=function(){var b=this.params;this.renderProgram=this.programRep.getProgram(n.program,{occlTest:!!b.occlusionTest,verticalOffset:!!b.verticalOffset,screenSizePerspective:!!b.screenSizePerspective,depthHud:!1,depthHudAlignStart:!!b.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===b.centerOffsetUnits,slice:b.slicePlaneEnabled});this.depthProgram=this.programRep.getProgram(n.program,
{occlTest:!!b.occlusionTest,verticalOffset:!!b.verticalOffset,screenSizePerspective:!!b.screenSizePerspective,depthHud:!0,depthHudAlignStart:!!b.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===b.centerOffsetUnits,slice:b.slicePlaneEnabled})};a.prototype.beginSlot=function(b){switch(b){case 21:return this.isRenderSlot=!0;case 22:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(a.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},enumerable:!0,
configurable:!0});a.prototype.getProgram=function(){return this.program};a.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]};a.prototype.getDrawMode=function(){return 4};a.prototype.bind=function(b,a){var e=a.cameraAboveGround?1:-1,d=this.program,c=this.params;b.bindProgram(d);d.setUniform1f("cameraGroundRelative",e);d.setUniform1f("polygonOffset",c.shaderPolygonOffset);d.setUniform4fv("viewport",a.viewport);d.setUniformMatrix4fv("viewNormal",a.viewInvTransp);d.setUniform1i("hudVisibilityTexture",
0);b.bindTexture(a.hudVisibilityTexture,0);p(d,"color",c.color);e=a.pixelRatio||1;d.setUniform1f("pixelRatio",e);d.setUniform2f("screenOffset",c.screenOffset[0]*e,c.screenOffset[1]*e);this.bindBorder(b,a);f.bindVerticalOffset(c.verticalOffset,a,d);this.bindSizing(b,a);f.bindScreenSizePerspective(c.screenSizePerspective,a,d);this.isRenderSlot?this.bindRender(b,a):this.bindHUDDepth(b,a)};a.prototype.bindRender=function(b,a){b.setBlendFunctionSeparate(1,771,770,771);b.setBlendingEnabled(!0);b.setDepthWriteEnabled(!1)};
a.prototype.bindHUDDepth=function(b,a){b.setColorMask(!1,!1,!1,!1);b.setDepthWriteEnabled(!0);b.setBlendingEnabled(!1);b.setDepthTestEnabled(!0)};a.prototype.bindView=function(b,a){b=this.program;var e=this.params;f.bindView(a.origin,a.view,b);f.bindCamPos(a.origin,a.viewInvTransp,b);e.slicePlaneEnabled&&f.bindSlicePlane(a.origin,a.slicePlane,b)};a.prototype.bindInstance=function(b,a){b=this.program;b.setUniformMatrix4fv("model",a.transformation);b.setUniformMatrix4fv("modelNormal",a.transformationNormal)};
a.prototype.release=function(b,a){this.isRenderSlot?this.releaseRender(b,a):this.releaseHUDDepth(b,a)};a.prototype.releaseRender=function(b,a){b.setBlendingEnabled(!1);b.setBlendFunction(770,771);b.setDepthWriteEnabled(!0)};a.prototype.releaseHUDDepth=function(b,a){b.setColorMask(!0,!0,!0,!0)};a.prototype.bindSizing=function(b,a){b=this.program;var c=this.params;b.setUniform2f("pixelToNDC",2/a.viewport[2],2/a.viewport[3]);b.setUniform1f("lineSize",Math.ceil(c.size)*(a.pixelRatio||1))};a.prototype.bindBorder=
function(b,a){b=this.program;var c=this.params;a=a.pixelRatio||1;null!==c.borderColor?(p(b,"borderColor",c.borderColor),b.setUniform1f("borderSize",a)):(b.setUniform4f("borderColor",0,0,0,0),b.setUniform1f("borderSize",0))};return a}(t),w={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},y=r.newLayout().vec3f(g.VertexAttrConstants.POSITION).vec3f(g.VertexAttrConstants.NORMAL).vec2f(g.VertexAttrConstants.UV0).vec4f(g.VertexAttrConstants.AUXPOS1),
q=[h.vec2f32.fromValues(0,0),h.vec2f32.fromValues(1,0),h.vec2f32.fromValues(0,1),h.vec2f32.fromValues(1,0),h.vec2f32.fromValues(1,1),h.vec2f32.fromValues(0,1)],v=function(){function c(){this.vertexBufferLayout=y}c.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};c.prototype.elementCount=function(a){return 6*a.indices[g.VertexAttrConstants.POSITION].length};c.prototype.write=function(a,b,c,f,d){k.writePosition(b.indices[g.VertexAttrConstants.POSITION],b.vertexAttr[g.VertexAttrConstants.POSITION].data,
a.transformation,f.position,d,6);k.writeNormal(b.indices[g.VertexAttrConstants.NORMAL],b.vertexAttr[g.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,f.normal,d,6);k.writeBufferVec4(b.indices[g.VertexAttrConstants.AUXPOS1],b.vertexAttr[g.VertexAttrConstants.AUXPOS1].data,f.auxpos1,d,6);for(a=0;a<q.length;++a)f.uv0.setVec(d+a,q[a])};return c}();return l});