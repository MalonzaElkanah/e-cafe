// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/MaterialUtil ../shaders/MeasurementArrowPrograms".split(" "),function(q,I,r,b,A,B,C,f,g,D){q=function(b){function a(c,a){a=b.call(this,a)||this;a.bufferWriter=new E;a.params=g.copyParameters(c,F);return a}r(a,b);a.prototype.dispose=function(){};a.prototype.getParameterValues=function(){var c=this.params;
return{width:c.width,outlineSize:c.outlineSize,outlineColor:c.outlineColor,stripeLength:c.stripeLength,stripeEvenColor:c.stripeEvenColor,stripeOddColor:c.stripeOddColor,polygonOffset:c.polygonOffset}};a.prototype.setParameterValues=function(c){g.updateParameters(this.params,c)&&this.notifyDirty("matChanged")};a.prototype.getParams=function(){return this.params};a.prototype.intersect=function(c,a,b,f,k,h,l,m){};a.prototype.getGLMaterials=function(){return{color:G,depthShadowMap:void 0,normal:void 0,
depth:void 0,highlight:void 0}};a.prototype.getAllTextureIds=function(){return[]};return a}(C);var G=function(b){function a(c,a,n){a=b.call(this,c,a)||this;a.params=g.copyParameters(c.getParams());a.selectProgram();return a}r(a,b);a.prototype.selectProgram=function(){this.program=this.programRep.getProgram(D.colorPass)};a.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};a.prototype.beginSlot=function(a){return 4===a};a.prototype.getProgram=
function(){return this.program};a.prototype.getDrawMode=function(){return 5};a.prototype.bind=function(a,b){b=this.program;a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!1);this.params.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.bindProgram(b);b.setUniform1f("width",this.params.width);b.setUniform1f("outlineSize",this.params.outlineSize);b.setUniform4fv("outlineColor",this.params.outlineColor);b.setUniform1f("stripeLength",
this.params.stripeLength);b.setUniform4fv("stripeEvenColor",this.params.stripeEvenColor);b.setUniform4fv("stripeOddColor",this.params.stripeOddColor)};a.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();g.bindView(a,b.view,c)};a.prototype.bindInstance=function(a,b){this.getProgram().setUniformMatrix4fv("model",b.transformation)};a.prototype.release=function(a){a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1)};
return a}(B),F={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1},H=A.newLayout().vec3f(f.VertexAttrConstants.POSITION).vec3f(f.VertexAttrConstants.NORMAL).vec2f(f.VertexAttrConstants.UV0).f32(f.VertexAttrConstants.AUXPOS1),l=b.vec3f64.create(),t=b.vec3f64.create(),v=b.vec3f64.create(),m=b.vec3f64.create(),w=b.vec3f64.create(),E=function(){function h(){this.vertexBufferLayout=H}h.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
h.prototype.elementCount=function(a){return 2*(a.indices[f.VertexAttrConstants.POSITION].length/2+1)};h.prototype.write=function(a,c,p,n,h){var k=c.vertexAttr[f.VertexAttrConstants.POSITION].data,g=c.vertexAttr[f.VertexAttrConstants.NORMAL].data;p=k.length/3;(c=c&&c.indices&&c.indices.position)&&c.length!==2*(p-1)&&console.warn("MeasurementArrowMaterial does not support indices");c=a.transformation;for(var q=a.invTranspTransformation,r=n.position,z=n.normal,x=n.uv0,e=a=0;e<p;++e){var d=3*e;b.vec3.set(l,
k[d],k[d+1],k[d+2]);e<p-1&&(d=3*(e+1),b.vec3.set(t,k[d],k[d+1],k[d+2]),b.vec3.set(w,g[d],g[d+1],g[d+2]),b.vec3.normalize(w,w),b.vec3.subtract(v,t,l),b.vec3.normalize(v,v),b.vec3.cross(m,w,v),b.vec3.normalize(m,m));d=b.vec3.distance(l,t);c&&q&&(b.vec3.transformMat4(l,l,c),b.vec3.transformMat4(t,t,c),b.vec3.transformMat4(m,m,q));var u=h+2*e,y=u+1;r.setVec(u,l);r.setVec(y,l);z.setVec(u,m);z.setVec(y,m);x.set(u,0,a);x.set(u,1,-1);x.set(y,0,a);x.set(y,1,1);e<p-1&&(a+=d)}n=n.auxpos1;for(e=0;e<2*p;++e)n.set(h+
e,a)};return h}();return q});