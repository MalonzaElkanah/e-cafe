// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/arrayUtils ../../../../../core/libs/gl-matrix-2/gl-matrix ../../../support/mathUtils ../../../support/buffer/typedArrayUtil".split(" "),function(T,w,M,d,z,N){function O(b,r){var f=z.acos(b.cosAngle),a=C.fwd,c=C.ortho;z.directionFromTo(a,b.position1,b.position0);b=0<d.vec3.dot(d.vec3.cross(c,b.faceNormal0,b.faceNormal1),a)?-1:1;return f*b>r}function P(b){var d=b.faces.length/3,f=b.faces;b=b.neighbors;for(var a=0,c=0;c<d;c++)var k=b[3*c+0],l=b[3*c+1],h=b[3*
c+2],m=f[3*c+0],e=f[3*c+1],n=f[3*c+2],a=a+(-1===k||m<e?1:0),a=a+(-1===l||e<n?1:0),a=a+(-1===h||n<m?1:0);for(var a=new Int32Array(4*a),g=0,c=0;c<d;c++){k=b[3*c+0];l=b[3*c+1];h=b[3*c+2];m=f[3*c+0];e=f[3*c+1];n=f[3*c+2];if(-1===k||m<e)a[g++]=m,a[g++]=e,a[g++]=c,a[g++]=k;if(-1===l||e<n)a[g++]=e,a[g++]=n,a[g++]=c,a[g++]=l;if(-1===h||n<m)a[g++]=n,a[g++]=m,a[g++]=c,a[g++]=h}return a}function Q(b){var r=b.faces.length/3,f=b.vertices.position;b=b.faces;for(var a=u.v0,c=u.v1,k=u.v2,l=new Float32Array(3*r),
h=0;h<r;h++){var m=b[3*h+1],e=b[3*h+2];f.getVec(b[3*h+0],a);f.getVec(m,c);f.getVec(e,k);d.vec3.subtract(c,c,a);d.vec3.subtract(k,k,a);d.vec3.cross(a,c,k);d.vec3.normalize(a,a);l[3*h+0]=a[0];l[3*h+1]=a[1];l[3*h+2]=a[2]}return l}Object.defineProperty(w,"__esModule",{value:!0});w.extractEdges=function(b,r,f,a){void 0===a&&(a=R);var c=b.vertices.position,k=b.vertices.componentIndex,l=z.deg2rad(a.anglePlanar);a=z.deg2rad(a.angleSignificantEdge);var h=Math.cos(a),m=Math.cos(l),e=C.edge,n=e.position0,g=
e.position1,x=e.faceNormal0,A=e.faceNormal1,q=Q(b),t=P(b),y=t.length/4;b=r.allocate(y);a=0;var u=f.allocate(y),w=0,G=0,H=0,I=M.range(0,y),B=new Float32Array(y);N.forEach(B,function(a,b,e){c.getVec(t[4*b+0],n);c.getVec(t[4*b+1],g);e[b]=d.vec3.distance(n,g)});I.sort(function(a,b){return B[b]-B[a]});for(var J=[],K=[],D=0;D<y;D++){var p=I[D],E=B[p],F=t[4*p+0],S=t[4*p+1],v=t[4*p+2],p=t[4*p+3],L=-1===p;c.getVec(F,n);c.getVec(S,g);if(L)d.vec3.set(x,q[3*v+0],q[3*v+1],q[3*v+2]),d.vec3.copy(A,x),e.componentIndex=
k.get(F),e.cosAngle=d.vec3.dot(x,A);else if(d.vec3.set(x,q[3*v+0],q[3*v+1],q[3*v+2]),d.vec3.set(A,q[3*p+0],q[3*p+1],q[3*p+2]),e.componentIndex=k.get(F),e.cosAngle=d.vec3.dot(x,A),e.cosAngle>m)continue;G+=E;H++;L||e.cosAngle<h?(r.write(b,a++,e),J.push(E)):O(e,l)&&(f.write(u,w++,e),K.push(E))}k=new Float32Array(J.reverse());l=new Float32Array(K.reverse());return{regular:{instancesData:r.trim(b,a),lodInfo:{lengths:k}},silhouette:{instancesData:f.trim(u,w),lodInfo:{lengths:l}},averageEdgeLength:G/H}};
var C={edge:{position0:d.vec3f64.create(),position1:d.vec3f64.create(),faceNormal0:d.vec3f64.create(),faceNormal1:d.vec3f64.create(),componentIndex:0,cosAngle:0},ortho:d.vec3f64.create(),fwd:d.vec3f64.create()},u={v0:d.vec3f64.create(),v1:d.vec3f64.create(),v2:d.vec3f64.create()},R={anglePlanar:4,angleSignificantEdge:35}});