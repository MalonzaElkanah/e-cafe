// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ./lib/ModelContentType ./lighting/Lightsources ./parts/Model ./parts/View".split(" "),function(n,p,e,h,k,l,m){return function(){function b(a,b,c,d){this.sceneIntersectionHelper=d;this._viewContent=[];this.container=b;this.viewingMode=a;this.model=new l;this.view=new m(b,this,this.model.getDirtySet(),c);this.view.setLighting({lights:[new k.MainLight(e.vec3f64.fromValues(.7,.7,.7)),new k.AmbientLight(e.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,
globalFactor:.5})}b.prototype.setNeedsRender=function(){this.view.setNeedsRender()};b.prototype.dispose=function(){this.view.dispose();this.model=this.view=null};b.prototype.add=function(a,b){this.model.add(a,b);"function"===typeof b.addParentStage&&b.addParentStage(this)};b.prototype.remove=function(a,b){a=this.model.remove(a,b);"function"===typeof a.removeParentStage&&a.removeParentStage(this);return a};b.prototype.notifyDirty=function(a,b,c,d){this.model.notifyDirty(a,b,c,d)};b.prototype.processDirty=
function(){var a=this.model.getDirtySet(),g=a.getDirtyMaterials();if(a.hasDirtyGeometryRecords()||g){b.DebugSettings.endFrameContentValidation&&this.model.validateContent();b.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var c=a.commitLayers(this._viewContent);(0<c[0].length+c[1].length+c[2].length||g)&&this.view.modify(c[0],c[1],c[2],g);b.DebugSettings.logDirtySet&&(console.log("RGs add: "+c[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+
c[1].map(function(a){return a.uniqueName})));a.commit();a.clearDirtyMaterials();this.view.setNeedsRender()}};b.prototype.processDirtyLayer=function(a){var b=this.model.getDirtySet(),c=b.getDirtyMaterials();a=b.commitLayers([a]);(0<a[0].length+a[1].length+a[2].length||c)&&this.view.modify(a[0],a[1],a[2],c);b.clearDirtyMaterials();this.view.setNeedsRender()};b.prototype.get=function(a,b){return this.model.get(a,b)};b.prototype.getAll=function(a){return this.model.getAll(a)};b.prototype.getCamera=function(){return this.view.getCamera()};
b.prototype.setCamera=function(a){this.view.setCamera(a)};b.prototype.getViewParams=function(a){return this.view.getViewParams(a)};b.prototype.setViewParams=function(a){this.view.setViewParams(a)};b.prototype.getLayers=function(){return this.model.getAll(h.LAYER)};b.prototype.setLighting=function(a){this.view.setLighting(a)};b.prototype.getCanvas=function(){return this.view.getCanvas()};b.prototype.setRenderParams=function(a){this.view.setRenderParams(a)};b.prototype.getRenderParams=function(){return this.view.getRenderParams()};
b.prototype.getIdleSuspend=function(){return this.view.getIdleSuspend()};b.prototype.has=function(a){return this.view.has(a)};b.prototype.getViewContent=function(){return this._viewContent.slice(0)};b.prototype.addToViewContent=function(a){for(var b=[],c=0;c<a.length;c++)-1===this._viewContent.indexOf(a[c])&&b.push(a[c]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.view.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,
b))};b.prototype.removeFromViewContent=function(a){this.processDirty();for(var b=this.model.getDirtySet(),c=this._viewContent,d=[],f=0;f<a.length;f++){var e=c.indexOf(a[f]);-1<e&&(c[e]=c[c.length-1],c.pop(),d.push(a[f]))}a=b.getResidentRenderGeometriesFilteredByLayers(d);this.view.modify([],a,[])};b.prototype.getFrameTask=function(){return this.view.getFrameTask()};b.prototype.takeScreenshot=function(a){return this.view.takeScreenshot(a)};b.prototype.addRenderPlugin=function(a,b){"intersect"in b&&
this.sceneIntersectionHelper.addIntersectionHandler(b);return this.view.renderPlugins.add(a,b)};b.prototype.removeRenderPlugin=function(a){"intersect"in a&&this.sceneIntersectionHelper.removeIntersectionHandler(a);return this.view.renderPlugins.remove(a)};b.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)};b.prototype.getRenderStats=function(){return this.view.getCombinedStats()};b.prototype.getRenderStatString=function(a){var b=this.getRenderStats(),c="";if(a){var c=
c+"\x3ctable\x3e",d;for(d in b)c+="\x3ctr\x3e\x3ctd\x3e"+d+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Math.round(b[d])+"\x3c/td\x3e\x3c/tr\x3e";c+="\x3c/table\x3e"}else for(d in b)c+=d+": "+b[d]+"\n";return c};b.prototype.getFramebufferTexture=function(a){void 0===a&&(a="color");return this.view.getFramebufferTexture(a)};b.prototype.getDrapedTextureRenderer=function(){return this.view.getDrapedTextureRenderer()};b.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};b.ModelContentType=
h;return b}()});