// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../support/geometryUtils ../../support/mathUtils ./GeometryData ./GeometryUtil ./Util".split(" "),function(I,J,E,F,a,y,G,w,B,h){var u;(function(p){var u=function(){function e(c){this.pos=c;this.mapPos=a.vec3f32.create();this.vRight=a.vec3f32.create();this.vLeft=a.vec3f32.create();this.frame={forward:a.vec3f32.create(),up:a.vec3f32.create(),right:a.vec3f32.create()};
this.rotationAxis=a.vec3f32.create();this.angle=0}e.prototype.profileSpaceToVertexSpace=function(c,d){c[0]=d[0]*this.frame.right[0]+d[1]*this.frame.up[0];c[1]=d[0]*this.frame.right[1]+d[1]*this.frame.up[1];c[2]=d[0]*this.frame.right[2]+d[1]*this.frame.up[2]};return e}();p.PathVertex=u;var m=function(){function e(){this.vertices=[];this.vertexIndices=[];this.uvIndices=this.uvs=this.normalIndices=this.normals=null}e.prototype.addVertex=function(c){this.vertices.push(a.vec2f32.clone(c));return this.vertices.length-
1};e.prototype.addNormal=function(c){this.normals||(this.normals=[],this.normalIndices=[]);this.normals.push(a.vec2f32.clone(c));return this.normals.length-1};e.prototype.addUV=function(c){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(c);return this.uvs.length-1};e.prototype.addSegment=function(c,d,b,a,f,e){void 0===b&&(b=null);void 0===a&&(a=null);void 0===f&&(f=null);void 0===e&&(e=null);this.vertexIndices.push(c);this.vertexIndices.push(d);null!==b&&null!==a&&(this.normalIndices.push(b),
this.normalIndices.push(a));null!==f&&null!==e&&(this.uvIndices.push(f),this.uvIndices.push(e))};Object.defineProperty(e.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0});e.prototype.hasNormals=function(){return null!=this.normals};e.prototype.hasUV=function(){return null!=this.uvs};e.prototype.normalize=function(){for(var c=0,d=0,b=this.vertices;d<b.length;d++)var g=b[d],c=Math.max(c,a.vec2.length(g));c=1/c;d=0;for(b=this.vertices;d<b.length;d++)g=
b[d],a.vec2.scale(g,g,c)};e.tube=function(c){void 0===c&&(c=20);for(var d=new e,b=0;b<c;++b){var g=2*b*Math.PI/c;d.addVertex(a.vec2f32.fromValues(1*Math.cos(g),1*Math.sin(g)));d.addUV(b/c)}d.addUV(1);for(b=0;b<c-1;++b)d.addSegment(b,b+1,null,null,b,b+1);d.addSegment(c-1,0,null,null,c-1,c);return d};e.line=function(c,d){var b=new e,g=d[0]-c[0],f=d[1]-c[1];b.addVertex(c);b.addVertex(d);b.addNormal(a.vec2f32.fromValues(-f,g));b.addUV(0);b.addUV(1);b.addSegment(0,1,0,0,0,1);return b};e.point=function(c){var a=
new e;a.addVertex(c);return a};e.wall=function(c,d){void 0===c&&(c=.2);void 0===d&&(d=1);var b=new e;b.addVertex(a.vec2f32.fromValues(.5*-c,0));b.addVertex(a.vec2f32.fromValues(.5*c,0));b.addVertex(a.vec2f32.fromValues(.5*c,d));b.addVertex(a.vec2f32.fromValues(.5*-c,d));b.addNormal(a.vec2f32.fromValues(0,-1));b.addNormal(a.vec2f32.fromValues(1,0));b.addNormal(a.vec2f32.fromValues(0,1));b.addNormal(a.vec2f32.fromValues(-1,0));b.addUV(0);b.addUV(1);b.addSegment(0,1,0,0,0,1);b.addSegment(1,2,1,1,0,1);
b.addSegment(2,3,2,2,0,1);b.addSegment(3,0,3,3,0,1);return b};e.strip=function(){return this.line(a.vec2f32.fromValues(-1,0),a.vec2f32.fromValues(1,0))};e.fence=function(){return this.line(a.vec2f32.fromValues(0,0),a.vec2f32.fromValues(0,1))};return e}();p.Profile=m;m=function(){return function(e,c,d,b,g,f){this.vertices=[];this.offset=a.vec3f32.create();a.vec3.copy(this.offset,f);for(f=d;f<d+b;++f){var t=new u(a.vec3f32.fromValues(e[3*f+0],e[3*f+1],e[3*f+2]));a.vec3.set(t.mapPos,c[3*f+0],c[3*f+1],
c[3*f+2]);this.vertices.push(t)}e=a.vec3f32.create();c=a.vec3f32.create();d=a.vec3f32.create();f=a.vec3f32.create();var t=a.vec3f32.create(),z=a.vec3f64.create(),l=a.vec3f32.create(),h=a.vec3f32.create(),m=a.vec3f32.create(),q=a.vec3f32.create(),n,p,r=y.plane.create(),k=this.vertices[0];a.vec3.set(l,0,1,0);a.vec3.subtract(c,this.vertices[1].pos,k.pos);n=0;p=a.vec3.length(c);a.vec3.normalize(c,c);g?(a.vec3.add(z,k.pos,this.offset),a.vec3.normalize(d,z)):a.vec3.set(d,0,0,1);B.makeOrthoBasisDirUpFallback(c,
d,l,l,t,d,.99619469809);a.vec3.copy(f,d);a.vec3.copy(q,t);a.vec3.copy(k.vRight,c);a.vec3.copy(k.vLeft,e);a.vec3.copy(k.frame.forward,c);a.vec3.copy(k.frame.up,d);a.vec3.copy(k.frame.right,t);k.vLeftLength=n;k.vRightLength=p;k.index=0;a.vec3.cross(k.rotationAxis,k.vLeft,k.vRight);a.vec3.normalize(k.rotationAxis,k.rotationAxis);k.angle=0;for(g=1;g<b;++g)k=this.vertices[g],a.vec3.copy(e,c),n=p,g<b-1&&(a.vec3.subtract(c,this.vertices[g+1].pos,k.pos),p=a.vec3.length(c),a.vec3.normalize(c,c)),a.vec3.add(h,
e,c),a.vec3.normalize(h,h),a.vec3.add(m,this.vertices[g-1].pos,f),y.plane.fromPositionAndNormal(this.vertices[g].pos,h,r),y.plane.intersectRay(r,y.ray.wrap(m,e),z)?(a.vec3.subtract(z,z,this.vertices[g].pos),a.vec3.normalize(d,z),a.vec3.cross(t,h,d),a.vec3.normalize(t,t)):B.makeOrthoBasisDirUpFallback(h,f,q,l,t,d,.99619469809),a.vec3.copy(f,d),a.vec3.copy(q,t),a.vec3.copy(k.vRight,c),a.vec3.copy(k.vLeft,e),a.vec3.copy(k.frame.forward,h),a.vec3.copy(k.frame.up,d),a.vec3.copy(k.frame.right,t),k.vLeftLength=
n,k.vRightLength=p,k.index=g,a.vec3.cross(k.rotationAxis,k.vLeft,k.vRight),a.vec3.normalize(k.rotationAxis,k.rotationAxis),a.vec3.negate(D,k.vLeft),k.angle=Math.PI-G.acos(a.vec3.dot(D,k.vRight))}}();p.Path=m;m=function(){return function(){}}();p.Extruder=m;m=function(){function a(){}a.prototype.numVertices=function(c){return c.vertices.length};a.prototype.extrude=function(c,a,b){for(var d=0;d<a.vertices.length;++d){var f=a.vertices[d];f.profileSpaceToVertexSpace(n,c);b(f.pos,n,d)}};return a}();p.SimpleExtruder=
m;m=function(){function e(c){void 0===c&&(c=1);this._segmentsPerRadian=c/Math.PI}e.prototype.getNumSegments=function(c){return Math.ceil(c*this._segmentsPerRadian)};e.prototype.numVertices=function(c){for(var a=2,b=1;b<c.vertices.length-1;++b)a+=this.getNumSegments(c.vertices[b].angle)+1;return a};e.prototype.extrude=function(c,d,b){d.vertices[0].profileSpaceToVertexSpace(n,c);b(d.vertices[0].pos,n,0);a.vec3.copy(C,n);for(var g=1;g<d.vertices.length-1;++g){var f=d.vertices[g];f.profileSpaceToVertexSpace(n,
c);var e=this.getNumSegments(f.angle);a.mat4.identity(r);a.mat4.rotate(r,r,.5*-f.angle,f.rotationAxis);a.vec3.transformMat4(A,n,r);if(0<=a.vec3.dot(A,f.vRight)){for(var h=0;h<e+1;++h)b(f.pos,n,g);a.vec3.copy(C,n)}else{a.mat4.identity(r);a.mat4.rotate(r,r,f.angle/e,f.rotationAxis);b(f.pos,A,g);a.vec3.copy(v,A);for(h=0;h<e;++h)a.vec3.transformMat4(v,v,r),b(f.pos,v,g);a.vec3.copy(C,v)}}g=d.vertices.length-1;d.vertices[g].profileSpaceToVertexSpace(n,c);b(d.vertices[g].pos,n,g)};return e}();p.RoundExtruder=
m;m=function(a){function c(){return a.call(this,1)||this}F(c,a);return c}(m);p.BevelExtruder=m;m=function(){function e(c,a,b){this.vvData=null;this._capNormalsOffset=this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this._numExtrusionVertices=this._extrusionNormalCount=this._extrusionVertexCount=0;this._profile=a;this._profile.normalize();this.path=c;this._extruder=b;this._numExtrusionVertices=b.numVertices(c);this.numVerticesTotal=a.vertices.length*this._numExtrusionVertices;this._profile.hasNormals()?
this.numNormalsTotal=this._profile.normals.length*this._numExtrusionVertices:this.numNormalsTotal=this.numVerticesTotal;this.numNormalsTotal+=2;this.originData=new Float32Array(3*this.numVerticesTotal);this.directionData=new Float32Array(4*this.numVerticesTotal);this.normalData=new Float32Array(3*this.numNormalsTotal);this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this._profile.hasUV()&&(this.numUVTotal=this._profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.buildGeometry();
this.buildTopology()}e.prototype.setVisualVariableValue=function(c){this.vvData||(this.vvData=new Float32Array(4*this.path.vertices.length));for(var a=0;a<this.path.vertices.length;++a)this.vvData[4*a+0]=c[0],this.vvData[4*a+1]=c[1]};e.queryVertexPosition=function(c,d){a.vec3.copy(c,d.direction);if(d.vvSizeEnabled){a.vec3.copy(l,d.vvSizeFactor);a.vec3.scale(l,l,d.auxpos2X);a.vec3.add(l,l,d.vvSizeOffset);var b=l,g=d.vvSizeMinSize,f=d.vvSizeMaxSize;b[0]=Math.min(Math.max(b[0],g[0]),f[0]);b[1]=Math.min(Math.max(b[1],
g[1]),f[1]);b[2]=Math.min(Math.max(b[2],g[2]),f[2]);a.vec3.multiply(c,c,l)}else a.vec3.scale(c,c,d.size);a.vec3.add(c,c,d.origin)};e.prototype.emitVertex=function(c,a,b){this.originData[3*this._extrusionVertexCount+0]=c[0];this.originData[3*this._extrusionVertexCount+1]=c[1];this.originData[3*this._extrusionVertexCount+2]=c[2];this.directionData[4*this._extrusionVertexCount+0]=a[0];this.directionData[4*this._extrusionVertexCount+1]=a[1];this.directionData[4*this._extrusionVertexCount+2]=a[2];this.directionData[4*
this._extrusionVertexCount+3]=b/(this.path.vertices.length-1);this.pathVertexData[this._extrusionVertexCount]=b;++this._extrusionVertexCount};e.prototype.emitNormal=function(c,d,b){a.vec3.normalize(l,d);this.normalData[3*this._extrusionNormalCount+0]=l[0];this.normalData[3*this._extrusionNormalCount+1]=l[1];this.normalData[3*this._extrusionNormalCount+2]=l[2];++this._extrusionNormalCount};e.prototype.buildGeometry=function(){for(var c=this.emitVertex.bind(this),d=this.emitNormal.bind(this),b=this._extrusionNormalCount=
this._extrusionVertexCount=0;b<this._profile.vertices.length;++b)this._extruder.extrude(this._profile.vertices[b],this.path,c);if(this._profile.hasNormals())for(c=0;c<this._profile.normals.length;++c)this._extruder.extrude(this._profile.normals[c],this.path,d);else for(c=0;c<this._extrusionVertexCount;++c)a.vec3.set(l,this.directionData[4*c+0],this.directionData[4*c+1],this.directionData[4*c+2]),a.vec3.normalize(l,l),this.normalData[3*this._extrusionNormalCount+0]=l[0],this.normalData[3*this._extrusionNormalCount+
1]=l[1],this.normalData[3*this._extrusionNormalCount+2]=l[2],++this._extrusionNormalCount;this._capNormalsOffset=this._extrusionNormalCount;d=this.path.vertices[0];c=this.path.vertices[this.path.vertices.length-1];this.normalData[3*this._extrusionNormalCount+0]=-d.vRight[0];this.normalData[3*this._extrusionNormalCount+1]=-d.vRight[1];this.normalData[3*this._extrusionNormalCount+2]=-d.vRight[2];++this._extrusionNormalCount;this.normalData[3*this._extrusionNormalCount+0]=c.vRight[0];this.normalData[3*
this._extrusionNormalCount+1]=c.vRight[1];this.normalData[3*this._extrusionNormalCount+2]=c.vRight[2];++this._extrusionNormalCount;if(this._profile.hasUV())for(c=0;c<this._profile.uvs.length;++c)this.uvData[2*c+0]=this._profile.uvs[c],this.uvData[2*c+1]=0};e.prototype.buildTopology=function(){var a=this._profile.numSegments,d=this._numExtrusionVertices-1,b=a*d*6;2<this._profile.vertices.length&&(b+=6*(this._profile.vertices.length-2));this._vertexIndices=new Uint32Array(b);this._normalIndices=new Uint32Array(b);
this._pathVertexIndices=new Uint32Array(b);this._profile.hasUV()&&(this._uvIndices=new Uint32Array(b));for(var g=b=0;g<a;++g){var f=this._profile.vertexIndices[2*g],e=this._profile.vertexIndices[2*g+1],h=f,l=e,m=0,n=0;this._profile.hasNormals()&&(h=this._profile.normalIndices[2*g],l=this._profile.normalIndices[2*g+1]);this._profile.hasUV()&&(m=this._profile.uvIndices[2*g],n=this._profile.uvIndices[2*g+1]);for(var q=0;q<d;++q){var p=f*this._numExtrusionVertices+q,r=f*this._numExtrusionVertices+q+1,
u=e*this._numExtrusionVertices+q+1,k=e*this._numExtrusionVertices+q,v=h*this._numExtrusionVertices+q,y=h*this._numExtrusionVertices+q+1,w=l*this._numExtrusionVertices+q+1,A=l*this._numExtrusionVertices+q,x=m,C=m,B=n,D=n;this._vertexIndices[3*b+0]=p;this._vertexIndices[3*b+1]=r;this._vertexIndices[3*b+2]=u;this._pathVertexIndices[3*b+0]=this.pathVertexData[p];this._pathVertexIndices[3*b+1]=this.pathVertexData[r];this._pathVertexIndices[3*b+2]=this.pathVertexData[u];this._normalIndices[3*b+0]=v;this._normalIndices[3*
b+1]=y;this._normalIndices[3*b+2]=w;this._vertexIndices[3*b+3]=p;this._vertexIndices[3*b+4]=u;this._vertexIndices[3*b+5]=k;this._pathVertexIndices[3*b+3]=this.pathVertexData[p];this._pathVertexIndices[3*b+4]=this.pathVertexData[u];this._pathVertexIndices[3*b+5]=this.pathVertexData[k];this._normalIndices[3*b+3]=v;this._normalIndices[3*b+4]=w;this._normalIndices[3*b+5]=A;this._profile.hasUV()&&(this._uvIndices[3*b+0]=x,this._uvIndices[3*b+1]=C,this._uvIndices[3*b+2]=B,this._uvIndices[3*b+3]=x,this._uvIndices[3*
b+4]=B,this._uvIndices[3*b+5]=D);b+=2}}if(2<this._profile.vertices.length)for(a=this._profile.vertices.length-2,f=0,d=f*this._numExtrusionVertices+0,f=(f+1)*this._numExtrusionVertices-1,q=0;q<a;++q)e=q+1,g=e*this._numExtrusionVertices+0,e=(e+1)*this._numExtrusionVertices-1,l=q+2,h=l*this._numExtrusionVertices+0,l=(l+1)*this._numExtrusionVertices-1,this._vertexIndices[3*b+0]=d,this._vertexIndices[3*b+1]=g,this._vertexIndices[3*b+2]=h,this._normalIndices[3*b+0]=this._capNormalsOffset+0,this._normalIndices[3*
b+1]=this._capNormalsOffset+0,this._normalIndices[3*b+2]=this._capNormalsOffset+0,this._pathVertexIndices[3*b+0]=this.pathVertexData[d],this._pathVertexIndices[3*b+1]=this.pathVertexData[g],this._pathVertexIndices[3*b+2]=this.pathVertexData[h],++b,this._vertexIndices[3*b+0]=l,this._vertexIndices[3*b+1]=e,this._vertexIndices[3*b+2]=f,this._normalIndices[3*b+0]=this._capNormalsOffset+1,this._normalIndices[3*b+1]=this._capNormalsOffset+1,this._normalIndices[3*b+2]=this._capNormalsOffset+1,this._pathVertexIndices[3*
b+0]=this.pathVertexData[l],this._pathVertexIndices[3*b+1]=this.pathVertexData[e],this._pathVertexIndices[3*b+2]=this.pathVertexData[f],++b};e.prototype.createBakedGeometryData=function(c){for(var d=new Float32Array(3*this.numVerticesTotal),b=new Float32Array(4*this.numVerticesTotal),g=E({},c,{origin:H,direction:n,auxpos2X:0}),f=0;f<this.numVerticesTotal;++f)a.vec3.set(g.origin,this.originData[3*f+0],this.originData[3*f+1],this.originData[3*f+2]),a.vec3.set(g.direction,this.directionData[4*f+0],this.directionData[4*
f+1],this.directionData[4*f+2]),c.vvSizeEnabled&&(g.auxpos2X=this.vvData[4*this._pathVertexIndices[f]+0]),e.queryVertexPosition(x,g),d[3*f+0]=x[0],d[3*f+1]=x[1],d[3*f+2]=x[2];c={};c[h.VertexAttrConstants.POSITION]=this._vertexIndices;c[h.VertexAttrConstants.NORMAL]=this._normalIndices;c[h.VertexAttrConstants.AUXPOS1]=this._vertexIndices;g={};g[h.VertexAttrConstants.POSITION]={size:3,data:d};g[h.VertexAttrConstants.NORMAL]={size:3,data:this.normalData};g[h.VertexAttrConstants.AUXPOS1]={size:4,data:b};
return new w(g,c,w.DefaultOffsets,"triangle")};e.prototype.createGeometryData=function(){var a={};a[h.VertexAttrConstants.POSITION]=this._vertexIndices;a[h.VertexAttrConstants.AUXPOS1]=this._vertexIndices;a[h.VertexAttrConstants.NORMAL]=this._normalIndices;var d={};d[h.VertexAttrConstants.POSITION]={size:3,data:this.originData};d[h.VertexAttrConstants.AUXPOS1]={size:4,data:this.directionData};d[h.VertexAttrConstants.NORMAL]={size:3,data:this.normalData};this._profile.hasUV()&&(a[h.VertexAttrConstants.UV0]=
this._uvIndices,d[h.VertexAttrConstants.UV0]={size:2,data:this.uvData});this.vvData&&(a[h.VertexAttrConstants.AUXPOS2]=this._pathVertexIndices,d[h.VertexAttrConstants.AUXPOS2]={size:4,data:this.vvData});return new w(d,a,w.DefaultOffsets,"triangle")};return e}();p.Builder=m})(u||(u={}));var x=a.vec3f32.create(),H=a.vec3f32.create(),n=a.vec3f32.create(),l=a.vec3f32.create(),D=a.vec3f32.create(),C=a.vec3f32.create(),A=a.vec3f32.create(),v=a.vec3f32.create(),r=a.mat4f32.create();return u});