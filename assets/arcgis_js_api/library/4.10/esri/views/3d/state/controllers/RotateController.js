// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/gl-matrix ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../../support/mathUtils".split(" "),function(e,g,p,a,q,k,r,l,m){Object.defineProperty(g,"__esModule",{value:!0});e=function(e){function c(f,d,c){var b=e.call(this)||this;b.view=f;b.intersectionHelper=d;b.pivot=c;b.lastPoint=a.vec2f64.create();b.tmpWorldUp=a.vec3f64.create();b.tmpViewDir=a.vec3f64.create();
b.tmpRotCurPoint=a.vec2f64.create();b.tmpTransf=a.mat4f64.create();b.tmpAxis=a.vec3f64.create();b.pivotPos=a.vec3f64.create();b.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};b.rotScale="center"===c?3:1.5;return b}p(c,e);c.prototype.begin=function(f){if(this.active){switch(this.pivot){case "eye":a.vec3.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=
1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||a.vec3.copy(this.pivotPos,this.beginCamera.center),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;l.normalizeCoordinate(this.beginCamera,f,this.lastPoint)}};c.prototype.update=function(a){if(this.active){var d;
switch(this.pivot){case "eye":d=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,d=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,d,this.pivotPos);q.applyAll(this.view,this.currentCamera,this.constraintOptions)}};c.prototype.end=function(){this.active&&this.finishController()};c.prototype.applyRotation=function(c,d,e,b){this.view.renderCoordsHelper.worldUpAtPosition(b,this.tmpWorldUp);l.normalizeCoordinate(c,d,this.tmpRotCurPoint);d=(this.tmpRotCurPoint[1]-
this.lastPoint[1])*this.rotScale;var f=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;a.vec3.subtract(this.tmpViewDir,e,b);var h=a.vec3.length(this.tmpViewDir),h=m.acos(a.vec3.dot(this.tmpViewDir,this.tmpWorldUp)/h);if("eye"===this.pivot){var g=.5*Math.PI-h,n=.495*Math.PI;d=g-Math.max(-n,Math.min(n,g+-.5*d))}d=m.clamp(d+h,k.TiltDefault.min,k.TiltDefault.max)-h;a.mat4.identity(this.tmpTransf);a.vec3.cross(this.tmpAxis,c.up,this.tmpViewDir);"center"===this.pivot&&(f=-f);a.mat4.rotate(this.tmpTransf,
this.tmpTransf,f,this.tmpWorldUp);a.mat4.rotate(this.tmpTransf,this.tmpTransf,d,this.tmpAxis);a.vec3.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);a.vec3.add(e,b,this.tmpViewDir);a.vec3.transformMat4(c.up,c.up,this.tmpTransf);a.vec2.copy(this.lastPoint,this.tmpRotCurPoint);c.markViewDirty()};return c}(r.InteractiveController);g.RotateController=e});