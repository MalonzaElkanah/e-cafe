// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/libs/gl-matrix-2/gl-matrix ../../../geometry/support/scaleUtils ../support/earthUtils ../support/mathUtils".split(" "),function(B,q,g,u,r,l){function t(c,b,d,a){d=v/d;c/b>d?(a.far=c,a.near=a.far/b):(a.near=d,a.far=a.near*b);return a}Object.defineProperty(q,"__esModule",{value:!0});q.createNearFarHeuristic=function(c,b,d){return"global"===c?new w:new x(b,d)};var x=function(){function c(b,d){this.elevationProvider=b;this.unitInMeters=u.getMetersPerUnitForSR(d)}
c.prototype.compute=function(b,d,a,c,n){n||(n={near:0,far:0});var m=r.earthRadius,e=b[2]*this.unitInMeters,h=e;c=e-c;var p=this.elevationProvider?this.elevationProvider.getElevationBounds():null;p&&(e=0<=c?h-this.unitInMeters*p[0]:this.unitInMeters*p[1]-h);h=Math.max(a.xmax-a.xmin,a.ymax-a.ymin,4*Math.max(a.xmax-a.xmin,a.ymax-a.ymin));g.vec3.subtract(f,d,b);k[0]=0<f[0]?a.xmax:a.xmin;k[1]=0<f[1]?a.ymax:a.ymin;k[2]=0<f[2]?h/2:-h/2;g.vec3.subtract(k,k,b);g.vec3.normalize(f,f);b=1.1*g.vec3.dot(k,f)*this.unitInMeters;
m=Math.sqrt(e*(e+2*m));a=Math.max(a.xmax-a.xmin,a.ymax-a.ymin);d=a*y*this.unitInMeters;e=l.clamp((e-d)/(a*z*this.unitInMeters-d),0,1);e=l.lerp(m,b,e*e*e);e*=Math.max(Math.log(Math.abs(c)),1);e=Math.min(e,Math.max(34064E4,h));e/=this.unitInMeters;return t(e,A,this.unitInMeters,n)};return c}(),w=function(){function c(){}c.prototype.compute=function(b,d,a,c,f){f||(f={near:0,far:0});d=r.earthRadius;b=g.vec3.length(b)-d;b=Math.max(Math.abs(b-c),Math.abs(b));c=Math.sqrt(b*(b+2*(d+Math.min(0,c))));b=l.clamp(2E4-
(Math.log(b)-7.983)/9.011*19E3,1E3,2E4);return t(1.2*c,b,1,f)};return c}(),A=2E4,v=2,z=.001,y=1E-4,k=g.vec3f64.create(),f=g.vec3f64.create()});