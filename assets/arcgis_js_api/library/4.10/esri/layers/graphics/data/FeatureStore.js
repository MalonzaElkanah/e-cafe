// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports @dojo/framework/shim/Map ../../../core/Error ../../../core/has ../../../core/Logger ../../../core/libs/rbush/rbush ../../../geometry/support/aaBoundingRect ../featureConversionUtils".split(" "),function(m,n,k,p,q,r,t,l,u){Object.defineProperty(n,"__esModule",{value:!0});var g=[],v=r.getLogger("esri.layers.graphics.data.FeatureStore"),h={minX:0,minY:0,maxX:0,maxY:0};m=function(){function c(a){this._featuresById=new k.default;this._boundsByFeature=new k.default;this._featuresByBounds=
new k.default;this._index=t(9,q("csp-restrictions")?function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:["[0]","[1]","[2]","[3]"]);this._geometryInfo=a}Object.defineProperty(c.prototype,"geometryType",{get:function(){return this._geometryInfo.geometryType},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasM",{get:function(){return this._geometryInfo.hasM},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasZ",{get:function(){return this._geometryInfo.hasZ},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"numFeatures",{get:function(){return this._featuresById.size},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"fullBounds",{get:function(){if(!this.numFeatures)return null;var a=l.create(l.NEGATIVE_INFINITY);this._boundsByFeature.forEach(function(b){b&&(a[0]=Math.min(b[0],a[0]),a[1]=Math.min(b[1],a[1]),a[2]=Math.max(b[2],a[2]),a[3]=Math.max(b[3],a[3]))});return a},enumerable:!0,configurable:!0});c.prototype.setEngine=
function(a){this._engine=a};c.prototype.add=function(a){this._add(a,g);this._index.load(g);this._clearCache();g.length=0};c.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this._add(a[b],g);this._index.load(g);this._clearCache();g.length=0};c.prototype.clear=function(){this._featuresById.clear();this._boundsByFeature.clear();this._featuresByBounds.clear();this._index.clear();this._clearCache()};c.prototype.removeManyById=function(a){for(var b=0;b<a.length;b++){var f=a[b],e=this._featuresById.get(f);
if(e){var d=this._boundsByFeature.get(e);d&&(this._index.remove(d),this._featuresByBounds.delete(d));this._boundsByFeature.delete(e)}this._featuresById.delete(f)}this._clearCache()};c.prototype.forEachBounds=function(a,b){for(var f=0;f<a.length;f++){var e=a[f],d=this._boundsByFeature.get(e);d&&b(d,e)}};c.prototype.getFeature=function(a){return this._featuresById.get(a)};c.prototype.hasFeature=function(a){return this._featuresById.has(a)};c.prototype.forEachFeature=function(a){this._featuresById.forEach(function(b){return a(b)})};
c.prototype.forEachFeatureInBounds=function(a,b){var f=0,e=this._index;h.minX=a[0];h.minY=a[1];h.maxX=a[2];h.maxY=a[3];for(a=e.search(h);f<a.length;f++)b(this._featuresByBounds.get(a[f]))};c.prototype.transferIds=function(a,b){for(var f=[],e=0;e<b.length;e++){var d=this._featuresById.get(b[e]);d&&(this._remove(d),f.push(d))}a.addMany(f);this._clearCache()};c.prototype.transferIdRange=function(a,b,f){for(var e=[];b<f;b++){var d=this._featuresById.get(b);d&&(this._remove(d),e.push(d))}a.addMany(e);
this._clearCache()};c.prototype.transferIf=function(a,b){var f=this,e=[];this._featuresById.forEach(function(a,c){b(a)&&(f._remove(a),e.push(a))});a.addMany(e);this._clearCache()};c.prototype.transferAll=function(a){var b=this,f=[];this._featuresById.forEach(function(a,c){b._remove(a);f.push(a)});a.addMany(f);this._clearCache()};c.prototype._clearCache=function(){this._engine&&this._engine.clearCache()};c.prototype._add=function(a,b){if(a){var c=a.objectId;if(null==c)v.error(new p("featurestore:invalid-feature",
"feature id is missing",{feature:a}));else{var e=this._featuresById.get(c),d;e&&(d=this._boundsByFeature.get(e))&&(this._index.remove(d),this._boundsByFeature.delete(e),this._featuresByBounds.delete(d));a.geometry?(d=u.getBoundsOptimizedGeometry(d||l.create(),a.geometry,this._geometryInfo.hasZ,this._geometryInfo.hasM),this._boundsByFeature.set(a,d),this._featuresByBounds.set(d,a),this._featuresById.set(c,a),b.push(d)):(this._boundsByFeature.set(a,null),this._featuresById.set(c,a))}}};c.prototype._remove=
function(a){var b;if(a){if(b=this._boundsByFeature.get(a))this._index.remove(b),this._boundsByFeature.delete(a),this._featuresByBounds.delete(b);this._featuresById.delete(a.objectId)}};return c}();n.default=m});