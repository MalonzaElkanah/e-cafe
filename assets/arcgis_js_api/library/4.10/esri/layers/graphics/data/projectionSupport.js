// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/Error ../../../core/promiseUtils ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(x,l,n,h,f,e,k){function p(b,a){var d;if(!a)return null;if("x"in a){var c={x:0,y:0};b=b(a.x,a.y,m,0);c.x=b[0];c.y=b[1];null!=a.z&&(c.z=a.z);null!=a.m&&(c.m=a.m);return c}if("xmin"in a)return c={xmin:0,ymin:0,xmax:0,ymax:0},d=b(a.xmin,a.ymin,m,0),c.xmin=d[0],c.ymin=d[1],b=b(a.xmax,a.ymax,m,
0),c.xmax=b[0],c.ymax=b[1],a.hasZ&&(c.zmin=a.zmin,c.zmax=a.zmax,c.hasZ=!0),a.hasM&&(c.mmin=a.mmin,c.mmax=a.mmax,c.hasM=!0),c;if("rings"in a)return{rings:q(a.rings,b),hasM:a.hasM,hasZ:a.hasZ};if("paths"in a)return{paths:q(a.paths,b),hasM:a.hasM,hasZ:a.hasZ};if("points"in a)return{points:r(a.points,b),hasM:a.hasM,hasZ:a.hasZ}}function q(b,a){for(var d=[],c=0;c<b.length;c++)d.push(r(b[c],a));return d}function r(b,a){for(var d=[],c=0;c<b.length;c++){var g=b[c],e=a(g[0],g[1],[0,0],0);d.push(e);2<g.length&&
e.push(g[2]);3<g.length&&e.push(g[3])}return d}function t(b,a){return!e.isValid(b)||!e.isValid(a)||e.equals(b,a)||k.canProject(b,a)?!1:!0}Object.defineProperty(l,"__esModule",{value:!0});var m=[0,0];l.checkProjectionSupport=function(b,a){if(Array.isArray(b)){for(var d=0;d<b.length;d++){var c=b[d];if(t(c.geometry&&c.geometry.spatialReference,a))return f.isSupported()?f.load():h.reject(new n("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,outSpatialReference:a}))}return h.resolve()}return t(b,
a)?f.isSupported()?f.load():h.reject(new n("feature-store:unsupported-query","projection not supported",{inSpatialReference:b,outSpatialReference:a})):h.resolve()};var u=p.bind(null,k.lngLatToXY),v=p.bind(null,k.xyToLngLat);l.project=function(b,a,d){return e.isValid(a)&&e.isValid(d)&&!e.equals(a,d)?k.canProject(a,d)?e.isWebMercator(d)?u(b):v(b):f.projectMany([b],a,d,null,!0)[0]:b};var w=new (function(){function b(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}b.prototype.push=
function(a,b,c){var d=this;a&&a.length&&b&&c&&!e.equals(b,c)||h.resolve(a);var f={geometries:a,inSpatialReference:b,outSpatialReference:c,resolve:null};this._jobs.push(f);return h.create(function(a){f.resolve=a;null===d._timer&&(d._timer=setTimeout(d._process,10))},function(){var a=d._jobs.indexOf(f);-1<a&&d._jobs.splice(a,1)})};b.prototype._process=function(){this._timer=null;var a=this._jobs.shift();if(a){var b=a.geometries,c=a.inSpatialReference,g=a.outSpatialReference,a=a.resolve;k.canProject(c,
g)?e.isWebMercator(g)?a(b.map(u)):a(b.map(v)):a(f.projectMany(b,c,g,null,!0));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return b}());l.projectMany=function(b,a,d){return w.push(b,a,d)}});