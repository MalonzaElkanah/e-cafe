// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/Logger ./OptimizedFeature ./OptimizedFeatureSet ./OptimizedGeometry".split(" "),function(la,k,G,fa,D,ga,y){function B(a,b){return Math.round((b-a.translate[0])/a.scale[0])}function C(a,b){return Math.round((a.translate[1]-b)/a.scale[1])}function L(a,b){return b*a.scale[0]+a.translate[0]}function M(a,b){return a.translate[1]-b*a.scale[1]}function H(a){a=a.coords;return{x:a[0],y:a[1]}}function Z(a){var b=new y.default;b.coords[0]=a.x;b.coords[1]=a.y;
return b}function N(a){a=a.coords;return{x:a[0],y:a[1],z:a[2]}}function ha(a){var b=new y.default;b.coords[0]=a.x;b.coords[1]=a.y;b.coords[2]=a.z;return b}function O(a){a=a.coords;return{x:a[0],y:a[1],m:a[2]}}function ia(a){var b=new y.default;b.coords[0]=a.x;b.coords[1]=a.y;b.coords[2]=a.m;return b}function P(a){a=a.coords;return{x:a[0],y:a[1],z:a[2],m:a[3]}}function ja(a){var b=new y.default;b.coords[0]=a.x;b.coords[1]=a.y;b.coords[2]=a.z;b.coords[3]=a.m;return b}function Q(a,b,c){if(!a)return null;
for(var d=b?c?4:3:c?3:2,e=[],g=0;g<a.coords.length;g+=d){for(var f=[],h=0;h<d;h++)f.push(a.coords[g+h]);e.push(f)}return b?c?{points:e,hasZ:b,hasM:c}:{points:e,hasZ:b}:c?{points:e,hasM:c}:{points:e}}function R(a,b,c){if(!a)return null;var d=b?c?4:3:c?3:2,e=a.coords,g=[],f=0,h=0;for(a=a.lengths;h<a.length;h++){for(var n=a[h],l=[],q=0;q<n;q++){for(var m=[],p=0;p<d;p++)m.push(e[f++]);l.push(m)}g.push(l)}return b?c?{paths:g,hasZ:b,hasM:c}:{paths:g,hasZ:b}:c?{paths:g,hasM:c}:{paths:g}}function S(a,b,c){if(!a)return null;
var d=b?c?4:3:c?3:2,e=a.coords,g=[],f=0,h=0;for(a=a.lengths;h<a.length;h++){for(var n=a[h],l=[],q=0;q<n;q++){for(var m=[],p=0;p<d;p++)m.push(e[f++]);l.push(m)}g.push(l)}return b?c?{rings:g,hasZ:b,hasM:c}:{rings:g,hasZ:b}:c?{rings:g,hasM:c}:{rings:g}}function T(a,b,c,d,e,g){a.length=0;if(c){switch(c){case "esriGeometryPoint":c=Z;d&&e?c=ja:d?c=ha:e&&(c=ia);for(d=0;d<b.length;d++){var f=b[d];e=f.geometry;f=f.attributes;e=e?c(e):void 0;a.push(new D.default(e,f,null,f[g]))}break;case "esriGeometryMultipoint":c=
d?e?4:3:e?3:2;for(d=0;d<b.length;d++){e=b[d];var h=e.geometry;e=e.attributes;f=void 0;if(h){f=new y.default;f.lengths[0]=h.points.length;for(var n=f.coords,l=0,q=0,h=h.points;q<h.length;q++)for(var m=h[q],p=0;p<c;p++)n[l++]=m[p]}a.push(new D.default(f,e,null,e[g]))}break;case "esriGeometryPolyline":c=d?e?4:3:e?3:2;for(d=0;d<b.length;d++){e=b[d];m=e.geometry;e=e.attributes;f=void 0;if(m)for(f=new y.default,n=f.lengths,l=f.coords,h=q=0,m=m.paths;h<m.length;h++){for(var p=m[h],r=0,u=p;r<u.length;r++)for(var t=
u[r],k=0;k<c;k++)l[q++]=t[k];n.push(p.length)}a.push(new D.default(f,e,null,e[g]))}break;case "esriGeometryPolygon":c=d?e?4:3:e?3:2;for(d=0;d<b.length;d++){f=b[d];p=f.geometry;e=f.centroid;f=f.attributes;n=void 0;if(p)for(n=new y.default,l=n.lengths,q=n.coords,m=h=0,p=p.rings;m<p.length;m++){r=p[m];u=0;for(t=r;u<t.length;u++)for(var k=t[u],x=0;x<c;x++)q[h++]=k[x];l.push(r.length)}e?a.push(new D.default(n,f,Z(e),f[g])):a.push(new D.default(n,f,null,f[g]))}break;default:I.error("convertToFeatureSet:unknown-geometry",
new G("Unable to parse unknown geometry type '"+c+"'")),a.length=0}return a}a.length=0}function U(a,b,c,d,e){a.length=0;switch(c){case "esriGeometryPoint":c=H;d&&e?c=P:d?c=N:e&&(c=O);for(d=0;d<b.length;d++){var g=b[d];e=g.geometry;g=g.attributes;e=e?c(e):null;a.push({attributes:g,geometry:e})}break;case "esriGeometryMultipoint":for(c=0;c<b.length;c++){var f=b[c],g=f.geometry,f=f.attributes,h=void 0;g&&(h=Q(g,d,e));a.push({attributes:f,geometry:h})}break;case "esriGeometryPolyline":for(c=0;c<b.length;c++)f=
b[c],g=f.geometry,f=f.attributes,h=void 0,g&&(h=R(g,d,e)),a.push({attributes:f,geometry:h});break;case "esriGeometryPolygon":for(c=0;c<b.length;c++){var h=b[c],f=h.geometry,g=h.attributes,n=h.centroid,h=void 0;f&&(h=S(f,d,e));n?(f=H(n),a.push({attributes:g,centroid:f,geometry:h})):a.push({attributes:g,geometry:h})}break;default:I.error("convertToFeatureSet:unknown-geometry",new G("Unable to parse unknown geometry type '"+c+"'"))}return a}function V(a,b,c,d,e,g){a.lengths.length&&(a.lengths.length=
0);a.coords.length&&(a.coords.length=0);if(!b||!b.coords.length)return null;e=W[e];var f=b.coords;b=b.lengths;var h=c?d?4:3:d?3:2;c=c?d?J:A:d?A:K;if(!b.length)return c(a.coords,f,0,0,B(g,f[0]),C(g,f[1])),a.lengths.length&&(a.lengths.length=0),a.coords.length=h,a;for(var n,l,q,m=0,p,r=0,u=0;u<b.length;u++){var k=b[u];if(!(k<e)){var v=0;p=r;l=d=B(g,f[m]);q=n=C(g,f[m+1]);c(a.coords,f,p,m,l,q);v++;m+=h;p+=h;for(var x=1;x<k;x++,m+=h)if(l=B(g,f[m]),q=C(g,f[m+1]),l!==d||q!==n)c(a.coords,f,p,m,l-d,q-n),p+=
h,v++,d=l,n=q;v>=e&&(a.lengths.push(v),r=p)}}a.coords.length=r;return a.coords.length?a:null}function X(a,b,c,d,e,g,f){for(var h=f-c,n=0,l=0,q,m=g+c;m<f-c;m+=c){q=b[m];var p=b[m+1],r=b[g],k=b[g+1],t=b[h],v=b[h+1];r===t?q=Math.abs(q-r):(t=(v-k)/(t-r),q=Math.abs(t*q-p+(k-t*r))/Math.sqrt(t*t+1));q>n&&(l=m,n=q)}n>d?(X(a,b,c,d,e,g,l+c),X(a,b,c,d,e,l,f)):(e(a,b,a.length,g,b[g],b[g+1]),e(a,b,a.length,h,b[h],b[h+1]))}function Y(a,b,c,d,e){var g=b.coords,f=b.lengths,h=c?d?J:A:d?A:K;c=c?d?4:3:d?3:2;if(!g.length)return a!==
b&&(a.lengths.length=0,a.coords.length=0),a;if(!f.length)return h(a.coords,g,0,0,L(e,g[0]),M(e,g[1])),a!==b&&(a.lengths.length=0,a.coords.length=c),a;var n=e.scale;d=n[0];for(var n=n[1],l=0,q=0;q<f.length;q++){var m=f[q];a.lengths[q]=m;var p=L(e,g[l]),r=M(e,g[l+1]);h(a.coords,g,l,l,p,r);for(var l=l+c,k=1;k<m;k++,l+=c)p+=g[l]*d,r-=g[l+1]*n,h(a.coords,g,l,l,p,r)}a!==b&&(a.lengths.length=f.length,a.coords.length=g.length);return a}function ka(a,b,c,d,e,g){g=e?g?4:3:g?3:2;var f=c,h=c+g,n=0,l=0,q=c=0,
m=0,p=0;for(--d;p<d;p++,f+=g,h+=g){var r=b[f],k=b[f+1],t=b[f+2],v=b[h],x=b[h+1],z=b[h+2],w=r*x-v*k,q=q+w,n=n+(r+v)*w,l=l+(k+x)*w;e&&(w=r*z-v*t,c+=(t+z)*w,m+=w);r<a[0]&&(a[0]=r);r>a[1]&&(a[1]=r);k<a[2]&&(a[2]=k);k>a[3]&&(a[3]=k);e&&(t<a[4]&&(a[4]=t),t>a[5]&&(a[5]=t))}0<q&&(q*=-1);0<m&&(m*=-1);if(!q)return null;a=[n,l,.5*q];e&&(a[3]=c,a[4]=.5*m);return a}function aa(a,b,c,d,e){e=d?e?4:3:e?3:2;for(var g=b,f=b+e,h=0,n=0,l=0,q=0,m=0,p=c-1;m<p;m++,g+=e,f+=e){var k=a[g],u=a[g+1],t=a[g+2],v=a[f],x=a[f+1],
z=a[f+2],w=d?ba(k,u,t,v,x,z):ca(k,u,v,x);w&&(h+=w,d?(k=da(k,u,t,v,x,z),n+=w*k[0],l+=w*k[1],q+=w*k[2]):(k=ea(k,u,v,x),n+=w*k[0],l+=w*k[1]))}return 0<h?d?[n/h,l/h,q/h]:[n/h,l/h]:0<c?d?[a[b],a[b+1],a[b+2]]:[a[b],a[b+1]]:null}function ca(a,b,c,d){a=c-a;b=d-b;return Math.sqrt(a*a+b*b)}function ba(a,b,c,d,e,g){a=d-a;b=e-b;c=g-c;return Math.sqrt(a*a+b*b+c*c)}function ea(a,b,c,d){return[a+.5*(c-a),b+.5*(d-b)]}function da(a,b,c,d,e,g){return[a+.5*(d-a),b+.5*(e-b),c+.5*(g-c)]}Object.defineProperty(k,"__esModule",
{value:!0});var I=fa.getLogger("esri.tasks.support.optimizedFeatureSet"),W={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},K=function(a,b,c,d,e,g){a[c]=e;a[c+1]=g},A=function(a,b,c,d,e,g){a[c]=e;a[c+1]=g;a[c+2]=b[d+2]},J=function(a,b,c,d,e,g){a[c]=e;a[c+1]=g;a[c+2]=b[d+2];a[c+3]=b[d+3]};k.quantizeX=B;k.quantizeY=C;k.hydrateX=L;k.hydrateY=M;k.convertToPoint=function(a,b,c){return a?b?c?P(a):N(a):c?O(a):H(a):null};k.convertToMultipoint=Q;k.convertToPolyline=
R;k.convertToPolygon=S;var E=[],F=[];k.convertFromFeature=function(a,b,c,d,e){E[0]=a;a=T(F,E,b,c,d,e)[0];E.length=F.length=0;return a};k.convertFromFeatures=T;k.convertToFeature=function(a,b,c,d){F[0]=a;U(E,F,b,c,d);a=E[0];E.length=F.length=0;return a};k.convertToGeometry=function(a,b,c,d){if(!a||!a.geometry)return null;switch(b){case "esriGeometryPoint":return b=H,c&&d?b=P:c?b=N:d&&(b=O),b(a.geometry);case "esriGeometryMultipoint":return Q(a.geometry,c,d);case "esriGeometryPolyline":return R(a.geometry,
c,d);case "esriGeometryPolygon":return S(a.geometry,c,d);default:I.error("convertToGeometry:unknown-geometry",new G("Unable to parse unknown geometry type '"+b+"'"))}};k.convertToFeatures=U;k.convertToFeatureSet=function(a){var b=a.objectIdFieldName,c=a.spatialReference,d=a.transform,e=a.fields,g=a.hasM,f=a.hasZ,h=a.geometryType,n=a.exceededTransferLimit;a={features:U([],a.features,h,f,g),fields:e,geometryType:h,objectIdFieldName:b,spatialReference:c};d&&(a.transform=d);n&&(a.exceededTransferLimit=
n);g&&(a.hasM=g);f&&(a.hasZ=f);return a};k.convertFromFeatureSet=function(a,b){var c=new ga.default,d=a.hasM,e=a.hasZ,g=a.features,f=a.objectIdFieldName,h=a.spatialReference,n=a.geometryType,l=a.exceededTransferLimit,k=a.transform;c.fields=a.fields;c.geometryType=n;c.objectIdFieldName=f||b;c.spatialReference=h;if(!c.objectIdFieldName)return I.error(new G("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),c;g&&T(c.features,g,n,e,d,c.objectIdFieldName);l&&(c.exceededTransferLimit=
l);d&&(c.hasM=d);e&&(c.hasZ=e);k&&(c.transform=k);return c};k.hydrateOptimizedFeatureSet=function(a){var b=a.transform,c=a.hasM,d=a.hasZ;if(!b)return a;for(var e=0,g=a.features;e<g.length;e++){var f=g[e];f.geometry&&Y(f.geometry,f.geometry,c,d,b);f.centroid&&Y(f.centroid,f.centroid,c,d,b)}a.transform=null;return a};k.quantizeOptimizedFeatureSet=function(a,b){var c=b.geometryType,d=b.features,e=b.hasM,g=b.hasZ;if(!a)return b;for(var f=0;f<d.length;f++){var h=d[f],n=new D.default(new y.default,h.attributes);
V(n.geometry,h.geometry,e,g,c,a);h.centroid&&(n.centroid=new y.default,V(n.centroid,h.centroid,e,g,"esriGeometryPoint",a));d[f]=n}b.transform=a;return b};k.quantizeOptimizedGeometry=V;k.quantizeOptimizedGeometryRemoveCollinear=function(a,b,c,d,e,g){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!b||!b.coords.length)return null;e=W[e];var f=b.coords;b=b.lengths;var h=c?d?4:3:d?3:2;c=c?d?J:A:d?A:K;if(!b.length)return c(a.coords,f,0,0,B(g,f[0]),C(g,f[1])),a.lengths.length&&
(a.lengths.length=0),a.coords.length=h,a;for(var n,l,k,m=0,p,r=0,u=0;u<b.length;u++){var t=b[u];if(!(t<e)){var v=0;p=r;d=n=B(g,f[m]);k=l=C(g,f[m+1]);c(a.coords,f,p,m,d,k);v++;for(var m=m+h,x=!1,z=0,w=0,y=1;y<t;y++,m+=h)if(d=B(g,f[m]),k=C(g,f[m+1]),d!==n||k!==l)n=d-n,l=k-l,x&&(0===z&&0===n||0===w&&0===l)?(z+=n,w+=l):(x=!0,z=n,w=l,p+=h,v++),c(a.coords,f,p,m,z,w),n=d,l=k;x&&(p+=h,c(a.coords,f,p,m,z,w));v>=e&&(a.lengths.push(v),r=p)}}a.coords.length!==r&&(a.coords.length=r);return a.coords.length?a:null};
k.generalizeOptimizedGeometry=function(a,b,c,d,e,g){a.lengths.length&&(a.lengths.length=0);a.coords.length&&(a.coords.length=0);if(!b||!b.coords.length)return null;e=W[e];var f=b.coords;b=b.lengths;var h=c?d?4:3:d?3:2;c=c?d?J:A:d?A:K;if(!b.length)return c(a.coords,f,0,0,f[0],f[1]),a.lengths.length&&(a.lengths.length=0),a.coords.length=h,a;for(var n=d=0;n<b.length;n++){var k=b[n];if(!(k<e)){var q=a.coords.length/h;X(a.coords,f,h,g,c,d,d+k*h);var m=a.coords.length/h-q;m>=e?a.lengths.push(m):a.coords.length=
q*h}d+=k*h}return a.coords.length?a:null};k.getBoundsOptimizedGeometry=function(a,b,c,d){c=c?d?4:3:d?3:2;var e=d=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,f=Number.NEGATIVE_INFINITY;if(b&&b.coords){b=b.coords;for(var h=0;h<b.length;h+=c){var k=b[h],l=b[h+1];d=Math.min(d,k);g=Math.max(g,k);e=Math.min(e,l);f=Math.max(f,l)}}a[0]=d;a[1]=e;a[2]=g;a[3]=f;return a};k.getQuantizedBoundsOptimizedGeometry=function(a,b,c,d){c=c?d?4:3:d?3:2;d=b.coords;var e=Number.POSITIVE_INFINITY,g=Number.POSITIVE_INFINITY,
f=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY,k=0,l=0;for(b=b.lengths;l<b.length;l++)for(var q=b[l],m=d[k],p=d[k+1],e=Math.min(m,e),g=Math.min(p,g),f=Math.max(m,f),h=Math.max(p,h),k=k+c,r=1;r<q;r++,k+=c){var u=d[k],t=d[k+1],m=m+u,p=p+t;0>u&&(e=Math.min(e,m));0<u&&(f=Math.max(f,m));0>t?g=Math.min(g,p):0<t&&(h=Math.max(h,p))}a[0]=e;a[1]=g;a[2]=f;a[3]=h;return a};k.hydrateOptimizedGeometry=Y;k.getCentroidOptimizedGeometry=function(a,b,c,d){if(!b||!b.lengths.length)return null;a.lengths.length&&
(a.lengths.length=0);a.coords.length&&(a.coords.length=0);for(var e=a.coords,g=[],f=c?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],h=b.lengths,k=b.coords,l=c?d?4:3:d?3:2,q=0,m=0;m<h.length;m++){var p=h[m],r=ka(f,k,q,p,c,d);r&&g.push(r);q+=p*l}g.sort(function(a,b){var d=a[2]-b[2];0===d&&c&&(d=
a[4]-b[4]);return d});g.length&&(l=6*g[0][2],e[0]=g[0][0]/l,e[1]=g[0][1]/l,c&&(l=6*g[0][4],e[2]=0!==l?g[0][3]/l:0),e[0]<f[0]||e[0]>f[1]||e[1]<f[2]||e[1]>f[3]||c&&(e[2]<f[4]||e[2]>f[5]))&&(e.length=0);if(!e.length)if(b=b.lengths[0]?aa(k,0,h[0],c,d):null)e[0]=b[0],e[1]=b[1],c&&2<b.length&&(e[2]=b[2]);else return null;return a};k.lineCentroid=aa;k.getLength2D=ca;k.getLength3D=ba;k.getMidpoint2D=ea;k.getMidpoint3D=da});