// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/CollectionFlattener ../core/Error ../core/lang ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./buildingSublayers/BuildingGroupSublayer ./mixins/SceneService ./support/commonProperties".split(" "),function(p,A,B,q,e,r,h,t,u,l,c,v,w,x,g,y,k){var m=u.getLogger("esri.layers.BuildingSceneLayer");
return function(n){function b(a){a=n.call(this)||this;a.operationalLayerType="BuildingSceneLayer";a.allSublayers=new r({root:a,rootCollectionNames:["sublayers"],getChildrenFunction:function(a){return"building-group"===a.type?a.sublayers:null}});a.sublayers=null;a.sublayerOverrides=null;a.type="building-scene";return a}q(b,n);b.prototype.normalizeCtorArgs=function(a){return"string"===typeof a?{url:a}:a};b.prototype.readSublayers=function(a,b,z){var d=this;a=g.readSublayers(a,b,z);g.forEachSublayer(a,
function(a){return a.layer=d});this.sublayerOverrides&&(this.applySublayerOverrides(a,this.sublayerOverrides),this.sublayerOverrides=null);return a};b.prototype.applySublayerOverrides=function(a,b){var d=b.overrides,c=b.context;g.forEachSublayer(a,function(a){return a.read(d.get(a.id),c)})};b.prototype.readSublayerOverrides=function(a,b){for(var d=new Map,c=0;c<a.length;c++){var f=a[c];null==f||"object"!==typeof f||"number"!==typeof f.id?b.messages.push(new h("building-scene-layer:invalid-sublayer-override",
"Invalid value for sublayer override. Not an object or no id specified.",{value:f})):d.set(f.id,f)}return{overrides:d,context:b}};b.prototype.writeSublayerOverrides=function(a,b,c){var d=[];g.forEachSublayer(this.sublayers,function(a){a=a.write({},c);1<Object.keys(a).length&&d.push(a)});0<d.length&&(b.sublayers=d)};b.prototype.writeUnappliedOverrides=function(a,b){b.sublayers=[];a.overrides.forEach(function(a){b.sublayers.push(t.clone(a))})};b.prototype.write=function(a,b){a=this.inherited(arguments);
b&&"web-scene"===b.origin&&(this.sublayers?this.writeSublayerOverrides(this.sublayers,a,b):this.sublayerOverrides&&this.writeUnappliedOverrides(this.sublayerOverrides,a));return a};b.prototype.read=function(a,b){this.inherited(arguments);if(b&&"web-scene"===b.origin&&null!=a&&Array.isArray(a.sublayers)){var c=this.readSublayerOverrides(a.sublayers,b);this.sublayers?this.applySublayerOverrides(this.sublayers,c):this.sublayerOverrides=c}return this};Object.defineProperty(b.prototype,"elevationInfo",
{set:function(a){this._set("elevationInfo",a);this._validateElevationInfo()},enumerable:!0,configurable:!0});b.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).then(function(){return a._fetchService()},function(){return a._fetchService()});this.addResolvingPromise(b);return this.when()};b.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return l.reject(new h("building-scene-layer:view-not-supported","BuildingSceneLayer is only supported in 3D"));
case "3d":return l.create(function(a){return p(["../views/3d/layers/BuildingSceneLayerView3D"],a)})}};b.prototype._validateLayer=function(a){if(!a.layerType||"Building"!==a.layerType)throw new h("buildingscenelayer:layer-type-not-supported","BuildingSceneLayer does not support this layer type",{layerType:a.layerType});};b.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("absolute-height"!==a.mode&&m.warn(".elevationInfo\x3d","Building scene layers only support absolute-height elevation mode"),
a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&m.warn(".elevationInfo\x3d","Building scene layers do not support featureExpressionInfo"))};b.prototype.graphicChanged=function(){};e([c.property({type:["BuildingSceneLayer"]})],b.prototype,"operationalLayerType",void 0);e([c.property({readOnly:!0})],b.prototype,"allSublayers",void 0);e([c.property(g.sublayersProperty)],b.prototype,"sublayers",void 0);e([c.reader("service","sublayers")],b.prototype,"readSublayers",null);e([c.property(k.readOnlyService(v))],
b.prototype,"fullExtent",void 0);e([c.property(k.readOnlyService(w))],b.prototype,"spatialReference",void 0);e([c.property(k.elevationInfo)],b.prototype,"elevationInfo",null);e([c.property({json:{read:!1},readOnly:!0})],b.prototype,"type",void 0);return b=e([c.subclass("esri.layers.BuildingSceneLayer")],b)}(c.declared(x,y))});