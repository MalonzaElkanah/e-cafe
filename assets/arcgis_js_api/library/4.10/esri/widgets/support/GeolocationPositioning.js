// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Graphic ../../core/Accessor ../../core/Error ../../core/Evented ../../core/geolocationUtils ../../core/promiseUtils ../../core/accessorSupport/decorators ../../symbols/PictureMarkerSymbol ./GoTo".split(" "),function(l,v,m,f,n,p,q,r,h,k,d,t,u){return function(g){function c(){var a=null!==g&&g.apply(this,arguments)||this;a._geolocationUsable=!0;a._iconPath=l.toUrl("../../images/support/sdk_gps_location.png");
a.geolocationOptions=null;a.goToLocationEnabled=!0;a.graphic=new n({symbol:new t({url:a._iconPath,width:21,height:21})});a.scale=null;a.useHeadingEnabled=!0;a.view=null;return a}m(c,g);c.prototype.initialize=function(){h.supported()||(this._geolocationUsable=!1)};c.prototype.destroy=function(){this._clear();this.view=null};c.prototype._clear=function(){this.view&&this.view.graphics.remove(this.graphic)};c.prototype._getScaleWithinConstraints=function(a,b){return b?"2d"===b.type?(b=b.constraints,Math.min(b.effectiveMinScale,
Math.max(b.effectiveMaxScale,a))):a:a};c.prototype._getScale=function(a){var b=this.scale;return this._getScaleWithinConstraints("number"===typeof b?b:2500,a)};c.prototype._getHeading=function(a,b){b=b.spatialReference;a=a.coords&&a.coords.heading;if(!(!b||!b.isWebMercator&&!b.isWGS84||"number"!==typeof a||0>a||360<a))return a};c.prototype._addHeading=function(a){var b=a.heading,c=a.target;(a=a.view)&&"number"===typeof b&&("3d"===a.type?c.heading=b:"2d"===a.type&&(c.rotation=360-b))};c.prototype._animatePoint=
function(a,b,c){if(!this.goToLocationEnabled)return k.resolve(b);var d=this.view,e=this.useHeadingEnabled?this._getHeading(b,d):void 0;a={target:a,scale:c};this._addHeading({heading:e,target:a,view:d});return this.callGoTo({target:a}).then(function(){return b})};c.prototype._setPosition=function(a){var b=this;return h.positionToPoint(a,this.view).then(function(c){var d=b.graphic,e=a.coords,e={timestamp:a.timestamp,accuracy:e.accuracy,altitude:e.altitude,altitudeAccuracy:e.altitudeAccuracy,heading:e.heading,
latitude:e.latitude,longitude:e.longitude,speed:e.speed};d&&(d.geometry=c,d.attributes=e);d=b._getScale(b.view);return b._animatePoint(c,a,d)}).catch(function(){return k.reject(new q("positioning:invalid-point","Cannot position invalid point"))})};f([d.property()],c.prototype,"geolocationOptions",void 0);f([d.property()],c.prototype,"goToLocationEnabled",void 0);f([d.property()],c.prototype,"graphic",void 0);f([d.property()],c.prototype,"scale",void 0);f([d.property()],c.prototype,"useHeadingEnabled",
void 0);f([d.property()],c.prototype,"view",void 0);return c=f([d.subclass("esri.widgets.support.GeolocationPositioning")],c)}(d.declared(p,r,u))});