// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./FeatureTemplates/nls/FeatureTemplates ../core/HandleOwner ../core/accessorSupport/decorators ./Widget ./FeatureTemplates/FeatureTemplatesViewModel ./support/widget ../core/libs/intersection-observer/intersection-observer".split(" "),function(q,r,t,l,e,g,m,f,n,p,d){return function(k){function b(a){a=k.call(this)||this;a._filterText=null;a.filterEnabled=!0;a.filterFunction=
null;a.groupBy=null;a.layers=null;a.viewModel=new p;a._handleItemClick=a._handleItemClick.bind(a);a._handleInputChange=a._handleInputChange.bind(a);a._afterItemCreateOrUpdate=a._afterItemCreateOrUpdate.bind(a);a._afterItemRemoved=a._afterItemRemoved.bind(a);a._afterRootCreate=a._afterRootCreate.bind(a);return a}l(b,k);b.prototype.postInitialize=function(){var a=this,c=function(c){c=c.name;return!a._filterText||-1<c.toLowerCase().indexOf(a._filterText.toLowerCase())};this.filterFunction||(this.filterFunction=
c)};b.prototype.destroy=function(){this._iconIntersectionObserver&&(this._iconIntersectionObserver.disconnect(),this._iconIntersectionObserver=null)};b.prototype.render=function(){var a=this._filterText,c=this.viewModel,b=c.items,c=c.state;return d.tsx("div",{class:this.classes("esri-feature-templates","esri-widget"),"aria-label":g.widgetLabel,afterCreate:this._afterRootCreate},"loading"===c?this.renderLoader():"ready"===c?0!==b.length||a?[this.filterEnabled?this.renderFilterInput():null,this.renderItems()]:
this.renderNoItems():null)};b.prototype._afterRootCreate=function(a){this._iconIntersectionObserver=new IntersectionObserver(function(a,b){a.forEach(function(a){if(a.isIntersecting){var c=a.target;if(!c["data-has-icon"]){c["data-has-icon"]=!0;var d=c["data-item"];d.fetchThumbnail().then(function(){d.thumbnail&&c.appendChild(d.thumbnail)})}b.unobserve(c)}})},{root:a})};b.prototype.renderFilterInput=function(){var a=this.id+"-placeholder";return d.tsx("div",{class:"esri-feature-templates__filter-container",
key:"filter"},d.tsx("input",{"aria-labelledby":a,class:this.classes("esri-input","esri-feature-templates__filter-input"),oninput:this._handleInputChange,type:"search"}),this._filterText?null:d.tsx("div",{class:"esri-feature-templates__filter-placeholder",id:a,key:"placeholder"},d.tsx("span",{class:"esri-icon-search","aria-hidden":"true"}),d.tsx("div",{class:"esri-feature-templates__filter-placeholder-text"},g.filterPlaceholder)))};b.prototype.renderItems=function(){var a=this,c=this.viewModel,b=c.filterFunction,
h=c.items,c=c.groupBy;this.handles.remove("thumbnails");return b&&0===h.length?d.tsx("div",{class:"esri-feature-templates__no-matches-message",key:"no-matches"},g.noMatches):"none"===c?d.tsx("ul",{class:this.classes("esri-feature-templates__list","esri-feature-templates__scroller"),key:"item-container"},h.map(function(c){return a.renderItem(c)})):this.renderItemSections(h)};b.prototype.renderItemSections=function(a){var c=this;return d.tsx("div",{class:"esri-feature-templates__scroller",key:"item-container"},
a.map(function(a){return c.renderItemSection(a)}))};b.prototype.renderItemSection=function(a){var c=this,b=a.uid+"-heading";return d.tsx("section",{"aria-labelledby":b,class:"esri-feature-templates__section",key:a.name},d.tsx("div",{"aria-level":"1",id:b,role:"heading",class:this.classes("esri-feature-templates__section-header")},this.renderLabel(a.name)),d.tsx("ul",{class:"esri-feature-templates__list"},a.items.map(function(b){return c.renderItem(b,a)})))};b.prototype.renderItem=function(a,b){var c=
this;this.handles.add(a.watch("thumbnail",function(){return c.scheduleRender()}),"thumbnails");return d.tsx("li",{"aria-level":b?"2":"",class:"esri-feature-templates__list-item","data-item":a,key:a.layer.uid+"__"+a.label,onclick:this._handleItemClick,onkeydown:this._handleItemClick,tabIndex:0},d.tsx("div",{class:"esri-feature-templates__list-item-container"},d.tsx("div",{class:"esri-feature-templates__list-item-icon",afterCreate:this._afterItemCreateOrUpdate,afterUpdate:this._afterItemCreateOrUpdate,
afterRemoved:this._afterItemRemoved,"data-item":a,"data-has-icon":!1}),d.tsx("div",{class:"esri-feature-templates__list-item-label"},this.renderLabel(a.label))))};b.prototype.renderLabel=function(a){var b=this._filterText;if(!b)return a;var e=a.toLowerCase(),f=b.toLowerCase(),g=e.indexOf(f);if(-1===g)return a;e=a.substring(0,g);f=a.substr(g,b.length);a=a.substring(g+b.length);return d.tsx("span",null,e,d.tsx("strong",null,f),a)};b.prototype.renderLoader=function(){return d.tsx("div",{class:"esri-feature-templates__loader",
key:"loader"})};b.prototype.renderNoItems=function(){return d.tsx("div",{class:"esri-feature-templates__no-items-message",key:"no-items"},d.tsx("h2",{class:"esri-widget__heading"},g.noItems))};b.prototype._handleItemClick=function(a){a=a.currentTarget["data-item"];this.emit("select",{item:a,template:a.template})};b.prototype._handleInputChange=function(a){this._filterText=a.target.value;this.viewModel.refresh()};b.prototype._afterItemCreateOrUpdate=function(a){this._iconIntersectionObserver.observe(a)};
b.prototype._afterItemRemoved=function(a){this._iconIntersectionObserver.unobserve(a)};e([f.property(),d.renderable()],b.prototype,"filterEnabled",void 0);e([f.aliasOf("viewModel.filterFunction")],b.prototype,"filterFunction",void 0);e([f.aliasOf("viewModel.groupBy")],b.prototype,"groupBy",void 0);e([f.aliasOf("viewModel.layers")],b.prototype,"layers",void 0);e([f.property(),d.renderable(["viewModel.items","viewModel.state"])],b.prototype,"viewModel",void 0);e([d.accessibleHandler()],b.prototype,
"_handleItemClick",null);return b=e([f.subclass("esri.widgets.FeatureTemplates")],b)}(f.declared(n,m))});