// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Search/SearchResultRenderer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/i18n!./nls/Search ../../core/accessorSupport/decorators ../Widget ./SearchViewModel ../support/widget".split(" "),function(z,v,x,a,k,g,c,w,d){return function(c){function r(a){a=c.call(this)||this;a.showMoreResultsOpen=!1;a.viewModel=null;return a}x(r,c);r.prototype.render=function(){var a=this,p,c=this.get("viewModel.selectedResult"),
q=this.get("viewModel.results"),c=c&&c.name||"",u=1<this._countResults(q),A=u&&q.map(function(e){return a._moreResultsList(e)}),q=u?d.tsx("div",{key:"esri-search-renderer__more-results-button",class:"esri-search-result-renderer__more-results-item"},d.tsx("a",{class:"esri-widget__anchor",href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?k.hideMoreResults:k.showMoreResults)):null,u=u?d.tsx("div",{key:"esri-search-renderer__more-results-container",
class:"esri-search-result-renderer__more-results-list"},A):null,A=(p={},p["esri-search-result-renderer__more-results--show-more-results"]=this.showMoreResultsOpen,p);return d.tsx("div",{class:"esri-search-result-renderer esri-widget"},d.tsx("div",{key:"esri-search-renderer__container",class:this.classes("esri-search-result-renderer__more-results",A)},d.tsx("div",{key:"esri-search-renderer__result-name",class:"esri-search-result-renderer__more-results-item"},c),d.tsx("div",{key:"esri-search-renderer__more-results"},
q,u)))};r.prototype._showMoreResultsClick=function(a){a.preventDefault();this.showMoreResultsOpen=!this.showMoreResultsOpen;(a=this.get("viewModel.view.popup"))&&a.reposition()};r.prototype._selectResultClick=function(a){a.preventDefault();a=a.currentTarget["data-result"];this.viewModel&&this.viewModel.select(a)};r.prototype._moreResultsList=function(a){var e=this,c=a.results,q=c.length,u=!!q,A=this.get("viewModel.selectedResult"),q=1===q&&c[0]===A,A=this._getSourceName(a.source,a.sourceIndex),A=
1<this.get("viewModel.results").length&&!q?d.tsx("div",{key:"esri-search-result-renderer__header-"+a.sourceIndex,class:"esri-search-result-renderer__more-results-list-header"},A):null,c=u&&c.map(function(a,c){return e._moreResultsListItem(a,c)}),c=u&&!q?d.tsx("ul",{key:"esri-search-result-renderer__list-"+a.sourceIndex},c):null;return u?d.tsx("div",{key:"esri-search-result-renderer__results-"+a.sourceIndex},A,c):null};r.prototype._moreResultsListItem=function(a,c){var e=this.get("viewModel.selectedResult");
return a!==e?d.tsx("li",{key:"esri-search-result-renderer__list-item-"+c},d.tsx("a",{class:"esri-widget__anchor",href:"#",tabindex:"0",bind:this,"data-result":a,onclick:this._selectResultClick,onkeydown:this._selectResultClick},a.name)):null};r.prototype._getSourceName=function(a,c){return c===w.ALL_INDEX?k.all:a.name};r.prototype._countResults=function(a){return a?a.reduce(function(a,c){return a+c.results.length},0):0};a([d.renderable(),g.property()],r.prototype,"showMoreResultsOpen",void 0);a([g.property(),
d.renderable(["viewModel.results","viewModel.selectedResult"])],r.prototype,"viewModel",void 0);a([d.accessibleHandler()],r.prototype,"_showMoreResultsClick",null);a([d.accessibleHandler()],r.prototype,"_selectResultClick",null);return r=a([g.subclass("esri.widgets.Search.SearchResultRenderer")],r)}(g.declared(c))})},"esri/widgets/Search/SearchViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/i18n!./nls/Search ../../Graphic ../../PopupTemplate ../../core/Accessor ../../core/Collection ../../core/Error ../../core/Evented ../../core/geolocationUtils ../../core/Handles ../../core/has ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/SpatialReference ../../portal/Portal ../../styles/basic ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ../../symbols/SimpleMarkerSymbol ../../symbols/TextSymbol ../../views/support/layerViewUtils ./FeatureLayerSearchSource ./LocatorSearchSource ./SearchSource ./support/geometryUtils ./support/locatorUtils ../support/GoTo".split(" "),
function(z,v,x,a,k,g,c,w,d,n,r,e,p,h,q,u,A,b,B,C,m,f,D,E,F,K,O,P,J,M,Q,H,R,I){function y(a,b){return a.hasOwnProperty(b)&&null!=a[b]&&""!==a[b]}var G=q.getLogger("esri.widgets.Search.SearchViewModel"),N=d.ofType({key:function(a){return a.featureLayer?"feature-layer":"locator"},base:Q,typeMap:{"feature-layer":J,locator:M}}),T=C.WGS84,L=/<(?:.|\s)*?>/g;return function(q){function t(l){l=q.call(this)||this;l._handles=new p;l._gotoPromise=null;l._searching=null;l._loadingDefaultSources=null;l.allPlaceholder=
k.allPlaceholder;l.autoNavigate=!0;l.autoSelect=!0;l.defaultSources=new N;l.defaultSymbol=new D({url:z.toUrl(h("trident")?"../../images/search/search-symbol-32.png":"../../images/search/search-symbol-32.svg"),size:24,width:24,height:24});l.includeDefaultSources=!0;l.locationToAddressDistance=1500;l.maxInputLength=128;l.maxResults=6;l.maxSuggestions=6;l.minSuggestCharacters=1;l.popupEnabled=!0;l.popupTemplate=new c({title:k.searchResult,content:"{Match_addr}"});l.portal=m.getDefault();l.resultGraphicEnabled=
!0;l.resultGraphic=null;l.results=null;l.selectedSuggestion=null;l.searchAllEnabled=!0;l.selectedResult=null;l.sources=new N;l.suggestionDelay=150;l.suggestions=null;l.suggestionsEnabled=!0;l.view=null;return l}x(t,q);t.prototype.initialize=function(){var l=this;this._handles.add([A.init(this,"portal",function(l){l&&!l.loaded&&l.load()}),A.init(this,["view","portal","includeDefaultSources"],function(){return l._loadDefaultSources()}),A.on(this,["defaultSources","sources"],"change",function(){return l.notifyChange("allSources")})])};
t.prototype.destroy=function(){this.clearGraphics();this._cancelLoadingDefaultSources();this._clearLoadingDefaultSources();this._handles.destroy();this._handles=null};Object.defineProperty(t.prototype,"activeSource",{get:function(){return this.allSources.getItemAt(this.activeSourceIndex)||null},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"activeSourceIndex",{get:function(){return 1!==this.allSources.length&&this.searchAllEnabled?-1:0},set:function(l){void 0===l?this._clearOverride("activeSourceIndex"):
this._override("activeSourceIndex",l)},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"allSources",{get:function(){var l=this.sources,a=this.defaultSources,b=this.includeDefaultSources,l="function"===typeof b?b.call(null,{sources:l,defaultSources:a}):b?a.concat(l):l,a=this._get("allSources");a.removeAll();a.addMany(l.filter(Boolean));return a},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"locationEnabled",{get:function(){return this._get("locationEnabled")||
e.supported()},set:function(l){if(void 0===l)this._clearOverride("locationEnabled");else{var a=e.supported();if(l&&!a){var b=new n("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});G.error(b)}this._override("locationEnabled",l&&a)}},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"placeholder",{get:function(){var l=this.activeSourceIndex,a=this.allPlaceholder,a=void 0===a?k.allPlaceholder:a;return-1===l?a:(l=this.allSources.getItemAt(l))?
l.placeholder:""},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"searchTerm",{get:function(){return this._get("searchTerm")||""},set:function(a){this._set("searchTerm",a||"");this.clearGraphics();this.selectedSuggestion&&this.selectedSuggestion.text!==a&&this._set("selectedSuggestion",null);""===a&&this._clear()},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"state",{get:function(){return this._searching?"searching":this._loadingDefaultSources?"loading":0===
this.allSources.length?"disabled":"ready"},enumerable:!0,configurable:!0});t.prototype.clear=function(){this.searchTerm=""};t.prototype.clearGraphics=function(){this._removeHighlight();this._closePopup();this.view&&this.view.graphics.remove(this.resultGraphic);this._set("resultGraphic",null)};t.prototype.search=function(a){var l=this;this.emit("search-start");this.clearGraphics();var b=this._createSuggestionForSearch(a);this._searching=a=this._whenViewAndPortalLoaded().then(function(){return l._getResultsFromSources(b).then(function(a){var c=
{activeSourceIndex:l.activeSourceIndex,searchTerm:b.text,numResults:0,numErrors:0,errors:[],results:[]};l._formatResponse(c,a,b);a=l._getFirstResult(c.results);var e=(b.location&&a?a.name:b.text).replace(L,"");l._set("searchTerm",e);(b.key&&"number"===typeof b.sourceIndex||b.location)&&l._set("selectedSuggestion",b);l._set("results",c.results);l.emit("search-complete",c);return l._selectFirstResult(a).then(function(){return c})})});this.notifyChange("state");a.then(function(){return l._clearSearching()}).catch(function(){return l._clearSearching()});
return a};t.prototype.searchNearby=function(){var a=this;if(!this.locationEnabled){var b=new n("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});G.error(b);return u.reject(b)}this._searching=b=e.getCurrentPosition().then(function(l){return e.positionToPoint(l,a.view).then(function(l){return a.search(l)})});this.notifyChange("state");b.then(function(){return a._clearSearching()}).catch(function(){return a._clearSearching()});return b};t.prototype.select=
function(a){var l=this;this.clearGraphics();if(!a){var b=new n("select:missing-parameter","Cannot select without a searchResult.",{searchResult:a});G.error(b);return u.reject(b)}var c=this.view,e=y(a,"sourceIndex")?a.sourceIndex:this._getSourceIndexOfResult(a),f=this.allSources.getItemAt(e);if(!f)return b=new n("select:missing-source","Cannot select without a source.",{source:f}),G.error(b),u.reject(b);var b=f instanceof J?this._getSourcePopupTemplate(f):null,p=f.resultSymbol||this._getDefaultSymbol(a),
t=y(f,"resultGraphicEnabled")?f.resultGraphicEnabled:this.resultGraphicEnabled,E=y(f,"autoNavigate")?f.autoNavigate:this.autoNavigate,L=y(f,"popupEnabled")?f.popupEnabled:this.popupEnabled,D=L?b||this.popupTemplate:null,h=a.feature;if(!h)return b=new n("select:missing-feature","Cannot select without a feature.",{feature:h}),G.error(b),u.reject(b);var A=h.attributes,q=h.geometry,m=h.layer,F=h.sourceLayer,r=H.getPointFromGeometry(q),b={layerViewQuery:this._getHighlightLayerView(h),elevationQuery:c&&
r?H.getPointWithElevation(r,c).catch(function(){return r}):u.resolve(r)};return u.eachAlways(b).then(function(b){var S=b.layerViewQuery.value,V=b.elevationQuery.value;p instanceof O&&(p.text=a.name);b=c&&E?l._getGoToTarget(a,f):null;return(b?l._goToSearchResult(b):u.resolve()).then(function(){l._gotoPromise=null;var b=S?h:new g({geometry:q,symbol:p,attributes:A,layer:m,sourceLayer:F,popupTemplate:D});S?l._highlightFeature({graphic:b,layerView:S}):t&&c&&c.graphics.push(b);L&&l.get("view.popup")&&b.getEffectivePopupTemplate()&&
c.popup.open({features:[b],location:V});l._set("selectedResult",a);l._set("resultGraphic",b);l.emit("select-result",{result:a,source:f,sourceIndex:e});return a})})};t.prototype.suggest=function(a,b){var l=this,c=a||this.searchTerm;this.emit("suggest-start",{searchTerm:c});return this._suggestTimer(b).then(function(){return l._suggestImmediate(c).then(function(a){l._set("suggestions",a.results);l.emit("suggest-complete",a);return a})})};t.prototype._cancelLoadingDefaultSources=function(){var a=this._loadingDefaultSources;
a&&a.cancel()};t.prototype._clearLoadingDefaultSources=function(){this._loadingDefaultSources=null;this.notifyChange("state")};t.prototype._clearSearching=function(){this._searching=null;this.notifyChange("state")};t.prototype._convertHelperServices=function(){var a=this.get("portal.helperServices.geocode");return a?a.map(function(a){if(!1!==a.placefinding&&(a=M.fromJSON(a),R.isArcGISWorldGeocoder(a.get("locator.url"))&&a.set({singleLineFieldName:"SingleLine",outFields:["Addr_type","Match_addr","StAddr",
"City"],localSearchOptions:{minScale:3E5,distance:5E4},placeholder:k.placeholder}),a.singleLineFieldName))return a}).filter(Boolean):[]};t.prototype._convertApplicationProperties=function(){var a=this,b=this.get("view.map.applicationProperties.viewing.search"),c=this.get("view.map");if(!c||!b)return[];var f=b.hintText;return b.enabled?b.layers.map(function(l){var b=c.findLayerById(l.id);if(b){l=a._getLayerJSON(l);var e=J.fromJSON(l);e.placeholder=f;a._getFeatureLayer(b,l).then(function(a){e.featureLayer=
a});return e}}).filter(Boolean):[]};t.prototype._getSubFeatureLayer=function(a,b){return a&&a.allSublayers?(a=a.allSublayers.find(function(a){return a.id===b.subLayer}))?u.resolve(a.createFeatureLayer()):u.reject():u.reject()};t.prototype._getFeatureLayer=function(a,b){var l=this;if("feature"===a.type||"scene"===a.type)return u.resolve(a);if("map-image"===a.type)return a.load().then(function(){return l._getSubFeatureLayer(a,b).catch(function(){var b=new n("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",
{layer:a});G.error(b);return null})})};t.prototype._getLayerJSON=function(a){return"function"===typeof a.toJSON?a.toJSON():a};t.prototype._updateDefaultSources=function(){var a=this.defaultSources,b=this.includeDefaultSources;a.removeAll();b&&a.addMany(this._convertApplicationProperties().concat(this._convertHelperServices()));this.notifyChange("allSources")};t.prototype._clear=function(){this._gotoPromise&&(this._gotoPromise.cancel(),this._gotoPromise=null);this._set("results",null);this._set("suggestions",
null);this._set("selectedResult",null);this._set("selectedSuggestion",null);this.emit("search-clear")};t.prototype._closePopup=function(){var a=this.get("view.popup"),b=this.resultGraphic;if(a&&b){var c=a.selectedFeature;c&&c===b&&a.close()}};t.prototype._suggestTimer=function(a){return u.after(null!=a?a:this.suggestionDelay)};t.prototype._createLocationForSearch=function(a){if(a instanceof g)return H.getPointFromGeometry(a.geometry);if(a instanceof B)return a;if(Array.isArray(a)&&2===a.length)return new B({longitude:a[0],
latitude:a[1]})};t.prototype._createSuggestionForSearch=function(a){if(a&&y(a,"key")&&y(a,"text")&&y(a,"sourceIndex"))return a;var b=this._createLocationForSearch(a)||null,l="string"===typeof a?a:this.searchTerm,c=this.selectedSuggestion,f=this.selectedResult,e=(a=!a&&c&&f)&&c.location;return a&&c.key===f.key&&c.sourceIndex===f.sourceIndex||e?c:{location:b,text:b?"":l,sourceIndex:null,key:null}};t.prototype._getFirstResult=function(a){var b=null;a&&a.some(function(a){a=a.results[0];var c=!!a;c&&(b=
a);return c});return b};t.prototype._selectFirstResult=function(a){return this.autoSelect&&a?this.select(a):u.resolve()};t.prototype._suggestImmediate=function(a){var b=this;return this._whenViewAndPortalLoaded().then(function(){return b._getSuggestionsFromSources(a)}).then(function(c){var l={activeSourceIndex:b.activeSourceIndex,searchTerm:a,numResults:0,numErrors:0,errors:[],results:[]};b._formatResponse(l,c);return l})};t.prototype._formatSourceResponse=function(a,b,c){var l=b&&b.value||[];b=b&&
b.error;var f=this.allSources.getItemAt(c);b?(a.errors.push({sourceIndex:c,source:f,error:b}),a.numErrors++):(a.results.push({sourceIndex:c,source:f,results:l}),a.numResults+=l.length)};t.prototype._formatResponse=function(a,b,c){var l=this;if(b)if(-1===a.activeSourceIndex){var f=c&&y(c,"sourceIndex")&&-1!==c.sourceIndex?c.sourceIndex:void 0;b.forEach(function(b,c){l._formatSourceResponse(a,b,void 0!==f?f:c)})}else this._formatSourceResponse(a,b[0],a.activeSourceIndex)};t.prototype._getResultsFromSources=
function(a){var b=this,c=this.allSources,f=!a.location&&y(a,"sourceIndex")?a.sourceIndex:this.activeSourceIndex,l=[];if(!c.length)return c=new n("search:no-sources-defined","At least one source is required.",{allSources:c}),G.error(c),u.reject(c);-1===f?c.forEach(function(c,f){l.push(b._getResultsFromSource(a,f))}):l.push(this._getResultsFromSource(a,f));return u.eachAlways(l)};t.prototype._getSuggestionsFromSources=function(a){var b=this,c=this.allSources,f=this.activeSourceIndex,l=[];if(!c.length)return c=
new n("suggest:no-sources-defined","At least one source is required.",{allSources:c}),G.error(c),u.reject(c);-1===f?c.forEach(function(c,f){l.push(b._getSuggestionsFromSource(a,f))}):l.push(this._getSuggestionsFromSource(a,f));return u.eachAlways(l)};t.prototype._getResultsFromSource=function(a,b){var c=this.allSources.getItemAt(b),f=a.location,f=void 0===f?null:f,l=this.get("view.spatialReference")||T,e=y(c,"maxResults")?c.maxResults:this.maxResults,p=c instanceof J&&y(c,"exactMatch")?c.exactMatch:
!1,t=c instanceof M&&y(c,"locationToAddressDistance")?c.locationToAddressDistance:this.locationToAddressDistance;return c.getResults({view:this.view,sourceIndex:b,location:f,suggestResult:a,spatialReference:l,exactMatch:p,maxResults:e,distance:t})};t.prototype._getSuggestionsFromSource=function(a,b){var c=this.allSources.getItemAt(b),f=y(c,"suggestionsEnabled")?c.suggestionsEnabled:this.suggestionsEnabled,l=a.trim().length,e=y(c,"minSuggestCharacters")?c.minSuggestCharacters:this.minSuggestCharacters;
return f&&l>=e?(f=this.get("view.spatialReference")||T,l=y(c,"maxSuggestions")?c.maxSuggestions:this.maxSuggestions,c.getSuggestions({view:this.view,sourceIndex:b,suggestTerm:a,spatialReference:f,maxSuggestions:l})):u.resolve()};t.prototype.createDefaultSymbol=function(a,b){if("point"===b)return new K({color:a.color,size:a.size,outline:{color:a.outline.color,width:a.outline.width}});if("polyline"===b)return new F({color:a.color,width:a.width});if("polygon"===b)return new E({color:a.color,outline:{color:a.outline.color,
width:a.outline.width}})};t.prototype._getSourcePopupTemplate=function(a){var b=a.featureLayer;if(b)return y(a,"popupTemplate")?a.popupTemplate:b.popupTemplate};t.prototype._getSourceIndexOfResult=function(a){var b=null;this.results.some(function(c){return c.results.some(function(f){if(f===a)return b=c.sourceIndex,!0})});return b};t.prototype._getGoToTarget=function(a,b){var c=a.extent;a=a.feature;return b instanceof J?a||c:c||a};t.prototype._goToSearchResult=function(a){var b=!!a;a=this.callGoTo({target:{target:a},
options:{animate:b}});b&&(this._gotoPromise=a);return a};t.prototype._whenViewAndPortalLoaded=function(){var a=this.portal,b=this.view,b=b?b.when():u.resolve(),a=a?a.when():u.resolve();return u.eachAlways([b,a]).then(function(){})};t.prototype._loadDefaultSources=function(){var a=this,b=this.includeDefaultSources;this._cancelLoadingDefaultSources();this._clearLoadingDefaultSources();var b=b?this._whenViewAndPortalLoaded():u.resolve(),c=!1;b.catch(function(){}).then(function(){c=!0;a._clearLoadingDefaultSources();
a._updateDefaultSources()});c||(this._loadingDefaultSources=b,this.notifyChange("state"));return b};t.prototype._getDefaultSymbol=function(a){var b=this.get("view.map.basemap.id");if(a=a&&a.feature&&a.feature.geometry&&a.feature.geometry.type)if(b=(b=f.getSchemes({theme:"default",basemap:b||"topo",geometryType:a}))&&b.primaryScheme)return b.color&&y(b,"opacity")&&(b.color.a=b.opacity),this.createDefaultSymbol(b,a);return this.defaultSymbol};t.prototype._removeHighlight=function(){this._handles.remove("highlight")};
t.prototype._getHighlightLayerView=function(a){var b=this.view;if(!a||!b)return u.resolve(null);var c=a.layer;return b.when().then(function(){return b.whenLayerView(c).then(function(a){return P.hasHighlight(a)?a:null})})};t.prototype._highlightFeature=function(a){var b=a.graphic,c=b.attributes,f=b.layer.objectIdField;a=a.layerView.highlight(c&&c[f]||b);this._handles.add(a,"highlight")};t.ALL_INDEX=-1;a([b.property({readOnly:!0,dependsOn:["activeSourceIndex","allSources.length"],value:null})],t.prototype,
"activeSource",null);a([b.property({dependsOn:["allSources.length","searchAllEnabled"]})],t.prototype,"activeSourceIndex",null);a([b.property()],t.prototype,"allPlaceholder",void 0);a([b.property({value:new N,dependsOn:["defaultSources.length","sources.length","includeDefaultSources"],readOnly:!0})],t.prototype,"allSources",null);a([b.property()],t.prototype,"autoNavigate",void 0);a([b.property()],t.prototype,"autoSelect",void 0);a([b.property({readOnly:!0})],t.prototype,"defaultSources",void 0);
a([b.property()],t.prototype,"defaultSymbol",void 0);a([b.property()],t.prototype,"includeDefaultSources",void 0);a([b.property()],t.prototype,"locationEnabled",null);a([b.property()],t.prototype,"locationToAddressDistance",void 0);a([b.property()],t.prototype,"maxInputLength",void 0);a([b.property()],t.prototype,"maxResults",void 0);a([b.property()],t.prototype,"maxSuggestions",void 0);a([b.property()],t.prototype,"minSuggestCharacters",void 0);a([b.property({readOnly:!0,dependsOn:["activeSourceIndex",
"activeSource.placeholder","allPlaceholder","allSources"]})],t.prototype,"placeholder",null);a([b.property()],t.prototype,"popupEnabled",void 0);a([b.property({type:c})],t.prototype,"popupTemplate",void 0);a([b.property({type:m})],t.prototype,"portal",void 0);a([b.property()],t.prototype,"resultGraphicEnabled",void 0);a([b.property({readOnly:!0})],t.prototype,"resultGraphic",void 0);a([b.property({readOnly:!0})],t.prototype,"results",void 0);a([b.property({readOnly:!0})],t.prototype,"selectedSuggestion",
void 0);a([b.property()],t.prototype,"searchAllEnabled",void 0);a([b.property({readOnly:!0})],t.prototype,"selectedResult",void 0);a([b.property()],t.prototype,"searchTerm",null);a([b.property({type:N})],t.prototype,"sources",void 0);a([b.property({readOnly:!0,dependsOn:["allSources.length"]})],t.prototype,"state",null);a([b.property()],t.prototype,"suggestionDelay",void 0);a([b.property({readOnly:!0})],t.prototype,"suggestions",void 0);a([b.property()],t.prototype,"suggestionsEnabled",void 0);a([b.property()],
t.prototype,"view",void 0);a([b.property()],t.prototype,"clear",null);return t=a([b.subclass("esri.widgets.Search.SearchViewModel")],t)}(b.declared(w,r,I))})},"esri/core/geolocationUtils":function(){define("require exports ./tsSupport/assignHelper ../config ./Error ./has ./Logger ./promiseUtils ../geometry/Point ../geometry/support/webMercatorUtils ../portal/Portal ../tasks/GeometryService ../tasks/support/ProjectParameters".split(" "),function(z,v,x,a,k,g,c,w,d,n,r,e,p){function h(a,c){var b=c.spatialReference;
return b.isWGS84?w.resolve(a):b.isWebMercator?w.resolve(n.geographicToWebMercator(a)):q().then(function(c){if(!c)return w.reject(new k("geometry-service:missing-url","Geometry service URL is missing"));c=new e({url:c});var f=new p({geometries:[a],outSR:b});return c.project(f).then(function(a){return a[0]})})}function q(){if(a.geometryServiceUrl)return w.resolve(a.geometryServiceUrl);var b=r.getDefault();return b.load().catch(function(a){}).then(function(){return b.get("helperServices.geometry.url")})}
Object.defineProperty(v,"__esModule",{value:!0});var u=c.getLogger("esri.core.geolocationUtils"),A={maximumAge:0,timeout:15E3,enableHighAccuracy:!0};v.supported=function(){var a=g("esri-geolocation");a||u.warn("geolocation-unsupported","Geolocation unsupported.");a&&((a=g("esri-secure-context"))||u.warn("insecure-context","Geolocation requires a secure origin."));return a};v.getCurrentPosition=function(a){a||(a=A);var b=w.create(function(b,c){navigator.geolocation.getCurrentPosition(b,c,a)});return w.timeout(b,
15E3,void 0)};v.positionToPoint=function(a,c){var b=a&&a.coords||{},b={accuracy:b.accuracy,altitude:b.altitude,altitudeAccuracy:b.altitudeAccuracy,heading:b.heading,latitude:b.latitude,longitude:b.longitude,speed:b.speed};a=a?{coords:b,timestamp:a.timestamp}:a;a=(a=a&&a.coords)?new d({longitude:a.longitude,latitude:a.latitude,z:a.altitude||null,spatialReference:{wkid:4326}}):null;return h(a,c)}})},"esri/styles/basic":function(){define(["../core/lang","../Color"],function(z,v){function x(a,c){var g;
if(a)switch(g={},g.color=new v(a.color),c){case "point":g.outline={color:new v(a.outline.color),width:a.outline.width};g.size=a.size;break;case "polyline":g.width=a.width;break;case "polygon":g.outline={color:new v(a.outline.color),width:a.outline.width}}return g}var a={"default":{name:"default",label:"Default",description:"Default theme for basic visualization of features.",basemapGroups:{light:"streets gray topo terrain national-geographic oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector".split(" "),
dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},pointSchemes:{light:{primary:{color:[77,77,77,1],outline:{color:[255,255,255,1],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,1],width:1},size:8},{color:[255,255,255,1],outline:{color:[51,51,51,1],width:1},size:8}]},dark:{primary:{color:[255,255,255,1],outline:{color:[26,26,26,1],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,1],width:1},size:8},{color:[26,
26,26,1],outline:{color:[178,178,178,1],width:1},size:8}]}},lineSchemes:{light:{primary:{color:[77,77,77,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[255,255,255,1],width:2}]},dark:{primary:{color:[255,255,255,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[26,26,26,1],width:2}]}},polygonSchemes:{light:{primary:{color:[227,139,79,.8],outline:{color:[255,255,255,1],width:1}},secondary:[{color:[128,128,128,.8],outline:{color:[255,255,255,1],width:1}},{color:[255,255,255,
.8],outline:{color:[128,128,128,1],width:1}}]},dark:{primary:{color:[227,139,79,.8],outline:{color:[51,51,51,1],width:1}},secondary:[{color:[178,178,178,.8],outline:{color:[51,51,51,1],width:1}},{color:[26,26,26,.8],outline:{color:[128,128,128,1],width:1}}]}}}},k={};(function(){var g,c,w,d,n,r,e,p;for(g in a)for(d in c=a[g],w=c.basemapGroups,n=k[g]={basemaps:[].concat(w.light).concat(w.dark),point:{},polyline:{},polygon:{}},w)for(r=w[d],e=0;e<r.length;e++)p=r[e],c.pointSchemes&&(n.point[p]=c.pointSchemes[d]),
c.lineSchemes&&(n.polyline[p]=c.lineSchemes[d]),c.polygonSchemes&&(n.polygon[p]=c.polygonSchemes[d])})();return{getAvailableThemes:function(g){var c=[],w,d,n;for(w in a)d=a[w],n=k[w],g&&n.basemaps&&-1===n.basemaps.indexOf(g)||c.push({name:d.name,label:d.label,description:d.description,basemaps:n.basemaps.slice(0)});return c},getSchemes:function(a){var c=a.basemap,g=a.geometryType;a=k[a.theme];var d;(a=(a=a&&a[g])&&a[c])&&(d={primaryScheme:x(a.primary,g),secondarySchemes:a.secondary.map(function(a){return x(a,
g)})});return d},cloneScheme:function(a){var c;a&&(c=z.mixin({},a),c.color&&(c.color=new v(c.color)),c.outline&&(c.outline={color:c.outline.color&&new v(c.outline.color),width:c.outline.width}));return c}}})},"esri/widgets/Search/FeatureLayerSearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/lang ../../core/accessorSupport/decorators ../../layers/CSVLayer ../../layers/FeatureLayer ../../layers/Layer ../../layers/SceneLayer ./SearchSource ./support/featureLayerUtils".split(" "),
function(z,v,x,a,k,g,c,w,d,n,r,e,p){return function(e){function h(){var a=null!==e&&e.apply(this,arguments)||this;a.displayField=null;a.exactMatch=null;a.searchFields=null;a.searchQueryParams=null;a.searchTemplate=null;a.suggestionTemplate=null;a.suggestQueryParams=null;return a}x(h,e);u=h;Object.defineProperty(h.prototype,"featureLayer",{set:function(a){this._set("featureLayer",a);a&&a.load()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"name",{get:function(){return this._getFeatureLayerTitle()||
""},set:function(a){void 0===a?this._clearOverride("name"):this._override("name",a)},enumerable:!0,configurable:!0});h.prototype.clone=function(){return new u({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?g.clone(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?
this.resultSymbol.clone():null,searchExtent:this.searchExtent?this.searchExtent.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,featureLayer:this.featureLayer,searchFields:this.searchFields?g.clone(this.searchFields):null,searchQueryParams:this.searchQueryParams?g.clone(this.searchQueryParams):null,suggestionTemplate:this.suggestionTemplate,suggestQueryParams:this.suggestQueryParams?
g.clone(this.suggestQueryParams):null,zoomScale:this.zoomScale})};h.prototype.getResults=function(a){return p.getResults(k({source:this},a))};h.prototype.getSuggestions=function(a){return p.getSuggestions(k({source:this},a))};h.prototype._getFirstStringField=function(){var a=this.featureLayer,b="";a&&a.fields&&a.fields.some(function(a){if("string"===a.type)return b=a.name,!0});return b};h.prototype._getDisplayField=function(){return this.displayField||this.featureLayer.displayField||this._getFirstStringField()};
h.prototype._getFeatureLayerTitle=function(){var a=this.featureLayer;if(a){var b=a.title;if(b){var c="";(this.searchFields||[this._getDisplayField()]).forEach(function(b,e){c+=0===e?": ":", ";e=a.getField(b);c+=e&&e.alias||b});return""+b+c}}};var u;a([c.property({json:{read:{source:"field.name"},write:{target:"field.name"}}})],h.prototype,"displayField",void 0);a([c.property({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],h.prototype,"exactMatch",void 0);a([c.property({types:{key:"type",
base:n,defaultKeyValue:"feature",typeMap:{feature:d,csv:w,scene:r}},value:null})],h.prototype,"featureLayer",null);a([c.property({dependsOn:["featureLayer.title"]})],h.prototype,"name",null);a([c.property()],h.prototype,"searchFields",void 0);a([c.property()],h.prototype,"searchQueryParams",void 0);a([c.property()],h.prototype,"searchTemplate",void 0);a([c.property()],h.prototype,"suggestionTemplate",void 0);a([c.property()],h.prototype,"suggestQueryParams",void 0);return h=u=a([c.subclass("esri.widgets.Search.FeatureLayerSearchSource")],
h)}(c.declared(e))})},"esri/layers/CSVLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/tsSupport/paramHelper ../geometry ../core/urlUtils ../core/accessorSupport/decorators ./FeatureLayer ./graphics/data/QueryEngineCapabilities ./graphics/sources/CSVSource ../tasks/support/Query".split(" "),function(z,v,x,a,k,g,c,w,d,n,r,e,p){return function(h){function q(a,e){a=h.call(this)||this;a.delimiter=null;
a.fields=null;a.latitudeField=null;a.locationType="coordinates";a.longitudeField=null;a.operationalLayerType="CSV";a.outFields=["*"];a.portalItem=null;a.spatialReference=c.SpatialReference.WGS84;a.source=null;a.type="csv";return a}x(q,h);q.prototype.normalizeCtorArgs=function(a,c){return"string"===typeof a?k({url:a},c):a};Object.defineProperty(q.prototype,"capabilities",{get:function(){return{data:{supportsAttachment:!1,supportsM:!1,supportsZ:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,
supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsQuery:!0,supportsResizeAttachments:!1,supportsUpdate:!1},query:r.queryCapabilities,queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},editing:{supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}},enumerable:!0,
configurable:!0});Object.defineProperty(q.prototype,"hasService",{get:function(){return!1},enumerable:!0,configurable:!0});q.prototype.readWebMapLabelsVisible=function(a,c){return null!=c.showLabels?c.showLabels:!!(c.layerDefinition&&c.layerDefinition.drawingInfo&&c.layerDefinition.drawingInfo.labelingInfo)};Object.defineProperty(q.prototype,"url",{set:function(a){this._set("url",a)},enumerable:!0,configurable:!0});q.prototype.createGraphicsSource=function(){var a=this,c=new e.default({delimiter:this.delimiter,
fields:this.fields,latitudeField:this.latitudeField,longitudeField:this.longitudeField,spatialReference:this.spatialReference,url:this.url});this._set("source",c);return c.load().then(function(){a.read({locationInfo:c.locationInfo,columnDelimiter:c.columnDelimiter},{origin:"service",url:a.parsedUrl});return c})};q.prototype.queryFeatures=function(a,c){var b=this;return this.load().then(function(){return b.source.queryFeatures(a||b.createQuery())}).then(function(a){if(a&&a.features)for(var c=0,e=a.features;c<
e.length;c++){var f=e[c];f.layer=f.sourceLayer=b}return a})};q.prototype.queryObjectIds=function(a,c){var b=this;return this.load().then(function(){return b.source.queryObjectIds(a||b.createQuery())})};q.prototype.queryFeatureCount=function(a,c){var b=this;return this.load().then(function(){return b.source.queryFeatureCount(a||b.createQuery())})};q.prototype.queryExtent=function(a,c){var b=this;return this.load().then(function(){return b.source.queryExtent(a||b.createQuery())})};q.prototype._verifyFields=
function(){};q.prototype._verifySource=function(){};q.prototype._hasMemorySource=function(){return!0};a([d.property({readOnly:!0,dependsOn:["loaded"],json:{read:!1,write:!1}})],q.prototype,"capabilities",null);a([d.property({type:String,json:{read:{source:"columnDelimiter"},write:{target:"columnDelimiter",ignoreOrigin:!0}}})],q.prototype,"delimiter",void 0);a([d.property({json:{read:{source:"layerDefinition.fields"}}})],q.prototype,"fields",void 0);a([d.property({readOnly:!0})],q.prototype,"hasService",
null);a([d.reader("web-map","labelsVisible",["layerDefinition.drawingInfo.labelingInfo","showLabels"])],q.prototype,"readWebMapLabelsVisible",null);a([d.property({type:String,json:{read:{source:"locationInfo.latitudeFieldName"},write:{target:"locationInfo.latitudeFieldName",ignoreOrigin:!0}}})],q.prototype,"latitudeField",void 0);a([d.property({type:String,json:{read:{source:"locationInfo.locationType"},write:{target:"locationInfo.locationType",ignoreOrigin:!0,isRequired:!0}}})],q.prototype,"locationType",
void 0);a([d.property({type:String,json:{read:{source:"locationInfo.longitudeFieldName"},write:{target:"locationInfo.longitudeFieldName",ignoreOrigin:!0}}})],q.prototype,"longitudeField",void 0);a([d.property({type:["CSV"]})],q.prototype,"operationalLayerType",void 0);a([d.property()],q.prototype,"outFields",void 0);a([d.property({json:{read:!1,write:!1}})],q.prototype,"portalItem",void 0);a([d.property({json:{read:!1},cast:null,type:e.default,readOnly:!0})],q.prototype,"source",void 0);a([d.property({json:{read:!1},
value:"csv",readOnly:!0})],q.prototype,"type",void 0);a([d.property({json:{read:w.read,write:w.write}})],q.prototype,"url",null);a([g(0,d.cast(p))],q.prototype,"queryFeatures",null);a([g(0,d.cast(p))],q.prototype,"queryObjectIds",null);a([g(0,d.cast(p))],q.prototype,"queryFeatureCount",null);a([g(0,d.cast(p))],q.prototype,"queryExtent",null);return q=a([d.subclass("esri.layers.CSVLayer")],q)}(d.declared(n))})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["require","exports"],
function(z,v){Object.defineProperty(v,"__esModule",{value:!0});v.queryCapabilities={supportsStatistics:!0,supportsCentroid:!0,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1}})},
"esri/layers/graphics/sources/CSVSource":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../geometry ../../../core/Accessor ../../../core/has ../../../core/Loadable ../../../core/promiseUtils ../../../core/requireUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../tasks/support/FeatureSet module".split(" "),function(z,v,x,a,k,g,c,w,d,n,r,e,p,h){Object.defineProperty(v,"__esModule",{value:!0});c.add("esri-workers-for-memory-layers",
!1);g=function(q){function u(a){a=q.call(this,a)||this;a.type="csv";return a}x(u,q);u.prototype.load=function(){var a=this,b;b=d.resolve();this.addResolvingPromise(b.then(function(){return r.open(n.getAbsMid("./support/CSVSourceWorker",z,h),{strategy:c("esri-workers-for-memory-layers")?"dedicated":"local"}).then(function(b){a._connection=b;return b.invoke("load",{url:a.url,parsing:{columnDelimiter:a.delimiter,fields:a.fields&&a.fields.map(function(a){return a.toJSON()}),latitudeField:a.latitudeField,
longitudeField:a.longitudeField,spatialReference:a.spatialReference&&a.spatialReference.toJSON()}})}).then(function(b){a.locationInfo=b.locationInfo;a.layerDefinition=b.layerDefinition;a.columnDelimiter=b.columnDelimiter})}));return this.when()};u.prototype.destroy=function(){this._connection&&this._connection.close()};u.prototype.openPorts=function(){var a=this;return this.load().then(function(){return a._connection.openPorts()})};u.prototype.queryFeatures=function(a){var b=this;return this.load().then(function(){return b._connection.invoke("queryFeatures",
a?a.toJSON():null)}).then(function(a){return p.fromJSON(a)})};u.prototype.queryFeaturesJSON=function(a){var b=this;return this.load().then(function(){return b._connection.invoke("queryFeatures",a?a.toJSON():null)})};u.prototype.queryFeatureCount=function(a){var b=this;return this.load().then(function(){return b._connection.invoke("queryFeatureCount",a?a.toJSON():null)})};u.prototype.queryObjectIds=function(a){var b=this;return this.load().then(function(){return b._connection.invoke("queryObjectIds",
a?a.toJSON():null)})};u.prototype.queryExtent=function(a){var b=this;return this.load().then(function(){return b._connection.invoke("queryExtent",a?a.toJSON():null)}).then(function(a){return{count:a.count,extent:k.Extent.fromJSON(a.extent)}})};a([e.property()],u.prototype,"type",void 0);a([e.property()],u.prototype,"url",void 0);a([e.property()],u.prototype,"delimiter",void 0);a([e.property()],u.prototype,"fields",void 0);a([e.property()],u.prototype,"latitudeField",void 0);a([e.property()],u.prototype,
"longitudeField",void 0);a([e.property()],u.prototype,"spatialReference",void 0);a([e.property()],u.prototype,"locationInfo",void 0);a([e.property()],u.prototype,"layerDefinition",void 0);a([e.property()],u.prototype,"columnDelimiter",void 0);return u=a([e.subclass("esri.layers.graphics.sources.CSVSource")],u)}(e.declared(g,w));v.default=g})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../PopupTemplate ../request ../core/Error ../core/Logger ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ./FeatureLayer ./Layer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/Field ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../portal/PortalItem ../renderers/support/jsonUtils ../renderers/support/styleUtils ../renderers/support/typeUtils ../tasks/support/Query".split(" "),
function(z,v,x,a,k,g,c,w,d,n,r,e,p,h,q,u,A,b,B,C,m,f,D,E,F,K,O,P,J,M,Q){function H(a,b,c){a&&((a=P.read(a,b,c)||void 0)||I.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var R=["3DObject","Point"],I=d.getLogger("esri.layers.SceneLayer"),y={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
G={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(u){function d(a,b){a=u.call(this)||this;a.featureReduction=null;a.rangeInfos=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=[];a.definitionExpression=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=
!0;return a}a(d,u);d.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?x({url:a},b):a};d.prototype.getField=function(a){return D.getField(a,this.fields)};Object.defineProperty(d.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this.loaded&&this._validateElevationInfo()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"geometryType",{get:function(){return G[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"renderer",{set:function(a){D.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});d.prototype.readCachedDrawingInfo=function(a,b){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};d.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a||void 0};d.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&y[a])return y[a];I.error("Unknown or missing profile",
{profile:a,layer:this});return"mesh-pyramids"};d.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).then(function(){return a._fetchService()},function(){return a._fetchService()}).then(function(){return n.all([a._verifyRootNodeAndUpdateExtent(),a._setCompanionFeatureLayer()])}).then(function(){return a._validateElevationInfo()}).then(function(){return a._applyCompanionOverrides()}).then(function(){return a._populateFieldUsageInfo()}).then(function(){return J.loadStyleRenderer(a,
{origin:"service"})}).then(function(){return D.fixRendererFields(a.renderer,a.fields)});this.addResolvingPromise(b);return this.when()};d.prototype.createLayerView=function(a){var b=this;return(null==this.profile||"mesh-pyramids"===this.profile?n.create(function(a){return z(["../views/3d/layers/SceneLayerView3D"],a)}):n.create(function(a){return z(["../views/3d/layers/SceneLayerGraphicsView3D"],a)})).then(function(c){return new c({view:a,layer:b})})};d.prototype.createQuery=function(){var a=new Q;
"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};d.prototype.queryExtent=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryExtent(a||b.createQuery())})};d.prototype.queryFeatureCount=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatureCount(a||b.createQuery())})};d.prototype.queryFeatures=function(a){var b=this;
return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatures(a||b.createQuery())}).then(function(a){if(a&&a.features)for(var c=0,f=a.features;c<f.length;c++){var e=f[c];e.layer=b;e.sourceLayer=b}return a})};d.prototype.queryObjectIds=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryObjectIds(a||b.createQuery())})};d.prototype.getFieldUsageInfo=function(a){var b={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,
supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[a]||b:(I.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),b)};d.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});var b=this.associatedLayer;return null!=b?n.resolve(b):n.reject(new w("scenelayer:query-not-available","SceneLayer queries are not available without associated feature layer"))};d.prototype.hasCachedStatistics=
function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})};d.prototype.queryCachedStatistics=function(a){if(!this.hasCachedStatistics(a))return n.reject(new w("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var b=0,f=this.statisticsInfo;b<f.length;b++){var e=f[b];if(e.name===a)return a=r.join(this.parsedUrl.path,e.href),c(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}};d.prototype.graphicChanged=
function(a){this.emit("graphic-update",a)};d.prototype._validateLayer=function(a){if(a.layerType&&-1===R.indexOf(a.layerType))throw new w("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new w("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new w("layer:service-version-too-new",
"Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,c=!1,f=!1;if(null==a)f=c=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":c=!0;f=b;break;case "vertex-reference-frame":c=!0;f=!b;break;default:c=!1}if(!c)throw new w("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!f)throw new w("scenelayer:incompatible-normal-reference-frame",
"Normal reference frame is incompatible with layer spatial reference.");};d.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),f=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||f,supportsLayerQuery:f}},
b=this,c=0,f=this.fields;c<f.length;c++)a(f[c])};d.prototype._applyCompanionOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var a=0,b=this.associatedLayer.fields;a<b.length;a++){var c=b[a];this.getField(c.name)||this.fields.push(c.clone())}a=["popupTemplate","popupEnabled"];b=h.getProperties(this);for(c=0;c<a.length;c++){var f=a[c];this._buddyIsMoreImportant(f)&&(b.setDefaultOrigin(this.associatedLayer.originOf(f)),b.set(f,this.associatedLayer[f]),b.setDefaultOrigin("user"))}}};
d.prototype._setCompanionFeatureLayer=function(){var a=this;return this._fetchCompanionFeatureLayer().then(function(b){a.associatedLayer=b})};d.prototype._fetchCompanionFeatureLayer=function(){var a=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?n.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchCompanionFeatureLayerFromRelatedItems(this.portalItem):this._fetchCompanionFeatureLayerFromUrl()).then(function(a){return a.load()}).catch(function(b){null==a.attributeStorageInfo?
I.warn("Companion FeatureLayer could not be loaded and no binary attributes found. Popups will not work for this SceneLayer: "+a.title):I.info("Companion FeatureLayer could not be loaded. Falling back to binary attributes for Popups on this SceneLayer: "+a.title);return null})};d.prototype._fetchCompanionFeatureLayerFromRelatedItems=function(a){var b=this;return a.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"}).then(function(a){return(a=a.filter(function(a){return"Feature Service"===
a.type})[0])?b._fetchCompanionFeatureLayerFromPortalItem(new O({id:a.id,portal:a.portal})):n.reject()}).catch(function(){return b._fetchCompanionFeatureLayerFromUrl()})};d.prototype._fetchCompanionFeatureLayerFromPortalItem=function(a){var b=this;return a.load().then(function(a){return b._findMatchingCompanionSublayerUrl(a.url)}).then(function(b){return n.resolve(new q({url:b,portalItem:a}))})};d.prototype._fetchCompanionFeatureLayerFromUrl=function(){return this._findMatchingCompanionSublayerUrl().then(function(a){return n.resolve(new q({url:a}))})};
d.prototype._findMatchingCompanionSublayerUrl=function(a){var b=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!b)return n.reject();null==a&&(a=b[1]+"/FeatureServer");var f=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");a={query:{f:"json"},responseType:"json"};var e=b[1]+"/SceneServer",p=parseInt(b[2],10),b=c(e,a).catch(function(a){return{data:{layers:null}}});a=c(f,a);return n.all([a,b]).then(function(a){var b=a[0];a=a[1];a=a.data&&a.data.layers;b=b.data&&b.data.layers;
if(!Array.isArray(b))throw Error("expected layers array");if(Array.isArray(a))for(var c=0;c<Math.min(a.length,b.length);c++){if(a[c].id===p)return f+"/"+b[c].id}else if(p<b.length)return f+"/"+b[p].id;throw Error("could not find matching associated sublayer");})};d.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var b=p.nameToId(this.originOf(a));a=p.nameToId(this.associatedLayer.originOf(a));return null!=a&&a<=p.OriginId.SERVICE?null==b||b<p.OriginId.SERVICE:null!=a&&
a<=p.OriginId.PORTAL_ITEM?null==b||b<p.OriginId.PORTAL_ITEM:!1};d.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("mesh-pyramids"===this.profile&&"absolute-height"!==a.mode&&I.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&I.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};k([e.shared("esri.layers.SceneLayer")],d.prototype,"declaredClass",
void 0);k([e.property({types:{key:"type",base:C.default,typeMap:{selection:m.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],d.prototype,"featureReduction",void 0);k([e.property({type:[K.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],d.prototype,"rangeInfos",void 0);k([e.property()],d.prototype,"associatedLayer",void 0);
k([e.property({type:["ArcGISSceneServiceLayer"]})],d.prototype,"operationalLayerType",void 0);k([e.property({json:{read:!1},readOnly:!0})],d.prototype,"type",void 0);k([e.property({type:[f]})],d.prototype,"fields",void 0);k([e.property({readOnly:!0})],d.prototype,"attributeStorageInfo",void 0);k([e.property({readOnly:!0})],d.prototype,"statisticsInfo",void 0);k([e.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression"}}})],
d.prototype,"definitionExpression",void 0);k([e.property(b.elevationInfo)],d.prototype,"elevationInfo",null);k([e.property({type:String,dependsOn:["profile"]})],d.prototype,"geometryType",null);k([e.property(b.labelsVisible)],d.prototype,"labelsVisible",void 0);k([e.property({type:[E],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:F.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:F.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],
d.prototype,"labelingInfo",void 0);k([e.property(b.legendEnabled)],d.prototype,"legendEnabled",void 0);k([e.property({types:M.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:H}}},read:{source:"layerDefinition.drawingInfo.renderer",reader:H},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],d.prototype,"renderer",null);k([e.property({json:{read:!1}})],d.prototype,"cachedDrawingInfo",void 0);k([e.reader("service","cachedDrawingInfo")],d.prototype,"readCachedDrawingInfo",
null);k([e.property(b.popupEnabled)],d.prototype,"popupEnabled",void 0);k([e.property({type:g,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],d.prototype,"popupTemplate",void 0);k([e.property({type:String,json:{read:!1}})],d.prototype,"objectIdField",void 0);k([e.reader("service","objectIdField",["objectIdField","fields"])],d.prototype,"readObjectIdField",null);k([e.property()],d.prototype,"objectIdFilter",void 0);k([e.property({type:String,json:{read:!1}})],d.prototype,"profile",void 0);
k([e.reader("service","profile",["store.profile"])],d.prototype,"readProfile",null);k([e.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],d.prototype,"normalReferenceFrame",void 0);k([e.property(B.screenSizePerspectiveEnabled)],d.prototype,"screenSizePerspectiveEnabled",void 0);return d=k([e.subclass()],d)}(e.declared(u,A))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/Error ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../Layer ./ArcGISService ./OperationalLayer ./PortalLayer ../support/arcgisLayerUrl ../support/commonProperties".split(" "),
function(z,v,x,a,k,g,c,w,d,n,r,e,p,h,q,u,A,b,B,C){var m=c.getLogger("esri.layers.mixins.SceneService");return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}x(c,b);c.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};
c.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return h.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new h(a):null};c.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent||!Array.isArray(a.extent)||a.extent.some(function(a){return-1E38>a})?null:new e({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],
spatialReference:b})};c.prototype.readVersion=function(a,b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};c.prototype.readTitlePortalItem=function(a,b){return"item-title"!==this.sublayerTitleMode?void 0:a};c.prototype.readTitleService=function(a,b){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return B.titleFromUrlAndName(this.url,
b.name);b=b.name||B.parse(this.url).title;"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return B.cleanTitle(b)};c.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(c.prototype,"url",{set:function(a){a=B.sanitizeUrlWithLayerId(this,a,m);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});c.prototype.writeUrl=function(a,b,c,f){B.writeUrlWithLayerId(this,a,"layers",b,f)};Object.defineProperty(c.prototype,
"parsedUrl",{get:function(){var a=this._get("url");if(!a)return null;a=n.urlToObject(a);null!=this.layerId&&B.match.test(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});c.prototype.readRootNode=function(a,b){return b.store.rootNode};c.prototype._verifyRootNodeAndUpdateExtent=function(){var a=this;return this._fetchRootNode().then(function(b){return a._updateExtentFromRootNode(b)})};c.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&
!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};c.prototype._fetchRootNode=function(){if(!this.rootNode)return d.resolve();var a=n.join(this.parsedUrl.path,this.rootNode);return k(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}).catch(function(b){throw new g("sceneservice:root-node-missing","Root node missing.",{error:b,url:a});})};c.prototype._fetchService=function(){var a=
this;return(null==this.layerId&&/SceneServer\/*$/i.test(this.url)?this._fetchFirstLayerId().then(function(b){null!=b&&(a.layerId=b)}):d.resolve()).then(function(){return a._fetchServiceLayer()})};c.prototype._fetchFirstLayerId=function(){return k(this.url,{query:{f:"json"},responseType:"json"}).then(function(a){if(a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length)return a.data.layers[0].id})};c.prototype._fetchServiceLayer=function(){var a=this;return k(this.parsedUrl.path,{query:{f:"json"},
responseType:"json"}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));b=b.data;a.read(b,{origin:"service",url:a.parsedUrl});a._validateLayer(b)})};c.prototype._validateLayer=function(a){};a([r.shared({id:{json:{origins:{service:{read:!1},"portal-item":{read:!1}}}}})],c.prototype,"properties",void 0);a([r.property({type:h})],c.prototype,"spatialReference",void 0);a([r.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],c.prototype,"readSpatialReference",
null);a([r.property({type:e})],c.prototype,"fullExtent",void 0);a([r.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],c.prototype,"readFullExtent",null);a([r.property({readOnly:!0,type:p})],c.prototype,"heightModelInfo",void 0);a([r.property({readOnly:!0})],c.prototype,"version",void 0);a([r.reader("version",["store.version"])],c.prototype,"readVersion",null);a([r.property({type:String,json:{read:{source:"copyrightText"}}})],c.prototype,"copyright",
void 0);a([r.property({type:String})],c.prototype,"sublayerTitleMode",void 0);a([r.property({type:String})],c.prototype,"title",void 0);a([r.reader("portal-item","title")],c.prototype,"readTitlePortalItem",null);a([r.reader("service","title",["name"])],c.prototype,"readTitleService",null);a([r.property({type:Number})],c.prototype,"layerId",void 0);a([r.reader("service","layerId",["id"])],c.prototype,"readLayerId",null);a([r.property(C.url)],c.prototype,"url",null);a([r.writer("url")],c.prototype,
"writeUrl",null);a([r.property({dependsOn:["layerId"]})],c.prototype,"parsedUrl",null);a([r.property()],c.prototype,"store",void 0);a([r.property({type:String})],c.prototype,"rootNode",void 0);a([r.reader("rootNode",["store.rootNode"])],c.prototype,"readRootNode",null);return c=a([r.subclass("esri.layers.mixins.SceneService")],c)}(r.declared(q,u,w,A,b))})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(z,v,x,a,k,g){Object.defineProperty(v,"__esModule",{value:!0});z=function(c){function k(){var a=null!==c&&c.apply(this,arguments)||this;a.name=null;a.field=null;a.currentRangeExtent=null;a.fullRangeExtent=null;a.type="rangeInfo";return a}x(k,c);a([g.property({type:String,json:{read:!0,write:!0}})],k.prototype,"name",void 0);a([g.property({type:String,json:{read:!0,write:!0}})],k.prototype,"field",void 0);a([g.property({type:[Number],json:{read:!0,write:!0}})],k.prototype,"currentRangeExtent",
void 0);a([g.property({type:[Number],json:{read:!0,write:!0}})],k.prototype,"fullRangeExtent",void 0);a([g.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],k.prototype,"type",void 0);return k=a([g.subclass("esri.layers.support.RangeInfo")],k)}(g.declared(k));v.RangeInfo=z;v.default=z})},"esri/widgets/Search/SearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Identifiable ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(z,v,x,a,k,g,c){return function(g){function d(a){a=g.call(this)||this;a.autoNavigate=null;a.filter=null;a.maxResults=null;a.maxSuggestions=null;a.minSuggestCharacters=null;a.outFields=null;a.placeholder="";a.popupEnabled=null;a.popupTemplate=null;a.prefix="";a.resultGraphicEnabled=null;a.resultSymbol=null;a.searchExtent=null;a.suggestionsEnabled=null;a.suffix="";a.withinViewEnabled=!1;a.zoomScale=null;return a}x(d,g);a([c.property()],d.prototype,"autoNavigate",void 0);a([c.property()],d.prototype,
"filter",void 0);a([c.property()],d.prototype,"maxResults",void 0);a([c.property()],d.prototype,"maxSuggestions",void 0);a([c.property()],d.prototype,"minSuggestCharacters",void 0);a([c.property()],d.prototype,"outFields",void 0);a([c.property()],d.prototype,"placeholder",void 0);a([c.property()],d.prototype,"popupEnabled",void 0);a([c.property()],d.prototype,"popupTemplate",void 0);a([c.property()],d.prototype,"prefix",void 0);a([c.property()],d.prototype,"resultGraphicEnabled",void 0);a([c.property()],
d.prototype,"resultSymbol",void 0);a([c.property()],d.prototype,"searchExtent",void 0);a([c.property()],d.prototype,"suggestionsEnabled",void 0);a([c.property()],d.prototype,"suffix",void 0);a([c.property()],d.prototype,"withinViewEnabled",void 0);a([c.property()],d.prototype,"zoomScale",void 0);return d=a([c.subclass("esri.widgets.Search.SearchSource")],d)}(c.declared(g,k.Identifiable))})},"esri/widgets/Search/support/featureLayerUtils":function(){define("require exports dojo/date/locale ../../../core/Error ../../../core/lang ../../../core/Logger ../../../core/promiseUtils ../../../geometry/support/scaleUtils ./geometryUtils".split(" "),
function(z,v,x,a,k,g,c,w,d){function n(a,b){var c=a.filter,f=a.searchExtent;b=b&&b.extent;a=a.withinViewEnabled&&b?b:void 0;return c&&c.geometry||f||a}function r(a){return a?a.load().then(c.resolve).catch(c.reject):c.resolve()}function e(a){return a&&!!a.get("capabilities.query.supportsPagination")}function p(a){var b="";a&&(a=a.fields)&&a.some(function(a){if("string"===a.type)return b=a.name,!0});return b}function h(a,b){return a&&b?b.every(function(b){return!!a.getField(b)}):!1}function q(a){for(var b=
0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1}function u(a,b,c){var f=null;(a=a.codedValues)&&a.some(function(a){var e=a.name,e=c?e:e.toLowerCase();if((c?b:b.toLowerCase())===e)return f=a.code.toString(),!0});return f}function A(a,b){return(b=b&&b.where)?"("+a+") AND ("+b+")":a}function b(a,b,c,f,e){var p=b.definitionExpression,h="";if(a){var d=D.test(b.url)&&q(a)?"N":"";c&&c.forEach(function(c){var p=b.getField(c);c=((c="function"===typeof b.getFieldDomain&&b.getFieldDomain(c))&&"coded-value"===
c.type?u(c,a,e):null)||a||null;if(null!==c){var q=p.type,p=p.name;"string"===q||"date"===q?e?p=A(p+" \x3d "+d+"'"+c+"'",f):(c=c.toUpperCase(),p=A("UPPER("+p+") LIKE "+d+"'%"+c+"%'",f)):"oid"===q||"small-integer"===q||"integer"===q||"single"===q||"double"===q?(c=parseFloat(c),p=isNaN(c)?null:A(p+" \x3d "+c,f)):p=A(p+" \x3d "+c,f);p&&(h+=h?" OR ("+p+")":"("+p+")")}})}return p?"("+p+") AND ("+h+")":h}function B(a,b){var c=null;(a=a.codedValues)&&a.length&&a.some(function(a){if(a.code===b)return c=a.name,
!0});return c}function C(a,b,c){var f=a.layer,e=a.attributes,p="function"===typeof f.getFieldDomain&&f.getFieldDomain(c);return b?k.substitute(e,b):c&&a.hasOwnProperty("attributes")&&e.hasOwnProperty(c)?(a=e[c],c=f.getField(c),p&&"coded-value"===p.type?B(p,a):c&&"date"===c.type?x.format(new Date(a)):c&&"integer"===c.type?a.toString():a):""}function m(a,b,c,f){return a.features.map(function(a){var e=a.attributes[a.layer.objectIdField];return{text:C(a,b.suggestionTemplate,f),key:e,sourceIndex:c}})}
function f(a,b,c,f,e,p,h){return a.features.map(function(a){var q=a.clone(),u=a.layer,u=(u=u&&u.objectIdField)&&a.attributes[u];a=C(a,c.searchTemplate,e);var r=d.createExtentFromGeometry(q.geometry,b,p);return{extent:h?d.scaleExtent(r.clone(),b,h):r,feature:q,key:u,name:a,sourceIndex:f}})}Object.defineProperty(v,"__esModule",{value:!0});var D=/https?:\/\/services.*\.arcgis\.com/i,E=/(?:\{([^}]+)\})/g,F=g.getLogger("esri.widgets.Search.support.featureLayerUtils");v.getResults=function(d){var q=d.exactMatch,
u=void 0===q?!1:q,D=d.location,m=d.maxResults,g=d.spatialReference,k=d.source,E=d.sourceIndex,A=d.suggestResult,v=d.view,x=k.featureLayer,C=k.filter,B=k.zoomScale,z=v&&v.scale,K=n(k,v);return r(x).then(function(){var d=x.objectIdField,q=x.returnZ,r=k.displayField||k.featureLayer.displayField||p(k.featureLayer);if(!x.getField(r))return F.error("invalid-field: displayField is invalid."),c.reject(new a("searchfeaturelayerutils:invalid-field","displayField is invalid."));var n=x.get("popupTemplate.requiredFields"),
n=n&&n.length?n:null,y=(n=k.outFields||n||[r],-1!==n.indexOf("*"));-1!==n.indexOf(d)||y||n.push(d);if(!y&&!h(x,n))return F.error("invalid-field: outField is invalid."),c.reject(new a("searchfeaturelayerutils:invalid-field","outField is invalid."));d=x.createQuery();(y=k.searchQueryParams)&&d.set(y);g&&(d.outSpatialReference=g,y=w.getMetersPerUnitForSR(g))&&(d.maxAllowableOffset=y);y=!!x.get("capabilities.data.supportsZ");d.returnZ=y&&!1!==q;d.returnGeometry=!0;n&&(d.outFields=n);if(D)d.geometry=D;
else if(A.key)d.objectIds=[parseInt(A.key,10)];else{q=k.searchFields||[r];if(!h(x,q))return F.error("invalid-field: search field is invalid."),c.reject(new a("searchfeaturelayerutils:invalid-field","search field is invalid."));e(x)&&(d.num=m);K&&(d.geometry=K);n=A.text.trim();if(!n)return c.resolve();var y=k.prefix,H=k.suffix,n=(""+(void 0===y?"":y)+n+(void 0===H?"":H)).replace(/\'/g,"''"),q=b(n,x,q,C,u);if(!q)return c.resolve();d.where=q}return x.queryFeatures(d).then(function(a){return f(a,v,k,
E,r,z,B)})})};v.getSuggestions=function(f){var d=f.source,q=f.spatialReference,u=f.suggestTerm,D=f.maxSuggestions,k=f.sourceIndex,g=d.featureLayer,A=d.filter,x=n(d,f.view);return r(g).then(function(){if(!e(g))return c.resolve();var f=d.displayField||d.featureLayer.displayField||p(d.featureLayer),r=d.searchFields||[f],n=[];d.suggestionTemplate?d.suggestionTemplate.replace(E,function(a,b){n.push(b);return a}):n.push(f);var w=n&&-1!==n.indexOf("*");-1!==n.indexOf(g.objectIdField)||w||n.push(g.objectIdField);
var v=!!g.getField(f),w=w||h(g,n),C=h(g,r);if(!v)return F.error("invalid-field: displayField is invalid."),c.reject(new a("searchfeaturelayerutils:invalid-field","displayField is invalid."));if(!w)return F.error("invalid-field: outField is invalid."),c.reject(new a("searchfeaturelayerutils:invalid-field","outField is invalid."));if(!C)return F.error("invalid-field: search field is invalid."),c.reject(new a("searchfeaturelayerutils:invalid-field","search field is invalid."));v=g.createQuery();(w=d.suggestQueryParams)&&
v.set(w);v.outSpatialReference=q;v.returnGeometry=!1;v.num=D;v.outFields=n;x&&(v.geometry=x);w=u.trim();if(!w)return c.resolve();var C=d.prefix,t=d.suffix,w=(""+(void 0===C?"":C)+w+(void 0===t?"":t)).replace(/\'/g,"''"),r=b(w,g,r,A,!1);if(!r)return c.resolve();v.where=r;return g.queryFeatures(v).then(function(a){return m(a,d,k,f)})})}})},"esri/widgets/Search/support/geometryUtils":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../geometry/support/scaleUtils ../../../views/MapView".split(" "),
function(z,v,x,a,k,g,c,w){function d(a,e,p){var d=a.hasZ?a.z:void 0;return e&&e.map?(p?c.getExtentForScale(e,p):e.extent).clone().centerAt(a).set({zmax:d,zmin:d}):new x.Extent({xmin:a.x-.25,ymin:a.y-.25,xmax:a.x+.25,ymax:a.y+.25,spatialReference:a.spatialReference,zmin:d,zmax:d})}Object.defineProperty(v,"__esModule",{value:!0});var n=k.getLogger("esri.widgets.Search.support.geometryUtils");v.getPointWithElevation=function(c,e){return e?c?c.hasZ||e instanceof w?g.resolve(c):(e=e.get("map.ground"))&&
e.layers.length?e.queryElevation(c).then(function(a){return a.geometry}):g.resolve(c):(n.error("missing-parameter: point is missing."),g.reject(new a("searchgeometryutils:missing-parameter","point is missing."))):(n.error("missing-parameter: view is missing."),g.reject(new a("searchgeometryutils:missing-parameter","view is missing.")))};v.getPointFromGeometry=function(a){if(a instanceof x.Point)return a;if(a instanceof x.Extent)return a.center;if(a instanceof x.Polygon)return a.centroid;if(a instanceof
x.Multipoint)return a.getPoint(0);if(a instanceof x.Polyline)return a.getPoint(0,0)};v.createExtentFromGeometry=function(a,c,p){if(a){if(a instanceof x.Extent)return a;if(a instanceof x.Multipoint||a instanceof x.Polygon||a instanceof x.Polyline)return a.extent;if(a instanceof x.Point)return d(a,c,p)}};v.scaleExtent=function(a,c,p){if(a&&c)return d(a.center,c,p)}})},"esri/widgets/Search/LocatorSearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/lang ../../core/accessorSupport/decorators ../../tasks/Locator ./SearchSource ./support/locatorUtils".split(" "),
function(z,v,x,a,k,g,c,w,d,n){return function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;a.categories=null;a.countryCode=null;a.localSearchOptions=null;a.locationToAddressDistance=1500;a.locator=null;a.name="";a.placeholder="";a.searchTemplate="";a.singleLineFieldName=null;a.suggestionsEnabled=null;a.zoomScale=null;return a}x(e,d);p=e;e.prototype.readLocator=function(a,c){return(a=c.url)?new w({url:a}):null};e.prototype.writeLocator=function(a,c){c.url=a?a.url:null};e.prototype.clone=
function(){return new p({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?g.clone(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,searchExtent:this.searchExtent?this.searchExtent.clone():null,suggestionsEnabled:this.suggestionsEnabled,
suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?g.clone(this.categories):null,countryCode:this.countryCode,localSearchOptions:this.localSearchOptions?g.clone(this.localSearchOptions):null,locationToAddressDistance:this.locationToAddressDistance,locator:this.locator,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})};e.prototype.getResults=function(a){return n.getResults(k({source:this},a))};e.prototype.getSuggestions=
function(a){return n.getSuggestions(k({source:this},a))};var p;a([c.property()],e.prototype,"categories",void 0);a([c.property()],e.prototype,"countryCode",void 0);a([c.property()],e.prototype,"localSearchOptions",void 0);a([c.property()],e.prototype,"locationToAddressDistance",void 0);a([c.property({type:w})],e.prototype,"locator",void 0);a([c.reader("locator",["url"])],e.prototype,"readLocator",null);a([c.writer("locator")],e.prototype,"writeLocator",null);a([c.property({json:{write:!0}})],e.prototype,
"name",void 0);a([c.property({json:{write:!0}})],e.prototype,"placeholder",void 0);a([c.property()],e.prototype,"searchTemplate",void 0);a([c.property({json:{write:!0}})],e.prototype,"singleLineFieldName",void 0);a([c.property({json:{read:{source:"suggest"},write:{target:"suggest"}}})],e.prototype,"suggestionsEnabled",void 0);a([c.property({json:{write:!0}})],e.prototype,"zoomScale",void 0);return e=p=a([c.subclass("esri.widgets.Search.LocatorSearchSource")],e)}(c.declared(d))})},"esri/tasks/Locator":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../request ../core/accessorSupport/decorators ../geometry/SpatialReference ./Task ./support/AddressCandidate".split(" "),
function(z,v,x,a,k,g,c,w,d,n){return function(d){function e(a){a=d.call(this,a)||this;a.categories=null;a.countryCode=null;a.outSpatialReference=null;a.url=null;return a}x(e,d);e.prototype.addressToLocations=function(a,c){var e=a.address,d=a.categories,p=a.countryCode,b=a.distance,h=a.forStorage,n=a.location,m=a.magicKey,f=a.maxLocations,D=a.outFields;a=a.searchExtent;var r=n?n.clone().normalize():null,w=a?a.shiftCentralMeridian():null,v=this.outSpatialReference,n=this.parsedUrl;a=this.requestOptions;
d={f:"json",outSR:v?JSON.stringify(v.toJSON()):null,outFields:D?D.join(","):null,searchExtent:w?JSON.stringify(w.toJSON()):null,category:d?d.join(","):null,countryCode:p||null,magicKey:m||null,distance:b||null,location:r,maxLocations:f||null,forStorage:h||null};e={query:this._encode(k({},n.query,e,d))};c=k({},a,c,e);return g(n.path+"/findAddressCandidates",c).then(this._handleAddressToLocationsResponse)};e.prototype.suggestLocations=function(a,c){var e=this.parsedUrl,d=this.requestOptions,p=a.location,
b=a.searchExtent,p=p?p.clone().normalize():null,b=b?b.shiftCentralMeridian():null;a={f:"json",text:a.text,maxSuggestions:a.maxSuggestions,searchExtent:b?JSON.stringify(b.toJSON()):null,category:a.categories?a.categories.join(","):null,countryCode:a.countryCode||null,location:p,distance:a.distance||null};a={query:this._encode(k({},e.query,a))};c=k({},d,c,a);return g(e.path+"/suggest",c).then(this._handleSuggestLocationsResponse)};e.prototype.addressesToLocations=function(a,c){var e=this.outSpatialReference,
d=this.parsedUrl,p=this.requestOptions,b=a.addresses,h=a.categories;a=a.countryCode;var n=[];Array.isArray(b)&&b.forEach(function(a){n.push({attributes:a})});e={category:h?h.join(","):null,sourceCountry:a||null,addresses:JSON.stringify({records:n}),f:"json",outSR:e?JSON.stringify(e):null};e={query:this._encode(k({},d.query,e))};c=k({},p,c,e);return g(d.path+"/geocodeAddresses",c).then(this._handleAddressesToLocationsResponse)};e.prototype.locationToAddress=function(a,c,e){var d=a?a.clone().normalize():
null,p="undefined"!==typeof d,b="undefined"!==typeof c&&p,h=this.outSpatialReference;a=this.parsedUrl;var q=this.requestOptions;c={outSR:h?JSON.stringify(h.toJSON()):null,location:p?JSON.stringify(d.toJSON()):null,distance:b?c:null,f:"json"};c={query:this._encode(k({},a.query,c))};e=k({},q,e,c);return g(a.path+"/reverseGeocode",e).then(this._handleLocationToAddressResponse)};e.prototype._handleAddressToLocationsResponse=function(a){a=a.data;if(!a)return[];var c=a.candidates,e=a.spatialReference;return c?
c.map(function(a){if(a){var c=a.extent,b=a.location,d=c?c&&"number"===typeof c.xmin&&"number"===typeof c.ymin&&"number"===typeof c.xmax&&"number"===typeof c.ymax:!0;if(b&&"number"===typeof b.x&&"number"===typeof b.x&&d)return c&&(c.spatialReference=e),b.spatialReference=e,n.fromJSON(a)}}):[]};e.prototype._handleSuggestLocationsResponse=function(a){return(a=a.data)?a.suggestions||[]:[]};e.prototype._handleAddressesToLocationsResponse=function(a){a=a.data;if(!a)return[];var c=a.locations,e=a.spatialReference;
return c?c.map(function(a){var c=a.location;c&&(c.spatialReference=e);return n.fromJSON(a)}):[]};e.prototype._handleLocationToAddressResponse=function(a){if(a=a.data){var c=a.address;return n.fromJSON({address:c&&c.Match_addr||"",attributes:c||{},location:a.location,score:100})}};a([c.property()],e.prototype,"categories",void 0);a([c.property()],e.prototype,"countryCode",void 0);a([c.property({type:w})],e.prototype,"outSpatialReference",void 0);a([c.property()],e.prototype,"url",void 0);return e=
a([c.subclass("esri.tasks.Locator")],e)}(c.declared(d))})},"esri/tasks/support/AddressCandidate":function(){define(["../../core/JSONSupport","../../geometry/Extent","../../geometry/Point"],function(z,v,x){return z.createSubclass({declaredClass:"esri.tasks.support.AddressCandidate",properties:{address:{value:null,json:{write:!0}},attributes:{value:null,json:{write:!0}},extent:{value:null,type:v,json:{write:!0}},location:{value:null,type:x,json:{write:!0}},score:{value:null,json:{write:!0}}}})})},"esri/widgets/Search/support/locatorUtils":function(){define(["require",
"exports","../../../Graphic","../../../core/promiseUtils","./geometryUtils"],function(z,v,x,a,k){function g(a){var c=a.source,e=a.spatialReference,d=a.location,g=a.distance,k=a.sourceIndex,b=a.view;a=c.locator;var r=c.zoomScale,w=b&&b.scale;e&&(a.outSpatialReference=e);return a.locationToAddress(d,g).then(function(a){return n([a],{sourceIndex:k,scale:w,view:b,zoomScale:r})})}function c(a,c){var e=a.filter,d=a.searchExtent;a=a.withinViewEnabled;var p=c&&c.extent;return(c=k.createExtentFromGeometry(e&&
e.geometry,c,c&&c.scale))||d||(a&&p?p:void 0)}function w(e){var d=e.source,h=e.suggestResult,q=e.spatialReference,g=e.view,k=e.maxResults,b=e.sourceIndex,w=d&&d.zoomScale;e=h.text.trim();if(!e)return a.resolve();e=""+(!h.key&&d.prefix?d.prefix:"")+e+(!h.key&&d.suffix?d.suffix:"");var v={},m=d.locator,f=g&&g.scale,D=c(d,g);if(!m)return a.resolve();d.categories&&(v.categories=d.categories);q&&(m.outSpatialReference=q);if(q=r(g,d,f))v.location=q.location,v.distance=q.distance;v.maxLocations=k;D&&(v.searchExtent=
D);d.countryCode&&(v.countryCode=d.countryCode);var E=h.key;E&&(v.magicKey=E);v.address={};v.address[d.singleLineFieldName||"Single Line Input"]=e;d.outFields&&(v.outFields=d.outFields);return m.addressToLocations(v).then(function(a){return n(a,{key:E,scale:f,sourceIndex:b,view:g,zoomScale:w})})}function d(a,c){return a.map(function(a){return{text:a.text,key:a.magicKey,sourceIndex:c}})}function n(a,c){return a.map(function(a){var d=c.key,e=c.scale,g=c.sourceIndex,b=c.view,h=c.zoomScale,p=a.extent,
m=a.location,f=a.address;a=new x({geometry:m,attributes:a.attributes});e=k.createExtentFromGeometry(p||m,b,e);b=h?k.scaleExtent(e,b,h):e;m=m?m.x+","+m.y:"";return{extent:b,feature:a,key:d,name:f||m,sourceIndex:g}})}function r(a,c,d){var e=c.localSearchOptions;if(a&&e&&e.hasOwnProperty("distance")&&e.hasOwnProperty("minScale")&&(c=e.minScale,e=e.distance,!c||d&&d<=c))return{location:a.get("extent.center"),distance:e}}Object.defineProperty(v,"__esModule",{value:!0});v.getResults=function(a){return a.location?
g(a):w(a)};v.getSuggestions=function(e){var g=e.source,h=e.spatialReference,k=e.view,n=e.suggestTerm,v=e.maxSuggestions,b=e.sourceIndex;e={};var w=g.locator,x=k&&k.scale,m=c(g,k);if(!w)return a.resolve();g.categories&&(e.categories=g.categories);w.outSpatialReference=h;if(h=r(k,g,x))e.location=h.location,e.distance=h.distance;n=n.trim();if(!n)return a.resolve();h=g.prefix;k=g.suffix;e.text=""+(void 0===h?"":h)+n+(void 0===k?"":k);m&&(e.searchExtent=m);e.maxSuggestions=v;g.countryCode&&(e.countryCode=
g.countryCode);return w.suggestLocations(e).then(function(a){return d(a,b)})};v.isArcGISWorldGeocoder=function(a){return a?/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(a)||/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(a):!1}})},"*now":function(z){z(['dojo/i18n!*preload*esri/widgets/nls/Search*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},
"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!../nls/common dojo/i18n!./Search/nls/Search dojo/keys dojo/query dojo/regexp ../PopupTemplate ../core/Handles ../core/lang ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Search/SearchResultRenderer ./Search/SearchViewModel ./support/widget".split(" "),function(z,v,x,a,k,g,c,w,d,n,r,e,p,h,q,u,A,b){var B=/<[a-z/][\s\S]*>/i;return function(q){function m(a){a=q.call(this)||this;
a._handles=new r;a._inputNode=null;a._sourceMenuButtonNode=null;a._sourceListNode=null;a._suggestionListNode=null;a._searchResultRenderer=new u({container:document.createElement("div")});a._suggestPromise=null;a._popupTemplate=new n({title:g.searchResult,content:a._renderSearchResultsContent.bind(a)});a._relatedTarget=null;a.activeMenu="none";a.activeSource=null;a.activeSourceIndex=null;a.allPlaceholder=null;a.autoNavigate=null;a.autoSelect=null;a.goToOverride=null;a.iconClass="esri-icon-search";
a.includeDefaultSources=null;a.label=g.widgetLabel;a.locationEnabled=null;a.locationToAddressDistance=null;a.maxResults=null;a.maxSuggestions=null;a.minSuggestCharacters=null;a.popupEnabled=null;a.popupTemplate=null;a.portal=null;a.resultGraphic=null;a.resultGraphicEnabled=null;a.results=null;a.searchAllEnabled=null;a.searchTerm=null;a.selectedResult=null;a.sources=null;a.suggestions=null;a.suggestionsEnabled=null;a.view=null;a.viewModel=new A;return a}x(m,q);m.prototype.postInitialize=function(){var a=
this;this.viewModel.popupTemplate=this._popupTemplate;this.own(p.watch(this,"searchTerm",function(b){if(b&&"warning"===a.activeMenu||!b&&!a.get("viewModel.selectedSuggestion.location"))a.activeMenu="none"}),p.on(this,"viewModel.allSources","change",function(){return a._watchSourceChanges()}))};m.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._cancelSuggest();this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=
null)};m.prototype.clear=function(){};m.prototype.focus=function(){this._inputNode&&(this.activeMenu="suggestion",this._inputNode.focus(),this.emit("search-focus"))};m.prototype.blur=function(a){this._inputNode&&(this._inputNode.blur(),this._inputBlur(a),this.emit("search-blur"))};m.prototype.search=function(a){var b=this;this.activeMenu="none";this._cancelSuggest();return this.viewModel.search(a).catch(function(a){b.activeMenu="none";return a}).then(function(a){b.activeMenu=a.numResults?"none":"warning";
return a})};m.prototype.suggest=function(a){var b=this;this._cancelSuggest();return this._suggestPromise=a=this.viewModel.suggest(a).then(function(a){a.numResults&&(b.activeMenu="suggestion");b._scrollToTopSuggestion();return a}).catch(function(){return null})};m.prototype.render=function(){var a=this,c,d,h=this.viewModel,m=h.activeSourceIndex,q=h.suggestions,n=h.maxInputLength,p=h.placeholder,r=h.searchTerm,u=h.searchAllEnabled,v=h.allSources,w=this._getSourceName(m),x=(""+r).trim(),y=this.activeMenu,
z=this.id,B=this.viewModel.state,C=this.id+"-suggest-menu",n=b.tsx("input",{bind:this,placeholder:p,"aria-label":g.searchButtonTitle,maxlength:n,autocomplete:"off",type:"text",tabindex:"0",class:this.classes("esri-input","esri-search__input"),"aria-autocomplete":"list",value:r,"aria-haspopup":"true","aria-owns":C,role:"textbox",onkeydown:this._handleInputKeydown,onkeyup:this._handleInputKeyup,onclick:this._handleInputClick,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:b.storeNode,
"data-node-ref":"_inputNode",onfocusout:this._storeRelatedTarget,onfocus:this.focus,onblur:this.blur,title:r?"":p}),n=b.tsx("form",{key:"esri-search__form",bind:this,class:"esri-search__form",onsubmit:this._formSubmit,role:"search"},n),p=r?b.tsx("div",{key:"esri-search__clear-button",bind:this,role:"button",class:this.classes("esri-search__clear-button","esri-widget--button"),tabindex:"0",title:g.clearButtonTitle,onfocus:this._clearButtonFocus,onclick:this._handleClearButtonClick,onkeydown:this._handleClearButtonClick},
b.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"})):null,L=this.locationEnabled&&!x?b.tsx("ul",{key:"esri-search__suggestion-list-current-location",class:this.classes("esri-search__suggestions-list","esri-search__suggestions-list--current-location")},b.tsx("li",{bind:this,onclick:this._handleUseCurrentLocationClick,onkeydown:this._handleUseCurrentLocationClick,onkeyup:this._handleSuggestionKeyup,role:"menuitem",tabindex:"-1"},b.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-locate-circled"}),
" ",g.useCurrentLocation)):null,U=1<v.length&&m===A.ALL_INDEX,m=q?q.map(function(c,d){var e=c.sourceIndex,f=c.results.length;d=f&&U?a._getSuggestionHeaderNode(e):null;c=c.results.map(function(c,b){return a._getSuggestionNode(c,b,e)});c=f?b.tsx("ul",{key:"esri-search__suggestion-list-"+e,class:"esri-search__suggestions-list"},c):null;return[d,c]}):null,C=b.tsx("div",{id:C,"aria-expanded":"suggestion"===y,key:"esri-search__suggestions-menu",class:this.classes("esri-menu","esri-search__suggestions-menu"),
role:"menu",bind:this,afterCreate:b.storeNode,"data-node-ref":"_suggestionListNode"},L,m),C=b.tsx("div",{key:"esri-search__input-container",class:"esri-search__input-container"},n,C,p),m=b.tsx("div",{key:"esri-search__submit-button",bind:this,role:"button",title:g.searchButtonTitle,class:this.classes("esri-search__submit-button","esri-widget--button"),tabindex:"0",onclick:this._handleSearchButtonClick,onkeydown:this._handleSearchButtonClick},b.tsx("span",{"aria-hidden":"true",role:"presentation",
class:"esri-icon-search"}),b.tsx("span",{class:"esri-icon-font-fallback-text"},g.searchButtonTitle)),r=x?e.substitute({value:'"'+r+'"'},g.noResultsFoundForValue):g.noResultsFound,r=h.get("selectedSuggestion.location")||x?b.tsx("div",{key:"esri-search__no_results"},b.tsx("div",{class:"esri-search__warning-header"},g.noResults),b.tsx("div",{class:"esri-search__warning-text"},r)):null,h=h.get("selectedSuggestion.location")||x?null:b.tsx("div",{key:"esri-search__empty-search"},b.tsx("span",{"aria-hidden":"true",
class:"esri-icon-notice-triangle"}),b.tsx("span",{class:"esri-search__no-value-text"},g.emptyValue)),h=b.tsx("div",{key:"esri-search__error-menu",class:this.classes("esri-menu","esri-search__warning-menu")},b.tsx("div",{class:"esri-search__warning-body"},r,h)),x=1<v.length,v=v&&v.toArray(),u=u?this._getSourceNode(A.ALL_INDEX):null,z=z+"-source-menu",w=x?b.tsx("div",{key:"esri-search__source-menu-button",bind:this,role:"button",title:g.searchIn,"aria-haspopup":"true","aria-expanded":"source"===y,"aria-controls":z,
class:this.classes("esri-search__sources-button","esri-widget--button"),tabindex:"0",onkeydown:this._handleSourceMenuButtonKeydown,onclick:this._handleSourcesMenuToggleClick,onkeyup:this._handleSourceMenuButtonKeyup,onblur:this._sourcesButtonBlur,afterCreate:b.storeNode,"data-node-ref":"_sourceMenuButtonNode"},b.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-down-arrow esri-search__sources-button--down"}),b.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-up-arrow esri-search__sources-button--up"}),
b.tsx("span",{class:"esri-search__source-name"},w)):null,u=x?b.tsx("ul",{bind:this,afterCreate:b.storeNode,"data-node-ref":"_sourceListNode"},u,v.map(function(c,b){return a._getSourceNode(b)})):null,z=b.tsx("div",{id:z,key:"esri-search__source-menu",class:this.classes("esri-menu","esri-search__sources-menu"),role:"menu"},u),y=(c={},c["esri-search--multiple-sources"]=x,c["esri-search--loading"]="loading"===B,c["esri-search--searching"]="searching"===B,c["esri-search--warning"]="warning"===y,c["esri-search--sources"]=
"source"===y,c["esri-search--show-suggestions"]="suggestion"===y,c);c=(d={},d["esri-disabled"]="disabled"===B,d);d="loading"===B?b.tsx("div",{role:"presentation",class:"esri-widget__loader",key:"base-loader"},b.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-widget__loader-animation"}),b.tsx("span",{class:"esri-icon-font-fallback-text"},g.searchButtonTitle),b.tsx("span",{class:"esri-widget__loader-text"},k.loading)):b.tsx("div",{role:"presentation",class:this.classes(y,"esri-search__container"),
key:"base-container"},w,z,C,m,h);return b.tsx("div",{class:this.classes("esri-search esri-widget",c)},d)};m.prototype._watchSourceChanges=function(){var a=this,c=this._handles,b=this.viewModel.allSources;c.remove("sources");b.forEach(function(b){return c.add(p.watch(b,"name",function(){return a.scheduleRender()}),"sources")})};m.prototype._handleSourceMenuButtonKeydown=function(a){var b=a.keyCode;b===c.UP_ARROW||b===c.DOWN_ARROW||b===c.END||b===c.HOME?(a.preventDefault(),a.stopPropagation(),this.activeMenu=
"source"):this._handleSourcesMenuToggleClick(a)};m.prototype._handleSourcesMenuToggleClick=function(a){var b="source"===this.activeMenu;this.activeMenu=b?"none":"source";this.renderNow();b?this._sourceMenuButtonNode&&this._sourceMenuButtonNode.focus():(b=this._sourceListNode?w("li",this._sourceListNode):null)&&(a=a.keyCode===c.END?b[b.length-1]:b[0])&&a.focus()};m.prototype._handleClearButtonClick=function(){this.viewModel.clear();this._focus()};m.prototype._handleSearchButtonClick=function(){this.search()};
m.prototype._handleSuggestionClick=function(a){if(a=a.currentTarget["data-suggestion"])this._focus(),this.search(a)};m.prototype._handleUseCurrentLocationClick=function(){this._focus("none");this.viewModel.searchNearby()};m.prototype._handleSourceClick=function(a){this.viewModel.activeSourceIndex=a.currentTarget["data-source-index"];this._focus("none")};m.prototype._sourcesButtonBlur=function(a){this._removeActiveMenu(a&&a.relatedTarget,this._sourceListNode)};m.prototype._inputBlur=function(a){a=
a&&a.relatedTarget;this._removeActiveMenu(a?a:this._relatedTarget,this._suggestionListNode)};m.prototype._storeRelatedTarget=function(a){this._relatedTarget=a.relatedTarget};m.prototype._clearButtonFocus=function(){this.activeMenu="none"};m.prototype._removeActiveMenu=function(a,b){a&&b&&b.contains(a)||(this.activeMenu="none")};m.prototype._cancelSuggest=function(){var a=this._suggestPromise;a&&a.cancel();this._suggestPromise=null};m.prototype._handleInputKeydown=function(a){var b=a.keyCode;(b===
c.TAB||b===c.ESCAPE||a.shiftKey&&b===c.TAB)&&this._cancelSuggest()};m.prototype._handleInputKeyup=function(a){var b=a.keyCode,d=a.ctrlKey||a.metaKey||b===c.copyKey||b===c.LEFT_ARROW||b===c.RIGHT_ARROW||b===c.ENTER||b===c.SHIFT,e=this._suggestionListNode?w("li",this._suggestionListNode):null;d||(b===c.TAB||b===c.ESCAPE||a.shiftKey&&b===c.TAB?(this._cancelSuggest(),b===c.ESCAPE&&(this.activeMenu="none")):b!==c.UP_ARROW&&b!==c.DOWN_ARROW||!e?this.viewModel.searchTerm&&this.suggest():(this.activeMenu=
"suggestion",a.stopPropagation(),a.preventDefault(),this._cancelSuggest(),(a=e[b===c.UP_ARROW?e.length-1:0])&&a.focus()))};m.prototype._scrollToTopSuggestion=function(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)};m.prototype._handleInputClick=function(a){this.activeMenu="suggestion"};m.prototype._handleInputPaste=function(a){var b=this.get("viewModel.searchTerm");a=a.target;b!==a.value&&(this.viewModel.searchTerm=a.value);b&&this.suggest()};m.prototype._handleSourceMenuButtonKeyup=
function(a){var b=a.keyCode;if(b===c.UP_ARROW||b===c.DOWN_ARROW||b===c.HOME||b===c.END)a.stopPropagation(),a.preventDefault(),(a=this._sourceListNode?w("li",this._sourceListNode):null)&&(b=a[b===c.UP_ARROW||b===c.END?a.length-1:0])&&b.focus()};m.prototype._handleSourceKeyup=function(a){var b=a.target,d=this._sourceListNode?w("li",this._sourceListNode):null,e=a.keyCode;if(e===c.ESCAPE)this._focus("none"),this._sourceMenuButtonNode&&this._sourceMenuButtonNode.focus();else if(d){b=d.indexOf(b);if(e===
c.HOME||e===c.END||e===c.UP_ARROW||e===c.DOWN_ARROW)a.stopPropagation(),a.preventDefault();e===c.HOME?(d=d[0])&&d.focus():e===c.END?(d=d[d.length-1])&&d.focus():e===c.UP_ARROW?(a=b-1,(d=0>a?this._sourceMenuButtonNode:d[a])&&d.focus()):e===c.DOWN_ARROW&&(a=b+1,(d=a>=d.length?this._sourceMenuButtonNode:d[a])&&d.focus())}};m.prototype._handleSuggestionKeyup=function(a){var b=a.target,d=this._suggestionListNode?w("li",this._suggestionListNode):null,b=d.indexOf(b),e=a.keyCode;this._cancelSuggest();if(e===
c.BACKSPACE||e===c.DELETE)this._focus();else if(e===c.ESCAPE)this._focus("none");else if(d){if(e===c.HOME||e===c.END||e===c.UP_ARROW||e===c.DOWN_ARROW)a.stopPropagation(),a.preventDefault();e===c.HOME&&(a=d[0])&&a.focus();e===c.END&&(a=d[d.length-1])&&a.focus();e===c.UP_ARROW?(--b,(d=0>b?d[d.length-1]:d[b])&&d.focus()):e===c.DOWN_ARROW&&(b+=1,(d=b>=d.length?d[0]:d[b])&&d.focus())}};m.prototype._focus=function(a){this.focus();a&&(this.activeMenu=a)};m.prototype._formSubmit=function(a){a.preventDefault();
this.search()};m.prototype._getSourceName=function(a){var b=this.viewModel.allSources.getItemAt(a);return a===A.ALL_INDEX?g.all:b?b.name||g.untitledSource:g.untitledSource};m.prototype._getSuggestionHeaderNode=function(a){var c=this._getSourceName(a);return b.tsx("div",{key:"esri-search__suggestion-header-"+a,class:"esri-menu__header"},c)};m.prototype._splitResult=function(a,b){b=d.escapeString(b);return a.replace(new RegExp("(^|)("+b+")(|$)","ig"),"$1|$2|$3").split("|")};m.prototype._getSuggestionNode=
function(a,c,d){if(d=this.viewModel.searchTerm){var e=a.text||g.untitledResult,f=[];if(B.test(e))f.push(b.tsx("div",{innerHTML:e}));else{var e=this._splitResult(e,d),h=d.toLowerCase();e.forEach(function(a,c){a&&a.length&&(a.toLowerCase()===h?f.push(b.tsx("strong",{key:c},a)):f.push(a))})}return b.tsx("li",{bind:this,onclick:this._handleSuggestionClick,onkeydown:this._handleSuggestionClick,onkeyup:this._handleSuggestionKeyup,key:"esri-search__suggestion$-{sourceIndex}_"+c,"data-suggestion":a,role:"menuitem",
tabindex:"-1"},f)}};m.prototype._getSourceNode=function(a){var c,d=(c={},c["esri-search__source--active"]=a===this.viewModel.activeSourceIndex,c);return b.tsx("li",{bind:this,key:"esri-search__source-"+a,onclick:this._handleSourceClick,onkeydown:this._handleSourceClick,onkeyup:this._handleSourceKeyup,"data-source-index":a,role:"menuitem",class:this.classes("esri-search__source",d),tabindex:"-1"},this._getSourceName(a))};m.prototype._renderSearchResultsContent=function(){this._searchResultRenderer.showMoreResultsOpen=
!1;this._searchResultRenderer.viewModel=this.viewModel;return this._searchResultRenderer};a([h.property(),b.renderable()],m.prototype,"activeMenu",void 0);a([h.aliasOf("viewModel.activeSource"),b.renderable()],m.prototype,"activeSource",void 0);a([h.aliasOf("viewModel.activeSourceIndex"),b.renderable()],m.prototype,"activeSourceIndex",void 0);a([h.aliasOf("viewModel.allPlaceholder"),b.renderable()],m.prototype,"allPlaceholder",void 0);a([h.aliasOf("viewModel.autoNavigate")],m.prototype,"autoNavigate",
void 0);a([h.aliasOf("viewModel.autoSelect")],m.prototype,"autoSelect",void 0);a([h.aliasOf("viewModel.goToOverride")],m.prototype,"goToOverride",void 0);a([h.property()],m.prototype,"iconClass",void 0);a([h.aliasOf("viewModel.includeDefaultSources")],m.prototype,"includeDefaultSources",void 0);a([h.property()],m.prototype,"label",void 0);a([b.renderable(),h.aliasOf("viewModel.locationEnabled")],m.prototype,"locationEnabled",void 0);a([h.aliasOf("viewModel.locationToAddressDistance")],m.prototype,
"locationToAddressDistance",void 0);a([h.aliasOf("viewModel.maxResults")],m.prototype,"maxResults",void 0);a([h.aliasOf("viewModel.maxSuggestions")],m.prototype,"maxSuggestions",void 0);a([h.aliasOf("viewModel.minSuggestCharacters")],m.prototype,"minSuggestCharacters",void 0);a([h.aliasOf("viewModel.popupEnabled")],m.prototype,"popupEnabled",void 0);a([h.aliasOf("viewModel.popupTemplate")],m.prototype,"popupTemplate",void 0);a([h.aliasOf("viewModel.portal")],m.prototype,"portal",void 0);a([h.aliasOf("viewModel.resultGraphic")],
m.prototype,"resultGraphic",void 0);a([h.aliasOf("viewModel.resultGraphicEnabled")],m.prototype,"resultGraphicEnabled",void 0);a([h.aliasOf("viewModel.results"),b.renderable()],m.prototype,"results",void 0);a([h.aliasOf("viewModel.searchAllEnabled"),b.renderable()],m.prototype,"searchAllEnabled",void 0);a([h.aliasOf("viewModel.searchTerm"),b.renderable()],m.prototype,"searchTerm",void 0);a([h.aliasOf("viewModel.selectedResult")],m.prototype,"selectedResult",void 0);a([h.aliasOf("viewModel.sources")],
m.prototype,"sources",void 0);a([h.aliasOf("viewModel.suggestions"),b.renderable()],m.prototype,"suggestions",void 0);a([h.aliasOf("viewModel.suggestionsEnabled")],m.prototype,"suggestionsEnabled",void 0);a([h.aliasOf("viewModel.view"),b.renderable()],m.prototype,"view",void 0);a([b.vmEvent("search-complete search-clear search-start select-result suggest-start suggest-complete".split(" ")),h.property({type:A}),b.renderable(["viewModel.allSources","viewModel.activeSource.placeholder","viewModel.activeSource.name",
"viewModel.state"])],m.prototype,"viewModel",void 0);a([h.aliasOf("viewModel.clear")],m.prototype,"clear",null);a([b.accessibleHandler()],m.prototype,"_handleSourcesMenuToggleClick",null);a([b.accessibleHandler()],m.prototype,"_handleClearButtonClick",null);a([b.accessibleHandler()],m.prototype,"_handleSearchButtonClick",null);a([b.accessibleHandler()],m.prototype,"_handleSuggestionClick",null);a([b.accessibleHandler()],m.prototype,"_handleUseCurrentLocationClick",null);a([b.accessibleHandler()],
m.prototype,"_handleSourceClick",null);return m=a([h.subclass("esri.widgets.Search")],m)}(h.declared(q))});