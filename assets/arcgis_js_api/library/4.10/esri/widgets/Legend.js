// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Legend/LegendViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./support/ActiveLayerInfo".split(" "),function(v,t,e,n,b,c,h,q,g,x){var k=c.ofType(x),r="esri.layers.CSVLayer esri.layers.FeatureLayer esri.layers.HeatmapLayer esri.layers.MapImageLayer esri.layers.MapNotesLayer esri.layers.PointCloudLayer esri.layers.TileLayer esri.layers.StreamLayer esri.layers.SceneLayer esri.layers.GeoRSSLayer esri.layers.GroupLayer esri.layers.ImageryLayer esri.layers.WMSLayer esri.layers.WMTSLayer".split(" "),
a=["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews","view.basemapView.referenceLayerViews"];return function(b){function d(a){a=b.call(this,a)||this;a._handles=new h;a._layerViewByLayerId={};a._layerInfosByLayerViewId={};a._activeLayerInfosByLayerViewId={};a.activeLayerInfos=new k;a.basemapLegendVisible=!1;a.groundLegendVisible=!1;a.layerInfos=[];a.view=null;return a}e(d,b);d.prototype.initialize=function(){this._handles.add(q.init(this,"view",this._viewHandles),"view")};
d.prototype.destroy=function(){this._destroyViewActiveLayerInfos();this._handles.destroy();this.view=this._handles=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});d.prototype._viewHandles=function(){this._handles.remove("state");this.view&&this._handles.add(q.init(this,"state",this._stateHandles),"state")};d.prototype._stateHandles=function(){this._resetAll();"ready"===this.state&&this._watchPropertiesAndAllLayerViews()};
d.prototype._resetAll=function(){this._handles.remove(["all-layer-views","legend-properties"]);this._destroyViewActiveLayerInfos();this.activeLayerInfos.removeAll()};d.prototype._destroyViewActiveLayerInfos=function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)};d.prototype._destroyViewActiveLayerInfo=function(a){this._handles.remove(a);delete this._activeLayerInfosByLayerViewId[a]};d.prototype._watchPropertiesAndAllLayerViews=function(){var a=this.view.allLayerViews;
a.length&&this._refresh();this._handles.add(a.on("change",this._allLayerViewsChangeHandle.bind(this)),"all-layer-views");this._handles.add(q.watch(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),"legend-properties")};d.prototype._allLayerViewsChangeHandle=function(a){var d=this;a.removed.forEach(function(a){return d._destroyViewActiveLayerInfo(a.uid)});this._refresh()};d.prototype._propertiesChangeHandle=function(){this._destroyViewActiveLayerInfos();
this._refresh()};d.prototype._refresh=function(){this._layerInfosByLayerViewId={};this.activeLayerInfos.removeAll();this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this);this._sortActiveLayerInfos(this.activeLayerInfos)};d.prototype._sortActiveLayerInfos=function(a){var d={};this.view.allLayerViews.forEach(function(a,b){return d[a.layer.uid]=b});a.sort(function(a,b){return(d[b.layer.uid]||0)-(d[a.layer.uid]||
0)})};d.prototype._generateLayerViews=function(){var d=[];a.filter(this._filterLayerViews,this).map(this.get,this).filter(function(a){return null!=a}).forEach(this._collectLayerViews("layerViews",d));return d};d.prototype._filterLayerViews=function(a){var d=!this.groundLegendVisible&&"view.groundView.layerViews"===a;return!(!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===a||"view.basemapView.referenceLayerViews"===a))&&!d};d.prototype._collectLayerViews=function(a,d){var b=function(l){l&&
l.forEach(function(l){d.push(l);b(l[a])});return d};return b};d.prototype._filterLayerViewsByLayerInfos=function(a){var d=this,b=this.layerInfos;return b&&b.length?b.some(function(b){return d._hasLayerInfo(b,a)}):!0};d.prototype._hasLayerInfo=function(a,d){var b=this._isLayerUIDMatching(a.layer,d.layer.uid);b&&(this._layerInfosByLayerViewId[d.uid]=a);return b};d.prototype._isLayerUIDMatching=function(a,d){return a&&(a.uid===d||this._hasLayerUID(a.layers,d))};d.prototype._hasLayerUID=function(a,d){var b=
this;return a&&a.some(function(a){return b._isLayerUIDMatching(a,d)})};d.prototype._isLayerViewSupported=function(a){return-1<r.indexOf(a.layer.declaredClass)?(this._layerViewByLayerId[a.layer.uid]=a,!0):!1};d.prototype._generateActiveLayerInfo=function(a){var d=this;this._isLayerActive(a)?this._buildActiveLayerInfo(a):(this._handles.remove(a.uid),this._handles.add(q.watch(a,"suspended, layer.legendEnabled",function(){return d._layerActiveHandle(a)}),a.uid))};d.prototype._layerActiveHandle=function(a){this._isLayerActive(a)&&
(this._handles.remove(a.uid),this._buildActiveLayerInfo(a))};d.prototype._isLayerActive=function(a){return!a.suspended&&a.get("layer.legendEnabled")};d.prototype._buildActiveLayerInfo=function(a){var d=this,b=a.layer,c=a.uid,l=this._layerInfosByLayerViewId[c],p=this._activeLayerInfosByLayerViewId[c];p||(p=new x({layer:b,title:l&&void 0!==l.title?l.title:b.title,view:this.view}),this._activeLayerInfosByLayerViewId[c]=p);p.parent||(l=(l=b.parent)&&this._layerViewByLayerId[l.uid],p.parent=l&&this._activeLayerInfosByLayerViewId[l.uid]);
if(!this._handles.has(c)){var l=q.watch(b,"title",function(f){return d._titleHandle(f,p,a)}),k=q.watch(b,"legendEnabled",function(f){return d._legendEnabledHandle(f,p,a)}),b=q.watch(b,"renderer, opacity",function(){return d._constructLegendElements(p,a)}),f=q.watch(a,"suspended",function(f){return d._suspendedHandle(f,p,a)}),m=q.whenTrue(this.view,"stationary",function(){return d._scaleHandle(p,a)});this._handles.add([l,k,b,f,m],c);this._constructLegendElements(p,a)}this._addActiveLayerInfo(p,a)};
d.prototype._titleHandle=function(a,d,b){d.title=a;this._constructLegendElements(d,b)};d.prototype._legendEnabledHandle=function(a,d,b){a?this._addActiveLayerInfo(d,b):this._removeActiveLayerInfo(d)};d.prototype._suspendedHandle=function(a,d,b){a?this._removeActiveLayerInfo(d):this._addActiveLayerInfo(d,b)};d.prototype._scaleHandle=function(a,d){a.scale!==this.view.scale&&a.isScaleDriven&&this._constructLegendElements(a,d)};d.prototype._addActiveLayerInfo=function(a,d){this._isLayerActive(d)&&-1===
this.activeLayerInfos.indexOf(a)&&((d=a.parent,d)?-1===d.children.indexOf(a)&&(d.children.push(a),this._sortActiveLayerInfos(d.children)):(this.activeLayerInfos.add(a),this._sortActiveLayerInfos(this.activeLayerInfos)))};d.prototype._removeActiveLayerInfo=function(a){var d=a.parent;d?d.children.remove(a):this.activeLayerInfos.remove(a)};d.prototype._constructLegendElements=function(a,d){d=d.layer;a.scale=this.view.scale;d.featureCollections?a.buildLegendElementsForFeatureCollections(d.featureCollections):
d.renderer?a.buildLegendElementsForRenderer():d.url&&a.buildLegendElementsForTools()};n([g.property({type:k})],d.prototype,"activeLayerInfos",void 0);n([g.property()],d.prototype,"basemapLegendVisible",void 0);n([g.property()],d.prototype,"groundLegendVisible",void 0);n([g.property()],d.prototype,"layerInfos",void 0);n([g.property({dependsOn:["view.ready"],readOnly:!0})],d.prototype,"state",null);n([g.property()],d.prototype,"view",void 0);return d=n([g.subclass("esri.widgets.Legend.LegendViewModel")],
d)}(g.declared(b))})},"esri/widgets/Legend/support/ActiveLayerInfo":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/io-query ../../../Color ../../../request ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ../../../renderers/support/jsonUtils ../../../symbols/support/gfxUtils ../../../symbols/support/symbolPreview ../../../symbols/support/utils ./colorRampUtils ./heatmapRampUtils ./relationshipRampUtils ./sizeRampUtils".split(" "),
function(v,t,e,n,b,c,h,q,g,x,k,r,a,d,p,l,w,y,B,D,C,z,f,m,u,A){function F(a){return"esri.renderers.SimpleRenderer"===a.declaredClass}function G(a){return"esri.renderers.ClassBreaksRenderer"===a.declaredClass}function J(a){return"esri.renderers.UniqueValueRenderer"===a.declaredClass}function K(a){return"esri.renderers.HeatmapRenderer"===a.declaredClass}function L(a){return"esri.renderers.PointCloudClassBreaksRenderer"===a.declaredClass}function M(a){return"esri.renderers.PointCloudStretchRenderer"===
a.declaredClass}function N(a){return"esri.renderers.PointCloudUniqueValueRenderer"===a.declaredClass}var H=d.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),O=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,I=new g.SimpleMarkerSymbol({size:6,outline:{color:[128,128,128,.5],width:.5}}),P=new g.SimpleMarkerSymbol({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",outline:{width:1,color:[85,85,85,1]}});return function(d){function g(f){f=d.call(this,f)||this;f._handles=new a;f._hasColorRamp=!1;f._hasOpacityRamp=
!1;f._hasSizeRamp=!1;f._legendResponse={};f._webStyleSymbolCache=new Map;f.children=new r;f.layer=null;f.legendElements=[];f.parent=null;f.scale=null;f.title=null;f.view=null;return f}n(g,d);g.prototype.initialize=function(){var a=this,f=function(){return a.notifyChange("ready")};this._handles.add([l.on(this,"children","change",function(d){var m=d.removed,b=a._handles;d.added.map(function(a){var d="activeLayerInfo-ready-watcher-"+a.layer.uid;b.add(l.init(a,"ready",f),d)});m.forEach(function(a){return b.remove(a.layer.uid)});
f()})])};g.prototype.destroy=function(){this._handles.destroy();this._webStyleSymbolCache=this._legendResponse=this._handles=null};Object.defineProperty(g.prototype,"ready",{get:function(){return null===this.layer?!0:0<this.children.length?this._isGroupActive():0<this.legendElements.length},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isScaleDriven",{get:function(){var a=this,f=this.layer;if(null===f)return!1;if(f.renderer){var d=f.get("renderer.valueExpression");return O.test(d)?
!0:(f=f.get("renderer.visualVariables"))&&f.some(function(f){return a._isScaleDrivenSizeVariable(f)})}return!0},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"version",{get:function(){return this._get("version")+1},enumerable:!0,configurable:!0});g.prototype.buildLegendElementsForFeatureCollections=function(a){var f=this;this.legendElements=[];a.forEach(function(a){if("esri.layers.FeatureLayer"===a.declaredClass)f._buildRendererLegendElements(a.renderer,a.title,"append");else if(a.featureSet&&
a.featureSet.features.length){var d=a.layerDefinition;(d=(d=d&&d.drawingInfo)&&B.fromJSON(d.renderer))?f._buildRendererLegendElements(d,a.name,"append"):H.warn("drawingInfo not available!")}})};g.prototype.buildLegendElementsForRenderer=function(){this._buildRendererLegendElements(this.layer.renderer,null,"replace")};g.prototype.buildLegendElementsForTools=function(){var a=this,f=this.layer;"esri.layers.WMTSLayer"===f.declaredClass?this._constructLegendElementsForWMTSlayer():"esri.layers.WMSLayer"===
f.declaredClass?this._constructLegendElementsForWMSSublayers():"esri.layers.MapImageLayer"===f.declaredClass?this._constructLegendElementsForSublayers():(this._handles.remove("imageryLayers-watcher"),this._getLegendLayers().then(function(d){a.legendElements=[];d.forEach(function(d){if("esri.layers.ImageryLayer"===a.layer.declaredClass){var m=f.watch("renderingRule, bandIds",function(){a._legendResponse["default"]=null;a.buildLegendElementsForTools()});a._handles.add(m,"imageryLayers-watcher")}(d=
a._generateSymbolTableElementForLegendLayer(d))&&d.infos.length&&a.legendElements.push(d);a.notifyChange("ready")});a.notifyChange("ready")}).catch(function(a){H.warn("Request to server for legend has failed!",a)}))};g.prototype._isGroupActive=function(){var a=this.children;return a.length?a.some(function(a){return a.ready}):!1};g.prototype._isScaleDrivenSizeVariable=function(a){if(a&&"size"!==a.type)return!1;var f=a.minSize,d=a.maxSize;return"object"===typeof f&&f?this._isScaleDrivenSizeVariable(f):
"object"===typeof d&&d?this._isScaleDrivenSizeVariable(d):!!a.expression||O.test(a.valueExpression)};g.prototype._buildRendererLegendElements=function(a,f,d){var m=this;this._getRendererLegendElements(a,f).then(function(a){"append"===d?Array.prototype.push.apply(m.legendElements,a):m.legendElements=a;m.notifyChange("ready")}).catch(function(a){H.warn("error while building legend for layer!",a)})};g.prototype._constructLegendElementsForWMTSlayer=function(){this.legendElements=[];this._handles.remove("wmts-activeLayer-watcher");
var a=this.layer,f=a.activeLayer;this._handles.add(l.watch(this.layer,"activeLayer",this._constructLegendElementsForWMTSlayer.bind(this)),"wmts-activeLayer-watcher");if(f.styleId&&f.styles){var d=null;f.styles.some(function(a){if(f.styleId===a.id)return d=a.legendUrl,!0});d&&(this.legendElements=[{type:"symbol-table",title:f.title,infos:[{src:d,opacity:a.opacity}]}])}this.notifyChange("ready")};g.prototype._constructLegendElementsForWMSSublayers=function(){this.legendElements=[];this._handles.remove("wms-sublayers-watcher");
var a=this.layer,f=null;if(a.customParameters||a.customLayerParameters)f=e({},a.customParameters,a.customLayerParameters);this._handles.add(l.watch(this.layer,"sublayers",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");this.legendElements=this._generateLegendElementsForWMSSublayers(a.sublayers,f);this.notifyChange("ready")};g.prototype._generateLegendElementsForWMSSublayers=function(a,f){var d=this,m=[];this._handles.add(a.on("change",this._constructLegendElementsForWMSSublayers.bind(this)),
"wms-sublayers-watcher");a.forEach(function(a){var b=a.watch("title, visible, legendEnabled",function(){return d._constructLegendElementsForWMSSublayers()});d._handles.add(b,"wms-sublayers-watcher");a.visible&&a.legendEnabled&&(a=d._generateSymbolTableElementForWMSSublayer(a,f))&&a.infos.length&&m.unshift(a)});return m};g.prototype._generateSymbolTableElementForWMSSublayer=function(a,f){return!a.legendUrl&&a.sublayers?(f=this._generateLegendElementsForWMSSublayers(a.sublayers,f).filter(function(a){return a}),
{type:"symbol-table",title:a.title,infos:f}):this._generateSymbolTableElementForLegendUrl(a,f)};g.prototype._generateSymbolTableElementForLegendUrl=function(a,f){var d=a.legendUrl;if(d){var m={type:"symbol-table",title:a.title||a.name||a.id&&a.id+"",infos:[]};f&&(d+="?"+c.objectToQuery(f));m.infos.push({src:d,opacity:a.layer&&a.layer.opacity});return m}};g.prototype._getLegendLayers=function(a){var f=this,d=(a=a&&a.hasDynamicLayers?a.dynamicLayers:null)||"default",m=this._legendResponse&&this._legendResponse[d];
return m?p.resolve(m):this._legendRequest(a).then(function(a){a=a.layers;return f._legendResponse[d]=a})};g.prototype._legendRequest=function(a){var f=this.layer;a={f:"json",dynamicLayers:a};"esri.layers.ImageryLayer"===f.declaredClass&&(f.renderingRule&&(a.renderingRule=JSON.stringify(f.renderingRule.toJSON())),f.bandIds&&(a.bandIds=f.bandIds.join()));var d=f.url.replace(/(\/)+$/,"");if(10.01<=f.version){var m=d.indexOf("?"),d=-1<m?d.substring(0,m)+"/legend"+d.substring(m):d+"/legend";f.token&&(d+=
"?token\x3d"+f.token)}else f=d.toLowerCase().indexOf("/rest/"),f=d.substring(0,f)+d.substring(f+5,d.length),d="https://utility.arcgis.com/sharing/tools/legend?soapUrl\x3d"+encodeURI(f)+"\x26returnbytes\x3dtrue";return q(d,{query:a}).then(function(a){return a.data})};g.prototype._constructLegendElementsForSublayers=function(){var a=this;this.legendElements=[];this._handles.remove("sublayers-watcher");var f=this.layer,d=new y.ExportImageParameters({layer:f});this._getLegendLayers(d).then(function(d){var m=
{};d.forEach(function(a){m[a.layerId]=a});a._handles.add(l.watch(f,"sublayers",a._constructLegendElementsForSublayers.bind(a)),"sublayers-watcher");a.legendElements=a._generateLegendElementsForSublayers(f.sublayers,m,f.opacity);a.notifyChange("ready")}).catch(function(a){H.warn("Request to server for legend has failed!",a)}).then(function(){return d.destroy()});this.notifyChange("ready")};g.prototype._generateLegendElementsForSublayers=function(a,f,d){var m=this,b=[];this._handles.add(a.on("change",
this._constructLegendElementsForSublayers.bind(this)),"sublayers-watcher");a.forEach(function(a){var c=a.watch("renderer, opacity, title, visible",function(){return m._constructLegendElementsForSublayers()});m._handles.add(c,"sublayers-watcher");a.visible&&a.legendEnabled&&(c=a&&null!=a.opacity?a.opacity:null,(a=m._generateSymbolTableElementForSublayer(a,f,null!=c?c*d:d))&&a.infos.length&&b.unshift(a))});return b};g.prototype._generateSymbolTableElementForSublayer=function(a,f,d){var m=f[a.id];return!m&&
a.sublayers?(f=this._generateLegendElementsForSublayers(a.sublayers,f,d).filter(function(a){return a}),{type:"symbol-table",title:a.title,infos:f}):this._generateSymbolTableElementForLegendLayer(m,a,d)};g.prototype._generateSymbolTableElementForLegendLayer=function(a,f,d){var m=this;if(a){var b=f&&f.renderer,c=f&&f.title||a.layerName;b&&(b=f&&f.title||this._getRendererTitle(b,f))&&(c&&(b.title=c),c=b);c={type:"symbol-table",title:c,infos:[]};a.legendType&&(c.legendType=a.legendType);a.legend&&this._isLegendLayerInScale(a,
f)&&(f=f?this._sanitizeLegendForSublayer(a.legend.slice(),f):a.legend,c.infos=f.map(function(f){var b=f.url;if(f.imageData&&0<f.imageData.length)b="data:image/png;base64,"+f.imageData;else if(0!==b.indexOf("http")){var b=m.layer.url+"/"+a.layerId+"/images/"+b,c=m.layer.token;c&&(b+="?token\x3d"+c)}else return null;return{label:f.label,src:b,opacity:d,width:f.width,height:f.height}}).filter(function(a){return!!a}));return c.infos.length?c:null}};g.prototype._isLegendLayerInScale=function(a,f){f=f||
this.layer;var d=null,m=null,b=!0;!f.minScale&&0!==f.minScale||!f.maxScale&&0!==f.maxScale?(0===a.minScale&&f.tileInfo&&(d=f.tileInfo.lods[0].scale),0===a.maxScale&&f.tileInfo&&(m=f.tileInfo.lods[f.tileInfo.lods.length-1].scale)):(d=Math.min(f.minScale,a.minScale)||f.minScale||a.minScale,m=Math.max(f.maxScale,a.maxScale));if(0<d&&d<this.scale||m>this.scale)b=!1;return b};g.prototype._sanitizeLegendForSublayer=function(a,f){if(10.1>this.layer.version||0===a.length)return a;f=f.renderer;var d=null,
m=null;a.some(function(a){return a.values})&&a.some(function(a,f){a.values||(d=f,m=a,m.label||(m.label="others"));return null!=m});f?"unique-value"===f.type?m&&(a.splice(d,1),a.push(m)):"class-breaks"===f.type&&(m&&a.splice(d,1),a.reverse(),m&&a.push(m)):m&&(a.splice(d,1),a.push(m));return a};g.prototype._getRendererLegendElements=function(a,f){return F(a)||G(a)||J(a)||K(a)||L(a)||M(a)||N(a)?L(a)||M(a)||N(a)||"esri.renderers.PointCloudRGBRenderer"===a.declaredClass?this._constructPointCloudRendererLegendElements(a,
f):this._constructRendererLegendElements(a,f):(H.warn("Renderer not supported!"),p.resolve([]))};g.prototype._getPointCloudRendererTitle=function(a){return a.legendOptions&&a.legendOptions.title||a.field};g.prototype._constructPointCloudRendererLegendElements=function(a,d){var m=this,b=this.layer.opacity,c=[],A=null,u=null;if(L(a))A={type:"symbol-table",title:d||this._getPointCloudRendererTitle(a),infos:[]},a.colorClassBreakInfos.forEach(function(a){A.infos.unshift({label:a.label||a.minValue+" - "+
a.maxValue,value:[a.minValue,a.maxValue],symbol:m._getAppliedCloneSymbol(I,a.color,b)})});else if(M(a)){var u=a.stops,l=null;if(u.length&&(1===u.length&&(l=u[0].color),!l)){var k=u[0].value,r=u[u.length-1].value;null!=k&&null!=r&&(l=f.getColorFromPointCloudStops(k+(r-k)/2,u))}A={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(I,l||I.color,b)}]};u={type:"color-ramp",title:d||this._getPointCloudRendererTitle(a),borderColor:D.getStroke(I).color,overlayColor:f.getRampOverlayColor(b),
infos:f.getRampStopsForPointCloud(a.stops)}}else N(a)&&(A={type:"symbol-table",title:d||this._getPointCloudRendererTitle(a),infos:[]},a.colorUniqueValueInfos.forEach(function(a){A.infos.push({label:a.label||a.values.join(", "),value:a.values.join(", "),symbol:m._getAppliedCloneSymbol(I,a.color,b)})}));A&&A.infos.length&&c.push(A);u&&u.infos.length&&c.push(u);a=c.reduce(function(a,f){return a.concat(f.infos)},[]).filter(function(a){return!!a.symbol}).map(function(a){return m._getSymbolPreview(a)});
return p.eachAlways(a).then(function(){return c})};g.prototype._constructRendererLegendElements=function(a,f){var d=this;return this._loadRenderer(a).then(function(a){d._hasColorRamp=!1;d._hasOpacityRamp=!1;d._hasSizeRamp=!1;var b=d._getVisualVariableLegendElements(a)||[],c={type:"symbol-table",title:f||d._getRendererTitle(a),infos:[]},A=null,l=!1;if(K(a))b.push({type:"heatmap-ramp",title:f,infos:m.getHeatmapRampStops(a)});else if(J(a)){var k=a&&a.authoringInfo;if(k&&"relationship"===k.type){var r=
k.focus,g=k.numClasses,e=k.field1,y=k.field2;if(g&&e&&y){for(var k=d.layer,e=[e,y],y=u.getRotationAngleForFocus(r)||0,h=0;h<e.length;h++){var w=e[h],z=w.normalizationField,w={field:d._getFieldAlias(w.field,k),normField:z&&d._getFieldAlias(z,k)},z=P.clone();z.angle=y;c.infos.push({label:w,symbol:z});y+=90}r=u.getRelationshipRampElement({focus:r,numClasses:g,infos:a.uniqueValueInfos});b.unshift(r)}}else{var q=a.field;a.uniqueValueInfos.forEach(function(a){a.symbol&&c.infos.push({label:a.label||d._getDomainName(q,
a.value)||a.value,value:a.value,symbol:a.symbol})})}a.defaultSymbol&&(c.infos.push({label:a.defaultLabel||"others",symbol:a.defaultSymbol}),l=!0)}else G(a)?(A=d._isUnclassedRenderer(a),A&&d._hasSizeRamp||(a.classBreakInfos.forEach(function(a){a.symbol&&c.infos.unshift({label:a.label||(A?null:a.minValue+" - "+a.maxValue),value:[a.minValue,a.maxValue],symbol:a.symbol})}),A&&(c.title=null),d._updateInfosforClassedSizeRenderer(a,c.infos)),a.defaultSymbol&&!A&&(c.infos.push({label:a.defaultLabel||"others",
symbol:a.defaultSymbol}),l=!0)):F(a)&&a.symbol&&!d._hasSizeRamp&&c.infos.push({label:a.label,symbol:a.symbol});r=a.defaultSymbol;!r||l||F(a)||A&&!d._hasColorRamp&&!d._hasSizeRamp&&!d._hasOpacityRamp||b.push({type:"symbol-table",infos:[{label:a.defaultLabel||"others",symbol:r}]});c.infos.length&&b.unshift(c);var n=d._getSymbolConfig("visualVariables"in a&&a.visualVariables),l=b.reduce(function(a,f){return a.concat(f.infos)},[]).filter(function(a){return!(!a||!a.symbol)}).map(function(a){return d._getSymbolPreview(a,
n)});a=null;return p.eachAlways(l).then(function(){return b})})};g.prototype._updateInfosforClassedSizeRenderer=function(a,f){var d=a.authoringInfo&&"class-breaks-size"===a.authoringInfo.type,m=a.classBreakInfos.some(function(a){return z.isVolumetricSymbol(a.symbol)});if(d&&m){var b=A.REAL_WORLD_MAX_SIZE;a=a.classBreakInfos.length;var c=(b-A.REAL_WORLD_MIN_SIZE)/(1<a?a-1:a);f.forEach(function(a,f){a.size=b-c*f})}};g.prototype._getSymbolConfig=function(a){var f=!1,d=!1;if(a)for(var m=0;m<a.length&&
(!f||!d);m++){var b=a[m];"size"===b.type&&("height"===b.axis&&(f=!0),"width-and-depth"===b.axis&&(d=!0))}return f&&d?"tall":null};g.prototype._getSymbolPreview=function(a,f){return C.renderPreviewHTML(a.symbol,{size:a.size,opacity:this.layer.opacity,symbolConfig:f,rotation:a.symbol.angle}).then(function(f){a.preview=f;return a}).catch(function(){a.preview=null;return a})};g.prototype._loadRenderer=function(a){var f=this,d=[];a=a.clone();var m=this._getMedianColor(a),b=this.layer.opacity;if(G(a)||
J(a)){var c=(a.classBreakInfos||a.uniqueValueInfos).map(function(a){return f._fetchSymbol(a.symbol,m,b).then(function(f){a.symbol=f}).catch(function(){a.symbol=null})});Array.prototype.push.apply(d,c)}d.push(this._fetchSymbol(a.symbol||a.defaultSymbol,a.defaultSymbol?null:m,b).then(function(d){f._applySymbolToRenderer(a,d,F(a))}).catch(function(){f._applySymbolToRenderer(a,null,F(a))}));return p.eachAlways(d).then(function(){return a})};g.prototype._applySymbolToRenderer=function(a,f,d){d?a.symbol=
f:a.defaultSymbol=f};g.prototype._getMedianColor=function(a){if(!("visualVariables"in a&&a.visualVariables))return null;var f=k.find(a.visualVariables,function(a){return"color"===a.type});if(!f)return null;var d=null,m=null;if(f.stops){if(1===f.stops.length)return f.stops[0].color;d=f.stops[0].value;m=f.stops[f.stops.length-1].value}if(null!=d&&null!=m)return a.getColor(d+(m-d)/2,{colorInfo:f})};g.prototype._fetchSymbol=function(a,f,d){var m=this;if(!a)return p.reject();if("web-style"===a.type){var b=
a.portal,b=a.name+"-"+a.styleName+"-"+a.styleUrl+"-"+(b&&b.url)+"-"+(b&&b.user&&b.user.username),c=this._webStyleSymbolCache;c.has(b)||c.set(b,a.fetchSymbol());return c.get(b).then(function(a){return m._getAppliedCloneSymbol(a,f,d)}).catch(function(){H.warn("Fetching web-style failed!");return p.reject()})}return p.resolve(this._getAppliedCloneSymbol(a,f,d))};g.prototype._getAppliedCloneSymbol=function(a,f,d){if(!a)return a;a=a.clone();var m=-1<a.type.indexOf("3d");f=f&&f.toRgba();m?this._applyColorTo3dSymbol(a,
f,d):(a.color&&(a.color=this._getOpacityAppliedColor(f||a.color.toRgba(),d)),(f=a.outline)&&f.color&&(f.color=this._getOpacityAppliedColor(f.color.toRgba(),d)));return a};g.prototype._applyColorTo3dSymbol=function(a,f,d){var m=this;a.symbolLayers.forEach(function(a){a&&(f&&(a.material||(a.material={}),a.material.color=new h(f)),null!=d&&(a.material&&a.material.color&&(a.material.color=m._getOpacityAppliedColor(a.material.color.toRgba(),d)),a.outline&&a.outline.color&&(a.outline.color=m._getOpacityAppliedColor(a.outline.color.toRgba(),
d))))})};g.prototype._getOpacityAppliedColor=function(a,f){a[3]*=f;return a};g.prototype._getVisualVariableLegendElements=function(a){var d=this;if(!("visualVariables"in a&&a.visualVariables))return null;var m=[],b=[],c=[],u=this.layer.opacity;a.visualVariables.forEach(function(a){"color"===a.type?m.push(a):"size"===a.type?b.push(a):"opacity"===a.type&&c.push(a)});var p=m.concat(b,c),k,l;0===m.length&&G(a)&&a.classBreakInfos&&1===a.classBreakInfos.length&&(k=(k=a.classBreakInfos[0])&&k.symbol);0===
m.length&&F(a)&&(k=a.symbol);k&&(-1<k.type.indexOf("3d")?(k=k.symbolLayers.getItemAt(0),k.get("material.color")&&(l=k.material.color)):k.url||(l=k.color),l&&(l=l.toRgba()));return p.map(function(m){if(!m.legendOptions||!1!==m.legendOptions.showLegend){var b=d._getRampTitle(m,d.layer),c=f.getRampBorderColor(a),k=f.getRampOverlayColor(u),p=null;"color"===m.type?(p={type:"color-ramp",title:b,borderColor:c,overlayColor:k,infos:f.getRampStops(a,m)},d._hasColorRamp||(d._hasColorRamp=!(null==p.infos||!p.infos.length))):
"size"===m.type?(p={type:"size-ramp",title:b,infos:A.getRampStops(a,m,d._getMedianColor(a),d.scale,d.view)},d._hasSizeRamp||(d._hasSizeRamp=!(null==p.infos||!p.infos.length))):"opacity"===m.type&&(p={type:"opacity-ramp",title:b,borderColor:c,overlayColor:k,infos:f.getRampStops(a,m,l)},d._hasOpacityRamp||(d._hasOpacityRamp=!(null==p.infos||!p.infos.length)));return p.infos&&p}}).filter(function(a){return!!a})};g.prototype._getDomainName=function(a,f){if(a&&"function"!==typeof a){var d=this.layer;return(d=
(a=d.getField&&d.getField(a))&&d.getFieldDomain?d.getFieldDomain(a.name):null)&&d.codedValues?d.getName(f):null}return null};g.prototype._getRampTitle=function(a,f){var d=a.field,m=a.normalizationField,b=!1,c=!1,A=!1,k=null,d="function"===typeof d?null:d,m="function"===typeof m?null:m;if(null!=(a.legendOptions&&a.legendOptions.title))k=a.legendOptions.title;else if(a.valueExpressionTitle)k=a.valueExpressionTitle;else{if(f.renderer.authoringInfo&&f.renderer.authoringInfo.visualVariables)for(a=f.renderer.authoringInfo.visualVariables,
k=0;k<a.length;k++){var p=a[k];if("color"===p.type)if("ratio"===p.style){b=!0;break}else if("percent"===p.style){c=!0;break}else if("percentTotal"===p.style){A=!0;break}}k={field:d&&this._getFieldAlias(d,f),normField:m&&this._getFieldAlias(m,f),ratio:b,ratioPercent:c,ratioPercentTotal:A}}return k};g.prototype._getRendererTitle=function(a,f){if(a.legendOptions&&a.legendOptions.title)return a.legendOptions.title;if(a.valueExpressionTitle)return a.valueExpressionTitle;var d=this.layer,m=a.field,b=null,
c=null;G(a)&&(b=a.normalizationField,c="percent-of-total"===a.normalizationType);m="function"===typeof m?null:m;b="function"===typeof b?null:b;a=null;if(m||b)a={field:f?m:m&&this._getFieldAlias(m,d),normField:f?b:b&&this._getFieldAlias(b,d),normByPct:c};return a};g.prototype._getFieldAlias=function(a,f){var d=f.popupTemplate,d=d&&d.fieldInfos;f="function"===typeof a?null:f.getField&&f.getField(a);var m=null;d&&d.some(function(f){if(a===f.fieldName)return m=f,!0});var d=m||f,b=null;d&&(b=m&&m.label||
f&&f.alias||d.name||d.fieldName);return b};g.prototype._isUnclassedRenderer=function(a){var f=a.visualVariables,d=!1;G(a)&&a.classBreakInfos&&1===a.classBreakInfos.length&&f&&(d=a.field?f.some(function(f){return!(!f||a.field!==f.field||(a.normalizationField||f.normalizationField)&&a.normalizationField!==f.normalizationField)}):!!f.length);return d};b([w.property()],g.prototype,"children",void 0);b([w.property()],g.prototype,"layer",void 0);b([w.property()],g.prototype,"legendElements",void 0);b([w.property()],
g.prototype,"parent",void 0);b([w.property({readOnly:!0})],g.prototype,"ready",null);b([w.property()],g.prototype,"scale",void 0);b([w.property({dependsOn:["layer.renderer.valueExpression","layer.renderer.visualVariables"],readOnly:!0})],g.prototype,"isScaleDriven",null);b([w.property()],g.prototype,"title",void 0);b([w.property({dependsOn:["ready"],readOnly:!0,value:0})],g.prototype,"version",null);b([w.property()],g.prototype,"view",void 0);return g=b([w.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],
g)}(w.declared(x))})},"esri/layers/support/ExportImageParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./sublayerUtils".split(" "),function(v,t,e,n,b,c,h,q){Object.defineProperty(t,"__esModule",{value:!0});var g={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",
opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};v=function(c){function k(){var b=null!==c&&c.apply(this,arguments)||this;b.scale=0;return b}n(k,c);Object.defineProperty(k.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;var b=this.visibleSublayers.map(function(a){return a.toExportImageJSON()});return b.length?JSON.stringify(b):null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,
"hasDynamicLayers",{get:function(){return q.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"layer",{set:function(b){var a=this;this._get("layer")!==b&&(this._set("layer",b),this._layerHandles&&(this._layerHandles.forEach(function(a){return a.remove()}),this._layerHandles.length=0),b&&(this._layerHandles=[b.allSublayers.on("change",function(){return a.notifyChange("visibleSublayers")}),b.on("sublayer-update",
function(d){return a.notifyChange(g[d.propertyName])})]))},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"layers",{get:function(){var b=this.visibleSublayers;return b?b.length?"show:"+b.map(function(a){return a.id}).join(","):"show:-1":null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"layerDefs",{get:function(){var b=this.visibleSublayers.filter(function(a){return null!=a.definitionExpression});return b.length?JSON.stringify(b.reduce(function(a,d){a[d.id]=
d.definitionExpression;return a},{})):null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"version",{get:function(){return(this._get("version")||0)+1},set:function(b){this._set("version",b)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"visibleSublayers",{get:function(){var b=this,a=this.layer.sublayers,d=[],c=function(a){var k=b.scale,p=0===a.minScale||k<=a.minScale,l=0===a.maxScale||k>=a.maxScale;a.visible&&(0===k||p&&l)&&(a.sublayers?a.sublayers.forEach(c):
d.unshift(a))};a&&a.forEach(c);return d},enumerable:!0,configurable:!0});k.prototype.toJSON=function(){var b=this.layer,b={dpi:b.dpi,format:b.imageFormat,transparent:b.imageTransparency,gdbVersion:b.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?b.dynamicLayers=this.dynamicLayers:b=e({},b,{layers:this.layers,layerDefs:this.layerDefs});return b};b([h.property({readOnly:!0,dependsOn:["hasDynamicLayers","visibleSublayers"]})],k.prototype,"dynamicLayers",null);b([h.property({readOnly:!0,
dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],k.prototype,"hasDynamicLayers",null);b([h.property()],k.prototype,"layer",null);b([h.property({readOnly:!0,dependsOn:["visibleSublayers"]})],k.prototype,"layers",null);b([h.property({readOnly:!0,dependsOn:["visibleSublayers"]})],k.prototype,"layerDefs",null);b([h.property({type:Number})],k.prototype,"scale",void 0);b([h.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion".split(" ")})],
k.prototype,"version",null);b([h.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],k.prototype,"visibleSublayers",null);return k=b([h.subclass("esri.layers.mixins.ExportImageParameters")],k)}(h.declared(c));t.ExportImageParameters=v})},"esri/symbols/support/symbolPreview":function(){define("require exports ../../core/compilerUtils ./previewSymbol2D ./previewSymbol3D ./previewWebStyleSymbol".split(" "),function(v,t,e,n,b,c){function h(q,g){switch(q.type){case "web-style":return c.previewWebStyleSymbol(q,
h,g);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return b.previewSymbol3D(q,g);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return n.previewSymbol2D(q,g);default:e.neverReached(q)}}Object.defineProperty(t,"__esModule",{value:!0});t.renderPreviewHTML=h})},"esri/symbols/support/previewSymbol2D":function(){define("require exports dojox/gfx/_base ../../core/Error ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils".split(" "),
function(v,t,e,n,b,c,h,q,g){function x(b,a){var d=k.getContext("2d"),c=[];a&&(a.weight&&c.push(a.weight),a.size&&c.push(a.size+"px"),a.family&&c.push(a.family));d.font=c.join(" ");return d.measureText(b).width}Object.defineProperty(t,"__esModule",{value:!0});var k=document.createElement("canvas");t.previewSymbol2D=function(k,a){var d=a&&a.size?c.pt2px(a.size):null,p=a&&a.maxSize?c.pt2px(a.maxSize):null,l=a&&null!=a.opacity?a.opacity:null,r=a&&null!=a.rotation?a.rotation:null,y=h.getStroke(k),B={shape:null,
fill:null,stroke:y};y&&y.width&&(y.width=Math.min(y.width,80));var D=0,C=0,z=y&&y.width||0,f=!1,m=null;switch(k.type){case "simple-marker":l=k.style;C=D=d=Math.min(d||c.pt2px(k.size),p||120);switch(l){case "circle":B.shape={type:"circle",cx:0,cy:0,r:.5*d};break;case "cross":B.shape={type:"path",path:[{command:"M",values:[0,.5*C]},{command:"L",values:[D,.5*C]},{command:"M",values:[.5*D,0]},{command:"L",values:[.5*D,C]},{command:"E",values:[]}]};break;case "diamond":B.shape={type:"path",path:[{command:"M",
values:[0,.5*C]},{command:"L",values:[.5*D,0]},{command:"L",values:[D,.5*C]},{command:"L",values:[.5*D,C]},{command:"Z",values:[]}]};break;case "square":B.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[D,0]},{command:"L",values:[D,C]},{command:"L",values:[0,C]},{command:"Z",values:[]}]};break;case "triangle":B.shape={type:"path",path:[{command:"M",values:[.5*D,0]},{command:"L",values:[D,C]},{command:"L",values:[0,C]},{command:"Z",values:[]}]};break;case "x":B.shape={type:"path",
path:[{command:"M",values:[0,0]},{command:"L",values:[D,C]},{command:"M",values:[D,0]},{command:"L",values:[0,C]},{command:"E",values:[]}]};break;case "path":f=!0,B.shape={type:"path",path:k.path||""}}break;case "simple-line":z=Math.min(d||z,p||80);D=22<z?2*z:40;C=z;y.width=z;z=0;B.shape={type:"path",path:[{command:"M",values:[0,.5*C]},{command:"L",values:[D,.5*C]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":C=D=d=Math.min(d,p||120);f=!0;B.shape=q.shapes.fill[0];break;case "picture-marker":var u=
p||120,y=c.pt2px(k.width),p=c.pt2px(k.height),d=Math.min(d||Math.max(y,p),u),p=y/p,y=1>=p?Math.ceil(d*p):d,p=1>=p?d:Math.ceil(d/p),D=y,C=p,m=l;B.shape={type:"image",x:-Math.round(y/2),y:-Math.round(p/2),width:y,height:p,src:k.url||""};break;case "text":l=k.text||"Aa",y=k.font,d=Math.min(d||c.pt2px(y.size),p||120),u=x(l,{weight:y.weight,size:d,family:y.family}),D=(p=/[\uE600-\uE6FF]/.test(l))?d:u,C=d,u=.25*e.normalizedLength((y?d:0).toString()),p&&(u+=5),B.shape={type:"text",text:l,x:0,y:u,align:"middle",
decoration:y&&y.decoration,rotated:k.rotated,kerning:k.kerning},B.font=y&&{size:d,style:y.style,decoration:y.decoration,weight:y.weight,family:y.family}}if(!B.shape)return b.reject(new n("symbolPreview: renderPreviewHTML2D","symbol not supported."));var D=(D||22)+z+1,C=(C||22)+z+1,A=h.getFill(k),z=k.color,d=null;A&&"pattern"===A.type&&z&&"picture-fill"!==k.type?d=h.getPatternUrlWithColor(A.src,z.toCss(!0)).then(function(a){A.src=a;B.fill=A;return B}):(B.fill=A,d=b.resolve(B));return d.then(function(d){return g.renderSymbol([[d]],
[D,C],{node:a&&a.node,scale:f,opacity:m,rotation:r})})}})},"esri/symbols/support/previewUtils":function(){define(["require","exports"],function(v,t){Object.defineProperty(t,"__esModule",{value:!0});t.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",
path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",
path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},
{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};t.getExtrudeSymbolShapes=function(e){e*=.5;return[{type:"path",path:[{command:"M",
values:[0,.7*11]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+e]},{command:"L",values:[0,22*.7+e-.7*11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+e]},{command:"L",values:[22,e]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[0,.7*11]},{command:"Z",values:[]}]}]};t.getCubeShapes=
function(e,n){var b=n?20:e,c=n?4:6,c=b=22>=b?b-.5*c:b-c;n=n?.35*b:.5*b;return[{type:"path",path:[{command:"M",values:[.5*c,0]},{command:"L",values:[c,.5*n]},{command:"L",values:[.5*c,n]},{command:"L",values:[0,.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[.5*c,n]},{command:"L",values:[.5*c,e]},{command:"L",values:[0,e-.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*c,n]},{command:"L",values:[.5*c,e]},{command:"L",
values:[c,e-.5*n]},{command:"L",values:[c,.5*n]},{command:"Z",values:[]}]}]};t.getCylinderShapes=function(e,n){var b=n?20:e;n=n?4:6;b=22>=b?b-.5*n:b-n;n=.5*b;var c=.15*b;e-=c;return[{type:"ellipse",cx:.5*b,cy:e,rx:n,ry:c},{type:"path",path:[{command:"M",values:[0,c]},{command:"L",values:[0,e]},{command:"L",values:[b,e]},{command:"L",values:[b,c]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*b,cy:c,rx:n,ry:c}]};t.getConeShapes=function(e,n){var b=n?20:e;n=n?4:6;b=22>=b?b-.5*n:b-n;n=.15*b;var c=
b;e-=n;return[{type:"ellipse",cx:.5*b,cy:e,rx:.5*b,ry:n},{type:"path",path:[{command:"M",values:[.5*c,0]},{command:"L",values:[c,e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]}]};t.getInvertedConeShapes=function(e){var n=e,n=22>n?n-3:n-6,b=.15*n,c=n;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[c,0]},{command:"L",values:[.5*c,e-b]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*n,cy:0,rx:.5*n,ry:b}]};t.getDiamondShapes=function(e){var n=e,n=22>n?n-2:n-4,b=Math.floor(e/
10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*n,0]},{command:"L",values:[n,.5*e-b]},{command:"L",values:[.45*n-b,.5*e+b]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*n,0]},{command:"L",values:[.45*n-b,.5*e+b]},{command:"L",values:[0,.5*e-b]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*e-b]},{command:"L",values:[.45*n-b,.5*e+b]},{command:"L",values:[.45*n,e]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*n,e]},
{command:"L",values:[n,.5*e-b]},{command:"L",values:[.45*n-b,.5*e+b]},{command:"Z",values:[]}]}]};t.getTetrahedronShapes=function(e){var n=e,n=22>n?n-1:n-2;return[{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[e,n]},{command:"L",values:[.45*e,.6*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[.45*e,.6*n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[.45*
e,.6*n]},{command:"L",values:[e,n]},{command:"Z",values:[]}]}]}})},"esri/symbols/support/renderUtils":function(){define("require exports dojox/gfx dojox/gfx/matrix ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/has ../../core/promiseUtils".split(" "),function(v,t,e,n,b,c,h,q,g,x){function k(a){return a.map(function(a){return a.command+" "+a.values.join(",")}).join(" ").trim()}function r(a,b,c,g){var d=g&&g.node||document.createElement("div"),p=e.createSurface(d,b,c);
null!=g.opacity&&(d.style.opacity=g.opacity.toString());try{a.forEach(function(a){var d=p.createGroup(),l=0;a.forEach(function(a){var f=a.shape,b=a.fill,m=a.stroke;l+=m&&m.width||0;var c=null;f&&("path"===f.type&&"string"!==typeof f.path&&(f.path=k(f.path)),c=d.createShape(f).setFill(b).setStroke(m?m:{width:0}),"text"===f.type&&c.setFont(a.font))});a=b/2;var f=c/2,m=d.getBoundingBox(),u=m.width,A=m.height,e=!1;if(g.scale&&0!==m.width&&0!==m.height){var h=m.width/m.height,e=(b>c?b:c)-2*l,y=1,r=1;isNaN(e)||
(1<h?(y=e/m.width,r=e/h/m.height):(r=e/m.height,y=e*h/m.width));d.applyTransform(n.scaleAt(y,r,a,f));e=!0}h=m.x+u/2;m=m.y+A/2;d.applyTransform(n.translate(a-h,f-m));!e&&(u>b||A>c)&&(e=u/b>A/c,u=((e?b:c)-5)/(e?u:A),d.applyTransform(n.scaleAt(u,u,a,f)));g.rotation&&d.applyTransform(n.rotategAt(g.rotation,h,m))})}catch(D){return p.clear(),p.destroy(),null}return d}function a(a,b,k){return a?c(a,{responseType:"image"}).then(function(a){a=a.data;var d=a.width,c=a.height,p=d/c,l=b;k&&(l=Math.min(l,Math.max(d,
c)));return{image:a,width:1>=p?Math.ceil(l*p):l,height:1>=p?l:Math.ceil(l/p)}}):x.reject(new q("renderUtils: imageDataSize","href not provided."))}Object.defineProperty(t,"__esModule",{value:!0});t.renderSymbol=function(a,b,c){var d=Math.ceil(b[0]);b=Math.ceil(b[1]);return a.some(function(a){return!!a.length})?r(a,d,b,c):null};t.tintImageWithColor=function(d,c,k,e,r){return a(d,c,r).then(function(a){var p=a.width?a.width:c,l=a.height?a.height:c,r;if(r=a.image)r=k&&"ignore"!==e?"multiply"===e&&255===
k.r&&255===k.g&&255===k.b&&1===k.a?!1:!0:!1;if(r){var f=a.image.width,m=a.image.height;(g("edge")||g("ie"))&&/\.svg$/i.test(d)&&(--f,--m);var u,A;u=Math.ceil(p);A=Math.ceil(l);r=document.createElement("canvas");r.width=u;r.height=A;r.style.width=u+"px";r.style.height=A+"px";r=r.getContext("2d");r.clearRect(0,0,u,A);r.drawImage(a.image,0,0,f,m,0,0,p,l);a=r.getImageData(0,0,p,l);f=[k.r/255,k.g/255,k.b/255,k.a];m=h.toHSV(k);for(u=0;u<a.data.length;u+=4){A=a.data;var y=u,q=f,w=m;switch(e){case "multiply":A[y+
0]*=q[0];A[y+1]*=q[1];A[y+2]*=q[2];A[y+3]*=q[3];break;default:var n=h.toHSV({r:A[y+0],g:A[y+1],b:A[y+2]});n.h=w.h;n.s=w.s;n.v=n.v/100*w.v;w=h.toRGB(n);A[y+0]=w.r;A[y+1]=w.g;A[y+2]=w.b;A[y+3]*=q[3]}}r.putImageData(a,0,0);d=r.canvas.toDataURL("image/png")}else(r=b.id&&b.id.findCredential(d))&&r.token&&(a=-1===d.indexOf("?")?"?":"\x26",d=""+d+a+"token\x3d"+r.token);return{url:d,width:p,height:l}}).catch(function(){return{url:d,width:c,height:c}})}})},"dojox/gfx":function(){define(["dojo/_base/lang",
"./gfx/_base","./gfx/renderer!"],function(v,t,e){t.switchTo(e);return t})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/config"],function(v,t,e,n,b){var c=null;e.add("vml",function(b,c,g){g.innerHTML='\x3cv:shape adj\x3d"1"/\x3e';b="adj"in g.firstChild;g.innerHTML="";return b});return{load:function(h,q,g){function x(){q(["dojox/gfx/"+k],function(a){v.renderer=k;c=a;g(a)})}if(c&&"force"!=h)g(c);else{var k=b.forceGfxRenderer;
h=!k&&(t.isString(b.gfxRenderer)?b.gfxRenderer:"svg,vml,canvas,silverlight").split(",");for(var r,a;!k&&h.length;)switch(h.shift()){case "svg":"SVGAngle"in n.global&&(k="svg");break;case "vml":e("vml")&&(k="vml");break;case "silverlight":try{e("ie")?(r=new ActiveXObject("AgControl.AgControl"),r.IsVersionSupported("1.0"))&&(a=!0):navigator.plugins["Silverlight Plug-In"]&&(a=!0)}catch(d){a=!1}finally{r=null}a&&(k="silverlight");break;case "canvas":n.global.CanvasRenderingContext2D&&(k="canvas")}"canvas"===
k&&!1!==b.canvasEvents&&(k="canvasWithEvents");b.isDebug&&console.log("gfx renderer \x3d "+k);"svg"==k&&"undefined"!=typeof window.svgweb?window.svgweb.addOnLoad(x):x()}}}})},"dojox/gfx/matrix":function(){define(["./_base","dojo/_base/lang"],function(v,t){var e=v.matrix={},n={};e._degToRad=function(b){return n[b]||(n[b]=Math.PI*b/180)};e._radToDeg=function(b){return b/Math.PI*180};e.Matrix2D=function(b){if(b)if("number"==typeof b)this.xx=this.yy=b;else if(b instanceof Array){if(0<b.length){for(var c=
e.normalize(b[0]),h=1;h<b.length;++h){var q=c,g=e.normalize(b[h]),c=new e.Matrix2D;c.xx=q.xx*g.xx+q.xy*g.yx;c.xy=q.xx*g.xy+q.xy*g.yy;c.yx=q.yx*g.xx+q.yy*g.yx;c.yy=q.yx*g.xy+q.yy*g.yy;c.dx=q.xx*g.dx+q.xy*g.dy+q.dx;c.dy=q.yx*g.dx+q.yy*g.dy+q.dy}t.mixin(this,c)}}else t.mixin(this,b)};t.extend(e.Matrix2D,{xx:1,xy:0,yx:0,yy:1,dx:0,dy:0});t.mixin(e,{identity:new e.Matrix2D,flipX:new e.Matrix2D({xx:-1}),flipY:new e.Matrix2D({yy:-1}),flipXY:new e.Matrix2D({xx:-1,yy:-1}),translate:function(b,c){return 1<arguments.length?
new e.Matrix2D({dx:b,dy:c}):new e.Matrix2D({dx:b.x,dy:b.y})},scale:function(b,c){return 1<arguments.length?new e.Matrix2D({xx:b,yy:c}):"number"==typeof b?new e.Matrix2D({xx:b,yy:b}):new e.Matrix2D({xx:b.x,yy:b.y})},rotate:function(b){var c=Math.cos(b);b=Math.sin(b);return new e.Matrix2D({xx:c,xy:-b,yx:b,yy:c})},rotateg:function(b){return e.rotate(e._degToRad(b))},skewX:function(b){return new e.Matrix2D({xy:Math.tan(b)})},skewXg:function(b){return e.skewX(e._degToRad(b))},skewY:function(b){return new e.Matrix2D({yx:Math.tan(b)})},
skewYg:function(b){return e.skewY(e._degToRad(b))},reflect:function(b,c){1==arguments.length&&(c=b.y,b=b.x);var h=b*b,q=c*c,g=h+q,n=2*b*c/g;return new e.Matrix2D({xx:2*h/g-1,xy:n,yx:n,yy:2*q/g-1})},project:function(b,c){1==arguments.length&&(c=b.y,b=b.x);var h=b*b,q=c*c,g=h+q,n=b*c/g;return new e.Matrix2D({xx:h/g,xy:n,yx:n,yy:q/g})},normalize:function(b){return b instanceof e.Matrix2D?b:new e.Matrix2D(b)},isIdentity:function(b){return 1==b.xx&&0==b.xy&&0==b.yx&&1==b.yy&&0==b.dx&&0==b.dy},clone:function(b){var c=
new e.Matrix2D,h;for(h in b)"number"==typeof b[h]&&"number"==typeof c[h]&&c[h]!=b[h]&&(c[h]=b[h]);return c},invert:function(b){b=e.normalize(b);var c=b.xx*b.yy-b.xy*b.yx;return b=new e.Matrix2D({xx:b.yy/c,xy:-b.xy/c,yx:-b.yx/c,yy:b.xx/c,dx:(b.xy*b.dy-b.yy*b.dx)/c,dy:(b.yx*b.dx-b.xx*b.dy)/c})},_multiplyPoint:function(b,c,e){return{x:b.xx*c+b.xy*e+b.dx,y:b.yx*c+b.yy*e+b.dy}},multiplyPoint:function(b,c,h){b=e.normalize(b);return"number"==typeof c&&"number"==typeof h?e._multiplyPoint(b,c,h):e._multiplyPoint(b,
c.x,c.y)},multiplyRectangle:function(b,c){var h=e.normalize(b);c=c||{x:0,y:0,width:0,height:0};if(e.isIdentity(h))return{x:c.x,y:c.y,width:c.width,height:c.height};b=e.multiplyPoint(h,c.x,c.y);var q=e.multiplyPoint(h,c.x,c.y+c.height),g=e.multiplyPoint(h,c.x+c.width,c.y);c=e.multiplyPoint(h,c.x+c.width,c.y+c.height);var h=Math.min(b.x,q.x,g.x,c.x),n=Math.min(b.y,q.y,g.y,c.y);return{x:h,y:n,width:Math.max(b.x,q.x,g.x,c.x)-h,height:Math.max(b.y,q.y,g.y,c.y)-n}},multiply:function(b){for(var c=e.normalize(b),
h=1;h<arguments.length;++h){var q=c,g=e.normalize(arguments[h]),c=new e.Matrix2D;c.xx=q.xx*g.xx+q.xy*g.yx;c.xy=q.xx*g.xy+q.xy*g.yy;c.yx=q.yx*g.xx+q.yy*g.yx;c.yy=q.yx*g.xy+q.yy*g.yy;c.dx=q.xx*g.dx+q.xy*g.dy+q.dx;c.dy=q.yx*g.dx+q.yy*g.dy+q.dy}return c},_sandwich:function(b,c,h){return e.multiply(e.translate(c,h),b,e.translate(-c,-h))},scaleAt:function(b,c,h,q){switch(arguments.length){case 4:return e._sandwich(e.scale(b,c),h,q);case 3:return"number"==typeof h?e._sandwich(e.scale(b),c,h):e._sandwich(e.scale(b,
c),h.x,h.y)}return e._sandwich(e.scale(b),c.x,c.y)},rotateAt:function(b,c,h){return 2<arguments.length?e._sandwich(e.rotate(b),c,h):e._sandwich(e.rotate(b),c.x,c.y)},rotategAt:function(b,c,h){return 2<arguments.length?e._sandwich(e.rotateg(b),c,h):e._sandwich(e.rotateg(b),c.x,c.y)},skewXAt:function(b,c,h){return 2<arguments.length?e._sandwich(e.skewX(b),c,h):e._sandwich(e.skewX(b),c.x,c.y)},skewXgAt:function(b,c,h){return 2<arguments.length?e._sandwich(e.skewXg(b),c,h):e._sandwich(e.skewXg(b),c.x,
c.y)},skewYAt:function(b,c,h){return 2<arguments.length?e._sandwich(e.skewY(b),c,h):e._sandwich(e.skewY(b),c.x,c.y)},skewYgAt:function(b,c,h){return 2<arguments.length?e._sandwich(e.skewYg(b),c,h):e._sandwich(e.skewYg(b),c.x,c.y)}});v.Matrix2D=e.Matrix2D;return e})},"esri/core/colorUtils":function(){define(["require","exports"],function(v,t){function e(b,c){var a=[],d,k;if(b[0].length!==c.length)throw"dimensions do not match";var l=b.length,e=b[0].length,g=0;for(d=0;d<l;d++){for(k=g=0;k<e;k++)g+=
b[d][k]*c[k];a.push(g)}return a}function n(b){b=[b.r/255,b.g/255,b.b/255].map(function(b){return.04045>=b?b/12.92:Math.pow((b+.055)/1.055,2.4)});b=e(g,b);return{x:100*b[0],y:100*b[1],z:100*b[2]}}function b(b){b=e(x,[b.x/100,b.y/100,b.z/100]).map(function(b){return Math.min(1,Math.max(.0031308>=b?12.92*b:1.055*Math.pow(b,1/2.4)-.055,0))});return{r:Math.round(255*b[0]),g:Math.round(255*b[1]),b:Math.round(255*b[2])}}function c(b){b=[b.x/95.047,b.y/100,b.z/108.883].map(function(b){return b>Math.pow(6/
29,3)?Math.pow(b,1/3):1/3*Math.pow(29/6,2)*b+4/29});return{l:116*b[1]-16,a:500*(b[0]-b[1]),b:200*(b[1]-b[2])}}function h(b){var c=b.l;b=[(c+16)/116+b.a/500,(c+16)/116,(c+16)/116-b.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*b[0],y:100*b[1],z:108.883*b[2]}}function q(c){if("r"in c&&"g"in c&&"b"in c)return c;if("l"in c&&"c"in c&&"h"in c){var k=c.c,a=c.h;return b(h({l:c.l,a:k*Math.cos(a),b:k*Math.sin(a)}))}if("l"in c&&"a"in c&&"b"in c)return b(h(c));
if("x"in c&&"y"in c&&"z"in c)return b(c);if("h"in c&&"s"in c&&"v"in c){k=c.h/60;a=c.v/100*255;c=c.s/100*a;var d=c*(1-Math.abs(k%2-1)),p;switch(Math.floor(k)){case 0:p={r:c,g:d,b:0};break;case 1:p={r:d,g:c,b:0};break;case 2:p={r:0,g:c,b:d};break;case 3:p={r:0,g:d,b:c};break;case 4:p={r:d,g:0,b:c};break;case 5:case 6:p={r:c,g:0,b:d}}p.r=Math.round(p.r+a-c);p.g=Math.round(p.g+a-c);p.b=Math.round(p.b+a-c);return p}}Object.defineProperty(t,"__esModule",{value:!0});var g=[[.4124,.3576,.1805],[.2126,.7152,
.0722],[.0193,.1192,.9505]],x=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];t.toRGB=q;t.toHSV=function(b){if("h"in b&&"s"in b&&"v"in b)return b;var c=q(b);b=c.r;var a=c.g,c=c.b,d=Math.max(b,a,c),p=d-Math.min(b,a,c),l;0===p?l=0:d===b?l=(a-c)/p%6:d===a?l=(c-b)/p+2:d===c&&(l=(b-a)/p+4);0>l&&(l+=6);return{h:60*l,s:100*(0===p?0:p/d),v:100/255*d}};t.toLAB=function(b){return"l"in b&&"a"in b&&"b"in b?b:c(n(q(b)))};t.toLCH=function(b){if(!("l"in b&&"c"in b&&"h"in b)){var k=c(n(q(b)));
b=k.l;var a=k.a,d=k.b,k=Math.sqrt(a*a+d*d),a=Math.atan2(d,a),a=0<a?a:a+2*Math.PI;b={l:b,c:k,h:a}}return b};t.toXYZ=function(b){return"x"in b&&"y"in b&&"z"in b?b:n(q(b))}})},"esri/symbols/support/previewSymbol3D":function(){define("require exports ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils ./styleUtils ./utils".split(" "),function(v,t,e,n,b,c,h,q,g,x,k){function r(a){var f=a.outline,b=a.get("material.color"),b=b&&b.toRgba().toString();
if(!f)return"fill"===a.type&&"255,255,255,1"===b?{color:"#bdc3c7",width:.75}:null;a=c.pt2px(f.size)||0;return{color:"rgba("+(null!=f.color?f.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function a(a,f){var d=f&&f.resource,d=d&&d.href;return a.thumbnail&&a.thumbnail.url?b.resolve(a.thumbnail.url):d&&"object"!==f.type?b.resolve(k.getIconHref(a,f)):a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?x.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal}).catch(function(a){return a}).then(function(a){return a&&
a.thumbnail&&a.thumbnail.url||z}):b.resolve(z)}function d(a,f){void 0===f&&(f=0);if(!a.material||!a.material.color)return a=Math.min(Math.max(h.defaultThematicColor.r+191.25*f,0),255),[a,a,a,100];for(var b=a.material.color.toRgb(),d=0;3>d;d++)b[d]=Math.min(Math.max(b[d]+191.25*f,0),255);b.push(a.material.color.a);return b}function p(a){return a.outline?r(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function l(a,f){if(!a.material)return{};for(var b=a.material.color.toRgb(),d="rgba(",m=0;3>m;m++)d+=Math.min(Math.max(b[m]+
191.25*f,0),255)+",";d+=a.material.color.a+");";a=a.size?c.pt2px(a.size):.75;return{color:d,width:Math.min(a,80)}}function w(a,f,b){b*=.75;return{type:"linear",x1:b?.25*b:0,y1:b?.5*b:0,x2:b||4,y2:b?.5*b:4,colors:[{color:a,offset:0},{color:f,offset:1}]}}function y(a){var f=a.depth,b=a.height;return(a=a.width)&&f&&b&&a===f&&a<b}function B(a,f,b,c){var m=a&&a.type,l="object"===m,u=[];if("icon"===m)switch(f){case "circle":u.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:d(a,0),stroke:r(a)});break;
case "square":u.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:d(a,0),stroke:r(a)});break;case "triangle":u.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:d(a,0),stroke:r(a)});break;case "cross":u.push({shape:{type:"path",path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*
b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]},{command:"E",values:[]}]},stroke:p(a)});break;case "x":u.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]},{command:"E",values:[]}]},stroke:p(a)});break;case "kite":u.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:d(a,
0),stroke:r(a)})}else if(l)switch(f){case "cone":f=d(a,0);a=d(a,-.6);a=w(f,a,c?20:b);b=q.getConeShapes(b,c);u.push({shape:b[0],fill:a});u.push({shape:b[1],fill:a});break;case "inverted-cone":c=d(a,0);a=d(a,-.6);a=w(c,a,b);b=q.getInvertedConeShapes(b);u.push({shape:b[0],fill:a});u.push({shape:b[1],fill:c});break;case "cube":b=q.getCubeShapes(b,c);u.push({shape:b[0],fill:d(a,0)});u.push({shape:b[1],fill:d(a,-.3)});u.push({shape:b[2],fill:d(a,-.5)});break;case "cylinder":f=d(a,0);m=d(a,-.6);f=w(f,m,
c?20:b);b=q.getCylinderShapes(b,c);u.push({shape:b[0],fill:f});u.push({shape:b[1],fill:f});u.push({shape:b[2],fill:d(a,0)});break;case "diamond":b=q.getDiamondShapes(b);u.push({shape:b[0],fill:d(a,-.3)});u.push({shape:b[1],fill:d(a,0)});u.push({shape:b[2],fill:d(a,-.3)});u.push({shape:b[3],fill:d(a,-.7)});break;case "sphere":c=d(a,0);a=d(a,-.6);a=w(c,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;u.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});break;case "tetrahedron":b=q.getTetrahedronShapes(b),
u.push({shape:b[0],fill:d(a,-.3)}),u.push({shape:b[1],fill:d(a,0)}),u.push({shape:b[2],fill:d(a,-.6)})}return u}function D(d,u){var m=u&&u.size?c.pt2px(u.size):null,p=u&&u.maxSize?c.pt2px(u.maxSize):null,l=u&&u.disableUpsampling,k=d.symbolLayers,e=[],h=0,q=0,w=k.getItemAt(k.length-1),n;w&&"icon"===w.type&&(n=w.size&&c.pt2px(w.size));k.forEach(function(f,k){if("icon"===f.type||"object"===f.type){k="icon"===f.type?f.size&&c.pt2px(f.size):0;var A=m||k?Math.ceil(Math.min(m||k,p||120)):22,w=r(f),z=w?w.width:
0;if(f&&f.resource&&f.resource.href)k=a(d,f).then(function(a){var b=f.get("material.color"),d;d="icon"===f.type?"multiply":"tint";return g.tintImageWithColor(a,A,b,d,l)}).then(function(a){var f=a.width,b=a.height;h=Math.max(h,f+z+1);q=Math.max(q,b+z+1);return[{shape:{type:"image",width:f,height:b,src:a.url},fill:null,stroke:null}]}),e.unshift(k);else{(w=f.get("resource.primitive"))||(w="icon"===f.type?"circle":"sphere");var x=A;"icon"===f.type&&n&&m&&(x=k/n*A);k=u&&"tall"===u.symbolConfig||("object"===
f.type?y(f):!1);h=Math.max(h,k?20:x+z+1);q=Math.max(q,x+z+1);e.unshift(b.resolve(B(f,w,x,k)))}}});return b.eachAlways(e).then(function(a){var b=[];a.forEach(function(a){a.value?b.push(a.value):a.error&&f.warn("error while building swatchInfo!",a.error)});return g.renderSymbol(b,[h,q],{node:u&&u.node,scale:!1})})}function C(a,f){var m=a.symbolLayers,p=[];a=k.isVolumetricSymbol(a);var u=f&&f.size?c.pt2px(f.size):null,e=(f&&f.maxSize?c.pt2px(f.maxSize):null)||80,y=0,h=0,w;m.forEach(function(a,f){var b=
a&&a.type,c="line"===b;if(c||"path"===b){var m=l(a,0),k=m&&m.width||0,b=[];c?(0===f&&(w=k),a=Math.min(u||k,e),a=0===f?a:u?k/w*a:a,h=Math.max(h,a),y=Math.max(y,22<a?a+1:40),m.width=a,b.push({shape:{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[y,.5*h]},{command:"E",values:[]}]},stroke:m})):(f=Math.min(u||22,e),m=d(a,0),c=d(a,-.2),a=l(a,-.4),a.width=1,b.push({shape:q.shapes.pathSymbol3DLayer[0],fill:c,stroke:a}),b.push({shape:q.shapes.pathSymbol3DLayer[1],fill:m,stroke:a}),y=
h=Math.max(h,f+1+1));p.push(b)}});return b.resolve(g.renderSymbol(p,[y,h],{node:f&&f.node,scale:a}))}Object.defineProperty(t,"__esModule",{value:!0});var z=v.toUrl("../../images/Legend/legend3dsymboldefault.png"),f=n.getLogger("esri.symbols.support.previewSymbol3D");t.getSymbolLayerFill=d;t.previewSymbol3D=function(a,f){if(0===a.symbolLayers.length)return b.reject(new e("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var m=null;switch(a.type){case "point-3d":m=D(a,f);break;
case "line-3d":m=C(a,f);break;case "polygon-3d":case "mesh-3d":a:{m="mesh-3d"===a.type;a=a.symbolLayers;for(var p=f&&f.size?c.pt2px(f.size):null,u=f&&f.maxSize?c.pt2px(f.maxSize):null,p=p||22,k=[],h=0,y=0,w=!1,n=0;n<a.length;n++){var z=a.getItemAt(n),x=z.type,B="fill"===x,t="line"===x,v="extrude"===z.type,x=[];if(m&&!B){m=void 0;break a}var E=q.shapes.fill[0];B?(w=(B=r(z))&&B.width||0,h=Math.max(h,p+w),y=Math.max(y,p+w),w=!0,x.push({shape:E,fill:d(z,0),stroke:B})):t?(z=(B=l(z,0))&&B.width||0,E={stroke:B,
shape:E},h=Math.max(h,22+z),y=Math.max(y,22+z),x.push(E)):v&&(E=l(z,-.4),B=d(z,0),z=d(z,-.2),t=Math.min(p,u||120),v=q.getExtrudeSymbolShapes(t),E.width=1,x.push({shape:v[0],fill:z,stroke:E}),x.push({shape:v[1],fill:z,stroke:E}),x.push({shape:v[2],fill:B,stroke:E}),z=22*.7+.5*t,h=Math.max(h,22+E.width+1),y=Math.max(y,z+E.width+1));k.push(x)}m=b.resolve(g.renderSymbol(k,[h,y],{node:f&&f.node,scale:w}))}}return m?m:b.reject(new e("symbolPreview: swatchInfo3D","symbol not supported."))}})},"esri/symbols/support/previewWebStyleSymbol":function(){define(["require",
"exports","../../request","../../core/screenUtils"],function(v,t,e,n){Object.defineProperty(t,"__esModule",{value:!0});t.previewWebStyleSymbol=function(b,c,h){var q=b.thumbnail&&b.thumbnail.url;return q?e(q,{responseType:"image"}).then(function(b){b=b.data;var c=!/\\.svg$/i.test(b.src)&&h&&h.disableUpsampling,k=Math.max(b.width,b.height),e=h&&null!=h.maxSize?n.pt2px(h.maxSize):120;c&&(e=Math.min(k,e));c=Math.min(e,h&&null!=h.size?n.pt2px(h.size):k);c!==k&&(k=0!==b.width&&0!==b.height?b.width/b.height:
1,1<=k?(b.width=c,b.height=c/k):(b.width=c*k,b.height=c));return h&&h.node?(h.node.appendChild(b),h.node):b}):b.fetchSymbol().then(function(b){return c(b,h)})}})},"esri/widgets/Legend/support/colorRampUtils":function(){define("require exports ../../../Color ../../../core/numberUtils ../../../symbols/support/gfxUtils ./utils".split(" "),function(v,t,e,n,b,c){function h(b,c){b=q(b,c);var a=b.startIndex,d=b.endIndex;if(a===d)return c[a].color;c=e.blendColors(c[a].color,c[d].color,b.weight);return new e(c)}
function q(b,c){var a=0,d=c.length-1;c.some(function(c,l){if(b<c.value)return d=l,!0;a=l;return!1});return{startIndex:a,endIndex:d,weight:(b-c[a].value)/(c[d].value-c[a].value)}}Object.defineProperty(t,"__esModule",{value:!0});var g=[64,64,64],x=[255,255,255];t.getRampBorderColor=function(c){var e=null;if("simple"===c.type)e=c.symbol;else if("unique-value"===c.type||"class-breaks"===c.type)e=(c=(c=c.classBreakInfos||c.uniqueValueInfos)&&c[0])&&c.symbol;return(c=(c=e&&-1===e.type.indexOf("line-symbol")?
b.getStroke(e):null)&&c.color)&&0<c.a&&!(240<=c.r&&240<=c.g&&240<=c.b)?c:null};t.getRampOverlayColor=function(b){var c=new e(x);c.a=1-b;return c};t.getRampStops=function(b,h,a){var d=!1,p=[],l=[];if(h.stops){var k=h.stops,p=k.map(function(a){return a.value});(d=k.some(function(a){return!!a.label}))&&(l=k.map(function(a){return a.label}))}var y=p[0],k=p[p.length-1];if(null==y&&null==k)return null;var q=k-y;return p.map(function(k,w){var z;if("opacity"===h.type){z=a;void 0===z&&(z=g);z=new e(z);var f=
b.getOpacity(k,{opacityInfo:h});null!=f&&(z.a=f)}else z=b.getColor(k,{colorInfo:h});w=d?l[w]:c.getLabelPrefix(w,p.length-1)+n.format(k);return{value:k,color:z,label:w,offset:q?1-(k-y)/q:1}}).reverse()};t.getRampStopsForPointCloud=function(b){var e=!1,a=[],d=[],a=b.map(function(a){return a.value});(e=b.some(function(a){return!!a.label}))&&(d=b.map(function(a){return a.label}));var p=a[0],l=a[a.length-1];if(null==p&&null==l)return null;var k=l-p;return a.map(function(l,g){var y=h(l,b);g=e?d[g]:c.getLabelPrefix(g,
a.length-1)+n.format(l);return{value:l,color:y,label:g,offset:k?1-(l-p)/k:1}}).reverse()};t.getColorFromPointCloudStops=h})},"esri/widgets/Legend/support/utils":function(){define(["require","exports"],function(v,t){Object.defineProperty(t,"__esModule",{value:!0});t.getLabelPrefix=function(e,n){return 0===e?"\x3c ":e===n?"\x3e ":""}})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["require","exports","../../../renderers/support/HeatmapColorStop"],function(v,t,e){Object.defineProperty(t,
"__esModule",{value:!0});t.getHeatmapRampStops=function(n){n=n.colorStops;var b=n.length-1;if(n&&n[0]){var c=n[b];c&&1!==c.ratio&&(n=n.slice(0),n.push(new e.HeatmapColorStop({ratio:1,color:c.color})),b++)}return n.map(function(c,e){var h="";0===e?h="low":e===b&&(h="high");return{color:c.color,label:h,ratio:c.ratio,offset:1-c.ratio}}).reverse()}})},"esri/widgets/Legend/support/relationshipRampUtils":function(){define("require exports dojox/gfx dojox/gfx/matrix ../../../symbols/support/gfxUtils ../../../symbols/support/previewSymbol3D".split(" "),
function(v,t,e,n,b,c){function h(a){if(a){var d=a.type;return-1<d.indexOf("3d")?c.getSymbolLayerFill(a.symbolLayers.getItemAt(0)):"simple-line"===d||"simple-marker"===a.type&&("x"===a.style||"cross"===a.style)?(a=b.getStroke(a))&&a.color:b.getFill(a)}}function q(a,b){var d=b.HH.label,c=b.LL.label,p=b.HL.label;b=b.LH.label;switch(a){case "HH":return{top:d,bottom:c,left:p,right:b};case "HL":return{top:p,bottom:b,left:c,right:d};case "LL":return{top:c,bottom:d,left:b,right:p};case "LH":return{top:b,
bottom:p,left:d,right:c};default:return{top:d,bottom:c,left:p,right:b}}}function g(a){var b=r[a];a&&null==b&&(b=r.HH);return b||0}function x(a,b,c,e){var d=e+"_arrowStart";e+="_arrowEnd";b="left"===b;switch(c){case "HL":a.setAttribute(b?"marker-start":"marker-end","url(#"+(b?e:d)+")");break;case "LL":a.setAttribute("marker-start","url(#"+e+")");break;case "LH":a.setAttribute(b?"marker-end":"marker-start","url(#"+(b?d:e)+")");break;default:a.setAttribute("marker-end","url(#"+d+")")}}function k(a,b,
c){var d="start"===b;b=d?c+"_arrowStart":c+"_arrowEnd";c=d?"0,0 5,5 0,10":"5,0 0,5 5,10";var e=d?"5":"0",d=document.createElementNS("http://www.w3.org/2000/svg","marker");d.setAttribute("id",b);d.setAttribute("markerWidth","10");d.setAttribute("markerHeight","10");d.setAttribute("refX",e);d.setAttribute("refY","5");d.setAttribute("markerUnits","strokeWidth");d.setAttribute("orient","auto");b=document.createElementNS("http://www.w3.org/2000/svg","polyline");b.setAttribute("points",c);b.setAttribute("fill",
"none");b.setAttribute("stroke","#555555");b.setAttribute("stroke-width","1");d.appendChild(b);a.appendChild(d)}Object.defineProperty(t,"__esModule",{value:!0});var r={HH:315,HL:45,LL:135,LH:225},a={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};t.getRelationshipRampElement=function(b){var d=b.focus,c=b.numClasses,e=a[c],k={};b.infos.forEach(function(a){k[a.value]=
{label:a.label,fill:h(a.symbol)}});b=[];for(var n=0;n<c;n++){for(var x=[],r=0;r<c;r++)x.push(k[e[n][r]].fill);b.push(x)}e=q(d,k);return{type:"relationship-ramp",numClasses:c,focus:d,colors:b,labels:e,rotation:g(d)}};t.getRotationAngleForFocus=g;t.renderRamp=function(a,c,l){void 0===l&&(l=60);var d=a.focus,p=a.numClasses,h=a.colors,g=a.rotation;a=!!d;var q=Math.sqrt(Math.pow(l,2)+Math.pow(l,2))+(a?0:5),z=document.createElement("div"),f=e.createSurface(z,q,q),m=b.create2DColorRamp({surface:f,colors:h,
numClasses:p,size:l}),p=(q-l)/2,q=(q-l)/2;m.applyTransform(n.translate(p,q));var h=l/2,u=l/2;m.applyTransform(n.rotategAt(g,h,u));var g=f.createGroup(),m={width:1,color:"#555555"},A=f.defNode;k(A,"start",c);k(A,"end",c);A=g.createLine({x1:-10,y1:l-15,x2:-10,y2:15}).setStroke(m);l=g.createLine({x1:15,y1:l+10,x2:l-15,y2:l+10}).setStroke(m);x(A.rawNode,"left",d,c);x(l.rawNode,"right",d,c);g.applyTransform(n.translate(p,q));a?g.applyTransform(n.rotategAt(-45,h,u)):f.rawNode.style.margin="-15px -15px -18px -15px";
return z}})},"esri/widgets/Legend/support/sizeRampUtils":function(){define("require exports ../../../symbols ../../../core/numberUtils ../../../symbols/support/utils ./utils".split(" "),function(v,t,e,n,b,c){function h(a,b){var d=null,c=null;if("simple"===a.type)d=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)d=(d=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&d.symbol,c=1<a.length;if(!d||q(d))return null;d=d.clone();if(b||c)-1<d.type.indexOf("3d")?g(d):(b=d,-1!==b.type.indexOf("line")?
b.color=w:(b.color=p,"simple-marker"===b.type&&(b.outline={color:w,width:1.5})));return d}function q(a){if(a)return e.isSymbol3D(a)?a.symbolLayers?a.symbolLayers.some(function(a){return a&&"fill"===a.type}):!1:-1!==a.type.indexOf("fill")}function g(a){b.isVolumetricSymbol(a)||("line-3d"===a.type?a.symbolLayers.forEach(function(a){a.material={color:w}}):a.symbolLayers.forEach(function(a){"icon"!==a.type||a.resource&&a.resource.href?a.material={color:l}:(a.material={color:p},a.outline={color:w,size:1.5})}))}
function x(a,b,d,c,e){var f=a.getSizeRangeAtScale(b,c,e),m=f&&k(f);if(f||m){for(var u=m.map(function(a){var d=f.minSize,c=f.maxSize,m=b.minDataValue,e=b.maxDataValue;return a<=d?m:a>=c?e:(a-d)/(c-d)*(e-m)+m}),u=n.round(u),l=1;l<u.length-1;l++){var p=r(a,b,d,u[l],u[l-1],c,e);p&&(u[l]=p[0],m[l]=p[1])}return u}}function k(a){var b=a.minSize;a=(a.maxSize-b)/4;for(var d=[],c=0;5>c;c++)d.push(b+a*c);return d}function r(b,d,c,e,l,f,m){var u,p=a(b,d,c,e,f,m);l=a(b,d,c,l,f,m);var k=n.numDigits(e),h=k.fractional,
g=k.integer,q=k=null;0<e&&1>e&&(k=Math.pow(10,h),e*=k,g=n.numDigits(e).integer);for(h=g-1;0<=h;h--){var z=Math.pow(10,h),g=Math.floor(e/z)*z,z=Math.ceil(e/z)*z;null!=k&&(g/=k,z/=k);u=(g+z)/2;u=n.round([g,u,z],{indexes:[1]});u=u[1];var w=a(b,d,c,g,f,m),y=a(b,d,c,z,f,m),x=a(b,d,c,u,f,m),r=n.percentChange(p,w,l,null),t=n.percentChange(p,y,l,null),v=n.percentChange(p,x,l,null),B=20>=r.previous,C=20>=t.previous;B&&C&&(r.previous<=t.previous?(B=!0,C=!1):(C=!0,B=!1));B?q=[g,w]:C?q=[z,y]:20>=v.previous&&
(q=[u,x]);if(q)break}return q}function a(a,b,d,c,e,f){return a.getSize(c,{sizeInfo:b,scale:e,view:f,shape:-1!==d.type.indexOf("marker-symbol")?d.style:null})}function d(a,d){a=a.clone();if(e.isSymbol3D(a))b.isVolumetricSymbol(a)||a.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=d)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=d;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){var c=a.width,l=a.height;a.height=d;a.width=c/l*d}else"esri.symbols.SimpleLineSymbol"===
a.declaredClass?a.width=d:"esri.symbols.TextSymbol"===a.declaredClass&&a.font&&(a.font.size=d);return a}Object.defineProperty(t,"__esModule",{value:!0});t.REAL_WORLD_MAX_SIZE=30;t.REAL_WORLD_MIN_SIZE=12;var p=[255,255,255],l=[200,200,200],w=[128,128,128];t.getRampStops=function(e,l,p,k,g){var f=l.legendOptions,f=f&&f.customValues,m=h(e,p);p=null!=l.minSize&&null!=l.maxSize;var u=l.stops&&1<l.stops.length,q=!!l.target;if(m&&(f||p||u&&!q)){var z=b.isVolumetricSymbol(m),w=null,r=null,y=null,r=z&&!u?
n.round([l.minDataValue,l.maxDataValue]):f||x(e,l,m,k,g);!r&&u&&(r=l.stops.map(function(a){return a.value}),(w=l.stops.some(function(a){return!!a.label}))&&(y=l.stops.map(function(a){return a.label})));f=!z||r&&2===r.length;if(!r||!f)return null;var v=[t.REAL_WORLD_MIN_SIZE,t.REAL_WORLD_MAX_SIZE],B=b.getSymbolOutlineSize(m);return r.map(function(b,f){var u=z?v[f]:a(e,l,m,b,k,g),p=d(m,u);f=w?y[f]:c.getLabelPrefix(f,r.length-1)+n.format(b);return{value:b,symbol:p,label:f,size:u,outlineSize:B}}).reverse()}}})},
"esri/widgets/Legend/styles/Card":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper dojo/i18n!../../../nls/common dojo/i18n!../../Legend/nls/Legend dojox/gfx ../../../core/Handles ../../../core/lang ../../../core/screenUtils ../../../core/accessorSupport/decorators ../../Widget ./support/utils ../support/styleUtils ../../support/colorUtils ../../support/widget".split(" "),function(v,t,e,n,b,c,
h,q,g,x,k,r,a,d,p,l,w){var y;(function(a){a.Auto="auto";a.Stack="stack";a.SideBySide="side-by-side"})(y||(y={}));var B=window.devicePixelRatio;return function(a){function b(b){b=a.call(this)||this;b._handles=new g;b._hasIndicators=!1;b._selectedSectionName=null;b._sectionNames=[];b._sectionMap=new Map;b.activeLayerInfos=null;b.layout=y.Stack;b.type="card";b.view=null;return b}e(b,a);b.prototype.postInitialize=function(){var a=this;this.own([this.watch("activeLayerInfos",function(b){a._handles.removeAll();
a._watchForSectionChanges(b)})])};b.prototype.destroy=function(){this._handles.destroy();this._handles=null};b.prototype.render=function(){var a=this,b;this._hasIndicators=this.layout===y.Auto&&768>=this.view.container.clientWidth||this.layout===y.Stack;var d=this.activeLayerInfos,e=d&&d.toArray().map(function(b){return a._renderLegendForLayer(b)}).filter(function(a){return!!a});this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=
this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;var l=this._sectionNames.length,d=this._sectionNames.map(function(b,f){var d;f=x.substitute({index:f+1,total:l},c.pagination.pageText);return w.tsx("div",{key:b,"aria-label":f,title:f,tabIndex:0,onclick:a._selectSection,onkeydown:a._selectSection,bind:a,class:a.classes("esri-legend--card__carousel-indicator",(d={},d["esri-legend--card__carousel-indicator--activated"]=a._selectedSectionName===b,d)),"data-section-name":b})}),
d=this._hasIndicators&&1<l?w.tsx("div",{class:"esri-legend--card__carousel-indicator-container",key:"carousel-navigation"},d):null,e=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):e&&e.length?e:null,p=(b={},b["esri-legend--stacked"]=this._hasIndicators,b);return w.tsx("div",{class:this.classes("esri-legend--card esri-widget",p)},d,e?e:w.tsx("div",{class:"esri-legend--card__message"},h.noLegend))};b.prototype._selectSection=function(a){if(a=a.target.getAttribute("data-section-name"))this._selectedSectionName=
a};b.prototype._watchForSectionChanges=function(a){var b=this;this._generateSectionNames();a&&(a.forEach(function(a){var f="activeLayerInfo-"+a.layer.uid+"-version-change";b._handles.remove(f);b._watchForSectionChanges(a.children);b._handles.add(a.watch("version",function(){return b._generateSectionNames()}),f)}),this._handles.add(a.on("change",function(){return b._watchForSectionChanges(a)})))};b.prototype._generateSectionNames=function(){this._sectionNames.length=0;this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,
this)};b.prototype._generateSectionNamesForActiveLayerInfo=function(a){var b=this;a.children.forEach(this._generateSectionNamesForActiveLayerInfo,this);a.legendElements&&a.legendElements.forEach(function(f,d){b._sectionNames.push("esri-legend--card__"+a.layer.uid+"-type-"+f.type+"-"+d)})};b.prototype._renderLegendForLayer=function(a){var b=this,d;if(!a.ready)return null;if(a.children.length)return d=a.children.map(function(a){return b._renderLegendForLayer(a)}).toArray(),w.tsx("div",{key:a.layer.uid,
class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},w.tsx("div",{class:"esri-legend--card__service-caption-container"},a.title),d);var c=a.legendElements;if(c&&!c.length)return null;var e=c.some(function(a){return"relationship-ramp"===a.type}),c=c.map(function(f,d){return b._renderLegendForElement(f,a,d,e)}).filter(function(a){return!!a});if(!c.length)return null;var l=(d={},d["esri-legend--card__group-layer-child"]=!!a.parent,d);return w.tsx("div",{key:a.layer.uid,
class:this.classes("esri-legend--card__service",l)},w.tsx("div",{class:"esri-legend--card__service-caption-container"},w.tsx("div",{class:"esri-legend--card__service-caption-text"},a.title)),w.tsx("div",{class:"esri-legend--card__service-content"},c))};b.prototype._renderLegendForElement=function(a,b,c,e){var f=this;void 0===e&&(e=!1);var m,l="color-ramp"===a.type,k="opacity-ramp"===a.type,h="size-ramp"===a.type,u=b.layer,g=a.title,q=null;"string"===typeof g?q=g:g&&(q=p.getTitle(g,l||k),q=g.title?
g.title+" ("+q+")":q);c="esri-legend--card__"+u.uid+"-type-"+a.type+"-"+c;u=this._hasIndicators?w.tsx("div",null,w.tsx("h3",{class:this.classes("esri-widget__heading","esri-legend--card__carousel-title")},b.title),w.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},q)):q?w.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},q):null;g=null;"symbol-table"===a.type?(h=a.infos.map(function(d,c){return f._renderLegendForElementInfo(d,
b,a.legendType,c)}).filter(function(a){return!!a}),h.length&&(g=h[0].properties.classes&&h[0].properties.classes["esri-legend--card__symbol-row"],e=(m={},m["esri-legend--card__label-container"]=!g&&!e,m["esri-legend--card__relationship-label-container"]=e,m),g=w.tsx("div",{key:c,class:"esri-legend--card__section"},u,w.tsx("div",{class:this.classes(e)},h)))):"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?g=w.tsx("div",{key:c,class:"esri-legend--card__section"},u,this._renderLegendForRamp(a)):
h?g=w.tsx("div",{key:c,class:"esri-legend--card__section"},u,this._renderSizeRamps(a)):"relationship-ramp"===a.type&&(g=w.tsx("div",{key:c,class:this.classes("esri-legend--card__section","esri-legend--card__relationship-section")},u,d.renderRelationshipRamp(a,this.id)));if(!g)return null;this._sectionMap.set(c,g);return g};b.prototype._renderLegendForElementInfo=function(a,b,d,c){var f,m,e,g=b.layer;if(a.type)return this._renderLegendForElement(a,b,c);b=p.isImageryStretchedLegend(g,d);if(a.symbol&&
a.preview){if(-1===a.symbol.type.indexOf("simple-fill")){if(!a.label)return w.tsx("div",{key:c,bind:a.preview,afterCreate:p.attachToNode});g=(f={},f["esri-legend--card__symbol-cell"]=this._hasIndicators,f);return w.tsx("div",{key:c,class:this.classes("esri-legend--card__layer-row",(m={},m["esri-legend--card__symbol-row"]=this._hasIndicators,m))},w.tsx("div",{class:this.classes(g),bind:a.preview,afterCreate:p.attachToNode}),w.tsx("div",{class:this.classes("esri-legend--card__image-label",(e={},e["esri-legend--card__label-cell"]=
this._hasIndicators,e))},p.getTitle(a.label,!1)||""))}e=m=f=255;var g=0,k=d=b=255,h=0,u=a.symbol.color&&a.symbol.color.a,q=a.symbol.outline&&a.symbol.outline.color.a;u&&(f=a.symbol.color.r,m=a.symbol.color.g,e=a.symbol.color.b,g=a.symbol.color.a);q&&(b=a.symbol.outline.color.r,d=a.symbol.outline.color.g,k=a.symbol.outline.color.b,h=a.symbol.outline.color.a);var n=l.isBright(a.symbol.color),r=n?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return w.tsx("div",{key:c,class:"esri-legend--card__layer-row"},
w.tsx("div",{class:"esri-legend--card__label-element",styles:{background:u?"rgba("+f+", "+m+", "+e+", "+g+")":"none",color:n?"black":"white",textShadow:"-1px -1px 0 "+r+",\n                                              1px -1px 0 "+r+",\n                                              -1px 1px 0 "+r+",\n                                              1px 1px 0 "+r,border:q?"1px solid rgba("+b+", "+d+", "+k+", "+h+")":"none"}}," ",a.label," "))}if(a.src)return f=this._renderImage(a,g,b),w.tsx("div",{key:c,
class:"esri-legend--card__layer-row"},f,w.tsx("div",{class:"esri-legend--card__image-label"},a.label||""))};b.prototype._renderImage=function(a,b,d){var f,c=a.label,m=a.src,e=a.opacity;d=(f={},f["esri-legend--card__imagery-layer-image--stretched"]=d,f["esri-legend--card__symbol"]=!d,f);b={opacity:""+(null!=e?e:b.opacity)};return w.tsx("img",{alt:c,src:m,border:0,width:a.width,height:a.height,class:this.classes(d),styles:b})};b.prototype._drawImageOnSizeRamp=function(a,b,d){var f=d.x,c=d.y,m=d.width,
e=d.height,l=new Image;l.src=b;l.onload=function(){a.drawImage(l,f,c,m,e);URL.revokeObjectURL(b)}};b.prototype._attachSizeRampToNode=function(a){var b=a["data-legend-element"].infos,d=b[0],c=b[b.length-1],e=d.symbol,l=c.symbol,g="picture-marker"===e.type;a:{if(e)if(-1<e.type.indexOf("3d")){if(b=e.symbolLayers&&e.symbolLayers.length){b=e.symbolLayers.getItemAt(b-1).get("resource.primitive");b="triangle"===b||"cone"===b||"tetrahedron"===b;break a}}else{b="triangle"===e.style;break a}b=void 0}var p;
a:{if(e)if(-1<e.type.indexOf("3d")){if(p=e.symbolLayers&&e.symbolLayers.length){p=e.symbolLayers.getItemAt(p-1);p=p.resource&&p.resource.primitive;p="circle"===p||"cross"===p||"kite"===p||"sphere"===p||"cube"===p||"diamond"===p;break a}}else{p=e.style;p="circle"===p||"diamond"===p||"cross"===p;break a}p=void 0}var h,q;g?(h=e.url,q=l.url):(d.preview&&(d.preview.firstChild.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg"),h=new Blob([d.preview.innerHTML],{type:"image/svg+xml"}),
h=URL.createObjectURL(h)),c.preview&&(c.preview.firstChild.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns","http://www.w3.org/2000/svg"),q=new Blob([c.preview.innerHTML],{type:"image/svg+xml"}),q=URL.createObjectURL(q)));var n=k.pt2px(d.size+d.outlineSize)*B,e=k.pt2px(c.size+c.outlineSize)*B,l=this._hasIndicators?n:n+100*B,g=this._hasIndicators?l+50*B:n,d=document.createElement("canvas");d.width=l;d.height=g;d.style.width=d.width/B+"px";d.style.height=d.height/B+"px";c=d.getContext("2d");this._hasIndicators?
(this._drawImageOnSizeRamp(c,h,{x:0,y:0,width:n,height:n}),this._drawImageOnSizeRamp(c,q,{x:l/2-e/2,y:g-e,width:e,height:e}),c.beginPath(),h=l/2-e/2,q=g-(b?0:p?e/2:e),c.moveTo(0,p?l/2:l),c.lineTo(h,q),h=l/2+e/2,b=g-(b?0:p?e/2:e),c.moveTo(l,p?l/2:l),c.lineTo(h,b)):(this._drawImageOnSizeRamp(c,h,{x:l-n,y:0,width:n,height:n}),this._drawImageOnSizeRamp(c,q,{x:0,y:g/2-e/2,width:e,height:e}),c.beginPath(),h=l-(p||b?n/2:n),c.moveTo(e-(p||b?e/2:0),g/2-e/2),c.lineTo(h,0),b=l-(p?n/2:n),c.moveTo(e-(p?e/2:0),
g/2+e/2),c.lineTo(b,g));c.strokeStyle="#ddd";c.stroke();a.appendChild(d)};b.prototype._renderSizeRamps=function(a){var b,d=a.infos,c=d[0].label,d=d[d.length-1].label;return w.tsx("div",{class:this.classes("esri-legend--card__layer-row",(b={},b["esri-legend--card__size-ramp-row"]=this._hasIndicators,b))},w.tsx("div",{class:"esri-legend--card__ramp-label"},this._hasIndicators?c:d),w.tsx("div",{class:"esri-legend--card__size-ramp-container"},w.tsx("div",{bind:this,"data-legend-element":a,afterCreate:this._attachSizeRampToNode})),
w.tsx("div",{class:"esri-legend--card__ramp-label"},this._hasIndicators?d:c))};b.prototype._renderLegendForRamp=function(a){var b=a.infos,d="heatmap-ramp"===a.type,c=b.length-1,e=2<c&&!d?25*c:100,l=e+20;a=document.createElement("div");a.style.width=l+"px";var g=q.createSurface(a,l,25),k=b.slice(0).reverse();try{k.forEach(function(a,b){a.offset=d?a.ratio:b/c}),d||g.createPath("M0 12.5 L10 0 L10 25 Z").setFill(k[0].color).setStroke(null),g.createRect({x:10,y:0,width:e,height:25}).setFill({type:"linear",
x1:10,y1:0,x2:e+10,y2:0,colors:k}).setStroke(null),d||g.createPath("M"+(e+10)+" 0 L"+l+" 12.5 L"+(e+10)+" 25 Z").setFill(k[k.length-1].color).setStroke(null)}catch(K){g.clear(),g.destroy()}if(!g)return null;e=k.filter(function(a,b){return!!a.label&&0!==b&&b!==k.length-1}).map(function(a){return w.tsx("div",{class:"esri-legend--card__interval-separators-container"},w.tsx("div",{class:"esri-legend--card__interval-separator"},"|"),w.tsx("div",{class:"esri-legend--card__ramp-label"},a.label))});l=b[b.length-
1].label;b=b[0].label;return w.tsx("div",{class:"esri-legend--card__layer-row"},w.tsx("div",{class:"esri-legend--card__ramp-label"},d?h[l]:l),w.tsx("div",{class:"esri-legend--card__symbol-container"},w.tsx("div",{bind:a,afterCreate:p.attachToNode}),e),w.tsx("div",{class:"esri-legend--card__ramp-label"},d?h[b]:b))};n([w.renderable(),r.property()],b.prototype,"activeLayerInfos",void 0);n([r.property()],b.prototype,"layout",void 0);n([r.property({readOnly:!0})],b.prototype,"type",void 0);n([r.property()],
b.prototype,"view",void 0);n([w.accessibleHandler()],b.prototype,"_selectSection",null);return b=n([r.subclass("esri.widgets.Legend.styles.Card")],b)}(r.declared(a))})},"esri/widgets/Legend/styles/support/utils":function(){define(["require","exports","../../support/relationshipRampUtils","../../support/styleUtils","../../../support/widget"],function(v,t,e,n,b){Object.defineProperty(t,"__esModule",{value:!0});t.renderRelationshipRamp=function(c,h){var q=c.labels,g=!!c.focus;c=e.renderRamp(c,h);return g?
b.tsx("div",{class:"esri-relationship-ramp--diamond__container"},b.tsx("div",{class:"esri-relationship-ramp--diamond__left-column"},q.left),b.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column"},b.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},q.top),b.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--ramp",bind:c,afterCreate:n.attachToNode}),b.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},q.bottom)),b.tsx("div",
{class:"esri-relationship-ramp--diamond__right-column"},q.right)):b.tsx("div",{class:"esri-relationship-ramp--square__table"},b.tsx("div",{class:"esri-relationship-ramp--square__table-row"},b.tsx("div",{class:b.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-bottom")},q.left),b.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),b.tsx("div",{class:b.classes("esri-relationship-ramp--square__table-cell",
"esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-bottom")},q.top)),b.tsx("div",{class:"esri-relationship-ramp--square__table-row"},b.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),b.tsx("div",{class:"esri-relationship-ramp--square__table-cell",bind:c,afterCreate:n.attachToNode}),b.tsx("div",{class:"esri-relationship-ramp--square__table-cell"})),b.tsx("div",{class:"esri-relationship-ramp--square__table-row"},b.tsx("div",{class:b.classes("esri-relationship-ramp--square__table-cell",
"esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-top")},q.bottom),b.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),b.tsx("div",{class:b.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-top")},q.right)))}})},"esri/widgets/Legend/support/styleUtils":function(){define(["require","exports","dojo/i18n!../../Legend/nls/Legend","../../../core/lang"],
function(v,t,e,n){Object.defineProperty(t,"__esModule",{value:!0});t.attachToNode=function(b){b.appendChild(this)};t.getTitle=function(b,c){if(b){if("string"===typeof b)return b;var h=null;c?h=b.ratioPercentTotal?"showRatioPercentTotal":b.ratioPercent?"showRatioPercent":b.ratio?"showRatio":b.normField?"showNormField":b.field?"showField":null:c||(h=b.normField?"showNormField":b.normByPct?"showNormPct":b.field?"showField":null);return h?n.substitute({field:b.field,normField:b.normField},"showField"===
h?"{field}":e[h]):null}};t.isRendererTitle=function(b,c){return!c};t.isImageryStretchedLegend=function(b,c){return!!(c&&"Stretched"===c&&10.3<=b.version&&"esri.layers.ImageryLayer"===b.declaredClass)}})},"esri/widgets/support/colorUtils":function(){define(["require","exports","../../Color"],function(v,t,e){function n(b){return new e(b)}function b(b){return!!b&&4===b.length&&x.test(b)}function c(b){return!!b&&7===b.length&&k.test(b)}function h(b){return 127<=.299*b.r+.587*b.g+.114*b.b}function q(b,
a){void 0===a&&(a=1);a=Math.pow(.7,a);return new e([Math.round(b.r*a),Math.round(b.g*a),Math.round(b.b*a),b.a])}function g(b,a){void 0===a&&(a=1);a=Math.pow(.7,a);var d=b.r,c=b.g,l=b.b;30>d&&(d=30);30>c&&(c=30);30>l&&(l=30);return new e([Math.min(255,Math.round(d/a)),Math.min(255,Math.round(c/a)),Math.min(255,Math.round(l/a)),b.a])}Object.defineProperty(t,"__esModule",{value:!0});var x=/^#[0-9A-F]{3}$/i,k=/^#[0-9A-F]{6}$/i;t.equal=function(b,a){return b&&a&&b.r===a.r&&b.g===a.g&&b.b===a.b&&b.a===
a.a};t.normalizeHex=function(b){return b?"#"+b.trim().replace(/#/g,"").substr(0,6):""};t.normalizeColor=n;t.isValidHex=function(e){return b(e)||c(e)};t.isShorthandHex=b;t.isLonghandHex=c;t.toHex=function(b){return n(b).toHex()};t.getContrastingColor=function(b){return h(b)?q(b):g(b,3)};t.isBright=h;t.darker=q;t.brighter=g})},"esri/widgets/Legend/styles/Classic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/i18n!../../Legend/nls/Legend dojox/gfx ../../../core/accessorSupport/decorators ../../Widget ./support/utils ../support/styleUtils ../../support/widget".split(" "),
function(v,t,e,n,b,c,h,q,g,x,k){return function(q){function a(a){a=q.call(this)||this;a.activeLayerInfos=null;a.type="classic";return a}e(a,q);a.prototype.render=function(){var a=this,c=this.activeLayerInfos,e=this.classes("esri-legend esri-widget--panel","esri-widget"),c=c&&c.toArray().map(function(b){return a._renderLegendForLayer(b)}).filter(function(a){return!!a});return k.tsx("div",{class:e},c&&c.length?c:k.tsx("div",{class:"esri-legend__message"},b.noLegend))};a.prototype._renderLegendForLayer=
function(a){var b=this,d;if(!a.ready)return null;var c=!!a.children.length,e="esri-legend__"+a.layer.uid+"-version-"+a.version,g=a.title?k.tsx("h3",{class:this.classes("esri-widget__heading","esri-legend__service-label")},a.title):null;if(c)return d=a.children.map(function(a){return b._renderLegendForLayer(a)}).toArray(),k.tsx("div",{key:e,class:this.classes("esri-legend__service","esri-legend__group-layer")},g,d);if((c=a.legendElements)&&!c.length)return null;c=c.map(function(d){return b._renderLegendForElement(d,
a.layer)}).filter(function(a){return!!a});if(!c.length)return null;var h=(d={},d["esri-legend__group-layer-child"]=!!a.parent,d);return k.tsx("div",{key:e,class:this.classes("esri-legend__service",h)},g,k.tsx("div",{class:"esri-legend__layer"},c))};a.prototype._renderLegendForElement=function(a,b,c){var d=this,e,l="color-ramp"===a.type,p="opacity-ramp"===a.type,h="size-ramp"===a.type,q=null;if("symbol-table"===a.type||h){var f=a.infos.map(function(f){return d._renderLegendForElementInfo(f,b,h,a.legendType)}).filter(function(a){return!!a});
f.length&&(q=k.tsx("div",{class:"esri-legend__layer-body"},f))}else"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?q=this._renderLegendForRamp(a):"relationship-ramp"===a.type&&(q=g.renderRelationshipRamp(a,this.id));if(!q)return null;var f=a.title,m=null;"string"===typeof f?m=f:f&&(m=x.getTitle(f,l||p),m=x.isRendererTitle(f,l||p)&&f.title?f.title+" ("+m+")":m);l=c?"esri-legend__layer-child-table":"esri-legend__layer-table";p=m?k.tsx("div",{class:"esri-legend__layer-caption"},
m):null;c=(e={},e["esri-legend__layer-table--size-ramp"]=h||!c,e);return k.tsx("div",{class:this.classes(l,c)},p,q)};a.prototype._renderLegendForRamp=function(a){var d=a.infos,e="opacity-ramp"===a.type,g="heatmap-ramp"===a.type,h=d.length-1,q=document.createElement("div");q.className="esri-legend__color-ramp "+(e?"esri-legend__opacity-ramp":"");q.style.height="75px";e=c.createSurface(q,"100%",75);try{if(g||d.forEach(function(a,b){a.offset=b/h}),e.createRect({x:0,y:0,width:"100%",height:75}).setFill({type:"linear",
x1:0,y1:0,x2:0,y2:75,colors:d}).setStroke(null),"color-ramp"===a.type||"opacity-ramp"===a.type){var n=a.overlayColor;n&&0<n.a&&e.createRect({x:0,y:0,width:"100%",height:75}).setFill(n).setStroke(null)}}catch(C){e.clear(),e.destroy()}if(!e)return null;a=d.filter(function(a){return!!a.label}).map(function(a){return k.tsx("div",{class:"esri-legend__ramp-label"},g?b[a.label]:a.label)});return k.tsx("div",{class:"esri-legend__layer-row"},k.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--symbols",
styles:{width:"24px"}},k.tsx("div",{class:"esri-legend__ramps",bind:q,afterCreate:x.attachToNode})),k.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info"},k.tsx("div",{class:"esri-legend__ramp-labels",styles:{height:"75px"}},a)))};a.prototype._renderLegendForElementInfo=function(a,b,c,e){var d,l;if(a.type)return this._renderLegendForElement(a,b,!0);var g=null;e=x.isImageryStretchedLegend(b,e);a.symbol&&a.preview?g=k.tsx("div",{class:"esri-legend__symbol",bind:a.preview,afterCreate:x.attachToNode}):
a.src&&(g=this._renderImage(a,b,e));if(!g)return null;b=(d={},d["esri-legend__imagery-layer-info--stretched"]=e,d);c=(l={},l["esri-legend__imagery-layer-info--stretched"]=e,l["esri-legend__size-ramp"]=!e&&c,l);return k.tsx("div",{class:"esri-legend__layer-row"},k.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--symbols",c)},g),k.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--info",b)},x.getTitle(a.label,!1)||""))};a.prototype._renderImage=
function(a,b,c){var d,e=a.label,l=a.src,g=a.opacity;c=(d={},d["esri-legend__imagery-layer-image--stretched"]=c,d["esri-legend__symbol"]=!c,d);b={opacity:""+(null!=g?g:b.opacity)};return k.tsx("img",{alt:e,src:l,border:0,width:a.width,height:a.height,class:this.classes(c),styles:b})};n([k.renderable(),h.property()],a.prototype,"activeLayerInfos",void 0);n([h.property({readOnly:!0})],a.prototype,"type",void 0);return a=n([h.subclass("esri.widgets.Legend.styles.Classic")],a)}(h.declared(q))})},"dojox/gfx/svg":function(){define("dojo/_base/lang dojo/_base/sniff dojo/_base/window dojo/dom dojo/_base/declare dojo/_base/array dojo/dom-geometry dojo/dom-attr dojo/_base/Color ./_base ./shape ./path".split(" "),
function(v,t,e,n,b,c,h,q,g,x,k,r){function a(a,b){return e.doc.createElementNS?e.doc.createElementNS(a,b):e.doc.createElement(b)}function d(a,b,d,c){return a.setAttributeNS?a.setAttributeNS(b,d,c):a.setAttribute(d,c)}function p(a){return l.useSvgWeb?e.doc.createTextNode(a,!0):e.doc.createTextNode(a)}var l=x.svg={};l.useSvgWeb="undefined"!=typeof window.svgweb;var w=navigator.userAgent,y=t("ios"),B=t("chrome")?"auto":"optimizeLegibility";l.xmlns={xlink:"http://www.w3.org/1999/xlink",svg:"http://www.w3.org/2000/svg"};
l.getRef=function(a){return a&&"none"!=a?a.match(/^url\(#.+\)$/)?n.byId(a.slice(5,-1)):a.match(/^#dojoUnique\d+$/)?n.byId(a.slice(1)):null:null};l.dasharray={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};var D=0;l.Shape=b("dojox.gfx.svg.Shape",k.Shape,{destroy:function(){if(this.fillStyle&&"type"in this.fillStyle){var a=this.rawNode.getAttribute("fill");
(a=l.getRef(a))&&a.parentNode.removeChild(a)}this.clip&&(a=this.rawNode.getAttribute("clip-path"))&&(a=n.byId(a.match(/gfx_clip[\d]+/)[0]))&&a.parentNode.removeChild(a);k.Shape.prototype.destroy.apply(this,arguments)},setFill:function(a){if(!a)return this.fillStyle=null,this.rawNode.setAttribute("fill","none"),this.rawNode.setAttribute("fill-opacity",0),this;var b,d=function(a){this.setAttribute(a,b[a].toFixed(8))};if("object"==typeof a&&"type"in a){switch(a.type){case "linear":b=x.makeParameters(x.defaultLinearGradient,
a);a=this._setFillObject(b,"linearGradient");c.forEach(["x1","y1","x2","y2"],d,a);break;case "radial":b=x.makeParameters(x.defaultRadialGradient,a);a=this._setFillObject(b,"radialGradient");c.forEach(["cx","cy","r"],d,a);break;case "pattern":b=x.makeParameters(x.defaultPattern,a),a=this._setFillObject(b,"pattern"),c.forEach(["x","y","width","height"],d,a)}this.fillStyle=b;return this}this.fillStyle=b=x.normalizeColor(a);this.rawNode.setAttribute("fill",b.toCss());this.rawNode.setAttribute("fill-opacity",
b.a);this.rawNode.setAttribute("fill-rule","evenodd");return this},setStroke:function(a){var b=this.rawNode;if(!a)return this.strokeStyle=null,b.setAttribute("stroke","none"),b.setAttribute("stroke-opacity",0),this;if("string"==typeof a||v.isArray(a)||a instanceof g)a={color:a};a=this.strokeStyle=x.makeParameters(x.defaultStroke,a);a.color=x.normalizeColor(a.color);if(a){var d=0>a.width?0:a.width;b.setAttribute("stroke",a.color.toCss());b.setAttribute("stroke-opacity",a.color.a);b.setAttribute("stroke-width",
d);b.setAttribute("stroke-linecap",a.cap);"number"==typeof a.join?(b.setAttribute("stroke-linejoin","miter"),b.setAttribute("stroke-miterlimit",a.join)):b.setAttribute("stroke-linejoin",a.join);var c=a.style.toLowerCase();c in l.dasharray&&(c=l.dasharray[c]);if(c instanceof Array){var c=v._toArray(c),f;for(f=0;f<c.length;++f)c[f]*=d;if("butt"!=a.cap){for(f=0;f<c.length;f+=2)c[f]-=d,1>c[f]&&(c[f]=1);for(f=1;f<c.length;f+=2)c[f]+=d}c=c.join(",")}b.setAttribute("stroke-dasharray",c);b.setAttribute("dojoGfxStrokeStyle",
a.style)}return this},_getParentSurface:function(){for(var a=this.parent;a&&!(a instanceof x.Surface);a=a.parent);return a},_setFillObject:function(b,c){var f=l.xmlns.svg;this.fillStyle=b;var e=this._getParentSurface().defNode,m=this.rawNode.getAttribute("fill");if(m=l.getRef(m))if(m.tagName.toLowerCase()!=c.toLowerCase()){var g=m.id;m.parentNode.removeChild(m);m=a(f,c);m.setAttribute("id",g);e.appendChild(m)}else for(;m.childNodes.length;)m.removeChild(m.lastChild);else m=a(f,c),m.setAttribute("id",
x._base._getUniqueId()),e.appendChild(m);if("pattern"==c)m.setAttribute("patternUnits","userSpaceOnUse"),f=a(f,"image"),f.setAttribute("x",0),f.setAttribute("y",0),f.setAttribute("width",(0>b.width?0:b.width).toFixed(8)),f.setAttribute("height",(0>b.height?0:b.height).toFixed(8)),d(f,l.xmlns.xlink,"xlink:href",b.src),m.appendChild(f);else for(m.setAttribute("gradientUnits","userSpaceOnUse"),c=0;c<b.colors.length;++c){var e=b.colors[c],g=a(f,"stop"),h=e.color=x.normalizeColor(e.color);g.setAttribute("offset",
e.offset.toFixed(8));g.setAttribute("stop-color",h.toCss());g.setAttribute("stop-opacity",h.a);m.appendChild(g)}this.rawNode.setAttribute("fill","url(#"+m.getAttribute("id")+")");this.rawNode.removeAttribute("fill-opacity");this.rawNode.setAttribute("fill-rule","evenodd");return m},_applyTransform:function(){if(this.matrix){var a=this.matrix;this.rawNode.setAttribute("transform","matrix("+a.xx.toFixed(8)+","+a.yx.toFixed(8)+","+a.xy.toFixed(8)+","+a.yy.toFixed(8)+","+a.dx.toFixed(8)+","+a.dy.toFixed(8)+
")")}else this.rawNode.removeAttribute("transform");return this},setRawNode:function(a){a=this.rawNode=a;"image"!=this.shape.type&&a.setAttribute("fill","none");a.setAttribute("fill-opacity",0);a.setAttribute("stroke","none");a.setAttribute("stroke-opacity",0);a.setAttribute("stroke-width",1);a.setAttribute("stroke-linecap","butt");a.setAttribute("stroke-linejoin","miter");a.setAttribute("stroke-miterlimit",4);a.__gfxObject__=this},setShape:function(a){this.shape=x.makeParameters(this.shape,a);for(var b in this.shape)if("type"!=
b){a=this.shape[b];if("width"===b||"height"===b)a=0>a?0:a;this.rawNode.setAttribute(b,a)}this.bbox=null;return this},_moveToFront:function(){this.rawNode.parentNode.appendChild(this.rawNode);return this},_moveToBack:function(){this.rawNode.parentNode.insertBefore(this.rawNode,this.rawNode.parentNode.firstChild);return this},setClip:function(b){this.inherited(arguments);var c=b?"width"in b?"rect":"cx"in b?"ellipse":"points"in b?"polyline":"d"in b?"path":null:null;if(b&&!c)return this;"polyline"===
c&&(b=v.clone(b),b.points=b.points.join(","));var d,f=q.get(this.rawNode,"clip-path");f&&(d=n.byId(f.match(/gfx_clip[\d]+/)[0]))&&d.removeChild(d.childNodes[0]);b?(d?(c=a(l.xmlns.svg,c),d.appendChild(c)):(f="gfx_clip"+ ++D,this.rawNode.setAttribute("clip-path","url(#"+f+")"),d=a(l.xmlns.svg,"clipPath"),c=a(l.xmlns.svg,c),d.appendChild(c),this.rawNode.parentNode.insertBefore(d,this.rawNode),q.set(d,"id",f)),q.set(c,b)):(this.rawNode.removeAttribute("clip-path"),d&&d.parentNode.removeChild(d));return this},
_removeClipNode:function(){var a,b=q.get(this.rawNode,"clip-path");b&&(a=n.byId(b.match(/gfx_clip[\d]+/)[0]))&&a.parentNode.removeChild(a);return a}});l.Group=b("dojox.gfx.svg.Group",l.Shape,{constructor:function(){k.Container._init.call(this)},setRawNode:function(a){this.rawNode=a;this.rawNode.__gfxObject__=this},destroy:function(){this.clear(!0);l.Shape.prototype.destroy.apply(this,arguments)}});l.Group.nodeType="g";l.Rect=b("dojox.gfx.svg.Rect",[l.Shape,k.Rect],{setShape:function(a){this.shape=
x.makeParameters(this.shape,a);this.bbox=null;for(var b in this.shape)if("type"!=b&&"r"!=b){a=this.shape[b];if("width"===b||"height"===b)a=0>a?0:a;this.rawNode.setAttribute(b,a)}null!=this.shape.r&&(this.rawNode.setAttribute("ry",this.shape.r),this.rawNode.setAttribute("rx",this.shape.r));return this}});l.Rect.nodeType="rect";l.Ellipse=b("dojox.gfx.svg.Ellipse",[l.Shape,k.Ellipse],{});l.Ellipse.nodeType="ellipse";l.Circle=b("dojox.gfx.svg.Circle",[l.Shape,k.Circle],{});l.Circle.nodeType="circle";
l.Line=b("dojox.gfx.svg.Line",[l.Shape,k.Line],{});l.Line.nodeType="line";l.Polyline=b("dojox.gfx.svg.Polyline",[l.Shape,k.Polyline],{setShape:function(a,b){a&&a instanceof Array?(this.shape=x.makeParameters(this.shape,{points:a}),b&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.shape=x.makeParameters(this.shape,a);this.bbox=null;this._normalizePoints();a=[];b=this.shape.points;for(var d=0;d<b.length;++d)a.push(b[d].x.toFixed(8),b[d].y.toFixed(8));this.rawNode.setAttribute("points",
a.join(" "));return this}});l.Polyline.nodeType="polyline";l.Image=b("dojox.gfx.svg.Image",[l.Shape,k.Image],{setShape:function(a){this.shape=x.makeParameters(this.shape,a);this.bbox=null;a=this.rawNode;for(var b in this.shape)if("type"!=b&&"src"!=b){var c=this.shape[b];if("width"===b||"height"===b)c=0>c?0:c;a.setAttribute(b,c)}a.setAttribute("preserveAspectRatio","none");d(a,l.xmlns.xlink,"xlink:href",this.shape.src);a.__gfxObject__=this;return this}});l.Image.nodeType="image";l.Text=b("dojox.gfx.svg.Text",
[l.Shape,k.Text],{setShape:function(a){this.shape=x.makeParameters(this.shape,a);this.bbox=null;a=this.rawNode;var b=this.shape;a.setAttribute("x",b.x);a.setAttribute("y",b.y);a.setAttribute("text-anchor",b.align);a.setAttribute("text-decoration",b.decoration);a.setAttribute("rotate",b.rotated?90:0);a.setAttribute("kerning",b.kerning?"auto":0);a.setAttribute("text-rendering",B);a.firstChild?a.firstChild.nodeValue=b.text:a.appendChild(p(b.text));return this},getTextWidth:function(){var a=this.rawNode,
b=a.parentNode,a=a.cloneNode(!0);a.style.visibility="hidden";var d=0,c=a.firstChild.nodeValue;b.appendChild(a);if(""!=c)for(;!d;)d=a.getBBox?parseInt(a.getBBox().width):68;b.removeChild(a);return d},getBoundingBox:function(){var a=null;if(this.getShape().text)try{a=this.rawNode.getBBox()}catch(m){a={x:0,y:0,width:0,height:0}}return a}});l.Text.nodeType="text";l.Path=b("dojox.gfx.svg.Path",[l.Shape,r.Path],{_updateWithSegment:function(a){this.inherited(arguments);"string"==typeof this.shape.path&&
this.rawNode.setAttribute("d",this.shape.path)},setShape:function(a){this.inherited(arguments);this.shape.path?this.rawNode.setAttribute("d",this.shape.path):this.rawNode.removeAttribute("d");return this}});l.Path.nodeType="path";l.TextPath=b("dojox.gfx.svg.TextPath",[l.Shape,r.TextPath],{_updateWithSegment:function(a){this.inherited(arguments);this._setTextPath()},setShape:function(a){this.inherited(arguments);this._setTextPath();return this},_setTextPath:function(){if("string"==typeof this.shape.path){var b=
this.rawNode;if(!b.firstChild){var c=a(l.xmlns.svg,"textPath"),e=p("");c.appendChild(e);b.appendChild(c)}c=(c=b.firstChild.getAttributeNS(l.xmlns.xlink,"href"))&&l.getRef(c);if(!c&&(e=this._getParentSurface())){var e=e.defNode,c=a(l.xmlns.svg,"path"),g=x._base._getUniqueId();c.setAttribute("id",g);e.appendChild(c);d(b.firstChild,l.xmlns.xlink,"xlink:href","#"+g)}c&&c.setAttribute("d",this.shape.path)}},_setText:function(){var b=this.rawNode;if(!b.firstChild){var c=a(l.xmlns.svg,"textPath"),d=p("");
c.appendChild(d);b.appendChild(c)}b=b.firstChild;c=this.text;b.setAttribute("alignment-baseline","middle");switch(c.align){case "middle":b.setAttribute("text-anchor","middle");b.setAttribute("startOffset","50%");break;case "end":b.setAttribute("text-anchor","end");b.setAttribute("startOffset","100%");break;default:b.setAttribute("text-anchor","start"),b.setAttribute("startOffset","0%")}b.setAttribute("baseline-shift","0.5ex");b.setAttribute("text-decoration",c.decoration);b.setAttribute("rotate",
c.rotated?90:0);b.setAttribute("kerning",c.kerning?"auto":0);b.firstChild.data=c.text}});l.TextPath.nodeType="text";var C=534<function(){var a=/WebKit\/(\d*)/.exec(w);return a?a[1]:0}();l.Surface=b("dojox.gfx.svg.Surface",k.Surface,{constructor:function(){k.Container._init.call(this)},destroy:function(){k.Container.clear.call(this,!0);this.defNode=null;this.inherited(arguments)},setDimensions:function(a,b){if(!this.rawNode)return this;a=0>a?0:a;b=0>b?0:b;this.rawNode.setAttribute("width",a);this.rawNode.setAttribute("height",
b);C&&(this.rawNode.style.width=a,this.rawNode.style.height=b);return this},getDimensions:function(){return this.rawNode?{width:x.normalizedLength(this.rawNode.getAttribute("width")),height:x.normalizedLength(this.rawNode.getAttribute("height"))}:null}});l.createSurface=function(b,c,d){var f=new l.Surface;f.rawNode=a(l.xmlns.svg,"svg");f.rawNode.setAttribute("overflow","hidden");c&&f.rawNode.setAttribute("width",0>c?0:c);d&&f.rawNode.setAttribute("height",0>d?0:d);c=a(l.xmlns.svg,"defs");f.rawNode.appendChild(c);
f.defNode=c;f._parent=n.byId(b);f._parent.appendChild(f.rawNode);x._base._fixMsTouchAction(f);return f};t={_setFont:function(){var a=this.fontStyle;this.rawNode.setAttribute("font-style",a.style);this.rawNode.setAttribute("font-variant",a.variant);this.rawNode.setAttribute("font-weight",a.weight);this.rawNode.setAttribute("font-size",a.size);this.rawNode.setAttribute("font-family",a.family)}};var z=k.Container;b=l.Container={openBatch:function(){if(!this._batch){var a;a=l.useSvgWeb?e.doc.createDocumentFragment(!0):
e.doc.createDocumentFragment();this.fragment=a}++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this.fragment&&!this._batch&&(this.rawNode.appendChild(this.fragment),delete this.fragment);return this},add:function(a){this!=a.getParent()&&(this.fragment?this.fragment.appendChild(a.rawNode):this.rawNode.appendChild(a.rawNode),z.add.apply(this,arguments),a.setClip(a.clip));return this},remove:function(a,b){this==a.getParent()&&(this.rawNode==a.rawNode.parentNode&&
this.rawNode.removeChild(a.rawNode),this.fragment&&this.fragment==a.rawNode.parentNode&&this.fragment.removeChild(a.rawNode),a._removeClipNode(),z.remove.apply(this,arguments));return this},clear:function(){for(var a=this.rawNode;a.lastChild;)a.removeChild(a.lastChild);var b=this.defNode;if(b){for(;b.lastChild;)b.removeChild(b.lastChild);a.appendChild(b)}return z.clear.apply(this,arguments)},getBoundingBox:z.getBoundingBox,_moveChildToFront:z._moveChildToFront,_moveChildToBack:z._moveChildToBack};
r=l.Creator={createObject:function(b,c){if(!this.rawNode)return null;var d=new b;b=a(l.xmlns.svg,b.nodeType);d.setRawNode(b);d.setShape(c);this.add(d);return d}};v.extend(l.Text,t);v.extend(l.TextPath,t);v.extend(l.Group,b);v.extend(l.Group,k.Creator);v.extend(l.Group,r);v.extend(l.Surface,b);v.extend(l.Surface,k.Creator);v.extend(l.Surface,r);l.fixTarget=function(a,b){a.gfxTarget||(a.gfxTarget=y&&a.target.wholeText?a.target.parentElement.__gfxObject__:a.target.__gfxObject__);return!0};l.useSvgWeb&&
(l.createSurface=function(b,c,d){var f=new l.Surface;c=0>c?0:c;d=0>d?0:d;if(!c||!d){var e=h.position(b);c=c||e.w;d=d||e.h}b=n.byId(b);var e=b.id?b.id+"_svgweb":x._base._getUniqueId(),g=a(l.xmlns.svg,"svg");g.id=e;g.setAttribute("width",c);g.setAttribute("height",d);svgweb.appendChild(g,b);g.addEventListener("SVGLoad",function(){f.rawNode=this;f.isLoaded=!0;var b=a(l.xmlns.svg,"defs");f.rawNode.appendChild(b);f.defNode=b;if(f.onLoad)f.onLoad(f)},!1);f.isLoaded=!1;return f},l.Surface.extend({destroy:function(){var a=
this.rawNode;svgweb.removeChild(a,a.parentNode)}}),t={connect:function(a,b,c){"on"===a.substring(0,2)&&(a=a.substring(2));c=2==arguments.length?b:v.hitch(b,c);this.getEventSource().addEventListener(a,c,!1);return[this,a,c]},disconnect:function(a){this.getEventSource().removeEventListener(a[1],a[2],!1);delete a[0]}},v.extend(l.Shape,t),v.extend(l.Surface,t));return l})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),
function(v,t,e,n,b,c,h,q,g,x){function k(a,b){for(var c=a.length-1;b<c;)a[b]=a[++b];a.length=c}var r=v.shape={};r.Shape=e("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(b("gfxRegistry")){var a=r.register(this);this.getUID=function(){return a}}},destroy:function(){b("gfxRegistry")&&r.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=
null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var a=this.getBoundingBox();if(!a)return null;var b=this._getRealMatrix();return[x.multiplyPoint(b,a.x,a.y),x.multiplyPoint(b,a.x+a.width,a.y),x.multiplyPoint(b,a.x+
a.width,a.y+a.height),x.multiplyPoint(b,a.x,a.y+a.height)]},getEventSource:function(){return this.rawNode},setClip:function(a){this.clip=a},getClip:function(){return this.clip},setShape:function(a){this.shape=v.makeParameters(this.shape,a);this.bbox=null;return this},setFill:function(a){if(!a)return this.fillStyle=null,this;var b=null;if("object"==typeof a&&"type"in a)switch(a.type){case "linear":b=v.makeParameters(v.defaultLinearGradient,a);break;case "radial":b=v.makeParameters(v.defaultRadialGradient,
a);break;case "pattern":b=v.makeParameters(v.defaultPattern,a)}else b=v.normalizeColor(a);this.fillStyle=b;return this},setStroke:function(a){if(!a)return this.strokeStyle=null,this;if("string"==typeof a||t.isArray(a)||a instanceof g)a={color:a};a=this.strokeStyle=v.makeParameters(v.defaultStroke,a);a.color=v.normalizeColor(a.color);return this},setTransform:function(a){this.matrix=x.clone(a?x.normalize(a):x.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var a=
this.getParent();a&&(a._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var a=this.getParent();a&&(a._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(a){return a?this.setTransform([this.matrix,a]):this},applyLeftTransform:function(a){return a?this.setTransform([a,this.matrix]):this},applyTransform:function(a){return a?this.setTransform([this.matrix,a]):this},removeShape:function(a){this.parent&&
this.parent.remove(this,a);return this},_setParent:function(a,b){this.parent=a;return this._updateParentMatrix(b)},_updateParentMatrix:function(a){this.parentMatrix=a?x.clone(a):null;return this._applyTransform()},_getRealMatrix:function(){for(var a=this.matrix,b=this.parent;b;)b.matrix&&(a=x.multiply(b.matrix,a)),b=b.parent;return a}});r._eventsProcessing={on:function(a,b){return c(this.getEventSource(),a,r.fixCallback(this,v.fixTarget,b))},connect:function(a,b,c){"on"==a.substring(0,2)&&(a=a.substring(2));
return this.on(a,c?t.hitch(b,c):b)},disconnect:function(a){return a.remove()}};r.fixCallback=function(a,b,c,e){e||(e=c,c=null);if(t.isString(e)){c=c||n.global;if(!c[e])throw['dojox.gfx.shape.fixCallback: scope["',e,'"] is null (scope\x3d"',c,'")'].join("");return function(d){return b(d,a)?c[e].apply(c,arguments||[]):void 0}}return c?function(d){return b(d,a)?e.apply(c,arguments||[]):void 0}:function(d){return b(d,a)?e.apply(c,arguments):void 0}};t.extend(r.Shape,r._eventsProcessing);r.Container={_init:function(){this.children=
[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(a){var b=a.getParent();b&&b.remove(a,!0);this.children.push(a);return a._setParent(this,this._getRealMatrix())},remove:function(a,b){for(var c=0;c<this.children.length;++c)if(this.children[c]==a){b||(a.parent=null,a.parentMatrix=null);k(this.children,c);break}return this},clear:function(a){for(var b,c=0;c<this.children.length;++c)b=this.children[c],b.parent=null,b.parentMatrix=null,a&&b.destroy();this.children=
[];return this},getBoundingBox:function(){if(this.children){var a=null;h.forEach(this.children,function(b){var c=b.getBoundingBox();c&&((b=b.getTransform())&&(c=x.multiplyRectangle(b,c)),a?(a.x=Math.min(a.x,c.x),a.y=Math.min(a.y,c.y),a.endX=Math.max(a.endX,c.x+c.width),a.endY=Math.max(a.endY,c.y+c.height)):a={x:c.x,y:c.y,endX:c.x+c.width,endY:c.y+c.height})});a&&(a.width=a.endX-a.x,a.height=a.endY-a.y);return a}return null},_moveChildToFront:function(a){for(var b=0;b<this.children.length;++b)if(this.children[b]==
a){k(this.children,b);this.children.push(a);break}return this},_moveChildToBack:function(a){for(var b=0;b<this.children.length;++b)if(this.children[b]==a){k(this.children,b);this.children.unshift(a);break}return this}};r.Surface=e("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){h.forEach(this._nodes,q.destroy);this._nodes=[];h.forEach(this._events,function(a){a&&a.remove()});this._events=[];this.rawNode=null;
if(b("ie"))for(;this._parent.lastChild;)q.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(a){},whenLoaded:function(a,b){var d=t.hitch(a,b);if(this.isLoaded)d(this);else c.once(this,"load",function(a){d(a)})}});t.extend(r.Surface,r._eventsProcessing);r.Rect=e("dojox.gfx.shape.Rect",r.Shape,{constructor:function(a){this.shape=v.getDefault("Rect");this.rawNode=
a},getBoundingBox:function(){return this.shape}});r.Ellipse=e("dojox.gfx.shape.Ellipse",r.Shape,{constructor:function(a){this.shape=v.getDefault("Ellipse");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-a.rx,y:a.cy-a.ry,width:2*a.rx,height:2*a.ry}}return this.bbox}});r.Circle=e("dojox.gfx.shape.Circle",r.Shape,{constructor:function(a){this.shape=v.getDefault("Circle");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:a.cx-
a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r}}return this.bbox}});r.Line=e("dojox.gfx.shape.Line",r.Shape,{constructor:function(a){this.shape=v.getDefault("Line");this.rawNode=a},getBoundingBox:function(){if(!this.bbox){var a=this.shape;this.bbox={x:Math.min(a.x1,a.x2),y:Math.min(a.y1,a.y2),width:Math.abs(a.x2-a.x1),height:Math.abs(a.y2-a.y1)}}return this.bbox}});r.Polyline=e("dojox.gfx.shape.Polyline",r.Shape,{constructor:function(a){this.shape=v.getDefault("Polyline");this.rawNode=a},setShape:function(a,
b){a&&a instanceof Array?(this.inherited(arguments,[{points:a}]),b&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[a]);return this},_normalizePoints:function(){var a=this.shape.points,b=a&&a.length;if(b&&"number"==typeof a[0]){for(var c=[],e=0;e<b;e+=2)c.push({x:a[e],y:a[e+1]});this.shape.points=c}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var a=this.shape.points,b=a.length,c=a[0],e=c.x,g=c.y,h=c.x,k=c.y,q=1;q<b;++q)c=
a[q],e>c.x&&(e=c.x),h<c.x&&(h=c.x),g>c.y&&(g=c.y),k<c.y&&(k=c.y);this.bbox={x:e,y:g,width:h-e,height:k-g}}return this.bbox}});r.Image=e("dojox.gfx.shape.Image",r.Shape,{constructor:function(a){this.shape=v.getDefault("Image");this.rawNode=a},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});r.Text=e(r.Shape,{constructor:function(a){this.fontStyle=null;this.shape=v.getDefault("Text");this.rawNode=a},getFont:function(){return this.fontStyle},
setFont:function(a){this.fontStyle="string"==typeof a?v.splitFontString(a):v.makeParameters(v.defaultFont,a);this._setFont();return this},getBoundingBox:function(){var a=null;this.getShape().text&&(a=v._base._computeTextBoundingBox(this));return a}});r.Creator={createShape:function(a){switch(a.type){case v.defaultPath.type:return this.createPath(a);case v.defaultRect.type:return this.createRect(a);case v.defaultCircle.type:return this.createCircle(a);case v.defaultEllipse.type:return this.createEllipse(a);
case v.defaultLine.type:return this.createLine(a);case v.defaultPolyline.type:return this.createPolyline(a);case v.defaultImage.type:return this.createImage(a);case v.defaultText.type:return this.createText(a);case v.defaultTextPath.type:return this.createTextPath(a)}return null},createGroup:function(){return this.createObject(v.Group)},createRect:function(a){return this.createObject(v.Rect,a)},createEllipse:function(a){return this.createObject(v.Ellipse,a)},createCircle:function(a){return this.createObject(v.Circle,
a)},createLine:function(a){return this.createObject(v.Line,a)},createPolyline:function(a){return this.createObject(v.Polyline,a)},createImage:function(a){return this.createObject(v.Image,a)},createText:function(a){return this.createObject(v.Text,a)},createPath:function(a){return this.createObject(v.Path,a)},createTextPath:function(a){return this.createObject(v.TextPath,{}).setText(a)},createObject:function(a,b){return null}};return r})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang",
"dojo/_base/declare","./matrix","./shape"],function(v,t,e,n,b){b=e("dojox.gfx.path.Path",b.Shape,{constructor:function(b){this.shape=t.clone(v.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=b;this.segmented=!1},setAbsoluteMode:function(b){this._confirmSegmented();this.absolute="string"==typeof b?"absolute"==b:b;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&
"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var b=this.bbox,e=this._getRealMatrix();this.bbox=null;for(var q=0,g=this.segments.length;q<g;++q)this._updateWithSegment(this.segments[q],e);e=this.bbox;this.bbox=b;return this.tbbox=e?[{x:e.l,y:e.t},{x:e.r,y:e.t},{x:e.r,y:e.b},{x:e.l,y:e.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in
this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(b,e,q){q&&(e=n.multiplyPoint(q,b,e),b=e.x,e=e.y);this.bbox&&"l"in this.bbox?(this.bbox.l>b&&(this.bbox.l=b),this.bbox.r<b&&(this.bbox.r=b),this.bbox.t>e&&(this.bbox.t=e),this.bbox.b<e&&(this.bbox.b=e)):this.bbox={l:b,b:e,r:b,t:e}},_updateWithSegment:function(b,e){var c=b.args,g=c.length,h;switch(b.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(h=0;h<g;h+=2)this._updateBBox(c[h],
c[h+1],e);this.last.x=c[g-2];this.last.y=c[g-1];this.absolute=!0;break;case "H":for(h=0;h<g;++h)this._updateBBox(c[h],this.last.y,e);this.last.x=c[g-1];this.absolute=!0;break;case "V":for(h=0;h<g;++h)this._updateBBox(this.last.x,c[h],e);this.last.y=c[g-1];this.absolute=!0;break;case "m":h=0;"x"in this.last||(this._updateBBox(this.last.x=c[0],this.last.y=c[1],e),h=2);for(;h<g;h+=2)this._updateBBox(this.last.x+=c[h],this.last.y+=c[h+1],e);this.absolute=!1;break;case "l":case "t":for(h=0;h<g;h+=2)this._updateBBox(this.last.x+=
c[h],this.last.y+=c[h+1],e);this.absolute=!1;break;case "h":for(h=0;h<g;++h)this._updateBBox(this.last.x+=c[h],this.last.y,e);this.absolute=!1;break;case "v":for(h=0;h<g;++h)this._updateBBox(this.last.x,this.last.y+=c[h],e);this.absolute=!1;break;case "c":for(h=0;h<g;h+=6)this._updateBBox(this.last.x+c[h],this.last.y+c[h+1],e),this._updateBBox(this.last.x+c[h+2],this.last.y+c[h+3],e),this._updateBBox(this.last.x+=c[h+4],this.last.y+=c[h+5],e);this.absolute=!1;break;case "s":case "q":for(h=0;h<g;h+=
4)this._updateBBox(this.last.x+c[h],this.last.y+c[h+1],e),this._updateBBox(this.last.x+=c[h+2],this.last.y+=c[h+3],e);this.absolute=!1;break;case "A":for(h=0;h<g;h+=7)this._updateBBox(c[h+5],c[h+6],e);this.last.x=c[g-2];this.last.y=c[g-1];this.absolute=!0;break;case "a":for(h=0;h<g;h+=7)this._updateBBox(this.last.x+=c[h+5],this.last.y+=c[h+6],e);this.absolute=!1}b=[b.action];for(h=0;h<g;++h)b.push(v.formatNumber(c[h],!0));if("string"==typeof this.shape.path)this.shape.path+=b.join("");else for(h=
0,g=b.length;h<g;++h)this.shape.path.push(b[h])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(b,e){this.tbbox=null;var c=this._validSegments[b.toLowerCase()];"number"==typeof c&&(c?e.length>=c&&(b={action:b,args:e.slice(0,e.length-e.length%c)},this.segments.push(b),this._updateWithSegment(b)):(b={action:b,args:[]},this.segments.push(b),this._updateWithSegment(b)))},_collectArgs:function(b,e){for(var c=0;c<e.length;++c){var g=e[c];"boolean"==typeof g?b.push(g?1:0):
"number"==typeof g?b.push(g):g instanceof Array?this._collectArgs(b,g):"x"in g&&"y"in g&&b.push(g.x,g.y)}},moveTo:function(){this._confirmSegmented();var b=[];this._collectArgs(b,arguments);this._pushSegment(this.absolute?"M":"m",b);return this},lineTo:function(){this._confirmSegmented();var b=[];this._collectArgs(b,arguments);this._pushSegment(this.absolute?"L":"l",b);return this},hLineTo:function(){this._confirmSegmented();var b=[];this._collectArgs(b,arguments);this._pushSegment(this.absolute?
"H":"h",b);return this},vLineTo:function(){this._confirmSegmented();var b=[];this._collectArgs(b,arguments);this._pushSegment(this.absolute?"V":"v",b);return this},curveTo:function(){this._confirmSegmented();var b=[];this._collectArgs(b,arguments);this._pushSegment(this.absolute?"C":"c",b);return this},smoothCurveTo:function(){this._confirmSegmented();var b=[];this._collectArgs(b,arguments);this._pushSegment(this.absolute?"S":"s",b);return this},qCurveTo:function(){this._confirmSegmented();var b=
[];this._collectArgs(b,arguments);this._pushSegment(this.absolute?"Q":"q",b);return this},qSmoothCurveTo:function(){this._confirmSegmented();var b=[];this._collectArgs(b,arguments);this._pushSegment(this.absolute?"T":"t",b);return this},arcTo:function(){this._confirmSegmented();var b=[];this._collectArgs(b,arguments);this._pushSegment(this.absolute?"A":"a",b);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var b=
this.shape.path;this.shape.path=[];this._setPath(b);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(b){b=t.isArray(b)?b:b.match(v.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(b){for(var c="",e=[],g=b.length,n=0;n<g;++n){var k=b[n],r=parseFloat(k);isNaN(r)?(c&&this._pushSegment(c,e),e=[],c=k):e.push(r)}this._pushSegment(c,e)}},setShape:function(b){this.inherited(arguments,["string"==typeof b?{path:b}:b]);this.segmented=!1;this.segments=
[];v.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});e=e("dojox.gfx.path.TextPath",b,{constructor:function(b){"text"in this||(this.text=t.clone(v.defaultTextPath));"fontStyle"in this||(this.fontStyle=t.clone(v.defaultFont))},getText:function(){return this.text},setText:function(b){this.text=v.makeParameters(this.text,"string"==typeof b?{text:b}:b);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(b){this.fontStyle="string"==typeof b?
v.splitFontString(b):v.makeParameters(v.defaultFont,b);this._setFont();return this}});return v.path={Path:b,TextPath:e}})},"*now":function(v){v(['dojo/i18n!*preload*esri/widgets/nls/Legend*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},"*noref":1}});
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Legend/nls/Legend ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/decorators/cast ./Widget ./Legend/LegendViewModel ./Legend/styles/Card ./Legend/styles/Classic ./support/widget".split(" "),function(v,t,e,n,b,c,h,q,g,x,k,r,a,d,p){return function(l){function k(a){a=l.call(this)||this;a._handles=new h;a.activeLayerInfos=
null;a.basemapLegendVisible=!1;a.groundLegendVisible=!1;a.iconClass="esri-icon-layer-list";a.label=c.widgetLabel;a.layerInfos=null;a.style=new d;a.view=null;a.viewModel=new r;return a}n(k,l);k.prototype.postInitialize=function(){var a=this;this.own(q.on(this,"activeLayerInfos","change",function(){return a._refreshActiveLayerInfos(a.activeLayerInfos)}),q.init(this,"style",function(b,c){c&&b!==c&&c.destroy();b&&(b.activeLayerInfos=a.activeLayerInfos,"card"===b.type&&(b.view=a.view))}))};k.prototype.destroy=
function(){this._handles.destroy();this._handles=null};k.prototype.castStyle=function(b){if(b instanceof a||b instanceof d)return b;if("string"===typeof b)return"card"===b?new a:new d;if(b&&"string"===typeof b.type){var c=e({},b);delete c.type;return new ("card"===b.type?a:d)(c)}return new d};k.prototype.render=function(){return this.style.render()};k.prototype._refreshActiveLayerInfos=function(a){var b=this;this._handles.removeAll();a.forEach(function(a){return b._renderOnActiveLayerInfoChange(a)});
this.scheduleRender()};k.prototype._renderOnActiveLayerInfoChange=function(a){var b=this,c=q.init(a,"version",function(){return b.scheduleRender()});this._handles.add(c,"version_"+a.layer.uid);a.children.forEach(function(a){return b._renderOnActiveLayerInfoChange(a)})};b([g.aliasOf("viewModel.activeLayerInfos"),p.renderable()],k.prototype,"activeLayerInfos",void 0);b([g.aliasOf("viewModel.basemapLegendVisible"),p.renderable()],k.prototype,"basemapLegendVisible",void 0);b([g.aliasOf("viewModel.groundLegendVisible"),
p.renderable()],k.prototype,"groundLegendVisible",void 0);b([g.property()],k.prototype,"iconClass",void 0);b([g.property()],k.prototype,"label",void 0);b([g.aliasOf("viewModel.layerInfos"),p.renderable()],k.prototype,"layerInfos",void 0);b([g.property(),p.renderable()],k.prototype,"style",void 0);b([x.cast("style")],k.prototype,"castStyle",null);b([g.aliasOf("viewModel.view"),p.renderable()],k.prototype,"view",void 0);b([g.property(),p.renderable(["view.size"])],k.prototype,"viewModel",void 0);return k=
b([g.subclass("esri.widgets.Legend")],k)}(g.declared(k))});