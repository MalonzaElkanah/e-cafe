// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/i18n!./nls/FeatureForm ../../moment ../../core/Accessor ../../core/lang ../../core/accessorSupport/decorators ../../layers/support/CodedValueDomain ../../layers/support/domains ../../layers/support/fieldUtils".split(" "),function(t,u,n,d,g,l,p,q,b,r,h,e){var f;(function(b){b.Text="text";b.Number="number";b.Date="date";b.Unsupported="unsupported"})(f||(f={}));return function(m){function a(c){c=
m.call(this)||this;c.config=null;c.feature=null;c.field=null;c.layer=null;c.description=null;c.group=null;c.editorType=null;c.error=null;c.format=null;c.hint=null;c.name=null;c.value=null;return c}n(a,m);Object.defineProperty(a.prototype,"domain",{get:function(){var c=this.layer.typeIdField,a=c===this.name,b=this.get("field.domain");if(a&&!b)return new r({name:"__internal-type-based-coded-value-domain__",codedValues:this.layer.types.map(function(c){return{code:c.id,name:c.name}})});a=this.feature;
c=c&&this.layer.getFieldDomain(this.name,{feature:a})||b;b=this.get("config.domain");return this._isDomainCompatible(b)?b:c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"editable",{get:function(){return this.layer.capabilities.operations.supportsEditing&&this.field.editable&&!1!==this.get("config.editable")},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"errorMessage",{get:function(){return this._toErrorMessage()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"label",{get:function(){return this.get("config.label")||this.field.alias||this.field.name},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxLength",{get:function(){if(this.type===f.Date)return-1;var c=this.get("field.length"),a=this.get("config.maxLength");return!isNaN(a)&&-1<=a&&(-1===c||a<=c)?a:c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"required",{get:function(){var c=this.get("field.nullable"),a=this.get("config.required");return this.editable&&
(!c||!0===a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"type",{get:function(){var c=this.field;return e.isNumericField(c)?f.Number:e.isStringField(c)?f.Text:e.isDateField(c)?f.Date:f.Unsupported},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"valid",{get:function(){var c=this.editable?this._validate():null;this._set("error",c);return null===c},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"visible",{get:function(){return!this._isEditorField()&&
(!!this.config||this._shownByDefault())},enumerable:!0,configurable:!0});a.prototype._isDomainCompatible=function(c){var a=this.field;if(c&&"coded-value"===c.type){var b=typeof c.codedValues[0].code;if("string"===b&&e.isStringField(a)||"number"===b&&e.isNumericField(a))return!0}return c&&"range"===c.type&&e.isNumericField(a)?!0:!1};a.prototype._validate=function(){var c=this.domain,a=this.field,b=this.value;return c?null!==b||this.required?h.validateDomainValue(c,b):null:e.validateFieldValue(a,b)};
a.prototype._shownByDefault=function(){var a=this.get("field.type");return"oid"!==a&&"global-id"!==a};a.prototype._isEditorField=function(){var a=this,b=this.layer.editFieldsInfo;return b?Object.keys(b).some(function(c){return b[c]===a.name}):!1};a.prototype._toErrorMessage=function(){var a=this.domain,b=this.field,d=this.value,f=this.type,k=this.error;return this.required&&null===d?g.validationErrors.cannotBeNull:k===h.DomainValidationError.VALUE_OUT_OF_RANGE||k===e.NumericRangeValidationError.OUT_OF_RANGE?
(b=h.getDomainRange(a)||e.getFieldRange(b),a=b.min,b=b.max,q.substitute({max:"date"===f?l(b).format("L LTS"):b,min:"date"===f?l(a).format("L LTS"):a},g.validationErrors.outsideRange)):k===h.DomainValidationError.INVALID_CODED_VALUE?g.validationErrors.invalidCodedValue:k===e.TypeValidationError.INVALID_TYPE?g.validationErrors.invalidType:null};d([b.property()],a.prototype,"config",void 0);d([b.property()],a.prototype,"feature",void 0);d([b.property()],a.prototype,"field",void 0);d([b.property()],a.prototype,
"layer",void 0);d([b.property({aliasOf:"config.description"})],a.prototype,"description",void 0);d([b.property({dependsOn:["config","feature","field","layer"]})],a.prototype,"domain",null);d([b.property({dependsOn:["config","field","layer"]})],a.prototype,"editable",null);d([b.property()],a.prototype,"group",void 0);d([b.property({aliasOf:"config.editorType"})],a.prototype,"editorType",void 0);d([b.property({readOnly:!0})],a.prototype,"error",void 0);d([b.property({dependsOn:["error","value"]})],
a.prototype,"errorMessage",null);d([b.property({aliasOf:"config.format"})],a.prototype,"format",void 0);d([b.property({aliasOf:"config.hint"})],a.prototype,"hint",void 0);d([b.property({dependsOn:["field","config"]})],a.prototype,"label",null);d([b.property({dependsOn:["field.length","config"]})],a.prototype,"maxLength",null);d([b.property({aliasOf:"field.name"})],a.prototype,"name",void 0);d([b.property({dependsOn:["field","config"]})],a.prototype,"required",null);d([b.property({dependsOn:["field"]})],
a.prototype,"type",null);d([b.property({dependsOn:["config","domain","field","layer","value"]})],a.prototype,"valid",null);d([b.property()],a.prototype,"value",void 0);d([b.property({dependsOn:["config","field","layer"]})],a.prototype,"visible",null);return a=d([b.subclass("esri.widgets.FeatureForm.InputField")],a)}(b.declared(p))});