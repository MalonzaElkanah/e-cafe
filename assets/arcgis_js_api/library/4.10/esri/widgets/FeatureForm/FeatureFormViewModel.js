// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/arrayUtils ../../core/Evented ../../core/lang ../../core/ObjectPool ../../core/accessorSupport/decorators ../../core/accessorSupport/decorators/cast ./FieldConfig ./FieldGroupConfig ./InputField ./InputFieldGroup".split(" "),function(z,A,q,c,r,m,t,u,n,e,v,w,l,x,y){return function(p){function b(a){a=p.call(this)||this;a._fieldPool=new n(x);a._fieldGroupPool=new n(y);
a._featureClone=null;a.fieldConfig=null;a.strict=!1;return a}q(b,p);Object.defineProperty(b.prototype,"_allInputFields",{get:function(){return this.inputFields.reduce(function(a,b){return b.inputFields?a.concat(b.inputFields):a.concat([b])},[])},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"feature",{get:function(){return this._get("feature")},set:function(a){this._featureClone=a?a.clone():null;this._set("feature",a)},enumerable:!0,configurable:!0});b.prototype.castFieldConfig=
function(a){return a?a.map(function(a){return a instanceof l||a instanceof l?a:a.fieldConfig?new l(a):new w(a)}):null};Object.defineProperty(b.prototype,"inputFields",{get:function(){var a=this,b=this._fieldPool,c=this._fieldGroupPool,h=this._featureClone,e=this.layer,g=this._get("inputFields");g&&g.forEach(function(a){a.inputFields?(a.inputFields.forEach(function(a){return b.release(a)}),c.release(a)):b.release(a)});if("ready"!==this.state)return[];var k=this.get("layer.fields")||[],g=this.fieldConfig||
[];return(0!==g.length?g.map(function(f){if(f.fieldConfig){var g=c.acquire(),d=f.fieldConfig.map(function(f){var d=m.find(k,function(a){return a.name===f.name}),c=b.acquire();c.set({field:d,config:f,feature:h,group:g,layer:e,value:a.getValue(d.name)});return c});g.set({label:f.label,description:f.description,inputFields:d});return g}var d=m.find(k,function(a){return a.name===f.name}),l=b.acquire();l.set({field:d,config:f,feature:h,group:null,layer:e,value:a.getValue(d.name)});return l}):k.map(function(f){var d=
b.acquire();d.set({field:f,feature:h,group:null,layer:e,value:a.getValue(f.name)});return d})).filter(function(b){var d=b.visible;d||a._disposeInputOrGroup(b);return d})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layer",{get:function(){return this.get("feature.layer")},set:function(a){a?this._override("layer",a):this._clearOverride("layer")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){return this.get("layer.loaded")&&this.feature?
"ready":"disabled"},enumerable:!0,configurable:!0});b.prototype.findField=function(a){return m.find(this._allInputFields,function(b){return b.name===a})};b.prototype.getValue=function(a){var b=this._featureClone;return b&&b.get("attributes."+a)};b.prototype.setValue=function(a,b){var c=this,h=this._featureClone,e=this.strict;if(h&&h.attributes){var d=this.findField(a);if(d&&h.attributes[a]!==b){d.value=b;if(this.get("layer.typeIdField")===d.name){var k=new Set;this.layer.types.forEach(function(a){return Object.keys(a.domains).forEach(function(a){return k.add(a)})});
k&&k.forEach(function(a){(a=c.findField(a))&&a.notifyChange("domain")})}if(!e||d.valid)h.attributes[a]=b,this._emitChangeEvent(d)}}};b.prototype.getValues=function(){var a=this._featureClone;return a&&u.clone(a.attributes)||null};b.prototype.submit=function(){var a=this._allInputFields,b=a.filter(function(a){return a.valid}).map(function(a){return a.name}),a=a.filter(function(a){return!a.valid}).map(function(a){return a.name}),c=this.getValues();this.emit("submit",{valid:b,invalid:a,values:c})};b.prototype._disposeInputOrGroup=
function(a){a.inputFields?this._disposeGroup(a):this._disposeInput(a)};b.prototype._disposeGroup=function(a){a.inputFields.forEach(this._disposeInput);this._fieldGroupPool.release(a)};b.prototype._disposeInput=function(a){this._fieldPool.release(a)};b.prototype._emitChangeEvent=function(a){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:a.name,value:a.value,valid:a.valid})};c([e.property({readOnly:!0,dependsOn:["inputFields"]})],b.prototype,"_allInputFields",null);c([e.property()],
b.prototype,"feature",null);c([e.property()],b.prototype,"fieldConfig",void 0);c([v.cast("fieldConfig")],b.prototype,"castFieldConfig",null);c([e.property({readOnly:!0,dependsOn:["feature","fieldConfig","layer.fields","layer.loaded"]})],b.prototype,"inputFields",null);c([e.property({dependsOn:["feature.layer"]})],b.prototype,"layer",null);c([e.property({dependsOn:["layer.loaded","feature"]})],b.prototype,"state",null);c([e.property()],b.prototype,"strict",void 0);c([e.property()],b.prototype,"getValues",
null);c([e.property()],b.prototype,"submit",null);return b=c([e.subclass("esri.widgets.FeatureForm.FeatureFormViewModel")],b)}(e.declared(r,t))});