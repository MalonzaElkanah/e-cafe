// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define(["dojo/_base/declare","../../core/promiseUtils","../../request"],function(p,m,l){return p(null,{declaredClass:"esri.tasks.support.NAServiceDescription",_sd:null,getServiceDescription:function(k,h){if(this._sd)return m.resolve(this._sd);var a=m.create(function(e,b){if(this.url&&this.parsedUrl){var a=this.url,m=(this.parsedUrl.path.match(/\/solve$/)||[]).length?"Route":(this.parsedUrl.path.match(/\/solveClosestFacility$/)||[]).length?"ClosestFacility":"ServiceAreas",d,n=function(a){l(a+("/"===
a[a.length-1]?"":"/")+"GetTravelModes/execute",{query:{f:"json",serviceName:m}}).then(function(c){var a=[],b=null;if(c&&c.data&&c.data.results&&c.data.results.length){c=c.data;for(var g=0;g<c.results.length;g++)if("supportedTravelModes"===c.results[g].paramName){if(c.results[g].value&&c.results[g].value.features)for(var f=0;f<c.results[g].value.features.length;f++)if(c.results[g].value.features[f].attributes){var h=JSON.parse(c.results[g].value.features[f].attributes.TravelMode);a.push(h)}}else"defaultTravelMode"===
c.results[g].paramName&&(b=c.results[g].value)}d.supportedTravelModes=a;d.defaultTravelMode=b;e(d)},function(a){console.log("Could not read from the routingUtilities service.");b(a)})};l(a,{query:{f:"json"}}).then(function(f){d=f.data;d.supportedTravelModes||(d.supportedTravelModes=[]);for(f=0;f<d.supportedTravelModes.length;f++)d.supportedTravelModes[f].id||(d.supportedTravelModes[f].id=d.supportedTravelModes[f].itemId);h?e(d):k?n(k):10.4<=d.currentVersion?l(a+("/"===a[a.length-1]?"":"/")+"retrieveTravelModes",
{query:{f:"json"}}).then(function(a){d.supportedTravelModes=a.data.supportedTravelModes;d.defaultTravelMode=a.data.defaultTravelMode;e(d)},function(a){console.log("Could not get to the NAServer's retrieveTravelModes.");b(a)}):l(a.substring(0,a.indexOf("/rest/")+6)+"info",{query:{f:"json"}}).then(function(c){c.data.owningSystemUrl?(a=c.data.owningSystemUrl,l(a+("/"===a[a.length-1]?"":"/")+"sharing/rest/portals/self",{query:{f:"json"}}).then(function(a){a&&a.data&&a.data.helperServices&&a.data.helperServices.routingUtilities&&
a.data.helperServices.routingUtilities.url?n(a.data.helperServices.routingUtilities.url):(console.log("Portal does not have helperServices.routingUtilities defined."),e(d))},function(a){console.log("Could not get to the portal's self.");b(a)})):e(d)},function(a){console.log("Could not get to the NAServer service description.");b(a)})},function(a){b(a)})}else b("NA Task has no URL specified.")}.bind(this));a.then(function(a){this._sd=a}.bind(this),function(){this._sd=null}.bind(this));return a},_isInputGeometryZAware:function(k,
h){for(var a=0;a<h.length;a++){var e=k[h[a]];if(e&&e.length)for(var b=0;b<e.length;b++)if(e[b].hasZ)return!0}return!1},_dropZValuesOffInputGeometry:function(k,h){var a,e;for(a=0;a<h.length;a++){var b=k[h[a]];if(b&&b.length)for(e=0;e<b.length;e++)b[e].z=void 0}console.log("The remote Network Analysis service is powered by a network dataset which is not Z-aware.\nZ-coordinates of the input geometry are ignored.")}})});