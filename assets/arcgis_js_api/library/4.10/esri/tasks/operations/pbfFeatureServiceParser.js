// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/Logger ../../core/pbf ./pbfDehydratedFeatureSet ./pbfOptimizedFeatureSet".split(" "),function(K,u,B,z,C,D,E){function F(b){for(;b.next();)switch(b.tag()){case 1:return b.getString();case 2:return b.getFloat();case 3:return b.getDouble();case 4:return b.getSInt32();case 5:return b.getUInt32();case 6:return b.getInt64();case 7:return b.getUInt64();case 8:return b.getSInt64();case 9:return b.getBool();default:return b.skip(),null}return null}function G(b){for(var g=
{type:0>=m.length?null:m[0]};b.next();)switch(b.tag()){case 1:g.name=b.getString();break;case 2:var d=b.getEnum();g.type=d>=m.length?null:m[d];break;case 3:g.alias=b.getString();break;case 4:d=b.getEnum();d=d>=v.length?null:v[d];g.sqlType=d;break;default:b.skip()}return g}function H(b,g,d,m){for(var q=b.createFeature(g),r=0;d.next();)switch(d.tag()){case 1:var l=m[r++].name;q.attributes[l]=F(d.getMessage());break;case 2:for(var l=b,e=g,a=d.getMessage(),c=l.createGeometry(e),e=2+(e.hasZ?1:0)+(e.hasM?
1:0);a.next();)switch(a.tag()){case 2:for(var k=a.getUInt32(),k=a.pos()+k,h=0;a.pos()<k;)l.addLength(c,a.getUInt32(),h++);break;case 3:for(var k=a.getUInt32(),k=a.pos()+k,f=h=0;a.pos()<k;)l.addCoordinate(c,a.getSInt64(),f,h),h++,h===e&&(f++,h=0);break;default:a.skip()}q.geometry=c;break;case 4:l=b;a=d.getMessage();for(c=l.createPointGeometry(g);a.next();)switch(a.tag()){case 3:e=a.getUInt32();e=a.pos()+e;for(k=0;a.pos()<e;)l.addCoordinatePoint(c,a.getSInt64(),0,k++);break;default:a.skip()}q.centroid=
c;break;default:d.skip()}return q}Object.defineProperty(u,"__esModule",{value:!0});var I=z.getLogger("esri.tasks.operations.pbfFeatureServiceParser"),m="esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeString esriFieldTypeDate esriFieldTypeOID esriFieldTypeGeometry esriFieldTypeBlob esriFieldTypeRaster esriFieldTypeGUID esriFieldTypeGlobalID esriFieldTypeXML".split(" "),v="sqlTypeBigInt sqlTypeBinary sqlTypeBit sqlTypeChar sqlTypeDate sqlTypeDecimal sqlTypeDouble sqlTypeFloat sqlTypeGeometry sqlTypeGUID sqlTypeInteger sqlTypeLongNVarchar sqlTypeLongVarbinary sqlTypeLongVarchar sqlTypeNChar sqlTypeNVarchar sqlTypeOther sqlTypeReal sqlTypeSmallInt sqlTypeSqlXml sqlTypeTime sqlTypeTimestamp sqlTypeTimestamp2 sqlTypeTinyInt sqlTypeVarbinary sqlTypeVarchar".split(" "),
x=["upperLeft","lowerLeft"];u.parseFeatureQuery=function(b,g){g=g&&"dehydrated"===g.type?new D.Context(g):new E.Context(g);try{var d=new C(new Uint8Array(b),new DataView(b));for(b={};d.next();)switch(d.tag()){case 2:for(var m=b,q=g,r=d.getMessage(),l={};r.next();)switch(r.tag()){case 1:var e=q,a=r.getMessage(),c=e.createFeatureResult();c.geometryType=0>=e.geometryTypes.length?null:e.geometryTypes[0];for(var k=!1;a.next();)switch(a.tag()){case 1:c.objectIdFieldName=a.getString();break;case 3:c.globalIdFieldName=
a.getString();break;case 4:c.geohashFieldName=a.getString();break;case 5:for(var h=a.getMessage(),f={};h.next();)switch(h.tag()){case 1:f.shapeAreaFieldName=h.getString();break;case 2:f.shapeLengthFieldName=h.getString();break;case 3:f.units=h.getString();break;default:h.skip()}c.geometryProperties=f;break;case 7:var u=a.getEnum();c.geometryType=u>=e.geometryTypes.length?null:e.geometryTypes[u];break;case 8:for(var w=a.getMessage(),A=e.createSpatialReference();w.next();)switch(w.tag()){case 1:A.wkid=
w.getUInt32();break;case 5:A.wkt=w.getString();break;default:w.skip()}c.spatialReference=A;break;case 10:c.hasZ=a.getBool();break;case 11:c.hasM=a.getBool();break;case 12:for(var t=a.getMessage(),y={originPosition:0>=x.length?null:x[0]};t.next();)switch(t.tag()){case 1:var v=t.getEnum();y.originPosition=v>=x.length?null:x[v];break;case 2:for(var n=t.getMessage(),f=[0,0,0,0];n.next();)switch(n.tag()){case 1:f[0]=n.getDouble();break;case 2:f[1]=n.getDouble();break;case 4:f[2]=n.getDouble();break;case 3:f[3]=
n.getDouble();break;default:n.skip()}y.scale=f;break;case 3:for(var p=t.getMessage(),f=[0,0,0,0];p.next();)switch(p.tag()){case 1:f[0]=p.getDouble();break;case 2:f[1]=p.getDouble();break;case 4:f[2]=p.getDouble();break;case 3:f[3]=p.getDouble();break;default:p.skip()}y.translate=f;break;default:t.skip()}c.transform=y;break;case 9:var z=a.getBool();c.exceededTransferLimit=z;break;case 13:e.addField(c,G(a.getMessage()));break;case 15:k||(e.prepareFeatures(c),k=!0);e.addFeature(c,H(e,c,a.getMessage(),
c.fields));break;default:a.skip()}e.finishFeatureResult(c);l.featureResult=c;break;default:r.skip()}m.queryResult=l;break;default:d.skip()}return b}catch(J){return d=new B("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:J}),I.error(d),{queryResult:{featureResult:g.createFeatureResult()}}}}});