// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../geometry","../../../core/Logger","../MeshComponent"],function(x,p,r,t,u){function v(a,c,e){if(a.components)for(var d=0,f=a.components;d<f.length;d++){for(var b=f[d],g=b.clone(),b=0;b<g.faces.length;b++)g.faces[b]+=c.position/3;b=g;0<c.normal&&!a.vertexAttributes.normal&&"source"===b.shading&&(b.shading="flat");e.push(g)}else if(a.vertexAttributes&&a.vertexAttributes.position){d=a.vertexAttributes.position.length/3;f=new Uint32Array(d);for(b=0;b<d;b++)f[b]=b+c.position;
d=b=new u({faces:f});0<c.normal&&!a.vertexAttributes.normal&&"source"===d.shading&&(d.shading="flat");e.push(b)}}function n(a,c,e,d,f){if(c){var b=c.position;if(b)if(c=c[a]){f=0;b=e[a];e=d[a];for(var g=c.length,h=0;h<g;h++)b[e++]=c[f++];d[a]+=c.length}else if(c=e[a],e=d[a],g=m[a],c){for(h=0;h<b.length;h+=3)for(var l=0;l<g;l++)c[e++]=f;d[a]=e}}}function w(a){var c,e,d,f=0,b=0,g=0,h=0;d=c=e=!1;for(var l=0;l<a.length;l++){var k=a[l].vertexAttributes;if(k&&k.position&&(k.uv&&(e=!0),k.normal&&(c=!0),k.color&&
(d=!0),c&&e&&d))break}for(l=0;l<a.length;l++)(k=a[l].vertexAttributes)&&k.position&&(f+=k.position.length,e&&(b+=k.position.length/m.position*m.uv),c&&(g+=k.position.length/m.position*m.normal),d&&(h+=k.position.length/m.position*m.color));return{position:new Float64Array(f),uv:b?new Float32Array(b):null,normal:g?new Float32Array(g):null,color:h?new Uint8Array(h):null}}Object.defineProperty(p,"__esModule",{value:!0});var q=t.getLogger("esri.geometry.support.triangleMeshMerge");p.merge=function(a){if(0===
a.length)return q.error("merge()","Must specify one more more geometries to merge"),null;var c=a[0].spatialReference;if(a.some(function(a){return!a.spatialReference.equals(c)}))return q.error("merge()","Geometries must all be in the same spatial reference"),null;for(var e=w(a),d=[],f={position:0,uv:0,normal:0,color:0},b=0;b<a.length;b++){var g=a[b],h=g.vertexAttributes;v(g,f,d);n("position",h,e,f,0);n("normal",h,e,f,0);n("uv",h,e,f,0);n("color",h,e,f,255)}return new r.Mesh({vertexAttributes:e,components:d,
spatialReference:c})};var m={position:3,normal:3,uv:2,color:4}});