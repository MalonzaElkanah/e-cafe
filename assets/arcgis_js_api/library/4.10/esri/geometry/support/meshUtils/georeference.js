// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/libs/gl-matrix-2/gl-matrix","./projection","../../../views/3d/support/projectionUtils"],function(v,p,l,q,m){function r(c,a,e,d){void 0===d&&(d=0);if(!e.isWebMercator||!a)return a;e=new Float32Array(a.length);for(var g=0;g<a.length;g+=3){var f=m.webMercator.y2lat(c[g+1]),f=Math.cos(f);1===d&&(f=1/f);h[0]=a[g+0]*f;h[1]=a[g+1]*f;h[2]=a[g+2];l.vec3.normalize(h,h);for(f=0;3>f;f++)e[g+f]=h[f]}return e}function t(c,a){c=c.spatialReference;return c.isWGS84||c.isWebMercator&&
(!a||!1!==a.geographic)}Object.defineProperty(p,"__esModule",{value:!0});p.georeference=function(c,a,e){if(t(a,e)){e=a.spatialReference;m.computeLinearTransformation(a.spatialReference,[a.x,a.y,a.z||0],n,m.SphericalECEFSpatialReference);var d=c.position,g=n;a=a.spatialReference;for(var f=new Float64Array(d.length),b=0;b<d.length;b+=3){for(var k=0;3>k;k++)h[k]=d[b+k];l.vec3.transformMat4(h,h,g);for(k=0;3>k;k++)f[b+k]=h[k]}d=new Float64Array(d.length);a=q.projectFromECEF(f,d,a);c=r(a,c.normal,e);c=
{position:a,normal:c}}else{e=new Float64Array(c.position.length);d=c.position;g=a.x;f=a.y;a=a.z||0;for(b=0;b<d.length;b+=3)e[b+0]=d[b+0]+g,e[b+1]=d[b+1]+f,e[b+2]=d[b+2]+a;c={position:e,normal:c.normal}}return c};p.ungeoreference=function(c,a,e){if(t(a,e)){e=a.spatialReference;m.computeLinearTransformation(a.spatialReference,[a.x,a.y,a.z||0],n,m.SphericalECEFSpatialReference);l.mat4.invert(u,n);var d=c.position,g=u;a=q.projectToECEF(d,e,new Float64Array(d.length));for(var f=0;f<d.length;f+=3){for(var b=
0;3>b;b++)h[b]=a[f+b];l.vec3.transformMat4(h,h,g);for(b=0;3>b;b++)a[f+b]=h[b]}c=r(c.position,c.normal,e,1);c={position:a,normal:c}}else{e=new Float64Array(c.position.length);d=c.position;g=a.x;f=a.y;a=a.z||0;for(b=0;b<d.length;b+=3)e[b+0]=d[b+0]-g,e[b+1]=d[b+1]-f,e[b+2]=d[b+2]-a;c={position:e,normal:c.normal}}return c};var n=l.mat4f64.create(),u=l.mat4f64.create(),h=l.vec3f64.create()});