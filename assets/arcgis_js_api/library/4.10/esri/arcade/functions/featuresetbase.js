// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports dojo/Deferred dojo/promise/all ../Dictionary ../Feature ../featureSetCollection ../kernel ../languageUtils ../featureSetUtils ../featureset/actions/AttributeFilter ../featureset/actions/OrderBy ../featureset/actions/Top ../featureset/sources/FeatureLayerMemory ../featureset/support/OrderbyClause ../featureset/support/WhereClause".split(" "),function(G,r,n,x,y,z,t,p,h,A,u,B,C,D,E,F){function c(d,c,a){void 0===a&&(a=null);for(var e in d)if(e.toLowerCase()===c.toLowerCase())return d[e];
return a}function v(d){if(null===d)return null;var k={type:c(d,"type",""),name:c(d,"name","")};if("range"===k.type)k.range=c(d,"range",[]);else{k.codedValues=[];var a=0;for(d=c(d,"codedValues",[]);a<d.length;a++){var e=d[a];k.codedValues.push({name:c(e,"name",""),code:c(e,"code",null)})}}return k}function q(d){if(null===d)return null;var k={},a=c(d,"wkt",null);null!==a&&(k.wkt=a);d=c(d,"wkid",null);null!==d&&(k.wkid=d);return k}function w(d){if(null===d)return null;var k={hasZ:c(d,"hasz",!1),hasM:c(d,
"hasm",!1)},a=c(d,"spatialreference",null);a&&(k.spatialReference=q(a));a=c(d,"x",null);if(null!==a)return k.x=a,k.y=c(d,"y",null),k;a=c(d,"rings",null);if(null!==a)return k.rings=a,k;a=c(d,"paths",null);if(null!==a)return k.paths=a,k;a=c(d,"points",null);if(null!==a)return k.points=a,k;for(var a=0,e="xmin xmax ymin ymax zmin zmax mmin mmax".split(" ");a<e.length;a++){var f=e[a],b=c(d,f,null);null!==b&&(k[f]=b)}return k}Object.defineProperty(r,"__esModule",{value:!0});r.registerFunctions=function(d){"async"===
d.mode&&(d.functions.featuresetbyid=function(c,a){return d.standardFunctionAsync(c,a,function(e,f,b){h.pcCheck(b,2,4);if(b[0]instanceof t){e=h.toString(b[1]);f=h.defaultUndefined(b[2],null);var g=h.toBoolean(h.defaultUndefined(b[3],!0));null===f&&(f=["*"]);if(!1===h.isArray(f))throw Error("Invalid Parameter");return b[0].featureSetById(e,g,f)}throw Error("Invalid Parameter");})},d.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),d.functions.featuresetbyportalitem=function(c,a){return d.standardFunctionAsync(c,
a,function(e,f,b){h.pcCheck(b,2,4);e=h.toString(b[0]);f=h.toString(b[1]);var g=h.defaultUndefined(b[2],null);b=h.toBoolean(h.defaultUndefined(b[3],!0));null===g&&(g=["*"]);if(!1===h.isArray(g))throw Error("Invalid Parameter");if(c.services&&c.services.portal)return A.constructFeatureSetFromPortalItem(e,f,c.spatialReference,g,b,c.services.portal,c.lrucache);throw Error("Portal is required");})},d.signatures.push({name:"featuresetbyportalitem",min:"2",max:"4"}),d.functions.featuresetbyname=function(c,
a){return d.standardFunctionAsync(c,a,function(e,f,b){h.pcCheck(b,2,4);if(b[0]instanceof t){e=h.toString(b[1]);f=h.defaultUndefined(b[2],null);var g=h.toBoolean(h.defaultUndefined(b[3],!0));null===f&&(f=["*"]);if(!1===h.isArray(f))throw Error("Invalid Parameter");return b[0].featureSetByName(e,g,f)}throw Error("Invalid Parameter");})},d.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),d.functions.featureset=function(k,a){return d.standardFunction(k,a,function(e,f,b){h.pcCheck(b,1,1);f=b[0];
e={layerDefinition:{geometryType:"",objectIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(h.isString(f))f=JSON.parse(f),void 0!==f.layerDefinition?(e.layerDefinition=f.layerDefinition,e.featureSet=f.featureSet,f.layerDefinition.spatialReference&&(e.layerDefinition.spatialReference=f.layerDefinition.spatialReference)):(e.featureSet.features=f.features,e.featureSet.geometryType=f.geometryType,e.layerDefinition.geometryType=e.featureSet.geometryType,e.layerDefinition.objectIdField=
f.objectIdFieldName,e.layerDefinition.typeIdField=f.typeIdFieldName,e.layerDefinition.fields=f.fields,f.spatialReference&&(e.layerDefinition.spatialReference=f.spatialReference));else if(b[0]instanceof y){f=JSON.parse(b[0].castToText());var g=c(f,"layerdefinition");if(null!==g){e.layerDefinition.geometryType=c(g,"geometrytype","");e.featureSet.geometryType=e.layerDefinition.geometryType;e.layerDefinition.objectIdField=c(g,"objectidfield","");e.layerDefinition.typeIdField=c(g,"typeidfield","");if(b=
c(g,"spatialreference",null))e.layerDefinition.spatialReference=q(b);b=0;for(var d=c(g,"fields",[]);b<d.length;b++)g=d[b],g={name:c(g,"name",""),alias:c(g,"alias",""),type:c(g,"type",""),nullable:c(g,"nullable",!0),editable:c(g,"editable",!0),length:c(g,"length",null),domain:v(c(g,"domain"))},e.layerDefinition.fields.push(g);if(f=c(f,"featureset",null)){b={};g=0;for(d=e.layerDefinition.fields;g<d.length;g++){var a=d[g];b[a.name.toLowerCase()]=a.name}for(var l=0,m=c(f,"features",[]);l<m.length;l++){f=
m[l];g={};d=c(f,"attributes",{});for(a in d)g[b[a.toLowerCase()]]=d[a];e.featureSet.features.push({attributes:g,geometry:w(c(f,"geometry",null))})}}}else{e.layerDefinition.geometryType=c(f,"geometrytype","");e.featureSet.geometryType=e.layerDefinition.geometryType;e.layerDefinition.objectIdField=c(f,"objectidfieldname","");e.layerDefinition.typeIdField=c(f,"typeidfieldname","");if(b=c(f,"spatialreference",null))e.layerDefinition.spatialReference=q(b);b=0;for(d=c(f,"fields",[]);b<d.length;b++)g=d[b],
g={name:c(g,"name",""),alias:c(g,"alias",""),type:c(g,"type",""),nullable:c(g,"nullable",!0),editable:c(g,"editable",!0),length:c(g,"length",null),domain:v(c(g,"domain"))},e.layerDefinition.fields.push(g);b={};g=0;for(d=e.layerDefinition.fields;g<d.length;g++)a=d[g],b[a.name.toLowerCase()]=a.name;l=0;for(m=c(f,"features",[]);l<m.length;l++){f=m[l];g={};d=c(f,"attributes",{});for(a in d)g[b[a.toLowerCase()]]=d[a];e.featureSet.features.push({attributes:g,geometry:w(c(f,"geometry",null))})}}}else throw Error("Invalid Parameter");
if(e.layerDefinition&&e.featureSet){b:{a=0;for(f=" esriGeometryPoint esriGeometryPolyline esriGeometryPolygon esriGeometryMultipoint esriGeometryEnvelope".split(" ");a<f.length;a++)if(f[a]===e.layerDefinition.geometryType){a=!0;break b}a=!1}a=!1===a||null===e.layerDefinition.objectIdField||""===e.layerDefinition.objectIdField||!1===h.isArray(e.layerDefinition.fields)||!1===h.isArray(e.featureSet.features)?!1:void 0}else a=!1;if(!1===a)throw Error("Invalid Parameter");return D.create(e,k.spatialReference)})},
d.signatures.push({name:"featureset",min:"1",max:"1"}),d.functions.filter=function(c,a){return d.standardFunctionAsync(c,a,function(e,a,b){h.pcCheck(b,2,2);if(h.isFeatureSet(b[0])){var g=F.create(b[1]),f=g.getVariables(),k=new n;if(0<f.length){e=[];for(a=0;a<f.length;a++)e.push(d.evaluateIdentifier(c,{name:f[a]}));x(e).then(p.callback(function(d){for(var a={},e=0;e<f.length;e++)a[f[e]]=d[e];g.setVariablesDictionary(a);k.resolve(new u({parentfeatureset:b[0],whereclause:g}))},k),p.errback(k))}else k.resolve(new u({parentfeatureset:b[0],
whereclause:g}));return k.promise}return d.failDefferred("Filter cannot accept this parameter type")})},d.signatures.push({name:"filter",min:"2",max:"2"}),d.functions.orderby=function(c,a){return d.standardFunctionAsync(c,a,function(a,c,b){h.pcCheck(b,2,2);return h.isFeatureSet(b[0])?(a=new n,c=new E(b[1]),a.resolve(new B({parentfeatureset:b[0],orderbyclause:c})),a.promise):d.failDefferred("Order cannot accept this parameter type")})},d.signatures.push({name:"orderby",min:"2",max:"2"}),d.functions.top=
function(c,a){return d.standardFunctionAsync(c,a,function(a,c,b){h.pcCheck(b,2,2);return h.isFeatureSet(b[0])?(a=new n,a.resolve(new C({parentfeatureset:b[0],topnum:b[1]})),a.promise):h.isArray(b[0])?h.toNumber(b[1])>=b[0].length?b[0].slice(0):b[0].slice(0,h.toNumber(b[1])):h.isImmutableArray(b[0])?h.toNumber(b[1])>=b[0].length()?b[0].slice(0):b[0].slice(0,h.toNumber(b[1])):d.failDefferred("Top cannot accept this parameter type")})},d.signatures.push({name:"top",min:"2",max:"2"}),d.functions.first=
function(c,a){return d.standardFunctionAsync(c,a,function(a,d,b){var c=new n;h.pcCheck(b,1,1);if(h.isFeatureSet(b[0]))b[0].first().then(p.callback(function(a){if(null!==a){var d=z.createFromGraphicLikeObject(a.geometry,a.attributes,b[0]);d._underlyingGraphic=a;a=d}c.resolve(a)},c),p.errback(c));else if(h.isArray(b[0]))0===b[0].length?c.resolve(null):c.resolve(b[0][0]);else if(h.isImmutableArray(b[0]))0===b[0].length()?c.resolve(null):c.resolve(b[0].get(0));else return null;return c.promise})},d.signatures.push({name:"first",
min:"1",max:"1"}))}});