// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper dojo/Deferred ../../../Graphic ../support/FeatureSet ../support/IdSet ../support/shared ../support/stats ../support/sha ../../../tasks/support/FeatureSet ../../../tasks/operations/query ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ../../../layers/graphics/featureConversionUtils ../polyfill/FeatureLayerAndTable".split(" "),function(J,K,z,t,A,B,w,k,C,D,E,F,G,v,x,H,I){return function(y){function e(a){var b=
y.call(this,a)||this;b.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic";b._removeGeometry=!1;b._overrideFields=null;b.formulaCredential=null;b._pageJustIds=!1;b._requestStandardised=!1;a.spatialReference&&(b.spatialReference=a.spatialReference);b._transparent=!0;b._maxProcessing=1E3;b._layer=a.layer;b._wset=null;void 0!==a.outFields&&(b._overrideFields=a.outFields);void 0!==a.includeGeometry&&(b._removeGeometry=!1===a.includeGeometry);return b}z(e,y);e.prototype._maxQueryRate=function(){return k.defaultMaxRecords};
e.prototype.end=function(){return this._layer};e.prototype.optimisePagingFeatureQueries=function(a){this._pageJustIds=a};e.prototype.convertQueryToLruCacheKey=function(a){a=k.stableStringify(a.toJSON());return(new D(a,"TEXT")).getHash("SHA-1","B64")};e.prototype.load=function(){var a=this;null===this._loadPromise&&(this._loadPromise=new t);null!==this._layer&&(!0===this._layer.loaded?!1===this._loadPromise.isFulfilled()&&(this._initialiseFeatureSet(),this._loadPromise.resolve(this)):(this._layer.when(function(){try{a._initialiseFeatureSet(),
a._loadPromise.resolve(a)}catch(b){a._loadPromise.reject(b)}},function(b){a._loadPromise.reject(b)}),this._layer.load()));return this._loadPromise.promise};e.prototype._initialiseFeatureSet=function(){null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference);this.geometryType=this._layer.geometryType;this.fields=this._layer.fields.slice(0);if(1!==this._layer.outFields.length||"*"!==this._layer.outFields[0]){for(var a=[],b=0,g=this.fields;b<g.length;b++){var f=g[b];if("oid"===
f.type)a.push(f);else for(var m=0,c=this._layer.outFields;m<c.length;m++){var h=c[m];if(h.toLowerCase()===f.name.toLowerCase()){a.push(f);break}}}this.fields=a}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{a=[];b=[];g=0;for(m=this.fields;g<m.length;g++)if(f=m[g],"oid"===f.type)a.push(f),b.push(f.name);else for(var c=0,d=this._overrideFields;c<d.length;c++)if(h=d[c],h.toLowerCase()===f.name.toLowerCase()){a.push(f);b.push(f.name);
break}this.fields=a;this._overrideFields=b}this._layer.source&&this._layer.source.layerDefinition&&(!0===this._layer.source.layerDefinition.useStandardizedQueries?this._databaseType=k.FeatureServiceDatabaseType.Standardised:(a=this._layer.source.layerDefinition.currentVersion,void 0!==a&&null!==a&&10.5<=a&&(this._databaseType=k.FeatureServiceDatabaseType.Standardised,this._requestStandardised=!0)));this.objectIdField=this._layer.objectIdField;this.hasM=this._layer.supportsM;this.hasZ=this._layer.supportsZ;
this.typeIdField=this._layer.typeIdField;this.types=this._layer.types};e.prototype._isInFeatureSet=function(){return k.IdState.InFeatureSet};e.prototype._refineSetBlock=function(a){var b=new t;b.resolve(a);return b.promise};e.prototype._candidateIdTransform=function(a){return a};e.prototype._transformSetWithIdChanges=function(){};e.prototype._getSet=function(a){var b=this,g=new t;null===this._wset?this._ensureLoaded().then(k.callback(function(){b._getFilteredSet("",null,null,null,a).then(k.callback(function(a){b._wset=
a;g.resolve(a)},g),k.errback(g))},g),k.errback(g)):g.resolve(this._wset);return g.promise};e.prototype._runDatabaseProbe=function(a){var b=this,g=new t;this._ensureLoaded().then(k.callback(function(){var f=new v;f.where=a.replace("OBJECTID",b._layer.objectIdField);b._layer.queryObjectIds(f).then(k.callback(function(){g.resolve(!0)},g),function(a){try{g.resolve(!1)}catch(c){g.reject(c)}})},g),k.errback(g));return g.promise};e.prototype._canUsePagination=function(){return this._layer.capabilities&&
this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsPagination?!0:!1};e.prototype._cacheableFeatureSetSourceKey=function(){return this._layer.url};e.prototype.pbfSupportedForQuery=function(a){return!a.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF};e.prototype.queryPBF=function(a,b){a.quantizationParameters={mode:"edit"};return F.executeQueryPBF(this._layer.parsedUrl,a,{type:"optimized"}).then(function(a){return E.fromJSON(H.convertToFeatureSet(a.data))})};
e.prototype.executeQuery=function(a,b){var g=new G({url:this._layer.parsedUrl.path}),f="execute"===b&&this.pbfSupportedForQuery(a),m=null;if(this.recentlyUsedQueries){var c=this.convertQueryToLruCacheKey(a);(m=this.recentlyUsedQueries.getFromCache(c))&&m.isRejected()&&(m=null,this.recentlyUsedQueries.removeFromCache(c));null===m&&(m=!0!==f?g[b](a):this.queryPBF(a,g),this.recentlyUsedQueries.addToCache(c,m))}null===m&&(m=!0!==f?g[b](a):this.queryPBF(a,g));return m};e.prototype._getFilteredSet=function(a,
b,g,f,m){var c=this,h=new t;this.databaseType().then(k.callback(function(d){if(c.isTable()&&b&&null!==a&&""!==a)d=new w([],[],!0,null),h.resolve(d);else if(c._canUsePagination())c._getFilteredSetUsingPaging(a,b,g,f,m).then(k.callback(function(a){h.resolve(a)},h),k.errback(h));else{var l="",n=!1;null!==f&&c._layer.capabilities&&c._layer.capabilities.query&&!0===c._layer.capabilities.query.supportsOrderBy&&(l=f.constructClause(),n=!0);var p=new v;p.where=null===g?null===b?"1\x3d1":"":g.toWhereClause(d);
c._requestStandardised&&(p.sqlFormat="standard");p.spatialRelationship=c._makeRelationshipEnum(a);p.outSpatialReference=c.spatialReference;p.orderByFields=""!==l?l.split(","):null;p.geometry=null===b?null:b;p.relationParameter=c._makeRelationshipParam(a);c.executeQuery(p,"executeForIds").then(k.callback(function(a){null===a&&(a=[]);c._checkCancelled(m);a=new w([],a,n,null);h.resolve(a)},h),k.errback(h))}},h),k.errback(h));return h.promise};e.prototype._expandPagedSet=function(a,b,g,f,m){return this._expandPagedSetFeatureSet(a,
b,g,f,m)};e.prototype._getFilteredSetUsingPaging=function(a,b,g,f,m){var c=this,h=new t;try{var d="",l=!1;null!==f&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(d=f.constructClause(),l=!0);this.databaseType().then(k.callback(function(f){f=null===g?null===b?"1\x3d1":"":g.toWhereClause(f);c._layer.definitionExpression&&(f=""!==f?"(("+c._layer.definitionExpression+") AND ("+f+"))":c._layer.definitionExpression);var p=c._maxQueryRate();
void 0!==c._layer.maxRecordCount&&c._layer.maxRecordCount<p&&(p=c._layer.maxRecordCount);var n=null;if(!0===c._pageJustIds)n=new w([],["GETPAGES"],l,{spatialRel:c._makeRelationshipEnum(a),relationParam:c._makeRelationshipParam(a),outFields:c._layer.objectIdField,resultRecordCount:p,resultOffset:0,geometry:null===b?null:b,where:f,orderByFields:d,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}});else{var e=!0;!0===c._removeGeometry&&(e=!1);var u=null!==c._overrideFields?
c._overrideFields:c._fieldsIncludingObjectId(c._layer.outFields),n=new w([],["GETPAGES"],l,{spatialRel:c._makeRelationshipEnum(a),relationParam:c._makeRelationshipParam(a),outFields:u.join(","),resultRecordCount:p,resultOffset:0,geometry:null===b?null:b,where:f,orderByFields:d,returnGeometry:e,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}})}c._expandPagedSet(n,p,0,1,m).then(k.callback(function(){h.resolve(n)},h),k.errback(h))},h),k.errback(h))}catch(n){h.reject(n)}return h.promise};
e.prototype._clonePageDefinition=function(a){return null===a?null:!0!==a.groupbypage?{groupbypage:!1,spatialRel:a.spatialRel,relationParam:a.relationParam,outFields:a.outFields,resultRecordCount:a.resultRecordCount,resultOffset:a.resultOffset,geometry:a.geometry,where:a.where,orderByFields:a.orderByFields,returnGeometry:a.returnGeometry,returnIdsOnly:a.returnIdsOnly,internal:a.internal}:{groupbypage:!0,spatialRel:a.spatialRel,relationParam:a.relationParam,outFields:a.outFields,resultRecordCount:a.resultRecordCount,
useOIDpagination:a.useOIDpagination,generatedOid:a.generatedOid,groupByFieldsForStatistics:a.groupByFieldsForStatistics,resultOffset:a.resultOffset,outStatistics:a.outStatistics,geometry:a.geometry,where:a.where,orderByFields:a.orderByFields,returnGeometry:a.returnGeometry,returnIdsOnly:a.returnIdsOnly,internal:a.internal}};e.prototype._getPhysicalPage=function(a,b,g){var f=this,m=new t;try{var c=a.pagesDefinition.internal.lastRetrieved,h=new v;this._requestStandardised&&(h.sqlFormat="standard");
h.spatialRelationship=a.pagesDefinition.spatialRel;h.relationParameter=a.pagesDefinition.relationParam;h.outFields=a.pagesDefinition.outFields.split(",");h.num=a.pagesDefinition.resultRecordCount;h.start=a.pagesDefinition.internal.lastRetrieved;h.geometry=a.pagesDefinition.geometry;h.where=a.pagesDefinition.where;h.orderByFields=""!==a.pagesDefinition.orderByFields?a.pagesDefinition.orderByFields.split(","):null;h.returnGeometry=a.pagesDefinition.returnGeometry;h.outSpatialReference=this.spatialReference;
this.executeQuery(h,"execute").then(k.callback(function(b){f._checkCancelled(g);a.pagesDefinition.internal.lastRetrieved!==c&&m.resolve("done");for(var l=0;l<b.features.length;l++)a.pagesDefinition.internal.set[c+l]=b.features[l].attributes[f._layer.objectIdField];if(!1===f._pageJustIds)for(l=0;l<b.features.length;l++)f._featureCache[b.features[l].attributes[f._layer.objectIdField]]=b.features[l];b.features.length!==a.pagesDefinition.resultRecordCount&&(a.pagesDefinition.internal.fullyResolved=!0);
a.pagesDefinition.internal.lastRetrieved=c+a.pagesDefinition.resultRecordCount;m.resolve("done")},m),k.errback(m))}catch(d){m.reject(d)}return m.promise};e.prototype._fieldsIncludingObjectId=function(a){if(null===a)return[this.objectIdField];a=a.slice(0);if(-1<a.indexOf("*"))return a;for(var b=!1,g=0;g<a.length;g++)if(a[g].toUpperCase()===this.objectIdField.toUpperCase()){b=!0;break}!1===b&&a.push(this.objectIdField);return a};e.prototype._getFeatures=function(a,b,g,f){var m=this,c=new t,h=[];try{-1!==
b&&void 0===this._featureCache[b]&&h.push(b);if(!0===this._checkIfNeedToExpandKnownPage(a,this._maxProcessingRate(),f))return this._expandPagedSet(a,this._maxProcessingRate(),0,0,f).then(k.callback(function(){m._getFeatures(a,b,g,f).then(k.callback(function(a){c.resolve(a)},c),k.errback(c))},c),k.errback(c)),c.promise;for(var d=0,l=a._lastFetchedIndex;l<a._known.length;l++){a._lastFetchedIndex+=1;d++;if(void 0===this._featureCache[a._known[l]]){var n=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){var p=
this._layer._mode;if(void 0!==p._featureMap[a._known[l]]){var e=p._featureMap[a._known[l]];null!==e&&(n=!0,this._featureCache[a._known[l]]=e)}}if(!1===n&&(a._known[l]!==b&&h.push(a._known[l]),h.length>=this._maxProcessingRate()-1))break}if(d>=g&&0===h.length)break}if(0===h.length)c.resolve("success");else try{var r=new v;this._requestStandardised&&(r.sqlFormat="standard");r.objectIds=h;r.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields);
r.returnGeometry=!0;!0===this._removeGeometry&&(r.returnGeometry=!1);r.outSpatialReference=this.spatialReference;this.executeQuery(r,"execute").then(k.callback(function(a){m._checkCancelled(f);if(void 0!==a.error)c.reject(Error(a.error));else{for(var b=0;b<a.features.length;b++)m._featureCache[a.features[b].attributes[m._layer.objectIdField]]=a.features[b];c.resolve("success")}},c),k.errback(c))}catch(u){c.reject(u)}}catch(u){c.reject(u)}return c.promise};e.prototype._getDistinctPages=function(a,
b,g,f,m,c,h,d,l){var n=this,p=new t;this._ensureLoaded().then(k.callback(function(){for(var e=g.parseTree.column,r=0;r<n._layer.fields.length;r++)if(n._layer.fields[r].name.toLowerCase()===e.toLowerCase()){e=n._layer.fields[r].name;break}n.databaseType().then(k.callback(function(u){var q=new v;n._requestStandardised&&(q.sqlFormat="standard");u=null===c?null===m?"1\x3d1":"":c.toWhereClause(u);n._layer.definitionExpression&&(u=""!==u?"(("+n._layer.definitionExpression+") AND ("+u+"))":n._layer.definitionExpression);
q.where=u;q.spatialRelationship=n._makeRelationshipEnum(f);q.relationParameter=n._makeRelationshipParam(f);q.geometry=null===m?null:m;q.returnDistinctValues=!0;q.returnGeometry=!1;q.outFields=[e];n.executeQuery(q,"execute").then(k.callback(function(q){n._checkCancelled(l);if(q.hasOwnProperty("features")){for(var u=!1,r=0;r<n._layer.fields.length;r++)if(n._layer.fields[r].name===e){"date"===n._layer.fields[r].type&&(u=!0);break}for(r=0;r<q.features.length;r++){if(u){var t=q.features[r].attributes[e];
null!==t?d.push(new Date(t)):d.push(t)}else d.push(q.features[r].attributes[e]);if(d.length>=h)break}0===q.features.length?p.resolve(d):q.features.length===n._layer.maxRecordCount&&d.length<h?n._getDistinctPages(a+q.features.length,b,g,f,m,c,h,d,l).then(k.callback(function(a){p.resolve({calculated:!0,result:a})},p),k.errback(p)):p.resolve(d)}else p.reject(Error("Unnexected Result querying statistics from layer"))},p),k.errback(p))},p),k.errback(p))},p),k.errback(p));return p.promise};e.prototype._distinctStat=
function(a,b,g,f,m,c,h,d){this._getDistinctPages(0,b,g,f,m,c,h,[],d).then(k.callback(function(b){a.resolve({calculated:!0,result:b})},a),k.errback(a))};e.prototype.isTable=function(){return null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType};e.prototype._countstat=function(a,b,g,f,m,c){var h=this;this.databaseType().then(k.callback(function(b){var c=new v;h._requestStandardised&&(c.sqlFormat="standard");h.isTable()&&f&&null!==g&&""!==g?a.resolve({calculated:!0,
result:0}):(b=null===m?null===f?"1\x3d1":"":m.toWhereClause(b),h._layer.definitionExpression&&(b=""!==b?"(("+h._layer.definitionExpression+") AND ("+b+"))":h._layer.definitionExpression),c.where=b,c.where=b,c.spatialRelationship=h._makeRelationshipEnum(g),c.relationParameter=h._makeRelationshipParam(g),c.geometry=null===f?null:f,c.returnGeometry=!1,h.executeQuery(c,"executeForCount").then(k.callback(function(b){a.resolve({calculated:!0,result:b})},a),k.errback(a)))},a),k.errback(a))};e.prototype._stats=
function(a,b,g,f,m,c,h,d){var l=this;this._ensureLoaded().then(k.callback(function(){var e=l._layer.capabilities&&l._layer.capabilities.query&&!0===l._layer.capabilities.query.supportsSqlExpression,p=l._layer.capabilities&&l._layer.capabilities.query&&!0===l._layer.capabilities.query.supportsStatistics,t=l._layer.capabilities&&l._layer.capabilities.query&&!0===l._layer.capabilities.query.supportsDistinct;"count"===b?t?l._countstat(a,b,f,m,c,d):a.resolve({calculated:!1}):!1===p||!1===g.isSingleField()&&
!1===e||!1===g.isStandardized()?""!==f||null!==c?a.resolve({calculated:!1}):l._manualStat(b,g,h,d).then(k.callback(function(b){a.resolve(b)},a),k.errback(a)):"distinct"===b?!1===t?""!==f||null!==c?a.resolve({calculated:!1}):l._manualStat(b,g,h,d).then(k.callback(function(b){a.resolve(b)},a),k.errback(a)):l._distinctStat(a,b,g,f,m,c,h,d):l.databaseType().then(k.callback(function(h){if(l.isTable()&&m&&null!==f&&""!==f)a.resolve({calculated:!0,result:null});else{var d=new v;l._requestStandardised&&(d.sqlFormat=
"standard");var e=null===c?null===m?"1\x3d1":"":c.toWhereClause(h);l._layer.definitionExpression&&(e=""!==e?"(("+l._layer.definitionExpression+") AND ("+e+"))":l._layer.definitionExpression);d.where=e;d.spatialRelationship=l._makeRelationshipEnum(f);d.relationParameter=l._makeRelationshipParam(f);d.geometry=null===m?null:m;e=new x;e.statisticType=C.decodeStatType(b);e.onStatisticField=g.toWhereClause(h);e.outStatisticFieldName="FORMULA_STAT_RESULT";d.returnGeometry=!1;d.outStatistics=[e];l.executeQuery(d,
"execute").then(k.callback(function(b){if(b.hasOwnProperty("features")&&0!==b.features.length){for(var c=!1,d=0;d<b.fields.length;d++)if("FORMULA_STAT_RESULT"===b.fields[d].name.toUpperCase()){"esriFieldTypeDate"===b.fields[d].type&&(c=!0);break}c?(c=b.features[0].attributes.FORMULA_STAT_RESULT,null!==c&&(c=new Date(b.features[0].attributes.FORMULA_STAT_RESULT)),a.resolve({calculated:!0,result:c})):a.resolve({calculated:!0,result:b.features[0].attributes.FORMULA_STAT_RESULT})}else a.reject(Error("Unnexected Result querying statistics from layer"))},
a),k.errback(a))}},a),k.errback(a))},a),k.errback(a))};e.prototype._stat=function(a,b,g,f,m,c,h){var d=new t;try{this._stats(d,a,b,g,f,m,c,h)}catch(l){d.reject(l)}return d.promise};e.prototype._canDoAggregates=function(a,b,g,f,m){var c=this,h=new t;this._ensureLoaded().then(k.callback(function(){var a=!1,g=c._layer.capabilities&&c._layer.capabilities.query&&!0===c._layer.capabilities.query.supportsSqlExpression;void 0!==c._layer.capabilities&&null!==c._layer.capabilities.query&&!0===c._layer.capabilities.query.supportsStatistics&&
!0===c._layer.capabilities.query.supportsOrderBy&&(a=!0);if(a)for(var f=0;f<b.length-1;f++)null!==b[f].workingexpr&&(!1===b[f].workingexpr.isStandardized()?a=!1:!1===b[f].workingexpr.isSingleField()&&!1===g&&(a=!1));!1===a?h.resolve(!1):h.resolve(!0)},h),k.errback(h));return h.promise};e.prototype._makeRelationshipEnum=function(a){if(0<=a.indexOf("esriSpatialRelRelation"))return"relation";switch(a){case "esriSpatialRelRelation":return"relation";case "esriSpatialRelIntersects":return"intersects";case "esriSpatialRelContains":return"contains";
case "esriSpatialRelOverlaps":return"overlaps";case "esriSpatialRelWithin":return"within";case "esriSpatialRelTouches":return"touches";case "esriSpatialRelCrosses":return"crosses";case "esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return a};e.prototype._makeRelationshipParam=function(a){return 0<=a.indexOf("esriSpatialRelRelation")?a.split(":")[1]:""};e.prototype._getAggregatePagesDataSourceDefinition=function(a,b,g,f,m,c,h){var d=this,l=new t;this._ensureLoaded().then(k.callback(function(){d.databaseType().then(k.callback(function(e){var k=
"",n=!1,r=!1;null!==c&&d._layer.capabilities&&d._layer.capabilities.query&&!0===d._layer.capabilities.query.supportsOrderBy&&(k=c.constructClause(),r=!0);d._layer.capabilities&&d._layer.capabilities.query&&!1===d._layer.capabilities.query.supportsPagination&&(r=!1,n=!0,k=d._layer.objectIdField);for(var t=[],q=0;q<b.length;q++){var v=new x;v.onStatisticField=null!==b[q].workingexpr?b[q].workingexpr.toWhereClause(e):"";v.outStatisticFieldName=b[q].field;v.statisticType=b[q].toStatisticsName();t.push(v)}""===
k&&(k=a.join(","));q=d._maxQueryRate();void 0!==d._layer.maxRecordCount&&d._layer.maxRecordCount<q&&(q=d._layer.maxRecordCount);e=null===m?null===f?"1\x3d1":"":m.toWhereClause(e);d._layer.definitionExpression&&(e=""!==e?"(("+d._layer.definitionExpression+") AND ("+e+"))":d._layer.definitionExpression);k=new w([],["GETPAGES"],r,{groupbypage:!0,spatialRel:d._makeRelationshipEnum(g),relationParam:d._makeRelationshipParam(g),outFields:["*"],useOIDpagination:n,generatedOid:h,resultRecordCount:q,resultOffset:0,
groupByFieldsForStatistics:a,outStatistics:t,geometry:null===f?null:f,where:e,orderByFields:k,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,fullyResolved:!1}});l.resolve(k)},l),k.errback(l))},l),k.errback(l));return l.promise};e.prototype._getAgregagtePhysicalPage=function(a,b,g){var f=this,e=new t;try{var c=a.pagesDefinition.where;!0===a.pagesDefinition.useOIDpagination&&(c=""!==c?"("+c+") AND ("+a.pagesDefinition.generatedOid+"\x3e"+a.pagesDefinition.internal.lastMaxId.toString()+
")":a.pagesDefinition.generatedOid+"\x3e"+a.pagesDefinition.internal.lastMaxId.toString());var h=a.pagesDefinition.internal.lastRetrieved,d=new v;this._requestStandardised&&(d.sqlFormat="standard");d.where=c;d.spatialRelationship=a.pagesDefinition.spatialRel;d.relationParameter=a.pagesDefinition.relationParam;d.outFields=a.pagesDefinition.outFields;d.outStatistics=a.pagesDefinition.outStatistics;d.geometry=a.pagesDefinition.geometry;d.groupByFieldsForStatistics=a.pagesDefinition.groupByFieldsForStatistics;
d.num=a.pagesDefinition.resultRecordCount;d.start=a.pagesDefinition.internal.lastRetrieved;d.returnGeometry=a.pagesDefinition.returnGeometry;d.orderByFields=""!==a.pagesDefinition.orderByFields?a.pagesDefinition.orderByFields.split(","):null;if(this.isTable()&&d.geometry&&d.spatialRelationship)return e.resolve([]),e.promise;this.executeQuery(d,"execute").then(k.callback(function(b){f._checkCancelled(g);if(b.hasOwnProperty("features")){var c=[];if(a.pagesDefinition.internal.lastRetrieved!==h)e.resolve([]);
else{for(var d=0;d<b.features.length;d++)a.pagesDefinition.internal.set[h+d]=b.features[d].attributes[a.pagesDefinition.generatedOid];for(d=0;d<b.features.length;d++)c.push(new A({attributes:b.features[d].attributes,geometry:null}));!0===a.pagesDefinition.useOIDpagination?0===b.features.length?a.pagesDefinition.internal.fullyResolved=!0:a.pagesDefinition.internal.lastMaxId=b.features[b.features.length-1].attributes[a.pagesDefinition.generatedOid]:b.features.length!==a.pagesDefinition.resultRecordCount&&
(a.pagesDefinition.internal.fullyResolved=!0);a.pagesDefinition.internal.lastRetrieved=h+a.pagesDefinition.resultRecordCount;e.resolve(c)}}else e.reject(Error("Unnexected Result querying aggregates from layer"))},e),k.errback(e))}catch(l){e.reject(l)}return e.promise};e.create=function(a,b,g,f,k){a={url:a,outFields:null===b?["*"]:b};null!==g&&""!==g&&(a.token=g);g=new I(a);return new e({layer:g,spatialReference:f,lrucache:k})};e.prototype.canBeBigDataFeatureSet=function(){return!0};e.prototype.shouldBeResolvedAsBigData=
function(){return!1};e.prototype.expressAsArcadeScriptImpl=function(a,b,e){a=this.arcadeAssignNextGlobalIdentifier(e);b[a]={name:a,type:"FeatureLayer",params:{url:this._layer.parsedUrl.path,token:this._layer.token,definitionExpression:this._layer.definitionExpression,fields:this._layer.outFields}};e.featuresetsyms.push(a);return""};return e}(B)});