// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports dojox/gfx/_base ../../core/Error ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils".split(" "),function(C,q,w,x,u,m,r,y,z){function A(g,d){var b=B.getContext("2d"),c=[];d&&(d.weight&&c.push(d.weight),d.size&&c.push(d.size+"px"),d.family&&c.push(d.family));b.font=c.join(" ");return b.measureText(g).width}Object.defineProperty(q,"__esModule",{value:!0});var B=document.createElement("canvas");q.previewSymbol2D=function(g,d){var b=d&&d.size?
m.pt2px(d.size):null,c=d&&d.maxSize?m.pt2px(d.maxSize):null,l=d&&null!=d.opacity?d.opacity:null,q=d&&null!=d.rotation?d.rotation:null,a=r.getStroke(g),h={shape:null,fill:null,stroke:a};a&&a.width&&(a.width=Math.min(a.width,80));var f=0,e=0,k=a&&a.width||0,t=!1,v=null;switch(g.type){case "simple-marker":l=g.style;e=f=b=Math.min(b||m.pt2px(g.size),c||120);switch(l){case "circle":h.shape={type:"circle",cx:0,cy:0,r:.5*b};break;case "cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",
values:[f,.5*e]},{command:"M",values:[.5*f,0]},{command:"L",values:[.5*f,e]},{command:"E",values:[]}]};break;case "diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[.5*f,0]},{command:"L",values:[f,.5*e]},{command:"L",values:[.5*f,e]},{command:"Z",values:[]}]};break;case "square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[f,0]},{command:"L",values:[f,e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]};break;case "triangle":h.shape=
{type:"path",path:[{command:"M",values:[.5*f,0]},{command:"L",values:[f,e]},{command:"L",values:[0,e]},{command:"Z",values:[]}]};break;case "x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[f,e]},{command:"M",values:[f,0]},{command:"L",values:[0,e]},{command:"E",values:[]}]};break;case "path":t=!0,h.shape={type:"path",path:g.path||""}}break;case "simple-line":k=Math.min(b||k,c||80);f=22<k?2*k:40;e=k;a.width=k;k=0;h.shape={type:"path",path:[{command:"M",values:[0,.5*e]},
{command:"L",values:[f,.5*e]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":e=f=b=Math.min(b,c||120);t=!0;h.shape=y.shapes.fill[0];break;case "picture-marker":var n=c||120,a=m.pt2px(g.width),c=m.pt2px(g.height),b=Math.min(b||Math.max(a,c),n),c=a/c,a=1>=c?Math.ceil(b*c):b,c=1>=c?b:Math.ceil(b/c),f=a,e=c,v=l;h.shape={type:"image",x:-Math.round(a/2),y:-Math.round(c/2),width:a,height:c,src:g.url||""};break;case "text":l=g.text||"Aa",a=g.font,b=Math.min(b||m.pt2px(a.size),c||120),
n=A(l,{weight:a.weight,size:b,family:a.family}),f=(c=/[\uE600-\uE6FF]/.test(l))?b:n,e=b,n=.25*w.normalizedLength((a?b:0).toString()),c&&(n+=5),h.shape={type:"text",text:l,x:0,y:n,align:"middle",decoration:a&&a.decoration,rotated:g.rotated,kerning:g.kerning},h.font=a&&{size:b,style:a.style,decoration:a.decoration,weight:a.weight,family:a.family}}if(!h.shape)return u.reject(new x("symbolPreview: renderPreviewHTML2D","symbol not supported."));var f=(f||22)+k+1,e=(e||22)+k+1,p=r.getFill(g),k=g.color,
b=null;p&&"pattern"===p.type&&k&&"picture-fill"!==g.type?b=r.getPatternUrlWithColor(p.src,k.toCss(!0)).then(function(a){p.src=a;h.fill=p;return h}):(h.fill=p,b=u.resolve(h));return b.then(function(a){return z.renderSymbol([[a]],[f,e],{node:d&&d.node,scale:t,opacity:v,rotation:q})})}});