// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils ./styleUtils ./utils".split(" "),function(G,B,C,H,v,t,I,u,z,J,D){function x(a){var c=a.outline,b=a.get("material.color"),b=b&&b.toRgba().toString();if(!c)return"fill"===a.type&&"255,255,255,1"===b?{color:"#bdc3c7",width:.75}:null;a=t.pt2px(c.size)||0;return{color:"rgba("+(null!=c.color?c.color.toRgba():"255,255,255,1")+")",width:Math.min(a,80)}}function K(a,
c){var b=c&&c.resource,b=b&&b.href;return a.thumbnail&&a.thumbnail.url?v.resolve(a.thumbnail.url):b&&"object"!==c.type?v.resolve(D.getIconHref(a,c)):a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?J.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal}).catch(function(a){return a}).then(function(a){return a&&a.thumbnail&&a.thumbnail.url||E}):v.resolve(E)}function f(a,c){void 0===c&&(c=0);if(!a.material||!a.material.color)return a=Math.min(Math.max(I.defaultThematicColor.r+
191.25*c,0),255),[a,a,a,100];for(var b=a.material.color.toRgb(),e=0;3>e;e++)b[e]=Math.min(Math.max(b[e]+191.25*c,0),255);b.push(a.material.color.a);return b}function F(a){return a.outline?x(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function A(a,c){if(!a.material)return{};for(var b=a.material.color.toRgb(),e="rgba(",f=0;3>f;f++)e+=Math.min(Math.max(b[f]+191.25*c,0),255)+",";e+=a.material.color.a+");";a=a.size?t.pt2px(a.size):.75;return{color:e,width:Math.min(a,80)}}function w(a,c,b){b*=.75;return{type:"linear",
x1:b?.25*b:0,y1:b?.5*b:0,x2:b||4,y2:b?.5*b:4,colors:[{color:a,offset:0},{color:c,offset:1}]}}function L(a){var c=a.depth,b=a.height;return(a=a.width)&&c&&b&&a===c&&a<b}function M(a,c,b,e){var r=a&&a.type,m="object"===r,d=[];if("icon"===r)switch(c){case "circle":d.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:f(a,0),stroke:x(a)});break;case "square":d.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},{command:"L",values:[b,b]},{command:"Z",
values:[]}]},fill:f(a,0),stroke:x(a)});break;case "triangle":d.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:f(a,0),stroke:x(a)});break;case "cross":d.push({shape:{type:"path",path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]},{command:"E",values:[]}]},stroke:F(a)});break;case "x":d.push({shape:{type:"path",path:[{command:"M",
values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]},{command:"E",values:[]}]},stroke:F(a)});break;case "kite":d.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:f(a,0),stroke:x(a)})}else if(m)switch(c){case "cone":c=f(a,0);a=f(a,-.6);a=w(c,a,e?20:b);b=u.getConeShapes(b,e);d.push({shape:b[0],fill:a});d.push({shape:b[1],fill:a});
break;case "inverted-cone":e=f(a,0);a=f(a,-.6);a=w(e,a,b);b=u.getInvertedConeShapes(b);d.push({shape:b[0],fill:a});d.push({shape:b[1],fill:e});break;case "cube":b=u.getCubeShapes(b,e);d.push({shape:b[0],fill:f(a,0)});d.push({shape:b[1],fill:f(a,-.3)});d.push({shape:b[2],fill:f(a,-.5)});break;case "cylinder":c=f(a,0);r=f(a,-.6);c=w(c,r,e?20:b);b=u.getCylinderShapes(b,e);d.push({shape:b[0],fill:c});d.push({shape:b[1],fill:c});d.push({shape:b[2],fill:f(a,0)});break;case "diamond":b=u.getDiamondShapes(b);
d.push({shape:b[0],fill:f(a,-.3)});d.push({shape:b[1],fill:f(a,0)});d.push({shape:b[2],fill:f(a,-.3)});d.push({shape:b[3],fill:f(a,-.7)});break;case "sphere":e=f(a,0);a=f(a,-.6);a=w(e,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;d.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});break;case "tetrahedron":b=u.getTetrahedronShapes(b),d.push({shape:b[0],fill:f(a,-.3)}),d.push({shape:b[1],fill:f(a,0)}),d.push({shape:b[2],fill:f(a,-.6)})}return d}function N(a,c){var b=c&&c.size?t.pt2px(c.size):null,f=c&&
c.maxSize?t.pt2px(c.maxSize):null,r=c&&c.disableUpsampling,m=a.symbolLayers,d=[],k=0,q=0,n=m.getItemAt(m.length-1),h;n&&"icon"===n.type&&(h=n.size&&t.pt2px(n.size));m.forEach(function(g,e){if("icon"===g.type||"object"===g.type){e="icon"===g.type?g.size&&t.pt2px(g.size):0;var n=b||e?Math.ceil(Math.min(b||e,f||120)):22,l=x(g),p=l?l.width:0;if(g&&g.resource&&g.resource.href)e=K(a,g).then(function(a){var b=g.get("material.color"),c;c="icon"===g.type?"multiply":"tint";return z.tintImageWithColor(a,n,b,
c,r)}).then(function(a){var b=a.width,c=a.height;k=Math.max(k,b+p+1);q=Math.max(q,c+p+1);return[{shape:{type:"image",width:b,height:c,src:a.url},fill:null,stroke:null}]}),d.unshift(e);else{(l=g.get("resource.primitive"))||(l="icon"===g.type?"circle":"sphere");var m=n;"icon"===g.type&&h&&b&&(m=e/h*n);e=c&&"tall"===c.symbolConfig||("object"===g.type?L(g):!1);k=Math.max(k,e?20:m+p+1);q=Math.max(q,m+p+1);d.unshift(v.resolve(M(g,l,m,e)))}}});return v.eachAlways(d).then(function(a){var b=[];a.forEach(function(a){a.value?
b.push(a.value):a.error&&O.warn("error while building swatchInfo!",a.error)});return z.renderSymbol(b,[k,q],{node:c&&c.node,scale:!1})})}function P(a,c){var b=a.symbolLayers,e=[];a=D.isVolumetricSymbol(a);var r=c&&c.size?t.pt2px(c.size):null,m=(c&&c.maxSize?t.pt2px(c.maxSize):null)||80,d=0,k=0,q;b.forEach(function(a,b){var c=a&&a.type,l="line"===c;if(l||"path"===c){var h=A(a,0),n=h&&h.width||0,c=[];l?(0===b&&(q=n),a=Math.min(r||n,m),a=0===b?a:r?n/q*a:a,k=Math.max(k,a),d=Math.max(d,22<a?a+1:40),h.width=
a,c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*k]},{command:"L",values:[d,.5*k]},{command:"E",values:[]}]},stroke:h})):(b=Math.min(r||22,m),h=f(a,0),l=f(a,-.2),a=A(a,-.4),a.width=1,c.push({shape:u.shapes.pathSymbol3DLayer[0],fill:l,stroke:a}),c.push({shape:u.shapes.pathSymbol3DLayer[1],fill:h,stroke:a}),d=k=Math.max(k,b+1+1));e.push(c)}});return v.resolve(z.renderSymbol(e,[d,k],{node:c&&c.node,scale:a}))}Object.defineProperty(B,"__esModule",{value:!0});var E=G.toUrl("../../images/Legend/legend3dsymboldefault.png"),
O=H.getLogger("esri.symbols.support.previewSymbol3D");B.getSymbolLayerFill=f;B.previewSymbol3D=function(a,c){if(0===a.symbolLayers.length)return v.reject(new C("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var b=null;switch(a.type){case "point-3d":b=N(a,c);break;case "line-3d":b=P(a,c);break;case "polygon-3d":case "mesh-3d":a:{b="mesh-3d"===a.type;a=a.symbolLayers;for(var e=c&&c.size?t.pt2px(c.size):null,r=c&&c.maxSize?t.pt2px(c.maxSize):null,e=e||22,m=[],d=0,k=0,q=!1,n=
0;n<a.length;n++){var h=a.getItemAt(n),g=h.type,l="fill"===g,w="line"===g,y="extrude"===h.type,g=[];if(b&&!l){b=void 0;break a}var p=u.shapes.fill[0];l?(q=(l=x(h))&&l.width||0,d=Math.max(d,e+q),k=Math.max(k,e+q),q=!0,g.push({shape:p,fill:f(h,0),stroke:l})):w?(h=(l=A(h,0))&&l.width||0,p={stroke:l,shape:p},d=Math.max(d,22+h),k=Math.max(k,22+h),g.push(p)):y&&(p=A(h,-.4),l=f(h,0),h=f(h,-.2),w=Math.min(e,r||120),y=u.getExtrudeSymbolShapes(w),p.width=1,g.push({shape:y[0],fill:h,stroke:p}),g.push({shape:y[1],
fill:h,stroke:p}),g.push({shape:y[2],fill:l,stroke:p}),h=22*.7+.5*w,d=Math.max(d,22+p.width+1),k=Math.max(k,h+p.width+1));m.push(g)}b=v.resolve(z.renderSymbol(m,[d,k],{node:c&&c.node,scale:q}))}}return b?b:v.reject(new C("symbolPreview: swatchInfo3D","symbol not supported."))}});