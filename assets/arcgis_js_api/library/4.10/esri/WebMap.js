// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.10/esri/copyright.txt for details.
//>>built
require({cache:{"esri/webmap/Bookmark":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../geometry/Extent ../webdoc/support/Thumbnail".split(" "),function(n,p,m,h,d,e,l,k,f){return function(d){function b(b){b=d.call(this)||this;b.extent=null;b.name=null;b.thumbnail=new f.default;return b}m(b,d);b.prototype.castThumbnail=function(b){return"string"===typeof b?
new f.default({url:b}):l.ensureType(f.default,b)};h([e.property({type:k})],b.prototype,"extent",void 0);h([e.property()],b.prototype,"name",void 0);h([e.property({type:f.default})],b.prototype,"thumbnail",void 0);h([e.cast("thumbnail")],b.prototype,"castThumbnail",null);return b=h([e.subclass("esri.webmap.Bookmark")],b)}(e.declared(d))})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(n,p,m,h,d,e){Object.defineProperty(p,"__esModule",{value:!0});n=function(d){function k(){var b=null!==d&&d.apply(this,arguments)||this;b.url="";return b}m(k,d);f=k;k.prototype.clone=function(){return new f({url:this.url})};var f;h([e.property({type:String,json:{write:{isRequired:!0}}})],k.prototype,"url",void 0);return k=f=h([e.subclass("esri.webdoc.support.Thumbnail")],k)}(e.declared(d));p.default=n})},"esri/webmap/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference".split(" "),
function(n,p,m,h,d,e,l,k){return function(e){function b(b){b=e.call(this,b)||this;b.spatialReference=null;b.viewpoint=null;return b}m(b,e);f=b;b.prototype.clone=function(){return new f({spatialReference:this.spatialReference?this.spatialReference.clone():null,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var f;h([l.shared("esri.webmap.InitialViewProperties")],b.prototype,"declaredClass",void 0);h([l.property({value:null,type:k})],b.prototype,"spatialReference",void 0);h([l.property({value:null,
type:d})],b.prototype,"viewpoint",void 0);return b=f=h([l.subclass()],b)}(l.declared(e))})},"*noref":1}});
define("require exports ./core/tsSupport/assignHelper ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./Map ./Viewpoint ./core/asyncUtils ./core/Collection ./core/Error ./core/JSONSupport ./core/Loadable ./core/loadAll ./core/Logger ./core/promiseUtils ./core/accessorSupport/decorators ./geometry/SpatialReference ./geometry/support/webMercatorUtils ./portal/Portal ./portal/PortalItem ./portal/support/geometryServiceUtils ./tasks/support/ProjectParameters ./webmap/Bookmark ./webmap/InitialViewProperties".split(" "),function(n,
p,m,h,d,e,l,k,f,b,v,w,x,y,q,g,z,A,t,B,C,D,E,r){var u=f.ofType(E),F=y.getLogger("esri.WebMap");return function(e){function c(a){a=e.call(this)||this;a.applicationProperties=null;a.authoringApp=null;a.authoringAppVersion=null;a.bookmarks=new u;a.initialViewProperties=null;a.portalItem=null;a.presentation=null;a.sourceVersion=null;a.tables=null;a.widgets=null;return a}h(c,e);f=c;c.prototype.initialize=function(){this.when().catch(function(a){F.error("#load()","Failed to load web map",a)});if(this.resourceInfo){var a=
void 0;try{a=this._validateJSON(this.resourceInfo)}catch(G){this.addResolvingPromise(q.reject(G));return}this.read(a)}};c.prototype.readInitialViewProperties=function(a,b){a={};b.spatialReference&&(a.spatialReference=z.fromJSON(b.spatialReference));return new r(a)};c.prototype.readSourceVersion=function(a,b){a=b.version.split(".");b=a[1];return{major:parseInt(a[0],10),minor:parseInt(b,10)}};c.prototype.load=function(){this.addResolvingPromise(this._loadFromSource());return this.when()};c.prototype.loadAll=
function(){var a=this;return k.safeCast(x.loadAll(this,function(b){b(a.ground,a.basemap,a.layers)}))};c.prototype.toJSON=function(){throw new b("internal:not-yet-implemented","WebMap.toJSON is not yet implemented");};c.fromJSON=function(a){if(!a)return null;if(a.declaredClass)throw Error("JSON object is already hydrated");return new f({resourceInfo:a})};c.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-map"}):this.portalItem&&this.portalItem.id?
this._loadFromItem(this.portalItem):q.resolve(null)};c.prototype._loadFromItem=function(a){var c=this;return a.load().catch(function(a){throw new b("webmap:load-portal-item","Failed to load portal item",{error:a});}).then(function(){if("Web Map"!==a.type)throw new b("webmap:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Map'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(b){c.resourceInfo=b;return c._readAndLoadFromJSON(b,{origin:"web-map",portal:a.portal||
t.getDefault()})}).then(function(){return c._getInitialExtent()}).then(function(a){if(a){var b=c.initialViewProperties?c.initialViewProperties.clone():new r;b.viewpoint=new l;b.viewpoint.targetGeometry=a;c.initialViewProperties=b}})};c.prototype._readAndLoadFromJSON=function(a,b){a=this._validateJSON(a);this.read(a,b);return this._loadFromJSON(a,b)};c.prototype._validateJSON=function(a){a=this._sanitizeJSON(a);var b=this._validateVersion(a.version);a.version=b.major+"."+b.minor;return a};c.prototype._sanitizeJSON=
function(a){return{authoringApp:a.authoringApp||"",authoringAppVersion:a.authoringAppVersion||"",applicationProperties:a.applicationProperties,baseMap:a.baseMap,bookmarks:a.bookmarks,operationalLayers:a.operationalLayers,presentation:a.presentation,spatialReference:a.spatialReference,tables:a.tables,version:a.version||"0.0",widgets:a.widgets}};c.prototype._validateVersion=function(a){var c=a.split("."),d=c[0],c=c[1],e=/^\s*\d+\s*$/;if(!e.test(d))throw new b("webmap:invalid-version","Expected major version to be a number, but got '"+
a+"'",{version:a});if(!e.test(c))throw new b("webmap:invalid-version","Expected minor version to be a number, but got '"+a+"'",{version:a});d=parseInt(d,10);c=parseInt(c,10);if(2!==d)throw new b("webmap:unsupported-version","Required major version is '2', but got '"+d+"'",{version:a});return{major:d,minor:c}};c.prototype._loadFromJSON=function(a,b){var c=this,d={context:m({},b,{layerContainerType:"operational-layers"})};this.portalItem&&(d.context.portal=this.portalItem.portal||t.getDefault());return q.create(function(a){return n(["./portal/support/layersCreator"],
a)}).then(function(b){var e=[],f=a.operationalLayers;f&&f.length&&e.push.apply(e,b.populateOperationalLayers(c.layers,f,d));return q.eachAlways(e).then(function(){})})};c.prototype._getInitialExtent=function(){var a=null,b=this.initialViewProperties&&this.initialViewProperties.spatialReference,c=this.portalItem&&this.portalItem.extent;if(b&&c)if(b.isWGS84)a=c.clone();else if(b.isWebMercator)a=A.geographicToWebMercator(c);else return C.create(this.portalItem).then(function(a){var d=new D;d.geometries=
[c];d.outSpatialReference=b;return a.project(d)}).then(function(a){return a[0]}).catch(function(a){console.log("Error projecting item's extent:",a);return null});return q.resolve(a)};var f;d([g.property()],c.prototype,"applicationProperties",void 0);d([g.property()],c.prototype,"authoringApp",void 0);d([g.property()],c.prototype,"authoringAppVersion",void 0);d([g.property({json:{read:{source:"baseMap"}}})],c.prototype,"basemap",void 0);d([g.property({type:u})],c.prototype,"bookmarks",void 0);d([g.property({type:r})],
c.prototype,"initialViewProperties",void 0);d([g.reader("initialViewProperties",["spatialReference"])],c.prototype,"readInitialViewProperties",null);d([g.property({type:B})],c.prototype,"portalItem",void 0);d([g.property()],c.prototype,"presentation",void 0);d([g.property()],c.prototype,"resourceInfo",void 0);d([g.property({readOnly:!0})],c.prototype,"sourceVersion",void 0);d([g.reader("sourceVersion",["version"])],c.prototype,"readSourceVersion",null);d([g.property()],c.prototype,"tables",void 0);
d([g.property()],c.prototype,"widgets",void 0);return c=f=d([g.subclass("esri.WebMap")],c)}(g.declared(e,w,v))});